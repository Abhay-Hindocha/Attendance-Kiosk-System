function eI(){import.meta.url,import("_").catch(()=>1);async function*e(){}}function a1(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const s=Object.getOwnPropertyDescriptor(r,a);s&&Object.defineProperty(e,a,s.get?s:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();function s1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var uv={exports:{}},wc={},dv={exports:{}},Be={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vi=Symbol.for("react.element"),o1=Symbol.for("react.portal"),i1=Symbol.for("react.fragment"),l1=Symbol.for("react.strict_mode"),c1=Symbol.for("react.profiler"),u1=Symbol.for("react.provider"),d1=Symbol.for("react.context"),h1=Symbol.for("react.forward_ref"),f1=Symbol.for("react.suspense"),p1=Symbol.for("react.memo"),m1=Symbol.for("react.lazy"),Fp=Symbol.iterator;function g1(e){return e===null||typeof e!="object"?null:(e=Fp&&e[Fp]||e["@@iterator"],typeof e=="function"?e:null)}var hv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},fv=Object.assign,pv={};function Zs(e,t,n){this.props=e,this.context=t,this.refs=pv,this.updater=n||hv}Zs.prototype.isReactComponent={};Zs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Zs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function mv(){}mv.prototype=Zs.prototype;function Ch(e,t,n){this.props=e,this.context=t,this.refs=pv,this.updater=n||hv}var Sh=Ch.prototype=new mv;Sh.constructor=Ch;fv(Sh,Zs.prototype);Sh.isPureReactComponent=!0;var Mp=Array.isArray,gv=Object.prototype.hasOwnProperty,Eh={current:null},vv={key:!0,ref:!0,__self:!0,__source:!0};function xv(e,t,n){var r,a={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)gv.call(t,r)&&!vv.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:vi,type:e,key:s,ref:o,props:a,_owner:Eh.current}}function v1(e,t){return{$$typeof:vi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Rh(e){return typeof e=="object"&&e!==null&&e.$$typeof===vi}function x1(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Op=/\/+/g;function Zc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?x1(""+e.key):t.toString(36)}function hl(e,t,n,r,a){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case vi:case o1:o=!0}}if(o)return o=e,a=a(o),e=r===""?"."+Zc(o,0):r,Mp(a)?(n="",e!=null&&(n=e.replace(Op,"$&/")+"/"),hl(a,t,n,"",function(u){return u})):a!=null&&(Rh(a)&&(a=v1(a,n+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(Op,"$&/")+"/")+e)),t.push(a)),1;if(o=0,r=r===""?".":r+":",Mp(e))for(var l=0;l<e.length;l++){s=e[l];var c=r+Zc(s,l);o+=hl(s,t,n,c,a)}else if(c=g1(e),typeof c=="function")for(e=c.call(e),l=0;!(s=e.next()).done;)s=s.value,c=r+Zc(s,l++),o+=hl(s,t,n,c,a);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Ai(e,t,n){if(e==null)return e;var r=[],a=0;return hl(e,r,"","",function(s){return t.call(n,s,a++)}),r}function y1(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var en={current:null},fl={transition:null},b1={ReactCurrentDispatcher:en,ReactCurrentBatchConfig:fl,ReactCurrentOwner:Eh};function yv(){throw Error("act(...) is not supported in production builds of React.")}Be.Children={map:Ai,forEach:function(e,t,n){Ai(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ai(e,function(){t++}),t},toArray:function(e){return Ai(e,function(t){return t})||[]},only:function(e){if(!Rh(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Be.Component=Zs;Be.Fragment=i1;Be.Profiler=c1;Be.PureComponent=Ch;Be.StrictMode=l1;Be.Suspense=f1;Be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=b1;Be.act=yv;Be.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=fv({},e.props),a=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=Eh.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)gv.call(t,c)&&!vv.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:vi,type:e.type,key:a,ref:s,props:r,_owner:o}};Be.createContext=function(e){return e={$$typeof:d1,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:u1,_context:e},e.Consumer=e};Be.createElement=xv;Be.createFactory=function(e){var t=xv.bind(null,e);return t.type=e,t};Be.createRef=function(){return{current:null}};Be.forwardRef=function(e){return{$$typeof:h1,render:e}};Be.isValidElement=Rh;Be.lazy=function(e){return{$$typeof:m1,_payload:{_status:-1,_result:e},_init:y1}};Be.memo=function(e,t){return{$$typeof:p1,type:e,compare:t===void 0?null:t}};Be.startTransition=function(e){var t=fl.transition;fl.transition={};try{e()}finally{fl.transition=t}};Be.unstable_act=yv;Be.useCallback=function(e,t){return en.current.useCallback(e,t)};Be.useContext=function(e){return en.current.useContext(e)};Be.useDebugValue=function(){};Be.useDeferredValue=function(e){return en.current.useDeferredValue(e)};Be.useEffect=function(e,t){return en.current.useEffect(e,t)};Be.useId=function(){return en.current.useId()};Be.useImperativeHandle=function(e,t,n){return en.current.useImperativeHandle(e,t,n)};Be.useInsertionEffect=function(e,t){return en.current.useInsertionEffect(e,t)};Be.useLayoutEffect=function(e,t){return en.current.useLayoutEffect(e,t)};Be.useMemo=function(e,t){return en.current.useMemo(e,t)};Be.useReducer=function(e,t,n){return en.current.useReducer(e,t,n)};Be.useRef=function(e){return en.current.useRef(e)};Be.useState=function(e){return en.current.useState(e)};Be.useSyncExternalStore=function(e,t,n){return en.current.useSyncExternalStore(e,t,n)};Be.useTransition=function(){return en.current.useTransition()};Be.version="18.3.1";dv.exports=Be;var E=dv.exports;const Cs=s1(E),w1=a1({__proto__:null,default:Cs},[E]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N1=E,_1=Symbol.for("react.element"),j1=Symbol.for("react.fragment"),k1=Object.prototype.hasOwnProperty,C1=N1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,S1={key:!0,ref:!0,__self:!0,__source:!0};function bv(e,t,n){var r,a={},s=null,o=null;n!==void 0&&(s=""+n),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)k1.call(t,r)&&!S1.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:_1,type:e,key:s,ref:o,props:a,_owner:C1.current}}wc.Fragment=j1;wc.jsx=bv;wc.jsxs=bv;uv.exports=wc;var i=uv.exports,rd={},wv={exports:{}},En={},Nv={exports:{}},_v={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(F,W){var I=F.length;F.push(W);e:for(;0<I;){var q=I-1>>>1,K=F[q];if(0<a(K,W))F[q]=W,F[I]=K,I=q;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var W=F[0],I=F.pop();if(I!==W){F[0]=I;e:for(var q=0,K=F.length,re=K>>>1;q<re;){var ie=2*(q+1)-1,ce=F[ie],me=ie+1,je=F[me];if(0>a(ce,I))me<K&&0>a(je,ce)?(F[q]=je,F[me]=I,q=me):(F[q]=ce,F[ie]=I,q=ie);else if(me<K&&0>a(je,I))F[q]=je,F[me]=I,q=me;else break e}}return W}function a(F,W){var I=F.sortIndex-W.sortIndex;return I!==0?I:F.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,m=!1,x=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(F){for(var W=n(u);W!==null;){if(W.callback===null)r(u);else if(W.startTime<=F)r(u),W.sortIndex=W.expirationTime,t(c,W);else break;W=n(u)}}function b(F){if(x=!1,w(F),!m)if(n(c)!==null)m=!0,U(N);else{var W=n(u);W!==null&&z(b,W.startTime-F)}}function N(F,W){m=!1,x&&(x=!1,g(j),j=-1),p=!0;var I=f;try{for(w(W),h=n(c);h!==null&&(!(h.expirationTime>W)||F&&!M());){var q=h.callback;if(typeof q=="function"){h.callback=null,f=h.priorityLevel;var K=q(h.expirationTime<=W);W=e.unstable_now(),typeof K=="function"?h.callback=K:h===n(c)&&r(c),w(W)}else r(c);h=n(c)}if(h!==null)var re=!0;else{var ie=n(u);ie!==null&&z(b,ie.startTime-W),re=!1}return re}finally{h=null,f=I,p=!1}}var _=!1,k=null,j=-1,C=5,S=-1;function M(){return!(e.unstable_now()-S<C)}function T(){if(k!==null){var F=e.unstable_now();S=F;var W=!0;try{W=k(!0,F)}finally{W?A():(_=!1,k=null)}}else _=!1}var A;if(typeof v=="function")A=function(){v(T)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,O=L.port2;L.port1.onmessage=T,A=function(){O.postMessage(null)}}else A=function(){y(T,0)};function U(F){k=F,_||(_=!0,A())}function z(F,W){j=y(function(){F(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,U(N))},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(F){switch(f){case 1:case 2:case 3:var W=3;break;default:W=f}var I=f;f=W;try{return F()}finally{f=I}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(F,W){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var I=f;f=F;try{return W()}finally{f=I}},e.unstable_scheduleCallback=function(F,W,I){var q=e.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?q+I:q):I=q,F){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=I+K,F={id:d++,callback:W,priorityLevel:F,startTime:I,expirationTime:K,sortIndex:-1},I>q?(F.sortIndex=I,t(u,F),n(c)===null&&F===n(u)&&(x?(g(j),j=-1):x=!0,z(b,I-q))):(F.sortIndex=K,t(c,F),m||p||(m=!0,U(N))),F},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(F){var W=f;return function(){var I=f;f=W;try{return F.apply(this,arguments)}finally{f=I}}}})(_v);Nv.exports=_v;var E1=Nv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R1=E,Sn=E1;function oe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jv=new Set,Wo={};function Ya(e,t){$s(e,t),$s(e+"Capture",t)}function $s(e,t){for(Wo[e]=t,e=0;e<t.length;e++)jv.add(t[e])}var Dr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ad=Object.prototype.hasOwnProperty,D1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lp={},Bp={};function I1(e){return ad.call(Bp,e)?!0:ad.call(Lp,e)?!1:D1.test(e)?Bp[e]=!0:(Lp[e]=!0,!1)}function A1(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function T1(e,t,n,r){if(t===null||typeof t>"u"||A1(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function tn(e,t,n,r,a,s,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var Lt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Lt[e]=new tn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Lt[t]=new tn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Lt[e]=new tn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Lt[e]=new tn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Lt[e]=new tn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Lt[e]=new tn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Lt[e]=new tn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Lt[e]=new tn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Lt[e]=new tn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Dh=/[\-:]([a-z])/g;function Ih(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Dh,Ih);Lt[t]=new tn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Dh,Ih);Lt[t]=new tn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Dh,Ih);Lt[t]=new tn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Lt[e]=new tn(e,1,!1,e.toLowerCase(),null,!1,!1)});Lt.xlinkHref=new tn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Lt[e]=new tn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ah(e,t,n,r){var a=Lt.hasOwnProperty(t)?Lt[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(T1(t,n,a,r)&&(n=null),r||a===null?I1(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Pr=R1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ti=Symbol.for("react.element"),hs=Symbol.for("react.portal"),fs=Symbol.for("react.fragment"),Th=Symbol.for("react.strict_mode"),sd=Symbol.for("react.profiler"),kv=Symbol.for("react.provider"),Cv=Symbol.for("react.context"),Ph=Symbol.for("react.forward_ref"),od=Symbol.for("react.suspense"),id=Symbol.for("react.suspense_list"),Fh=Symbol.for("react.memo"),Gr=Symbol.for("react.lazy"),Sv=Symbol.for("react.offscreen"),Wp=Symbol.iterator;function co(e){return e===null||typeof e!="object"?null:(e=Wp&&e[Wp]||e["@@iterator"],typeof e=="function"?e:null)}var it=Object.assign,eu;function _o(e){if(eu===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);eu=t&&t[1]||""}return"\n"+eu+e}var tu=!1;function nu(e,t){if(!e||tu)return"";tu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var a=u.stack.split("\n"),s=r.stack.split("\n"),o=a.length-1,l=s.length-1;1<=o&&0<=l&&a[o]!==s[l];)l--;for(;1<=o&&0<=l;o--,l--)if(a[o]!==s[l]){if(o!==1||l!==1)do if(o--,l--,0>l||a[o]!==s[l]){var c="\n"+a[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=l);break}}}finally{tu=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?_o(e):""}function P1(e){switch(e.tag){case 5:return _o(e.type);case 16:return _o("Lazy");case 13:return _o("Suspense");case 19:return _o("SuspenseList");case 0:case 2:case 15:return e=nu(e.type,!1),e;case 11:return e=nu(e.type.render,!1),e;case 1:return e=nu(e.type,!0),e;default:return""}}function ld(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case fs:return"Fragment";case hs:return"Portal";case sd:return"Profiler";case Th:return"StrictMode";case od:return"Suspense";case id:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Cv:return(e.displayName||"Context")+".Consumer";case kv:return(e._context.displayName||"Context")+".Provider";case Ph:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Fh:return t=e.displayName||null,t!==null?t:ld(e.type)||"Memo";case Gr:t=e._payload,e=e._init;try{return ld(e(t))}catch(n){}}return null}function F1(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ld(t);case 8:return t===Th?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ma(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ev(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function M1(e){var t=Ev(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Pi(e){e._valueTracker||(e._valueTracker=M1(e))}function Rv(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Ev(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Cl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch(t){return e.body}}function cd(e,t){var n=t.checked;return it({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:e._wrapperState.initialChecked})}function $p(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=ma(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Dv(e,t){t=t.checked,t!=null&&Ah(e,"checked",t,!1)}function ud(e,t){Dv(e,t);var n=ma(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?dd(e,t.type,n):t.hasOwnProperty("defaultValue")&&dd(e,t.type,ma(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function zp(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function dd(e,t,n){(t!=="number"||Cl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var jo=Array.isArray;function Ss(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ma(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function hd(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(oe(91));return it({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Up(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(oe(92));if(jo(n)){if(1<n.length)throw Error(oe(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:ma(n)}}function Iv(e,t){var n=ma(t.value),r=ma(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Vp(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Av(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fd(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Av(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Fi,Tv=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Fi=Fi||document.createElement("div"),Fi.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Fi.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function $o(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var So={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},O1=["Webkit","ms","Moz","O"];Object.keys(So).forEach(function(e){O1.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),So[t]=So[e]})});function Pv(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||So.hasOwnProperty(e)&&So[e]?(""+t).trim():t+"px"}function Fv(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=Pv(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var L1=it({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pd(e,t){if(t){if(L1[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(oe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(oe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(oe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(oe(62))}}function md(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gd=null;function Mh(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var vd=null,Es=null,Rs=null;function qp(e){if(e=bi(e)){if(typeof vd!="function")throw Error(oe(280));var t=e.stateNode;t&&(t=Cc(t),vd(e.stateNode,e.type,t))}}function Mv(e){Es?Rs?Rs.push(e):Rs=[e]:Es=e}function Ov(){if(Es){var e=Es,t=Rs;if(Rs=Es=null,qp(e),t)for(e=0;e<t.length;e++)qp(t[e])}}function Lv(e,t){return e(t)}function Bv(){}var ru=!1;function Wv(e,t,n){if(ru)return e(t,n);ru=!0;try{return Lv(e,t,n)}finally{ru=!1,(Es!==null||Rs!==null)&&(Bv(),Ov())}}function zo(e,t){var n=e.stateNode;if(n===null)return null;var r=Cc(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(oe(231,t,typeof n));return n}var xd=!1;if(Dr)try{var uo={};Object.defineProperty(uo,"passive",{get:function(){xd=!0}}),window.addEventListener("test",uo,uo),window.removeEventListener("test",uo,uo)}catch(e){xd=!1}function B1(e,t,n,r,a,s,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(d){this.onError(d)}}var Eo=!1,Sl=null,El=!1,yd=null,W1={onError:function(e){Eo=!0,Sl=e}};function $1(e,t,n,r,a,s,o,l,c){Eo=!1,Sl=null,B1.apply(W1,arguments)}function z1(e,t,n,r,a,s,o,l,c){if($1.apply(this,arguments),Eo){if(Eo){var u=Sl;Eo=!1,Sl=null}else throw Error(oe(198));El||(El=!0,yd=u)}}function Qa(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function $v(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Hp(e){if(Qa(e)!==e)throw Error(oe(188))}function U1(e){var t=e.alternate;if(!t){if(t=Qa(e),t===null)throw Error(oe(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var s=a.alternate;if(s===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===n)return Hp(a),e;if(s===r)return Hp(a),t;s=s.sibling}throw Error(oe(188))}if(n.return!==r.return)n=a,r=s;else{for(var o=!1,l=a.child;l;){if(l===n){o=!0,n=a,r=s;break}if(l===r){o=!0,r=a,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=a;break}if(l===r){o=!0,r=s,n=a;break}l=l.sibling}if(!o)throw Error(oe(189))}}if(n.alternate!==r)throw Error(oe(190))}if(n.tag!==3)throw Error(oe(188));return n.stateNode.current===n?e:t}function zv(e){return e=U1(e),e!==null?Uv(e):null}function Uv(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Uv(e);if(t!==null)return t;e=e.sibling}return null}var Vv=Sn.unstable_scheduleCallback,Gp=Sn.unstable_cancelCallback,V1=Sn.unstable_shouldYield,q1=Sn.unstable_requestPaint,ft=Sn.unstable_now,H1=Sn.unstable_getCurrentPriorityLevel,Oh=Sn.unstable_ImmediatePriority,qv=Sn.unstable_UserBlockingPriority,Rl=Sn.unstable_NormalPriority,G1=Sn.unstable_LowPriority,Hv=Sn.unstable_IdlePriority,Nc=null,dr=null;function K1(e){if(dr&&typeof dr.onCommitFiberRoot=="function")try{dr.onCommitFiberRoot(Nc,e,void 0,(e.current.flags&128)===128)}catch(t){}}var Xn=Math.clz32?Math.clz32:Q1,X1=Math.log,Y1=Math.LN2;function Q1(e){return e>>>=0,e===0?32:31-(X1(e)/Y1|0)|0}var Mi=64,Oi=4194304;function ko(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Dl(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,s=e.pingedLanes,o=n&268435455;if(o!==0){var l=o&~a;l!==0?r=ko(l):(s&=o,s!==0&&(r=ko(s)))}else o=n&~a,o!==0?r=ko(o):s!==0&&(r=ko(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,s=t&-t,a>=s||a===16&&(s&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Xn(t),a=1<<n,r|=e[n],t&=~a;return r}function J1(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Z1(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-Xn(s),l=1<<o,c=a[o];c===-1?(!(l&n)||l&r)&&(a[o]=J1(l,t)):c<=t&&(e.expiredLanes|=l),s&=~l}}function bd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Gv(){var e=Mi;return Mi<<=1,!(Mi&4194240)&&(Mi=64),e}function au(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function xi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Xn(t),e[t]=n}function ew(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-Xn(n),s=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~s}}function Lh(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Xn(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var He=0;function Kv(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Xv,Bh,Yv,Qv,Jv,wd=!1,Li=[],na=null,ra=null,aa=null,Uo=new Map,Vo=new Map,Xr=[],tw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Kp(e,t){switch(e){case"focusin":case"focusout":na=null;break;case"dragenter":case"dragleave":ra=null;break;case"mouseover":case"mouseout":aa=null;break;case"pointerover":case"pointerout":Uo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vo.delete(t.pointerId)}}function ho(e,t,n,r,a,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[a]},t!==null&&(t=bi(t),t!==null&&Bh(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function nw(e,t,n,r,a){switch(t){case"focusin":return na=ho(na,e,t,n,r,a),!0;case"dragenter":return ra=ho(ra,e,t,n,r,a),!0;case"mouseover":return aa=ho(aa,e,t,n,r,a),!0;case"pointerover":var s=a.pointerId;return Uo.set(s,ho(Uo.get(s)||null,e,t,n,r,a)),!0;case"gotpointercapture":return s=a.pointerId,Vo.set(s,ho(Vo.get(s)||null,e,t,n,r,a)),!0}return!1}function Zv(e){var t=Ta(e.target);if(t!==null){var n=Qa(t);if(n!==null){if(t=n.tag,t===13){if(t=$v(n),t!==null){e.blockedOn=t,Jv(e.priority,function(){Yv(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Nd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);gd=r,n.target.dispatchEvent(r),gd=null}else return t=bi(n),t!==null&&Bh(t),e.blockedOn=n,!1;t.shift()}return!0}function Xp(e,t,n){pl(e)&&n.delete(t)}function rw(){wd=!1,na!==null&&pl(na)&&(na=null),ra!==null&&pl(ra)&&(ra=null),aa!==null&&pl(aa)&&(aa=null),Uo.forEach(Xp),Vo.forEach(Xp)}function fo(e,t){e.blockedOn===t&&(e.blockedOn=null,wd||(wd=!0,Sn.unstable_scheduleCallback(Sn.unstable_NormalPriority,rw)))}function qo(e){function t(a){return fo(a,e)}if(0<Li.length){fo(Li[0],e);for(var n=1;n<Li.length;n++){var r=Li[n];r.blockedOn===e&&(r.blockedOn=null)}}for(na!==null&&fo(na,e),ra!==null&&fo(ra,e),aa!==null&&fo(aa,e),Uo.forEach(t),Vo.forEach(t),n=0;n<Xr.length;n++)r=Xr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Xr.length&&(n=Xr[0],n.blockedOn===null);)Zv(n),n.blockedOn===null&&Xr.shift()}var Ds=Pr.ReactCurrentBatchConfig,Il=!0;function aw(e,t,n,r){var a=He,s=Ds.transition;Ds.transition=null;try{He=1,Wh(e,t,n,r)}finally{He=a,Ds.transition=s}}function sw(e,t,n,r){var a=He,s=Ds.transition;Ds.transition=null;try{He=4,Wh(e,t,n,r)}finally{He=a,Ds.transition=s}}function Wh(e,t,n,r){if(Il){var a=Nd(e,t,n,r);if(a===null)pu(e,t,r,Al,n),Kp(e,r);else if(nw(a,e,t,n,r))r.stopPropagation();else if(Kp(e,r),t&4&&-1<tw.indexOf(e)){for(;a!==null;){var s=bi(a);if(s!==null&&Xv(s),s=Nd(e,t,n,r),s===null&&pu(e,t,r,Al,n),s===a)break;a=s}a!==null&&r.stopPropagation()}else pu(e,t,r,null,n)}}var Al=null;function Nd(e,t,n,r){if(Al=null,e=Mh(r),e=Ta(e),e!==null)if(t=Qa(e),t===null)e=null;else if(n=t.tag,n===13){if(e=$v(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Al=e,null}function ex(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(H1()){case Oh:return 1;case qv:return 4;case Rl:case G1:return 16;case Hv:return 536870912;default:return 16}default:return 16}}var Qr=null,$h=null,ml=null;function tx(){if(ml)return ml;var e,t=$h,n=t.length,r,a="value"in Qr?Qr.value:Qr.textContent,s=a.length;for(e=0;e<n&&t[e]===a[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===a[s-r];r++);return ml=a.slice(e,1<r?1-r:void 0)}function gl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Bi(){return!0}function Yp(){return!1}function Rn(e){function t(n,r,a,s,o){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(s):s[l]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Bi:Yp,this.isPropagationStopped=Yp,this}return it(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Bi)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Bi)},persist:function(){},isPersistent:Bi}),t}var eo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zh=Rn(eo),yi=it({},eo,{view:0,detail:0}),ow=Rn(yi),su,ou,po,_c=it({},yi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Uh,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==po&&(po&&e.type==="mousemove"?(su=e.screenX-po.screenX,ou=e.screenY-po.screenY):ou=su=0,po=e),su)},movementY:function(e){return"movementY"in e?e.movementY:ou}}),Qp=Rn(_c),iw=it({},_c,{dataTransfer:0}),lw=Rn(iw),cw=it({},yi,{relatedTarget:0}),iu=Rn(cw),uw=it({},eo,{animationName:0,elapsedTime:0,pseudoElement:0}),dw=Rn(uw),hw=it({},eo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),fw=Rn(hw),pw=it({},eo,{data:0}),Jp=Rn(pw),mw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xw(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=vw[e])?!!t[e]:!1}function Uh(){return xw}var yw=it({},yi,{key:function(e){if(e.key){var t=mw[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=gl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?gw[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Uh,charCode:function(e){return e.type==="keypress"?gl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?gl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),bw=Rn(yw),ww=it({},_c,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zp=Rn(ww),Nw=it({},yi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Uh}),_w=Rn(Nw),jw=it({},eo,{propertyName:0,elapsedTime:0,pseudoElement:0}),kw=Rn(jw),Cw=it({},_c,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Sw=Rn(Cw),Ew=[9,13,27,32],Vh=Dr&&"CompositionEvent"in window,Ro=null;Dr&&"documentMode"in document&&(Ro=document.documentMode);var Rw=Dr&&"TextEvent"in window&&!Ro,nx=Dr&&(!Vh||Ro&&8<Ro&&11>=Ro),em=String.fromCharCode(32),tm=!1;function rx(e,t){switch(e){case"keyup":return Ew.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ax(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ps=!1;function Dw(e,t){switch(e){case"compositionend":return ax(t);case"keypress":return t.which!==32?null:(tm=!0,em);case"textInput":return e=t.data,e===em&&tm?null:e;default:return null}}function Iw(e,t){if(ps)return e==="compositionend"||!Vh&&rx(e,t)?(e=tx(),ml=$h=Qr=null,ps=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return nx&&t.locale!=="ko"?null:t.data;default:return null}}var Aw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Aw[e.type]:t==="textarea"}function sx(e,t,n,r){Mv(r),t=Tl(t,"onChange"),0<t.length&&(n=new zh("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Do=null,Ho=null;function Tw(e){gx(e,0)}function jc(e){var t=vs(e);if(Rv(t))return e}function Pw(e,t){if(e==="change")return t}var ox=!1;if(Dr){var lu;if(Dr){var cu="oninput"in document;if(!cu){var rm=document.createElement("div");rm.setAttribute("oninput","return;"),cu=typeof rm.oninput=="function"}lu=cu}else lu=!1;ox=lu&&(!document.documentMode||9<document.documentMode)}function am(){Do&&(Do.detachEvent("onpropertychange",ix),Ho=Do=null)}function ix(e){if(e.propertyName==="value"&&jc(Ho)){var t=[];sx(t,Ho,e,Mh(e)),Wv(Tw,t)}}function Fw(e,t,n){e==="focusin"?(am(),Do=t,Ho=n,Do.attachEvent("onpropertychange",ix)):e==="focusout"&&am()}function Mw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return jc(Ho)}function Ow(e,t){if(e==="click")return jc(t)}function Lw(e,t){if(e==="input"||e==="change")return jc(t)}function Bw(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Jn=typeof Object.is=="function"?Object.is:Bw;function Go(e,t){if(Jn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!ad.call(t,a)||!Jn(e[a],t[a]))return!1}return!0}function sm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function om(e,t){var n=sm(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=sm(n)}}function lx(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?lx(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function cx(){for(var e=window,t=Cl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch(r){n=!1}if(n)e=t.contentWindow;else break;t=Cl(e.document)}return t}function qh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Ww(e){var t=cx(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&lx(n.ownerDocument.documentElement,n)){if(r!==null&&qh(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,s=Math.min(r.start,a);r=r.end===void 0?s:Math.min(r.end,a),!e.extend&&s>r&&(a=r,r=s,s=a),a=om(n,s);var o=om(n,r);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var $w=Dr&&"documentMode"in document&&11>=document.documentMode,ms=null,_d=null,Io=null,jd=!1;function im(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;jd||ms==null||ms!==Cl(r)||(r=ms,"selectionStart"in r&&qh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Io&&Go(Io,r)||(Io=r,r=Tl(_d,"onSelect"),0<r.length&&(t=new zh("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ms)))}function Wi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var gs={animationend:Wi("Animation","AnimationEnd"),animationiteration:Wi("Animation","AnimationIteration"),animationstart:Wi("Animation","AnimationStart"),transitionend:Wi("Transition","TransitionEnd")},uu={},ux={};Dr&&(ux=document.createElement("div").style,"AnimationEvent"in window||(delete gs.animationend.animation,delete gs.animationiteration.animation,delete gs.animationstart.animation),"TransitionEvent"in window||delete gs.transitionend.transition);function kc(e){if(uu[e])return uu[e];if(!gs[e])return e;var t=gs[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in ux)return uu[e]=t[n];return e}var dx=kc("animationend"),hx=kc("animationiteration"),fx=kc("animationstart"),px=kc("transitionend"),mx=new Map,lm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ya(e,t){mx.set(e,t),Ya(t,[e])}for(var du=0;du<lm.length;du++){var hu=lm[du],zw=hu.toLowerCase(),Uw=hu[0].toUpperCase()+hu.slice(1);ya(zw,"on"+Uw)}ya(dx,"onAnimationEnd");ya(hx,"onAnimationIteration");ya(fx,"onAnimationStart");ya("dblclick","onDoubleClick");ya("focusin","onFocus");ya("focusout","onBlur");ya(px,"onTransitionEnd");$s("onMouseEnter",["mouseout","mouseover"]);$s("onMouseLeave",["mouseout","mouseover"]);$s("onPointerEnter",["pointerout","pointerover"]);$s("onPointerLeave",["pointerout","pointerover"]);Ya("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ya("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ya("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ya("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ya("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ya("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Co="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vw=new Set("cancel close invalid load scroll toggle".split(" ").concat(Co));function cm(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,z1(r,t,void 0,e),e.currentTarget=null}function gx(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==s&&a.isPropagationStopped())break e;cm(a,l,u),s=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==s&&a.isPropagationStopped())break e;cm(a,l,u),s=c}}}if(El)throw e=yd,El=!1,yd=null,e}function Xe(e,t){var n=t[Rd];n===void 0&&(n=t[Rd]=new Set);var r=e+"__bubble";n.has(r)||(vx(t,e,2,!1),n.add(r))}function fu(e,t,n){var r=0;t&&(r|=4),vx(n,e,r,t)}var $i="_reactListening"+Math.random().toString(36).slice(2);function Ko(e){if(!e[$i]){e[$i]=!0,jv.forEach(function(n){n!=="selectionchange"&&(Vw.has(n)||fu(n,!1,e),fu(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[$i]||(t[$i]=!0,fu("selectionchange",!1,t))}}function vx(e,t,n,r){switch(ex(t)){case 1:var a=aw;break;case 4:a=sw;break;default:a=Wh}n=a.bind(null,t,n,e),a=void 0,!xd||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function pu(e,t,n,r,a){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;o=o.return}for(;l!==null;){if(o=Ta(l),o===null)return;if(c=o.tag,c===5||c===6){r=s=o;continue e}l=l.parentNode}}r=r.return}Wv(function(){var u=s,d=Mh(n),h=[];e:{var f=mx.get(e);if(f!==void 0){var p=zh,m=e;switch(e){case"keypress":if(gl(n)===0)break e;case"keydown":case"keyup":p=bw;break;case"focusin":m="focus",p=iu;break;case"focusout":m="blur",p=iu;break;case"beforeblur":case"afterblur":p=iu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Qp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=lw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=_w;break;case dx:case hx:case fx:p=dw;break;case px:p=kw;break;case"scroll":p=ow;break;case"wheel":p=Sw;break;case"copy":case"cut":case"paste":p=fw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Zp}var x=(t&4)!==0,y=!x&&e==="scroll",g=x?f!==null?f+"Capture":null:f;x=[];for(var v=u,w;v!==null;){w=v;var b=w.stateNode;if(w.tag===5&&b!==null&&(w=b,g!==null&&(b=zo(v,g),b!=null&&x.push(Xo(v,b,w)))),y)break;v=v.return}0<x.length&&(f=new p(f,m,null,n,d),h.push({event:f,listeners:x}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",f&&n!==gd&&(m=n.relatedTarget||n.fromElement)&&(Ta(m)||m[Ir]))break e;if((p||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?Ta(m):null,m!==null&&(y=Qa(m),m!==y||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(x=Qp,b="onMouseLeave",g="onMouseEnter",v="mouse",(e==="pointerout"||e==="pointerover")&&(x=Zp,b="onPointerLeave",g="onPointerEnter",v="pointer"),y=p==null?f:vs(p),w=m==null?f:vs(m),f=new x(b,v+"leave",p,n,d),f.target=y,f.relatedTarget=w,b=null,Ta(d)===u&&(x=new x(g,v+"enter",m,n,d),x.target=w,x.relatedTarget=y,b=x),y=b,p&&m)t:{for(x=p,g=m,v=0,w=x;w;w=rs(w))v++;for(w=0,b=g;b;b=rs(b))w++;for(;0<v-w;)x=rs(x),v--;for(;0<w-v;)g=rs(g),w--;for(;v--;){if(x===g||g!==null&&x===g.alternate)break t;x=rs(x),g=rs(g)}x=null}else x=null;p!==null&&um(h,f,p,x,!1),m!==null&&y!==null&&um(h,y,m,x,!0)}}e:{if(f=u?vs(u):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var N=Pw;else if(nm(f))if(ox)N=Lw;else{N=Mw;var _=Fw}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(N=Ow);if(N&&(N=N(e,u))){sx(h,N,n,d);break e}_&&_(e,f,u),e==="focusout"&&(_=f._wrapperState)&&_.controlled&&f.type==="number"&&dd(f,"number",f.value)}switch(_=u?vs(u):window,e){case"focusin":(nm(_)||_.contentEditable==="true")&&(ms=_,_d=u,Io=null);break;case"focusout":Io=_d=ms=null;break;case"mousedown":jd=!0;break;case"contextmenu":case"mouseup":case"dragend":jd=!1,im(h,n,d);break;case"selectionchange":if($w)break;case"keydown":case"keyup":im(h,n,d)}var k;if(Vh)e:{switch(e){case"compositionstart":var j="onCompositionStart";break e;case"compositionend":j="onCompositionEnd";break e;case"compositionupdate":j="onCompositionUpdate";break e}j=void 0}else ps?rx(e,n)&&(j="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(j="onCompositionStart");j&&(nx&&n.locale!=="ko"&&(ps||j!=="onCompositionStart"?j==="onCompositionEnd"&&ps&&(k=tx()):(Qr=d,$h="value"in Qr?Qr.value:Qr.textContent,ps=!0)),_=Tl(u,j),0<_.length&&(j=new Jp(j,e,null,n,d),h.push({event:j,listeners:_}),k?j.data=k:(k=ax(n),k!==null&&(j.data=k)))),(k=Rw?Dw(e,n):Iw(e,n))&&(u=Tl(u,"onBeforeInput"),0<u.length&&(d=new Jp("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:u}),d.data=k))}gx(h,t)})}function Xo(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Tl(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,s=a.stateNode;a.tag===5&&s!==null&&(a=s,s=zo(e,n),s!=null&&r.unshift(Xo(e,s,a)),s=zo(e,t),s!=null&&r.push(Xo(e,s,a))),e=e.return}return r}function rs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function um(e,t,n,r,a){for(var s=t._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,u=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&u!==null&&(l=u,a?(c=zo(n,s),c!=null&&o.unshift(Xo(n,c,l))):a||(c=zo(n,s),c!=null&&o.push(Xo(n,c,l)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var qw=/\r\n?/g,Hw=/\u0000|\uFFFD/g;function dm(e){return(typeof e=="string"?e:""+e).replace(qw,"\n").replace(Hw,"")}function zi(e,t,n){if(t=dm(t),dm(e)!==t&&n)throw Error(oe(425))}function Pl(){}var kd=null,Cd=null;function Sd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ed=typeof setTimeout=="function"?setTimeout:void 0,Gw=typeof clearTimeout=="function"?clearTimeout:void 0,hm=typeof Promise=="function"?Promise:void 0,Kw=typeof queueMicrotask=="function"?queueMicrotask:typeof hm<"u"?function(e){return hm.resolve(null).then(e).catch(Xw)}:Ed;function Xw(e){setTimeout(function(){throw e})}function mu(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),qo(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);qo(t)}function sa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function fm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var to=Math.random().toString(36).slice(2),ir="__reactFiber$"+to,Yo="__reactProps$"+to,Ir="__reactContainer$"+to,Rd="__reactEvents$"+to,Yw="__reactListeners$"+to,Qw="__reactHandles$"+to;function Ta(e){var t=e[ir];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ir]||n[ir]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=fm(e);e!==null;){if(n=e[ir])return n;e=fm(e)}return t}e=n,n=e.parentNode}return null}function bi(e){return e=e[ir]||e[Ir],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function vs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(oe(33))}function Cc(e){return e[Yo]||null}var Dd=[],xs=-1;function ba(e){return{current:e}}function Ze(e){0>xs||(e.current=Dd[xs],Dd[xs]=null,xs--)}function Ge(e,t){xs++,Dd[xs]=e.current,e.current=t}var ga={},Kt=ba(ga),cn=ba(!1),za=ga;function zs(e,t){var n=e.type.contextTypes;if(!n)return ga;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},s;for(s in n)a[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function un(e){return e=e.childContextTypes,e!=null}function Fl(){Ze(cn),Ze(Kt)}function pm(e,t,n){if(Kt.current!==ga)throw Error(oe(168));Ge(Kt,t),Ge(cn,n)}function xx(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(oe(108,F1(e)||"Unknown",a));return it({},n,r)}function Ml(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ga,za=Kt.current,Ge(Kt,e),Ge(cn,cn.current),!0}function mm(e,t,n){var r=e.stateNode;if(!r)throw Error(oe(169));n?(e=xx(e,t,za),r.__reactInternalMemoizedMergedChildContext=e,Ze(cn),Ze(Kt),Ge(Kt,e)):Ze(cn),Ge(cn,n)}var kr=null,Sc=!1,gu=!1;function yx(e){kr===null?kr=[e]:kr.push(e)}function Jw(e){Sc=!0,yx(e)}function wa(){if(!gu&&kr!==null){gu=!0;var e=0,t=He;try{var n=kr;for(He=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}kr=null,Sc=!1}catch(a){throw kr!==null&&(kr=kr.slice(e+1)),Vv(Oh,wa),a}finally{He=t,gu=!1}}return null}var ys=[],bs=0,Ol=null,Ll=0,In=[],An=0,Ua=null,Sr=1,Er="";function Ea(e,t){ys[bs++]=Ll,ys[bs++]=Ol,Ol=e,Ll=t}function bx(e,t,n){In[An++]=Sr,In[An++]=Er,In[An++]=Ua,Ua=e;var r=Sr;e=Er;var a=32-Xn(r)-1;r&=~(1<<a),n+=1;var s=32-Xn(t)+a;if(30<s){var o=a-a%5;s=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Sr=1<<32-Xn(t)+a|n<<a|r,Er=s+e}else Sr=1<<s|n<<a|r,Er=e}function Hh(e){e.return!==null&&(Ea(e,1),bx(e,1,0))}function Gh(e){for(;e===Ol;)Ol=ys[--bs],ys[bs]=null,Ll=ys[--bs],ys[bs]=null;for(;e===Ua;)Ua=In[--An],In[An]=null,Er=In[--An],In[An]=null,Sr=In[--An],In[An]=null}var jn=null,bn=null,tt=!1,qn=null;function wx(e,t){var n=Fn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function gm(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,jn=e,bn=sa(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,jn=e,bn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Ua!==null?{id:Sr,overflow:Er}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Fn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,jn=e,bn=null,!0):!1;default:return!1}}function Id(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Ad(e){if(tt){var t=bn;if(t){var n=t;if(!gm(e,t)){if(Id(e))throw Error(oe(418));t=sa(n.nextSibling);var r=jn;t&&gm(e,t)?wx(r,n):(e.flags=e.flags&-4097|2,tt=!1,jn=e)}}else{if(Id(e))throw Error(oe(418));e.flags=e.flags&-4097|2,tt=!1,jn=e}}}function vm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;jn=e}function Ui(e){if(e!==jn)return!1;if(!tt)return vm(e),tt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Sd(e.type,e.memoizedProps)),t&&(t=bn)){if(Id(e))throw Nx(),Error(oe(418));for(;t;)wx(e,t),t=sa(t.nextSibling)}if(vm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(oe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){bn=sa(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}bn=null}}else bn=jn?sa(e.stateNode.nextSibling):null;return!0}function Nx(){for(var e=bn;e;)e=sa(e.nextSibling)}function Us(){bn=jn=null,tt=!1}function Kh(e){qn===null?qn=[e]:qn.push(e)}var Zw=Pr.ReactCurrentBatchConfig;function mo(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(oe(309));var r=n.stateNode}if(!r)throw Error(oe(147,e));var a=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(o){var l=a.refs;o===null?delete l[s]:l[s]=o},t._stringRef=s,t)}if(typeof e!="string")throw Error(oe(284));if(!n._owner)throw Error(oe(290,e))}return e}function Vi(e,t){throw e=Object.prototype.toString.call(t),Error(oe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function xm(e){var t=e._init;return t(e._payload)}function _x(e){function t(g,v){if(e){var w=g.deletions;w===null?(g.deletions=[v],g.flags|=16):w.push(v)}}function n(g,v){if(!e)return null;for(;v!==null;)t(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function a(g,v){return g=ca(g,v),g.index=0,g.sibling=null,g}function s(g,v,w){return g.index=w,e?(w=g.alternate,w!==null?(w=w.index,w<v?(g.flags|=2,v):w):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return e&&g.alternate===null&&(g.flags|=2),g}function l(g,v,w,b){return v===null||v.tag!==6?(v=_u(w,g.mode,b),v.return=g,v):(v=a(v,w),v.return=g,v)}function c(g,v,w,b){var N=w.type;return N===fs?d(g,v,w.props.children,b,w.key):v!==null&&(v.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Gr&&xm(N)===v.type)?(b=a(v,w.props),b.ref=mo(g,v,w),b.return=g,b):(b=_l(w.type,w.key,w.props,null,g.mode,b),b.ref=mo(g,v,w),b.return=g,b)}function u(g,v,w,b){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=ju(w,g.mode,b),v.return=g,v):(v=a(v,w.children||[]),v.return=g,v)}function d(g,v,w,b,N){return v===null||v.tag!==7?(v=Wa(w,g.mode,b,N),v.return=g,v):(v=a(v,w),v.return=g,v)}function h(g,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=_u(""+v,g.mode,w),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ti:return w=_l(v.type,v.key,v.props,null,g.mode,w),w.ref=mo(g,null,v),w.return=g,w;case hs:return v=ju(v,g.mode,w),v.return=g,v;case Gr:var b=v._init;return h(g,b(v._payload),w)}if(jo(v)||co(v))return v=Wa(v,g.mode,w,null),v.return=g,v;Vi(g,v)}return null}function f(g,v,w,b){var N=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return N!==null?null:l(g,v,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Ti:return w.key===N?c(g,v,w,b):null;case hs:return w.key===N?u(g,v,w,b):null;case Gr:return N=w._init,f(g,v,N(w._payload),b)}if(jo(w)||co(w))return N!==null?null:d(g,v,w,b,null);Vi(g,w)}return null}function p(g,v,w,b,N){if(typeof b=="string"&&b!==""||typeof b=="number")return g=g.get(w)||null,l(v,g,""+b,N);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ti:return g=g.get(b.key===null?w:b.key)||null,c(v,g,b,N);case hs:return g=g.get(b.key===null?w:b.key)||null,u(v,g,b,N);case Gr:var _=b._init;return p(g,v,w,_(b._payload),N)}if(jo(b)||co(b))return g=g.get(w)||null,d(v,g,b,N,null);Vi(v,b)}return null}function m(g,v,w,b){for(var N=null,_=null,k=v,j=v=0,C=null;k!==null&&j<w.length;j++){k.index>j?(C=k,k=null):C=k.sibling;var S=f(g,k,w[j],b);if(S===null){k===null&&(k=C);break}e&&k&&S.alternate===null&&t(g,k),v=s(S,v,j),_===null?N=S:_.sibling=S,_=S,k=C}if(j===w.length)return n(g,k),tt&&Ea(g,j),N;if(k===null){for(;j<w.length;j++)k=h(g,w[j],b),k!==null&&(v=s(k,v,j),_===null?N=k:_.sibling=k,_=k);return tt&&Ea(g,j),N}for(k=r(g,k);j<w.length;j++)C=p(k,g,j,w[j],b),C!==null&&(e&&C.alternate!==null&&k.delete(C.key===null?j:C.key),v=s(C,v,j),_===null?N=C:_.sibling=C,_=C);return e&&k.forEach(function(M){return t(g,M)}),tt&&Ea(g,j),N}function x(g,v,w,b){var N=co(w);if(typeof N!="function")throw Error(oe(150));if(w=N.call(w),w==null)throw Error(oe(151));for(var _=N=null,k=v,j=v=0,C=null,S=w.next();k!==null&&!S.done;j++,S=w.next()){k.index>j?(C=k,k=null):C=k.sibling;var M=f(g,k,S.value,b);if(M===null){k===null&&(k=C);break}e&&k&&M.alternate===null&&t(g,k),v=s(M,v,j),_===null?N=M:_.sibling=M,_=M,k=C}if(S.done)return n(g,k),tt&&Ea(g,j),N;if(k===null){for(;!S.done;j++,S=w.next())S=h(g,S.value,b),S!==null&&(v=s(S,v,j),_===null?N=S:_.sibling=S,_=S);return tt&&Ea(g,j),N}for(k=r(g,k);!S.done;j++,S=w.next())S=p(k,g,j,S.value,b),S!==null&&(e&&S.alternate!==null&&k.delete(S.key===null?j:S.key),v=s(S,v,j),_===null?N=S:_.sibling=S,_=S);return e&&k.forEach(function(T){return t(g,T)}),tt&&Ea(g,j),N}function y(g,v,w,b){if(typeof w=="object"&&w!==null&&w.type===fs&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Ti:e:{for(var N=w.key,_=v;_!==null;){if(_.key===N){if(N=w.type,N===fs){if(_.tag===7){n(g,_.sibling),v=a(_,w.props.children),v.return=g,g=v;break e}}else if(_.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Gr&&xm(N)===_.type){n(g,_.sibling),v=a(_,w.props),v.ref=mo(g,_,w),v.return=g,g=v;break e}n(g,_);break}else t(g,_);_=_.sibling}w.type===fs?(v=Wa(w.props.children,g.mode,b,w.key),v.return=g,g=v):(b=_l(w.type,w.key,w.props,null,g.mode,b),b.ref=mo(g,v,w),b.return=g,g=b)}return o(g);case hs:e:{for(_=w.key;v!==null;){if(v.key===_)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(g,v.sibling),v=a(v,w.children||[]),v.return=g,g=v;break e}else{n(g,v);break}else t(g,v);v=v.sibling}v=ju(w,g.mode,b),v.return=g,g=v}return o(g);case Gr:return _=w._init,y(g,v,_(w._payload),b)}if(jo(w))return m(g,v,w,b);if(co(w))return x(g,v,w,b);Vi(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(g,v.sibling),v=a(v,w),v.return=g,g=v):(n(g,v),v=_u(w,g.mode,b),v.return=g,g=v),o(g)):n(g,v)}return y}var Vs=_x(!0),jx=_x(!1),Bl=ba(null),Wl=null,ws=null,Xh=null;function Yh(){Xh=ws=Wl=null}function Qh(e){var t=Bl.current;Ze(Bl),e._currentValue=t}function Td(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Is(e,t){Wl=e,Xh=ws=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(ln=!0),e.firstContext=null)}function Ln(e){var t=e._currentValue;if(Xh!==e)if(e={context:e,memoizedValue:t,next:null},ws===null){if(Wl===null)throw Error(oe(308));ws=e,Wl.dependencies={lanes:0,firstContext:e}}else ws=ws.next=e;return t}var Pa=null;function Jh(e){Pa===null?Pa=[e]:Pa.push(e)}function kx(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,Jh(t)):(n.next=a.next,a.next=n),t.interleaved=n,Ar(e,r)}function Ar(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Kr=!1;function Zh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Cx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Rr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function oa(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Ue&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Ar(e,n)}return a=r.interleaved,a===null?(t.next=t,Jh(r)):(t.next=a.next,a.next=t),r.interleaved=t,Ar(e,n)}function vl(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Lh(e,n)}}function ym(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?a=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?a=s=t:s=s.next=t}else a=s=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function $l(e,t,n,r){var a=e.updateQueue;Kr=!1;var s=a.firstBaseUpdate,o=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?s=u:o.next=u,o=c;var d=e.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==o&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(s!==null){var h=a.baseState;o=0,d=u=c=null,l=s;do{var f=l.lane,p=l.eventTime;if((r&f)===f){d!==null&&(d=d.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,x=l;switch(f=t,p=n,x.tag){case 1:if(m=x.payload,typeof m=="function"){h=m.call(p,h,f);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=x.payload,f=typeof m=="function"?m.call(p,h,f):m,f==null)break e;h=it({},h,f);break e;case 2:Kr=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,f=a.effects,f===null?a.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=p,c=h):d=d.next=p,o|=f;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;f=l,l=f.next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}while(1);if(d===null&&(c=h),a.baseState=c,a.firstBaseUpdate=u,a.lastBaseUpdate=d,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else s===null&&(a.shared.lanes=0);qa|=o,e.lanes=o,e.memoizedState=h}}function bm(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(oe(191,a));a.call(r)}}}var wi={},hr=ba(wi),Qo=ba(wi),Jo=ba(wi);function Fa(e){if(e===wi)throw Error(oe(174));return e}function ef(e,t){switch(Ge(Jo,t),Ge(Qo,e),Ge(hr,wi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fd(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=fd(t,e)}Ze(hr),Ge(hr,t)}function qs(){Ze(hr),Ze(Qo),Ze(Jo)}function Sx(e){Fa(Jo.current);var t=Fa(hr.current),n=fd(t,e.type);t!==n&&(Ge(Qo,e),Ge(hr,n))}function tf(e){Qo.current===e&&(Ze(hr),Ze(Qo))}var rt=ba(0);function zl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var vu=[];function nf(){for(var e=0;e<vu.length;e++)vu[e]._workInProgressVersionPrimary=null;vu.length=0}var xl=Pr.ReactCurrentDispatcher,xu=Pr.ReactCurrentBatchConfig,Va=0,ot=null,yt=null,Et=null,Ul=!1,Ao=!1,Zo=0,e2=0;function Bt(){throw Error(oe(321))}function rf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jn(e[n],t[n]))return!1;return!0}function af(e,t,n,r,a,s){if(Va=s,ot=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xl.current=e===null||e.memoizedState===null?a2:s2,e=n(r,a),Ao){s=0;do{if(Ao=!1,Zo=0,25<=s)throw Error(oe(301));s+=1,Et=yt=null,t.updateQueue=null,xl.current=o2,e=n(r,a)}while(Ao)}if(xl.current=Vl,t=yt!==null&&yt.next!==null,Va=0,Et=yt=ot=null,Ul=!1,t)throw Error(oe(300));return e}function sf(){var e=Zo!==0;return Zo=0,e}function ar(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Et===null?ot.memoizedState=Et=e:Et=Et.next=e,Et}function Bn(){if(yt===null){var e=ot.alternate;e=e!==null?e.memoizedState:null}else e=yt.next;var t=Et===null?ot.memoizedState:Et.next;if(t!==null)Et=t,yt=e;else{if(e===null)throw Error(oe(310));yt=e,e={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},Et===null?ot.memoizedState=Et=e:Et=Et.next=e}return Et}function ei(e,t){return typeof t=="function"?t(e):t}function yu(e){var t=Bn(),n=t.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=e;var r=yt,a=r.baseQueue,s=n.pending;if(s!==null){if(a!==null){var o=a.next;a.next=s.next,s.next=o}r.baseQueue=a=s,n.pending=null}if(a!==null){s=a.next,r=r.baseState;var l=o=null,c=null,u=s;do{var d=u.lane;if((Va&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,ot.lanes|=d,qa|=d}u=u.next}while(u!==null&&u!==s);c===null?o=r:c.next=l,Jn(r,t.memoizedState)||(ln=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do s=a.lane,ot.lanes|=s,qa|=s,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function bu(e){var t=Bn(),n=t.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,s=t.memoizedState;if(a!==null){n.pending=null;var o=a=a.next;do s=e(s,o.action),o=o.next;while(o!==a);Jn(s,t.memoizedState)||(ln=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Ex(){}function Rx(e,t){var n=ot,r=Bn(),a=t(),s=!Jn(r.memoizedState,a);if(s&&(r.memoizedState=a,ln=!0),r=r.queue,of(Ax.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||Et!==null&&Et.memoizedState.tag&1){if(n.flags|=2048,ti(9,Ix.bind(null,n,r,a,t),void 0,null),Rt===null)throw Error(oe(349));Va&30||Dx(n,t,a)}return a}function Dx(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=ot.updateQueue,t===null?(t={lastEffect:null,stores:null},ot.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Ix(e,t,n,r){t.value=n,t.getSnapshot=r,Tx(t)&&Px(e)}function Ax(e,t,n){return n(function(){Tx(t)&&Px(e)})}function Tx(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Jn(e,n)}catch(r){return!0}}function Px(e){var t=Ar(e,1);t!==null&&Yn(t,e,1,-1)}function wm(e){var t=ar();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:e},t.queue=e,e=e.dispatch=r2.bind(null,ot,e),[t.memoizedState,e]}function ti(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=ot.updateQueue,t===null?(t={lastEffect:null,stores:null},ot.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Fx(){return Bn().memoizedState}function yl(e,t,n,r){var a=ar();ot.flags|=e,a.memoizedState=ti(1|t,n,void 0,r===void 0?null:r)}function Ec(e,t,n,r){var a=Bn();r=r===void 0?null:r;var s=void 0;if(yt!==null){var o=yt.memoizedState;if(s=o.destroy,r!==null&&rf(r,o.deps)){a.memoizedState=ti(t,n,s,r);return}}ot.flags|=e,a.memoizedState=ti(1|t,n,s,r)}function Nm(e,t){return yl(8390656,8,e,t)}function of(e,t){return Ec(2048,8,e,t)}function Mx(e,t){return Ec(4,2,e,t)}function Ox(e,t){return Ec(4,4,e,t)}function Lx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Bx(e,t,n){return n=n!=null?n.concat([e]):null,Ec(4,4,Lx.bind(null,t,e),n)}function lf(){}function Wx(e,t){var n=Bn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&rf(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function $x(e,t){var n=Bn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&rf(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function zx(e,t,n){return Va&21?(Jn(n,t)||(n=Gv(),ot.lanes|=n,qa|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ln=!0),e.memoizedState=n)}function t2(e,t){var n=He;He=n!==0&&4>n?n:4,e(!0);var r=xu.transition;xu.transition={};try{e(!1),t()}finally{He=n,xu.transition=r}}function Ux(){return Bn().memoizedState}function n2(e,t,n){var r=la(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Vx(e))qx(t,n);else if(n=kx(e,t,n,r),n!==null){var a=Zt();Yn(n,e,r,a),Hx(n,t,r)}}function r2(e,t,n){var r=la(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Vx(e))qx(t,a);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var o=t.lastRenderedState,l=s(o,n);if(a.hasEagerState=!0,a.eagerState=l,Jn(l,o)){var c=t.interleaved;c===null?(a.next=a,Jh(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch(u){}finally{}n=kx(e,t,a,r),n!==null&&(a=Zt(),Yn(n,e,r,a),Hx(n,t,r))}}function Vx(e){var t=e.alternate;return e===ot||t!==null&&t===ot}function qx(e,t){Ao=Ul=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Hx(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Lh(e,n)}}var Vl={readContext:Ln,useCallback:Bt,useContext:Bt,useEffect:Bt,useImperativeHandle:Bt,useInsertionEffect:Bt,useLayoutEffect:Bt,useMemo:Bt,useReducer:Bt,useRef:Bt,useState:Bt,useDebugValue:Bt,useDeferredValue:Bt,useTransition:Bt,useMutableSource:Bt,useSyncExternalStore:Bt,useId:Bt,unstable_isNewReconciler:!1},a2={readContext:Ln,useCallback:function(e,t){return ar().memoizedState=[e,t===void 0?null:t],e},useContext:Ln,useEffect:Nm,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,yl(4194308,4,Lx.bind(null,t,e),n)},useLayoutEffect:function(e,t){return yl(4194308,4,e,t)},useInsertionEffect:function(e,t){return yl(4,2,e,t)},useMemo:function(e,t){var n=ar();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ar();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=n2.bind(null,ot,e),[r.memoizedState,e]},useRef:function(e){var t=ar();return e={current:e},t.memoizedState=e},useState:wm,useDebugValue:lf,useDeferredValue:function(e){return ar().memoizedState=e},useTransition:function(){var e=wm(!1),t=e[0];return e=t2.bind(null,e[1]),ar().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ot,a=ar();if(tt){if(n===void 0)throw Error(oe(407));n=n()}else{if(n=t(),Rt===null)throw Error(oe(349));Va&30||Dx(r,t,n)}a.memoizedState=n;var s={value:n,getSnapshot:t};return a.queue=s,Nm(Ax.bind(null,r,s,e),[e]),r.flags|=2048,ti(9,Ix.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=ar(),t=Rt.identifierPrefix;if(tt){var n=Er,r=Sr;n=(r&~(1<<32-Xn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=Zo++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=e2++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},s2={readContext:Ln,useCallback:Wx,useContext:Ln,useEffect:of,useImperativeHandle:Bx,useInsertionEffect:Mx,useLayoutEffect:Ox,useMemo:$x,useReducer:yu,useRef:Fx,useState:function(){return yu(ei)},useDebugValue:lf,useDeferredValue:function(e){var t=Bn();return zx(t,yt.memoizedState,e)},useTransition:function(){var e=yu(ei)[0],t=Bn().memoizedState;return[e,t]},useMutableSource:Ex,useSyncExternalStore:Rx,useId:Ux,unstable_isNewReconciler:!1},o2={readContext:Ln,useCallback:Wx,useContext:Ln,useEffect:of,useImperativeHandle:Bx,useInsertionEffect:Mx,useLayoutEffect:Ox,useMemo:$x,useReducer:bu,useRef:Fx,useState:function(){return bu(ei)},useDebugValue:lf,useDeferredValue:function(e){var t=Bn();return yt===null?t.memoizedState=e:zx(t,yt.memoizedState,e)},useTransition:function(){var e=bu(ei)[0],t=Bn().memoizedState;return[e,t]},useMutableSource:Ex,useSyncExternalStore:Rx,useId:Ux,unstable_isNewReconciler:!1};function zn(e,t){if(e&&e.defaultProps){t=it({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Pd(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:it({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Rc={isMounted:function(e){return(e=e._reactInternals)?Qa(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Zt(),a=la(e),s=Rr(r,a);s.payload=t,n!=null&&(s.callback=n),t=oa(e,s,a),t!==null&&(Yn(t,e,a,r),vl(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Zt(),a=la(e),s=Rr(r,a);s.tag=1,s.payload=t,n!=null&&(s.callback=n),t=oa(e,s,a),t!==null&&(Yn(t,e,a,r),vl(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zt(),r=la(e),a=Rr(n,r);a.tag=2,t!=null&&(a.callback=t),t=oa(e,a,r),t!==null&&(Yn(t,e,r,n),vl(t,e,r))}};function _m(e,t,n,r,a,s,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,o):t.prototype&&t.prototype.isPureReactComponent?!Go(n,r)||!Go(a,s):!0}function Gx(e,t,n){var r=!1,a=ga,s=t.contextType;return typeof s=="object"&&s!==null?s=Ln(s):(a=un(t)?za:Kt.current,r=t.contextTypes,s=(r=r!=null)?zs(e,a):ga),t=new t(n,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Rc,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=s),t}function jm(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Rc.enqueueReplaceState(t,t.state,null)}function Fd(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},Zh(e);var s=t.contextType;typeof s=="object"&&s!==null?a.context=Ln(s):(s=un(t)?za:Kt.current,a.context=zs(e,s)),a.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(Pd(e,t,s,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Rc.enqueueReplaceState(a,a.state,null),$l(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Hs(e,t){try{var n="",r=t;do n+=P1(r),r=r.return;while(r);var a=n}catch(s){a="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:a,digest:null}}function wu(e,t,n){return{value:e,source:null,stack:n!=null?n:null,digest:t!=null?t:null}}function Md(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var i2=typeof WeakMap=="function"?WeakMap:Map;function Kx(e,t,n){n=Rr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hl||(Hl=!0,Hd=r),Md(e,t)},n}function Xx(e,t,n){n=Rr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){Md(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Md(e,t),typeof r!="function"&&(ia===null?ia=new Set([this]):ia.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function km(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new i2;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=w2.bind(null,e,t,n),t.then(e,e))}function Cm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Sm(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Rr(-1,1),t.tag=2,oa(n,t,1))),n.lanes|=1),e)}var l2=Pr.ReactCurrentOwner,ln=!1;function Yt(e,t,n,r){t.child=e===null?jx(t,null,n,r):Vs(t,e.child,n,r)}function Em(e,t,n,r,a){n=n.render;var s=t.ref;return Is(t,a),r=af(e,t,n,r,s,a),n=sf(),e!==null&&!ln?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Tr(e,t,a)):(tt&&n&&Hh(t),t.flags|=1,Yt(e,t,r,a),t.child)}function Rm(e,t,n,r,a){if(e===null){var s=n.type;return typeof s=="function"&&!gf(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=s,Yx(e,t,s,r,a)):(e=_l(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&a)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Go,n(o,r)&&e.ref===t.ref)return Tr(e,t,a)}return t.flags|=1,e=ca(s,r),e.ref=t.ref,e.return=t,t.child=e}function Yx(e,t,n,r,a){if(e!==null){var s=e.memoizedProps;if(Go(s,r)&&e.ref===t.ref)if(ln=!1,t.pendingProps=r=s,(e.lanes&a)!==0)e.flags&131072&&(ln=!0);else return t.lanes=e.lanes,Tr(e,t,a)}return Od(e,t,n,r,a)}function Qx(e,t,n){var r=t.pendingProps,a=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ge(_s,gn),gn|=n;else{if(!(n&1073741824))return e=s!==null?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ge(_s,gn),gn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,Ge(_s,gn),gn|=r}else s!==null?(r=s.baseLanes|n,t.memoizedState=null):r=n,Ge(_s,gn),gn|=r;return Yt(e,t,a,n),t.child}function Jx(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Od(e,t,n,r,a){var s=un(n)?za:Kt.current;return s=zs(t,s),Is(t,a),n=af(e,t,n,r,s,a),r=sf(),e!==null&&!ln?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Tr(e,t,a)):(tt&&r&&Hh(t),t.flags|=1,Yt(e,t,n,a),t.child)}function Dm(e,t,n,r,a){if(un(n)){var s=!0;Ml(t)}else s=!1;if(Is(t,a),t.stateNode===null)bl(e,t),Gx(t,n,r),Fd(t,n,r,a),r=!0;else if(e===null){var o=t.stateNode,l=t.memoizedProps;o.props=l;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Ln(u):(u=un(n)?za:Kt.current,u=zs(t,u));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==u)&&jm(t,o,r,u),Kr=!1;var f=t.memoizedState;o.state=f,$l(t,r,o,a),c=t.memoizedState,l!==r||f!==c||cn.current||Kr?(typeof d=="function"&&(Pd(t,n,d,r),c=t.memoizedState),(l=Kr||_m(t,n,l,r,f,c,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=u,r=l):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Cx(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:zn(t.type,l),o.props=u,h=t.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Ln(c):(c=un(n)?za:Kt.current,c=zs(t,c));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==c)&&jm(t,o,r,c),Kr=!1,f=t.memoizedState,o.state=f,$l(t,r,o,a);var m=t.memoizedState;l!==h||f!==m||cn.current||Kr?(typeof p=="function"&&(Pd(t,n,p,r),m=t.memoizedState),(u=Kr||_m(t,n,u,r,f,m,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=m),o.props=r,o.state=m,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return Ld(e,t,n,r,s,a)}function Ld(e,t,n,r,a,s){Jx(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return a&&mm(t,n,!1),Tr(e,t,s);r=t.stateNode,l2.current=t;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=Vs(t,e.child,null,s),t.child=Vs(t,null,l,s)):Yt(e,t,l,s),t.memoizedState=r.state,a&&mm(t,n,!0),t.child}function Zx(e){var t=e.stateNode;t.pendingContext?pm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&pm(e,t.context,!1),ef(e,t.containerInfo)}function Im(e,t,n,r,a){return Us(),Kh(a),t.flags|=256,Yt(e,t,n,r),t.child}var Bd={dehydrated:null,treeContext:null,retryLane:0};function Wd(e){return{baseLanes:e,cachePool:null,transitions:null}}function e0(e,t,n){var r=t.pendingProps,a=rt.current,s=!1,o=(t.flags&128)!==0,l;if((l=o)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Ge(rt,a&1),e===null)return Ad(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,s?(r=t.mode,s=t.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Ac(o,r,0,null),e=Wa(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Wd(n),t.memoizedState=Bd,e):cf(t,o));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return c2(e,t,o,r,l,a,n);if(s){s=r.fallback,o=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=ca(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?s=ca(l,s):(s=Wa(s,o,n,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,o=e.child.memoizedState,o=o===null?Wd(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=e.childLanes&~n,t.memoizedState=Bd,r}return s=e.child,e=s.sibling,r=ca(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function cf(e,t){return t=Ac({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function qi(e,t,n,r){return r!==null&&Kh(r),Vs(t,e.child,null,n),e=cf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function c2(e,t,n,r,a,s,o){if(n)return t.flags&256?(t.flags&=-257,r=wu(Error(oe(422))),qi(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,a=t.mode,r=Ac({mode:"visible",children:r.children},a,0,null),s=Wa(s,a,o,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&Vs(t,e.child,null,o),t.child.memoizedState=Wd(o),t.memoizedState=Bd,s);if(!(t.mode&1))return qi(e,t,o,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,s=Error(oe(419)),r=wu(s,r,void 0),qi(e,t,o,r)}if(l=(o&e.childLanes)!==0,ln||l){if(r=Rt,r!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|o)?0:a,a!==0&&a!==s.retryLane&&(s.retryLane=a,Ar(e,a),Yn(r,e,a,-1))}return mf(),r=wu(Error(oe(421))),qi(e,t,o,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=N2.bind(null,e),a._reactRetry=t,null):(e=s.treeContext,bn=sa(a.nextSibling),jn=t,tt=!0,qn=null,e!==null&&(In[An++]=Sr,In[An++]=Er,In[An++]=Ua,Sr=e.id,Er=e.overflow,Ua=t),t=cf(t,r.children),t.flags|=4096,t)}function Am(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Td(e.return,t,n)}function Nu(e,t,n,r,a){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=a)}function t0(e,t,n){var r=t.pendingProps,a=r.revealOrder,s=r.tail;if(Yt(e,t,r.children,n),r=rt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Am(e,n,t);else if(e.tag===19)Am(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ge(rt,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&zl(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Nu(t,!1,a,n,s);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&zl(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Nu(t,!0,n,null,s);break;case"together":Nu(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function bl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Tr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),qa|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(oe(153));if(t.child!==null){for(e=t.child,n=ca(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ca(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function u2(e,t,n){switch(t.tag){case 3:Zx(t),Us();break;case 5:Sx(t);break;case 1:un(t.type)&&Ml(t);break;case 4:ef(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ge(Bl,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Ge(rt,rt.current&1),t.flags|=128,null):n&t.child.childLanes?e0(e,t,n):(Ge(rt,rt.current&1),e=Tr(e,t,n),e!==null?e.sibling:null);Ge(rt,rt.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return t0(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ge(rt,rt.current),r)break;return null;case 22:case 23:return t.lanes=0,Qx(e,t,n)}return Tr(e,t,n)}var n0,$d,r0,a0;n0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};$d=function(){};r0=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Fa(hr.current);var s=null;switch(n){case"input":a=cd(e,a),r=cd(e,r),s=[];break;case"select":a=it({},a,{value:void 0}),r=it({},r,{value:void 0}),s=[];break;case"textarea":a=hd(e,a),r=hd(e,r),s=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Pl)}pd(n,r);var o;n=null;for(u in a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var l=a[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Wo.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=a!=null?a[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(s=s||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Wo.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Xe("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}};a0=function(e,t,n,r){n!==r&&(t.flags|=4)};function go(e,t){if(!tt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Wt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function d2(e,t,n){var r=t.pendingProps;switch(Gh(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(t),null;case 1:return un(t.type)&&Fl(),Wt(t),null;case 3:return r=t.stateNode,qs(),Ze(cn),Ze(Kt),nf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Ui(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,qn!==null&&(Xd(qn),qn=null))),$d(e,t),Wt(t),null;case 5:tf(t);var a=Fa(Jo.current);if(n=t.type,e!==null&&t.stateNode!=null)r0(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(oe(166));return Wt(t),null}if(e=Fa(hr.current),Ui(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[ir]=t,r[Yo]=s,e=(t.mode&1)!==0,n){case"dialog":Xe("cancel",r),Xe("close",r);break;case"iframe":case"object":case"embed":Xe("load",r);break;case"video":case"audio":for(a=0;a<Co.length;a++)Xe(Co[a],r);break;case"source":Xe("error",r);break;case"img":case"image":case"link":Xe("error",r),Xe("load",r);break;case"details":Xe("toggle",r);break;case"input":$p(r,s),Xe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Xe("invalid",r);break;case"textarea":Up(r,s),Xe("invalid",r)}pd(n,s),a=null;for(var o in s)if(s.hasOwnProperty(o)){var l=s[o];o==="children"?typeof l=="string"?r.textContent!==l&&(s.suppressHydrationWarning!==!0&&zi(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(s.suppressHydrationWarning!==!0&&zi(r.textContent,l,e),a=["children",""+l]):Wo.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Xe("scroll",r)}switch(n){case"input":Pi(r),zp(r,s,!0);break;case"textarea":Pi(r),Vp(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Pl)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Av(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[ir]=t,e[Yo]=r,n0(e,t,!1,!1),t.stateNode=e;e:{switch(o=md(n,r),n){case"dialog":Xe("cancel",e),Xe("close",e),a=r;break;case"iframe":case"object":case"embed":Xe("load",e),a=r;break;case"video":case"audio":for(a=0;a<Co.length;a++)Xe(Co[a],e);a=r;break;case"source":Xe("error",e),a=r;break;case"img":case"image":case"link":Xe("error",e),Xe("load",e),a=r;break;case"details":Xe("toggle",e),a=r;break;case"input":$p(e,r),a=cd(e,r),Xe("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=it({},r,{value:void 0}),Xe("invalid",e);break;case"textarea":Up(e,r),a=hd(e,r),Xe("invalid",e);break;default:a=r}pd(n,a),l=a;for(s in l)if(l.hasOwnProperty(s)){var c=l[s];s==="style"?Fv(e,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Tv(e,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&$o(e,c):typeof c=="number"&&$o(e,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Wo.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Xe("scroll",e):c!=null&&Ah(e,s,c,o))}switch(n){case"input":Pi(e),zp(e,r,!1);break;case"textarea":Pi(e),Vp(e);break;case"option":r.value!=null&&e.setAttribute("value",""+ma(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?Ss(e,!!r.multiple,s,!1):r.defaultValue!=null&&Ss(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Pl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Wt(t),null;case 6:if(e&&t.stateNode!=null)a0(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(oe(166));if(n=Fa(Jo.current),Fa(hr.current),Ui(t)){if(r=t.stateNode,n=t.memoizedProps,r[ir]=t,(s=r.nodeValue!==n)&&(e=jn,e!==null))switch(e.tag){case 3:zi(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&zi(r.nodeValue,n,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ir]=t,t.stateNode=r}return Wt(t),null;case 13:if(Ze(rt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(tt&&bn!==null&&t.mode&1&&!(t.flags&128))Nx(),Us(),t.flags|=98560,s=!1;else if(s=Ui(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(oe(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(oe(317));s[ir]=t}else Us(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Wt(t),s=!1}else qn!==null&&(Xd(qn),qn=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||rt.current&1?bt===0&&(bt=3):mf())),t.updateQueue!==null&&(t.flags|=4),Wt(t),null);case 4:return qs(),$d(e,t),e===null&&Ko(t.stateNode.containerInfo),Wt(t),null;case 10:return Qh(t.type._context),Wt(t),null;case 17:return un(t.type)&&Fl(),Wt(t),null;case 19:if(Ze(rt),s=t.memoizedState,s===null)return Wt(t),null;if(r=(t.flags&128)!==0,o=s.rendering,o===null)if(r)go(s,!1);else{if(bt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=zl(e),o!==null){for(t.flags|=128,go(s,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)s=n,e=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,e=o.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ge(rt,rt.current&1|2),t.child}e=e.sibling}s.tail!==null&&ft()>Gs&&(t.flags|=128,r=!0,go(s,!1),t.lanes=4194304)}else{if(!r)if(e=zl(o),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),go(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!tt)return Wt(t),null}else 2*ft()-s.renderingStartTime>Gs&&n!==1073741824&&(t.flags|=128,r=!0,go(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(n=s.last,n!==null?n.sibling=o:t.child=o,s.last=o)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=ft(),t.sibling=null,n=rt.current,Ge(rt,r?n&1|2:n&1),t):(Wt(t),null);case 22:case 23:return pf(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?gn&1073741824&&(Wt(t),t.subtreeFlags&6&&(t.flags|=8192)):Wt(t),null;case 24:return null;case 25:return null}throw Error(oe(156,t.tag))}function h2(e,t){switch(Gh(t),t.tag){case 1:return un(t.type)&&Fl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return qs(),Ze(cn),Ze(Kt),nf(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return tf(t),null;case 13:if(Ze(rt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(oe(340));Us()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ze(rt),null;case 4:return qs(),null;case 10:return Qh(t.type._context),null;case 22:case 23:return pf(),null;case 24:return null;default:return null}}var Hi=!1,Ut=!1,f2=typeof WeakSet=="function"?WeakSet:Set,ge=null;function Ns(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ut(e,t,r)}else n.current=null}function zd(e,t,n){try{n()}catch(r){ut(e,t,r)}}var Tm=!1;function p2(e,t){if(kd=Il,e=cx(),qh(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(b){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||a!==0&&h.nodeType!==3||(l=o+a),h!==s||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===a&&(l=o),f===s&&++d===r&&(c=o),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Cd={focusedElem:e,selectionRange:n},Il=!1,ge=t;ge!==null;)if(t=ge,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ge=e;else for(;ge!==null;){t=ge;try{var m=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var x=m.memoizedProps,y=m.memoizedState,g=t.stateNode,v=g.getSnapshotBeforeUpdate(t.elementType===t.type?x:zn(t.type,x),y);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=t.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(b){ut(t,t.return,b)}if(e=t.sibling,e!==null){e.return=t.return,ge=e;break}ge=t.return}return m=Tm,Tm=!1,m}function To(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var s=a.destroy;a.destroy=void 0,s!==void 0&&zd(t,n,s)}a=a.next}while(a!==r)}}function Dc(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Ud(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function s0(e){var t=e.alternate;t!==null&&(e.alternate=null,s0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ir],delete t[Yo],delete t[Rd],delete t[Yw],delete t[Qw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function o0(e){return e.tag===5||e.tag===3||e.tag===4}function Pm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||o0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Pl));else if(r!==4&&(e=e.child,e!==null))for(Vd(e,t,n),e=e.sibling;e!==null;)Vd(e,t,n),e=e.sibling}function qd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(qd(e,t,n),e=e.sibling;e!==null;)qd(e,t,n),e=e.sibling}var Tt=null,Un=!1;function Vr(e,t,n){for(n=n.child;n!==null;)i0(e,t,n),n=n.sibling}function i0(e,t,n){if(dr&&typeof dr.onCommitFiberUnmount=="function")try{dr.onCommitFiberUnmount(Nc,n)}catch(l){}switch(n.tag){case 5:Ut||Ns(n,t);case 6:var r=Tt,a=Un;Tt=null,Vr(e,t,n),Tt=r,Un=a,Tt!==null&&(Un?(e=Tt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Tt.removeChild(n.stateNode));break;case 18:Tt!==null&&(Un?(e=Tt,n=n.stateNode,e.nodeType===8?mu(e.parentNode,n):e.nodeType===1&&mu(e,n),qo(e)):mu(Tt,n.stateNode));break;case 4:r=Tt,a=Un,Tt=n.stateNode.containerInfo,Un=!0,Vr(e,t,n),Tt=r,Un=a;break;case 0:case 11:case 14:case 15:if(!Ut&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var s=a,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&zd(n,t,o),a=a.next}while(a!==r)}Vr(e,t,n);break;case 1:if(!Ut&&(Ns(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){ut(n,t,l)}Vr(e,t,n);break;case 21:Vr(e,t,n);break;case 22:n.mode&1?(Ut=(r=Ut)||n.memoizedState!==null,Vr(e,t,n),Ut=r):Vr(e,t,n);break;default:Vr(e,t,n)}}function Fm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new f2),t.forEach(function(r){var a=_2.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function $n(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var s=e,o=t,l=o;e:for(;l!==null;){switch(l.tag){case 5:Tt=l.stateNode,Un=!1;break e;case 3:Tt=l.stateNode.containerInfo,Un=!0;break e;case 4:Tt=l.stateNode.containerInfo,Un=!0;break e}l=l.return}if(Tt===null)throw Error(oe(160));i0(s,o,a),Tt=null,Un=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(u){ut(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)l0(t,e),t=t.sibling}function l0(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if($n(t,e),nr(e),r&4){try{To(3,e,e.return),Dc(3,e)}catch(x){ut(e,e.return,x)}try{To(5,e,e.return)}catch(x){ut(e,e.return,x)}}break;case 1:$n(t,e),nr(e),r&512&&n!==null&&Ns(n,n.return);break;case 5:if($n(t,e),nr(e),r&512&&n!==null&&Ns(n,n.return),e.flags&32){var a=e.stateNode;try{$o(a,"")}catch(x){ut(e,e.return,x)}}if(r&4&&(a=e.stateNode,a!=null)){var s=e.memoizedProps,o=n!==null?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&s.type==="radio"&&s.name!=null&&Dv(a,s),md(l,o);var u=md(l,s);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?Fv(a,h):d==="dangerouslySetInnerHTML"?Tv(a,h):d==="children"?$o(a,h):Ah(a,d,h,u)}switch(l){case"input":ud(a,s);break;case"textarea":Iv(a,s);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Ss(a,!!s.multiple,p,!1):f!==!!s.multiple&&(s.defaultValue!=null?Ss(a,!!s.multiple,s.defaultValue,!0):Ss(a,!!s.multiple,s.multiple?[]:"",!1))}a[Yo]=s}catch(x){ut(e,e.return,x)}}break;case 6:if($n(t,e),nr(e),r&4){if(e.stateNode===null)throw Error(oe(162));a=e.stateNode,s=e.memoizedProps;try{a.nodeValue=s}catch(x){ut(e,e.return,x)}}break;case 3:if($n(t,e),nr(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{qo(t.containerInfo)}catch(x){ut(e,e.return,x)}break;case 4:$n(t,e),nr(e);break;case 13:$n(t,e),nr(e),a=e.child,a.flags&8192&&(s=a.memoizedState!==null,a.stateNode.isHidden=s,!s||a.alternate!==null&&a.alternate.memoizedState!==null||(hf=ft())),r&4&&Fm(e);break;case 22:if(d=n!==null&&n.memoizedState!==null,e.mode&1?(Ut=(u=Ut)||d,$n(t,e),Ut=u):$n(t,e),nr(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(ge=e,d=e.child;d!==null;){for(h=ge=d;ge!==null;){switch(f=ge,p=f.child,f.tag){case 0:case 11:case 14:case 15:To(4,f,f.return);break;case 1:Ns(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(x){ut(r,n,x)}}break;case 5:Ns(f,f.return);break;case 22:if(f.memoizedState!==null){Om(h);continue}}p!==null?(p.return=f,ge=p):Om(h)}d=d.sibling}e:for(d=null,h=e;;){if(h.tag===5){if(d===null){d=h;try{a=h.stateNode,u?(s=a.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Pv("display",o))}catch(x){ut(e,e.return,x)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(x){ut(e,e.return,x)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:$n(t,e),nr(e),r&4&&Fm(e);break;case 21:break;default:$n(t,e),nr(e)}}function nr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(o0(n)){var r=n;break e}n=n.return}throw Error(oe(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&($o(a,""),r.flags&=-33);var s=Pm(e);qd(e,s,a);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Pm(e);Vd(e,l,o);break;default:throw Error(oe(161))}}catch(c){ut(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function m2(e,t,n){ge=e,c0(e)}function c0(e,t,n){for(var r=(e.mode&1)!==0;ge!==null;){var a=ge,s=a.child;if(a.tag===22&&r){var o=a.memoizedState!==null||Hi;if(!o){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Ut;l=Hi;var u=Ut;if(Hi=o,(Ut=c)&&!u)for(ge=a;ge!==null;)o=ge,c=o.child,o.tag===22&&o.memoizedState!==null?Lm(a):c!==null?(c.return=o,ge=c):Lm(a);for(;s!==null;)ge=s,c0(s),s=s.sibling;ge=a,Hi=l,Ut=u}Mm(e)}else a.subtreeFlags&8772&&s!==null?(s.return=a,ge=s):Mm(e)}}function Mm(e){for(;ge!==null;){var t=ge;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ut||Dc(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Ut)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:zn(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&bm(t,s,r);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}bm(t,o,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&qo(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}Ut||t.flags&512&&Ud(t)}catch(f){ut(t,t.return,f)}}if(t===e){ge=null;break}if(n=t.sibling,n!==null){n.return=t.return,ge=n;break}ge=t.return}}function Om(e){for(;ge!==null;){var t=ge;if(t===e){ge=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ge=n;break}ge=t.return}}function Lm(e){for(;ge!==null;){var t=ge;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Dc(4,t)}catch(c){ut(t,n,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){ut(t,a,c)}}var s=t.return;try{Ud(t)}catch(c){ut(t,s,c)}break;case 5:var o=t.return;try{Ud(t)}catch(c){ut(t,o,c)}}}catch(c){ut(t,t.return,c)}if(t===e){ge=null;break}var l=t.sibling;if(l!==null){l.return=t.return,ge=l;break}ge=t.return}}var g2=Math.ceil,ql=Pr.ReactCurrentDispatcher,uf=Pr.ReactCurrentOwner,On=Pr.ReactCurrentBatchConfig,Ue=0,Rt=null,gt=null,Ot=0,gn=0,_s=ba(0),bt=0,ni=null,qa=0,Ic=0,df=0,Po=null,an=null,hf=0,Gs=1/0,jr=null,Hl=!1,Hd=null,ia=null,Gi=!1,Jr=null,Gl=0,Fo=0,Gd=null,wl=-1,Nl=0;function Zt(){return Ue&6?ft():wl!==-1?wl:wl=ft()}function la(e){return e.mode&1?Ue&2&&Ot!==0?Ot&-Ot:Zw.transition!==null?(Nl===0&&(Nl=Gv()),Nl):(e=He,e!==0||(e=window.event,e=e===void 0?16:ex(e.type)),e):1}function Yn(e,t,n,r){if(50<Fo)throw Fo=0,Gd=null,Error(oe(185));xi(e,n,r),(!(Ue&2)||e!==Rt)&&(e===Rt&&(!(Ue&2)&&(Ic|=n),bt===4&&Yr(e,Ot)),dn(e,r),n===1&&Ue===0&&!(t.mode&1)&&(Gs=ft()+500,Sc&&wa()))}function dn(e,t){var n=e.callbackNode;Z1(e,t);var r=Dl(e,e===Rt?Ot:0);if(r===0)n!==null&&Gp(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Gp(n),t===1)e.tag===0?Jw(Bm.bind(null,e)):yx(Bm.bind(null,e)),Kw(function(){!(Ue&6)&&wa()}),n=null;else{switch(Kv(r)){case 1:n=Oh;break;case 4:n=qv;break;case 16:n=Rl;break;case 536870912:n=Hv;break;default:n=Rl}n=v0(n,u0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function u0(e,t){if(wl=-1,Nl=0,Ue&6)throw Error(oe(327));var n=e.callbackNode;if(As()&&e.callbackNode!==n)return null;var r=Dl(e,e===Rt?Ot:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Kl(e,r);else{t=r;var a=Ue;Ue|=2;var s=h0();(Rt!==e||Ot!==t)&&(jr=null,Gs=ft()+500,Ba(e,t));do try{y2();break}catch(l){d0(e,l)}while(1);Yh(),ql.current=s,Ue=a,gt!==null?t=0:(Rt=null,Ot=0,t=bt)}if(t!==0){if(t===2&&(a=bd(e),a!==0&&(r=a,t=Kd(e,a))),t===1)throw n=ni,Ba(e,0),Yr(e,r),dn(e,ft()),n;if(t===6)Yr(e,r);else{if(a=e.current.alternate,!(r&30)&&!v2(a)&&(t=Kl(e,r),t===2&&(s=bd(e),s!==0&&(r=s,t=Kd(e,s))),t===1))throw n=ni,Ba(e,0),Yr(e,r),dn(e,ft()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(oe(345));case 2:Ra(e,an,jr);break;case 3:if(Yr(e,r),(r&130023424)===r&&(t=hf+500-ft(),10<t)){if(Dl(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Zt(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Ed(Ra.bind(null,e,an,jr),t);break}Ra(e,an,jr);break;case 4:if(Yr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var o=31-Xn(r);s=1<<o,o=t[o],o>a&&(a=o),r&=~s}if(r=a,r=ft()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*g2(r/1960))-r,10<r){e.timeoutHandle=Ed(Ra.bind(null,e,an,jr),r);break}Ra(e,an,jr);break;case 5:Ra(e,an,jr);break;default:throw Error(oe(329))}}}return dn(e,ft()),e.callbackNode===n?u0.bind(null,e):null}function Kd(e,t){var n=Po;return e.current.memoizedState.isDehydrated&&(Ba(e,t).flags|=256),e=Kl(e,t),e!==2&&(t=an,an=n,t!==null&&Xd(t)),e}function Xd(e){an===null?an=e:an.push.apply(an,e)}function v2(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],s=a.getSnapshot;a=a.value;try{if(!Jn(s(),a))return!1}catch(o){return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Yr(e,t){for(t&=~df,t&=~Ic,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Xn(t),r=1<<n;e[n]=-1,t&=~r}}function Bm(e){if(Ue&6)throw Error(oe(327));As();var t=Dl(e,0);if(!(t&1))return dn(e,ft()),null;var n=Kl(e,t);if(e.tag!==0&&n===2){var r=bd(e);r!==0&&(t=r,n=Kd(e,r))}if(n===1)throw n=ni,Ba(e,0),Yr(e,t),dn(e,ft()),n;if(n===6)throw Error(oe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ra(e,an,jr),dn(e,ft()),null}function ff(e,t){var n=Ue;Ue|=1;try{return e(t)}finally{Ue=n,Ue===0&&(Gs=ft()+500,Sc&&wa())}}function Ha(e){Jr!==null&&Jr.tag===0&&!(Ue&6)&&As();var t=Ue;Ue|=1;var n=On.transition,r=He;try{if(On.transition=null,He=1,e)return e()}finally{He=r,On.transition=n,Ue=t,!(Ue&6)&&wa()}}function pf(){gn=_s.current,Ze(_s)}function Ba(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Gw(n)),gt!==null)for(n=gt.return;n!==null;){var r=n;switch(Gh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Fl();break;case 3:qs(),Ze(cn),Ze(Kt),nf();break;case 5:tf(r);break;case 4:qs();break;case 13:Ze(rt);break;case 19:Ze(rt);break;case 10:Qh(r.type._context);break;case 22:case 23:pf()}n=n.return}if(Rt=e,gt=e=ca(e.current,null),Ot=gn=t,bt=0,ni=null,df=Ic=qa=0,an=Po=null,Pa!==null){for(t=0;t<Pa.length;t++)if(n=Pa[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=a,r.next=o}n.pending=r}Pa=null}return e}function d0(e,t){do{var n=gt;try{if(Yh(),xl.current=Vl,Ul){for(var r=ot.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Ul=!1}if(Va=0,Et=yt=ot=null,Ao=!1,Zo=0,uf.current=null,n===null||n.return===null){bt=1,ni=t,gt=null;break}e:{var s=e,o=n.return,l=n,c=t;if(t=Ot,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=l,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=Cm(o);if(p!==null){p.flags&=-257,Sm(p,o,l,s,t),p.mode&1&&km(s,u,t),t=p,c=u;var m=t.updateQueue;if(m===null){var x=new Set;x.add(c),t.updateQueue=x}else m.add(c);break e}else{if(!(t&1)){km(s,u,t),mf();break e}c=Error(oe(426))}}else if(tt&&l.mode&1){var y=Cm(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Sm(y,o,l,s,t),Kh(Hs(c,l));break e}}s=c=Hs(c,l),bt!==4&&(bt=2),Po===null?Po=[s]:Po.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var g=Kx(s,c,t);ym(s,g);break e;case 1:l=c;var v=s.type,w=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(ia===null||!ia.has(w)))){s.flags|=65536,t&=-t,s.lanes|=t;var b=Xx(s,l,t);ym(s,b);break e}}s=s.return}while(s!==null)}p0(n)}catch(N){t=N,gt===n&&n!==null&&(gt=n=n.return);continue}break}while(1)}function h0(){var e=ql.current;return ql.current=Vl,e===null?Vl:e}function mf(){(bt===0||bt===3||bt===2)&&(bt=4),Rt===null||!(qa&268435455)&&!(Ic&268435455)||Yr(Rt,Ot)}function Kl(e,t){var n=Ue;Ue|=2;var r=h0();(Rt!==e||Ot!==t)&&(jr=null,Ba(e,t));do try{x2();break}catch(a){d0(e,a)}while(1);if(Yh(),Ue=n,ql.current=r,gt!==null)throw Error(oe(261));return Rt=null,Ot=0,bt}function x2(){for(;gt!==null;)f0(gt)}function y2(){for(;gt!==null&&!V1();)f0(gt)}function f0(e){var t=g0(e.alternate,e,gn);e.memoizedProps=e.pendingProps,t===null?p0(e):gt=t,uf.current=null}function p0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=h2(n,t),n!==null){n.flags&=32767,gt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{bt=6,gt=null;return}}else if(n=d2(n,t,gn),n!==null){gt=n;return}if(t=t.sibling,t!==null){gt=t;return}gt=t=e}while(t!==null);bt===0&&(bt=5)}function Ra(e,t,n){var r=He,a=On.transition;try{On.transition=null,He=1,b2(e,t,n,r)}finally{On.transition=a,He=r}return null}function b2(e,t,n,r){do As();while(Jr!==null);if(Ue&6)throw Error(oe(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(oe(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(ew(e,s),e===Rt&&(gt=Rt=null,Ot=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Gi||(Gi=!0,v0(Rl,function(){return As(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=On.transition,On.transition=null;var o=He;He=1;var l=Ue;Ue|=4,uf.current=null,p2(e,n),l0(n,e),Ww(Cd),Il=!!kd,Cd=kd=null,e.current=n,m2(n),q1(),Ue=l,He=o,On.transition=s}else e.current=n;if(Gi&&(Gi=!1,Jr=e,Gl=a),s=e.pendingLanes,s===0&&(ia=null),K1(n.stateNode),dn(e,ft()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Hl)throw Hl=!1,e=Hd,Hd=null,e;return Gl&1&&e.tag!==0&&As(),s=e.pendingLanes,s&1?e===Gd?Fo++:(Fo=0,Gd=e):Fo=0,wa(),null}function As(){if(Jr!==null){var e=Kv(Gl),t=On.transition,n=He;try{if(On.transition=null,He=16>e?16:e,Jr===null)var r=!1;else{if(e=Jr,Jr=null,Gl=0,Ue&6)throw Error(oe(331));var a=Ue;for(Ue|=4,ge=e.current;ge!==null;){var s=ge,o=s.child;if(ge.flags&16){var l=s.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(ge=u;ge!==null;){var d=ge;switch(d.tag){case 0:case 11:case 15:To(8,d,s)}var h=d.child;if(h!==null)h.return=d,ge=h;else for(;ge!==null;){d=ge;var f=d.sibling,p=d.return;if(s0(d),d===u){ge=null;break}if(f!==null){f.return=p,ge=f;break}ge=p}}}var m=s.alternate;if(m!==null){var x=m.child;if(x!==null){m.child=null;do{var y=x.sibling;x.sibling=null,x=y}while(x!==null)}}ge=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,ge=o;else e:for(;ge!==null;){if(s=ge,s.flags&2048)switch(s.tag){case 0:case 11:case 15:To(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,ge=g;break e}ge=s.return}}var v=e.current;for(ge=v;ge!==null;){o=ge;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,ge=w;else e:for(o=v;ge!==null;){if(l=ge,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Dc(9,l)}}catch(N){ut(l,l.return,N)}if(l===o){ge=null;break e}var b=l.sibling;if(b!==null){b.return=l.return,ge=b;break e}ge=l.return}}if(Ue=a,wa(),dr&&typeof dr.onPostCommitFiberRoot=="function")try{dr.onPostCommitFiberRoot(Nc,e)}catch(N){}r=!0}return r}finally{He=n,On.transition=t}}return!1}function Wm(e,t,n){t=Hs(n,t),t=Kx(e,t,1),e=oa(e,t,1),t=Zt(),e!==null&&(xi(e,1,t),dn(e,t))}function ut(e,t,n){if(e.tag===3)Wm(e,e,n);else for(;t!==null;){if(t.tag===3){Wm(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ia===null||!ia.has(r))){e=Hs(n,e),e=Xx(t,e,1),t=oa(t,e,1),e=Zt(),t!==null&&(xi(t,1,e),dn(t,e));break}}t=t.return}}function w2(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Zt(),e.pingedLanes|=e.suspendedLanes&n,Rt===e&&(Ot&n)===n&&(bt===4||bt===3&&(Ot&130023424)===Ot&&500>ft()-hf?Ba(e,0):df|=n),dn(e,t)}function m0(e,t){t===0&&(e.mode&1?(t=Oi,Oi<<=1,!(Oi&130023424)&&(Oi=4194304)):t=1);var n=Zt();e=Ar(e,t),e!==null&&(xi(e,t,n),dn(e,n))}function N2(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),m0(e,n)}function _2(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(oe(314))}r!==null&&r.delete(t),m0(e,n)}var g0;g0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||cn.current)ln=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return ln=!1,u2(e,t,n);ln=!!(e.flags&131072)}else ln=!1,tt&&t.flags&1048576&&bx(t,Ll,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;bl(e,t),e=t.pendingProps;var a=zs(t,Kt.current);Is(t,n),a=af(null,t,r,e,a,n);var s=sf();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,un(r)?(s=!0,Ml(t)):s=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,Zh(t),a.updater=Rc,t.stateNode=a,a._reactInternals=t,Fd(t,r,e,n),t=Ld(null,t,r,!0,s,n)):(t.tag=0,tt&&s&&Hh(t),Yt(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(bl(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=k2(r),e=zn(r,e),a){case 0:t=Od(null,t,r,e,n);break e;case 1:t=Dm(null,t,r,e,n);break e;case 11:t=Em(null,t,r,e,n);break e;case 14:t=Rm(null,t,r,zn(r.type,e),n);break e}throw Error(oe(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:zn(r,a),Od(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:zn(r,a),Dm(e,t,r,a,n);case 3:e:{if(Zx(t),e===null)throw Error(oe(387));r=t.pendingProps,s=t.memoizedState,a=s.element,Cx(e,t),$l(t,r,null,n);var o=t.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){a=Hs(Error(oe(423)),t),t=Im(e,t,r,n,a);break e}else if(r!==a){a=Hs(Error(oe(424)),t),t=Im(e,t,r,n,a);break e}else for(bn=sa(t.stateNode.containerInfo.firstChild),jn=t,tt=!0,qn=null,n=jx(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Us(),r===a){t=Tr(e,t,n);break e}Yt(e,t,r,n)}t=t.child}return t;case 5:return Sx(t),e===null&&Ad(t),r=t.type,a=t.pendingProps,s=e!==null?e.memoizedProps:null,o=a.children,Sd(r,a)?o=null:s!==null&&Sd(r,s)&&(t.flags|=32),Jx(e,t),Yt(e,t,o,n),t.child;case 6:return e===null&&Ad(t),null;case 13:return e0(e,t,n);case 4:return ef(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Vs(t,null,r,n):Yt(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:zn(r,a),Em(e,t,r,a,n);case 7:return Yt(e,t,t.pendingProps,n),t.child;case 8:return Yt(e,t,t.pendingProps.children,n),t.child;case 12:return Yt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,s=t.memoizedProps,o=a.value,Ge(Bl,r._currentValue),r._currentValue=o,s!==null)if(Jn(s.value,o)){if(s.children===a.children&&!cn.current){t=Tr(e,t,n);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var l=s.dependencies;if(l!==null){o=s.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(s.tag===1){c=Rr(-1,n&-n),c.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),Td(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===t.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(oe(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Td(o,n,t),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Yt(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Is(t,n),a=Ln(a),r=r(a),t.flags|=1,Yt(e,t,r,n),t.child;case 14:return r=t.type,a=zn(r,t.pendingProps),a=zn(r.type,a),Rm(e,t,r,a,n);case 15:return Yx(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:zn(r,a),bl(e,t),t.tag=1,un(r)?(e=!0,Ml(t)):e=!1,Is(t,n),Gx(t,r,a),Fd(t,r,a,n),Ld(null,t,r,!0,e,n);case 19:return t0(e,t,n);case 22:return Qx(e,t,n)}throw Error(oe(156,t.tag))};function v0(e,t){return Vv(e,t)}function j2(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fn(e,t,n,r){return new j2(e,t,n,r)}function gf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function k2(e){if(typeof e=="function")return gf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Ph)return 11;if(e===Fh)return 14}return 2}function ca(e,t){var n=e.alternate;return n===null?(n=Fn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function _l(e,t,n,r,a,s){var o=2;if(r=e,typeof e=="function")gf(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case fs:return Wa(n.children,a,s,t);case Th:o=8,a|=8;break;case sd:return e=Fn(12,n,t,a|2),e.elementType=sd,e.lanes=s,e;case od:return e=Fn(13,n,t,a),e.elementType=od,e.lanes=s,e;case id:return e=Fn(19,n,t,a),e.elementType=id,e.lanes=s,e;case Sv:return Ac(n,a,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case kv:o=10;break e;case Cv:o=9;break e;case Ph:o=11;break e;case Fh:o=14;break e;case Gr:o=16,r=null;break e}throw Error(oe(130,e==null?e:typeof e,""))}return t=Fn(o,n,t,a),t.elementType=e,t.type=r,t.lanes=s,t}function Wa(e,t,n,r){return e=Fn(7,e,r,t),e.lanes=n,e}function Ac(e,t,n,r){return e=Fn(22,e,r,t),e.elementType=Sv,e.lanes=n,e.stateNode={isHidden:!1},e}function _u(e,t,n){return e=Fn(6,e,null,t),e.lanes=n,e}function ju(e,t,n){return t=Fn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function C2(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=au(0),this.expirationTimes=au(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=au(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function vf(e,t,n,r,a,s,o,l,c){return e=new C2(e,t,n,l,c),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Fn(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zh(s),e}function S2(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:hs,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function x0(e){if(!e)return ga;e=e._reactInternals;e:{if(Qa(e)!==e||e.tag!==1)throw Error(oe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(un(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(oe(171))}if(e.tag===1){var n=e.type;if(un(n))return xx(e,n,t)}return t}function y0(e,t,n,r,a,s,o,l,c){return e=vf(n,r,!0,e,a,s,o,l,c),e.context=x0(null),n=e.current,r=Zt(),a=la(n),s=Rr(r,a),s.callback=t!=null?t:null,oa(n,s,a),e.current.lanes=a,xi(e,a,r),dn(e,r),e}function Tc(e,t,n,r){var a=t.current,s=Zt(),o=la(a);return n=x0(n),t.context===null?t.context=n:t.pendingContext=n,t=Rr(s,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=oa(a,t,o),e!==null&&(Yn(e,a,o,s),vl(e,a,o)),o}function Xl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function $m(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function xf(e,t){$m(e,t),(e=e.alternate)&&$m(e,t)}function E2(){return null}var b0=typeof reportError=="function"?reportError:function(e){console.error(e)};function yf(e){this._internalRoot=e}Pc.prototype.render=yf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(oe(409));Tc(e,t,null,null)};Pc.prototype.unmount=yf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ha(function(){Tc(null,e,null,null)}),t[Ir]=null}};function Pc(e){this._internalRoot=e}Pc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Qv();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Xr.length&&t!==0&&t<Xr[n].priority;n++);Xr.splice(n,0,e),n===0&&Zv(e)}};function bf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Fc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function zm(){}function R2(e,t,n,r,a){if(a){if(typeof r=="function"){var s=r;r=function(){var u=Xl(o);s.call(u)}}var o=y0(t,r,e,0,null,!1,!1,"",zm);return e._reactRootContainer=o,e[Ir]=o.current,Ko(e.nodeType===8?e.parentNode:e),Ha(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var u=Xl(c);l.call(u)}}var c=vf(e,0,!1,null,null,!1,!1,"",zm);return e._reactRootContainer=c,e[Ir]=c.current,Ko(e.nodeType===8?e.parentNode:e),Ha(function(){Tc(t,c,n,r)}),c}function Mc(e,t,n,r,a){var s=n._reactRootContainer;if(s){var o=s;if(typeof a=="function"){var l=a;a=function(){var c=Xl(o);l.call(c)}}Tc(t,o,e,a)}else o=R2(n,t,e,a,r);return Xl(o)}Xv=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ko(t.pendingLanes);n!==0&&(Lh(t,n|1),dn(t,ft()),!(Ue&6)&&(Gs=ft()+500,wa()))}break;case 13:Ha(function(){var r=Ar(e,1);if(r!==null){var a=Zt();Yn(r,e,1,a)}}),xf(e,1)}};Bh=function(e){if(e.tag===13){var t=Ar(e,134217728);if(t!==null){var n=Zt();Yn(t,e,134217728,n)}xf(e,134217728)}};Yv=function(e){if(e.tag===13){var t=la(e),n=Ar(e,t);if(n!==null){var r=Zt();Yn(n,e,t,r)}xf(e,t)}};Qv=function(){return He};Jv=function(e,t){var n=He;try{return He=e,t()}finally{He=n}};vd=function(e,t,n){switch(t){case"input":if(ud(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=Cc(r);if(!a)throw Error(oe(90));Rv(r),ud(r,a)}}}break;case"textarea":Iv(e,n);break;case"select":t=n.value,t!=null&&Ss(e,!!n.multiple,t,!1)}};Lv=ff;Bv=Ha;var D2={usingClientEntryPoint:!1,Events:[bi,vs,Cc,Mv,Ov,ff]},vo={findFiberByHostInstance:Ta,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},I2={bundleType:vo.bundleType,version:vo.version,rendererPackageName:vo.rendererPackageName,rendererConfig:vo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Pr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=zv(e),e===null?null:e.stateNode},findFiberByHostInstance:vo.findFiberByHostInstance||E2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ki=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ki.isDisabled&&Ki.supportsFiber)try{Nc=Ki.inject(I2),dr=Ki}catch(e){}}En.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D2;En.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bf(t))throw Error(oe(200));return S2(e,t,null,n)};En.createRoot=function(e,t){if(!bf(e))throw Error(oe(299));var n=!1,r="",a=b0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=vf(e,1,!1,null,null,n,!1,r,a),e[Ir]=t.current,Ko(e.nodeType===8?e.parentNode:e),new yf(t)};En.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(oe(188)):(e=Object.keys(e).join(","),Error(oe(268,e)));return e=zv(t),e=e===null?null:e.stateNode,e};En.flushSync=function(e){return Ha(e)};En.hydrate=function(e,t,n){if(!Fc(t))throw Error(oe(200));return Mc(null,e,t,!0,n)};En.hydrateRoot=function(e,t,n){if(!bf(e))throw Error(oe(405));var r=n!=null&&n.hydratedSources||null,a=!1,s="",o=b0;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=y0(t,null,e,1,n!=null?n:null,a,!1,s,o),e[Ir]=t.current,Ko(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Pc(t)};En.render=function(e,t,n){if(!Fc(t))throw Error(oe(200));return Mc(null,e,t,!1,n)};En.unmountComponentAtNode=function(e){if(!Fc(e))throw Error(oe(40));return e._reactRootContainer?(Ha(function(){Mc(null,null,e,!1,function(){e._reactRootContainer=null,e[Ir]=null})}),!0):!1};En.unstable_batchedUpdates=ff;En.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Fc(n))throw Error(oe(200));if(e==null||e._reactInternals===void 0)throw Error(oe(38));return Mc(e,t,n,!1,r)};En.version="18.3.1-next-f1338f8080-20240426";function w0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(w0)}catch(e){console.error(e)}}w0(),wv.exports=En;var A2=wv.exports,Um=A2;rd.createRoot=Um.createRoot,rd.hydrateRoot=Um.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ri(){return ri=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ri.apply(this,arguments)}var Zr;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Zr||(Zr={}));const Vm="popstate";function T2(e){e===void 0&&(e={});function t(r,a){let{pathname:s,search:o,hash:l}=r.location;return Yd("",{pathname:s,search:o,hash:l},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:Yl(a)}return F2(t,n,null,e)}function pt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function N0(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch(n){}}}function P2(){return Math.random().toString(36).substr(2,8)}function qm(e,t){return{usr:e.state,key:e.key,idx:t}}function Yd(e,t,n,r){return n===void 0&&(n=null),ri({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?no(t):t,{state:n,key:t&&t.key||r||P2()})}function Yl(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function no(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function F2(e,t,n,r){r===void 0&&(r={});let{window:a=document.defaultView,v5Compat:s=!1}=r,o=a.history,l=Zr.Pop,c=null,u=d();u==null&&(u=0,o.replaceState(ri({},o.state,{idx:u}),""));function d(){return(o.state||{idx:null}).idx}function h(){l=Zr.Pop;let y=d(),g=y==null?null:y-u;u=y,c&&c({action:l,location:x.location,delta:g})}function f(y,g){l=Zr.Push;let v=Yd(x.location,y,g);n&&n(v,y),u=d()+1;let w=qm(v,u),b=x.createHref(v);try{o.pushState(w,"",b)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;a.location.assign(b)}s&&c&&c({action:l,location:x.location,delta:1})}function p(y,g){l=Zr.Replace;let v=Yd(x.location,y,g);n&&n(v,y),u=d();let w=qm(v,u),b=x.createHref(v);o.replaceState(w,"",b),s&&c&&c({action:l,location:x.location,delta:0})}function m(y){let g=a.location.origin!=="null"?a.location.origin:a.location.href,v=typeof y=="string"?y:Yl(y);return v=v.replace(/ $/,"%20"),pt(g,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,g)}let x={get action(){return l},get location(){return e(a,o)},listen(y){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(Vm,h),c=y,()=>{a.removeEventListener(Vm,h),c=null}},createHref(y){return t(a,y)},createURL:m,encodeLocation(y){let g=m(y);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:p,go(y){return o.go(y)}};return x}var Hm;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Hm||(Hm={}));function M2(e,t,n){return n===void 0&&(n="/"),O2(e,t,n,!1)}function O2(e,t,n,r){let a=typeof t=="string"?no(t):t,s=wf(a.pathname||"/",n);if(s==null)return null;let o=_0(e);L2(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let u=X2(s);l=G2(o[c],u,r)}return l}function _0(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let a=(s,o,l)=>{let c={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(pt(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let u=ua([r,c.relativePath]),d=n.concat(c);s.children&&s.children.length>0&&(pt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),_0(s.children,t,d,u)),!(s.path==null&&!s.index)&&t.push({path:u,score:q2(u,s.index),routesMeta:d})};return e.forEach((s,o)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))a(s,o);else for(let c of j0(s.path))a(s,o,c)}),t}function j0(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,a=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return a?[s,""]:[s];let o=j0(r.join("/")),l=[];return l.push(...o.map(c=>c===""?s:[s,c].join("/"))),a&&l.push(...o),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function L2(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:H2(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const B2=/^:[\w-]+$/,W2=3,$2=2,z2=1,U2=10,V2=-2,Gm=e=>e==="*";function q2(e,t){let n=e.split("/"),r=n.length;return n.some(Gm)&&(r+=V2),t&&(r+=$2),n.filter(a=>!Gm(a)).reduce((a,s)=>a+(B2.test(s)?W2:s===""?z2:U2),r)}function H2(e,t){return e.length===t.length&&e.slice(0,-1).every((r,a)=>r===t[a])?e[e.length-1]-t[t.length-1]:0}function G2(e,t,n){n===void 0&&(n=!1);let{routesMeta:r}=e,a={},s="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],u=l===r.length-1,d=s==="/"?t:t.slice(s.length)||"/",h=Km({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),f=c.route;if(!h&&u&&n&&!r[r.length-1].route.index&&(h=Km({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!h)return null;Object.assign(a,h.params),o.push({params:a,pathname:ua([s,h.pathname]),pathnameBase:Z2(ua([s,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(s=ua([s,h.pathnameBase]))}return o}function Km(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=K2(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let s=a[0],o=s.replace(/(.)\/+$/,"$1"),l=a.slice(1);return{params:r.reduce((u,d,h)=>{let{paramName:f,isOptional:p}=d;if(f==="*"){let x=l[h]||"";o=s.slice(0,s.length-x.length).replace(/(.)\/+$/,"$1")}const m=l[h];return p&&!m?u[f]=void 0:u[f]=(m||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:o,pattern:e}}function K2(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),N0(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),r]}function X2(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return N0(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function wf(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function Y2(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:a=""}=typeof e=="string"?no(e):e;return{pathname:n?n.startsWith("/")?n:Q2(n,t):t,search:eN(r),hash:tN(a)}}function Q2(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function ku(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function J2(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function Nf(e,t){let n=J2(e);return t?n.map((r,a)=>a===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function _f(e,t,n,r){r===void 0&&(r=!1);let a;typeof e=="string"?a=no(e):(a=ri({},e),pt(!a.pathname||!a.pathname.includes("?"),ku("?","pathname","search",a)),pt(!a.pathname||!a.pathname.includes("#"),ku("#","pathname","hash",a)),pt(!a.search||!a.search.includes("#"),ku("#","search","hash",a)));let s=e===""||a.pathname==="",o=s?"/":a.pathname,l;if(o==null)l=n;else{let h=t.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;a.pathname=f.join("/")}l=h>=0?t[h]:"/"}let c=Y2(a,l),u=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const ua=e=>e.join("/").replace(/\/\/+/g,"/"),Z2=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),eN=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,tN=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function nN(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const k0=["post","put","patch","delete"];new Set(k0);const rN=["get",...k0];new Set(rN);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ai(){return ai=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ai.apply(this,arguments)}const jf=E.createContext(null),aN=E.createContext(null),Na=E.createContext(null),Oc=E.createContext(null),Fr=E.createContext({outlet:null,matches:[],isDataRoute:!1}),C0=E.createContext(null);function sN(e,t){let{relative:n}=t===void 0?{}:t;ro()||pt(!1);let{basename:r,navigator:a}=E.useContext(Na),{hash:s,pathname:o,search:l}=E0(e,{relative:n}),c=o;return r!=="/"&&(c=o==="/"?r:ua([r,o])),a.createHref({pathname:c,search:l,hash:s})}function ro(){return E.useContext(Oc)!=null}function Mr(){return ro()||pt(!1),E.useContext(Oc).location}function S0(e){E.useContext(Na).static||E.useLayoutEffect(e)}function Zn(){let{isDataRoute:e}=E.useContext(Fr);return e?bN():oN()}function oN(){ro()||pt(!1);let e=E.useContext(jf),{basename:t,future:n,navigator:r}=E.useContext(Na),{matches:a}=E.useContext(Fr),{pathname:s}=Mr(),o=JSON.stringify(Nf(a,n.v7_relativeSplatPath)),l=E.useRef(!1);return S0(()=>{l.current=!0}),E.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){r.go(u);return}let h=_f(u,JSON.parse(o),s,d.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:ua([t,h.pathname])),(d.replace?r.replace:r.push)(h,d.state,d)},[t,r,o,s,e])}const iN=E.createContext(null);function lN(e){let t=E.useContext(Fr).outlet;return t&&E.createElement(iN.Provider,{value:e},t)}function E0(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=E.useContext(Na),{matches:a}=E.useContext(Fr),{pathname:s}=Mr(),o=JSON.stringify(Nf(a,r.v7_relativeSplatPath));return E.useMemo(()=>_f(e,JSON.parse(o),s,n==="path"),[e,o,s,n])}function cN(e,t){return uN(e,t)}function uN(e,t,n,r){ro()||pt(!1);let{navigator:a}=E.useContext(Na),{matches:s}=E.useContext(Fr),o=s[s.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let u=Mr(),d;if(t){var h;let y=typeof t=="string"?no(t):t;c==="/"||(h=y.pathname)!=null&&h.startsWith(c)||pt(!1),d=y}else d=u;let f=d.pathname||"/",p=f;if(c!=="/"){let y=c.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(y.length).join("/")}let m=M2(e,{pathname:p}),x=mN(m&&m.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:ua([c,a.encodeLocation?a.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:ua([c,a.encodeLocation?a.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),s,n,r);return t&&x?E.createElement(Oc.Provider,{value:{location:ai({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Zr.Pop}},x):x}function dN(){let e=yN(),t=nN(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},s=null;return E.createElement(E.Fragment,null,E.createElement("h2",null,"Unexpected Application Error!"),E.createElement("h3",{style:{fontStyle:"italic"}},t),n?E.createElement("pre",{style:a},n):null,s)}const hN=E.createElement(dN,null);class fN extends E.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?E.createElement(Fr.Provider,{value:this.props.routeContext},E.createElement(C0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function pN(e){let{routeContext:t,match:n,children:r}=e,a=E.useContext(jf);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),E.createElement(Fr.Provider,{value:t},r)}function mN(e,t,n,r){var a;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var s;if(!n)return null;if(n.errors)e=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let o=e,l=(a=n)==null?void 0:a.errors;if(l!=null){let d=o.findIndex(h=>h.route.id&&(l==null?void 0:l[h.route.id])!==void 0);d>=0||pt(!1),o=o.slice(0,Math.min(o.length,d+1))}let c=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let d=0;d<o.length;d++){let h=o[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=d),h.route.id){let{loaderData:f,errors:p}=n,m=h.route.loader&&f[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||m){c=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((d,h,f)=>{let p,m=!1,x=null,y=null;n&&(p=l&&h.route.id?l[h.route.id]:void 0,x=h.route.errorElement||hN,c&&(u<0&&f===0?(wN("route-fallback",!1),m=!0,y=null):u===f&&(m=!0,y=h.route.hydrateFallbackElement||null)));let g=t.concat(o.slice(0,f+1)),v=()=>{let w;return p?w=x:m?w=y:h.route.Component?w=E.createElement(h.route.Component,null):h.route.element?w=h.route.element:w=d,E.createElement(pN,{match:h,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:w})};return n&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?E.createElement(fN,{location:n.location,revalidation:n.revalidation,component:x,error:p,children:v(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):v()},null)}var R0=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(R0||{}),Ql=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ql||{});function gN(e){let t=E.useContext(jf);return t||pt(!1),t}function vN(e){let t=E.useContext(aN);return t||pt(!1),t}function xN(e){let t=E.useContext(Fr);return t||pt(!1),t}function D0(e){let t=xN(),n=t.matches[t.matches.length-1];return n.route.id||pt(!1),n.route.id}function yN(){var e;let t=E.useContext(C0),n=vN(Ql.UseRouteError),r=D0(Ql.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function bN(){let{router:e}=gN(R0.UseNavigateStable),t=D0(Ql.UseNavigateStable),n=E.useRef(!1);return S0(()=>{n.current=!0}),E.useCallback(function(a,s){s===void 0&&(s={}),n.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,ai({fromRouteId:t},s)))},[e,t])}const Xm={};function wN(e,t,n){!t&&!Xm[e]&&(Xm[e]=!0)}function NN(e,t){e==null||e.v7_startTransition,(e==null?void 0:e.v7_relativeSplatPath)===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function kf(e){let{to:t,replace:n,state:r,relative:a}=e;ro()||pt(!1);let{future:s,static:o}=E.useContext(Na),{matches:l}=E.useContext(Fr),{pathname:c}=Mr(),u=Zn(),d=_f(t,Nf(l,s.v7_relativeSplatPath),c,a==="path"),h=JSON.stringify(d);return E.useEffect(()=>u(JSON.parse(h),{replace:n,state:r,relative:a}),[u,h,a,n,r]),null}function _N(e){return lN(e.context)}function Ct(e){pt(!1)}function jN(e){let{basename:t="/",children:n=null,location:r,navigationType:a=Zr.Pop,navigator:s,static:o=!1,future:l}=e;ro()&&pt(!1);let c=t.replace(/^\/*/,"/"),u=E.useMemo(()=>({basename:c,navigator:s,static:o,future:ai({v7_relativeSplatPath:!1},l)}),[c,l,s,o]);typeof r=="string"&&(r=no(r));let{pathname:d="/",search:h="",hash:f="",state:p=null,key:m="default"}=r,x=E.useMemo(()=>{let y=wf(d,c);return y==null?null:{location:{pathname:y,search:h,hash:f,state:p,key:m},navigationType:a}},[c,d,h,f,p,m,a]);return x==null?null:E.createElement(Na.Provider,{value:u},E.createElement(Oc.Provider,{children:n,value:x}))}function kN(e){let{children:t,location:n}=e;return cN(Qd(t),n)}new Promise(()=>{});function Qd(e,t){t===void 0&&(t=[]);let n=[];return E.Children.forEach(e,(r,a)=>{if(!E.isValidElement(r))return;let s=[...t,a];if(r.type===E.Fragment){n.push.apply(n,Qd(r.props.children,s));return}r.type!==Ct&&pt(!1),!r.props.index||!r.props.children||pt(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Qd(r.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Jd(){return Jd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Jd.apply(this,arguments)}function CN(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,s;for(s=0;s<r.length;s++)a=r[s],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function SN(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function EN(e,t){return e.button===0&&(!t||t==="_self")&&!SN(e)}const RN=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],DN="6";try{window.__reactRouterVersion=DN}catch(e){}const IN="startTransition",Ym=w1[IN];function AN(e){let{basename:t,children:n,future:r,window:a}=e,s=E.useRef();s.current==null&&(s.current=T2({window:a,v5Compat:!0}));let o=s.current,[l,c]=E.useState({action:o.action,location:o.location}),{v7_startTransition:u}=r||{},d=E.useCallback(h=>{u&&Ym?Ym(()=>c(h)):c(h)},[c,u]);return E.useLayoutEffect(()=>o.listen(d),[o,d]),E.useEffect(()=>NN(r),[r]),E.createElement(jN,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}const TN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",PN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,js=E.forwardRef(function(t,n){let{onClick:r,relative:a,reloadDocument:s,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:h}=t,f=CN(t,RN),{basename:p}=E.useContext(Na),m,x=!1;if(typeof u=="string"&&PN.test(u)&&(m=u,TN))try{let w=new URL(window.location.href),b=u.startsWith("//")?new URL(w.protocol+u):new URL(u),N=wf(b.pathname,p);b.origin===w.origin&&N!=null?u=N+b.search+b.hash:x=!0}catch(w){}let y=sN(u,{relative:a}),g=FN(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:a,viewTransition:h});function v(w){r&&r(w),w.defaultPrevented||g(w)}return E.createElement("a",Jd({},f,{href:m||y,onClick:x||s?r:v,ref:n,target:c}))});var Qm;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Qm||(Qm={}));var Jm;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Jm||(Jm={}));function FN(e,t){let{target:n,replace:r,state:a,preventScrollReset:s,relative:o,viewTransition:l}=t===void 0?{}:t,c=Zn(),u=Mr(),d=E0(e,{relative:o});return E.useCallback(h=>{if(EN(h,n)){h.preventDefault();let f=r!==void 0?r:Yl(u)===Yl(d);c(e,{replace:f,state:a,preventScrollReset:s,relative:o,viewTransition:l})}},[u,c,d,r,a,n,e,s,o,l])}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MN=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ON=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),Zm=e=>{const t=ON(e);return t.charAt(0).toUpperCase()+t.slice(1)},I0=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),LN=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var BN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WN=E.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:s,iconNode:o,...l},c)=>E.createElement("svg",{ref:c,...BN,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:I0("lucide",a),...!s&&!LN(l)&&{"aria-hidden":"true"},...l},[...o.map(([u,d])=>E.createElement(u,d)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=(e,t)=>{const n=E.forwardRef(({className:r,...a},s)=>E.createElement(WN,{ref:s,iconNode:t,className:I0("lucide-".concat(MN(Zm(e))),"lucide-".concat(e),r),...a}));return n.displayName=Zm(e),n};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $N=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],zN=Re("activity",$N);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Zd=Re("archive",UN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VN=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],qN=Re("building",VN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]],GN=Re("calendar-check",HN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Je=Re("calendar",KN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XN=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ks=Re("camera",XN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Cu=Re("chart-column",YN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QN=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],JN=Re("check",QN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZN=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],e_=Re("chevron-down",ZN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t_=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],A0=Re("chevron-left",t_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n_=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Cf=Re("chevron-right",n_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Dt=Re("circle-alert",r_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],s_=Re("circle-check",a_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o_=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Qt=Re("circle-check-big",o_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],l_=Re("circle-user",i_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ao=Re("circle-x",c_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u_=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],Su=Re("clipboard-check",u_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d_=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Qe=Re("clock",d_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h_=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],f_=Re("coffee",h_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],eh=Re("copy",p_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m_=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],si=Re("download",m_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],T0=Re("eye",g_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],xn=Re("file-text",v_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Sf=Re("funnel",x_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],b_=Re("house",y_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],N_=Re("info",w_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],xo=Re("key",__);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],k_=Re("layout-dashboard",j_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C_=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],oi=Re("loader-circle",C_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S_=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ks=Re("log-out",S_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E_=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ii=Re("lock",E_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R_=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Vn=Re("mail",R_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D_=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],I_=Re("map-pin",D_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A_=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],P0=Re("menu",A_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T_=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],P_=Re("message-square",T_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F_=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],eg=Re("pen-line",F_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M_=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Ma=Re("phone",M_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O_=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ga=Re("plus",O_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L_=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],th=Re("refresh-cw",L_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B_=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],tg=Re("scale",B_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W_=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ng=Re("search",W_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $_=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ef=Re("settings",$_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z_=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],U_=Re("shield-check",z_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V_=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],rg=Re("shield",V_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q_=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],da=Re("square-pen",q_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H_=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],li=Re("trash-2",H_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G_=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],nh=Re("trending-up",G_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K_=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ci=Re("users",K_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X_=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Gn=Re("user",X_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y_=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Q_=Re("wifi-off",Y_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J_=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Z_=Re("wifi",J_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ej=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],kn=Re("x",ej),tj="https://kiosk.quriousclick.es/api";class nj{constructor(){this.baseURL=tj}async request(t,n={}){const r="".concat(this.baseURL).concat(t),a=localStorage.getItem("authToken"),{headers:s={},...o}=n,l=o.body instanceof FormData,c={headers:{Accept:"application/json",...a&&{Authorization:"Bearer ".concat(a)},...!l&&o.body?{"Content-Type":"application/json"}:{},...s},...o};try{const u=await fetch(r,c);if(!u.ok){let h;const f=u.headers.get("content-type");if(f&&f.includes("application/json")){if(h=await u.json(),u.status===422&&h.errors)throw{message:Object.values(h.errors).flat().join(" ")}}else h={message:await u.text()};throw h}if(n.responseType==="blob")return u.blob();const d=u.headers.get("content-type");if(d&&d.includes("application/json"))return u.json();{const h=await u.text();throw{message:"Server returned HTML instead of JSON: ".concat(h.substring(0,100),"...")}}}catch(u){throw console.error("API request failed:",u),u}}async get(t,n={}){return this.request(t,{method:"GET",...n})}async post(t,n,r={}){const a=n instanceof FormData?n:JSON.stringify(n);return this.request(t,{method:"POST",body:a,...r})}async put(t,n,r={}){const a=n instanceof FormData?n:JSON.stringify(n);return this.request(t,{method:"PUT",body:a,...r})}async delete(t,n={}){return this.request(t,{method:"DELETE",...n})}async login(t){const n=await this.post("/login",t);return localStorage.setItem("authToken",n.token),n}async logout(){try{await this.request("/logout",{method:"POST"})}finally{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("isAuthenticated")}}async getCurrentUser(){return this.request("/user")}async getEmployees(){return this.request("/employees")}async createEmployee(t){const n=t instanceof FormData;return this.request("/employees",{method:"POST",body:n?t:JSON.stringify(t)})}async updateEmployee(t,n){const r=n instanceof FormData;return this.request("/employees/".concat(t),{method:"PUT",body:r?n:JSON.stringify(n)})}async deleteEmployee(t){return this.request("/employees/".concat(t),{method:"DELETE"})}async getPolicies(){return this.request("/policies")}async createPolicy(t){return this.request("/policies",{method:"POST",body:JSON.stringify(t)})}async updatePolicy(t,n){return this.request("/policies/".concat(t),{method:"PUT",body:JSON.stringify(n)})}async deletePolicy(t){return this.request("/policies/".concat(t),{method:"DELETE"})}async togglePolicyStatus(t){return this.request("/policies/".concat(t,"/toggle-status"),{method:"PATCH"})}async getLeavePolicies(t={}){const n=new URLSearchParams(t).toString(),r=n?"/leave-policies?".concat(n):"/leave-policies";return this.request(r)}async createLeavePolicy(t){return this.request("/leave-policies",{method:"POST",body:JSON.stringify(t)})}async updateLeavePolicy(t,n){return this.request("/leave-policies/".concat(t),{method:"PUT",body:JSON.stringify(n)})}async copyLeavePolicy(t){return this.request("/leave-policies/".concat(t,"/copy"),{method:"POST"})}async toggleLeavePolicyStatus(t){return this.request("/leave-policies/".concat(t,"/toggle-status"),{method:"PATCH"})}async deleteLeavePolicy(t){return this.request("/leave-policies/".concat(t),{method:"DELETE"})}async getEmployeeLeavePolicies(t){return this.request("/employees/".concat(t,"/leave-policies"))}async assignLeavePolicies(t,n){return this.request("/employees/".concat(t,"/leave-policies"),{method:"POST",body:JSON.stringify({policy_ids:n})})}async detachLeavePolicy(t,n){return this.request("/employees/".concat(t,"/leave-policies/").concat(n),{method:"DELETE"})}async getLeaveRequests(t={}){const n=new URLSearchParams(t).toString(),r=n?"/leave/requests?".concat(n):"/leave/requests";return this.request(r)}async getLeaveRequest(t){return this.request("/leave/requests/".concat(t))}async getLeaveApprovals(t={}){const n=new URLSearchParams(t).toString(),r=n?"/leave/approvals?".concat(n):"/leave/approvals";return this.request(r)}async createLeaveRequest(t){return this.request("/leave/requests",{method:"POST",body:t})}async cancelLeaveRequest(t){return this.request("/leave/requests/".concat(t,"/cancel"),{method:"POST"})}async approveLeaveRequest(t,n={}){return this.request("/leave/requests/".concat(t,"/approve"),{method:"POST",body:JSON.stringify(n)})}async rejectLeaveRequest(t,n={}){return this.request("/leave/requests/".concat(t,"/reject"),{method:"POST",body:JSON.stringify(n)})}async requestLeaveClarification(t,n){return this.request("/leave/requests/".concat(t,"/clarify"),{method:"POST",body:JSON.stringify(n)})}async overwriteLeaveRequestDates(t,n){return this.request("/leave/requests/".concat(t,"/overwrite-dates"),{method:"POST",body:JSON.stringify(n)})}async getEmployeeLeaveRequests(t){return this.request("/leave/requests?employee_id=".concat(t))}async getCorrectionData(){return this.request("/leave/correction-data")}async applyLeaveCorrection(t){return this.request("/leave/manual-correction",{method:"POST",body:JSON.stringify(t)})}async adjustLeaveBalance(t,n){return this.request("/employees/".concat(t,"/leave-balances/adjust"),{method:"POST",body:JSON.stringify(n)})}async getAttendances(t={}){const n=new URLSearchParams(t).toString(),r=n?"/attendances?".concat(n):"/attendances";return this.request(r)}async createAttendance(t){return this.request("/attendances",{method:"POST",body:JSON.stringify(t)})}async updateAttendance(t,n){return this.request("/attendances/".concat(t),{method:"PUT",body:JSON.stringify(n)})}async deleteAttendance(t){return this.request("/attendances/".concat(t),{method:"DELETE"})}async markAttendance(t){return this.request("/attendances/mark",{method:"POST",body:JSON.stringify({employee_id:t})})}async enrollFace(t,n,r={}){return this.request("/faces/enroll",{method:"POST",body:JSON.stringify({employee_id:t,descriptors:n,metadata:r})})}async recognizeFace(t,n=.6){return this.request("/faces/recognize",{method:"POST",body:JSON.stringify({descriptor:t,threshold:n})})}async unenrollFace(t){return this.request("/faces/unenroll",{method:"POST",body:JSON.stringify({employee_id:t})})}async getDashboardData(){return this.request("/attendance/dashboard")}async getAttendanceStats(){return this.request("/attendance/stats")}async getDepartmentStats(){return this.request("/attendance/departments")}async getAttendanceTrends(){return this.request("/attendance/trends")}async getLiveActivity(){return this.request("/attendance/live?t=".concat(Date.now()))}async getPresentToday(){return this.request("/attendance/present-today")}async getAbsentToday(){return this.request("/attendance/absent-today")}async getOnLeaveToday(){return this.request("/attendance/on-leave-today")}async getLateArrivalsToday(){return this.request("/attendance/late-arrivals-today")}async getEarlyDeparturesToday(){return this.request("/attendance/early-departures-today")}async getEmployeeMonthlyAttendance(t,n,r){return this.request("/attendance/employee/".concat(t,"/").concat(n,"/").concat(r))}async exportEmployeeMonthlyAttendance(t,n,r){return this.request("/attendance/export/employee/".concat(t,"/").concat(n,"/").concat(r),{responseType:"blob"})}async exportEmployeeDailyAttendance(t,n){return this.request("/attendance/export/daily/employee/".concat(t,"/").concat(n),{responseType:"blob"})}async exportEmployeeCustomRangeAttendance(t,n,r){return this.request("/attendance/export/custom/employee/".concat(t,"/").concat(n,"/").concat(r),{responseType:"blob"})}async emailEmployeeAttendanceReport(t,n,r,a,s,o,l){return this.request("/attendance/email",{method:"POST",body:JSON.stringify({employee_id:t,email:n,report_type:r,year:a,month:s,start_date:o,end_date:l})})}async getDepartments(){return this.request("/admin/departments")}async getEmployeesByDepartment(t){const n=t&&t!=="all"?"?department=".concat(encodeURIComponent(t)):"";return this.request("/admin/employees-by-department".concat(n))}async getAttendanceLogs(t,n,r){return this.request("/admin/attendance-logs?employee_id=".concat(t,"&start_date=").concat(n,"&end_date=").concat(r))}async addNewAttendance(t){return this.request("/admin/attendance/add-new",{method:"POST",body:JSON.stringify(t)})}async updateAttendanceRecord(t,n){return this.request("/admin/attendance/".concat(t,"/update"),{method:"PUT",body:JSON.stringify(n)})}}const ke=new nj,F0=()=>{const[e,t]=E.useState(!1),[n,r]=E.useState(!1),[a,s]=E.useState(!1),[o,l]=E.useState(new Date),[c,u]=E.useState(navigator.onLine),d=Mr(),h=E.useRef(null);E.useEffect(()=>{const v=setInterval(()=>l(new Date),1e3);return()=>clearInterval(v)},[]),E.useEffect(()=>{const v=()=>u(!0),w=()=>u(!1);return window.addEventListener("online",v),window.addEventListener("offline",w),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",w)}},[]),E.useEffect(()=>{const v=w=>{h.current&&!h.current.contains(w.target)&&(r(!1),s(!1))};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const f=[{name:"Dashboard",href:"/dashboard",icon:k_},{name:"Policies",icon:xn,dropdown:!0,items:[{name:"Attendance Policies",href:"/policies",icon:xn},{name:"Leave Policies",href:"/leave/policies",icon:Je}]},{name:"Requests",icon:Su,dropdown:!0,items:[{name:"Leave Approvals",href:"/leave/approvals",icon:Su},{name:"Attendance Corrections",href:"/admin/correction-requests",icon:Qe}]},{name:"Employees",href:"/employees",icon:ci},{name:"Reports",href:"/reports",icon:Cu}],p=[{name:"Dashboard",href:"/dashboard",icon:Cu},{name:"Attendance Policies",href:"/policies",icon:Ef},{name:"Leave Policies",href:"/leave/policies",icon:Je},{name:"Leave Approvals",href:"/leave/approvals",icon:Su},{name:"Attendance Corrections",href:"/admin/correction-requests",icon:Qe},{name:"Employees",href:"/employees",icon:ci},{name:"Reports",href:"/reports",icon:Cu}],m=v=>d.pathname===v||d.pathname.startsWith("".concat(v,"/")),x=v=>v.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),y=v=>v.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),g=d.pathname==="/";return i.jsxs("header",{className:"".concat(g?"bg-white/10 backdrop-blur-sm border-b border-white/20 px-4 md:px-8 py-4 md:py-6":"bg-white border-b border-gray-200 px-4 py-3 shadow-sm sticky top-0 z-50"),children:[i.jsx("div",{className:"max-w-7xl mx-auto",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:"flex items-center gap-4",children:g?i.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[i.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-white rounded-xl flex items-center justify-center",children:i.jsx(ks,{className:" md:w-6 md:h-6 lg:w-6 lg:h-6 text-slate-900"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg md:text-2xl font-bold text-white",children:"Attendance system"}),i.jsx("p",{className:"text-xs md:text-sm text-slate-300",children:"Attendance system"})]})]}):i.jsxs(i.Fragment,{children:[i.jsx("h1",{className:"text-base md:text-lg font-semibold text-gray-900",children:"Admin Panel"}),i.jsx("span",{className:"hidden md:inline-block text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:"Logged in as Admin"})]})}),g?i.jsxs("div",{className:"flex items-center gap-3 md:gap-6",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-xl md:text-3xl font-bold text-white",children:x(o)}),i.jsx("div",{className:"text-xs md:text-sm text-slate-300",children:y(o)})]}),i.jsxs(js,{to:"/login",className:"bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2",children:[i.jsx(ii,{className:"w-4 h-4"}),i.jsx("span",{className:"hidden md:inline",children:"Admin"})]}),i.jsx("div",{className:"flex items-center gap-2",children:c?i.jsx(Z_,{className:"w-5 h-5 text-green-400"}):i.jsx(Q_,{className:"w-5 h-5 text-red-400"})})]}):i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{ref:h,className:"hidden lg:flex items-center gap-2",children:[f.map(v=>{const w=v.icon;if(v.dropdown){const b=v.items.some(k=>m(k.href)),N=v.name==="Policies"?n:a,_=v.name==="Policies"?r:s;return i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:()=>_(!N),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(b?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[i.jsx(w,{className:"w-4 h-4"}),i.jsx("span",{children:v.name}),i.jsx(e_,{className:"w-4 h-4 transition-transform ".concat(N?"rotate-180":"")})]}),N&&i.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:v.items.map(k=>{const j=k.icon,C=m(k.href);return i.jsxs(js,{to:k.href,onClick:()=>_(!1),className:"flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors ".concat(C?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),children:[i.jsx(j,{className:"w-4 h-4"}),i.jsx("span",{children:k.name})]},k.name)})})]},v.name)}else{const b=m(v.href);return i.jsxs(js,{to:v.href,onClick:()=>{r(!1),s(!1)},className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(b?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[i.jsx(w,{className:"w-4 h-4"}),i.jsx("span",{children:v.name})]},v.name)}}),i.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),i.jsxs("button",{onClick:async()=>{try{await ke.logout()}catch(v){console.error("Logout failed:",v)}finally{window.location.href="/login"}},className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[i.jsx(Ks,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]}),i.jsx("button",{className:"lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors ml-auto",onClick:()=>t(!e),children:e?i.jsx(kn,{className:"w-6 h-6 "}):i.jsx(P0,{className:"w-6 h-6"})})]})]})}),e&&!g&&i.jsxs("div",{className:"lg:hidden mt-4 space-y-2",children:[i.jsx("hr",{className:"border-gray-200"}),i.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:p.map(v=>{const w=v.icon,b=m(v.href);return i.jsxs(js,{to:v.href,onClick:()=>t(!1),className:"flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium transition-colors\n                    ".concat(b?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[i.jsx(w,{className:"w-4 h-4"}),i.jsx("span",{children:v.name})]},v.name)})}),i.jsxs("button",{onClick:async()=>{try{await ke.logout()}catch(v){console.error("Logout failed:",v)}finally{window.location.href="/login"}},className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[i.jsx(Ks,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]})]})},M0=()=>i.jsx("footer",{className:"bg-white/5 backdrop-blur-sm border-t border-white/20 px-4 md:px-8 py-3 md:py-4",children:i.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 text-xs md:text-sm text-slate-400",children:[i.jsx("p",{children:"Powered by FaceRecognition AI v2.0"}),i.jsx("p",{className:"text-center md:text-right",children:"For support, contact IT Help Desk"})]})}),Ca=({children:e})=>{const t=localStorage.getItem("authToken"),n=Mr();if(!t)return i.jsx(kf,{to:"/login",replace:!0});const r=n.pathname==="/";return i.jsxs("div",{className:"min-h-screen flex flex-col",children:[i.jsx(F0,{}),i.jsx("main",{children:e}),r&&i.jsx(M0,{})]})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var O0=function(e,t){return(O0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)r.hasOwnProperty(a)&&(n[a]=r[a])})(e,t)};function er(e,t){function n(){this.constructor=e}O0(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function xe(e,t,n,r){return new(n||(n=Promise))(function(a,s){function o(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?a(u.value):new n(function(d){d(u.value)}).then(o,l)}c((r=r.apply(e,t||[])).next())})}function ye(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(c){return function(u){return function(d){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&d[0]?r.return:d[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,d[1])).done)return a;switch(r=0,a&&(d=[2&d[0],a.value]),d[0]){case 0:case 1:a=d;break;case 4:return o.label++,{value:d[1],done:!1};case 5:o.label++,r=d[1],d=[0];continue;case 7:d=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){o=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){o.label=d[1];break}if(d[0]===6&&o.label<a[1]){o.label=a[1],a=d;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(d);break}a[2]&&o.ops.pop(),o.trys.pop();continue}d=t.call(e,o)}catch(h){d=[6,h],r=0}finally{n=a=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([c,u])}}}var rj=function(){function e(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(t,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=t,this.platform=n},e.prototype.registerFlag=function(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){var a=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+a+"."),this.set(t,a)}},e.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},e.prototype.getNumber=function(t){return this.get(t)},e.prototype.getBool=function(t){return this.get(t)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(t,n){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)},e.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},e.prototype.setFlags=function(t){this.flags=Object.assign({},t)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,a=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(s){for(var o=[],l=1;l<arguments.length;l++)o[l-1]=arguments[l];return aj(r,o[0],o[1]),o.join("=")}),r);"tfjsflags"in a&&a.tfjsflags.split(",").forEach(function(s){var o=s.split(":"),l=o[0],c=o[1];t.urlFlags[l]=function(u,d){if((d=d.toLowerCase())==="true"||d==="false")return d==="true";if(""+ +d===d)return+d;throw new Error("Could not parse value flag value "+d+" for flag "+u+".")}(l,c)})}},e}();function aj(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function Z(){return L0}var L0=null,Jl=new Map,rh=new Map;function B0(e,t){var n=$0(e,t);return Jl.get(n)}function sj(e){return rh.get(e)}function ag(e){for(var t=Jl.entries(),n=[];;){var r=t.next(),a=r.done,s=r.value;if(a)break;var o=s[0],l=s[1];o.split("_")[0]===e&&n.push(l)}return n}function W0(e){var t=e.kernelName,n=e.backendName,r=$0(t,n);if(Jl.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");Jl.set(r,e)}function oj(e){var t=e.kernelName;rh.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),rh.set(t,e)}function $0(e,t){return t+"_"+e}function ah(e,t,n){return Math.max(e,Math.min(t,n))}function z0(e){return e%2==0?e:e+1}function ij(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function P(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function qe(e,t,n){n===void 0&&(n=""),P(It(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function so(e){P(e!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Xs(e,t,n){if(t===void 0&&(t=[]),n===void 0&&(n=!1),t==null&&(t=[]),Array.isArray(e)||fr(e)&&!n)for(var r=0;r<e.length;++r)Xs(e[r],t,n);else t.push(e);return t}function be(e){if(e.length===0)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function It(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ht(e){return e%1==0}function lj(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function sh(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Ts(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function sg(e,t,n){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,a){var s=0,o=function(){if(e())r();else{s++;var l=t(s);n!=null&&s>=n?a():setTimeout(o,l)}};o()})}function cj(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(e[a]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+a);r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found "+e[a]+" at dim "+a);if(r===-1){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(n===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var s=e.slice();return s[r]=t/n,s}function kt(e,t){var n=t.length;return P((e=e==null?t.map(function(r,a){return a}):[].concat(e)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),P(e.every(function(r){return ht(r)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(r){return r<0?n+r:r})}function Aa(e,t){for(var n=[],r=[],a=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||a?null:kt(t,e).sort(),o=0,l=0;l<e.length;++l){if(s!=null){if(s[o]===l&&e[l]!==1)throw new Error("Can't squeeze axis "+l+" since its dim '"+e[l]+"' is not 1");(s[o]==null||s[o]>l)&&e[l]===1&&(n.push(e[l]),r.push(l)),s[o]<=l&&o++}e[l]!==1&&(n.push(e[l]),r.push(l))}return{newShape:n,keptDims:r}}function ui(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Zl(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else{if(e!=="string")throw new Error("Unknown data type "+e);n=new Array(t)}return n}function uj(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function dj(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function hj(e,t){return t!=="complex64"&&(t!=="float32"||e==="complex64")&&(t!=="int32"||e==="float32"||e==="complex64")&&(t!=="bool"||e!=="bool")}function fr(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function U0(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function fj(e){if(e==null)return 0;var t=0;return e.forEach(function(n){return t+=n.length}),t}function Rf(e){return typeof e=="string"||e instanceof String}function pj(e){return typeof e=="boolean"}function mj(e){return typeof e=="number"}function Ni(e){return Array.isArray(e)?Ni(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":mj(e)?"float32":Rf(e)?"string":pj(e)?"bool":"float32"}function oh(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ih(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function pr(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function V0(e,t,n){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Xs(e)),n&&uj(e,t),function(s,o){return s instanceof Float32Array&&o==="float32"||s instanceof Int32Array&&o==="int32"||s instanceof Uint8Array&&o==="bool"}(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){for(var r=new Uint8Array(e.length),a=0;a<r.length;++a)Math.round(e[a])!==0&&(r[a]=1);return r}throw new Error("Unknown data type "+t)}function og(e,t){if(e.length===0)return t[0];var n=e.reduce(function(r,a){return r*a});if(n===0)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function r(a,s,o){var l=new Array;if(s.length===1)for(var c=s[0],u=0;u<c;u++)l[u]=o[a+u];else{c=s[0];var d=s.slice(1),h=d.reduce(function(f,p){return f*p});for(u=0;u<c;u++)l[u]=r(a+u*h,d,o)}return l}(0,e,t)}function q0(e,t){for(var n=_i(e,t),r=0;r<n.length;r++)n[r]=1;return n}function _i(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+t)}function or(){return Z().platform.now()}function H0(e){e.forEach(function(t){P(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function gj(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",Z().platform.encode(e,t)}function ec(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",Z().platform.decode(e,t)}function ig(e,t,n){if(t===0)return 0;if(t===1)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function vj(e,t,n){if(t===0)return[];if(t===1)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}var xj=function(){function e(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new yj)}return e.prototype.profileKernel=function(t,n,r){var a,s=this,o=this.backendTimer.time(function(){a=r()});return a.forEach(function(l){l.data().then(function(c){(function(u,d,h){if(d!=="float32")return!1;for(var f=0;f<u.length;f++){var p=u[f];if(isNaN(p)||!isFinite(p))return console.warn("Found "+p+" in the result of '"+h+"'"),!0}})(c,l.dtype,t),o.then(function(u){var d="";u.getExtraProfileInfo!=null&&(d=u.getExtraProfileInfo()),s.logger.logKernelProfile(t,l,c,u.kernelMs,n,d)})})}),a},e}(),yj=function(){function e(){}return e.prototype.logKernelProfile=function(t,n,r,a,s,o){var l=typeof a=="number"?Ts(a+"ms",9):a.error,c=Ts(t,25),u=n.rank,d=n.size,h=Ts(n.shape.toString(),14),f="";for(var p in s){var m=s[p].shape||n.shape,x=m.length;f+=p+": "+x+"D "+(x>0?m:"")+" "}console.log("%c"+c+"	%c"+l+"	%c"+u+"D "+h+"	%c"+d+"	%c"+f+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),lg=20,yo=3,Eu=7;function bj(e,t,n,r){var a=pr(t),s=function(u,d,h,f){var p=be(d),m=f[f.length-1],x=new Array(m).fill(0),y=d.length,g=h==="complex64"?wo(u):u;if(y>1)for(var v=0;v<p/m;v++)for(var w=v*m,b=0;b<m;b++)x[b]=Math.max(x[b],bo(g[w+b],0,h).length);return x}(e,t,n,a),o=t.length,l=function u(d,h,f,p,m,x){x===void 0&&(x=!0);var y=f==="complex64"?2:1,g=h[0],v=h.length;if(v===0)return f==="complex64"?[bo(wo(d)[0],0,f)]:f==="bool"?[G0(d[0])]:[d[0].toString()];if(v===1){if(g>lg){var w=yo*y,b=Array.from(d.slice(0,w)),N=Array.from(d.slice((g-yo)*y,g*y));return f==="complex64"&&(b=wo(b),N=wo(N)),["["+b.map(function(O,U){return bo(O,m[U],f)}).join(", ")+", ..., "+N.map(function(O,U){return bo(O,m[g-yo+U],f)}).join(", ")+"]"]}return["["+(f==="complex64"?wo(d):Array.from(d)).map(function(O,U){return bo(O,m[U],f)}).join(", ")+"]"]}var _=h.slice(1),k=p.slice(1),j=p[0]*y,C=[];if(g>lg){for(var S=0;S<yo;S++){var M=(T=S*j)+j;C.push.apply(C,u(d.slice(T,M),_,f,k,m,!1))}for(C.push("..."),S=g-yo;S<g;S++)M=(T=S*j)+j,C.push.apply(C,u(d.slice(T,M),_,f,k,m,S===g-1))}else for(S=0;S<g;S++){var T;M=(T=S*j)+j,C.push.apply(C,u(d.slice(T,M),_,f,k,m,S===g-1))}var A=v===2?",":"";for(C[0]="["+C[0]+A,S=1;S<C.length-1;S++)C[S]=" "+C[S]+A;var L=",\n";for(S=2;S<v;S++)L+="\n";return C[C.length-1]=" "+C[C.length-1]+"]"+(x?"":L),C}(e,t,n,a,s),c=["Tensor"];return r&&(c.push("  dtype: "+n),c.push("  rank: "+o),c.push("  shape: ["+t+"]"),c.push("  values:")),c.push(l.map(function(u){return"    "+u}).join("\n")),c.join("\n")}function bo(e,t,n){return Ts(Array.isArray(e)?parseFloat(e[0].toFixed(Eu))+" + "+parseFloat(e[1].toFixed(Eu))+"j":Rf(e)?"'"+e+"'":n==="bool"?G0(e):parseFloat(e.toFixed(Eu)).toString(),t)}function G0(e){return e===0?"false":"true"}function wo(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var di=function(){function e(t,n,r){var a=this;if(this.dtype=n,this.shape=t.slice(),this.size=be(t),r!=null){var s=r.length;P(s===this.size,function(){return"Length of values '"+s+"' does not match the size inferred by the shape '"+a.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Zl(n,this.size),this.strides=pr(t)}return e.prototype.set=function(t){for(var n=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),P(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var s=this.locToIndex(r);this.values[s]=t},e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length===0&&(t=[0]);for(var r=0,a=0,s=t;a<s.length;a++){var o=s[a];if(o<0||o>=this.shape[r]){var l="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(l)}r++}for(var c=t[t.length-1],u=0;u<t.length-1;++u)c+=this.strides[u]*t[u];return this.values[c]},e.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n},e.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return lr().makeTensor(this.values,this.shape,this.dtype)},e}(),lr=null,Q=null,K0=null,at=function(){function e(t,n,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=be(t),this.strides=pr(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),P(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(t,n){return this.throwIfDisposed(),this.reshape([t,n])},e.prototype.as3D=function(t,n,r){return this.throwIfDisposed(),this.reshape([t,n,r])},e.prototype.as4D=function(t,n,r,a){return this.throwIfDisposed(),this.reshape([t,n,r,a])},e.prototype.as5D=function(t,n,r,a,s){return this.throwIfDisposed(),this.reshape([t,n,r,a,s])},e.prototype.asType=function(t){return this.throwIfDisposed(),Q.cast(this,t)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return xe(this,void 0,void 0,function(){var t;return ye(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,Q.buffer(this.shape,this.dtype,t)]}})})},e.prototype.bufferSync=function(){return Q.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return xe(this,void 0,void 0,function(){var t;return ye(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,og(this.shape,t)]}})})},e.prototype.arraySync=function(){return og(this.shape,this.dataSync())},e.prototype.data=function(){return xe(this,void 0,void 0,function(){var t,n;return ye(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=lr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:n=r.sent();try{return[2,n.map(function(a){return ec(a)})]}catch(a){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var t=lr().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(n){return ec(n)})}catch(n){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},e.prototype.bytes=function(){return xe(this,void 0,void 0,function(){var t;return ye(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,lr().read(this.dataId)];case 1:return t=n.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(lr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(t){return t===void 0&&(t=!1),Q.print(this,t)},e.prototype.reshape=function(t){return this.throwIfDisposed(),Q.reshape(this,t)},e.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},e.prototype.expandDims=function(t){return t===void 0&&(t=0),Q.expandDims(this,t)},e.prototype.cumsum=function(t,n,r){return t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1),Q.cumsum(this,t,n,r)},e.prototype.squeeze=function(t){return this.throwIfDisposed(),Q.squeeze(this,t)},e.prototype.clone=function(){return this.throwIfDisposed(),Q.clone(this)},e.prototype.oneHot=function(t,n,r){return this.throwIfDisposed(),Q.oneHot(this,t,n,r)},e.prototype.toString=function(t){return t===void 0&&(t=!1),bj(this.dataSync(),this.shape,this.dtype,t)},e.prototype.tile=function(t){return this.throwIfDisposed(),Q.tile(this,t)},e.prototype.gather=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),Q.gather(this,t,n)},e.prototype.matMul=function(t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Q.matMul(this,t,n,r)},e.prototype.dot=function(t){return this.throwIfDisposed(),Q.dot(this,t)},e.prototype.norm=function(t,n,r){return t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),Q.norm(this,t,n,r)},e.prototype.slice=function(t,n){return this.throwIfDisposed(),Q.slice(this,t,n)},e.prototype.reverse=function(t){return this.throwIfDisposed(),Q.reverse(this,t)},e.prototype.concat=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),Q.concat([this].concat(t),n)},e.prototype.split=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),Q.split(this,t,n)},e.prototype.stack=function(t,n){return n===void 0&&(n=0),Q.stack([this,t],n)},e.prototype.unstack=function(t){return t===void 0&&(t=0),Q.unstack(this,t)},e.prototype.pad=function(t,n){return n===void 0&&(n=0),Q.pad(this,t,n)},e.prototype.batchNormalization=function(t,n,r,a,s){return r===void 0&&(r=.001),K0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,n,s,a,r)},e.prototype.batchNorm=function(t,n,r,a,s){return s===void 0&&(s=.001),this.throwIfDisposed(),Q.batchNorm(this,t,n,r,a,s)},e.prototype.all=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Q.all(this,t,n)},e.prototype.any=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Q.any(this,t,n)},e.prototype.logSumExp=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Q.logSumExp(this,t,n)},e.prototype.sum=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Q.sum(this,t,n)},e.prototype.prod=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Q.prod(this,t,n)},e.prototype.mean=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Q.mean(this,t,n)},e.prototype.min=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Q.min(this,t,n)},e.prototype.max=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Q.max(this,t,n)},e.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),Q.argMin(this,t)},e.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),Q.argMax(this,t)},e.prototype.cast=function(t){return this.throwIfDisposed(),Q.cast(this,t)},e.prototype.add=function(t){return this.throwIfDisposed(),Q.add(this,t)},e.prototype.addStrict=function(t){return this.throwIfDisposed(),Q.addStrict(this,t)},e.prototype.atan2=function(t){return this.throwIfDisposed(),Q.atan2(this,t)},e.prototype.sub=function(t){return this.throwIfDisposed(),Q.sub(this,t)},e.prototype.subStrict=function(t){return this.throwIfDisposed(),Q.subStrict(this,t)},e.prototype.pow=function(t){return this.throwIfDisposed(),Q.pow(this,t)},e.prototype.powStrict=function(t){return this.throwIfDisposed(),Q.powStrict(this,t)},e.prototype.mul=function(t){return this.throwIfDisposed(),Q.mul(this,t)},e.prototype.mulStrict=function(t){return this.throwIfDisposed(),Q.mulStrict(this,t)},e.prototype.div=function(t){return this.throwIfDisposed(),Q.div(this,t)},e.prototype.divNoNan=function(t){return this.throwIfDisposed(),Q.divNoNan(this,t)},e.prototype.floorDiv=function(t){return this.throwIfDisposed(),Q.floorDiv(this,t)},e.prototype.divStrict=function(t){return this.throwIfDisposed(),Q.divStrict(this,t)},e.prototype.minimum=function(t){return this.throwIfDisposed(),Q.minimum(this,t)},e.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Q.minimumStrict(this,t)},e.prototype.maximum=function(t){return this.throwIfDisposed(),Q.maximum(this,t)},e.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Q.maximumStrict(this,t)},e.prototype.mod=function(t){return this.throwIfDisposed(),Q.mod(this,t)},e.prototype.modStrict=function(t){return this.throwIfDisposed(),Q.modStrict(this,t)},e.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Q.squaredDifferenceStrict(this,t)},e.prototype.transpose=function(t){return this.throwIfDisposed(),Q.transpose(this,t)},e.prototype.notEqual=function(t){return this.throwIfDisposed(),Q.notEqual(this,t)},e.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Q.notEqualStrict(this,t)},e.prototype.less=function(t){return this.throwIfDisposed(),Q.less(this,t)},e.prototype.lessStrict=function(t){return this.throwIfDisposed(),Q.lessStrict(this,t)},e.prototype.equal=function(t){return this.throwIfDisposed(),Q.equal(this,t)},e.prototype.equalStrict=function(t){return this.throwIfDisposed(),Q.equalStrict(this,t)},e.prototype.lessEqual=function(t){return this.throwIfDisposed(),Q.lessEqual(this,t)},e.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Q.lessEqualStrict(this,t)},e.prototype.greater=function(t){return this.throwIfDisposed(),Q.greater(this,t)},e.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Q.greaterStrict(this,t)},e.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Q.greaterEqual(this,t)},e.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Q.greaterEqualStrict(this,t)},e.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Q.logicalAnd(this,t)},e.prototype.logicalOr=function(t){return this.throwIfDisposed(),Q.logicalOr(this,t)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),Q.logicalNot(this)},e.prototype.logicalXor=function(t){return this.throwIfDisposed(),Q.logicalXor(this,t)},e.prototype.where=function(t,n){return this.throwIfDisposed(),Q.where(t,this,n)},e.prototype.neg=function(){return this.throwIfDisposed(),Q.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),Q.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),Q.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),Q.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),Q.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),Q.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),Q.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),Q.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),Q.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),Q.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),Q.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),Q.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),Q.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),Q.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),Q.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),Q.abs(this)},e.prototype.clipByValue=function(t,n){return this.throwIfDisposed(),Q.clipByValue(this,t,n)},e.prototype.relu=function(){return this.throwIfDisposed(),Q.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),Q.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),Q.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),Q.selu(this)},e.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),Q.leakyRelu(this,t)},e.prototype.prelu=function(t){return this.throwIfDisposed(),Q.prelu(this,t)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),Q.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),Q.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),Q.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),Q.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),Q.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),Q.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),Q.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),Q.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),Q.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),Q.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),Q.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),Q.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),Q.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),Q.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),Q.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),Q.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),Q.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),Q.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),Q.round(this)},e.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),Q.step(this,t)},e.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),Q.softmax(this,t)},e.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),Q.logSoftmax(this,t)},e.prototype.resizeBilinear=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),Q.image.resizeBilinear(this,t,n)},e.prototype.resizeNearestNeighbor=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),Q.image.resizeNearestNeighbor(this,t,n)},e.prototype.conv1d=function(t,n,r,a,s,o){return a===void 0&&(a="NWC"),s===void 0&&(s=1),this.throwIfDisposed(),Q.conv1d(this,t,n,r,a,s,o)},e.prototype.conv2d=function(t,n,r,a,s,o){return a===void 0&&(a="NHWC"),s===void 0&&(s=[1,1]),this.throwIfDisposed(),Q.conv2d(this,t,n,r,a,s,o)},e.prototype.conv2dTranspose=function(t,n,r,a,s){return this.throwIfDisposed(),Q.conv2dTranspose(this,t,n,r,a,s)},e.prototype.depthwiseConv2D=function(t,n,r,a,s,o){return a===void 0&&(a="NHWC"),s===void 0&&(s=[1,1]),this.throwIfDisposed(),Q.depthwiseConv2d(this,t,n,r,a,s,o)},e.prototype.separableConv2d=function(t,n,r,a,s,o){return s===void 0&&(s=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),Q.separableConv2d(this,t,n,r,a,s,o)},e.prototype.avgPool=function(t,n,r,a){return this.throwIfDisposed(),Q.avgPool(this,t,n,r,a)},e.prototype.maxPool=function(t,n,r,a){return this.throwIfDisposed(),Q.maxPool(this,t,n,r,a)},e.prototype.localResponseNormalization=function(t,n,r,a){return t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),a===void 0&&(a=.5),Q.localResponseNormalization(this,t,n,r,a)},e.prototype.pool=function(t,n,r,a,s){return this.throwIfDisposed(),Q.pool(this,t,n,r,a,s)},e.prototype.variable=function(t,n,r){return t===void 0&&(t=!0),this.throwIfDisposed(),lr().makeVariable(this,t,n,r)},e.prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),Q.unsortedSegmentSum(this,t,n)},e.prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),Q.batchToSpaceND(this,t,n)},e.prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),Q.spaceToBatchND(this,t,n)},e.prototype.topk=function(t,n){return t===void 0&&(t=1),n===void 0&&(n=!0),this.throwIfDisposed(),Q.topk(this,t,n)},e.prototype.stridedSlice=function(t,n,r,a,s,o,l,c){return a===void 0&&(a=0),s===void 0&&(s=0),o===void 0&&(o=0),l===void 0&&(l=0),c===void 0&&(c=0),this.throwIfDisposed(),Q.stridedSlice(this,t,n,r,a,s,o,l,c)},e.prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),Q.depthToSpace(this,t,n)},e.prototype.fft=function(){return this.throwIfDisposed(),Q.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),Q.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),Q.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),Q.spectral.irfft(this)},e}();Object.defineProperty(at,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var cg,lh,ch,uh,dh,Ys=function(e){function t(n,r,a,s){var o=e.call(this,n.shape,n.dtype,n.dataId,s)||this;return o.trainable=r,o.name=a,o}return er(t,e),t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!It(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");lr().disposeTensor(this),this.dataId=n.dataId,lr().incRef(this,null)},t.prototype.dispose=function(){lr().disposeVariable(this),this.isDisposedInternal=!0},t}(at);Object.defineProperty(Ys,Symbol.hasInstance,{value:function(e){return e instanceof at&&e.assign!=null&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(cg||(cg={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(lh||(lh={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(ch||(ch={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(uh||(uh={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(dh||(dh={}));var wj={float32:uh,int32:lh,bool:ch,complex64:dh};function Ft(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error("Can not upcast "+e+" with "+t)}return wj[e][t]}function Ru(e){return Ft(e,"int32")}function lt(e,t){if(e.dtype===t.dtype)return[e,t];var n=Ft(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Nj(e,t){P(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function X0(e){var t=[];return function n(r,a,s){if(r!=null){if(r instanceof at)return void a.push(r);if(o=r,!(!Array.isArray(o)&&typeof o!="object")){var o,l=r;for(var c in l){var u=l[c];s.has(u)||(s.add(u),n(u,a,s))}}}}(e,t,new Set),t}var Du,ug=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},e}(),_j=function(){function e(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ug}return e.prototype.ready=function(){return xe(this,void 0,void 0,function(){var t,n,r;return ye(this,function(a){switch(a.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),n=0,a.label=1;case 1:return n<t.length?(r=t[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return a.sent()?[4,this.setBackend(r)]:[3,4];case 3:return a.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),n=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},e.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},e.prototype.registerBackend=function(t,n,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:n,priority:r},!0)},e.prototype.setBackend=function(t){return xe(this,void 0,void 0,function(){var n,r,a;return ye(this,function(s){switch(s.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return a=s.sent(),[3,3];case 2:a=r,s.label=3;case 3:if(!a)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new xj(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var t=this;ag(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(t.backendInstance)})},e.prototype.disposeRegisteredKernels=function(t){var n=this;ag(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[t])})},e.prototype.initializeBackend=function(t){var n=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var a=r.factory();if(Promise.resolve(a)===a){var s=++this.pendingBackendInitId,o=a.then(function(l){return!(s<n.pendingBackendInitId)&&(n.registry[t]=l,n.pendingBackendInit=null,!0)}).catch(function(l){return!(s<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(l.stack||l.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[t]=a,{success:!0,asyncInit:!1}}catch(l){return console.warn("Initialization of backend "+t+" failed"),console.warn(l.stack||l.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return t.registryFactory[r].priority-t.registryFactory[n].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),n=0;n<t.length;n++){var r=t[n],a=this.initializeBackend(r),s=a.success,o=a.asyncInit;if(o||s)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(t,n){var r=this.state.tensorInfo.get(n),a=r.backend,s=this.readSync(n);a.disposeData(n),r.backend=t,t.move(n,s,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(t,n){var r,a=this,s=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}return this.scopedRun(function(){return a.startScope(s)},function(){return a.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},e.prototype.scopedRun=function(t,n,r){t();try{var a=r();return n(),a}catch(s){throw n(),s}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(t){var n=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[n],function(a){return{x:function(){return a.toFloat()}}},[]),n},e.prototype.runKernel=function(t,n,r,a,s){return this.runKernelFunc(null,n,null,t,r,a,s)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(t,n,r){var a=this.backend.numDataIds(),s=0;r.forEach(function(c){s+=c.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=a-n-s-o;if(l>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+l+" data ids) after running '"+t+"'")},e.prototype.runKernelFunc=function(t,n,r,a,s,o,l){var c,u=this;o===void 0&&(o=[]),l===void 0&&(l=[]);var d=[],h=this.isTapeOn();a==null&&(a=this.state.activeScope!=null?this.state.activeScope.name:"");var f,p=function(v){h&&(d=v.map(function(w){return u.keep(u.clone(w))}))},m=this.state.numBytes,x=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var y,g=B0(a,this.backendName);return f=g!=null?function(){var v=u.backend.numDataIds();y=g.kernelFunc({inputs:n,attrs:s,backend:u.backend});var w=Array.isArray(y)?y:[y];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(a,v,w);var b=w.map(function(_){var k=_.dataId,j=_.shape,C=_.dtype;return u.makeTensorFromDataId(k,j,C)}),N=b.filter(function(_,k){return l[k]});return p((o||[]).slice().concat(N)),b}:function(){var v=u.backend.numDataIds();y=u.tidy(function(){return t(u.backend,p)});var w=Array.isArray(y)?y:[y];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(a,v,w),w},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){c=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(a,n,function(){return f()}):f()}),h&&this.addTapeNode(a,n,c,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:a,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-x,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(v){return n[v].shape}),outputShapes:c.map(function(v){return v.shape})}),Array.isArray(y)?c:c[0]},e.prototype.makeTensor=function(t,n,r,a){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var s=t;r==="string"&&Rf(t[0])&&(s=t.map(function(d){return gj(d)}));var o=a.write(s,n,r),l=new at(n,r,o,this.nextTensorId());if(this.incRef(l,a),r==="string"){var c=this.state.tensorInfo.get(o),u=fj(s);this.state.numBytes+=u-c.bytes,c.bytes=u}return l},e.prototype.makeTensorFromDataId=function(t,n,r,a){var s=new at(n,r=r||"float32",t,this.nextTensorId());return this.incRef(s,a),s},e.prototype.makeVariable=function(t,n,r,a){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==t.dtype&&(t=t.asType(a));var s=new Ys(t,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error("Variable with name "+s.name+" was already registered");return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s},e.prototype.incRef=function(t,n){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var a=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(a=t.size*U0(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:a,refCount:0}),this.state.numBytes+=a}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Ys||this.track(t)},e.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(t.dataId);n.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var n=this.state.registeredVariables[t];this.disposeVariable(n)}},e.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},e.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},e.prototype.profile=function(t){return xe(this,void 0,void 0,function(){var n,r;return ye(this,function(a){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(s){return s.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(t,n,r,a,s){var o=this,l={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:s},c=sj(t);c!=null&&(a=c.gradFunc),a!=null&&(l.gradient=function(u){return u=u.map(function(d,h){if(d==null){var f=r[h],p=_i(f.size,f.dtype);return o.makeTensor(p,f.shape,f.dtype)}return d}),a(u.length>1?u:u[0],s)}),this.state.activeTape.push(l)},e.prototype.keep=function(t){return t.kept=!0,t},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(t){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n},e.prototype.endScope=function(t){for(var n=this,r=X0(t),a=new Set(r.map(function(c){return c.id})),s=0;s<this.state.activeScope.track.length;s++){var o=this.state.activeScope.track[s];o.kept||a.has(o.id)||o.dispose()}var l=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(c){c.kept||c.scopeId!==l.id||n.track(c)})},e.prototype.gradients=function(t,n,r,a){var s=this;if(a===void 0&&(a=!1),P(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun(function(){return s.startTape()},function(){return s.endTape()},function(){return s.tidy("forward",t)});P(o instanceof at,function(){return"The result y returned by f() must be a tensor."});var l=function(c,u,d){for(var h={},f={},p=0;p<u.length;p++)h[u[p].id]=!0;for(p=0;p<c.length;p++){var m=(_=c[p]).inputs;for(var x in m){for(var y=m[x],g=!1,v=0;v<u.length;v++)if(h[y.id]){_.outputs.forEach(function(S){return h[S.id]=!0}),g=!0,f[_.id]=!0;break}if(g)break}}var w={};w[d.id]=!0;var b={};for(p=c.length-1;p>=0;p--)for(m=(_=c[p]).inputs,v=0;v<_.outputs.length;v++)if(w[_.outputs[v].id]){for(var x in m)w[m[x].id]=!0,b[_.id]=!0;break}var N=[];for(p=0;p<c.length;p++){var _;if(f[(_=c[p]).id]&&b[_.id]){var k={};for(var x in _.inputs){var j=_.inputs[x];h[j.id]&&(k[x]=j)}var C=Object.assign({},_);C.inputs=k,C.outputs=_.outputs,N.push(C)}}return N}(this.state.activeTape,n,o);if(!a&&l.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var c,u,d={};d[o.id]=r==null?(c=o.shape,u=q0(be(c),"float32"),V.makeTensor(u,c,"float32")):r,function(f,p,m){for(var x=function(g){var v=p[g],w=[];if(v.outputs.forEach(function(k){var j=f[k.id];j!=null?w.push(j):w.push(null)}),v.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+v.kernelName+".");var b=v.gradient(w),N=function(k){if(!(k in b))throw new Error("Cannot backprop through input "+k+". Available gradients found: "+Object.keys(b)+".");var j=m(function(){return b[k]()});if(j.dtype!=="float32")throw new Error("Error in gradient for op "+v.kernelName+". The gradient of input "+k+" must have 'float32' dtype, but has '"+j.dtype+"'");var C=v.inputs[k];if(!It(j.shape,C.shape))throw new Error("Error in gradient for op "+v.kernelName+". The gradient of input '"+k+"' has shape '"+j.shape+"', which does not match the shape of the input '"+C.shape+"'");if(f[C.id]==null)f[C.id]=j;else{var S=f[C.id];f[C.id]=S.add(j),S.dispose()}};for(var _ in v.inputs)N(_)},y=p.length-1;y>=0;y--)x(y)}(d,l,function(f){return s.tidy(f)});var h=n.map(function(f){return d[f.id]});return s.state.gradientDepth===0&&(s.state.activeTape.forEach(function(f){for(var p=0,m=f.saved;p<m.length;p++)m[p].dispose()}),s.state.activeTape=null),{value:o,grads:h}})},e.prototype.customGrad=function(t){var n=this;return P(oh(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];P(a.every(function(l){return l instanceof at}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return a.forEach(function(l,c){o[c]=l}),n.runKernelFunc(function(l,c){return P((r=t.apply(void 0,a.concat([c]))).value instanceof at,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),P(oh(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},o,function(l,c){var u=r.gradFunc(l,c),d=Array.isArray(u)?u:[u];P(d.length===a.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),P(d.every(function(f){return f instanceof at}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return d.forEach(function(f,p){h[p]=function(){return f}}),h})}},e.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},e.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},e.prototype.time=function(t){return xe(this,void 0,void 0,function(){var n,r;return ye(this,function(a){switch(a.label){case 0:return n=or(),[4,this.backend.time(t)];case 1:return(r=a.sent()).wallMs=or()-n,[2,r]}})})},e.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ug,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),V=function(){var e=function(){if(Du==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}Du=n}return Du}();if(e._tfengine==null){var t=new rj(e);e._tfengine=new _j(t)}return function(n){L0=n}(e._tfengine.ENV),lr=function(){return e._tfengine},e._tfengine}();function Y0(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Nr=Z();Nr.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Nr.registerFlag("IS_BROWSER",function(){return Y0()}),Nr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Nr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Nr.registerFlag("PROD",function(){return!1}),Nr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Nr.getBool("DEBUG")}),Nr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Nr.registerFlag("IS_TEST",function(){return!1});var hi,wn,yn,Da={},Iu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function jj(e,t){Da[e]=t}function vr(e){e in Da||(Da[e]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(a){if(typeof OffscreenCanvas<"u"&&a===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(a){a.preventDefault(),delete Da[n]},!1),n===1?r.getContext("webgl",Iu)||r.getContext("experimental-webgl",Iu):r.getContext("webgl2",Iu)}(e));var t=Da[e];return t.isContextLost()?(delete Da[e],vr(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Da[e])}function Lc(e,t){return[t,e]}function Mo(e){var t=be(e);return sh(Math.ceil(t/4))}function ji(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Df(e,t){var n,r,a,s,o,l,c,u,d,h=e;return Z().getNumber("WEBGL_VERSION")===2?(n=h.R32F,r=h.R16F,a=h.RGBA16F,s=h.RGBA32F,o=h.RED,l=4,c=1,u=h.HALF_FLOAT,d=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,s=h.RGBA,o=e.RGBA,l=4,c=4,u=t!=null?t.HALF_FLOAT_OES:null,d=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:s,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:u,textureTypeFloat:d}}function we(e,t,n){var r=n();return t&&function(a){var s=a.getError();if(s!==a.NO_ERROR)throw new Error("WebGL Error: "+Ej(a,s))}(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(hi||(hi={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(wn||(wn={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(yn||(yn={}));var kj=596e-10,Cj=65504;function Sj(e){return!!(Z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||kj<Math.abs(e)&&Math.abs(e)<Cj)}function Ej(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Xi(e,t,n){return Or(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function Rj(e,t,n){var r=Or(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(we(e,t,function(){return e.shaderSource(r,n)}),we(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Dj(e,t,n){var r=Or(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(we(e,t,function(){return e.shaderSource(r,n)}),we(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw function(a,s){var o=Ij.exec(s);if(o==null)return console.log("Couldn't parse line number in error: "+s),void console.log(a);for(var l=+o[1],c=a.split("\n"),u=c.length.toString().length+2,d=c.map(function(y,g){return Ts((g+1).toString(),u)+y}),h=0,f=0;f<d.length;f++)h=Math.max(d[f].length,h);var p=d.slice(0,l-1),m=d.slice(l-1,l),x=d.slice(l);console.log(p.join("\n")),console.log(s.split("\n")[0]),console.log("%c "+Ts(m[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(x.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Au,Tu,Ij=/ERROR: [0-9]+:([0-9]+):/g;function Aj(e,t){return Or(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function Tj(e,t,n){if(we(e,t,function(){return e.linkProgram(n)}),e.getProgramParameter(n,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Pu(e,t,n){if(we(e,t,function(){return e.validateProgram(n)}),e.getProgramParameter(n,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function Pj(e,t,n){var r=Or(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return we(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),we(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Fj(e,t,n){var r=Or(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return we(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),we(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Mj(e,t){return Or(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function Oj(e,t){var n=Z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function Lj(e,t){return Or(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function dg(e,t,n,r,a,s,o,l){var c=e.getAttribLocation(n,r);return c!==-1&&(we(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,a)}),we(e,t,function(){return e.vertexAttribPointer(c,s,e.FLOAT,!1,o,l)}),we(e,t,function(){return e.enableVertexAttribArray(c)}),!0)}function Bj(e,t,n,r){Vj(e,r),we(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),we(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function Wj(e,t,n,r){return Or(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function $j(e,t,n){return e.getUniformLocation(t,n)}function zj(e,t,n,r,a,s){we(e,t,function(){return Bj(e,t,r,s)}),we(e,t,function(){return e.uniform1i(a,s)})}function Fu(e,t,n,r){we(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),we(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function hg(e,t,n){we(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),we(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Yi(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Uj(e,t))}function Uj(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Or(e,t,n,r){var a=we(e,t,function(){return n()});if(a==null)throw new Error(r);return a}function Vj(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function tc(e,t){return t===void 0&&(t=2),be(e.slice(0,e.length-t))}function nc(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Mu(e){var t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[tc(e)].concat(nc(e))),t}function qj(e,t){var n;t===void 0&&(t=!1);var r=Z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(e=e.map(function(u,d){return d>=e.length-2?z0(e[d]):e[d]})).length===1&&(e=[2,e[0]])),e.length!==2){var a=Aa(e);e=a.newShape}var s=be(e);if(e.length<=1&&s<=r)return[1,s];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=tc(e),l=2,c=2;return e.length&&(l=(n=nc(e))[0],c=n[1]),sh(s=o*(l/2)*(c/2)).map(function(u){return 2*u})}return sh(s)}function Qi(e){return e%2==0}function Ji(e,t){if(It(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||Qi(n)&&Qi(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&Qi(e[0])&&Qi(t[0])}function Hj(e){if(Au==null){var t=vr(e);Au=t.getParameter(t.MAX_TEXTURE_SIZE)}return Au}function Gj(e){if(Tu==null){var t=vr(e);Tu=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Tu)}function Kj(e){if(e===0)return 0;var t=vr(e);return Mn(t,"EXT_disjoint_timer_query_webgl2")&&e===2?2:Mn(t,"EXT_disjoint_timer_query")?1:0}function Mn(e,t){return e.getExtension(t)!=null}function fg(e){try{if(vr(e)!=null)return!0}catch(t){return!1}return!1}function Xj(e){if(e===0)return!1;var t=vr(e);if(e===1){if(!Mn(t,"OES_texture_float"))return!1}else if(!Mn(t,"EXT_color_buffer_float"))return!1;return hh(t)}function Yj(e){if(e===0)return!1;var t=vr(e);if(e!==1){if(Mn(t,"EXT_color_buffer_float"))return hh(t);if(Mn(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(r,a){var s=Df(r,a),o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,s.internalFormatHalfFloat,1,1,0,s.textureFormatFloat,s.textureTypeHalfFloat,null);var l=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,l),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0);var c=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(o),r.deleteFramebuffer(l),c}(t,n)}return!1}return!!Mn(t,"OES_texture_float")&&!!Mn(t,"WEBGL_color_buffer_float")&&hh(t)}function hh(e){var t=Df(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function Qj(e){return e===2&&vr(e).fenceSync!=null}var Ie=Z();function Q0(e){Z().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function pe(e,t){return V.tidy(e,t)}function hn(e){X0(e).forEach(function(t){return t.dispose()})}function Jj(e){return V.keep(e)}function rc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Z().getBool("IS_TEST")||console.warn.apply(console,e)}function _a(e,t){var n=e;if(fr(e))return t==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||fr(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&Z().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function a(s,o,l){if(l=l||[],!Array.isArray(s)&&!fr(s))return void P(o.length===0,function(){return"Element arr["+l.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});P(o.length>0,function(){return"Element arr["+l.join("][")+"] should be a primitive, but is an array of "+s.length+" elements"}),P(s.length===o[0],function(){return"Element arr["+l.join("][")+"] should have "+o[0]+" elements, but has "+s.length+" elements"});for(var c=o.slice(1),u=0;u<s.length;++u)a(s[u],c,l.concat(u))}(e,r,[]),r}function pg(e,t,n,r){if(e!=null&&(e!=="numeric"&&e!==t||e==="numeric"&&t==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function D(e,t,n,r){if(r===void 0&&(r="numeric"),e instanceof at)return pg(r,e.dtype,t,n),e;var a=Ni(e);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),pg(r,a,t,n),e==null||!fr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var s=e==null?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+s+"'")}var o=_a(e,a);fr(e)||Array.isArray(e)||(e=[e]);var l=a!=="string"?V0(e,a,Z().getBool("DEBUG")):Xs(e,[],!0);return V.makeTensor(l,o,a)}function ac(e,t,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(a,s){return D(a,t+"["+s+"]",n)},r)}function J0(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Zj(e,t,n){for(var r=e.length+t.length,a=[],s=0,o=0,l=0;l<r;l++)n.indexOf(l)===-1?a.push(e[s++]):a.push(t[o++]);return a}function zt(e,t){for(var n=[],r=e.length,a=0;a<r;a++)t.indexOf(a)===-1&&n.push(e[a]);return[n,t.map(function(s){return e[s]})]}function fn(e,t){return Zj(e,t.map(function(n){return 1}),t)}function vn(e,t,n){P(J0(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function xr(e,t){if(J0(e,t))return null;for(var n=[],r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(function(a){return n.push(a)}),n}function If(e){return e.map(function(t,n){return[n,t]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})}function yr(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function ek(e,t){var n=e[0].length;e.forEach(function(a,s){P(a.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+s+"] must be the same as the rank of the rest ("+n+")"})}),P(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(a,s){for(var o=0;o<n;o++)P(o===t||a[o]===r[o],function(){return"Error in concat"+n+"D: Shape of tensors["+s+"] ("+a+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+s+"."})})}function Qs(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function B(e){var t=Object.keys(e);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];V.startScope(n);try{var l=r.apply(void 0,s);return l instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),V.endScope(l),l}catch(c){throw V.endScope(null),c}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}Ie.registerFlag("HAS_WEBGL",function(){return Ie.getNumber("WEBGL_VERSION")>0}),Ie.registerFlag("WEBGL_VERSION",function(){return fg(2)?2:fg(1)?1:0}),Ie.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ie.get("WEBGL_VERSION")===2}),Ie.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Ie.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Ie.registerFlag("WEBGL_PACK",function(){return Ie.getBool("HAS_WEBGL")}),Ie.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_CLIP",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Ie.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_PACK_REDUCE",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_CONV_IM2COL",function(){return Ie.getBool("WEBGL_PACK")}),Ie.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Hj(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Gj(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=Ie.getNumber("WEBGL_VERSION");return e===0?0:Kj(e)}),Ie.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ie.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),Ie.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Xj(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Ie.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ie.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Ie.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Yj(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Qj(Ie.getNumber("WEBGL_VERSION"))}),Ie.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Ie.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),K0=Q0;var Pt=B({complex_:function(e,t){var n=D(e,"real","complex"),r=D(t,"imag","complex");return qe(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),V.runKernelFunc(function(a){return a.complex(n,r)},{$real:n,$imag:r})}}),Pn=B({real_:function(e){var t=D(e,"input","real");return V.runKernelFunc(function(n){return n.real(t)},{$input:t})}}),cr=B({imag_:function(e){var t=D(e,"input","imag");return V.runKernelFunc(function(n){return n.imag(t)},{$input:t})}});function Mt(e,t,n){return ja(e,t,_a(e,n),n)}function ja(e,t,n,r){if(r==null&&(r=Ni(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!fr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){H0(t);var a=be(t),s=be(n);P(a===s,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+s});for(var o=0;o<n.length;++o){var l=n[o],c=o!==n.length-1||l!==be(t.slice(o));P(n[o]===t[o]||!c,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return fr(e)||Array.isArray(e)||(e=[e]),t=t||n,e=r!=="string"?V0(e,r,Z().getBool("DEBUG")):Xs(e,[],!0),V.makeTensor(e,t,r)}function de(e,t){if((fr(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&fr(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ja(e,[],[],t)}function vt(e,t){so(e);var n=_a(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ja(e,null,n,t)}function ha(e,t,n){if(so(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=_a(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ja(e,t,r,n)}function Af(e,t,n){if(so(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=_a(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ja(e,t,r,n)}function sn(e,t,n){if(so(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=_a(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ja(e,t,r,n)}function tk(e,t,n){if(so(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=_a(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ja(e,t,r,n)}function nk(e,t,n){if(so(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=_a(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ja(e,t=t||r,r,n)}function rk(e,t,n,r){return t===void 0&&(t=!0),V.makeVariable(e,t,n,r)}function oo(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=oo(e,"float32"),r=Ye(e,"float32");return Pt(n,r)}var a=q0(be(e),t);return V.makeTensor(a,e,t)}function Ye(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Ye(e,"float32"),r=Ye(e,"float32");return Pt(n,r)}var a=_i(be(e),t);return V.makeTensor(a,e,t)}function mr(e,t,n){return V.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function ak(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return V.runKernelFunc(function(r){return r.linspace(e,t,n)},{})}function sc(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Ye([0],r);var a=_i(Math.abs(Math.ceil((t-e)/n)),r);t<e&&n===1&&(n=-1),a[0]=e;for(var s=1;s<a.length;s++)a[s]=a[s-1]+n;return vt(a,r)}var Z0=B({onesLike_:function(e){var t=D(e,"x","onesLike");if(t.dtype==="complex64"){var n=Z0(Pn(t)),r=ze(cr(t));return Pt(n,r)}return V.runKernelFunc(function(a){return a.onesLike(t)},{$x:t},function(a,s){return{$x:function(){return ze(a)}}})}}),ze=B({zerosLike_:function(e){var t=D(e,"x","zerosLike");return V.runKernelFunc(function(n){return n.zerosLike(t)},{$x:t},function(n,r){return{$x:function(){return ze(n)}}})}}),wt=B({concat_:function(e,t){t===void 0&&(t=0),P(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=ac(e,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(l){if(l.dtype!=="complex64")throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+l.dtype+". ")}),t=kt(t,n[0].shape)[0];var r=Qs(n.map(function(l){return l.shape}),t);if(be(r)===0)return Mt([],r);if((n=n.filter(function(l){return l.size>0})).length===1)return n[0];var a=n.map(function(l){return l.shape});ek(a,t);var s=n,o={axis:t};return V.runKernelFunc(function(l){return l.concat(n,t)},s,function(l){var c=a.map(function(u){return u[t]});return Tf(l,c,t).map(function(u){return function(){return u}})},"Concat",o)}}),sk=B({concat1d_:function(e){return wt(e,0)}}),ok=B({concat2d_:function(e,t){return wt(e,t)}}),ik=B({concat3d_:function(e,t){return wt(e,t)}}),lk=B({concat4d_:function(e,t){return wt(e,t)}}),Tf=B({split_:function(e,t,n){n===void 0&&(n=0);var r,a=D(e,"x","split");return n=kt(n,a.shape)[0],typeof t=="number"?(P(a.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(a.shape[n]/t)):(P(a.shape[n]===t.reduce(function(s,o){return s+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),V.runKernelFunc(function(s){return s.split(a,r,n)},{$x:a},function(s){return{$x:function(){return wt(s,n)}}})}});function Ja(e,t){return e(t={exports:{}},t.exports),t.exports}var ck=Ja(function(e){(function(t,n,r){function a(l){var c,u=this,d=(c=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var p=.02519603282416938*(c+=h.charCodeAt(f));p-=c=p>>>0,c=(p*=c)>>>0,c+=4294967296*(p-=c)}return 23283064365386963e-26*(c>>>0)});u.next=function(){var h=2091639*u.s0+23283064365386963e-26*u.c;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=0|h)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function s(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var u=new a(l),d=c&&c.state,h=u.next;return h.int32=function(){return 4294967296*u.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(0,e,!1)}),uk=Ja(function(e){(function(t,n,r){function a(l){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},l===(0|l)?c.x=l:u+=l;for(var d=0;d<u.length+64;d++)c.x^=0|u.charCodeAt(d),c.next()}function s(l,c){return c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,c}function o(l,c){var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(0,e,!1)}),dk=Ja(function(e){(function(t,n,r){function a(l){var c=this,u="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^h^h<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,l===(0|l)?c.x=l:u+=l;for(var d=0;d<u.length+64;d++)c.x^=0|u.charCodeAt(d),d==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function s(l,c){return c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,c.v=l.v,c.d=l.d,c}function o(l,c){var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(0,e,!1)}),hk=Ja(function(e){(function(t,n,r){function a(l){var c=this;c.next=function(){var u,d,h=c.x,f=c.i;return u=h[f],d=(u^=u>>>7)^u<<24,d^=(u=h[f+1&7])^u>>>10,d^=(u=h[f+3&7])^u>>>3,d^=(u=h[f+4&7])^u<<7,u=h[f+7&7],d^=(u^=u<<13)^u<<9,h[f]=d,c.i=f+1&7,d},function(u,d){var h,f=[];if(d===(0|d))f[0]=d;else for(d=""+d,h=0;h<d.length;++h)f[7&h]=f[7&h]<<15^d.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],u.x=f,u.i=0,h=256;h>0;--h)u.next()}(c,l)}function s(l,c){return c.x=l.x.slice(),c.i=l.i,c}function o(l,c){l==null&&(l=+new Date);var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(d.x&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(0,e,!1)}),fk=Ja(function(e){(function(t,n,r){function a(l){var c=this;c.next=function(){var u,d,h=c.w,f=c.X,p=c.i;return c.w=h=h+1640531527|0,d=f[p+34&127],u=f[p=p+1&127],d^=d<<13,u^=u<<17,d^=d>>>15,u^=u>>>12,d=f[p]=d^u,c.i=p,d+(h^h>>>16)|0},function(u,d){var h,f,p,m,x,y=[],g=128;for(d===(0|d)?(f=d,d=null):(d+="\0",f=0,g=Math.max(g,d.length)),p=0,m=-32;m<g;++m)d&&(f^=d.charCodeAt((m+32)%d.length)),m===0&&(x=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(x=x+1640531527|0,p=(h=y[127&m]^=f+x)==0?p+1:0);for(p>=128&&(y[127&(d&&d.length||0)]=-1),p=127,m=512;m>0;--m)f=y[p+34&127],h=y[p=p+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,y[p]=f^h;u.w=x,u.X=y,u.i=p}(c,l)}function s(l,c){return c.i=l.i,c.w=l.w,c.X=l.X.slice(),c}function o(l,c){l==null&&(l=+new Date);var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(d.X&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(0,e,!1)}),pk=Ja(function(e){(function(t,n,r){function a(l){var c=this,u="";c.next=function(){var h=c.b,f=c.c,p=c.d,m=c.a;return h=h<<25^h>>>7^f,f=f-p|0,p=p<<24^p>>>8^m,m=m-h|0,c.b=h=h<<20^h>>>12^f,c.c=f=f-p|0,c.d=p<<16^f>>>16^m,c.a=m-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,l===Math.floor(l)?(c.a=l/4294967296|0,c.b=0|l):u+=l;for(var d=0;d<u.length+20;d++)c.b^=0|u.charCodeAt(d),c.next()}function s(l,c){return c.a=l.a,c.b=l.b,c.c=l.c,c.d=l.d,c}function o(l,c){var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(0,e,!1)}),Ia=Ja(function(e){(function(t,n){var r,a=this,s=256,o=6,l="random",c=n.pow(s,o),u=n.pow(2,52),d=2*u,h=s-1;function f(g,v,w){var b=[],N=x(function j(C,S){var M,T=[],A=typeof C;if(S&&A=="object")for(M in C)try{T.push(j(C[M],S-1))}catch(L){}return T.length?T:A=="string"?C:C+"\0"}((v=v==1?{entropy:!0}:v||{}).entropy?[g,y(t)]:g==null?function(){try{var j;return r&&(j=r.randomBytes)?j=j(s):(j=new Uint8Array(s),(a.crypto||a.msCrypto).getRandomValues(j)),y(j)}catch(M){var C=a.navigator,S=C&&C.plugins;return[+new Date,a,S,a.screen,y(t)]}}():g,3),b),_=new p(b),k=function(){for(var j=_.g(o),C=c,S=0;j<u;)j=(j+S)*s,C*=s,S=_.g(1);for(;j>=d;)j/=2,C/=2,S>>>=1;return(j+S)/C};return k.int32=function(){return 0|_.g(4)},k.quick=function(){return _.g(4)/4294967296},k.double=k,x(y(_.S),t),(v.pass||w||function(j,C,S,M){return M&&(M.S&&m(M,_),j.state=function(){return m(_,{})}),S?(n[l]=j,C):j})(k,N,"global"in v?v.global:this==n,v.state)}function p(g){var v,w=g.length,b=this,N=0,_=b.i=b.j=0,k=b.S=[];for(w||(g=[w++]);N<s;)k[N]=N++;for(N=0;N<s;N++)k[N]=k[_=h&_+g[N%w]+(v=k[N])],k[_]=v;(b.g=function(j){for(var C,S=0,M=b.i,T=b.j,A=b.S;j--;)C=A[M=h&M+1],S=S*s+A[h&(A[M]=A[T=h&T+C])+(A[T]=C)];return b.i=M,b.j=T,S})(s)}function m(g,v){return v.i=g.i,v.j=g.j,v.S=g.S.slice(),v}function x(g,v){for(var w,b=g+"",N=0;N<b.length;)v[h&N]=h&(w^=19*v[h&N])+b.charCodeAt(N++);return y(v)}function y(g){return String.fromCharCode.apply(0,g)}if(n["seed"+l]=f,x(n.random(),t),e.exports){e.exports=f;try{r=require("crypto")}catch(g){}}})([],Math)});Ia.alea=ck,Ia.xor128=uk,Ia.xorwow=dk,Ia.xorshift7=hk,Ia.xor4096=fk,Ia.tychei=pk;var Bc=Ia.alea,Pf=function(){function e(t,n,r,a,s){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=s||Math.random();this.random=Bc(o.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var n,r,a=!1;!a;){var s=void 0,o=void 0,l=void 0;do l=(s=2*this.random()-1)*s+(o=2*this.random()-1)*o;while(l>=1||l===0);var c=Math.sqrt(-2*Math.log(l)/l);n=this.mean+this.stdDev*s*c,r=this.mean+this.stdDev*o*c,this.truncated&&!this.isValidTruncated(n)||(a=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},e.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}(),mk=function(){function e(t,n,r,a){this.alpha=t,this.beta=1/n,this.dtype=r;var s=a||Math.random();this.randu=Bc(s.toString()),this.randn=new Pf(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var t,n,r,a,s,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,n=1-.331*(t=a*a)*t,r=.5*t+this.d*(1-o+Math.log(o)),(s=this.randu())<n||Math.log(s)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},e.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},e}(),gk=function(){function e(t,n,r,a){var s=this;if(t===void 0&&(t=0),n===void 0&&(n=1),this.canReturnFloat=function(){return s.dtype==null||s.dtype==="float32"},this.min=t,this.range=n-t,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+n+" <= 1 and dtype is not float");this.random=Bc(a)}return e.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Te(e,t,n){return t===void 0&&(t="float32"),t=t||"float32",H0(e),new di(e,t,n)}function vk(e,t){t===void 0&&(t=!1),console.log(e.toString(t))}var ey=B({batchToSpaceND_:function(e,t,n){var r=D(e,"x","batchToSpaceND"),a=t.reduce(function(s,o){return s*o});return P(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),P(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),P(r.shape[0]%a==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a}),V.runKernelFunc(function(s){return s.batchToSpaceND(r,t,n)},{$x:r},function(s){return{$x:function(){return s.spaceToBatchND(t,n)}}})}}),xk=B({broadcastTo_:function(e,t){var n=D(e,"broadcastTo","x"),r=n.shape;if(t.some(function(c){return!(c>0)||c%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=n.reshape(a)}for(var s=Array.from(t),o=t.length-1;o>=0;o--)if(n.shape[o]===t[o])s[o]=1;else if(n.shape[o]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var l=s.map(function(c,u){return c>1?u:-1}).filter(function(c){return c>=0});return l.length===0?n.clone():V.runKernelFunc(function(c){return c.tile(n,s)},{input:n},function(c){return{input:function(){return c.sum(l,!0)}}})}}),yk=B({cast_:function(e,t){var n=D(e,"x","cast");if(!dj(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return V.runKernelFunc(function(a){return a.cast(n,t)},{x:n},function(a){return{x:function(){return a.clone()}}},"Cast",r)}}),bk=B({clone_:function(e){var t=D(e,"x","clone",null);return V.runKernelFunc(function(){return V.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(n){return{$x:function(){return n.toFloat()}}})}}),wk=B({cumsum_:function(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var a=D(e,"x","cumsum"),s=xr([t|=0],a.rank),o=a;s!=null&&(o=a.transpose(s));var l=yr(1,a.rank)[0],c=V.runKernelFunc(function(u){return u.cumsum(o,l,n,r)},{permutedX:o},function(u){return{permutedX:function(){return u.cumsum(t,n,!r)}}});return s!=null&&(c=c.transpose(s)),c}}),Nk=B({depthToSpace_:function(e,t,n){n===void 0&&(n="NHWC");var r=D(e,"x","depthToSpace"),a=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],o=n==="NHWC"?r.shape[3]:r.shape[1];return P(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),P(s*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+s+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),P(o%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape}),V.runKernelFunc(function(l){return l.depthToSpace(r,t,n)},{$x:r})}}),Tn=B({expandDims_:function(e,t){t===void 0&&(t=0);var n=D(e,"x","expandDims",null);P(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(P(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),Kn(n,r)}}),ty=B({eye_:function(e,t,n,r){r===void 0&&(r="float32"),t==null&&(t=e);for(var a=Te([e,t],r),s=e<=t?e:t,o=0;o<s;++o)a.set(1,o,o);var l=a.toTensor().as2D(e,t);if(n==null)return l;if(n.length===1)return Ps(Tn(l,0),[n[0],1,1]);if(n.length===2)return Ps(Tn(Tn(l,0),0),[n[0],n[1],1,1]);if(n.length===3)return Ps(Tn(Tn(Tn(l,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),_k=B({multinomial_:function(e,t,n,r){r===void 0&&(r=!1);var a=D(e,"logits","multinomial"),s=a.size,o=a.rank;if(s<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+s+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var l=o===1?a.as2D(1,-1):a,c=V.runKernelFunc(function(u){return u.multinomial(l,r,t,n)},{logits2D:l});return o===1?c.as1D():c}}),fh=B({oneHot_:function(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=D(e,"indices","oneHot","int32"),s=a.shape.concat([t]);return a=a.flatten(),V.runKernelFunc(function(o){return o.oneHot(a,t,n,r)},{$indices:a},function(o){return{$indices:function(){return Ye(a.shape,"float32")}}}).reshape(s)}}),Za=B({pad_:function(e,t,n){n===void 0&&(n=0);var r=D(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n};return V.runKernelFunc(function(s){return s.pad(r,t,n)},{x:r},function(s){var o=t.map(function(l){return l[0]});return{x:function(){return s.slice(o,r.shape)}}},"PadV2",a)}}),jk=B({pad1d_:function(e,t,n){return n===void 0&&(n=0),P(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Za(e,[t],n)}}),kk=B({pad2d_:function(e,t,n){return n===void 0&&(n=0),P(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Za(e,t,n)}}),Ck=B({pad3d_:function(e,t,n){return n===void 0&&(n=0),P(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Za(e,t,n)}}),Sk=B({pad4d_:function(e,t,n){return n===void 0&&(n=0),P(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Za(e,t,n)}}),Ek=B({rand_:function(e,t,n){var r=be(e),a=null;if(n==null||n==="float32")a=new Float32Array(r);else if(n==="int32")a=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);a=new Uint8Array(r)}for(var s=0;s<r;s++)a[s]=t();return V.makeTensor(a,e,n)}}),Rk=B({randomNormal_:function(e,t,n,r,a){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var s=new Pf(t,n,r,!1,a),o=Te(e,r),l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}}),Dk=B({randomGamma_:function(e,t,n,r,a){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var s=new mk(t,n,r,a),o=Te(e,r),l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}}),ny=B({randomUniform_:function(e,t,n,r,a){t===void 0&&(t=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var s=Te(e,r),o=new gk(t,n,null,a),l=0;l<s.values.length;l++)s.values[l]=o.nextValue();return s.toTensor()}}),Kn=B({reshape_:function(e,t){var n=D(e,"x","reshape",null);t=cj(t,n.size),P(n.size===be(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return V.runKernelFunc(function(a){return a.reshape(n,t)},{x:n},function(a){return{x:function(){return a.reshape(n.shape)}}},"Reshape",r)}}),ry=B({spaceToBatchND_:function(e,t,n){var r=D(e,"x","spaceToBatchND");return P(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),P(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),P(r.shape.reduce(function(a,s,o){return o>0&&o<=t.length?a&&(s+n[o-1][0]+n[o-1][1])%t[o-1]==0:a},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),V.runKernelFunc(function(a){return a.spaceToBatchND(r,t,n)},{$x:r},function(a){return{$x:function(){return a.batchToSpaceND(t,n)}}})}}),ay=B({squeeze_:function(e,t){var n=D(e,"x","squeeze");return Kn(n,Aa(n.shape,t).newShape)}}),Cn=B({stack_:function(e,t){t===void 0&&(t=0);var n=ac(e,"tensors","stack");if(P(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(t);var r=n[0].rank,a=n[0].shape,s=n[0].dtype;P(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(l){qe(a,l.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(l){P(s===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=n.map(function(l){return l.expandDims(t)});return wt(o,t)}}),Ps=B({tile_:function(e,t){var n=D(e,"x","tile",null);P(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],a={reps:t};return V.runKernelFunc(function(s,o){var l=s.tile(n,t);return o([n]),l},{x:n},function(s,o){var l=o[0];return{x:function(){var c=ze(l);if(l.rank===1)for(var u=0;u<t[0];++u)c=c.add(s.slice([u*l.shape[0]],[l.shape[0]]));else if(l.rank===2)for(u=0;u<t[0];++u)for(var d=0;d<t[1];++d)c=c.add(s.slice([u*l.shape[0],d*l.shape[1]],[l.shape[0],l.shape[1]]));else if(l.rank===3)for(u=0;u<t[0];++u)for(d=0;d<t[1];++d)for(var h=0;h<t[2];++h)c=c.add(s.slice([u*l.shape[0],d*l.shape[1],h*l.shape[2]],[l.shape[0],l.shape[1],l.shape[2]]));else{if(l.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+l.rank+" tensors yet.");for(u=0;u<t[0];++u)for(d=0;d<t[1];++d)for(h=0;h<t[2];++h)for(var f=0;f<t[3];++f)c=c.add(s.slice([u*l.shape[0],d*l.shape[1],h*l.shape[2],f*l.shape[3]],[l.shape[0],l.shape[1],l.shape[2],l.shape[3]]))}return c}}},"Tile",a,r)}}),Ik=B({truncatedNormal_:function(e,t,n,r,a){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var s=new Pf(t,n,r,!0,a),o=Te(e,r),l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}}),Nt=B({unstack_:function(e,t){t===void 0&&(t=0),t=t||0;var n=D(e,"x","unstack");P(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return V.runKernelFunc(function(a){return a.unstack(n,t)},{x:n},function(a){return{x:function(){return Cn(a,t)}}},"Unpack",r)}}),Ak=function(e,t){return xe(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d,h;return ye(this,function(f){switch(f.label){case 0:return n=D(e,"x","setdiff1d"),r=D(t,"y","setdiff1d"),P(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),P(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),P(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return a=f.sent(),[4,r.data()];case 2:for(s=f.sent(),o=new Set(s),l=0,d=0;d<a.length;d++)o.has(a[d])||l++;for(c=new di([l],n.dtype),u=new di([l],"int32"),d=0,h=0;d<a.length;d++)o.has(a[d])||(c.values[h]=a[d],u.values[h]=d,h++);return[2,[c.toTensor(),u.toTensor()]]}})})};function oc(e,t,n,r){r===void 0&&(r=!0);var a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var s=t.length,o=0;o<s;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(s+1))}return a}function ic(e,t,n){n===void 0&&(n=!0);var r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{var s=[],o=[];for(a=1;a<e;++a)a>=2*t+1||a%2==1?o.push(a):s.push(a);r.push.apply(r,s),r.push(0),r.push.apply(r,o)}return r}function lc(e,t,n,r){r===void 0&&(r=!0);var a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var s=1;s<e.length;++s)s<=t.length?r?a.push(t[s-1]*e[s]):a.push(e[s]/t[s-1]):a.push(e[s]);return a}function sy(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function oy(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function iy(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],a=1,s=0;s<n.length-1;++s)a*=n[s];var o=e.shape,l=n.slice();l.pop();var c=1;for(s=r;s<e.rank;++s)c*=o[s],l.push(o[s]);var u=pr(e.shape).map(function(d){return d/c}).concat([1]).slice(0,r);return[l,a,c,u]}var ly=30;function Ou(e){return e<=ly?e:ih(e,Math.floor(Math.sqrt(e)))}function Tk(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,s="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+a+".";if(n.rank<a)throw new Error(s+" update.rank < "+a+". ");if(e.length<r+(n.rank-a))throw new Error(s+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(s+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(s+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-a;++o)if(n.shape[o+a]!==e[o+r])throw new Error(s+" updates.shape["+(o+a)+"] ("+n.shape[o+a]+") != shape["+(o+a)+"] ("+e[o+a]+")")}function Pk(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Tk(n,t,e)}function cc(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,s=n.length,o=1,l=a;l<s;++l)o*=n[l];var c=a<1?1:a;return{sliceRank:a,numUpdates:be(t.shape)/c,sliceSize:o,strides:pr(n.slice(0,a)).concat([1]),outputSize:be(n)}}function Fk(e,t,n){P(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),P(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(s){P(t[s]+n[s]<=e.shape[s],function(){return"Error in slice"+e.rank+"D: begin["+s+"] + size["+s+"] ("+(t[s]+n[s])+") would overflow input.shape["+s+"] ("+e.shape[s]+")"})},a=0;a<e.rank;++a)r(a)}function mg(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Ff(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Mk(e,t,n,r,a){var s=t[a],o=n[a]||1;(e&1<<a||s==null)&&(s=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var l=r[a];return s<0&&(s+=l),s=ah(0,s,l-1)}function Ok(e,t,n,r,a){var s=t[a],o=n[a]||1;(e&1<<a||s==null)&&(s=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var l=r[a];return s<0&&(s+=l),s=o>0?ah(0,s,l):ah(-1,s,l-1)}function cy(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function uy(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Lk(e,t){P(oh(e),function(){return"The f passed in variableGrads(f) must be a function"}),P(t==null||Array.isArray(t)&&t.every(function(d){return d instanceof Ys}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=t!=null;if(!n)for(var r in t=[],V.registeredVariables)t.push(V.registeredVariables[r]);var a=n?t.filter(function(d){return!d.trainable}):null,s=t.length;P((t=t.filter(function(d){return d.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+s+" variables is trainable."});var o=V.gradients(e,t,null,!0),l=o.value,c=o.grads;P(c.some(function(d){return d!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),P(l.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+l.rank+" tensor"});var u={};return t.forEach(function(d,h){c[h]!=null&&(u[d.name]=c[h])}),a!=null&&a.forEach(function(d){return u[d.name]=null}),{value:l,grads:u}}function Wc(e){return V.customGrad(e)}var Lr=B({softmax_:function(e,t){t===void 0&&(t=-1);var n=D(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return V.runKernelFunc(function(r,a){var s=r.softmax(n,t);return a([s]),s},{logits:n},function(r,a){var s=a[0],o=r.mul(s);return{logits:function(){return o.sub(o.sum([t],!0).mul(s))}}},"Softmax",{dim:t},[],[!0])}}),Bk=B({logSoftmax_:function(e,t){t===void 0&&(t=-1);var n=D(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Wc(function(r,a){var s=r.max(t,!0),o=r.sub(s),l=o.toFloat().sub(o.exp().sum(t,!0).log());return a([l]),{value:l,gradFunc:function(c,u){var d=u[0].exp();return c.sub(c.sum(t,!0).mul(d))}}})(n)}}),dy=function(){function e(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},e.prototype.set=function(t,n){this.dataIdsCount++,this.data.set(t,n)},e.prototype.has=function(t){return this.data.has(t)},e.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),hy=function(){function e(){}return e.prototype.time=function(t){return X("time")},e.prototype.read=function(t){return X("read")},e.prototype.readSync=function(t){return X("readSync")},e.prototype.numDataIds=function(){return X("numDataIds")},e.prototype.disposeData=function(t){return X("disposeData")},e.prototype.write=function(t,n,r){return X("write")},e.prototype.move=function(t,n,r,a){return X("move")},e.prototype.memory=function(){return X("memory")},e.prototype.floatPrecision=function(){return X("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(t,n,r,a){return X("batchMatMul")},e.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,X("fusedBatchMatMul")},e.prototype.slice=function(t,n,r){return X("slice")},e.prototype.stridedSlice=function(t,n,r,a){return X("stridedSlice")},e.prototype.unstack=function(t,n){return X("unstack")},e.prototype.reverse=function(t,n){return X("reverse")},e.prototype.concat=function(t,n){return X("concat")},e.prototype.neg=function(t){return X("neg")},e.prototype.add=function(t,n){return X("add")},e.prototype.addN=function(t){return X("addN")},e.prototype.subtract=function(t,n){return X("subtract")},e.prototype.multiply=function(t,n){return X("multiply")},e.prototype.realDivide=function(t,n){return X("realDivide")},e.prototype.floorDiv=function(t,n){return X("floorDiv")},e.prototype.sum=function(t,n){return X("sum")},e.prototype.prod=function(t,n){return X("prod")},e.prototype.unsortedSegmentSum=function(t,n,r){return X("unsortedSegmentSum")},e.prototype.argMin=function(t,n){return X("argMin")},e.prototype.argMax=function(t,n){return X("argMax")},e.prototype.equal=function(t,n){return X("equal")},e.prototype.notEqual=function(t,n){return X("notEqual")},e.prototype.less=function(t,n){return X("less")},e.prototype.lessEqual=function(t,n){return X("lessEqual")},e.prototype.greater=function(t,n){return X("greater")},e.prototype.greaterEqual=function(t,n){return X("greaterEqual")},e.prototype.logicalNot=function(t){return X("logicalNot")},e.prototype.logicalAnd=function(t,n){return X("logicalAnd")},e.prototype.logicalOr=function(t,n){return X("logicalOr")},e.prototype.where=function(t){return X("where")},e.prototype.select=function(t,n,r){return X("select")},e.prototype.topk=function(t,n,r){return X("topk")},e.prototype.min=function(t,n){return X("min")},e.prototype.minimum=function(t,n){return X("minimum")},e.prototype.mod=function(t,n){return X("mod")},e.prototype.max=function(t,n){return X("max")},e.prototype.maximum=function(t,n){return X("maximum")},e.prototype.all=function(t,n){return X("all")},e.prototype.any=function(t,n){return X("any")},e.prototype.squaredDifference=function(t,n){return X("squaredDifference")},e.prototype.ceil=function(t){return X("ceil")},e.prototype.floor=function(t){return X("floor")},e.prototype.round=function(t){return X("round")},e.prototype.sign=function(t){return X("sign")},e.prototype.isNaN=function(t){return X("isNaN")},e.prototype.isInf=function(t){return X("isInf")},e.prototype.isFinite=function(t){return X("isFinite")},e.prototype.pow=function(t,n){return X("pow")},e.prototype.exp=function(t){return X("exp")},e.prototype.expm1=function(t){return X("expm1")},e.prototype.softmax=function(t,n){return X("softmax")},e.prototype.log=function(t){return X("log")},e.prototype.log1p=function(t){return X("log1p")},e.prototype.sqrt=function(t){return X("sqrt")},e.prototype.rsqrt=function(t){return X("rsqrt")},e.prototype.square=function(t){return X("square")},e.prototype.reciprocal=function(t){return X("reciprocal")},e.prototype.relu=function(t){return X("relu")},e.prototype.relu6=function(t){return X("relu6")},e.prototype.prelu=function(t,n){return X("prelu")},e.prototype.elu=function(t){return X("elu")},e.prototype.eluDer=function(t,n){return X("eluDer")},e.prototype.selu=function(t){return X("selu")},e.prototype.int=function(t){return X("int")},e.prototype.clip=function(t,n,r){return X("clip")},e.prototype.abs=function(t){return X("abs")},e.prototype.complexAbs=function(t){return X("complexAbs")},e.prototype.sigmoid=function(t){return X("sigmoid")},e.prototype.softplus=function(t){return X("softplus")},e.prototype.sin=function(t){return X("sin")},e.prototype.cos=function(t){return X("cos")},e.prototype.tan=function(t){return X("tan")},e.prototype.asin=function(t){return X("asin")},e.prototype.acos=function(t){return X("acos")},e.prototype.atan=function(t){return X("atan")},e.prototype.atan2=function(t,n){return X("atan2")},e.prototype.sinh=function(t){return X("sinh")},e.prototype.cosh=function(t){return X("cosh")},e.prototype.tanh=function(t){return X("tanh")},e.prototype.asinh=function(t){return X("asinh")},e.prototype.acosh=function(t){return X("acosh")},e.prototype.atanh=function(t){return X("atanh")},e.prototype.erf=function(t){return X("erf")},e.prototype.step=function(t,n){return X("step")},e.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,X("fusedConv2d")},e.prototype.conv2d=function(t,n,r){return X("conv2d")},e.prototype.conv2dDerInput=function(t,n,r){return X("conv2dDerInput")},e.prototype.conv2dDerFilter=function(t,n,r){return X("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,X("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(t,n,r){return X("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(t,n,r){return X("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){return X("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(t,n,r){return X("conv3d")},e.prototype.conv3dDerInput=function(t,n,r){return X("conv3dDerInput")},e.prototype.conv3dDerFilter=function(t,n,r){return X("conv3dDerFilter")},e.prototype.maxPool=function(t,n){return X("maxPool")},e.prototype.maxPoolBackprop=function(t,n,r,a){return X("maxPoolBackprop")},e.prototype.avgPool=function(t,n){return X("avgPool")},e.prototype.avgPoolBackprop=function(t,n,r){return X("avgPoolBackprop")},e.prototype.avgPool3d=function(t,n){return X("avgPool3d")},e.prototype.avgPool3dBackprop=function(t,n,r){return X("avgPool3dBackprop")},e.prototype.maxPool3d=function(t,n){return X("maxPool3d")},e.prototype.maxPool3dBackprop=function(t,n,r,a){return X("maxPool3dBackprop")},e.prototype.reshape=function(t,n){return X("reshape")},e.prototype.cast=function(t,n){return X("cast")},e.prototype.tile=function(t,n){return X("tile")},e.prototype.pad=function(t,n,r){return X("pad")},e.prototype.transpose=function(t,n){return X("transpose")},e.prototype.gather=function(t,n,r){return X("gather")},e.prototype.gatherND=function(t,n){return X("gatherND")},e.prototype.scatterND=function(t,n,r){return X("scatterND")},e.prototype.batchToSpaceND=function(t,n,r){return X("batchToSpaceND")},e.prototype.spaceToBatchND=function(t,n,r){return X("spaceToBatchND")},e.prototype.resizeBilinear=function(t,n,r,a){return X("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(t,n,r){return X("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(t,n,r,a){return X("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){return X("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(t,n,r,a,s,o){return X("batchNormalization")},e.prototype.localResponseNormalization4D=function(t,n,r,a,s){return X("localResponseNormalization4D")},e.prototype.LRNGrad=function(t,n,r,a,s,o,l){return X("LRNGrad")},e.prototype.multinomial=function(t,n,r,a){return X("multinomial")},e.prototype.oneHot=function(t,n,r,a){return X("oneHot")},e.prototype.cumsum=function(t,n,r,a){return X("cumsum")},e.prototype.nonMaxSuppression=function(t,n,r,a,s){return X("nonMaxSuppression")},e.prototype.fft=function(t){return X("fft")},e.prototype.ifft=function(t){return X("ifft")},e.prototype.complex=function(t,n){return X("complex")},e.prototype.real=function(t){return X("real")},e.prototype.imag=function(t){return X("imag")},e.prototype.cropAndResize=function(t,n,r,a,s,o){return X("cropAndResize")},e.prototype.depthToSpace=function(t,n,r){return X("depthToSpace")},e.prototype.split=function(t,n,r){return X("split")},e.prototype.sparseToDense=function(t,n,r,a){return X("sparseToDense")},e.prototype.diag=function(t){return X("diag")},e.prototype.fill=function(t,n,r){return X("fill")},e.prototype.onesLike=function(t){return X("onesLike")},e.prototype.zerosLike=function(t){return X("zerosLike")},e.prototype.linspace=function(t,n,r){return X("linspace")},e.prototype.dispose=function(){return X("dispose")},e}();function X(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function ea(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var s=n-1-a,o=e[s]||1;(t[t.length-1-a]||1)>1&&o===1&&r.unshift(s)}return r}function _t(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],s=t.length-r-1,o=t[s];(a==null||a===1&&o>1)&&n.unshift(s)}return n}function Le(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var s=e[e.length-a-1];s==null&&(s=1);var o=t[t.length-a-1];if(o==null&&(o=1),s===1)n.unshift(o);else if(o===1)n.unshift(s);else{if(s!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(s)}}return n}function fi(e,t,n,r,a,s,o){o===void 0&&(o="channelsLast");var l,c=hc(t),u=c[0],d=c[1];if(o==="channelsLast")l=[u,d,e[3],e[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);l=[u,d,e[1],e[1]]}return es(e,l,n,r,a,s,!1,o)}function uc(e,t,n,r,a,s,o){o===void 0&&(o="NDHWC");var l,c,u=ph(t),d=u[0],h=u[1],f=u[2];if(o==="NDHWC")c="channelsLast",l=[d,h,f,e[4],e[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);c="channelsFirst",l=[d,h,f,e[1],e[1]]}return dc(e,l,n,r,a,!1,c,s)}function es(e,t,n,r,a,s,o,l){o===void 0&&(o=!1),l===void 0&&(l="channelsLast");var c=[-1,-1,-1,-1],u=c[0],d=c[1],h=c[2],f=c[3];if(l==="channelsLast")u=e[0],d=e[1],h=e[2],f=e[3];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);u=e[0],f=e[1],d=e[2],h=e[3]}var p,m=t[0],x=t[1],y=t[3],g=hc(n),v=g[0],w=g[1],b=hc(r),N=b[0],_=b[1],k=Fs(m,N),j=Fs(x,_),C=function(L,O,U,z,F,W,I,q){var K,re,ie;if(typeof L=="number"){K={top:L,bottom:L,left:L,right:L,type:L===0?"VALID":"NUMBER"};var ce=function(R,Y,ne,fe,Se){fe==null&&(fe=fy(R,Y,ne));var $=R[0],le=R[1],ve=Oo(($-Y+2*fe)/ne+1,Se);P(ht(ve),function(){return"The output # of rows ("+ve+") must be an integer. Change the stride and/or zero pad parameters"});var ue=Oo((le-Y+2*fe)/ne+1,Se);return P(ht(ue),function(){return"The output # of columns ("+ue+") must be an integer. Change the stride and/or zero pad parameters"}),[ve,ue]}([O,U],W,z,L,q);re=ce[0],ie=ce[1]}else if(L==="same"){re=Math.ceil(O/z),ie=Math.ceil(U/F);var me=Math.max(0,(re-1)*z+W-O),je=Math.max(0,(ie-1)*F+I-U),G=Math.floor(me/2),se=me-G,Ce=Math.floor(je/2);K={top:G,bottom:se,left:Ce,right:je-Ce,type:"SAME"}}else{if(L!=="valid")throw Error("Unknown padding parameter: "+L);K={top:0,bottom:0,left:0,right:0,type:"VALID"},re=Math.ceil((O-W+1)/z),ie=Math.ceil((U-I+1)/F)}return{padInfo:K,outHeight:re,outWidth:ie}}(a,d,h,v,w,k,j,s),S=C.padInfo,M=C.outHeight,T=C.outWidth,A=o?y*f:y;return l==="channelsFirst"?p=[u,A,M,T]:l==="channelsLast"&&(p=[u,M,T,A]),{batchSize:u,dataFormat:l,inHeight:d,inWidth:h,inChannels:f,outHeight:M,outWidth:T,outChannels:A,padInfo:S,strideHeight:v,strideWidth:w,filterHeight:m,filterWidth:x,effectiveFilterHeight:k,effectiveFilterWidth:j,dilationHeight:N,dilationWidth:_,inShape:e,outShape:p,filterShape:t}}function dc(e,t,n,r,a,s,o,l){s===void 0&&(s=!1),o===void 0&&(o="channelsLast");var c=[-1,-1,-1,-1,-1],u=c[0],d=c[1],h=c[2],f=c[3],p=c[4];if(o==="channelsLast")u=e[0],d=e[1],h=e[2],f=e[3],p=e[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);u=e[0],p=e[1],d=e[2],h=e[3],f=e[4]}var m,x=t[0],y=t[1],g=t[2],v=t[4],w=ph(n),b=w[0],N=w[1],_=w[2],k=ph(r),j=k[0],C=k[1],S=k[2],M=Fs(x,j),T=Fs(y,C),A=Fs(g,S),L=function(I,q,K,re,ie,ce,me,je,G,se,Ce){var R,Y,ne,fe;if(typeof I=="number"){R={top:I,bottom:I,left:I,right:I,front:I,back:I,type:I===0?"VALID":"NUMBER"};var Se=function(H,ee,he,$e,Pe,nt){Pe==null&&(Pe=fy(H,ee,$e));var mt=H[0],nn=H[1],wr=H[2],Dn=Oo((mt-ee+2*Pe)/$e+1,nt);P(ht(Dn),function(){return"The output # of depths ("+Dn+") must be an integer. Change the stride and/or zero pad parameters"});var lo=Oo((nn-ee+2*Pe)/$e+1,nt);P(ht(lo),function(){return"The output # of rows ("+lo+") must be an integer. Change the stride and/or zero pad parameters"});var Ur=Oo((wr-ee+2*Pe)/$e+1,nt);return P(ht(Ur),function(){return"The output # of columns ("+Ur+") must be an integer. Change the stride and/or zero pad parameters"}),[Dn,lo,Ur,he]}([q,K,re,1],je,1,ie,I,Ce);Y=Se[0],ne=Se[1],fe=Se[2]}else if(I==="same"){Y=Math.ceil(q/ie),ne=Math.ceil(K/ce),fe=Math.ceil(re/me);var $=(Y-1)*ie+je-q,le=(ne-1)*ce+G-K,ve=(fe-1)*me+se-re,ue=Math.floor($/2),Ee=$-ue,De=Math.floor(le/2),We=le-De,J=Math.floor(ve/2);R={top:De,bottom:We,left:J,right:ve-J,front:ue,back:Ee,type:"SAME"}}else{if(I!=="valid")throw Error("Unknown padding parameter: "+I);R={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Y=Math.ceil((q-je+1)/ie),ne=Math.ceil((K-G+1)/ce),fe=Math.ceil((re-se+1)/me)}return{padInfo:R,outDepth:Y,outHeight:ne,outWidth:fe}}(a,d,h,f,b,N,_,M,T,A,l),O=L.padInfo,U=L.outDepth,z=L.outHeight,F=L.outWidth,W=s?v*p:v;return o==="channelsFirst"?m=[u,W,U,z,F]:o==="channelsLast"&&(m=[u,U,z,F,W]),{batchSize:u,dataFormat:o,inDepth:d,inHeight:h,inWidth:f,inChannels:p,outDepth:U,outHeight:z,outWidth:F,outChannels:W,padInfo:O,strideDepth:b,strideHeight:N,strideWidth:_,filterDepth:x,filterHeight:y,filterWidth:g,effectiveFilterDepth:M,effectiveFilterHeight:T,effectiveFilterWidth:A,dilationDepth:j,dilationHeight:C,dilationWidth:S,inShape:e,outShape:m,filterShape:t}}function fy(e,t,n,r){r===void 0&&(r=1);var a=Fs(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function hc(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function ph(e){return typeof e=="number"?[e,e,e]:e}function Fs(e,t){return t<=1?e:e+(e-1)*(t-1)}function Oo(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Js(e){var t=hc(e),n=t[0],r=t[1],a=t[2];return n===1&&r===1&&a===1}function pn(e,t){return Js(e)||Js(t)}function Mf(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function py(e,t,n){if(t==="complex64"){if(e.dtype==="complex64")return e.clone();var r=Ye(e.shape),a=e.toFloat(),s=n.complex(a,r);return r.dispose(),a.dispose(),s}if(!hj(e.dtype,t))return V.makeTensorFromDataId(e.dataId,e.shape,t);if(e.dtype==="complex64"){var o=n.real(e);return s=o.cast(t),o.dispose(),s}if(t==="int32")return n.int(e);if(t==="bool"){var l=de(0,e.dtype);return s=n.notEqual(e,l),l.dispose(),s}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function mh(e,t){return V.makeTensorFromDataId(e.dataId,t,e.dtype)}function my(e,t,n){var r=(t-e)/(n-1),a=_i(n,"float32");a[0]=e;for(var s=1;s<a.length;s++)a[s]=a[s-1]+r;return vt(a,"float32")}function gh(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function gg(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Wk(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function $k(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function zk(e,t,n){var r=function(s,o,l){return function(c,u,d){for(var h=0,f=c.length,p=0,m=!1;h<f;){var x=d(u,c[p=h+(f-h>>>1)]);x>0?h=p+1:(f=p,m=!x)}return m?h:-h-1}(s,o,l||Uk)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Uk(e,t){return e>t?1:e<t?-1:0}function Of(e,t,n,r,a){return gy(e,t,n,r,a,0).selectedIndices}function Lf(e,t,n,r,a,s){var o=gy(e,t,n,r,a,s);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function gy(e,t,n,r,a,s,o,l){l===void 0&&(l=!1);for(var c=Array.from(t).map(function(b,N){return{score:b,boxIndex:N,suppressBeginIndex:0}}).filter(function(b){return b.score>a}).sort(vg),u=s>0?-.5/s:0,d=[],h=[];d.length<n&&c.length>0;){var f=c.pop(),p=f.score,m=f.boxIndex,x=f.suppressBeginIndex;if(p<a)break;for(var y=!1,g=d.length-1;g>=x;--g){var v=Vk(e,m,d[g]);if(v>=r){y=!0;break}if(f.score=f.score*qk(r,u,v),f.score<=a)break}f.suppressBeginIndex=d.length,y||(f.score===p?(d.push(m),h.push(f.score)):f.score>a&&zk(c,f,vg))}var w=d.length;return l&&(d.fill(0,w),h.fill(0,w)),{selectedIndices:vt(d,"int32"),selectedScores:vt(h,"float32"),numValidOutputs:de(w,"int32")}}function Vk(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),l=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),u=Math.min(a[0],a[2]),d=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),p=(l-s)*(c-o),m=(h-u)*(f-d);if(p<=0||m<=0)return 0;var x=Math.max(s,u),y=Math.max(o,d),g=Math.min(l,h),v=Math.min(c,f),w=Math.max(g-x,0)*Math.max(v-y,0);return w/(p+m-w)}function qk(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function vg(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function vy(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map(function(s){a[n]=s;var o=e.slice(r,a);return r[n]+=s,o})}function xy(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var a=Te(n,e.dtype);for(r=0;r<a.values.length;++r){for(var s=a.indexToLoc(r),o=new Array(e.rank),l=0;l<o.length;l++)o[l]=s[l]%e.shape[l];var c=e.locToIndex(o);a.values[r]=e.values[c]}return a.toTensor()}function yy(e,t,n,r,a){for(var s=t[t.length-1],o=[e.length/s,s],l=o[0],c=o[1],u=ui(n,l*r),d=ui("int32",l*r),h=0;h<l;h++){for(var f=h*c,p=e.subarray(f,f+c),m=[],x=0;x<p.length;x++)m.push({value:p[x],index:x});m.sort(function(b,N){return N.value-b.value});var y=h*r,g=u.subarray(y,y+r),v=d.subarray(y,y+r);for(x=0;x<r;x++)g[x]=m[x].value,v[x]=m[x].index}var w=t.slice();return w[w.length-1]=r,[Mt(u,w,n),Mt(d,w,"int32")]}function Bf(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var a=Te(e,"int32"),s=Te([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=a.indexToLoc(n[r]),l=r*e.length;s.values.set(o,l)}return s.toTensor()}var Hk=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(a,s){return"T"+s});var n=[];this.variableNames.forEach(function(a){n.push("float v"+a+" = get"+a+"AtOutCoords();")});var r=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Gk=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(a,s){return"T"+s});var n=[];this.variableNames.forEach(function(a){n.push("vec4 v"+a+" = get"+a+"AtOutCoords();")});var r=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Kk=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,a=e.batchSize,s=e.inSize,o=Math.ceil(s/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var l=t==="max"?">":"<",c=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+c+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+l+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function by(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(n){return e+"."+n})}function on(e,t){return t===1?[e]:by(e,t)}function qt(){var e,t,n,r,a,s,o,l,c,u;return Z().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",a="texture",s="outputColor",o="out vec4 outputColor;",l="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",s="gl_FragColor",o="",l="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:s,defineOutput:o,defineSpecialNaN:l,defineSpecialInf:c,defineRound:u}}function Oa(e,t,n){n===void 0&&(n="index");var r=pr(t);return r.map(function(a,s){return"int "+e[s]+" = "+n+" / "+a+"; "+(s===r.length-1?"int "+e[s+1]+" = "+n+" - "+e[s]+" * "+a:"index -= "+e[s]+" * "+a)+";"}).join("")}function Wf(e){var t=pr(e).map(function(n){return n.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var wy="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Xk(e,t,n,r){var a=[];e.forEach(function(p){var m=be(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?a.push("uniform float "+p.name+(m>1?"["+m+"]":"")+";"):(a.push("uniform sampler2D "+p.name+";"),a.push("uniform int offset"+p.name+";"))});var s,o,l=a.join("\n"),c=e.map(function(p){return function(m,x,y){y===void 0&&(y=!1);var g="";g+=y?Ny(m):ls(m);var v=m.shapeInfo.logicalShape,w=x.logicalShape;return v.length<=w.length&&(g+=y?function(b,N){var _,k=b.name,j=k.charAt(0).toUpperCase()+k.slice(1),C="get"+j+"AtOutCoords",S=b.shapeInfo.logicalShape.length,M=N.logicalShape.length,T=ea(b.shapeInfo.logicalShape,N.logicalShape),A=Ke(M),L=M-S,O=["x","y","z","w","u","v"];_=S===0?"":M<2&&T.length>=1?"coords = 0;":T.map(function(K){return"coords."+O[K+L]+" = 0;"}).join("\n");var U="";U=M<2&&S>0?"coords":b.shapeInfo.logicalShape.map(function(K,re){return"coords."+O[re+L]}).join(", ");var z="return outputValue;",F=be(b.shapeInfo.logicalShape)===1,W=be(N.logicalShape)===1;if(S!==1||F||W){if(F&&!W)z=M===1?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(T.length){var I=S-2,q=S-1;T.indexOf(I)>-1&&T.indexOf(q)>-1?z="return vec4(outputValue.x);":T.indexOf(I)>-1?z="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":T.indexOf(q)>-1&&(z="return vec4(outputValue.xx, outputValue.zz);")}}else z="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+C+"() {\n      "+A+" coords = getOutputCoords();\n      "+_+"\n      vec4 outputValue = get"+j+"("+U+");\n      "+z+"\n    }\n  "}(m,x):function(b,N){var _=b.name,k=_.charAt(0).toUpperCase()+_.slice(1),j="get"+k+"AtOutCoords",C=N.texShape,S=b.shapeInfo.texShape,M=b.shapeInfo.logicalShape.length,T=N.logicalShape.length;if(!b.shapeInfo.isUniform&&M===T&&b.shapeInfo.flatOffset==null&&It(S,C))return"\n      float "+j+"() {\n        return sampleTexture("+_+", resultUV);\n      }\n    ";var A,L=Ke(T),O=ea(b.shapeInfo.logicalShape,N.logicalShape),U=T-M,z=["x","y","z","w","u","v"];A=M===0?"":T<2&&O.length>=1?"coords = 0;":O.map(function(W){return"coords."+z[W+U]+" = 0;"}).join("\n");var F="";return F=T<2&&M>0?"coords":b.shapeInfo.logicalShape.map(function(W,I){return"coords."+z[I+U]}).join(", "),"\n    float "+j+"() {\n      "+L+" coords = getOutputCoords();\n      "+A+"\n      return get"+k+"("+F+");\n    }\n  "}(m,x)),g}(p,t,r)}).join("\n"),u=t.texShape,d=qt(),h=function(p){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+p.texture2D+"(textureSampler, uv).r;\n    }\n  "}(d),f=function(p){return p.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+p.varyingFs+" vec2 resultUV;\n    "+p.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+p.defineSpecialNaN+"\n    "+p.defineSpecialInf+"\n    "+p.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Yk+"\n    "+Qk+"\n    "+Jk+"\n  "}(d);return t.isPacked?(s=function(p,m){switch(p.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(b,N){var _=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)];return _[0]===1?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+_[1]+".0);\n      }\n    ":_[1]===1?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+_[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n      return 2 * (resTexRC.x * "+_[1]+" + resTexRC.y);\n    }\n  "}(0,m);case 2:return function(b,N){var _=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)];if(It(b,N))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+_[0]+", "+_[1]+"));\n      }\n    ";var k=Math.ceil(b[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n\n      int index = resTexRC.x * "+_[1]+" + resTexRC.y;\n      int r = 2 * (index / "+k+");\n      int c = imod(index, "+k+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(p,m);case 3:return x=p,y=m,g=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],v=Math.ceil(x[2]/2),w=v*Math.ceil(x[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+g[0]+", "+g[1]+"));\n      int index = resTexRC.x * "+g[1]+" + resTexRC.y;\n\n      int b = index / "+w+";\n      index -= b * "+w+";\n\n      int r = 2 * (index / "+v+");\n      int c = imod(index, "+v+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(b,N){for(var _=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)],k=Math.ceil(b[b.length-1]/2),j=k*Math.ceil(b[b.length-2]/2),C=j,S="",M="b, r, c",T=2;T<b.length-1;T++)C*=b[b.length-T-1],S="\n      int b"+T+" = index / "+C+";\n      index -= b"+T+" * "+C+";\n    "+S,M="b"+T+", "+M;return"\n    ivec"+b.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n      int index = resTexRC.x * "+_[1]+" + resTexRC.y;\n\n      "+S+"\n\n      int b = index / "+j+";\n      index -= b * "+j+";\n\n      int r = 2 * (index / "+k+");\n      int c = imod(index, "+k+") * 2;\n\n      return ivec"+b.length+"("+M+");\n    }\n  "}(p,m)}var x,y,g,v,w}(t.logicalShape,u),o=function(p){return"\n    void setOutput(vec4 val) {\n      "+p.output+" = val;\n    }\n  "}(d)):(s=function(p,m){switch(p.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(g,v){return v[0]===1?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+v[1]+".0);\n      }\n    ":v[1]===1?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+v[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+v[0]+", "+v[1]+"));\n      return resTexRC.x * "+v[1]+" + resTexRC.y;\n    }\n  "}(0,m);case 2:return function(g,v){return It(g,v)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+v[0]+", "+v[1]+"));\n      }\n    ":g[1]===1?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+v[0]+", "+v[1]+"));\n        int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":g[0]===1?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+v[0]+", "+v[1]+"));\n        int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n      int r = index / "+g[1]+";\n      int c = index - r * "+g[1]+";\n      return ivec2(r, c);\n    }\n  "}(p,m);case 3:return x=m,y=Oa(["r","c","d"],p),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+x[0]+", "+x[1]+"));\n      int index = resTexRC.x * "+x[1]+" + resTexRC.y;\n      "+y+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(g,v){var w=Oa(["r","c","d","d2"],g);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n      "+w+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(p,m);case 5:return function(g,v){var w=Oa(["r","c","d","d2","d3"],g);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+v[0]+",\n                             "+v[1]+"));\n\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n\n      "+w+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(p,m);case 6:return function(g,v){var w=Oa(["r","c","d","d2","d3","d4"],g);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n\n      "+w+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(p,m);default:throw new Error(p.length+"-D output sampling is not yet supported")}var x,y}(t.logicalShape,u),o=function(p){return"\n    void setOutput(float val) {\n      "+p.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(d)),r&&(f+=Zk),[f,h,o,l,s,c,n].join("\n")}function ls(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(n){var r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+a+"() {return "+r+";}";var s=n.shapeInfo.texShape,o=s[0],l=s[1];if(o===1&&l===1)return"\n      float "+a+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var c=n.shapeInfo.texShape,u=c[0],d=c[1],h=Sa(r);return"\n    float "+a+"() {\n      vec2 uv = uvFromFlat("+u+", "+d+", "+h+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 1:return function(n){var r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"\n      float "+a+"(int index) {\n        "+as(n)+"\n      }\n    ";var s=n.shapeInfo.texShape,o=s[0],l=s[1];if(l===1&&o===1)return"\n      float "+a+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var c=Sa(r);return l===1?"\n      float "+a+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+c+") + 0.5) / "+o+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":o===1?"\n      float "+a+"(int index) {\n        vec2 uv = vec2((float(index + "+c+") + 0.5) / "+l+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+a+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+l+", index + "+c+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 2:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n.shapeInfo.texShape;if(o!=null&&It(r,o)){var l=o[0],c=o[1];return"\n    float "+s+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+c+".0, "+l+".0);\n      return sampleTexture("+a+", uv);\n    }\n  "}var u=Aa(r),d=u.newShape,h=u.keptDims,f=d;if(f.length<r.length){var p=cs(n,f);return"\n      "+ls(p)+"\n      float "+s+"(int row, int col) {\n        return "+s+"("+us(["row","col"],h)+");\n      }\n    "}if(n.shapeInfo.isUniform)return"\n      float "+s+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+as(n)+"\n      }\n    ";var m=o[0],x=o[1],y=Sa(a);return x===1?"\n    float "+s+"(int row, int col) {\n      float index = dot(vec3(row, col, "+y+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+m+".0);\n      return sampleTexture("+a+", uv);\n    }\n  ":m===1?"\n    float "+s+"(int row, int col) {\n      float index = dot(vec3(row, col, "+y+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+x+".0, 0.5);\n      return sampleTexture("+a+", uv);\n    }\n  ":"\n  float "+s+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+y+";\n    vec2 uv = uvFromFlat("+m+", "+x+", index);\n    return sampleTexture("+a+", uv);\n  }\n"}(e);case 3:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r[1]*r[2],l=r[2],c=Aa(r),u=c.newShape,d=c.keptDims,h=u;if(h.length<r.length){var f=cs(n,h);return"\n        "+ls(f)+"\n        float "+s+"(int row, int col, int depth) {\n          return "+s+"("+us(["row","col","depth"],d)+");\n        }\n      "}if(n.shapeInfo.isUniform)return"\n      float "+s+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+l+", 1)));\n        "+as(n)+"\n      }\n    ";var p=n.shapeInfo.texShape,m=p[0],x=p[1],y=n.shapeInfo.flatOffset;if(x===o&&y==null)return"\n        float "+s+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+l+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+x+".0, "+m+".0);\n          return sampleTexture("+a+", uv);\n        }\n      ";if(x===l&&y==null)return"\n    float "+s+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+x+".0, "+m+".0);\n      return sampleTexture("+a+", uv);\n    }\n  ";var g=Sa(a);return"\n      float "+s+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+l+" + depth + "+g+";\n        vec2 uv = uvFromFlat("+m+", "+x+", index);\n        return sampleTexture("+a+", uv);\n      }\n  "}(e);case 4:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r[3],l=r[2]*o,c=r[1]*l,u=Aa(r),d=u.newShape,h=u.keptDims;if(d.length<r.length){var f=cs(n,d);return"\n      "+ls(f)+"\n      float "+s+"(int row, int col, int depth, int depth2) {\n        return "+s+"("+us(["row","col","depth","depth2"],h)+");\n      }\n    "}if(n.shapeInfo.isUniform)return"\n      float "+s+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+c+", "+l+", "+o+", 1)));\n        "+as(n)+"\n      }\n    ";var p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,x=m[0],y=m[1];if(y===c&&p==null)return"\n      float "+s+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+l+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+y+".0, "+x+".0);\n        return sampleTexture("+a+", uv);\n      }\n    ";if(y===o&&p==null)return"\n      float "+s+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+y+".0, "+x+".0);\n        return sampleTexture("+a+", uv);\n      }\n    ";var g=Sa(a);return"\n    float "+s+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+l+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+x+", "+y+", index + "+g+");\n      return sampleTexture("+a+", uv);\n    }\n  "}(e);case 5:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r[4],l=r[3]*o,c=r[2]*l,u=r[1]*c,d=Aa(r),h=d.newShape,f=d.keptDims;if(h.length<r.length){var p=cs(n,h);return"\n      "+ls(p)+"\n      float "+s+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+s+"("+us(["row","col","depth","depth2","depth3"],f)+");\n      }\n    "}if(n.shapeInfo.isUniform)return"\n      float "+s+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+c+", "+l+", "+o+")) +\n          depth3;\n        "+as(n)+"\n      }\n    ";var m=n.shapeInfo.flatOffset,x=n.shapeInfo.texShape,y=x[0],g=x[1];if(g===u&&m==null)return"\n      float "+s+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+c+", "+l+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+y+".0);\n        return sampleTexture("+a+", uv);\n      }\n    ";if(g===o&&m==null)return"\n      float "+s+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+y+".0);\n        return sampleTexture("+a+", uv);\n      }\n    ";var v=Sa(a);return"\n    float "+s+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+c+" + depth * "+l+" +\n          depth2 * "+o+" + depth3 + "+v+";\n      vec2 uv = uvFromFlat("+y+", "+g+", index);\n      return sampleTexture("+a+", uv);\n    }\n  "}(e);case 6:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=Aa(r),l=o.newShape,c=o.keptDims;if(l.length<r.length){var u=cs(n,l);return"\n      "+ls(u)+"\n      float "+s+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+s+"("+us(["row","col","depth","depth2","depth3","depth4"],c)+");\n      }\n    "}var d=r[5],h=r[4]*d,f=r[3]*h,p=r[2]*f,m=r[1]*p;if(n.shapeInfo.isUniform)return"\n      float "+s+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+m+", "+p+", "+f+", "+h+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+d+", 1)));\n        "+as(n)+"\n      }\n    ";var x=n.shapeInfo.flatOffset,y=n.shapeInfo.texShape,g=y[0],v=y[1];if(v===m&&x==null)return"\n      float "+s+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+p+", "+f+", "+h+", "+d+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+g+".0);\n        return sampleTexture("+a+", uv);\n      }\n    ";if(v===d&&x==null)return"\n      float "+s+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+g+".0);\n        return sampleTexture("+a+", uv);\n      }\n    ";var w=Sa(a);return"\n    float "+s+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+m+" + col * "+p+" + depth * "+f+" +\n          depth2 * "+h+" + depth3 * "+d+" + depth4 + "+w+";\n      vec2 uv = uvFromFlat("+g+", "+v+", index);\n      return sampleTexture("+a+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Ny(e){var t,n,r;switch(e.shapeInfo.logicalShape.length){case 0:return t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=qt(),"\n    vec4 "+n+"() {\n      return "+r.texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(a){var s=a.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),l=a.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],u=qt();return"\n    vec4 "+o+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+c[0]+", "+c[1]+", index);\n      return "+u.texture2D+"("+s+", uv);\n    }\n  "}(e);case 2:return function(a){var s=a.shapeInfo.logicalShape,o=a.name,l="get"+o.charAt(0).toUpperCase()+o.slice(1),c=a.shapeInfo.texShape,u=c[0],d=c[1],h=qt();if(c!=null&&It(s,c))return"\n      vec4 "+l+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+d+".0, "+u+".0);\n\n        return "+h.texture2D+"("+o+", uv);\n      }\n    ";var f=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],p=Math.ceil(s[1]/2);return"\n    vec4 "+l+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+p+", "+f[0]+", "+f[1]+", row, col);\n      return "+h.texture2D+"("+o+", uv);\n    }\n  "}(e);case 3:return function(a){var s=a.shapeInfo.logicalShape,o=a.name,l="get"+o.charAt(0).toUpperCase()+o.slice(1),c=a.shapeInfo.texShape,u=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(s[0]===1){var d=s.slice(1),h=cs(a,d);return"\n        "+Ny(h)+"\n        vec4 "+l+"(int b, int row, int col) {\n          return "+l+"("+us(["b","row","col"],[1,2])+");\n        }\n      "}var f=u[0],p=u[1],m=Math.ceil(s[2]/2),x=m*Math.ceil(s[1]/2),y=qt();return"\n    vec4 "+l+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+f+", "+p+", "+x+", "+m+", b, row, col);\n      return "+y.texture2D+"("+o+", uv);\n    }\n  "}(e);default:return function(a){for(var s=a.shapeInfo.logicalShape,o=s.length,l=a.name,c="get"+l.charAt(0).toUpperCase()+l.slice(1),u=a.shapeInfo.texShape,d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=d[0],f=d[1],p=Math.ceil(s[o-1]/2),m=p*Math.ceil(s[o-2]/2),x="int b, int row, int col",y="b * "+m+" + (row / 2) * "+p+" + (col / 2)",g=2;g<o-1;g++)x="int b"+g+", "+x,m*=s[o-g-1],y="b"+g+" * "+m+" + "+y;var v=qt();return"\n    vec4 "+c+"("+x+") {\n      int index = "+y+";\n      int texR = index / "+f+";\n      int texC = index - texR * "+f+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+", "+h+");\n      return "+v.texture2D+"("+l+", uv);\n    }\n  "}(e)}}var Yk="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Qk="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Jk="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Zk="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Sa(e){return"offset"+e}function as(e){var t=e.name,n=be(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function Ke(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function cs(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function us(e,t){return t.map(function(n){return e[n]}).join(", ")}var eC=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,P(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var a=e[e.length-1],s=Math.ceil(a/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");var o,l,c=this.outputShape,u=c.length,d=Ke(u),h=on("coords",u);if(s===1){var f=Ke(l=u+1);o="\n        "+f+" sourceLocR = "+f+"("+h.join()+", 0);\n        ++"+h[u-1]+";\n        "+f+" sourceLocG = "+f+"("+h.join()+", 0);\n        ++"+h[u-2]+";\n        "+f+" sourceLocA = "+f+"("+h.join()+", 0);\n        --"+h[u-1]+";\n        "+f+" sourceLocB = "+f+"("+h.join()+", 0);\n        --"+h[u-2]+";"}else l=u,o="\n        "+d+" sourceLocR = coords;\n        ++"+h[u-1]+";\n        "+d+" sourceLocG = coords;\n        ++"+h[u-2]+";\n        "+d+" sourceLocA = coords;\n        --"+h[u-1]+";\n        "+d+" sourceLocB = coords;\n        --"+h[u-2]+";";var p=["x","y","z","w","u","v"].slice(0,l),m="."+p[l-1],x=p.map(function(j){return"int "+j}),y=on("sourceLocR",l-1).concat("inIdx.r"),g=on("sourceLocG",l-1).concat("inIdx.g"),v=on("sourceLocB",l-1).concat("inIdx.b"),w=on("sourceLocA",l-1).concat("inIdx.a"),b=n==="max"?"greaterThan":"lessThan",N=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+w.join()+")));",_="vec4(\n            getAChannel("+y.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+v.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+w.join()+") : 0.)",k=r?"":"\n      float getBestIndicesAChannel("+x.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+x.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+k+"\n      void main() {\n        "+d+" coords = getOutputCoords();\n        bool hasNextCol = "+h[u-1]+" < "+(c[u-1]-1)+";\n        bool hasNextRow = "+h[u-2]+" < "+(c[u-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+m+", sourceLocG"+m+",\n          sourceLocB"+m+", sourceLocA"+m+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+N+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},tC=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+u+", "+d+");\n      const float avgMultiplier = float("+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+";\n            wR += "+s+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+c+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},nC=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=h-1-e.padInfo.top,x=f-1-e.padInfo.left,y=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+p+", "+m+", "+x+");\n      const float avgMultiplier = float("+y+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+l+") {\n          float dyD = float(dyDCorner + wD) / "+a+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+h+";\n              wR += "+c+") {\n            float dyR = float(dyRCorner + wR) / "+s+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+u+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},rC=function(e,t,n,r,a,s){this.outputShape=[],this.variableNames=["x","mean","variance"],Le(e,t),Le(e,n);var o="0.0";r!=null&&(Le(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var l="1.0";a!=null&&(Le(e,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+l+";\n        float inv = scale * inversesqrt(variance + float("+s+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},aC=function(e,t,n,r,a,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Le(e,t),Le(e,n);var o="vec4(0.0)";r!=null&&(Le(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var l="vec4(1.0)";a!=null&&(Le(e,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+l+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+s+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},sC="return areal * breal - aimag * bimag;",oC="return areal * bimag + aimag * breal;",xg=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Le(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Lu="return a + b;",Bu="return a - b;",yg="return a * b;",_y="return (a < 0.) ? b * a : a;",ct=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Le(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},jy="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",_r=function(e,t,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Le(t,n);var a=this.outputShape.length,s="";if(r)if(a===0||be(this.outputShape)===1)s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(s="\n          "+Ke(a)+" coords = getOutputCoords();\n        ",a===1)s+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=on("coords",a);s+="\n            bool nextRowOutOfBounds =\n              ("+o[a-2]+" + 1) >= "+this.outputShape[a-2]+";\n            bool nextColOutOfBounds =\n              ("+o[a-1]+" + 1) >= "+this.outputShape[a-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+s+"\n\n        setOutput(result);\n      }\n    "},iC=function(){function e(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(a,s){r.minLoc==null&&(r.minLoc=a.getUniformLocationNoThrow(s,"minVal"),r.maxLoc=a.getUniformLocationNoThrow(s,"maxVal")),a.gl.uniform1f(r.minLoc,t),a.gl.uniform1f(r.maxLoc,n)}},e}(),lC=function(){function e(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(a,s){r.minLoc==null&&(r.minLoc=a.getUniformLocationNoThrow(s,"minVal"),r.maxLoc=a.getUniformLocationNoThrow(s,"maxVal")),a.gl.uniform1f(r.minLoc,t),a.gl.uniform1f(r.maxLoc,n)}},e}(),cC=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},uC=function(e){this.outputShape=[],this.outputShape=Qs(e,1),this.variableNames=e.map(function(l,c){return"T"+c});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var a=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+a+"));")}var s=t.length,o=t[t.length-1];r.push("else setOutput(getT"+s+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},dC=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Qs(e,t);var n=this.outputShape,r=n.length,a=Ke(r),s=on("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(y,g){return"T"+g});var l=new Array(e.length-1);l[0]=e[0][t];for(var c=1;c<l.length;c++)l[c]=l[c-1]+e[c][t];var u=o[t],d=o.slice(-2),h=o.join(),f="if ("+u+" < "+l[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+d.join()+"));\n        }";for(c=1;c<l.length;c++){var p=l[c-1];f+="\n        if ("+u+" < "+l[c]+"  && "+u+" >= "+l[c-1]+") {\n          return getChannel(\n            getT"+c+"("+Zi(o,u,p)+"),\n            vec2("+Zi(d,u,p)+"));\n        }"}var m=l.length,x=l[l.length-1];f+="\n        return getChannel(\n          getT"+m+"("+Zi(o,u,x)+"),\n          vec2("+Zi(d,u,x)+"));",this.userCode="\n      float getValue("+o.map(function(y){return"int "+y})+") {\n        "+f+"\n      }\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+s+"), 0., 0., 0.);\n\n        "+s[r-1]+" = "+s[r-1]+" + 1;\n        if ("+s[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+s+");\n        }\n\n        "+s[r-2]+" = "+s[r-2]+" + 1;\n        if ("+s[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+s+");\n        }\n\n        "+s[r-1]+" = "+s[r-1]+" - 1;\n        if ("+s[r-2]+" < "+n[r-2]+" &&\n            "+s[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+s+");\n        }\n        setOutput(result);\n      }\n    "};function Zi(e,t,n){var r=e.indexOf(t);return e.map(function(a,s){return s===r?a+" - "+n:a}).join()}var hC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.dataFormat==="channelsLast";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+s+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},fC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dataFormat==="channelsLast",o=t-1-e.padInfo.top,l=n-1-e.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+l+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+d+"];\n\n        ivec2 dyCorner = ivec2(coords["+c+"], coords["+u+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+s+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},pC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,s=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+a+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+s+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},mC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=t-1-e.padInfo.front,c=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+c+", "+u+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+a+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+s+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},gC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+s+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+s+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+l+"; dm++) {\n              int d2 = d1 * "+l+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},bg=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.padInfo.top,s=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4,m=e.dataFormat==="channelsLast",x=m?1:2,y=m?2:3,g=m?3:1,v="",w="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",w="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+o+", "+l+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+x+"], coords["+y+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+m+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(p===1)+") {\n\n              if ("+m+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(p===2)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+m+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(p===3)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+m+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+w+"\n        setOutput(result);\n      }\n    "},xC=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,f=e.filterWidth,p=4*Math.floor(e.inChannels/4),m=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+a+", "+s+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+d+"; wF++) {\n          int xF = xFCorner + wF * "+l+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+c+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+u+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(m===1)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+p+") *\n                  getW(wF, wR, wC, "+p+", d2);\n              } else if ("+(m===2)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(m===3)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1),\n                  getX(batch, xF, xR, xC, "+p+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2),\n                  getW(wF, wR, wC, "+p+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},wg=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.inHeight,s=e.inWidth,o=e.padInfo.top,l=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=e.outChannels/e.inChannels,x="",y="";n&&(x=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",y="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+c+", "+u+");\n      const ivec2 pads = ivec2("+o+", "+l+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+m+";\n        int q = d2 - d1 * "+m+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+d+";\n\n          if (xR < 0 || xR >= "+a+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+s+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+y+"\n        setOutput(result);\n      }\n    "},Ng=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var a=e.inHeight,s=e.inWidth,o=e.padInfo.top,l=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=p,x="int xR; int xC; int xCOffset;",y=0;y<f;y++)for(var g=0;g<p;g++)x+="\n          vec4 xTexelR"+y+"C"+2*g+" = vec4(0.);\n          vec4 wR"+y+"C"+g+" = vec4(0.);\n          vec4 xR"+y+"C"+g+" = vec4(0.);";for(y=0;y<f;y++)for(var v=0;v<m;v++){if(x+="\n          xR = xRCorner + "+y*d+";\n          xC = xCCorner + "+(g=2*v)*h+";\n        ",u===1){if(g<p&&(x+=l%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+s+") {\n                  xTexelR"+y+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+s+") {\n                    xTexelR"+y+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+y+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+s+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+s+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+y+"C"+g+" = vec4(previous.zw, xTexelR"+y+"C"+g+".xy);\n                } else {\n                  xR"+y+"C"+g+" = vec4(0, 0, xTexelR"+y+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+a+" && xC >= 0 && xC < "+s+") {\n                  xTexelR"+y+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+y+"C"+g+" = vec4(0.);\n                }\n\n                xR"+y+"C"+g+" = xTexelR"+y+"C"+g+";\n              ",g+1<p)){var w=l%2==0?z0(h):h;h%2==0&&l%2==1||h%2!=0&&l%2!=1?(x+="\n                  xCOffset = xC + "+l%2+" + "+w+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+s+") {\n                    xTexelR"+y+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(x+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+a+" &&\n                      xCOffset >= 0 && xCOffset < "+s+") {\n                      xTexelR"+y+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+y+"C"+g+" = vec4(0.);\n                    }\n                  "),x+="\n                  xR"+y+"C"+(g+1)+" = vec4(\n                    xTexelR"+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+".xy);\n                "):x+="\n                  xCOffset = xC + "+w+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+s+") {\n                    xTexelR"+y+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+y+"C"+(g+1)+" = xTexelR"+y+"C"+(g+2)+";\n                "}}else g<p&&(x+="\n              if(xR >= 0 && xR < "+a+") {\n            ",l%2==1?(x+="\n                xCOffset = xC + 1 - "+u+";\n                if(xCOffset >= 0 && xCOffset < "+s+") {\n                  xTexelR"+y+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+y+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+s+") {\n                  xTexelR"+y+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+y+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+y+"C"+g+" = vec4(\n                  xTexelR"+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+".zw);\n              ",g+1<p&&(x+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+u+";\n                  if(xCOffset >= 0 && xCOffset < "+s+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+y+"C"+(g+1)+" = vec4(xTexelR"+y+"C"+(g+2)+".xy, final.xy);\n                ")):(x+="\n                if(xC >= 0 && xC < "+s+") {\n                  xTexelR"+y+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+y+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+u+";\n                if(xCOffset >= 0 && xCOffset < "+s+") {\n                  xTexelR"+y+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+y+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+y+"C"+g+" = vec4(\n                  xTexelR"+y+"C"+g+".xy, xTexelR"+y+"C"+(g+2)+".xy);\n              ",g+1<p&&(x+="\n                  xR"+y+"C"+(g+1)+" = vec4(\n                    xTexelR"+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+".zw);\n                ")),x+="}");g<p&&(x+="\n            vec4 wTexelR"+y+"C"+g+" = getW("+y+", "+g+", d1, q);\n            wR"+y+"C"+g+" = vec4(wTexelR"+y+"C"+g+".xz, wTexelR"+y+"C"+g+".xz);\n          ",g+1<p&&(x+="\n              vec4 wTexelR"+y+"C"+(g+1)+" = getW("+y+", "+(g+1)+", d1, q);\n              wR"+y+"C"+(g+1)+" =\n                vec4(wTexelR"+y+"C"+(g+1)+".xz, wTexelR"+y+"C"+(g+1)+".xz);"))}for(y=0;y<f;y++)for(g=0;g<p;g++)x+="dotProd += xR"+y+"C"+g+" * wR"+y+"C"+g+";";var b="",N="";n&&(b=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",N="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+c+", "+u+");\n      const ivec2 pads = ivec2("+o+", "+l+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+x+"\n\n        vec4 result = dotProd;\n        "+_+"\n        "+N+"\n        setOutput(result);\n      }\n    "},yC=function(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var s=e[0],o=e[1],l=e[2],c=e[3],u=t[0],d=n[0],h=n[1];this.outputShape=[u,d,h,c];var f=r==="bilinear"?1:0,p=[o-1+".0",l-1+".0"],m=p[0],x=p[1],y=d>1?[""+(o-1)/(d-1),"(y2-y1) * height_ratio","y1*"+m+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+m],g=y[0],v=y[1],w=y[2],b=h>1?[""+(l-1)/(h-1),"(x2-x1) * width_ratio","x1*"+x+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+x],N=b[0],_=b[1],k=b[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+N+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+s+") {\n          return;\n        }\n\n        float height_scale = "+v+";\n        float width_scale = "+_+";\n\n        float in_y = "+w+";\n        if( in_y < 0.0 || in_y > "+m+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n        float in_x = "+k+";\n        if( in_x < 0.0 || in_x > "+x+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+f+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},bC=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,a=e[e.length-1],s=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+a+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Ke(r)+" coords = getOutputCoords();\n        int end = "+_g(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+a+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+s+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+_g(r,"coords")+" = idx;\n          val += getX("+function(o,l){if(o===1)return""+l;if(o===2)return l+".x, "+l+".y";if(o===3)return l+".x, "+l+".y, "+l+".z";if(o===4)return l+".x, "+l+".y, "+l+".z, "+l+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function _g(e,t){if(e===1)return""+t;if(e===2)return t+".y";if(e===3)return t+".z";if(e===4)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var wC=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=hi.DENSE;var t=Mo(e),n=qt();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Oa(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},NC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=hi.DENSE;var t=Mo(e),n=qt();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Oa(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},_C=function(){function e(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+n+";\n      int offset_h = imod(h, "+n+");\n      int in_w = w / "+n+";\n      int offset_w = imod(w, "+n+");\n      int offset_d = (offset_h * "+n+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),jC=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},kC=function(e){this.variableNames=["A"],this.outTexUsage=wn.DOWNLOAD;var t=qt();this.outputShape=e,this.userCode="\n      "+wy+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},CC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=wn.DOWNLOAD;var t=qt();this.outputShape=e,this.userCode="\n      "+wy+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},SC=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=qt(),a=t[0],s=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+Wf(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+s+";\n        int c = imod(flatIndex, "+s+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+s+".0, "+a+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},EC=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=qt(),a=t[0],s=t[1];this.outputShape=e;var o="",l="result";n&&(l="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var u=0;u<=1;u++){var d=2*c+u;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+u+" < "+e[2]+") {\n            localCoords[2] += "+u+";\n            if(localCoords[1] + "+c+" < "+e[1]+") {\n              localCoords[1] += "+c+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+s+";\n              c = imod(flatIndex, "+s+");\n              uv = (vec2(c, r) + halfCR) / vec2("+s+".0, "+a+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+d+"] = values[0];\n              } else if(offset == 1) {\n                result["+d+"] = values[1];\n              } else if(offset == 2) {\n                result["+d+"] = values[2];\n              } else {\n                result["+d+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Wf(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+l+";\n      }\n    "},RC="return real * expR - imag * expI;",DC="return real * expI + imag * expR;",jg=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var a=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,s=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+a+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+s+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},IC=function(){function e(t,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,a){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(a,"value")),r.gl.uniform1f(n.valueLoc,t)}},e}(),AC=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var a=Ke(this.rank),s=function(o,l){var c=o.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(c===1)return"int(getIndices(resRC))";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w"],d=[],h=0;h<o.length;h++)h===l?d.push("int(getIndices("+u[h]+"))"):d.push(""+u[h]);return d.join()}(e,n);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+s+"));\n      }\n    "},TC=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Ke(t.length),a=Ke(n.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+a+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+s+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function PC(e,t){var n=qt();return Rj(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function FC(e,t){return Pj(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function MC(e,t){return Fj(e,t,new Uint16Array([0,1,2,2,1,3]))}function ki(e,t,n,r,a,s,o){Oj(n,r);var l=Mj(e,t),c=e.TEXTURE_2D;return we(e,t,function(){return e.bindTexture(c,l)}),we(e,t,function(){return e.texParameteri(c,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),we(e,t,function(){return e.texParameteri(c,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),we(e,t,function(){return e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.NEAREST)}),we(e,t,function(){return e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST)}),we(e,t,function(){return e.texImage2D(c,0,a,n,r,0,s,o,null)}),we(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),l}function OC(e,t,n,r,a){var s=Lc(n,r);return ki(e,t,s[0],s[1],a.internalFormatFloat,a.textureFormatFloat,e.FLOAT)}function LC(e,t,n,r,a){var s=Lc(n,r);return ki(e,t,s[0],s[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function BC(e,t,n,r,a){var s=Lc(n,r);return ki(e,t,s[0],s[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function WC(e,t,n,r,a){var s=ji(n,r);return ki(e,t,s[0],s[1],a.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function $C(e,t,n,r,a){var s=ji(n,r);return ki(e,t,s[0],s[1],a.internalFormatPackedHalfFloat,e.RGBA,a.textureTypeHalfFloat)}function zC(e,t,n,r){return we(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),dg(e,t,n,"clipSpacePos",r,3,20,0)&&dg(e,t,n,"uv",r,2,20,12)}function UC(e,t,n,r,a,s,o){var l,c,u;we(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),s instanceof Uint8Array?(l=new Uint8Array(r*a*4),c=e.UNSIGNED_BYTE,u=e.RGBA):(l=new Float32Array(r*a*4),c=e.FLOAT,u=o.internalFormatPackedFloat),l.set(s),we(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,u,r,a,0,e.RGBA,c,l)}),we(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function VC(e,t,n,r){we(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?we(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):we(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),we(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function qC(e,t,n,r,a){var s=e.createBuffer();we(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,s)});var o=16*n*r;return we(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)}),we(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),we(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),s}function HC(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function GC(e,t,n,r,a){var s=Lc(n,r),o=s[0],l=s[1],c=new Uint8Array(n*r*4);return we(e,t,function(){return e.readPixels(0,0,o,l,a.downloadTextureFormat,e.UNSIGNED_BYTE,c)}),new Float32Array(c.buffer)}function KC(e,t,n,r,a,s,o,l){var c=e,u=new Float32Array(function(d,h){var f=ji(d,h);return f[0]*f[1]*4}(s,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}function XC(e,t,n,r){var a=new Float32Array(n*r*4);return we(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,a)}),a}var YC=function(){function e(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=Z().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,jj(n,t)):this.gl=vr(n);var r="WEBGL_color_buffer_float";if(Z().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Xi(this.gl,this.debug,"OES_texture_float"),Mn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Xi(this.gl,this.debug,"OES_texture_half_float");else if(Z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Mn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Xi(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Mn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Mn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=FC(this.gl,this.debug),this.indexBuffer=MC(this.gl,this.debug),this.framebuffer=Lj(this.gl,this.debug),this.textureConfig=Df(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return Z().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;we(n,this.debug,function(){return n.finish()}),we(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),we(n,this.debug,function(){return n.deleteFramebuffer(t.framebuffer)}),we(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),we(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),we(n,this.debug,function(){return n.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(t,n){return this.throwIfDisposed(),OC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(t,n){return this.throwIfDisposed(),LC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(t,n){return this.throwIfDisposed(),BC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(t,n){this.throwIfDisposed(),VC(this.gl,this.debug,t,n)},e.prototype.uploadDenseMatrixToTexture=function(t,n,r,a){this.throwIfDisposed(),UC(this.gl,this.debug,t,n,r,a,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(t,n){return this.throwIfDisposed(),$C(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(t,n){return this.throwIfDisposed(),WC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(t){var n=this;this.throwIfDisposed(),this.outputTexture===t&&(hg(this.gl,this.debug,this.framebuffer),this.outputTexture=null),we(this.gl,this.debug,function(){return n.gl.deleteTexture(t)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,n,r){var a=this;return this.downloadMatrixDriver(t,function(){return GC(a.gl,a.debug,n,r,a.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(t,n,r,a,s,o){return KC(this.gl,t,0,0,0,s,o,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(t,n){return HC(this.gl,t,n)},e.prototype.createBufferFromTexture=function(t,n,r){this.bindTextureToFrameBuffer(t);var a=qC(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},e.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},e.prototype.createFence=function(t){var n,r,a=this;if(Z().getBool("WEBGL_FENCE_API_ENABLED")){var s=t,o=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var l=s.clientWaitSync(o,0,0);return l===s.ALREADY_SIGNALED||l===s.CONDITION_SATISFIED},n=o}else Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return a.isQueryAvailable(n,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(t,n,r){var a=this;return this.downloadMatrixDriver(t,function(){return XC(a.gl,a.debug,n,r)})},e.prototype.createProgram=function(t){this.throwIfDisposed();var n=this.gl,r=Dj(n,this.debug,t),a=PC(n,this.debug),s=Aj(n,this.debug);return we(n,this.debug,function(){return n.attachShader(s,a)}),we(n,this.debug,function(){return n.attachShader(s,r)}),Tj(n,this.debug,s),this.debug&&Pu(n,this.debug,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=zC(n,this.debug,this.program,this.vertexBuffer)),s},e.prototype.deleteProgram=function(t){var n=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&we(this.gl,this.debug,function(){return n.gl.deleteProgram(t)})},e.prototype.setProgram=function(t){var n=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Pu(this.gl,this.debug,this.program),we(this.gl,this.debug,function(){return n.gl.useProgram(t)})},e.prototype.getUniformLocation=function(t,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?Wj(this.gl,this.debug,t,n):$j(this.gl,t,n)},e.prototype.getAttributeLocation=function(t,n){var r=this;return this.throwIfDisposed(),we(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,n)})},e.prototype.getUniformLocationNoThrow=function(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)},e.prototype.setInputMatrixTexture=function(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),zj(this.gl,this.debug,this.program,t,n,r)},e.prototype.setOutputMatrixTexture=function(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)},e.prototype.setOutputPackedMatrixTexture=function(t,n,r){this.throwIfDisposed();var a=ji(n,r),s=a[0],o=a[1];this.setOutputMatrixTextureDriver(t,s,o)},e.prototype.setOutputMatrixWriteRegion=function(t,n,r,a){this.setOutputMatrixWriteRegionDriver(r,t,a,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(t,n,r,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&Pu(this.gl,this.debug,this.program),Yi(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),we(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),we(this.gl,this.debug,function(){return t.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Xi(this.gl,this.debug,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(n.TIME_ELAPSED_EXT,r),r}var a=this.getQueryTimerExtensionWebGL1(),s=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,s),s},e.prototype.endQuery=function(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(t){return xe(this,void 0,void 0,function(){var n=this;return ye(this,function(r){switch(r.label){case 0:return[4,sg(function(){return n.disposed||n.isQueryAvailable(t,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(t,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(t,n){if(n===0)return!0;if(n===2){var r=this.gl,a=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),s&&!this.disjoint}return s=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,a.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),s&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var t=function(r){for(var a=0;a<r.length&&r[a]();++a);return a-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=t;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},e.prototype.addItemToPoll=function(t,n){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||sg(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Fu(this.gl,this.debug,t,this.framebuffer),this.debug&&Yi(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Fu(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Yi(this.gl)):hg(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(t,n){this.bindTextureToFrameBuffer(t);var r=n();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(t,n,r){this.throwIfDisposed();var a=this.gl;Fu(a,this.debug,t,this.framebuffer),this.debug&&Yi(a),this.outputTexture=t,we(a,this.debug,function(){return a.viewport(0,0,n,r)}),we(a,this.debug,function(){return a.scissor(0,0,n,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(t,n,r,a){var s=this;this.throwIfDisposed(),we(this.gl,this.debug,function(){return s.gl.scissor(t,n,r,a)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function kg(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(n,r){var a=n.logicalShape,s=t[r],o=s.shape;if(!It(a,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+a+" and "+o+" must match");if(!n.isUniform||!s.isUniform){var l=n.texShape,c=s.isUniform?null:s.texData.texShape;if(!It(l,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+l+" and "+c+" must match")}})}var QC=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,a=n.inChannels,s=n.strideWidth,o=n.strideHeight,l=n.padInfo,c=n.outWidth,u=n.dilationWidth,d=n.dilationHeight,h=n.dataFormat,f=l.left,p=l.top,m=a*r,x=qt(),y=h==="channelsLast",g=y?0:1,v=y?1:2,w="",b=0;b<=1;b++)for(var N=0;N<=1;N++)w+="\n          blockIndex = rc.y + "+N+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+c+")) * "+o+" - "+p+";\n            d0 = offsetY + "+d+" * (pos / "+m+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+c+".) * "+s+". - "+f+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+m+".) / "+a+".));\n\n              if(d1 < "+t[v]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+a+".));\n\n                if ("+y+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+N)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+N)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+w+"\n\n        "+x.output+" = result;\n      }\n    "},JC=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];var s,o=t,l=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";s=a===.5?"inversesqrt("+c+")":a===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+l+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+s+";\n        setOutput(val);\n      }\n    "},ZC=function(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+a+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+a+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},eS=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var s,o=t,l=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";s=a===.5?"inversesqrt("+c+")":a===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+l+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+s+";\n        setOutput(result);\n      }\n    "},tS=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,s=e.effectiveFilterWidth,o=a-1-e.padInfo.top,l=s-1-e.padInfo.left,c=a*s-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+l+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+s+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+c+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+s+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},nS=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=c-1-e.padInfo.top,f=u-1-e.padInfo.left,p=l*c*u-1;this.userCode="\n      const ivec3 pads = ivec3("+d+", "+h+", "+f+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n           wD += "+a+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+s+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+p+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+c+" * "+u+" +\n                  wR * "+u+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wu=function(e,t,n,r,a,s,o){n===void 0&&(n=!1),r===void 0&&(r=!1),a===void 0&&(a=!1),s===void 0&&(s=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var l=n?e[1]:e[2],c=Math.ceil(l/2),u=n?"i * 2, rc.y":"rc.y, i * 2",d=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",m="";s&&(p=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+s+"\n        }":"vec4 activation(vec4 x) {\n          "+s+"\n        }",m="result = activation(result);");var x=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+c+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+c+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+d+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+h[0]+" * "+f[0]+");\n          result += ("+h[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+x+"\n\n        "+m+"\n\n        setOutput(result);\n      }\n    "},rS=function(){function e(t,n,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(n-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(n-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,a){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(a,"seed")),r.gl.uniform1f(n.seedLoc,t)}},e}(),aS=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},sS=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(t===0)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=on("rc",t),r=Ke(t),a=function(l,c,u){if(l===1)return"rc > "+c[0];for(var d="",h=l-2;h<l;h++)d+=u[h]+" >= "+c[h],h<l-1&&(d+="||");return d}(t,e,n),s=function(l,c,u,d){if(l===1)return"";var h=d.slice(-2);return"\n    int r = "+h[0]+";\n    int c = "+h[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+c+";\n    bool rEdge = rp1 >= "+u+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(l,c){var u=l.length,d=function(h,f){for(var p=[],m=0;m<=1;m++)for(var x=0;x<=1;x++){for(var y=(m===0?"r":"rp1")+", "+(x===0?"c":"cp1"),g=2;g<h;g++)y=f[f.length-1-g]+","+y;p.push(y)}return p}(u,c);return u===1?"getA(rc),\n            rc + 1 >= "+l[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+d[0]+"),\n          cEdge ? 0. : getA("+d[1]+"),\n          rEdge ? 0. : getA("+d[2]+"),\n          rEdge || cEdge ? 0. : getA("+d[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+a+") {\n            setOutput(vec4(0));\n          } else {\n            "+s+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}},oS=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(c,u){return c[0]+e[u]+c[1]});var r=e.length,a=Ke(r),s=t.map(function(c){return c[0]}).join(","),o=t.map(function(c,u){return c[0]+e[u]}).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?"\n      "+a+" start = "+a+"("+s+");\n      "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+a+" coords = outC - start;\n          setOutput(getX("+l+"));\n        }\n      }\n    ":"\n        int start = "+s+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},iS=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(y,g){return y[0]+e[g]+y[1]});for(var r=e.length,a=Ke(r),s=t.map(function(y){return y[0]}).join(","),o=t.map(function(y,g){return y[0]+e[g]}).join(","),l=on("rc",r),c=on("source",r),u=l[r-1]+" < "+this.outputShape[r-1],d=r===1?"source":"vec2("+c.slice(-2).join()+")",h=[a+" rc = outputLoc;",l[r-1]+" += 1;\n       if("+u+") {\n      ",r===1?"":"}\n       rc = outputLoc;\n       "+l[r-2]+" += 1;\n       if("+l[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+l[r-1]+" += 1;\n         if("+u+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",m=0,x=r===1?2:4;m<x;m++)p+="\n        "+h[m]+"\n        if ("+f+") {\n          result["+m+"] = float("+n+");\n        } else {\n          "+a+" source = rc - start;\n          result["+m+"] = getChannel(getX("+c.join()+"), "+d+");\n        }\n      ";p+=r===1?"} ":"}}",this.userCode="\n      const "+a+" start = "+a+"("+s+");\n      const "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+p+"\n        setOutput(result);\n      }\n    "},$u=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideHeight,s=e.strideWidth,o=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var f=t==="avg",p="0.0";if(f||(p="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+a+", "+s+");\n        const ivec2 pads = ivec2("+d+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+o+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+l+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+u+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var m=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(m="avgValue / count");var x=4*Math.floor(r/4),y=r%4,g="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+d+", "+h+");\n      const float initializationValue = "+p+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+p+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+c+";\n            wR += "+o+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+x+"; wC += 4) {\n            int xC = xCCorner + wC * "+l+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              getValue(batch, xR, xC + 2 * "+l+", d),\n              getValue(batch, xR, xC + 3 * "+l+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+x+";\n          if ("+(y===1)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(y===2)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(y===3)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+l+", d),\n              getValue(batch, xR, xC + 2 * "+l+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+m+");\n      }\n    "}},zu=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,m=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;var y=t==="avg",g="0.0";if(y||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+a+", "+s+", "+o+");\n        const ivec3 pads = ivec3("+p+", "+m+", "+x+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+d+";\n              wD += "+l+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+c+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+u+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var v=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(v="avgValue / count");var w=4*Math.floor(r/4),b=r%4,N="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+a+", "+s+", "+o+");\n      const ivec3 pads = ivec3("+p+", "+m+", "+x+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+l+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+c+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+u+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+u+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+u+", ch)\n              );\n\n              "+N+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(b===1)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+N+"\n            } else if ("+(b===2)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+N+"\n            } else if ("+(b===3)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+u+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+u+", ch),\n                initializationValue\n              );\n\n              "+N+"\n            }\n          }\n          setOutput("+v+");\n        }\n      }\n    "}},lS=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,s=Math.ceil(a/n);this.outputShape=[r,s];var o="0.0",l="";t==="prod"?o="1.0":t==="min"?(o="1.0 / 1e-20",l="min"):t==="max"&&(o="-1.0 / 1e-20",l="max");var c=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var u=4*Math.floor(n/4),d=n%4,h="\n      if ("+(t==="sum")+") {\n        sumValue += dot(values, ones);\n      } else if ("+(t==="prod")+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+l+"(values, minMaxValue);\n      }\n    ",f="vec4";t==="all"?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):t==="any"&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var p="";a%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+p+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(d===1)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(d===2)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(d===3)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+c+");\n      }\n    "},cS=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var a="thisRC = rc;";r%2==1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+="\n        "+a+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Oa(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Wf(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},uS=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],s=r[2],o=e.shape,l=o[1],c=o[2],u=[n&&l>1?a-1:a,n&&c>1?s-1:s],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],h=u[0]/d[0],f=u[1]/d[1],p=1/h,m=1/f,x=2*Math.ceil(p)+2,y=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+m+");\n\n        const int winHeight = int("+x+");\n        const int winWidth = int("+y+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+l+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(a-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(s-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},dS=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],s=e[1],o=e[2],l=e[3];this.outputShape=[a,t,n,l];var c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+s+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},hS=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=e[0],s=e[1],o=e[2],l=e[3];this.outputShape=[a,t,n,l];var c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+",\n          "+c[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+s+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(l-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},fS=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],s=r[2],o=e.shape,l=o[1],c=o[2],u=[n&&l>1?a-1:a,n&&c>1?s-1:s],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],h=u[0]/d[0],f=u[1]/d[1],p=1/h,m=1/f,x=2*Math.ceil(p)+2,y=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+m+");\n\n        const int winHeight = int("+x+");\n        const int winWidth = int("+y+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+l+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+u[0]+") *\n                (float(dyR) / float("+d[0]+"));\n\n            float sourceFracCol =\n                float("+u[1]+") *\n                  (float(dyC) / float("+d[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+s+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},pS=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],s=e[1],o=e[2],l=e[3];this.outputShape=[a,t,n,l];var c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+s+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+d+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},mS=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n!==1){var r=e.map(function(s,o){return function(l){return t.indexOf(l)!==-1&&e[l]!==1?e[l]+" - coords["+l+"] - 1":"coords["+l+"]"}(o)}).join(","),a=Ke(n);this.userCode="\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},gS=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=on("rc",n),a=r[n-1]+" + 1 < "+this.outputShape[n-1],s=r[n-2]+" + 1 < "+this.outputShape[n-2],o=Ke(n);function l(c){var u=e.map(function(d,h){return function(f,p){return t.indexOf(f)!==-1&&e[f]!==1?e[f]+" - "+p[f]+" - 1":""+p[f]}(h,c)});return"getChannel(getX("+u.join(",")+"), vec2("+u.slice(-2).join(",")+"))"}this.userCode=n===1?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+a+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(c){return l(c)}(r.slice())+";\n          if("+a+"){\n            result.g = "+function(c){return c[n-1]="("+c[n-1]+" + 1)",l(c)}(r.slice())+";\n          }\n          if("+s+") {\n            result.b = "+function(c){return c[n-2]="("+c[n-2]+" + 1)",l(c)}(r.slice())+";\n            if("+a+") {\n              result.a = "+function(c){return c[n-1]="("+c[n-1]+" + 1)",c[n-2]="("+c[n-2]+" + 1)",l(c)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Cg=function(e,t,n,r,a,s,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;var l=Ke(a.length),c=Ke(s.length),u="";n===1?u="i":n===2&&(u="i, j");var d="getIndices("+u+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var f="getUpdates("+h+")",p=t>1?"strides[j]":"strides";this.userCode="\n        "+l+" strides = "+l+"("+a+");\n\n        void main() {\n          "+c+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+d+");\n              flattenedIndex += index * "+p+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+f+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},vS=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,a=e.inSize,s=e.numSegments,o=s*Math.ceil(a/n);this.outputShape=[r,o];var l=4*Math.floor(n/4),c=n%4,u="\n        sumValue += dot(values, segFilter);\n    ",d="";a%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      ");var h="";a%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+s+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+s+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+u+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(c===1)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+u+"\n        } else if ("+(c===2)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+u+"\n        } else if ("+(c===3)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+u+"\n        }\n        setOutput(sumValue);\n      }\n    "},xS=function(e,t,n){var r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)a="resRC",r="resRC";else{for(var s=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],l=[],c=0;c<t.length;c++)l.push(""+s[c]),c<e&&o.push(""+s[c]);r=o.join(),a=l.join()}var u=Ke(n);this.userCode="\n      void main() {\n        "+u+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+a+"));\n        } else {\n          setOutput(getB("+a+"));\n        }\n      }\n    "},yS=function(){function e(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=Ke(this.rank),a="uniform int start["+this.rank+"];",s=function(o){if(o===1)return"sourceLoc";if(o<=6)return Uu.slice(0,o).map(function(l){return"sourceLoc."+l}).join(",");throw Error("Slicing for rank "+o+" is not yet supported")}(this.rank);n="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+t.map(function(o,l){return"sourceLoc."+Uu[l]+" = start["+l+"] + coords."+Uu[l]+";"}).join("\n")+"\n      ",this.userCode="\n      "+a+"\n      void main() {\n        "+n+"\n        setOutput(getSource("+s+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,a){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(a,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),Uu=["x","y","z","w","u","v"],bS=function(){function e(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=Ke(this.rank),r=on("coords",this.rank),a=on("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",o="getChannel(getSource("+a.join()+"), "+s+")",l="\n      result.x = "+o+";\n      if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+a[this.rank-1]+";\n        result.y = "+o+";\n        --"+a[this.rank-1]+";\n      }\n    ",c=this.rank===1?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+a[this.rank-2]+";\n        result.z = "+o+";\n        if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+a[this.rank-1]+";\n          result.w = "+o+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+n+"("+t.map(function(d,h){return"start["+h+"]"}).join()+");":t.map(function(d,h){return a[h]+" = "+r[h]+" + start["+h+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+n+" coords = getOutputCoords();\n        "+n+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+l+"\n        "+c+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,a){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(a,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),wS=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,a=Ke(n.length),s=Ke(n.length),o="";if(r===1)o="coords * strides + begin";else{var l=0;o=n.map(function(c,u){return l++,n.length===1?"coords * strides["+u+"] + begin["+u+"]":"coords["+(l-1)+"] * strides["+u+"] + begin["+u+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+e+");\n      "+a+" strides = "+a+"("+t+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "},NS=function(){function e(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(t,n,r){var a,s=Sg(n,r),o=Eg(t,s,r);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var l=this.freeTextures[o].shift();return this.usedTextures[o].push(l),l}return this.numUsedTextures++,this.log(),s===yn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):s===yn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):s===yn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):s===yn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):s===yn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[o].push(a),a},e.prototype.releaseTexture=function(t,n,r,a){if(this.freeTextures!=null){var s=Eg(n,Sg(r,a),a);s in this.freeTextures||(this.freeTextures[s]=[]),this.freeTextures[s].push(t),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[s],l=o.indexOf(t);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(l,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(a){t.gpgpu.deleteMatrixTexture(a)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Sg(e,t){if(e===wn.UPLOAD)return yn.PACKED_2X2_FLOAT32;if(e===wn.RENDER||e==null)return function(n){return Z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?yn.PACKED_2X2_FLOAT32:yn.UNPACKED_FLOAT32:n?yn.PACKED_2X2_FLOAT16:yn.UNPACKED_FLOAT16}(t);if(e===wn.DOWNLOAD||e===wn.PIXELS)return yn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Eg(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var _S=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var a=Ke(this.rank),s=function(o){var l=o.length;if(l>5)throw Error("Tile for rank "+l+" is not yet supported");if(l===1)return"imod(resRC, "+o[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],u=[],d=0;d<o.length;d++)u.push("imod("+c[d]+", "+o[d]+")");return u.join()}(e);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+s+"));\n      }\n    "},jS=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var a=Ke(this.rank),s=function(o){var l=o.length;if(l>6)throw Error("Transpose for rank "+l+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],u=new Array(l),d=0;d<o.length;d++)u[o[d]]=c[d];return u.join()}(t);this.userCode="\n    void main() {\n      "+a+" resRC = getOutputCoords();\n      setOutput(getA("+s+"));\n    }\n    "},kS=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=Ke(this.rank),s=by("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=s[r];var l="vec2("+o.slice(-2).join()+")",c="++"+s[this.rank-1]+" < "+n[this.rank-1],u="getChannel(getA("+o.join()+"), "+l+")";this.userCode="\n    void main() {\n      "+a+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+u+";\n      if("+c+") {\n        result[1] = "+u+";\n      }\n      --"+s[this.rank-1]+";\n      if(++"+s[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+u+";\n        if("+c+") {\n          result[3] = "+u+";\n        }\n      }\n      setOutput(result);\n    }\n    "},$f=1.7580993408473768,zf=1.0507009873554805,Me=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},tr="if (isnan(x)) return x;",CS="return x;",Rg="return abs(x);",ky=tr+"\n  return (x < 0.0) ? 0.0 : x;\n",Cy=tr+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Sy="return (x >= 0.0) ? x : (exp(x) - 1.0);",SS="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+$f+";\n  float scale = "+zf+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",Dg="return -x;",Ig="return ceil(x);",Ag="return floor(x);",Tg="return exp(x);",Pg="return exp(x) - 1.0;",ES=tr+"\n  return sin(x);\n",RS=tr+"\n  return cos(x);\n",DS=tr+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",IS=tr+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",AS=tr+"\n  return atan(x);\n",TS=tr+"return log(x + sqrt(x * x + 1.0));",PS=tr+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",FS=tr+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",el="return x;",MS="return x;",Ey="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ry="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Dy="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",No=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},OS=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=on("rc",t),r=Ke(t),a=function(l,c){if(l===1)return"rc";for(var u="",d=0;d<l;d++)u+=c[d],d<l-1&&(u+=",");return u}(t,n),s=n.slice(-2),o=t<=1?"rc":"vec2("+s.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+a+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},tl={};function nl(e,t){if(t===void 0&&(t=!1),e==="linear")return t?MS:CS;if(e==="relu")return t?Ey:ky;if(e==="elu")return t?Dy:Sy;if(e==="relu6")return t?Ry:Cy;if(e==="prelu")return t?jy:_y;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var LS=600,BS=function(e){function t(n){var r,a=e.call(this)||this;if(a.pendingRead=new WeakMap,a.pendingDisposal=new WeakSet,a.dataRefCount=new WeakMap,a.numBytesInGPU=0,a.uploadWaitMs=0,a.downloadWaitMs=0,a.warnedAboutMemory=!1,a.pendingDeletes=0,a.disposed=!1,!Z().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var s=vr(Z().getNumber("WEBGL_VERSION"));a.binaryCache=((r=Z().getNumber("WEBGL_VERSION"))in tl||(tl[r]={}),tl[r]),a.gpgpu=new YC(s),a.canvas=s.canvas,a.gpgpuCreatedLocally=!0}else a.gpgpu=n,a.binaryCache={},a.gpgpuCreatedLocally=!1,a.canvas=n.gl.canvas;return a.textureManager=new NS(a.gpgpu),a.numMBBeforeWarning=Z().global.screen==null?1024:Z().global.screen.height*Z().global.screen.width*window.devicePixelRatio*LS/1024/1024,a.texData=new dy(a,V),a}return er(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(n,r,a){if(Z().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var s={};return this.texData.set(s,{shape:r,dtype:a,values:n,usage:wn.UPLOAD}),s},t.prototype.move=function(n,r,a,s){if(Z().getBool("DEBUG")&&this.checkNumericalProblems(r),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:a,dtype:s,values:r,usage:wn.UPLOAD})},t.prototype.readSync=function(n){var r=this.texData.get(n),a=r.values,s=r.dtype,o=r.complexTensors,l=r.slice,c=r.shape,u=r.isPacked;if(l!=null){var d=void 0;d=u?new No(c,el):new Me(c,el);var h=this.runWebGLProgram(d,[{dataId:n,shape:c,dtype:s}],s),f=this.readSync(h.dataId);return this.disposeData(h.dataId),f}if(a!=null)return this.convertAndCacheOnCPU(n);if(s==="string")return a;var p,m,x=this.activeTimers!=null;return x&&(p=or()),s==="complex64"?m=gh(o.real.dataSync(),o.imag.dataSync()):m=this.getValuesFromTexture(n),x&&(this.downloadWaitMs+=or()-p),this.convertAndCacheOnCPU(n,m)},t.prototype.read=function(n){return xe(this,void 0,void 0,function(){var r,a,s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,k,j;return ye(this,function(C){switch(C.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(S){return r.push(S)})];if(a=this.texData.get(n),s=a.values,o=a.shape,l=a.slice,c=a.dtype,u=a.complexTensors,d=a.isPacked,l!=null)return h=void 0,h=d?new No(o,el):new Me(o,el),f=this.runWebGLProgram(h,[{dataId:n,shape:o,dtype:c}],c),p=this.read(f.dataId),this.disposeData(f.dataId),[2,p];if(s!=null)return[2,this.convertAndCacheOnCPU(n)];if(!Z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Z().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,c!=="complex64"&&Z().get("WEBGL_BUFFER_SUPPORTED")&&(x=this.decode(n),y=this.texData.get(x.dataId),m=(j=this.gpgpu).createBufferFromTexture.apply(j,[y.texture].concat(Mo(o)))),this.pendingRead.set(n,[]),c==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return c!=="complex64"?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return v=C.sent(),w=v[0],b=v[1],g=gh(w,b),[3,5];case 4:m==null?g=this.getValuesFromTexture(n):(N=be(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(m,N)),C.label=5;case 5:return x!=null&&this.disposeData(x.dataId),_=this.convertAndCacheOnCPU(n,g),k=this.pendingRead.get(n),this.pendingRead.delete(n),k.forEach(function(S){return S(_)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,_]}})})},t.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var a=n[r];if(!Sj(a))throw Z().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(n){var r,a=this.texData.get(n),s=a.shape,o=a.dtype,l=a.isPacked,c=be(s);if(Z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(n),d=this.texData.get(u.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[d.texture].concat(Mo(s))).subarray(0,c);return this.disposeData(u.dataId),h}var f=Z().getBool("WEBGL_PACK")&&l===!0,p=f?Mu(s):s,m=f?new CC(p):new kC(p),x=this.runWebGLProgram(m,[{shape:p,dtype:o,dataId:n}],"float32"),y=this.texData.get(x.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,c);return this.disposeData(x.dataId),g},t.prototype.time=function(n){return xe(this,void 0,void 0,function(){var r,a,s,o,l,c,u;return ye(this,function(d){switch(d.label){case 0:return r=this.activeTimers,a=[],s=!1,this.programTimersStack==null?(this.programTimersStack=a,s=!0):this.activeTimers.push(a),this.activeTimers=a,n(),o=Xs(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),l=Xs(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,s&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return u=d.sent(),c.kernelMs=ij(u),c.getExtraProfileInfo=function(){return u.map(function(h,f){return{name:l[f],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},d.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:or(),endMs:null}},t.prototype.endTimer=function(n){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=or(),n)},t.prototype.getQueryTime=function(n){return xe(this,void 0,void 0,function(){var r;return ye(this,function(a){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},t.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},t.prototype.releaseGPUData=function(n){var r=this.texData.get(n),a=r.texture,s=r.dtype,o=r.texShape,l=r.usage,c=r.isPacked,u=r.slice,d=u&&u.origDataId||n,h=this.dataRefCount.get(d);h>1?this.dataRefCount.set(d,h-1):(this.dataRefCount.delete(d),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,s),this.textureManager.releaseTexture(a,o,l,c)));var f=this.texData.get(n);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},t.prototype.getDataInfo=function(n){return this.texData.get(n)},t.prototype.getCPUBackend=function(){return Z().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=V.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(n,r){var a=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(s){return a.texData.get(s.dataId).texture==null&&s.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(n,r){var a=this.makeOutput(n.shape,"complex64");return this.texData.get(a.dataId).complexTensors={real:V.keep(n.clone()),imag:V.keep(r.clone())},a},t.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,a){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,a);if(be(a)===0)return Mt([],a,n.dtype);var s=this.texData.get(n.dataId).isPacked,o=cy(n.shape,r,a);if(s||!o){var l=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bS(a):new yS(a),c=l.getCustomSetupFunc(r);return this.compileAndRun(l,[n],null,c)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,a)},t.prototype.shallowSlice=function(n,r,a){var s=this.texData.get(n.dataId),o=this.makeOutput(a,n.dtype),l=this.texData.get(o.dataId);Object.assign(l,s),l.shape=a,l.dtype=n.dtype;var c=uy(r,n.strides);s.slice&&(c+=s.slice.flatOffset),l.slice={flatOffset:c,origDataId:s.slice&&s.slice.origDataId||n.dataId};var u=this.dataRefCount.get(l.slice.origDataId)||1;return this.dataRefCount.set(l.slice.origDataId,u+1),o},t.prototype.stridedSlice=function(n,r,a,s){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,a,s);var o=Ff(r,a,s);if(o.some(function(c){return c===0}))return Mt([],o);var l=new wS(r,s,o);return this.compileAndRun(l,[n])},t.prototype.reverse=function(n,r){var a=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gS(n.shape,r):new mS(n.shape,r);return this.compileAndRun(a,[n])},t.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var a=n.map(function(p){return Pn(p)}),s=n.map(function(p){return cr(p)});return Pt(this.concat(a,r),this.concat(s,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>Z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(n.length/2),l=this.concat(n.slice(0,o),r),c=this.concat(n.slice(o),r);return this.concat([l,c],r)}if(Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var u=new dC(n.map(function(p){return p.shape}),r);return this.compileAndRun(u,n)}var d=Qs(n.map(function(p){return p.shape}),r),h=n.map(function(p){return p.as2D(-1,be(p.shape.slice(r)))}),f=new uC(h.map(function(p){return p.shape}));return this.compileAndRun(f,h).reshape(d)},t.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Dg,n.dtype);var r=new Me(n.shape,Dg);return this.compileAndRun(r,[n])},t.prototype.batchMatMul=function(n,r,a,s){var o=a?n.shape[2]:n.shape[1],l=s?r.shape[1]:r.shape[2],c=a?n.shape[1]:n.shape[2],u=n.shape[0];if((o===1||l===1)&&c>1e3){a&&(n=n.transpose([0,2,1])),s&&(r=r.transpose([0,2,1]));var d=l===1?n:n.as3D(u,c,1),h=l===1?2:1,f=l===1?r.as3D(u,1,c):r;return this.multiply(d,f).sum(h,!0)}var p=Ft(n.dtype,r.dtype),m=new Wu(n.shape,[u,o,l],a,s);return this.compileAndRun(m,[n,r],p)},t.prototype.fusedBatchMatMul=function(n){var r=n.a,a=n.b,s=n.transposeA,o=n.transposeB,l=n.bias,c=n.activation,u=n.preluActivationWeights,d=s?r.shape[2]:r.shape[1],h=o?a.shape[1]:a.shape[2],f=r.shape[0],p=Ft(r.dtype,a.dtype),m=l!=null,x=u!=null,y=c?nl(c,!0):null,g=new Wu(r.shape,[f,d,h],s,o,m,y,x),v=[r,a];return l&&v.push(l),u&&v.push(u),this.compileAndRun(g,v,p)},t.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var a=this.texData.get(n.dataId),s=this.texData.get(r.dataId),o=new xg(sC,n.shape,r.shape),l=new xg(oC,n.shape,r.shape),c=[this.makeComplexComponentTensorInfo(n,a.complexTensors.real),this.makeComplexComponentTensorInfo(n,a.complexTensors.imag),this.makeComplexComponentTensorInfo(r,s.complexTensors.real),this.makeComplexComponentTensorInfo(r,s.complexTensors.imag)],u=this.compileAndRun(o,c),d=this.compileAndRun(l,c),h=this.complex(u,d);return u.dispose(),d.dispose(),h}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,yg,n.dtype);var f=new ct(yg,n.shape,r.shape);return this.compileAndRun(f,[n,r],n.dtype)},t.prototype.batchNormalization=function(n,r,a,s,o,l){var c=[n,r,a],u=null;l!=null&&(u=l.shape,c.push(l));var d=null;if(o!=null&&(d=o.shape,c.push(o)),Z().getBool("WEBGL_PACK_NORMALIZATION")){var h=new aC(n.shape,r.shape,a.shape,u,d,s);return this.compileAndRun(h,c)}var f=new rC(n.shape,r.shape,a.shape,u,d,s);return this.compileAndRun(f,c)},t.prototype.localResponseNormalization4D=function(n,r,a,s,o){var l=Z().getBool("WEBGL_PACK_NORMALIZATION")?new eS(n.shape,r,a,s,o):new JC(n.shape,r,a,s,o);return this.compileAndRun(l,[n])},t.prototype.LRNGrad=function(n,r,a,s,o,l,c){var u=new ZC(r.shape,s,o,l,c);return this.compileAndRun(u,[r,a,n])},t.prototype.tile=function(n,r){if(n.dtype==="string"){var a=this.readSync(n.dataId).map(function(o){return ec(o)});return xy(Te(n.shape,n.dtype,a),r)}var s=new _S(n.shape,r);return this.compileAndRun(s,[n])},t.prototype.pad=function(n,r,a){var s=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iS(n.shape,r,a):new oS(n.shape,r,a);return this.compileAndRun(s,[n])},t.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var a=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kS(n.shape,r):new jS(n.shape,r);return this.compileAndRun(a,[n])},t.prototype.gather=function(n,r,a){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,a);var s=new AC(n.shape,r.size,a);return this.compileAndRun(s,[n,r])},t.prototype.batchToSpaceND=function(n,r,a){P(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=r.reduce(function(h,f){return h*f}),o=oc(n.shape,r,s),l=ic(o.length,r.length),c=lc(n.shape,r,s),u=sy(a,r.length),d=oy(c,a,r.length);return n.reshape(o).transpose(l).reshape(c).slice(u,d)},t.prototype.spaceToBatchND=function(n,r,a){P(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=r.reduce(function(f,p){return f*p}),o=[[0,0]];o.push.apply(o,a);for(var l=1+r.length;l<n.shape.length;++l)o.push([0,0]);var c=n.pad(o),u=oc(c.shape,r,s,!1),d=ic(u.length,r.length,!1),h=lc(c.shape,r,s,!1);return c.reshape(u).transpose(d).reshape(h)},t.prototype.reduce=function(n,r,a){var s=n.shape[0],o=n.shape[1],l=Ou(o),c=new lS({windowSize:l,inSize:o,batchSize:s},r),u=this.compileAndRun(c,[n],a);return u.shape[1]===1?u:this.reduce(u,r,a)},t.prototype.argReduce=function(n,r,a){a===void 0&&(a=null);var s=n.shape[0],o=n.shape[1];a!=null&&(s=a.shape[0],o=a.shape[1]);var l=Ou(o),c=new Kk({windowSize:l,inSize:o,batchSize:s},r,a==null),u=[n];a!=null&&u.push(a);var d=this.compileAndRun(c,u,"int32");return d.shape[1]===1?d:this.argReduce(n,r,d)},t.prototype.argReducePacked=function(n,r,a){a===void 0&&(a=null);var s=a!=null?a.shape:n.shape,o=Ou(s[s.length-1]),l=new eC(s,o,r,a==null),c=a==null?[n]:[n,a],u=this.compileAndRun(l,c,"int32");return u.rank===n.rank?this.argReducePacked(n,r,u):u},t.prototype.sum=function(n,r){vn("sum",r,n.rank);var a=zt(n.shape,r),s=a[0],o=be(a[1]),l=n.as2D(-1,o),c=Ru(n.dtype);return this.reduce(l,"sum",c).reshape(s)},t.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var a=zt(n.shape,r),s=a[0],o=be(a[1]),l=n.as2D(-1,o),c=Ru(n.dtype);return this.reduce(l,"prod",c).reshape(s)},t.prototype.unsortedSegmentSum=function(n,r,a){var s=0,o=xr([s],n.rank),l=n;o!=null&&(l=n.transpose(o),s=yr(1,n.rank)[0]);var c=function(p,m,x){for(var y=[],g=p.length,v=0;v<g;v++)v!==m?y.push(p[v]):y.push(x);return y}(l.shape,s,a),u=be([l.shape[s]]),d=l.as2D(-1,u),h=Ru(n.dtype),f=this.segOpCompute(d,"unsortedSegmentSum",r,h,a).reshape(c);return o!=null&&(f=f.transpose(If(o))),f},t.prototype.segOpCompute=function(n,r,a,s,o){var l=n.shape[0],c=n.shape[1],u=function(f,p){var m,x=!1;for(f<=ly?(m=f,x=!0):m=ih(f,Math.floor(Math.sqrt(f)));!x;)m>p||m===f?x=!0:m=ih(f,m+1);return m}(c,o),d=new vS({windowSize:u,inSize:c,batchSize:l,numSegments:o}),h=this.compileAndRun(d,[n,a],s);return h.shape[1]===o?h:(a=sc(0,o).tile([c/u]),this.segOpCompute(h,r,a,s,o))},t.prototype.argMinMaxReduce=function(n,r,a){var s=[r];if(vn("arg"+a.charAt(0).toUpperCase()+a.slice(1),s,n.rank),!Z().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var o=zt(n.shape,s),l=o[0],c=be(o[1]),u=n.as2D(-1,c);return this.argReduce(u,a).reshape(l)}return this.argReducePacked(n,a)},t.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},t.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},t.prototype.cumsum=function(n,r,a,s){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var o=new bC(n.shape,a,s);return this.compileAndRun(o,[n])},t.prototype.equal=function(n,r){if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  return vec4(equal(a, b));\n","bool");var a=new ct("return float(a == b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.notEqual=function(n,r){if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  return vec4(notEqual(a, b));\n","bool");var a=new ct("return float(a != b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  return vec4(lessThan(a, b));\n","bool");var a=new ct("return float(a < b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.lessEqual=function(n,r){if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var a=new ct("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  return vec4(greaterThan(a, b));\n","bool");var a=new ct("return float(a > b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.greaterEqual=function(n,r){if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var a=new ct("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.logicalNot=function(n){var r=new Me(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},t.prototype.logicalAnd=function(n,r){if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var a=new ct("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.logicalOr=function(n,r){if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var a=new ct("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.select=function(n,r,a){var s=new xS(n.rank,r.shape,r.rank);return this.compileAndRun(s,[n,r,a],Ft(r.dtype,a.dtype))},t.prototype.where=function(n){rc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return Bf(n.shape,r)},t.prototype.topk=function(n,r,a){return yy(n.dataSync(),n.shape,n.dtype,r)},t.prototype.min=function(n,r){vn("min",r,n.rank);var a=zt(n.shape,r),s=a[0],o=be(a[1]),l=n.as2D(-1,o);return this.reduce(l,"min",l.dtype).reshape(s)},t.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _r("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,r.shape):new ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.mod=function(n,r){var a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _r("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,r.shape):new ct("if (b == 0.0) return NAN;\n  return mod(a, b);",n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);vn("max",r,n.rank);var a=zt(n.shape,r),s=a[0],o=be(a[1]),l=n.as2D(-1,o);return this.reduce(l,"max",l.dtype).reshape(s)},t.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _r("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,r.shape):new ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.all=function(n,r){vn("all",r,n.rank);var a=zt(n.shape,r),s=a[0],o=be(a[1]),l=n.as2D(-1,o);return this.reduce(l,"all",l.dtype).reshape(s)},t.prototype.any=function(n,r){vn("any",r,n.rank);var a=zt(n.shape,r),s=a[0],o=be(a[1]),l=n.as2D(-1,o);return this.reduce(l,"any",l.dtype).reshape(s)},t.prototype.realDivide=function(n,r){if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var a=new ct("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",n.shape,r.shape);return this.compileAndRun(a,[n,r],"float32")},t.prototype.floorDiv=function(n,r){if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var a=new ct("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",n.shape,r.shape);return this.compileAndRun(a,[n,r],"int32")},t.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,Lu);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var a=Ft(n.dtype,r.dtype);if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Lu,a);var s=new ct(Lu,n.shape,r.shape);return this.compileAndRun(s,[n,r],a)},t.prototype.packedUnaryOp=function(n,r,a){var s=new No(n.shape,r);return this.compileAndRun(s,[n],a)},t.prototype.packedBinaryOp=function(n,r,a,s,o){o===void 0&&(o=!1);var l=new _r(a,n.shape,r.shape,o);return this.compileAndRun(l,[n,r],s)},t.prototype.complexSeparableBinaryOp=function(n,r,a){var s=this,o=this.texData.get(n.dataId),l=this.texData.get(r.dataId),c=[[o.complexTensors.real,l.complexTensors.real],[o.complexTensors.imag,l.complexTensors.imag]].map(function(f){var p=f[0],m=f[1],x=s.makeComplexComponentTensorInfo(n,p),y=s.makeComplexComponentTensorInfo(r,m),g=new ct(a,n.shape,r.shape);return s.compileAndRun(g,[x,y],Ft(p.dtype,m.dtype))}),u=c[0],d=c[1],h=this.complex(u,d);return u.dispose(),d.dispose(),h},t.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},t.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>Z().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),a=this.addN(n.slice(0,r)),s=this.addN(n.slice(r));return this.addN([a,s])}var o=n.map(function(u){return u.dtype}).reduce(function(u,d){return Ft(u,d)}),l=n.map(function(u){return u.shape}),c=Z().getBool("WEBGL_PACK")?new Gk(n[0].shape,l):new Hk(n[0].shape,l);return this.compileAndRun(c,n,o)},t.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,Bu);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var a=Ft(n.dtype,r.dtype);if(Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Bu,n.dtype);var s=new ct(Bu,n.shape,r.shape);return this.compileAndRun(s,[n,r],a)},t.prototype.pow=function(n,r){var a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _r("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,r.shape):new ct("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",n.shape,r.shape),s=Ft(n.dtype,r.dtype);return this.compileAndRun(a,[n,r],s)},t.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Ig,n.dtype);var r=new Me(n.shape,Ig);return this.compileAndRun(r,[n])},t.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Ag,n.dtype);var r=new Me(n.shape,Ag);return this.compileAndRun(r,[n])},t.prototype.sign=function(n){var r=new Me(n.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[n])},t.prototype.isNaN=function(n){var r=new Me(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isInf=function(n){var r=new Me(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isFinite=function(n){var r=new Me(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.round=function(n){var r=new Me(n.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[n])},t.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Tg,n.dtype);var r=new Me(n.shape,Tg);return this.compileAndRun(r,[n])},t.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Pg,n.dtype);var r=new Me(n.shape,Pg);return this.compileAndRun(r,[n])},t.prototype.softmax=function(n,r){var a=kt([r],n.shape),s=this.max(n,a),o=fn(s.shape,a),l=this.subtract(n,s.reshape(o)),c=this.exp(l),u=this.sum(c,a).reshape(o);return this.realDivide(c,u)},t.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",n.dtype);var r=new Me(n.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[n])},t.prototype.log1p=function(n){var r=new Me(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},t.prototype.sqrt=function(n){var r=new Me(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},t.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new Me(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},t.prototype.reciprocal=function(n){var r=new Me(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},t.prototype.relu=function(n){var r;return r=Z().getBool("WEBGL_PACK")?new No(n.shape,Ey):new Me(n.shape,ky),this.compileAndRun(r,[n])},t.prototype.relu6=function(n){var r;return r=Z().getBool("WEBGL_PACK")?new No(n.shape,Ry):new Me(n.shape,Cy),this.compileAndRun(r,[n])},t.prototype.prelu=function(n,r){var a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _r(jy,n.shape,r.shape):new ct(_y,n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.elu=function(n){if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Dy,n.dtype);var r=new Me(n.shape,Sy);return this.compileAndRun(r,[n])},t.prototype.eluDer=function(n,r){var a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _r("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",n.shape,r.shape):new ct("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.selu=function(n){var r=new Me(n.shape,SS);return this.compileAndRun(r,[n])},t.prototype.int=function(n){var r=new Me(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},t.prototype.clip=function(n,r,a){var s,o=(s=Z().getBool("WEBGL_PACK_CLIP")?new lC(n.shape):new iC(n.shape)).getCustomSetupFunc(r,a);return this.compileAndRun(s,[n],null,o)},t.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Rg,n.dtype);var r=new Me(n.shape,Rg);return this.compileAndRun(r,[n])},t.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),a=new cC(n.shape),s=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(a,s)},t.prototype.sigmoid=function(n){var r=new Me(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},t.prototype.softplus=function(n){var r=new Me(n.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[n])},t.prototype.sin=function(n){var r=new Me(n.shape,ES);return this.compileAndRun(r,[n])},t.prototype.cos=function(n){var r=new Me(n.shape,RS);return this.compileAndRun(r,[n])},t.prototype.tan=function(n){var r=new Me(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},t.prototype.asin=function(n){var r=new Me(n.shape,DS);return this.compileAndRun(r,[n])},t.prototype.acos=function(n){var r=new Me(n.shape,IS);return this.compileAndRun(r,[n])},t.prototype.atan=function(n){var r=new Me(n.shape,AS);return this.compileAndRun(r,[n])},t.prototype.atan2=function(n,r){var a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _r("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",n.shape,r.shape):new ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.sinh=function(n){var r=new Me(n.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[n])},t.prototype.cosh=function(n){var r=new Me(n.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[n])},t.prototype.tanh=function(n){var r=new Me(n.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[n])},t.prototype.asinh=function(n){var r=new Me(n.shape,TS);return this.compileAndRun(r,[n])},t.prototype.acosh=function(n){var r=new Me(n.shape,PS);return this.compileAndRun(r,[n])},t.prototype.atanh=function(n){var r=new Me(n.shape,FS);return this.compileAndRun(r,[n])},t.prototype.erf=function(n){var r=new Me(n.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[n])},t.prototype.step=function(n,r){var a=new Me(n.shape,function(s){return s===void 0&&(s=0),tr+"\n    return x > 0.0 ? 1.0 : float("+s+");\n  "}(r));return this.compileAndRun(a,[n])},t.prototype.conv2dByMatMul=function(n,r,a,s,o,l){var c=n.shape,u=this.texData.get(n.dataId),d=a.inChannels,h=c[0]*c[1]*c[2],f=a.outChannels,p=a.dataFormat==="channelsLast",m=(h===1||f===1)&&d>1e3,x=c[2]%2!=0&&!!u.isPacked;if(m||!Z().getBool("WEBGL_LAZILY_UNPACK")||!Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!x){var y=p?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],g=this.reshape(n,[1,y,a.inChannels]),v=this.reshape(r,[1,a.inChannels,a.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:v,transposeA:!1,transposeB:!1,bias:s,activation:o,preluActivationWeights:l}),a.outShape)}var w=p?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),b={dataId:n.dataId,shape:[1,w,a.inChannels],dtype:n.dtype},N=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,P(Ji(u.shape,b.shape),function(){return"packed reshape "+u.shape+" to "+b.shape+" isn't free"});var _=this.reshape(r,[1,a.inChannels,a.outChannels]),k=this.fusedBatchMatMul({a:b,b:_,transposeA:!1,transposeB:!1,bias:s,activation:o,preluActivationWeights:l}),j=this.texData.get(k.dataId);return P(j.isPacked,function(){return"batchMatMul result is expected to be packed"}),u.shape=N,j.shape=a.outShape,V.makeTensorFromDataId(k.dataId,a.outShape,k.dtype)},t.prototype.conv2dWithIm2Row=function(n,r,a,s,o,l){var c=a.filterWidth,u=a.filterHeight,d=a.inChannels,h=a.outWidth,f=a.outHeight,p=a.dataFormat==="channelsLast",m=c*u*d,x=f*h,y=[m,x],g=n.squeeze([0]),v=r.reshape([1,m,-1]),w=new QC(y,g.shape,a),b=this.compileAndRun(w,[g]).reshape([1,y[0],y[1]]),N=s!=null,_=l!=null,k=o?nl(o,!0):null,j=new Wu(b.shape,[1,x,a.outChannels],!0,!1,N,k,_),C=[b,v];s&&C.push(s),_&&C.push(l);var S=this.compileAndRun(j,C);return p?S.reshape([1,f,h,a.outChannels]):S.reshape([1,a.outChannels,f,h])},t.prototype.fusedConv2d=function(n){var r=n.input,a=n.filter,s=n.convInfo,o=n.bias,l=n.activation,c=n.preluActivationWeights;if(s.filterHeight===1&&s.filterWidth===1&&s.dilationHeight===1&&s.dilationWidth===1&&s.strideHeight===1&&s.strideWidth===1&&(s.padInfo.type==="SAME"||s.padInfo.type==="VALID"))return this.conv2dByMatMul(r,a,s,o,l,c);if(Z().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,a,s,o,l,c);var u=o!=null,d=c!=null,h=l?nl(l,!1):null,f=new bg(s,u,h,d),p=[r,a];return o&&p.push(o),c&&p.push(c),this.compileAndRun(f,p)},t.prototype.conv2d=function(n,r,a){if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,a);if(Z().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,a);var s=new bg(a);return this.compileAndRun(s,[n,r])},t.prototype.conv2dDerInput=function(n,r,a){var s=new fC(a);return this.compileAndRun(s,[n,r])},t.prototype.conv2dDerFilter=function(n,r,a){var s=new hC(a);return this.compileAndRun(s,[n,r])},t.prototype.fusedDepthwiseConv2D=function(n){var r,a=n.input,s=n.filter,o=n.convInfo,l=n.bias,c=n.activation,u=n.preluActivationWeights,d=Z().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,h=c?nl(c,d):null,f=[a,s],p=l!=null,m=u!=null;return p&&f.push(l),m&&f.push(u),d?(r=new Ng(o,p,h,m),this.compileAndRun(r,f)):(r=new wg(o,p,h,m),this.compileAndRun(r,f))},t.prototype.depthwiseConv2D=function(n,r,a){var s;return Z().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1?(s=new Ng(a),this.compileAndRun(s,[n,r])):(s=new wg(a),this.compileAndRun(s,[n,r]))},t.prototype.depthwiseConv2DDerInput=function(n,r,a){var s=new vC(a);return this.compileAndRun(s,[n,r])},t.prototype.depthwiseConv2DDerFilter=function(n,r,a){var s=new gC(a);return this.compileAndRun(s,[n,r])},t.prototype.conv3d=function(n,r,a){var s=new xC(a);return this.compileAndRun(s,[n,r])},t.prototype.conv3dDerInput=function(n,r,a){var s=new mC(a);return this.compileAndRun(s,[n,r])},t.prototype.conv3dDerFilter=function(n,r,a){var s=new pC(a);return this.compileAndRun(s,[n,r])},t.prototype.maxPool=function(n,r){var a=new $u(r,"max",!1);return this.compileAndRun(a,[n])},t.prototype.avgPool=function(n,r){var a=new $u(r,"avg",!1);return this.compileAndRun(a,[n],"float32")},t.prototype.maxPoolBackprop=function(n,r,a,s){var o=new $u(s,"max",!0),l=this.compileAndRun(o,[r]),c=new tS(s),u=this.compileAndRun(c,[n,l],r.dtype);return l.dispose(),u},t.prototype.avgPoolBackprop=function(n,r,a){var s=new tC(a);return this.compileAndRun(s,[n],r.dtype)},t.prototype.cast=function(n,r){return py(n,r,this)},t.prototype.unstack=function(n,r){for(var a=n.shape[r],s=new Array(n.rank-1),o=0,l=0;l<n.rank;l++)l!==r&&(s[o++]=n.shape[l]);var c=new Array(n.rank).fill(0),u=n.shape.slice();u[r]=1;var d=new Array(a);for(l=0;l<d.length;l++)c[r]=l,d[l]=this.slice(n,c,u).reshape(s);return d},t.prototype.avgPool3d=function(n,r){var a=new zu(r,"avg",!1);return this.compileAndRun(a,[n],"float32")},t.prototype.avgPool3dBackprop=function(n,r,a){var s=new nC(a);return this.compileAndRun(s,[n],r.dtype)},t.prototype.maxPool3d=function(n,r){var a=new zu(r,"max",!1);return this.compileAndRun(a,[n],"float32")},t.prototype.maxPool3dBackprop=function(n,r,a,s){var o=new zu(s,"max",!0),l=this.compileAndRun(o,[r]),c=new nS(s),u=this.compileAndRun(c,[n,l],r.dtype);return l.dispose(),u},t.prototype.reshape=function(n,r){var a=this.texData.get(n.dataId);if(a.isPacked&&!Ji(n.shape,r)&&(a.texture===null||!Ji(a.shape,r))){var s=this.packedReshape(n,r);return V.makeTensorFromDataId(s.dataId,s.shape,s.dtype)}return mh(n,r)},t.prototype.resizeBilinear=function(n,r,a,s){var o=Z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new hS(n.shape,r,a,s):new dS(n.shape,r,a,s);return this.compileAndRun(o,[n],"float32")},t.prototype.resizeBilinearBackprop=function(n,r,a){var s=new uS(n,r,a);return this.compileAndRun(s,[n])},t.prototype.resizeNearestNeighbor=function(n,r,a,s){var o=new pS(n.shape,r,a,s);return this.compileAndRun(o,[n])},t.prototype.resizeNearestNeighborBackprop=function(n,r,a){var s=new fS(n,r,a);return this.compileAndRun(s,[n])},t.prototype.multinomial=function(n,r,a,s){var o=r?n:Lr(n),l=o.shape[0],c=o.shape[1],u=new rS(l,c,a),d=u.getCustomSetupFunc(s);return this.compileAndRun(u,[o],"int32",d)},t.prototype.oneHot=function(n,r,a,s){var o=new aS(n.size,r,a,s);return this.compileAndRun(o,[n])},t.prototype.diag=function(n){var r=new jC(n.size);return this.compileAndRun(r,[n])},t.prototype.nonMaxSuppression=function(n,r,a,s,o){return rc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Of(n.dataSync(),r.dataSync(),a,s,o)},t.prototype.cropAndResize=function(n,r,a,s,o,l){var c=new yC(n.shape,r.shape,s,o,l);return this.compileAndRun(c,[n,r,a],"float32")},t.prototype.depthToSpace=function(n,r,a){P(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var s=n.shape[0],o=a==="NHWC"?n.shape[1]:n.shape[2],l=a==="NHWC"?n.shape[2]:n.shape[3],c=a==="NHWC"?n.shape[3]:n.shape[1],u=o*r,d=l*r,h=c/(r*r),f=new _C(a==="NHWC"?[s,u,d,h]:[s,h,u,d],r,a);return this.compileAndRun(f,[n])},t.prototype.split=function(n,r,a){return vy(n,r,a)},t.prototype.scatterND=function(n,r,a){var s=cc(0,n,a),o=s.sliceRank,l=s.numUpdates,c=s.sliceSize,u=s.strides,d=s.outputSize,h=[d/c,c],f=n.reshape([l,o]),p=r.reshape([l,c]);if(d===0)return mh(Mt([]),a);var m=de(0),x=new Cg(l,o,f.rank,p.rank,u,h);return this.compileAndRun(x,[p,f,m]).reshape(a)},t.prototype.sparseToDense=function(n,r,a,s){var o=cc(0,n,a),l=o.sliceRank,c=o.numUpdates,u=o.strides,d=o.outputSize,h=new Cg(c,l,n.rank,r.rank,u,[d,1]);return this.compileAndRun(h,[r,n,s]).reshape(a)},t.prototype.fft=function(n){return this.fftImpl(n,!1)},t.prototype.ifft=function(n){return this.fftImpl(n,!0)},t.prototype.fftImpl=function(n,r){var a=this.texData.get(n.dataId),s=new jg(RC,n.shape,r),o=new jg(DC,n.shape,r),l=[this.makeComplexComponentTensorInfo(n,a.complexTensors.real),this.makeComplexComponentTensorInfo(n,a.complexTensors.imag)],c=this.compileAndRun(s,l),u=this.compileAndRun(o,l),d=this.complex(c,u).as2D(n.shape[0],n.shape[1]);return c.dispose(),u.dispose(),d},t.prototype.gatherND=function(n,r){var a=r.shape,s=a[a.length-1],o=iy(n,r),l=o[0],c=o[1],u=o[2],d=o[3],h=r.reshape([c,s]),f=n.reshape([n.size/u,u]),p=new TC(s,d,[c,u]);return this.compileAndRun(p,[f,h]).reshape(l)},t.prototype.fill=function(n,r,a){if((a=a||Ni(r))==="string"){var s=Zl(a,be(n));return s.fill(r),V.makeTensor(s,n,a,this)}var o=new IC(n,r),l=o.getCustomSetupFunc(r);return this.compileAndRun(o,[],a,l)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},t.prototype.linspace=function(n,r,a){return my(n,r,a)},t.prototype.makeTensorInfo=function(n,r){var a=this.write(null,n,r);return this.texData.get(a).usage=null,{dataId:a,shape:n,dtype:r}},t.prototype.makeOutput=function(n,r){var a=this.makeTensorInfo(n,r).dataId;return V.makeTensorFromDataId(a,n,r,this)},t.prototype.unpackTensor=function(n){var r=new OS(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},t.prototype.packTensor=function(n){var r=new sS(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},t.prototype.packedReshape=function(n,r){var a=[tc(n.shape)].concat(nc(n.shape)),s={dtype:n.dtype,shape:a,dataId:n.dataId},o=[tc(r)].concat(nc(r)),l=new cS(o,a),c=this.runWebGLProgram(l,[s],n.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}},t.prototype.decode=function(n){var r,a=this.texData.get(n),s=a.isPacked,o=a.shape,l=a.dtype,c=Mu(o);return r=s?new NC(c):new wC(c),{dtype:l,shape:o,dataId:this.runWebGLProgram(r,[{shape:c,dtype:l,dataId:n}],l,null,!0).dataId}},t.prototype.runWebGLProgram=function(n,r,a,s,o){var l=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(n.outputShape,a),u=this.texData.get(c.dataId);if(n.packedOutput&&(u.isPacked=!0),n.outPackingScheme===hi.DENSE){var d=Mo(n.outputShape);u.texShape=d.map(function(w){return 2*w})}if(n.outTexUsage!=null&&(u.usage=n.outTexUsage),be(c.shape)===0)return u.values=ui(c.dtype,0),c;var h=[],f=r.map(function(w){if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=l.texData.get(w.dataId);if(b.texture==null){if(!n.packedInputs&&be(w.shape)<=Z().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:b.values};n.packedInputs&&(b.isPacked=!0,b.shape=w.shape)}else if(!!b.isPacked!=!!n.packedInputs)w=b.isPacked?l.unpackTensor(w):l.packTensor(w),h.push(w),b=l.texData.get(w.dataId);else if(b.isPacked&&!Ji(b.shape,w.shape)){var N=w,_=w.shape;w.shape=b.shape,w=l.packedReshape(w,_),h.push(w),b=l.texData.get(w.dataId),N.shape=_}return l.uploadToGPU(w.dataId),{shape:w.shape,texData:b,isUniform:!1}});this.uploadToGPU(c.dataId);var p,m={shape:c.shape,texData:u,isUniform:!1},x=function(w,b,N){var _="";b.concat(N).forEach(function(C){var S=C.texData!=null&&C.texData.slice!=null&&C.texData.slice.flatOffset>0,M=C.isUniform?"uniform":C.texData.texShape;_+=C.shape+"_"+M+"_"+S});var k=w.userCode,j=w.constructor.name;return j+="_"+_+"_"+k}(n,f,m),y=this.getAndSaveBinary(x,function(){return function(w,b,N,_){var k=b.userCode,j=N.map(function(F,W){var I={logicalShape:F.shape,texShape:F.isUniform?null:F.texData.texShape,isUniform:F.isUniform,isPacked:!F.isUniform&&F.texData.isPacked,flatOffset:null};return F.texData!=null&&F.texData.slice!=null&&F.texData.slice.flatOffset>0&&(I.flatOffset=F.texData.slice.flatOffset),{name:b.variableNames[W],shapeInfo:I}}),C=j.map(function(F){return F.shapeInfo}),S={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},M=Xk(j,S,k,b.packedInputs),T=w.createProgram(M),A=null,L=w.getUniformLocation(T,"NAN",!1);Z().getNumber("WEBGL_VERSION")===1&&(A=w.getUniformLocation(T,"INFINITY",!1));for(var O={},U=0;U<b.variableNames.length;U++){var z=b.variableNames[U];O[z]=w.getUniformLocation(T,z,!1),O["offset"+z]=w.getUniformLocation(T,"offset"+z,!1)}return{program:b,source:M,webGLProgram:T,uniformLocations:O,inShapeInfos:C,outShapeInfo:S,infLoc:A,nanLoc:L}}(l.gpgpu,n,f,m)}),g=this.activeTimers!=null;if(g&&(p=this.startTimer()),function(w,b,N,_,k){kg(b.inShapeInfos,N),kg([b.outShapeInfo],[_]);var j=_.texData.texture,C=_.texData.texShape;_.texData.isPacked?w.setOutputPackedMatrixTexture(j,C[0],C[1]):w.setOutputMatrixTexture(j,C[0],C[1]),w.setProgram(b.webGLProgram),Z().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&w.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&w.gl.uniform1f(b.nanLoc,NaN),N.forEach(function(S,M){var T=b.program.variableNames[M],A=b.uniformLocations[T],L=b.uniformLocations["offset"+T];if(A!=null)if(S.isUniform)if(be(S.shape)<2)w.gl.uniform1f(A,S.uniformValues[0]);else{var O=S.uniformValues;O instanceof Float32Array||(O=new Float32Array(O)),w.gl.uniform1fv(A,O)}else S.texData.slice!=null&&L!=null&&w.gl.uniform1i(L,S.texData.slice.flatOffset),w.setInputMatrixTexture(S.texData.texture,A,M)}),k!=null&&k(w,b.webGLProgram),w.executeProgram()}(this.gpgpu,y,f,m,s),h.forEach(function(w){return l.disposeData(w.dataId)}),g&&(p=this.endTimer(p),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(p)})),!Z().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&o===!1){var v=this.unpackTensor(c);return this.disposeData(c.dataId),v}return c},t.prototype.compileAndRun=function(n,r,a,s,o){o===void 0&&(o=!1),a=a||r[0].dtype;var l=this.runWebGLProgram(n,r,a,s,o);return V.makeTensorFromDataId(l.dataId,l.shape,l.dtype)},t.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var n=this;this.disposed||(Z().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=pe(function(){if(!Z().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=Z().getBool("DEBUG");Z().set("DEBUG",!1);var a=n.abs(de(1e-8)).dataSync()[0];if(Z().set("DEBUG",r),a>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(n){var r,a=this.texData.get(n),s=a.shape,o=a.dtype,l=a.values,c=a.texture,u=a.usage,d=a.isPacked;if(c==null){var h,f=this.activeTimers!=null;f&&(h=or());var p=a.texShape;if(p==null&&(p=qj(s,d),a.texShape=p),l!=null){var m=Mu(s),x=void 0,y=p[1],g=p[0],v=l instanceof Uint8Array;d?(y=(r=ji(p[0],p[1]))[0],g=r[1],x=new EC(m,[g,y],v)):x=new SC(m,[g,y],v);var w=this.makeTensorInfo([g,y],o);this.texData.get(w.dataId).usage=v?wn.PIXELS:wn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),y,g,l);var b=this.runWebGLProgram(x,[w],o,null,!0),N=this.texData.get(b.dataId);a.texture=N.texture,a.texShape=N.texShape,a.isPacked=N.isPacked,a.usage=N.usage,this.disposeData(w.dataId),this.texData.delete(b.dataId),a.values=null,f&&(this.uploadWaitMs+=or()-h)}else{var _=this.acquireTexture(p,u,o,d);a.texture=_}}},t.prototype.convertAndCacheOnCPU=function(n,r){var a=this.texData.get(n),s=a.dtype;return this.releaseGPUData(n),r!=null&&(a.values=function(o,l){if(l==="float32"||l==="complex64")return o;if(l==="int32"||l==="bool"){for(var c=l==="int32"?new Int32Array(o.length):new Uint8Array(o.length),u=0;u<c.length;++u)c[u]=Math.round(o[u]);return c}throw new Error("Unknown dtype "+l)}(r,s)),a.values},t.prototype.acquireTexture=function(n,r,a,s){if(this.numBytesInGPU+=this.computeBytes(n,a),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,s)},t.prototype.computeBytes=function(n,r){return n[0]*n[1]*U0(r)},t}(hy);Y0()&&V.registerBackend("webgl",function(){return new BS},2);var WS=B({square_:function(e){var t=D(e,"x","square"),n=[t];return V.runKernelFunc(function(r,a){return a([t]),r.square(t)},{x:t},null,"Square",{},n,[])}}),pi="SquaredDifference",Iy=B({squaredDifference_:function(e,t){var n,r=D(e,"a","squaredDifference"),a=D(t,"b","squaredDifference");n=lt(r,a),r=n[0],a=n[1],Le(r.shape,a.shape);var s={a:r,b:a},o=[r,a];return V.runKernelFunc(function(l,c){var u=l.squaredDifference(r,a);return c([r,a]),u},s,function(l,c){var u=c[0],d=c[1],h=de(2);return{a:function(){return l.mul(u.sub(d).mul(h))},b:function(){return l.mul(d.sub(u).mul(h))}}},pi,{},o,[])}}),$S=B({abs_:function(e){var t=D(e,"x","abs");return t.dtype==="complex64"?V.runKernelFunc(function(n){return n.complexAbs(t)},{$x:t}):V.runKernelFunc(function(n,r){var a=n.abs(t);return r([t]),a},{x:t},function(n,r){var a=r[0];return{x:function(){return n.mul(a.toFloat().step(-1))}}},"Abs")}}),zS=B({acos_:function(e){var t=D(e,"x","acos");return V.runKernelFunc(function(n,r){var a=n.acos(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.divStrict(de(1).sub(a.toFloat().square()).sqrt()).neg()}}})}}),US=B({acosh_:function(e){var t=D(e,"x","acosh");return V.runKernelFunc(function(n,r){var a=n.acosh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.divStrict(a.toFloat().square().sub(1).sqrt())}}})}}),VS=B({asin_:function(e){var t=D(e,"x","asin");return V.runKernelFunc(function(n,r){var a=n.asin(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.divStrict(de(1).sub(a.toFloat().square()).sqrt())}}})}}),qS=B({asinh_:function(e){var t=D(e,"x","asinh");return V.runKernelFunc(function(n,r){var a=n.asinh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.divStrict(de(1).add(a.toFloat().square()).sqrt())}}})}}),HS=B({atan_:function(e){var t=D(e,"x","atan");return V.runKernelFunc(function(n,r){var a=n.atan(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.toFloat().square().add(1))}}})}}),GS=B({atanh_:function(e){var t=D(e,"x","atanh");return V.runKernelFunc(function(n,r){var a=n.atanh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(de(1).sub(a.toFloat().square()))}}})}}),KS=B({ceil_:function(e){var t=D(e,"x","ceil");return V.runKernelFunc(function(n){return n.ceil(t)},{$x:t},function(n){return{$x:function(){return ze(n)}}})}}),Uf=B({clipByValue_:function(e,t,n){var r=D(e,"x","clipByValue");P(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var a=[r],s={min:t,max:n};return V.runKernelFunc(function(o,l){var c=o.clip(r,t,n);return l([r]),c},{x:r},function(o,l){var c=l[0];return{x:function(){return o.where(c.greaterEqual(t).logicalAnd(c.lessEqual(n)),ze(o))}}},"ClipByValue",s,a)}}),XS=B({cos_:function(e){var t=D(e,"x","cos"),n=[t];return V.runKernelFunc(function(r,a){var s=r.cos(t);return a([t]),s},{x:t},function(r,a){var s=a[0];return{x:function(){return s.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),YS=B({cosh_:function(e){var t=D(e,"x","cosh");return V.runKernelFunc(function(n,r){var a=n.cosh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return a.toFloat().sinh().mulStrict(n)}}})}}),QS=B({erf_:function(e){var t=D(e,"x","erf");return P(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),V.runKernelFunc(function(n,r){var a=n.erf(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),vh=B({exp_:function(e){var t=D(e,"x","exp");return V.runKernelFunc(function(n,r){var a=n.exp(t);return r([a]),a},{x:t},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),JS=B({expm1_:function(e){var t=D(e,"x","expm1");return V.runKernelFunc(function(n,r){var a=n.expm1(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.mul(a.exp())}}})}}),ZS=B({floor_:function(e){var t=D(e,"x","floor");return V.runKernelFunc(function(n){return n.floor(t)},{$x:t},function(n){return{$x:function(){return ze(n)}}})}}),e4=B({log_:function(e){var t=D(e,"x","log"),n=[t];return V.runKernelFunc(function(r,a){var s=r.log(t);return a([t]),s},{x:t},function(r,a){var s=a[0];return{x:function(){return r.div(s.toFloat())}}},"Log",{},n)}}),t4=B({log1p_:function(e){var t=D(e,"x","log1p");return V.runKernelFunc(function(n,r){var a=n.log1p(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.add(1))}}})}}),n4=B({logSigmoid_:function(e){var t=D(e,"x","logSigmoid");return V.runKernelFunc(function(n,r){var a=n.softplus(t.neg()).neg();return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.mul(a.neg().sigmoid())}}})}}),fc=B({neg_:function(e){var t=D(e,"x","neg"),n=[t];return V.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),r4=B({reciprocal_:function(e){var t=D(e,"x","reciprocal");return V.runKernelFunc(function(n,r){var a=n.reciprocal(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.square().neg())}}})}}),a4=B({round_:function(e){var t=D(e,"x","round");return V.runKernelFunc(function(n){return n.round(t)},{$x:t},function(n){return{$x:function(){return ze(n)}}})}}),Ay=B({rsqrt_:function(e){var t=D(e,"x","rsqrt"),n=[t];return V.runKernelFunc(function(r,a){var s=r.rsqrt(t);return a([t]),s},{x:t},function(r,a){var s=a[0];return{x:function(){return r.div(s.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),Ty=B({sigmoid_:function(e){var t=D(e,"x","sigmoid");return V.runKernelFunc(function(n,r){var a=n.sigmoid(t);return r([a]),a},{x:t},function(n,r){var a=r[0];return{x:function(){return n.mul(a.mul(de(1).sub(a)))}}},"Sigmoid")}}),s4=B({sign_:function(e){var t=D(e,"x","sign");return V.runKernelFunc(function(n){return n.sign(t)},{$x:t},function(n){return{$x:function(){return ze(n)}}})}}),o4=B({isNaN_:function(e){var t=D(e,"x","isNaN");return V.runKernelFunc(function(n){return n.isNaN(t)},{$x:t},function(n){return{$x:function(){return ze(n)}}})}}),i4=B({isInf_:function(e){var t=D(e,"x","isInf");return V.runKernelFunc(function(n){return n.isInf(t)},{$x:t},function(n){return{$x:function(){return ze(n)}}})}}),l4=B({isFinite_:function(e){var t=D(e,"x","isFinite");return V.runKernelFunc(function(n){return n.isFinite(t)},{$x:t},function(n){return{$x:function(){return ze(n)}}})}}),c4=B({sin_:function(e){var t=D(e,"x","sin"),n=[t];return V.runKernelFunc(function(r,a){var s=r.sin(t);return a([t]),s},{x:t},function(r,a){var s=a[0];return{x:function(){return s.toFloat().cos().mul(r)}}},"Sin",{},n)}}),u4=B({sinh_:function(e){var t=D(e,"x","sinh");return V.runKernelFunc(function(n,r){var a=n.sinh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return a.toFloat().cosh().mulStrict(n)}}})}}),d4=B({softplus_:function(e){var t=D(e,"x","softplus");return V.runKernelFunc(function(n,r){var a=n.softplus(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.mul(a.sigmoid())}}})}}),h4=B({sqrt_:function(e){var t=D(e,"x","sqrt");return V.runKernelFunc(function(n,r){var a=n.sqrt(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.toFloat().sqrt().mul(2))}}})}}),f4=B({step_:function(e,t){t===void 0&&(t=0);var n=D(e,"x","step");return V.runKernelFunc(function(r){return r.step(n,t)},{$x:n},function(r){return{$x:function(){return ze(r)}}})}}),p4=B({tan_:function(e){var t=D(e,"x","tan");return V.runKernelFunc(function(n,r){var a=n.tan(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.cos().square())}}})}}),m4=B({tanh_:function(e){var t=D(e,"x","tanh");return V.runKernelFunc(function(n,r){var a=n.tanh(t);return r([a]),a},{x:t},function(n,r){var a=r[0];return{x:function(){return de(1).sub(a.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function Py(e,t,n,r,a,s){var o,l,c=D(e,"x","batchNorm"),u=D(t,"mean","batchNorm"),d=D(n,"variance","batchNorm");return a!=null&&(o=D(a,"scale","batchNorm")),r!=null&&(l=D(r,"offset","batchNorm")),P(c.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),P(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."}),P(d.rank===2||d.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+d.rank+"."}),o!=null&&P(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),l!=null&&P(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+l.rank+"."}),Ci(c,u,d,l,o,s)}function Fy(e,t,n,r,a,s){var o,l,c=D(e,"x","batchNorm"),u=D(t,"mean","batchNorm"),d=D(n,"variance","batchNorm");return a!=null&&(o=D(a,"scale","batchNorm")),r!=null&&(l=D(r,"offset","batchNorm")),P(c.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),P(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."}),P(d.rank===3||d.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+d.rank+"."}),o!=null&&P(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),l!=null&&P(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+l.rank+"."}),Ci(c,u,d,l,o,s)}function My(e,t,n,r,a,s){var o,l,c=D(e,"x","batchNorm"),u=D(t,"mean","batchNorm"),d=D(n,"variance","batchNorm");return a!=null&&(o=D(a,"scale","batchNorm")),r!=null&&(l=D(r,"offset","batchNorm")),P(c.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."}),P(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."}),P(d.rank===4||d.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+d.rank+"."}),o!=null&&P(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),l!=null&&P(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+l.rank+"."}),Ci(c,u,d,l,o,s)}function Ci(e,t,n,r,a,s){s==null&&(s=.001);var o,l,c,u=D(e,"x","batchNorm"),d=D(t,"mean","batchNorm"),h=D(n,"variance","batchNorm");a!=null&&(o=D(a,"scale","batchNorm")),r!=null&&(l=D(r,"offset","batchNorm")),P(d.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),P(l==null||d.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),P(o==null||d.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),c=u.rank===0||u.rank===1?u.as4D(1,1,1,u.size):u.rank===2?u.as4D(1,1,u.shape[0],u.shape[1]):u.rank===3?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u;var f=[u,d,h,o];return V.runKernelFunc(function(p,m){var x=p.batchNormalization(c,rl(d),rl(h),s,rl(o),rl(l));return m([u,d,h,o]),x},{x:u,mean:d,variance:h,scale:o,offset:l},function(p,m){var x=m,y=x[0],g=x[1],v=x[2],w=x[3],b=w==null?de(1):w,N=_t(g.shape,c.shape),_=[];if(g.rank===1){for(var k=0;k<c.shape.length-1;++k)_.push(c.shape[k]);_.push(1)}var j=y.sub(g),C=p.mul(b),S=Ay(v.add(de(s))),M=S.mul(S).mul(S).mul(de(-.5));return{x:function(){return g.rank===1?p.mul(Ps(S.as4D(1,1,1,g.shape[0]),_)).mul(b).reshape(y.shape):p.mul(S).mul(b).reshape(y.shape)},mean:function(){var T=S.mul(de(-1)).mul(C);return g.rank===1&&(T=T.sum(N)),T.reshape(g.shape)},variance:function(){var T=M.mul(j).mul(C);return g.rank===1&&(T=T.sum(N)),T.reshape(g.shape)},scale:function(){var T=j.mul(S),A=p.mul(T);return g.rank===1&&(A=A.sum(N)),A.reshape(g.shape)},offset:function(){var T=p;return g.rank===1&&(T=T.sum(N)),T.reshape(g.shape)}}},"BatchNormalization",{varianceEpsilon:s},f).reshape(u.shape)}function rl(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function $c(){Q0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var g4=B({batchNormalization2d_:function(e,t,n,r,a,s){return r===void 0&&(r=.001),$c(),Py(e,t,n,s,a,r)}}),v4=B({batchNormalization3d_:function(e,t,n,r,a,s){return r===void 0&&(r=.001),$c(),Fy(e,t,n,s,a,r)}}),x4=B({batchNormalization4d_:function(e,t,n,r,a,s){return r===void 0&&(r=.001),$c(),My(e,t,n,s,a,r)}}),y4=B({batchNormalization_:function(e,t,n,r,a,s){return r===void 0&&(r=.001),$c(),Ci(e,t,n,s,a,r)}}),Oy=B({batchNorm_:Ci}),b4=B({batchNorm2d_:Py}),w4=B({batchNorm3d_:Fy}),N4=B({batchNorm4d_:My}),zc=B({logicalAnd_:function(e,t){var n=D(e,"a","logicalAnd","bool"),r=D(t,"b","logicalAnd","bool");return Le(n.shape,r.shape),V.runKernelFunc(function(a){return a.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),_4=B({logicalNot_:function(e){var t=D(e,"x","logicalNot","bool");return V.runKernelFunc(function(n){return n.logicalNot(t)},{$x:t})}}),Ly=B({logicalOr_:function(e,t){var n=D(e,"a","logicalOr","bool"),r=D(t,"b","logicalOr","bool");return Le(n.shape,r.shape),V.runKernelFunc(function(a){return a.logicalOr(n,r)},{$a:n,$b:r})}}),j4=B({logicalXor_:function(e,t){var n=D(e,"a","logicalXor","bool"),r=D(t,"b","logicalXor","bool");return Le(n.shape,r.shape),Ly(e,t).logicalAnd(zc(e,t).logicalNot())}}),Ka=B({where_:function(e,t,n){var r=D(t,"a","where"),a=D(n,"b","where"),s=D(e,"condition","where","bool");return qe(r.shape,a.shape,"Error in where: "),s.rank===1?P(s.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):qe(s.shape,a.shape,"Error in where: "),V.runKernelFunc(function(o,l){var c=o.select(s,r,a);return l([s]),c},{$condition:s,$a:r,$b:a},function(o,l){var c=l[0];return{$condition:function(){return ze(c).toFloat()},$a:function(){return o.mul(c.cast(o.dtype))},$b:function(){return o.mul(c.logicalNot().cast(o.dtype))}}})}}),By=function(e){return xe(this,void 0,void 0,function(){var t,n,r;return ye(this,function(a){switch(a.label){case 0:return[4,(t=D(e,"condition","whereAsync","bool")).data()];case 1:return n=a.sent(),r=Bf(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},Oe=B({add_:function(e,t){var n,r=D(e,"a","add"),a=D(t,"b","add");n=lt(r,a),r=n[0],a=n[1];var s=Le(r.shape,a.shape);return V.runKernelFunc(function(o){return o.add(r,a)},{a:r,b:a},function(o){return{a:function(){var l=o,c=_t(r.shape,s);return c.length>0&&(l=l.sum(c)),l.reshape(r.shape)},b:function(){var l=o,c=_t(a.shape,s);return c.length>0&&(l=l.sum(c)),l.reshape(a.shape)}}},"Add")}}),k4=B({addN_:function(e){P(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),P(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(a,s){return D(a,"tensors"+s,"addN")}),n=t[0];t.forEach(function(a){if(a.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(a){if(!It(a.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return V.runKernelFunc(function(a){return a.addN(t)},r,function(a){var s={};return t.forEach(function(o,l){s[l]=function(){return a.clone()}}),s},"AddN")}}),C4=B({addStrict_:function(e,t){var n=D(e,"a","addStrict"),r=D(t,"b","addStrict");return qe(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),S4=B({atan2_:function(e,t){var n,r=D(e,"a","atan2"),a=D(t,"b","atan2");n=lt(r,a),r=n[0],a=n[1];var s=Le(r.shape,a.shape);return V.runKernelFunc(function(o,l){var c=o.atan2(r,a);return l([r,a]),c},{$a:r,$b:a},function(o,l){var c=l[0],u=l[1];return{$a:function(){var d=Oe(c.square(),u.square()),h=o.mul(u.div(d)),f=_t(c.shape,s);return f.length>0&&(h=h.sum(f)),h.reshape(c.shape)},$b:function(){var d=Oe(c.square(),u.square()),h=fc(o.mul(c.div(d))),f=_t(u.shape,s);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)}}})}}),Hn=B({div_:function(e,t){var n,r=D(e,"a","div"),a=D(t,"b","div");if(n=lt(r,a),r=n[0],a=n[1],r.dtype==="int32"&&a.dtype==="int32")return Wy(r,a);var s=Le(r.shape,a.shape);return V.runKernelFunc(function(o,l){var c=o.realDivide(r,a);return l([r,a]),c},{a:r,b:a},function(o,l){var c=l[0],u=l[1];return{a:function(){var d=o.div(u.toFloat()),h=_t(c.shape,s);return h.length>0?d.sum(h).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),h=_t(u.shape,s);h.length>0&&(d=d.sum(h).reshape(u.shape));var f=u.square();return d.div(f.toFloat()).neg()}}},"Div")}}),E4=B({divNoNan_:function(e,t){var n,r=D(e,"a","div"),a=D(t,"b","div");r=(n=lt(r,a))[0],a=n[1];var s=Hn(r,a),o=ze(s),l=a.equal(o);return Ka(l,o,s)}}),R4=B({divStrict_:function(e,t){var n=D(e,"a","div"),r=D(t,"b","div");return qe(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Wy=B({floorDiv_:function(e,t){var n,r=D(e,"a","floorDiv"),a=D(t,"b","floorDiv");n=lt(r,a),r=n[0],a=n[1];var s=Le(r.shape,a.shape);return V.runKernelFunc(function(o,l){var c=o.floorDiv(r,a);return l([r,a]),c},{a:r,b:a},function(o,l){var c=l[0],u=l[1];return{a:function(){var d=o.div(u.toFloat()),h=_t(c.shape,s);return h.length>0?d.sum(h).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),h=_t(u.shape,s);h.length>0&&(d=d.sum(h).reshape(u.shape));var f=u.square();return d.div(f.toFloat()).neg()}}},"FloorDiv")}}),Vf=B({maximum_:function(e,t){var n,r=D(e,"a","maximum"),a=D(t,"b","maximum");return n=lt(r,a),r=n[0],a=n[1],r.dtype==="bool"&&(r=r.toInt(),a=a.toInt()),Le(r.shape,a.shape),V.runKernelFunc(function(s,o){var l=s.maximum(r,a);return o([r,a]),l},{a:r,b:a},function(s,o){var l=o[0],c=o[1];return{a:function(){return s.mul(l.greaterEqual(c).toFloat())},b:function(){return s.mul(l.less(c).toFloat())}}},"Maximum")}}),D4=B({maximumStrict_:function(e,t){var n=D(e,"a","maximumStrict"),r=D(t,"b","maximumStrict");return qe(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),$y=B({minimum_:function(e,t){var n,r=D(e,"a","minimum"),a=D(t,"b","minimum");return n=lt(r,a),r=n[0],a=n[1],r.dtype==="bool"&&(r=r.toInt(),a=a.toInt()),Le(r.shape,a.shape),V.runKernelFunc(function(s,o){var l=s.minimum(r,a);return o([r,a]),l},{a:r,b:a},function(s,o){var l=o[0],c=o[1];return{a:function(){return s.mul(l.lessEqual(c).toFloat())},b:function(){return s.mul(l.greater(c).toFloat())}}},"Minimum")}}),I4=B({minimumStrict_:function(e,t){var n=D(e,"a","minimumStrict"),r=D(t,"b","minimumStrict");return qe(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),A4=B({mod_:function(e,t){var n,r=D(e,"a","mod"),a=D(t,"b","mod");n=lt(r,a),r=n[0],a=n[1];var s=Le(r.shape,a.shape);return V.runKernelFunc(function(o,l){var c=o.mod(r,a);return l([r,a]),c},{$a:r,$b:a},function(o,l){var c=l[0],u=l[1];return{$a:function(){var d=_t(c.shape,s);return d.length>0?o.sum(d).reshape(c.shape):o},$b:function(){var d=o.mul(c.div(u).floor().neg()),h=_t(u.shape,s);return h.length>0?d.sum(h).reshape(u.shape):d}}})}}),T4=B({modStrict_:function(e,t){var n=D(e,"a","modStrict"),r=D(t,"b","modStrict");return qe(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Gt=B({mul_:function(e,t){var n,r=D(e,"a","mul"),a=D(t,"b","mul");n=lt(r,a),r=n[0],a=n[1];var s=Le(r.shape,a.shape);return V.runKernelFunc(function(o,l){var c=o.multiply(r,a);return l([r,a]),c},{a:r,b:a},function(o,l){var c=l[0],u=l[1];return{a:function(){var d=o.mul(u.toFloat()),h=_t(c.shape,s);return h.length>0?d.sum(h).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),h=_t(u.shape,s);return h.length>0?d.sum(h).reshape(u.shape):d}}},"Mul")}}),P4=B({mulStrict_:function(e,t){var n=D(e,"a","mul"),r=D(t,"b","mul");return qe(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),pc=B({pow_:function(e,t){var n,r=D(e,"base","pow"),a=D(t,"exp","pow");n=lt(r,a),r=n[0],a=n[1];var s=Le(r.shape,a.shape),o=[r,a];return V.runKernelFunc(function(l,c){var u=l.pow(r,a);return c([r,a,u]),u},{a:r,b:a},function(l,c){var u=c[0],d=c[1],h=c[2];return{a:function(){var f=d.toFloat(),p=l.mul(f.mul(u.pow(f.sub(de(1))))),m=_t(u.shape,s);return m.length>0&&(p=p.sum(m)),p.reshape(u.shape)},b:function(){var f=u.greater(0),p=u.log().where(f,ze(u)),m=l.mul(h.mul(p)),x=_t(d.shape,s);return x.length>0&&(m=m.sum(x)),m.reshape(d.shape)}}},"Pow",{},o,[!0])}}),F4=B({powStrict_:function(e,t){return qe(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),M4=B({squaredDifferenceStrict_:function(e,t){var n=D(e,"a","squaredDifferenceStrict"),r=D(t,"b","squaredDifferenceStrict");return qe(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),jt=B({sub_:function(e,t){var n,r=D(e,"a","sub"),a=D(t,"b","sub");n=lt(r,a),r=n[0],a=n[1];var s=Le(r.shape,a.shape);return V.runKernelFunc(function(o){return o.subtract(r,a)},{a:r,b:a},function(o){return{a:function(){var l=o,c=_t(r.shape,s);return c.length>0&&(l=l.sum(c)),l.reshape(r.shape)},b:function(){var l=o,c=_t(a.shape,s);return c.length>0&&(l=l.sum(c)),l.neg().reshape(a.shape)}}},"Sub")}}),O4=B({subStrict_:function(e,t){var n=D(e,"a","subStrict"),r=D(t,"b","subStrict");return qe(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),zy=B({equal_:function(e,t){var n,r=D(e,"a","equal"),a=D(t,"b","equal");return n=lt(r,a),r=n[0],a=n[1],Le(r.shape,a.shape),V.runKernelFunc(function(s){return s.equal(r,a)},{$a:r,$b:a})}}),L4=B({equalStrict_:function(e,t){var n=D(e,"a","equalStrict"),r=D(t,"b","equalStrict");return qe(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),B4=B({greater_:function(e,t){var n,r=D(e,"a","greater"),a=D(t,"b","greater");return n=lt(r,a),r=n[0],a=n[1],Le(r.shape,a.shape),V.runKernelFunc(function(s){return s.greater(r,a)},{a:r,b:a},null,"Greater")}}),Uy=B({greaterEqual_:function(e,t){var n,r=D(e,"a","greaterEqual"),a=D(t,"b","greaterEqual");return n=lt(r,a),r=n[0],a=n[1],Le(r.shape,a.shape),V.runKernelFunc(function(s,o){var l=s.greaterEqual(r,a);return o([r,a]),l},{a:r,b:a},function(s,o){var l=o[0],c=o[1];return{a:function(){return ze(l)},b:function(){return ze(c)}}},"GreaterEqual")}}),W4=B({greaterEqualStrict_:function(e,t){var n=D(e,"a","greaterEqualStrict"),r=D(t,"b","greaterEqualStrict");return qe(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),$4=B({greaterStrict_:function(e,t){var n=D(e,"a","greaterStrict"),r=D(t,"b","greaterStrict");return qe(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),z4=B({less_:function(e,t){var n,r=D(e,"a","less"),a=D(t,"b","less");return n=lt(r,a),r=n[0],a=n[1],Le(r.shape,a.shape),V.runKernelFunc(function(s){return s.less(r,a)},{a:r,b:a},null,"Less")}}),U4=B({lessEqual_:function(e,t){var n,r=D(e,"a","lessEqual"),a=D(t,"b","lessEqual");return n=lt(r,a),r=n[0],a=n[1],Le(r.shape,a.shape),V.runKernelFunc(function(s,o){var l=s.lessEqual(r,a);return o([r,a]),l},{a:r,b:a},null,"LessEqual")}}),V4=B({lessEqualStrict_:function(e,t){var n=D(e,"a","lessEqualStrict"),r=D(t,"b","lessEqualStrict");return qe(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),q4=B({lessStrict_:function(e,t){var n=D(e,"a","lessStrict"),r=D(t,"b","lessStrict");return qe(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),H4=B({notEqual_:function(e,t){var n,r=D(e,"a","notEqual"),a=D(t,"b","notEqual");return n=lt(r,a),r=n[0],a=n[1],Le(r.shape,a.shape),V.runKernelFunc(function(s){return s.notEqual(r,a)},{a:r,b:a},null,"NotEqual")}}),G4=B({notEqualStrict_:function(e,t){var n=D(e,"a","notEqualStrict"),r=D(t,"b","notEqualStrict");return qe(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Fg(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Mg(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var qf=B({gather_:function(e,t,n){n===void 0&&(n=0);var r=D(e,"x","gather"),a=D(t,"indices","gather","int32");n=kt(n,r.shape)[0];var s=function(o,l,c){for(var u=o.shape[c],d=[],h=1,f=1,p=0;p<c;p++)d.push(o.shape[p]),h*=o.shape[p];for(p=0;p<l.rank;p++)d.push(l.shape[p]);for(p=c+1;p<o.rank;p++)d.push(o.shape[p]),f*=o.shape[p];return{batchSize:h,sliceSize:f,dimSize:u,outputShape:d}}(r,a,n);return V.runKernelFunc(function(o,l){var c=o.gather(r,a.flatten(),n);return l([a]),c},{x:r,indices:a},function(o,l){var c=l[0];return{x:function(){var u=r.shape,d=c.size,h=u.slice(0,n),f=h.length,p=u.slice(n,u.length).slice(1),m=p.length,x=Fg(0,f),y=Fg(f+1,f+1+m),g=Mg([h,[d],p]),v=o.reshape(g),w=c.reshape([d]),b=Mg([[f],x,y]),N=v.transpose(b),_=Vy(N,w,r.shape[n]),k=If(b);return _=_.transpose(k)},indices:function(){return c}}},"Gather",{axis:n}).reshape(s.outputShape)}}),Vy=B({unsortedSegmentSum_:function(e,t,n){var r=D(e,"x","unsortedSegmentSum"),a=D(t,"segmentIds","unsortedSegmentSum","int32");return P(ht(n),function(){return"numSegments must be of dtype int"}),V.runKernelFunc(function(s,o){var l=s.unsortedSegmentSum(r,a,n);return o([a]),l},{$x:r},function(s,o){var l=o[0];return{$x:function(){return function(c,u){for(var d=Vf(u,ze(u)),h=qf(c,d),f=Uy(u,de(0,"int32")),p=h.rank-f.rank,m=0;m<p;++m)f=Tn(f,m+1);f=zc(f,oo(h.shape,"bool"));var x=ze(h);return Ka(f,h,x)}(s,l)}}})}}),K4=function(e,t,n){return xe(this,void 0,void 0,function(){var r,a,s,o,l,c,u,d,h,f,p,m,x;return ye(this,function(y){switch(y.label){case 0:for(r=D(e,"tensor","boolMask"),a=D(t,"mask","boolMask","bool"),s=n==null?0:n,o=a.rank,l=r.shape,P(o>0,function(){return"mask cannot be scalar"}),qe(l.slice(s,s+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,u=s;u<s+o;u++)c*=l[u];return d=l.slice(0,s).concat([c],l.slice(s+o)),h=r.reshape(d),f=a.reshape([-1]),[4,By(f)];case 1:return p=y.sent(),m=p.squeeze([1]),x=qf(h,m,s),e!==r&&r.dispose(),t!==a&&a.dispose(),m.dispose(),h.dispose(),f.dispose(),p.dispose(),[2,x]}})})};function qy(e,t,n,r,a,s,o){s===void 0&&(s="NHWC"),P(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var l=e,c=t,u=!1;t.rank===3&&(u=!0,c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),l=[1,e[0],e[1],e[2]]),P(l.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+l.length+"."}),P(c.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank}),P(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var d=s==="NHWC"?l[3]:l[1],h=s==="NHWC"?c.shape[3]:c.shape[1];P(d===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+n.shape[2]+"."}),P(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."}),o!=null&&P(ht(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var f=Mf(s),p=es(l,n.shape,r,1,a,o,!1,f),m=V.runKernelFunc(function(x,y){var g=x.conv2dDerInput(c,n,p);return y([n,c]),g},{dy4D:c,filter:n},function(x,y){var g=y[0],v=y[1];return{dy4D:function(){return Wn(x,g,r,a,s,1,o)},filter:function(){return Hf(x,v,g.shape,r,a,s,o)}}});return u?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function Vu(e){var t=function(s){return typeof s=="number"?[s,s,s]:s.length===2?[s[0],s[1],1]:s}(e),n=t[0],r=t[1],a=t[2];return n===1&&r===1&&a===1}function Hy(e,t,n,r,a){P(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,o=t,l=!1;t.rank===4&&(l=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),s=[1,e[0],e[1],e[2],e[3]]);var c=s[4],u=o.shape[4];P(s.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+s.length+"."}),P(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),P(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),P(c===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[3]+"."}),P(u===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+n.shape[4]+"."});var d=dc(s,n.shape,r,1,a),h=V.runKernelFunc(function(f){return f.conv3dDerInput(o,n,d)},{dy5D:o});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var X4=B({conv1d_:function(e,t,n,r,a,s,o){a===void 0&&(a="NWC"),s===void 0&&(s=1);var l=D(e,"x","conv1d"),c=D(t,"filter","conv1d"),u=l,d=!1;l.rank===2&&(d=!0,u=l.as3D(1,l.shape[0],l.shape[1])),P(u.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."}),P(c.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."}),o!=null&&P(ht(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}),P(u.shape[2]===c.shape[1],function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+c.shape[1]+"."}),P(pn(n,s),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+s+"'"}),P(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var h=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),f=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),p=Wn(f,h,[1,n],r,"NHWC",[1,s],o);return d?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),Wn=B({conv2d_:function(e,t,n,r,a,s,o){a===void 0&&(a="NHWC"),s===void 0&&(s=[1,1]);var l=D(e,"x","conv2d"),c=D(t,"filter","conv2d"),u=l,d=!1;l.rank===3&&(d=!0,u=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),P(u.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."}),P(c.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."}),o!=null&&P(ht(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var h=a==="NHWC"?u.shape[3]:u.shape[1];P(h===c.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+c.shape[2]+"."}),P(pn(n,s),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"});var f=Mf(a),p=es(u.shape,c.shape,n,s,r,o,!1,f),m=[c,u],x=V.runKernelFunc(function(y,g){var v=y.conv2d(u,c,p);return g([c,u]),v},{x:u,filter:c},function(y,g){var v=g,w=v[0],b=v[1];return P(Js(s),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"}),{x:function(){return Gy(b.shape,y,w,n,r,a)},filter:function(){return Hf(b,y,w.shape,n,r,a)}}},"Conv2D",p,m);return d?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),Y4=B({conv3d_:function(e,t,n,r,a,s){a===void 0&&(a="NDHWC"),s===void 0&&(s=[1,1,1]);var o=D(e,"x","conv3d"),l=D(t,"filter","conv3d"),c=o,u=!1;o.rank===4&&(u=!0,c=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),P(c.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),P(l.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+l.rank+"."}),P(c.shape[4]===l.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+l.shape[3]+"."}),P(function(f,p){return Vu(f)||Vu(p)}(n,s),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),P(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var d=dc(c.shape,l.shape,n,s,r),h=V.runKernelFunc(function(f,p){var m=f.conv3d(c,l,d);return p([c,l]),m},{x:c,$filter:l},function(f,p){P(Vu(s),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"});var m=p[0],x=p[1];return{x:function(){return Hy(m.shape,f,x,n,r)},$filter:function(){return function(y,g,v,w,b){var N=y;y.rank===4&&(N=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var _=g;_.rank===4&&(_=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),P(N.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+N.shape+"."}),P(_.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),P(v.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+v+"."}),P(N.shape[4]===v[3],function(){return"Error in conv3dDerFilter: depth of input "+N.shape[4]+") must match input depth in filter ("+v[3]+"."}),P(_.shape[4]===v[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+v[4]+")."});var k=dc(N.shape,v,w,1,b);return V.runKernelFunc(function(j){return j.conv3dDerFilter(N,_,k)},{x5D:N,dy5D:_})}(m,f,x.shape,n,r)}}});return u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Hf=B({conv2dDerFilter_:function(e,t,n,r,a,s,o){s===void 0&&(s="NHWC");var l=e;e.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var c=t;c.rank===3&&(c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),P(l.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+l.shape+"."}),P(c.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."}),P(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var u=s==="NHWC"?l.shape[3]:l.shape[1],d=s==="NHWC"?c.shape[3]:c.shape[1];P(u===n[2],function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+n[2]+"."}),P(d===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+n[3]+")."}),o!=null&&P(ht(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var h=Mf(s),f=es(l.shape,n,r,1,a,o,!1,h);return V.runKernelFunc(function(p){return p.conv2dDerFilter(l,c,f)},{x4D:l,dy4D:c})}}),Gy=B({conv2dDerInput_:qy}),Uc=B({depthwiseConv2d_:function(e,t,n,r,a,s,o){s===void 0&&(s=[1,1]);var l=D(e,"x","depthwiseConv2d"),c=D(t,"filter","depthwiseConv2d"),u=l,d=!1;l.rank===3&&(d=!0,u=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),P(u.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."}),P(c.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."}),P(u.shape[3]===c.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."}),s==null&&(s=[1,1]),P(pn(n,s),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),o!=null&&P(ht(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var h=es(u.shape,c.shape,n,s,r,o,!0),f=[u,c],p=V.runKernelFunc(function(m,x){var y=m.depthwiseConv2D(u,c,h);return x([u,c]),y},{x:u,filter:c},function(m,x){P(Js(s),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"});var y=x[0],g=x[1];return{x:function(){return Ky(y.shape,m,g,h)},filter:function(){return Xy(y,m,g.shape,h)}}},"DepthwiseConv2dNative",h,f);return d?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),Ky=B({depthwiseConv2dDerInput_:function(e,t,n,r){var a=t,s=!1;t.rank===3&&(s=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=V.runKernelFunc(function(l){return l.depthwiseConv2DDerInput(a,n,r)},{dy4D:a});return s?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),Xy=B({depthwiseConv2dDerFilter_:function(e,t,n,r){var a=e;e.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=t;return s.rank===3&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),V.runKernelFunc(function(o){return o.depthwiseConv2DDerFilter(a,s,r)},{x4D:a,dy4D:s})}}),Gf=B({separableConv2d_:function(e,t,n,r,a,s,o){s===void 0&&(s=[1,1]),o===void 0&&(o="NHWC");var l=D(e,"x","separableConv2d"),c=D(t,"depthwiseFilter","separableConv2d"),u=D(n,"pointwiseFilter","separableConv2d"),d=l,h=!1;if(l.rank===3&&(h=!0,d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");P(d.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."}),P(c.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."}),P(u.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."}),P(u.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."}),P(u.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."});var f=c.shape[2],p=c.shape[3];P(u.shape[2]===f*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*p+", but got "+u.shape[2]+"."});var m=Uc(d,c,r,a,o,s),x=Wn(m,u,1,"valid",o);return h?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),Q4=B({conv2dTranspose_:function(e,t,n,r,a,s){return qy(n,D(e,"x","conv2dTranspose"),D(t,"filter","conv2dTranspose"),r,a,"NHWC",s)}}),J4=B({conv3dTranspose_:function(e,t,n,r,a){return Hy(n,D(e,"x","conv3dTranspose"),D(t,"filter","conv3dTranspose"),r,a)}}),Vc=B({matMul_:function(e,t,n,r){var a;n===void 0&&(n=!1),r===void 0&&(r=!1);var s=D(e,"a","matMul"),o=D(t,"b","matMul");a=lt(s,o),s=a[0],o=a[1];var l=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],u=n?s.shape[s.rank-1]:s.shape[s.rank-2],d=r?o.shape[o.rank-2]:o.shape[o.rank-1],h=s.shape.slice(0,-2),f=o.shape.slice(0,-2),p=be(h),m=be(f);P(s.rank>=2&&o.rank>=2&&s.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+o.rank+"."}),P(It(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+s.shape+" and "+o.shape+" must match."}),P(l===c,function(){return"Error in matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var x=s.shape.slice(0,-2).concat([u,d]),y=n?s.as3D(p,l,u):s.as3D(p,u,l),g=r?o.as3D(m,d,c):o.as3D(m,c,d),v={transposeA:n,transposeB:r};return V.runKernelFunc(function(w,b){var N=w.batchMatMul(y,g,n,r);return b([y,g]),N},{a:y,b:g},function(w,b){var N=b,_=N[0],k=N[1];return n||r?!n&&r?{a:function(){return w.matMul(k,!1,!1)},b:function(){return w.matMul(_,!0,!1)}}:n&&!r?{a:function(){return k.matMul(w,!1,!0)},b:function(){return _.matMul(w,!1,!1)}}:{a:function(){return k.matMul(w,!0,!0)},b:function(){return w.matMul(_,!0,!0)}}:{a:function(){return w.matMul(k,!1,!0)},b:function(){return _.matMul(w,!0,!1)}}},"BatchMatMul",v).reshape(x)}}),Z4=B({dot_:function(e,t){var n=D(e,"t1","dot"),r=D(t,"t2","dot");P(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var a=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];return P(a===s,function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+s+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),eE=B({outerProduct_:function(e,t){var n=D(e,"v1","outerProduct"),r=D(t,"v2","outerProduct");return P(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Si=B({reverse_:function(e,t){var n=D(e,"x","reverse");if(n.rank===0)return n.clone();var r=kt(t,n.shape);return V.runKernelFunc(function(a){return a.reverse(n,r)},{$x:n},function(a){return{$x:function(){return a.reverse(r)}}}).reshapeAs(n)}}),tE=B({reverse1d_:function(e){var t=D(e,"x","reverse");return P(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Si(t,0)}}),nE=B({reverse2d_:function(e,t){var n=D(e,"x","reverse");return P(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Si(n,t)}}),rE=B({reverse3d_:function(e,t){var n=D(e,"x","reverse");return P(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Si(n,t)}}),aE=B({reverse4d_:function(e,t){var n=D(e,"x","reverse");return P(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Si(n,t)}});function Yy(e,t,n,r,a,s){var o=D(e,"x","maxPool"),l=o,c=!1;o.rank===3&&(c=!0,l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),r==null&&(r=[1,1]),P(l.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+l.rank+"."}),P(pn(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),s!=null&&P(ht(a),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var u=fi(l.shape,t,n,r,a,s);if(u.filterWidth===1&&u.filterHeight===1&&It(u.inShape,u.outShape))return o.clone();var d=[l],h=V.runKernelFunc(function(f,p){var m=f.maxPool(l,u);return p([l,m]),m},{x:l},function(f,p){var m=p[0],x=p[1];return{x:function(){return function(y,g,v,w,b,N,_,k){var j=D(y,"dy","maxPoolBackprop"),C=D(g,"input","maxPoolBackprop"),S=D(v,"output","maxPoolBackprop");P(C.rank===j.rank,function(){return"Rank of input ("+C.rank+") does not match rank of dy ("+j.rank+")"}),N==null&&(N=[1,1]),P(pn(b,N),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+N+"'"}),P(j.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+j.rank+"."}),P(C.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+C.rank+"."}),k!=null&&P(ht(_),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+k+" but got pad "+_+"."});var M=fi(C.shape,w,b,N,_,k);return V.runKernelFunc(function(T){return T.maxPoolBackprop(j,C,S,M)},{$dy:j,$input:C})}(f,m,x,t,n,r,a)}}},"MaxPool",u,d);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Qy(e,t,n,r,a,s){var o=D(e,"x","avgPool","float32");r==null&&(r=[1,1]),P(pn(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var l=o,c=!1;o.rank===3&&(c=!0,l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),P(l.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+l.rank+"."}),s!=null&&P(ht(a),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var u=fi(l.shape,t,n,r,a,s);if(u.filterWidth===1&&u.filterHeight===1&&It(u.inShape,u.outShape))return o.clone();var d=V.runKernelFunc(function(h){return h.avgPool(l,u)},{x:l},function(h){return{x:function(){return function(f,p,m,x,y,g){var v=D(f,"dy","avgPoolBackprop"),w=D(p,"input","avgPoolBackprop");P(w.rank===v.rank,function(){return"Rank of input ("+w.rank+") does not match rank of dy ("+v.rank+")"}),y==null&&(y=[1,1]),P(pn(x,y),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+y+"'"});var b=w,N=v,_=!1;w.rank===3&&(_=!0,b=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),N=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),P(N.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+N.rank+"."}),P(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var k=fi(b.shape,m,x,y,g),j=V.runKernelFunc(function(C){return C.avgPoolBackprop(N,b,k)},{dy4D:N,input4D:b});return _?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}(h,l,t,n,r,a)}}},"AvgPool",u);return d=d.cast(o.dtype),c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}var St=B({maxPool_:function(e,t,n,r,a){return Yy(e,t,n,1,r,a)}}),Ei=B({avgPool_:function(e,t,n,r,a){return Qy(e,t,n,1,r,a)}}),sE=B({pool_:function(e,t,n,r,a,s){a==null&&(a=[1,1]),s==null&&(s=1),r===0&&(r="valid");var o=D(e,"x","maxPool"),l=o,c=!1;o.rank===3&&(c=!0,l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),P(pn(s,a),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+a+"'"});var u,d=fi(l.shape,t,s,a,r),h=[d.dilationHeight,d.dilationWidth];u=r==="same"?function(b,N){var _=b.map(function(C,S){return C+(C-1)*(N[S]-1)}).map(function(C){return C-1}),k=_.map(function(C){return Math.floor(C/2)}),j=_.map(function(C,S){return C-k[S]});return _.map(function(C,S){return[k[S],j[S]]})}([d.filterHeight,d.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,p=function(b,N,_){var k=_.map(function(L){return L[0]}),j=_.map(function(L){return L[1]}),C=b.concat(k,j),S=N.map(function(L,O){return(L-C[O]%L)%L}),M=j.map(function(L,O){return L+S[O]}),T=N.map(function(L,O){return[k[O],M[O]]}),A=N.map(function(L,O){return[0,S[O]]});return[T,A]}([d.inHeight,d.inWidth],h,u),m=p[0],x=p[1],y=f?r:"valid",g=f?l:ry(l,h,m),v=(n==="avg"?function(){return Qy(g,t,s,1,y)}:function(){return Yy(g,t,s,1,y)})(),w=f?v:ey(v,h,x);return c?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),oE=B({maxPool3d_:function(e,t,n,r,a,s,o){s===void 0&&(s="NDHWC");var l=D(e,"x","maxPool3d"),c=l,u=!1;l.rank===4&&(u=!0,c=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),o==null&&(o=[1,1,1]),P(c.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."}),P(s==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+s}),P(pn(n,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),a!=null&&P(ht(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=uc(c.shape,t,n,o,r,a,s),h=V.runKernelFunc(function(f,p){var m=f.maxPool3d(c,d);return p([c,m]),m},{x:c},function(f,p){var m=p[0],x=p[1];return{x:function(){return function(y,g,v,w,b,N,_,k){var j=D(y,"dy","maxPool3dBackprop"),C=D(g,"input","maxPool3dBackprop"),S=D(v,"output","maxPool3dBackprop"),M=j,T=C,A=S,L=!1;C.rank===4&&(L=!0,M=j.as5D(1,j.shape[0],j.shape[1],j.shape[2],j.shape[3]),T=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),A=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),P(M.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+M.rank+"."}),P(T.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),P(A.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+A.rank+"."}),N==null&&(N=[1,1,1]),P(pn(b,N),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+N+"'"}),k!=null&&P(ht(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+k+" but got pad "+_+"."});var O=uc(T.shape,w,b,N,_,k),U=V.runKernelFunc(function(z){return z.maxPool3dBackprop(M,T,A,O)},{dy5D:M,input5D:T});return L?U.as4D(U.shape[1],U.shape[2],U.shape[3],U.shape[4]):U}(f,m,x,t,n,o,r,a)}}});return u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),iE=B({avgPool3d_:function(e,t,n,r,a,s,o){s===void 0&&(s="NDHWC");var l=D(e,"x","avgPool3d","float32"),c=l,u=!1;l.rank===4&&(u=!0,c=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),o==null&&(o=[1,1,1]),P(c.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."}),P(s==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+s}),P(pn(n,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),a!=null&&P(ht(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=uc(c.shape,t,n,o,r,a,s),h=V.runKernelFunc(function(f){return f.avgPool3d(c,d)},{x:c},function(f){return{x:function(){return function(p,m,x,y,g,v,w){var b=D(p,"dy","avgPool3dBackprop"),N=D(m,"input","avgPool3dBackprop"),_=b,k=N,j=!1;N.rank===4&&(j=!0,_=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),k=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),P(_.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),P(k.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+k.rank+"."}),g==null&&(g=[1,1,1]),P(pn(y,g),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+g+"'"}),w!=null&&P(ht(v),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+v+"."});var C=uc(k.shape,x,y,g,v,w),S=V.runKernelFunc(function(M){return M.avgPool3dBackprop(_,k,C)},{dy5D:_,input5D:k});return j?S.as4D(S.shape[1],S.shape[2],S.shape[3],S.shape[4]):S}(f,c,t,n,o,r,a)}}});return h=h.cast(c.dtype),u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),gr=B({slice_:function(e,t,n){var r,a,s=D(e,"x","slice");if(s.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(s.rank-1).fill(0)):t.length<s.rank?t.concat(new Array(s.rank-t.length).fill(0)):t.slice()).forEach(function(c){P(c!==-1,function(){return"slice() does not support negative begin indexing."})}),a=(a=n==null?new Array(s.rank).fill(-1):typeof n=="number"?[n].concat(new Array(s.rank-1).fill(-1)):n.length<s.rank?n.concat(new Array(s.rank-n.length).fill(-1)):n).map(function(c,u){return c>=0?c:(P(c===-1,function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+u+"."}),s.shape[u]-r[u])}),Fk(s,r,a);var o=s.shape,l={begin:r,size:a};return V.runKernelFunc(function(c){return c.slice(s,r,a)},{x:s},function(c){for(var u=[],d=0;d<c.rank;d++)u.push([r[d],o[d]-r[d]-a[d]]);return{x:function(){return c.pad(u)}}},"Slice",l)}}),lE=B({slice1d_:function(e,t,n){var r=D(e,"x","slice1d");return P(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),gr(r,[t],[n])}}),cE=B({slice2d_:function(e,t,n){var r=D(e,"x","slice2d");return P(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),gr(r,t,n)}}),Jy=B({slice3d_:function(e,t,n){var r=D(e,"x","slice3d");return P(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),gr(r,t,n)}}),uE=B({slice4d_:function(e,t,n){var r=D(e,"x","slice4d");return P(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),gr(r,t,n)}});function Zy(e,t,n,r,a){return t.rank<n.rank&&(t=t.reshape(fn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(fn(e.shape,r))),{x:function(){var s=e.mul(n.equal(t).cast(e.dtype));return a==null?s:s.transpose(a)}}}var dE=B({all_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=D(e,"x","all","bool"),a=kt(t,r.shape),s=a,o=xr(s,r.rank);o!=null&&(r=r.transpose(o),s=yr(s.length,r.rank));var l=V.runKernelFunc(function(u){return u.all(r,s)},{$x:r});if(n){var c=fn(l.shape,a);return l.reshape(c)}return l}}),hE=B({any_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=D(e,"x","any","bool"),a=kt(t,r.shape),s=a,o=xr(s,r.rank);o!=null&&(r=r.transpose(o),s=yr(s.length,r.rank));var l=V.runKernelFunc(function(u){return u.any(r,s)},{$x:r});if(n){var c=fn(l.shape,a);return l.reshape(c)}return l}}),fE=B({argMax_:function(e,t){t===void 0&&(t=0);var n=D(e,"x","argMax");t==null&&(t=0);var r=kt(t,n.shape),a=xr(r,n.rank);a!=null&&(n=n.transpose(a),r=yr(r.length,n.rank));var s={axis:r[0]},o=[n];return V.runKernelFunc(function(l,c){var u=l.argMax(n,r[0]);return c([n]),u},{x:n},function(l,c){var u=c[0];return{x:function(){return ze(u)}}},"ArgMax",s,o)}}),pE=B({argMin_:function(e,t){t===void 0&&(t=0);var n=D(e,"x","argMin");t==null&&(t=0);var r=kt(t,n.shape),a=xr(r,n.rank);return a!=null&&(n=n.transpose(a),r=yr(r.length,n.rank)),V.runKernelFunc(function(s,o){var l=s.argMin(n,r[0]);return o([n]),l},{$x:n},function(s,o){var l=o[0];return{$x:function(){return ze(l)}}})}}),mE=B({logSumExp_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=D(e,"x","logSumExp"),a=kt(t,r.shape),s=r.max(a,!0),o=r.sub(s).exp().sum(a).log(),l=s.reshape(o.shape).add(o);if(n){var c=fn(l.shape,a);return l.reshape(c)}return l}}),qc=B({max_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=D(e,"x","max"),a=r,s=kt(t,r.shape),o=s,l=xr(o,r.rank);l!=null&&(r=r.transpose(l),o=yr(o.length,r.rank));var c=[r],u=V.runKernelFunc(function(h,f){var p=h.max(r,o);return f([a,p]),p},{x:r},function(h,f){return Zy(h,f[1],f[0],s,l)},"Max",{axes:o},c,[!0]);if(n){var d=fn(u.shape,s);u=u.reshape(d)}return u}}),gE=B({mean_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=D(e,"x","mean"),a=kt(t,r.shape),s=be(zt(r.shape,a)[1]);return Wc(function(o){var l=de(s);return{value:(l.dtype===o.dtype?o:o.cast(l.dtype)).div(l).sum(t,n),gradFunc:function(c){var u=o.shape.slice();return a.forEach(function(d){u[d]=1}),c.reshape(u).mul(oo(o.shape,"float32")).div(s)}}})(r)}}),vE=B({min_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=D(e,"x","min"),a=r,s=kt(t,r.shape),o=s,l=xr(o,r.rank);l!=null&&(r=r.transpose(l),o=yr(o.length,r.rank));var c=[r],u=V.runKernelFunc(function(h,f){var p=h.min(r,o);return f([a,p]),p},{x:r},function(h,f){return Zy(h,f[1],f[0],s,l)},"Min",{axes:o},c,[!0]);if(n){var d=fn(u.shape,s);u=u.reshape(d)}return u}}),xE=B({moments_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=kt(t,(e=D(e,"x","moments")).shape),a=e.mean(r,n),s=a.shape;n||(s=fn(a.shape,r));var o=e.toFloat().sub(a.reshape(s)).square();return{mean:a,variance:o.mean(r,n)}}}),eb=B({sum_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=D(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var a=kt(t,r.shape);return Wc(function(s){var o=xr(a,s.rank),l=a,c=s;o!=null&&(c=s.transpose(o),l=yr(l.length,s.rank));var u=function(p){var m=s.shape.slice();return a.forEach(function(x){m[x]=1}),p.reshape(m).mul(oo(s.shape,"float32"))},d={axes:l},h=V.runKernelFunc(function(p){return p.sum(c,l)},{x:c},function(p){return{x:function(){return u(p)}}},"Sum",d);if(n){var f=fn(h.shape,a);h=h.reshape(f)}return{value:h,gradFunc:u}})(r)}}),yE=B({prod_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=D(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var a=kt(t,r.shape),s=xr(a,r.rank),o=a,l=r;s!=null&&(l=r.transpose(s),o=yr(o.length,r.rank));var c=V.runKernelFunc(function(d){return d.prod(l,o)},{permutedX:l});if(n){var u=fn(c.shape,a);c=c.reshape(u)}return c}}),tb=B({elu_:function(e){var t=D(e,"x","elu");return V.runKernelFunc(function(n,r){var a=n.elu(t);return r([a]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return V.runKernelFunc(function(s){return s.eluDer(n,a)},{dy:n,y:a})}}})}}),bE=B({leakyRelu_:function(e,t){t===void 0&&(t=.2);var n=D(e,"x","leakyRelu");return Vf(de(t).mul(n),n)}}),nb=B({prelu_:function(e,t){var n=D(e,"x","prelu"),r=D(t,"alpha","prelu");return V.runKernelFunc(function(a,s){var o=a.prelu(n,r);return s([n,r]),o},{x:n,alpha:r},function(a,s){var o=s[0],l=s[1],c=o.greater(0);return{x:function(){return Ka(c,a,a.mul(l))},alpha:function(){var u=Ka(c,ze(a),a.mul(o)),d=_t(l.shape,a.shape);return d.length>0&&(u=u.sum(d)),u.reshape(l.shape)}}},"Prelu")}}),st=B({relu_:function(e){var t=D(e,"x","relu");return t.dtype==="bool"?t.toInt():V.runKernelFunc(function(n,r){var a=n.relu(t);return r([t]),a},{x:t},function(n,r){var a=r[0];return{x:function(){return n.mulStrict(a.step().toFloat())}}},"Relu")}}),rb=B({relu6_:function(e){var t=D(e,"x","relu6");return t.dtype==="bool"?t.toInt():V.runKernelFunc(function(n,r){var a=n.relu6(t);return r([t]),a},{x:t},function(n,r){var a=r[0],s=a.lessEqual(6).mul(a.step());return{x:function(){return n.mulStrict(s.toFloat())}}},"Relu6")}}),wE=B({selu_:function(e){var t=D(e,"x","selu");return V.runKernelFunc(function(n,r){var a=n.selu(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){var s=a.greater(de(0)),o=de($f),l=de(zf),c=n.mul(l),u=n.mul(o).mul(a.toFloat().exp());return Ka(s,c,u)}}})}}),va=B({transpose_:function(e,t){var n=D(e,"x","transpose");if(t==null&&(t=n.shape.map(function(a,s){return s}).reverse()),P(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(a){P(a>=0&&a<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return V.runKernelFunc(function(a){return a.transpose(n,t)},{x:n},function(a){var s=If(t);return{x:function(){return a.transpose(s)}}},"Transpose",r)}}),NE=B({localResponseNormalization_:function(e,t,n,r,a){t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),a===void 0&&(a=.5);var s=D(e,"x","localResponseNormalization");P(s.rank===4||s.rank===3,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+s.rank+"."}),P(ht(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var o=s,l=!1;s.rank===3&&(l=!0,o=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]));var c=V.runKernelFunc(function(u,d){var h=u.localResponseNormalization4D(o,t,n,r,a);return d([o,h]),h},{x4D:o},function(u,d){var h=d[0],f=d[1];return{x4D:function(){return V.runKernelFunc(function(p){return p.LRNGrad(u,h,f,t,n,r,a)},{})}}});return l?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),ab=B({norm_:function(e,t,n,r){t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var a=function l(c,u,d){if(d===void 0&&(d=null),c.rank===0)return c.abs();if(c.rank!==1&&d===null)return l(c.reshape([-1]),u,d);if(c.rank===1||typeof d=="number"||Array.isArray(d)&&d.length===1){if(u===1)return c.abs().sum(d);if(u===1/0)return c.abs().max(d);if(u===-1/0)return c.abs().min(d);if(u==="euclidean"||u===2)return c.abs().pow(de(2,"int32")).sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}if(Array.isArray(d)&&d.length===2){if(u===1)return c.abs().sum(d[0]).max(d[1]-1);if(u===1/0)return c.abs().sum(d[1]).max(d[0]);if(u===-1/0)return c.abs().sum(d[1]).min(d[0]);if(u==="fro"||u==="euclidean")return c.square().sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}throw new Error("Error in norm: invalid axis: "+d)}(e=D(e,"x","norm"),t,n),s=a.shape;if(r){var o=kt(n,e.shape);s=fn(a.shape,o)}return a.reshape(s)}}),_E=B({basicLSTMCell_:function(e,t,n,r,a,s){var o=D(e,"forgetBias","basicLSTMCell"),l=D(t,"lstmKernel","basicLSTMCell"),c=D(n,"lstmBias","basicLSTMCell"),u=D(r,"data","basicLSTMCell"),d=D(a,"c","basicLSTMCell"),h=D(s,"h","basicLSTMCell"),f=u.concat(h,1).matMul(l).add(c),p=f.shape[0],m=f.shape[1]/4,x=[p,m],y=f.slice([0,0],x),g=f.slice([0,m],x),v=f.slice([0,2*m],x),w=f.slice([0,3*m],x),b=y.sigmoid().mulStrict(g.tanh()).addStrict(d.mulStrict(o.add(v).sigmoid())),N=b.tanh().mulStrict(w.sigmoid());return[b,N]}}),jE=B({multiRNNCell_:function(e,t,n,r){for(var a=D(t,"data","multiRNNCell"),s=ac(n,"c","multiRNNCell"),o=ac(r,"h","multiRNNCell"),l=a,c=[],u=0;u<e.length;u++){var d=e[u](l,s[u],o[u]);c.push(d[0]),c.push(d[1]),l=d[1]}var h=[],f=[];for(u=0;u<c.length;u+=2)h.push(c[u]),f.push(c[u+1]);return[h,f]}}),kE=B({movingAverage_:function(e,t,n,r,a){a===void 0&&(a=!0);var s=D(e,"v","movingAverage"),o=D(t,"x","movingAverage"),l=D(n,"decay","movingAverage");Nj(s,o),P(It(s.shape,o.shape),function(){return"Shape mismatch in v and x"});var c=de(1),u=c.sub(l),d=o.sub(s).mul(u);if(a){P(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=D(r,"step","movingAverage");d=d.div(c.sub(pc(l,h)))}return s.add(d)}}),CE=B({stridedSlice_:function(e,t,n,r,a,s,o,l,c){if(a===void 0&&(a=0),s===void 0&&(s=0),o===void 0&&(o=0),l===void 0&&(l=0),c===void 0&&(c=0),r==null&&(r=new Array(t.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var u=D(e,"x","stridedSlice"),d=mg(l),h=u.shape.slice();d.forEach(function(y){t[y]=0,n[y]=1,h.splice(y,0,1)}),u=u.reshape(h);for(var f=0;f<u.rank;f++)t[f]=Mk(a,t,r,u.shape,f),n[f]=Ok(s,n,r,u.shape,f),r[f]=r[f]||1;var p=mg(c);p.forEach(function(y){n[y]=t[y]+1,r[y]=1});var m=Ff(t,n,r),x=m.filter(function(y,g){return p.indexOf(g)===-1});return r.every(function(y){return y===1})?gr(u,t,m).reshape(x):V.runKernelFunc(function(y){return y.stridedSlice(u,t,n,r)},{$x:u}).reshape(x)}}),SE=B({topk_:function(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!0);var r=D(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var s=V.runKernelFunc(function(o){return o.topk(r,t,n)},{$x:r});return{values:s[0],indices:s[1]}}}),EE=B({scatterND_:function(e,t,n){var r=D(e,"indices","scatterND","int32"),a=D(t,"updates","scatterND");return Pk(a,r,n),V.runKernelFunc(function(s){return s.scatterND(r,a,n)},{indices:r,updates:a},null,"ScatterNd",{shape:n})}}),Kf=B({fft_:function(e){P(e.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return V.runKernelFunc(function(a){return a.fft(r)},{input:e}).reshape(e.shape)}}),mc=B({ifft_:function(e){P(e.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return V.runKernelFunc(function(a){return a.ifft(r)},{input:e}).reshape(e.shape)}}),Xf=B({rfft_:function(e,t){P(e.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],a=e.size/r;if(t!=null&&t<r){var s=e.shape.map(function(g){return 0}),o=e.shape.map(function(g){return g});o[e.shape.length-1]=t,n=e.slice(s,o),r=t}else if(t!=null&&t>r){var l=e.shape.map(function(g){return g});l[e.shape.length-1]=t-r,n=e.concat(Ye(l),e.shape.length-1),r=t}else n=e;var c=n.zerosLike(),u=Pt(n,c).as2D(a,r),d=Kf(u),h=Math.floor(r/2)+1,f=Pn(d),p=cr(d),m=f.split([h,r-h],f.shape.length-1),x=p.split([h,r-h],p.shape.length-1),y=n.shape.slice();return y[n.shape.length-1]=h,Pt(m[0],x[0]).reshape(y)}}),sb=B({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),a=mc(r);return Pn(a)}var s=[n,2*(t-1)],o=Pn(e).as2D(n,t),l=cr(e).as2D(n,t),c=o.slice([0,1],[n,t-2]).reverse(1),u=l.slice([0,1],[n,t-2]).reverse(1).mul(de(-1)),d=o.concat(c,1),h=l.concat(u,1);return r=Pt(d,h).as2D(s[0],s[1]),a=mc(r),Pn(a)}}),RE=Object.freeze({fft:Kf,ifft:mc,rfft:Xf,irfft:sb}),DE=B({sparseToDense_:function(e,t,n,r){r===void 0&&(r=0);var a=D(e,"sparseIndices","sparseToDense","int32"),s=D(t,"sparseValues","sparseToDense"),o=D(r,"defaultValue","sparseToDense",s.dtype);return function(l,c,u,d){if(l.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+l.dtype+".");if(l.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+l.shape+".");var h=l.rank>0?l.shape[0]:1,f=l.rank>1?l.shape[1]:1;if(u.length!==f)throw new Error("outputShape has incorrect number of elements:, "+u.length+", should be: "+f+".");var p=c.size;if(c.rank!==0&&(c.rank!==1||p!==h))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+h+"]");if(c.dtype!==d.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,s,n,o),V.runKernelFunc(function(l){return l.sparseToDense(a,s,n,o)},{$sparseIndices:a,$sparseValues:s,$defaultValue:o})}}),IE=B({gatherND_:function(e,t){var n=D(t,"indices","gatherND","int32"),r=D(e,"x","gatherND");return V.runKernelFunc(function(a){return a.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),AE=B({diag_:function(e){var t=D(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return V.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(n)}}),TE=B({dropout_:function(e,t,n,r){var a=D(e,"x","dropout");if(P(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."}),P(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return e instanceof at?a.clone():a;var s=function(c,u){if(u==null)return c.shape.slice();if(It(c.shape,u))return u;if(c.shape.length===u.length){for(var d=[],h=0;h<c.shape.length;h++)u[h]==null&&c.shape[h]!=null?d.push(c.shape[h]):d.push(u[h]);return d}return u}(a,n),o=1-t,l=ny(s,0,1,"float32",r).add(o).floor().div(o);return a.mul(l)}});function ob(e,t,n){for(var r=1-e%2,a=new Float32Array(e),s=0;s<e;++s){var o=2*Math.PI*s/(e+r-1);a[s]=t-n*Math.cos(o)}return vt(a,"float32")}var Yf=B({hannWindow_:function(e){return ob(e,.5,.5)}}),ib=B({hammingWindow_:function(e){return ob(e,.54,.46)}}),Qf=B({frame_:function(e,t,n,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var s=0,o=[];s+t<=e.size;)o.push(gr(e,s,t)),s+=n;if(r)for(;s<e.size;){var l=s+t-e.size,c=wt([gr(e,s,t-l),mr([l],a)]);o.push(c),s+=n}return o.length===0?ha([],[0,t]):wt(o).as2D(o.length,t)}}),lb=B({stft_:function(e,t,n,r,a){var s;a===void 0&&(a=Yf),r==null&&(s=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(s)/Math.log(2)))));for(var o=Qf(e,t,n),l=Gt(o,a(t)),c=[],u=0;u<o.shape[0];u++)c.push(Xf(l.slice([u,0],[1,t]),r));return wt(c)}}),PE=Object.freeze({hannWindow:Yf,hammingWindow:ib,frame:Qf,stft:lb}),Ht,FE=function(e,t,n){return n===void 0&&(n=1),xe(this,void 0,void 0,function(){var r,a,s,o,l,c,u,d,h,f,p,m,x,y;return ye(this,function(g){switch(g.label){case 0:return r=D(e,"predictions","inTopK"),a=D(t,"targets","inTopK"),P(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),P(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+a.rank}),qe(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),s=r.shape[r.shape.length-1],P(n>0&&n<=s,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+s+"), but got "+n}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(l=g.sent(),c=[o.length/s,s],d=c[1],h=ui("bool",u=c[0]),f=0;f<u;f++){for(p=f*d,m=o.subarray(p,p+d),x=[],y=0;y<m.length;y++)x.push({value:m[y],index:y});for(x.sort(function(v,w){return w.value-v.value}),h[f]=0,y=0;y<n;y++)if(x[y].index===l[f]){h[f]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),[2,Mt(h,a.shape,"bool")]}})})};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Ht||(Ht={}));var ME=B({absoluteDifference_:function(e,t,n,r){r===void 0&&(r=Ht.SUM_BY_NONZERO_WEIGHTS);var a=D(e,"labels","absoluteDifference"),s=D(t,"predictions","absoluteDifference"),o=null;n!=null&&(o=D(n,"weights","absoluteDifference")),qe(a.shape,s.shape,"Error in absoluteDifference: ");var l=a.sub(s).abs();return Br(l,o,r)}}),Br=B({computeWeightedLoss_:function(e,t,n){n===void 0&&(n=Ht.SUM_BY_NONZERO_WEIGHTS);var r=D(e,"losses","computeWeightedLoss"),a=null;t!=null&&(a=D(t,"weights","computeWeightedLoss"));var s=a==null?r:r.mul(a);if(n===Ht.NONE)return s;if(n===Ht.SUM)return s.sum();if(n===Ht.MEAN){if(a==null)return s.mean();var o=r.size/a.size,l=s.sum().div(a.sum());return o>1?l.div(de(o)):l}if(n===Ht.SUM_BY_NONZERO_WEIGHTS){if(a==null)return s.sum().div(de(r.size));var c=a.mul(oo(r.shape)).notEqual(de(0)).sum().toFloat();return s.sum().div(c)}throw Error("Unknown reduction: "+n)}}),OE=B({cosineDistance_:function(e,t,n,r,a){a===void 0&&(a=Ht.SUM_BY_NONZERO_WEIGHTS);var s=D(e,"labels","cosineDistance"),o=D(t,"predictions","cosineDistance"),l=null;r!=null&&(l=D(r,"weights","cosineDistance")),qe(s.shape,o.shape,"Error in cosineDistance: ");var c=de(1).sub(s.mul(o).sum(n,!0));return Br(c,l,a)}}),LE=B({hingeLoss_:function(e,t,n,r){r===void 0&&(r=Ht.SUM_BY_NONZERO_WEIGHTS);var a=D(e,"labels","hingeLoss"),s=D(t,"predictions","hingeLoss"),o=null;n!=null&&(o=D(n,"weights","hingeLoss")),qe(a.shape,s.shape,"Error in hingeLoss: ");var l=de(1);a=de(2).mul(a).sub(l);var c=l.sub(a.mul(s)).relu();return Br(c,o,r)}}),BE=B({huberLoss_:function(e,t,n,r,a){r===void 0&&(r=1),a===void 0&&(a=Ht.SUM_BY_NONZERO_WEIGHTS);var s=D(e,"labels","huberLoss"),o=D(t,"predictions","huberLoss"),l=null;n!=null&&(l=D(n,"weights","huberLoss")),qe(s.shape,o.shape,"Error in huberLoss: ");var c=de(r),u=o.sub(s).abs(),d=$y(u,c),h=u.sub(d),f=de(.5).mul(d.square()).add(c.mul(h));return Br(f,l,a)}}),WE=B({logLoss_:function(e,t,n,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=Ht.SUM_BY_NONZERO_WEIGHTS);var s=D(e,"labels","logLoss"),o=D(t,"predictions","logLoss"),l=null;n!=null&&(l=D(n,"weights","logLoss")),qe(s.shape,o.shape,"Error in logLoss: ");var c=de(1),u=de(r),d=s.mul(o.add(u).log()).neg().sub(c.sub(s).mul(c.sub(o).add(u).log()));return Br(d,l,a)}}),$E=B({meanSquaredError_:function(e,t,n,r){r===void 0&&(r=Ht.SUM_BY_NONZERO_WEIGHTS);var a=D(e,"labels","meanSquaredError"),s=D(t,"predictions","meanSquaredError"),o=null;n!=null&&(o=D(n,"weights","meanSquaredError")),qe(a.shape,s.shape,"Error in meanSquaredError: ");var l=a.squaredDifference(s);return Br(l,o,r)}}),zE=B({sigmoidCrossEntropy_:function(e,t,n,r,a){r===void 0&&(r=0),a===void 0&&(a=Ht.SUM_BY_NONZERO_WEIGHTS);var s=D(e,"multiClassLabels","sigmoidCrossEntropy"),o=D(t,"logits","sigmoidCrossEntropy"),l=null;if(n!=null&&(l=D(n,"weights","sigmoidCrossEntropy")),qe(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=de(r),u=de(1),d=de(.5);s=s.mul(u.sub(c)).add(d.mul(c))}var h=function(f,p){var m=D(f,"labels","sigmoidCrossEntropyWithLogits"),x=D(p,"logits","sigmoidCrossEntropyWithLogits");qe(m.shape,x.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=x.relu(),g=x.mul(m),v=x.abs().neg().exp().log1p();return y.sub(g).add(v)}(s,o);return Br(h,l,a)}}),UE=B({softmaxCrossEntropy_:function(e,t,n,r,a){r===void 0&&(r=0),a===void 0&&(a=Ht.SUM_BY_NONZERO_WEIGHTS);var s=D(e,"onehotLabels","softmaxCrossEntropy"),o=D(t,"logits","softmaxCrossEntropy"),l=null;if(n!=null&&(l=D(n,"weights","softmaxCrossEntropy")),qe(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=de(r),u=de(1),d=de(s.shape[1]);s=s.mul(u.sub(c)).add(c.div(d))}var h=function(f,p,m){if(m===void 0&&(m=-1),m===-1&&(m=p.rank-1),m!==p.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+p.rank+" and dim was "+m);return Wc(function(x,y,g){var v=y.logSumExp([m],!0),w=y.toFloat().sub(v);return g([x,w]),{value:w.mul(x).neg().sum([m]),gradFunc:function(b,N){var _=N[0],k=N[1],j=fn(b.shape,[m]);return[b.reshape(j).mul(_.toFloat().sub(k.exp())),b.reshape(j).mul(k.exp().sub(_.toFloat()))]}}})(f,p)}(s,o);return Br(h,l,a)}}),VE=Object.freeze({get Reduction(){return Ht},absoluteDifference:ME,computeWeightedLoss:Br,cosineDistance:OE,hingeLoss:LE,huberLoss:BE,logLoss:WE,meanSquaredError:$E,sigmoidCrossEntropy:zE,softmaxCrossEntropy:UE});function Og(e,t){return t===void 0&&(t=!1),V.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],a=ty(n),s=e.clone(),o=ha([[1]],[1,1]),l=o.clone(),c=n>=r?r:n,u=function(h){var f,p=s,m=l,x=a;f=V.tidy(function(){var y=s.slice([h,h],[n-h,1]),g=y.norm(),v=s.slice([h,h],[1,1]),w=ha([[-1]]).where(v.greater(0),ha([[1]])),b=v.sub(w.mul(g)),N=y.div(b);l=N.shape[0]===1?o.clone():o.concat(N.slice([1,0],[N.shape[0]-1,N.shape[1]]),0);var _=w.matMul(b).div(g).neg(),k=s.slice([h,0],[n-h,r]),j=_.mul(l);if(h===0)s=k.sub(j.matMul(l.transpose().matMul(k)));else{var C=k.sub(j.matMul(l.transpose().matMul(k)));s=s.slice([0,0],[h,r]).concat(C,0)}var S=a.slice([0,h],[n,a.shape[1]-h]);if(h===0)a=S.sub(S.matMul(l).matMul(j.transpose()));else{var M=S.sub(S.matMul(l).matMul(j.transpose()));a=a.slice([0,0],[n,h]).concat(M,1)}return[l,s,a]}),l=f[0],s=f[1],a=f[2],hn([p,m,x])},d=0;d<c;++d)u(d);return!t&&n>r&&(a=a.slice([0,0],[n,r]),s=s.slice([0,0],[r,r])),[a,s]})}var qE=B({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=D(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var a=r.shape,s=r.shape.slice(-2),o=s[0],l=s[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=l))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+l+").");t<0&&(t=o),n<0&&(n=l);var c=sc(0,o,1,"int32").reshape([-1,1]),u=sc(0,l,1,"int32"),d=jt(c,u),h=zc(d.lessEqual(de(+t,"int32")),d.greaterEqual(de(-n,"int32"))),f=Ye([o,l],r.dtype);return Cn(Nt(r.reshape([-1,o,l])).map(function(p){return Ka(h,p,f)})).reshape(a)}}),HE=B({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,P(e!=null&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(c){P(e[c].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[c].shape[0]+" vs. "+n+")"})},a=1;a<e.length;++a)r(a)}else t=!0,e=Tf(e,e.shape[0],0).map(function(c){return ay(c,[0])});P(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var s=[],o=e,l=function(c){s.push(V.tidy(function(){var u=o[c];if(c>0)for(var d=0;d<c;++d){var h=eb(s[d].mulStrict(u)).mul(s[d]);u=u.sub(h)}return u.div(ab(u,"euclidean"))}))};for(a=0;a<e.length;++a)l(a);return t?Cn(s,0):s}}),GE=B({qr_:function(e,t){if(t===void 0&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return Og(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(o,l){return o*l}),r=Nt(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],s=[];return r.forEach(function(o){var l=Og(o,t),c=l[0],u=l[1];a.push(c),s.push(u)}),[Cn(a,0).reshape(e.shape),Cn(s,0).reshape(e.shape)]}}),KE=Object.freeze({bandPart:qE,gramSchmidt:HE,qr:GE});function Hc(e,t,n,r,a,s){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),s==null&&(s=0);var o=e.shape[0];return n=Math.min(n,o),P(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),P(e.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),P(e.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),P(t.rank===1,function(){return"scores must be a 1D tensor"}),P(t.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]}),P(0<=s&&s<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+s+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s}}var XE=B({resizeBilinear_:function(e,t,n){n===void 0&&(n=!1);var r=D(e,"images","resizeBilinear");P(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),P(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var a=r,s=!1;r.rank===3&&(s=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],l=t[1],c=V.runKernelFunc(function(u,d){return d([a]),u.resizeBilinear(a,o,l,n)},{x:a},function(u,d){return{x:function(){return V.runKernelFunc(function(h){return h.resizeBilinearBackprop(u,d[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:l});return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),YE=B({resizeNearestNeighbor_:function(e,t,n){n===void 0&&(n=!1);var r=D(e,"images","resizeNearestNeighbor");P(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),P(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),P(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var a=r,s=!1;r.rank===3&&(s=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],l=t[1],c=V.runKernelFunc(function(u,d){return d([a]),u.resizeNearestNeighbor(a,o,l,n)},{batchImages:a},function(u,d){return{batchImages:function(){return V.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(u,d[0],n)},{})}}});return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),QE=B({nonMaxSuppression_:function(e,t,n,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var s=D(e,"boxes","nonMaxSuppression"),o=D(t,"scores","nonMaxSuppression"),l=Hc(s,o,n,r,a);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold;var c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return V.runKernelFunc(function(u){return u.nonMaxSuppression(s,o,n,r,a)},{boxes:s,scores:o},null,"NonMaxSuppressionV3",c)}}),JE=function(e,t,n,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),xe(this,void 0,void 0,function(){var s,o,l,c,u,d,h;return ye(this,function(f){switch(f.label){case 0:return s=D(e,"boxes","nonMaxSuppressionAsync"),o=D(t,"scores","nonMaxSuppressionAsync"),l=Hc(s,o,n,r,a),n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold,[4,Promise.all([s.data(),o.data()])];case 1:return c=f.sent(),u=c[0],d=c[1],h=Of(u,d,n,r,a),s!==e&&s.dispose(),o!==t&&o.dispose(),[2,h]}})})},ZE=B({nonMaxSuppressionWithScore_:function(e,t,n,r,a,s){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),s===void 0&&(s=0);var o=D(e,"boxes","nonMaxSuppression"),l=D(t,"scores","nonMaxSuppression"),c=Hc(o,l,n,r,a,s),u={maxOutputSize:n=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:a=c.scoreThreshold,softNmsSigma:s=c.softNmsSigma},d=V.runKernel("NonMaxSuppressionV5",{boxes:o,scores:l},u);return{selectedIndices:d[0],selectedScores:d[1]}}}),e3=function(e,t,n,r,a,s){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),s===void 0&&(s=0),xe(this,void 0,void 0,function(){var o,l,c,u,d,h,f;return ye(this,function(p){switch(p.label){case 0:return o=D(e,"boxes","nonMaxSuppressionAsync"),l=D(t,"scores","nonMaxSuppressionAsync"),c=Hc(o,l,n,r,a,s),n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,s=c.softNmsSigma,[4,Promise.all([o.data(),l.data()])];case 1:return u=p.sent(),d=u[0],h=u[1],f=Lf(d,h,n,r,a,s),o!==e&&o.dispose(),l!==t&&l.dispose(),[2,f]}})})},t3=B({cropAndResize_:function(e,t,n,r,a,s){var o=D(e,"image","cropAndResize"),l=D(t,"boxes","cropAndResize","float32"),c=D(n,"boxInd","cropAndResize","int32");a=a||"bilinear",s=s||0;var u=l.shape[0];return P(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),P(l.rank===2&&l.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+l.shape+"."}),P(c.rank===1&&c.shape[0]===u,function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+l.shape+"."}),P(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),P(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),P(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a}),V.runKernelFunc(function(d,h){return d.cropAndResize(o,l,c,r,a,s)},{images:o,boxes:l,boxInd:c},null,"CropAndResize",{method:a,extrapolationValue:s,cropSize:r})}}),Jf=Object.freeze({resizeBilinear:XE,resizeNearestNeighbor:YE,nonMaxSuppression:QE,nonMaxSuppressionAsync:JE,nonMaxSuppressionWithScore:ZE,nonMaxSuppressionWithScoreAsync:e3,cropAndResize:t3}),Zf=function(e,t){return!(e>0)||t==="linear"},ep=function(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},tp=function(e,t){var n=t,r=_t(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},np=function(e,t,n){if(t==="linear")return e;if(t==="relu")return st(e);if(t==="elu")return tb(e);if(t==="relu6")return rb(e);if(t==="prelu")return nb(e,n);throw new Error("Unknown fused activation "+t+".")},n3=B({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,s=a!==void 0&&a,o=e.transposeB,l=o!==void 0&&o,c=e.bias,u=e.activation,d=u===void 0?"linear":u,h=e.preluActivationWeights;if(Zf(V.state.gradientDepth,d)===!1){var f=Vc(n,r,s,l);return c!=null&&(f=Oe(f,c)),np(f,d,h)}var p=D(n,"a","fused matMul"),m=D(r,"b","fused matMul");t=lt(p,m),p=t[0],m=t[1];var x=s?p.shape[p.rank-2]:p.shape[p.rank-1],y=l?m.shape[m.rank-1]:m.shape[m.rank-2],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=l?m.shape[m.rank-2]:m.shape[m.rank-1],w=p.shape.slice(0,-2),b=m.shape.slice(0,-2),N=be(w),_=be(b);P(p.rank>=2&&m.rank>=2&&p.rank===m.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+m.rank+"."}),P(It(w,b),function(){return"Error in fused matMul: outer dimensions ("+w+") and ("+b+") of Tensors with shapes "+p.shape+" and "+m.shape+" must match."}),P(x===y,function(){return"Error in fused matMul: inner shapes ("+x+") and ("+y+") of Tensors with shapes "+p.shape+" and "+m.shape+" and transposeA="+s+" and transposeB="+l+" must match."});var k,j,C=p.shape.slice(0,-2).concat([g,v]),S=s?p.as3D(N,x,g):p.as3D(N,g,x),M=l?m.as3D(_,v,y):m.as3D(_,y,v);c!=null&&Le(C,(k=lt(k=D(c,"bias","fused matMul"),p)[0]).shape),h!=null&&(j=D(h,"prelu weights","fused matMul"));var T={a:S,b:M};c!=null&&(T.bias=k),h!=null&&(T.preluActivationWeights=j);var A=[S,M];return V.runKernelFunc(function(L,O){var U=L.fusedBatchMatMul({a:S,b:M,transposeA:s,transposeB:l,bias:k,activation:d,preluActivationWeights:j});return O([S,M,U]),U},T,function(L,O){var U=O[0],z=O[1],F=O[2],W=ep(L,F,d),I={};return c!=null&&(I={bias:function(){return tp(k,W)}}),Object.assign(s||l?!s&&l?{a:function(){return W.matMul(z,!1,!1)},b:function(){return W.matMul(U,!0,!1)}}:s&&!l?{a:function(){return z.matMul(W,!1,!0)},b:function(){return U.matMul(W,!1,!1)}}:{a:function(){return z.matMul(W,!0,!0)},b:function(){return W.matMul(U,!0,!0)}}:{a:function(){return W.matMul(z,!1,!0)},b:function(){return U.matMul(W,!0,!1)}},I)},"_FusedMatMul",{transposeA:s,transposeB:l,activation:d},A,[!0]).reshape(C)}}),r3=B({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,s=e.dataFormat,o=s===void 0?"NHWC":s,l=e.dilations,c=l===void 0?[1,1]:l,u=e.dimRoundingMode,d=e.bias,h=e.activation,f=h===void 0?"linear":h,p=e.preluActivationWeights;if(f=f||"linear",Zf(V.state.gradientDepth,f)===!1){var m=Wn(t,n,r,a,o,c,u);return d!=null&&(m=Oe(m,d)),np(m,f,p)}var x=D(t,"x","conv2d"),y=D(n,"filter","conv2d"),g=x,v=!1;x.rank===3&&(v=!0,g=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),P(g.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),P(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."}),u!=null&&P(ht(a),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+a+"."}),P(g.shape[3]===y.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+y.shape[2]+"."}),P(pn(r,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),P(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var w,b,N=es(g.shape,y.shape,r,c,a,u);d!=null&&(w=lt(w=D(d,"bias","fused conv2d"),x)[0],Le(N.outShape,w.shape)),p!=null&&(b=D(p,"prelu weights","fused conv2d"));var _={x:g,filter:y};d!=null&&(_.bias=w),p!=null&&(_.preluActivationWeights=b);var k=[y,g],j=V.runKernelFunc(function(C,S){var M=C.fusedConv2d({input:g,filter:y,convInfo:N,bias:w,activation:f,preluActivationWeights:b});return S([y,g,M]),M},_,function(C,S){var M=S,T=M[0],A=M[1],L=M[2],O=ep(C,L,f);P(Js(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"});var U={};return d!=null&&(U={bias:function(){return tp(w,O)}}),Object.assign({x:function(){return Gy(A.shape,O,T,r,a)},filter:function(){return Hf(A,O,T.shape,r,a)}},U)},"FusedConv2D",{convInfo:N,activation:f},k,[!0]);return v?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}}),a3=B({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,s=e.dataFormat,o=s===void 0?"NHWC":s,l=e.dilations,c=l===void 0?[1,1]:l,u=e.dimRoundingMode,d=e.bias,h=e.activation,f=h===void 0?"linear":h,p=e.preluActivationWeights;if(Zf(V.state.gradientDepth,f)===!1){var m=Uc(t,n,r,a,o,c,u);return d!=null&&(m=Oe(m,d)),np(m,f,p)}var x=D(t,"x","depthwiseConv2d"),y=D(n,"filter","depthwiseConv2d"),g=x,v=!1;x.rank===3&&(v=!0,g=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),P(g.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),P(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."}),P(g.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."}),c==null&&(c=[1,1]),P(pn(r,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),u!=null&&P(ht(a),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+a+"."});var w,b,N=es(g.shape,y.shape,r,c,a,u,!0);d!=null&&(w=lt(w=D(d,"bias","fused conv2d"),x)[0],Le(N.outShape,w.shape)),p!=null&&(b=D(p,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:y};d!=null&&(_.bias=w),p!=null&&(_.preluActivationWeights=b);var k=[y,g],j=V.runKernelFunc(function(C,S){var M=C.fusedDepthwiseConv2D({input:g,filter:y,convInfo:N,bias:w,activation:f,preluActivationWeights:b});return S([y,g,M]),M},_,function(C,S){P(Js(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"});var M=S[0],T=S[1],A=S[2],L=ep(C,A,f),O={};return d!=null&&(O={bias:function(){return tp(w,L)}}),Object.assign({x:function(){return Ky(T.shape,L,M,N)},filter:function(){return Xy(T,L,M.shape,N)}},O)},"FusedDepthwiseConv2D",{convInfo:N,activation:f},k,[!0]);return v?j.as3D(j.shape[1],j.shape[2],j.shape[3]):j}}),s3=Object.freeze({matMul:n3,conv2d:r3,depthwiseConv2d:a3}),o3=Object.freeze({image:Jf,linalg:KE,losses:VE,spectral:RE,fused:s3,signal:PE,square:WS,squaredDifference:Iy,conv1d:X4,conv2d:Wn,conv3d:Y4,depthwiseConv2d:Uc,separableConv2d:Gf,conv2dTranspose:Q4,conv3dTranspose:J4,op:B,batchNormalization2d:g4,batchNormalization3d:v4,batchNormalization4d:x4,batchNormalization:y4,batchNorm:Oy,batchNorm2d:b4,batchNorm3d:w4,batchNorm4d:N4,booleanMaskAsync:K4,complex:Pt,real:Pn,imag:cr,concat:wt,concat1d:sk,concat2d:ok,concat3d:ik,concat4d:lk,split:Tf,matMul:Vc,dot:Z4,outerProduct:eE,reverse:Si,reverse1d:tE,reverse2d:nE,reverse3d:rE,reverse4d:aE,maxPool:St,avgPool:Ei,pool:sE,maxPool3d:oE,avgPool3d:iE,slice:gr,slice1d:lE,slice2d:cE,slice3d:Jy,slice4d:uE,abs:$S,acos:zS,acosh:US,asin:VS,asinh:qS,atan:HS,atanh:GS,ceil:KS,clipByValue:Uf,cos:XS,cosh:YS,erf:QS,exp:vh,expm1:JS,floor:ZS,log:e4,log1p:t4,logSigmoid:n4,neg:fc,reciprocal:r4,round:a4,rsqrt:Ay,sigmoid:Ty,sign:s4,isNaN:o4,isInf:i4,isFinite:l4,sin:c4,sinh:u4,softplus:d4,sqrt:h4,step:f4,tan:p4,tanh:m4,all:dE,any:hE,argMax:fE,argMin:pE,logSumExp:mE,max:qc,mean:gE,min:vE,moments:xE,sum:eb,prod:yE,equal:zy,equalStrict:L4,greater:B4,greaterEqual:Uy,greaterEqualStrict:W4,greaterStrict:$4,less:z4,lessEqual:U4,lessEqualStrict:V4,lessStrict:q4,notEqual:H4,notEqualStrict:G4,add:Oe,addN:k4,addStrict:C4,atan2:S4,div:Hn,divNoNan:E4,divStrict:R4,floorDiv:Wy,maximum:Vf,maximumStrict:D4,minimum:$y,minimumStrict:I4,mod:A4,modStrict:T4,mul:Gt,mulStrict:P4,pow:pc,powStrict:F4,squaredDifferenceStrict:M4,sub:jt,subStrict:O4,elu:tb,leakyRelu:bE,prelu:nb,relu:st,relu6:rb,selu:wE,logicalAnd:zc,logicalNot:_4,logicalOr:Ly,logicalXor:j4,where:Ka,whereAsync:By,buffer:Te,print:vk,batchToSpaceND:ey,broadcastTo:xk,cast:yk,clone:bk,cumsum:wk,depthToSpace:Nk,expandDims:Tn,eye:ty,multinomial:_k,oneHot:fh,pad:Za,pad1d:jk,pad2d:kk,pad3d:Ck,pad4d:Sk,rand:Ek,randomNormal:Rk,randomGamma:Dk,randomUniform:ny,reshape:Kn,spaceToBatchND:ry,squeeze:ay,stack:Cn,tile:Ps,truncatedNormal:Ik,unstack:Nt,setdiff1dAsync:Ak,fill:mr,linspace:ak,ones:oo,range:sc,scalar:de,tensor:Mt,tensor1d:vt,tensor2d:ha,tensor3d:Af,tensor4d:sn,tensor5d:tk,tensor6d:nk,variable:rk,zeros:Ye,onesLike:Z0,zerosLike:ze,transpose:va,softmax:Lr,logSoftmax:Bk,localResponseNormalization:NE,norm:ab,gather:qf,unsortedSegmentSum:Vy,basicLSTMCell:_E,multiRNNCell:jE,movingAverage:kE,stridedSlice:CE,topk:SE,scatterND:EE,fft:Kf,ifft:mc,rfft:Xf,irfft:sb,sparseToDense:DE,gatherND:IE,diag:AE,dropout:TE,hannWindow:Yf,hammingWindow:ib,frame:Qf,stft:lb,inTopKAsync:FE});function ae(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(n){n!=null&&P(n.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function qu(e,t,n,r){if(n==="linear")return e.linear(t);if(n==="relu")return e.relu(t);if(n==="elu")return e.elu(t);if(n==="relu6")return e.relu6(t);if(n==="prelu")return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var i3=function(e){function t(){var n=e.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new dy(n,V),n}return er(t,e),t.prototype.write=function(n,r,a){this.firstUse&&(this.firstUse=!1,Z().get("IS_NODE")&&rc("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var s={};return this.data.set(s,{values:n,dtype:a}),s},t.prototype.move=function(n,r,a,s){this.data.set(n,{values:r,dtype:s})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(n){return xe(this,void 0,void 0,function(){return ye(this,function(r){return[2,this.readSync(n)]})})},t.prototype.readSync=function(n){var r=this.data.get(n),a=r.dtype,s=r.complexTensors;return a==="complex64"?gh(this.readSync(s.real.dataId),this.readSync(s.imag.dataId)):this.data.get(n).values},t.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),a=r;if(n.dtype==="string")try{a=r.map(function(s){return ec(s)})}catch(s){throw new Error("Failed to decode encoded string bytes into utf-8")}return Te(n.shape,n.dtype,a)},t.prototype.makeOutput=function(n,r,a){var s=this.write(n,r,a);return V.makeTensorFromDataId(s,r,a,this)},t.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},t.prototype.time=function(n){return xe(this,void 0,void 0,function(){var r;return ye(this,function(a){return r=or(),n(),[2,{kernelMs:or()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(n,r){var a=this.makeOutput(null,n.shape,"complex64");return this.data.get(a.dataId).complexTensors={real:V.keep(n.clone()),imag:V.keep(r.clone())},a},t.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,a){if(ae(n,"slice"),cy(n.shape,r,a)){var s=uy(r,n.strides),o=be(a);return Mt(this.readSync(n.dataId).subarray(s,s+o),a,n.dtype)}for(var l=Te(a,n.dtype),c=this.bufferSync(n),u=0;u<l.size;++u){var d=l.indexToLoc(u).map(function(h,f){return h+r[f]});l.values[u]=c.get.apply(c,d)}return l.toTensor()},t.prototype.stridedSlice=function(n,r,a,s){ae(n,"stridedSlice");var o=Ff(r,a,s);if(o.some(function(p){return p===0}))return Mt([],o);for(var l=Te(o,n.dtype),c=this.bufferSync(n),u=0;u<l.size;u++){for(var d=l.indexToLoc(u),h=new Array(d.length),f=0;f<h.length;f++)h[f]=d[f]*s[f]+r[f];l.set.apply(l,[c.get.apply(c,h)].concat(d))}return l.toTensor()},t.prototype.diag=function(n){for(var r=this.readSync(n.dataId),a=Te([n.size,n.size],n.dtype),s=a.values,o=0;o<r.length;o++)s[o*n.size+o]=r[o];return a.toTensor()},t.prototype.unstack=function(n,r){for(var a=n.shape[r],s=new Array(n.rank-1),o=0,l=0;l<n.rank;l++)l!==r&&(s[o++]=n.shape[l]);var c=new Array(n.rank).fill(0),u=n.shape.slice();u[r]=1;var d=new Array(a);for(l=0;l<d.length;l++)c[r]=l,d[l]=this.slice(n,c,u).reshape(s);return d},t.prototype.reverse=function(n,r){ae(n,"reverse");for(var a=Te(n.shape,n.dtype),s=this.bufferSync(n),o=function(c){var u=a.indexToLoc(c),d=u.slice();r.forEach(function(h){return d[h]=n.shape[h]-1-d[h]}),a.set.apply(a,[s.get.apply(s,d)].concat(u))},l=0;l<a.size;l++)o(l);return a.toTensor()},t.prototype.concat=function(n,r){var a=this;if(n[0].dtype==="complex64"){var s=n.map(function(p){return Pn(p)}),o=n.map(function(p){return cr(p)});return Pt(this.concat(s,r),this.concat(o,r))}var l=n.map(function(p){var m=be(p.shape.slice(r));return p.as2D(-1,m)}),c=Qs(l.map(function(p){return p.shape}),1),u=Te(c,n[0].dtype).values;if(l[0].shape[0]===1){var d=0;l.forEach(function(p){u.set(a.readSync(p.dataId),d),d+=p.size})}else{var h=0;l.forEach(function(p){for(var m=a.readSync(p.dataId),x=0,y=0;y<p.shape[0];++y)for(var g=y*c[1]+h,v=0;v<p.shape[1];++v)u[g+v]=m[x++];h+=p.shape[1]})}var f=Qs(n.map(function(p){return p.shape}),r);return Mt(u,f,n[0].dtype)},t.prototype.neg=function(n){return ae(n,"neg"),this.multiply(de(-1),n)},t.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(a,s,o,l){return{real:a+o,imag:s+l}}):this.broadcastedBinaryOp(n,r,Ft(n.dtype,r.dtype),function(a,s){return a+s})},t.prototype.addN=function(n){var r=this;ae(n,"addN");for(var a=n.map(function(d){return r.readSync(d.dataId)}),s=Te(n[0].shape,n[0].dtype),o=s.values,l=0;l<n.length;l++)for(var c=a[l],u=0;u<o.length;u++)o[u]+=c[u];return s.toTensor()},t.prototype.softmax=function(n,r){var a=kt([r],n.shape),s=this.max(n,a),o=fn(s.shape,a),l=this.subtract(n,s.reshape(o)),c=this.exp(l),u=this.sum(c,a).reshape(o);return this.realDivide(c,u)},t.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(a,s,o,l){return{real:a-o,imag:s-l}}):this.broadcastedBinaryOp(n,r,Ft(n.dtype,r.dtype),function(a,s){return a-s})},t.prototype.pow=function(n,r){return ae([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return Math.pow(a,s)})},t.prototype.batchMatMul=function(n,r,a,s){ae([n,r],"matMul");for(var o=a?n.shape[1]:n.shape[2],l=a?n.shape[2]:n.shape[1],c=s?r.shape[1]:r.shape[2],u=n.shape[0],d=this.readSync(n.dataId),h=this.readSync(r.dataId),f=a?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],p=f[0],m=f[1],x=f[2],y=s?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],g=y[0],v=y[1],w=y[2],b=l*c,N=Te([u,l,c],n.dtype),_=N.values,k=this.blockSize,j=0;j<u;j++)for(var C=0;C<l;C+=k)for(var S=0;S<c;S+=k)for(var M=0;M<o;M+=k)for(var T=Math.min(C+k,l),A=Math.min(S+k,c),L=Math.min(M+k,o),O=C;O<T;O++)for(var U=S;U<A;U++){for(var z=0,F=M;F<L;F++)z+=d[j*p+O*m+F*x]*h[F*g+U*v+j*w];_[j*b+(O*c+U)]+=z}return N.toTensor()},t.prototype.fusedBatchMatMul=function(n){var r=n.a,a=n.b,s=n.transposeA,o=n.transposeB,l=n.bias,c=n.activation,u=n.preluActivationWeights,d=this.batchMatMul(r,a,s,o);return l&&(d=this.add(d,l)),c&&(d=qu(this,d,c,u)),d},t.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(a,s,o,l){return{real:a*o-s*l,imag:a*l+s*o}}):this.broadcastedBinaryOp(n,r,Ft(n.dtype,r.dtype),function(a,s){return a*s})},t.prototype.realDivide=function(n,r){return ae([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(a,s){return a/s})},t.prototype.floorDiv=function(n,r){return ae([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(a,s){return Math.floor(a/s)})},t.prototype.sum=function(n,r){ae(n,"sum"),vn("sum",r,n.rank);for(var a=zt(n.shape,r),s=a[0],o=a[1],l=Ye(s,Ft(n.dtype,"int32")),c=be(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=0,m=0;m<c;++m)p+=d[f+m];u[h]=p}return l},t.prototype.prod=function(n,r){ae(n,"sum");for(var a=zt(n.shape,r),s=a[0],o=a[1],l=Ye(s,Ft(n.dtype,"int32")),c=be(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=1,m=0;m<c;++m)p*=d[f+m];u[h]=p}return l},t.prototype.unsortedSegmentSum=function(n,r,a){ae(n,"unsortedSegmentSum");for(var s=[],o=n.rank-r.rank,l=0;l<o;++l)r=r.expandDims(l+1);for(l=0;l<a;++l){var c=de(l,"int32"),u=zy(c,r).asType("float32").mul(n).sum(0);s.push(u)}return Cn(s)},t.prototype.argMin=function(n,r){ae(n,"argMin");var a=[r];vn("argMin",a,n.rank);for(var s=zt(n.shape,a),o=s[0],l=s[1],c=Ye(o,"int32"),u=be(l),d=this.readSync(c.dataId),h=this.readSync(n.dataId),f=0;f<d.length;++f){for(var p=f*u,m=h[p],x=0,y=0;y<u;++y){var g=h[p+y];g<m&&(m=g,x=y)}d[f]=x}return c},t.prototype.argMax=function(n,r){ae(n,"argMax");var a=[r];vn("argMax",a,n.rank);for(var s=zt(n.shape,a),o=s[0],l=s[1],c=Ye(o,"int32"),u=be(l),d=this.readSync(c.dataId),h=this.readSync(n.dataId),f=0;f<d.length;++f){for(var p=f*u,m=h[p],x=0,y=0;y<u;++y){var g=h[p+y];g>m&&(m=g,x=y)}d[f]=x}return c},t.prototype.cumsum=function(n,r,a,s){if(ae(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var o=Ft(n.dtype,"int32"),l=Ye(n.shape,o),c=this.readSync(l.dataId),u=this.readSync(n.dataId),d=n.shape[n.rank-1],h=s?function(y,g){return y+d-g-1}:function(y,g){return y+g},f=0;f<u.length;f+=d)for(var p=0;p<d;p++){var m=h(f,p);if(p===0)c[m]=a?0:u[m];else{var x=h(f,p-1);c[m]=a?u[x]+c[x]:u[m]+c[x]}}return l},t.prototype.equal=function(n,r){return ae([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a===s?1:0})},t.prototype.notEqual=function(n,r){return ae([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a!==s?1:0})},t.prototype.less=function(n,r){return ae([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a<s?1:0})},t.prototype.lessEqual=function(n,r){return ae([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a<=s?1:0})},t.prototype.greater=function(n,r){return ae([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a>s?1:0})},t.prototype.greaterEqual=function(n,r){return ae([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a>=s?1:0})},t.prototype.logicalNot=function(n){ae(n,"logicalNot");for(var r=this.readSync(n.dataId),a=new Uint8Array(r.length),s=0;s<r.length;++s)a[s]=r[s]?0:1;return this.makeOutput(a,n.shape,"bool")},t.prototype.logicalAnd=function(n,r){return ae([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a&&s})},t.prototype.logicalOr=function(n,r){return ae([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a||s})},t.prototype.select=function(n,r,a){ae([n,r,a],"select");for(var s=this.readSync(n.dataId),o=this.readSync(r.dataId),l=this.readSync(a.dataId),c=Ye(r.shape,Ft(r.dtype,a.dtype)),u=this.readSync(c.dataId),d=0,h=n.rank===0||n.rank>1||r.rank===1?1:be(r.shape.slice(1)),f=0;f<s.length;f++)for(var p=0;p<h;p++)s[f]===1?u[d++]=o[f]:u[d++]=l[f];return c},t.prototype.where=function(n){ae([n],"where");var r=this.readSync(n.dataId);return Bf(n.shape,r)},t.prototype.topk=function(n,r,a){return ae(n,"topk"),yy(this.readSync(n.dataId),n.shape,n.dtype,r)},t.prototype.min=function(n,r){ae(n,"min"),vn("min",r,n.rank);for(var a=zt(n.shape,r),s=a[0],o=a[1],l=Ye(s,n.dtype),c=be(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=d[f],m=0;m<c;++m){var x=d[f+m];x<p&&(p=x)}u[h]=p}return l},t.prototype.minimum=function(n,r){return ae([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return Math.min(a,s)})},t.prototype.mod=function(n,r){return ae([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){var o=a%s;return a<0&&s<0||a>=0&&s>=0?o:(o+s)%s})},t.prototype.max=function(n,r){ae(n,"max"),vn("max",r,n.rank);for(var a=zt(n.shape,r),s=a[0],o=a[1],l=Ye(s,n.dtype),c=be(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=d[f],m=0;m<c;++m){var x=d[f+m];x>p&&(p=x)}u[h]=p}return l},t.prototype.maximum=function(n,r){return ae([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return Math.max(a,s)})},t.prototype.all=function(n,r){ae(n,"all"),vn("all",r,n.rank);for(var a=zt(n.shape,r),s=a[0],o=a[1],l=Ye(s,n.dtype),c=be(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=d[f],m=0;m<c;++m){var x=d[f+m];p=p&&x}u[h]=p}return l},t.prototype.any=function(n,r){ae(n,"any"),vn("any",r,n.rank);for(var a=zt(n.shape,r),s=a[0],o=a[1],l=Ye(s,n.dtype),c=be(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=d[f],m=0;m<c;++m){var x=d[f+m];p=p||x}u[h]=p}return l},t.prototype.squaredDifference=function(n,r){return ae([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){var o=a-s;return o*o})},t.prototype.ceil=function(n){ae(n,"ceil");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=Math.ceil(r[s]);return this.makeOutput(a,n.shape,"float32")},t.prototype.floor=function(n){ae(n,"floor");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=Math.floor(r[s]);return this.makeOutput(a,n.shape,"float32")},t.prototype.sign=function(n){ae(n,"x");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)r[s]<0?a[s]=-1:r[s]>0?a[s]=1:a[s]=0;return this.makeOutput(a,n.shape,"float32")},t.prototype.isNaN=function(n){ae(n,"x");for(var r=this.readSync(n.dataId),a=new Uint8Array(r.length),s=0;s<r.length;++s)Number.isNaN(r[s])&&(a[s]=1);return this.makeOutput(a,n.shape,"bool")},t.prototype.isInf=function(n){ae(n,"x");for(var r=this.readSync(n.dataId),a=new Uint8Array(r.length),s=0;s<r.length;++s)Math.abs(r[s])===1/0&&(a[s]=1);return this.makeOutput(a,n.shape,"bool")},t.prototype.isFinite=function(n){ae(n,"x");for(var r=this.readSync(n.dataId),a=new Uint8Array(r.length),s=0;s<r.length;++s)Number.isFinite(r[s])&&(a[s]=1);return this.makeOutput(a,n.shape,"bool")},t.prototype.round=function(n){ae(n,"round");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=Math.floor(r[s]);r[s]-o<.5?a[s]=Math.floor(r[s]):r[s]-o>.5?a[s]=Math.ceil(r[s]):a[s]=o%2==0?o:o+1}return this.makeOutput(a,n.shape,"float32")},t.prototype.exp=function(n){ae(n,"exp");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=Math.exp(r[s]);return this.makeOutput(a,n.shape,"float32")},t.prototype.expm1=function(n){ae(n,"expm1");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=Math.expm1(r[s]);return this.makeOutput(a,n.shape,"float32")},t.prototype.log=function(n){ae(n,"log");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];a[s]=Math.log(o)}return this.makeOutput(a,n.shape,"float32")},t.prototype.log1p=function(n){ae(n,"log1p");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];a[s]=Math.log1p(o)}return this.makeOutput(a,n.shape,"float32")},t.prototype.sqrt=function(n){ae(n,"sqrt");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];a[s]=Math.sqrt(o)}return this.makeOutput(a,n.shape,"float32")},t.prototype.rsqrt=function(n){ae(n,"rsqrt");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];a[s]=1/Math.sqrt(o)}return this.makeOutput(a,n.shape,"float32")},t.prototype.reciprocal=function(n){ae(n,"reciprocal");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=1/r[s];return this.makeOutput(a,n.shape,"float32")},t.prototype.linear=function(n){return n},t.prototype.relu=function(n){ae(n,"relu");for(var r=Ye(n.shape,n.dtype),a=this.readSync(r.dataId),s=this.readSync(n.dataId),o=0;o<s.length;++o)a[o]=Math.max(0,s[o]);return r},t.prototype.relu6=function(n){ae(n,"relu");for(var r=Ye(n.shape,n.dtype),a=this.readSync(r.dataId),s=this.readSync(n.dataId),o=0;o<s.length;++o)a[o]=Math.min(Math.max(0,s[o]),6);return r},t.prototype.prelu=function(n,r){return ae([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return a<0?s*a:a})},t.prototype.elu=function(n){ae(n,"elu");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var o=a[s];r[s]=o>=0?o:Math.exp(o)-1}return this.makeOutput(r,n.shape,"float32")},t.prototype.eluDer=function(n,r){ae([n,r],"eluDer");for(var a=new Float32Array(r.size),s=this.readSync(r.dataId),o=this.readSync(n.dataId),l=0;l<s.length;++l){var c=s[l];a[l]=c>=1?o[l]:o[l]*(c+1)}return this.makeOutput(a,r.shape,"float32")},t.prototype.selu=function(n){ae(n,"selu");for(var r=$f,a=zf,s=new Float32Array(n.size),o=this.readSync(n.dataId),l=0;l<o.length;++l){var c=o[l];s[l]=c>=0?a*c:r*(Math.exp(c)-1)}return this.makeOutput(s,n.shape,"float32")},t.prototype.clip=function(n,r,a){ae(n,"clip");for(var s=new Float32Array(n.size),o=this.readSync(n.dataId),l=0;l<o.length;++l){var c=o[l];s[l]=c>a?a:c<r?r:c}return this.makeOutput(s,n.shape,"float32")},t.prototype.abs=function(n){for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.abs(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<n.size;++s){var o=a[2*s],l=a[2*s+1];r[s]=Math.hypot(o,l)}return this.makeOutput(r,n.shape,"float32")},t.prototype.int=function(n){ae(n,"int");for(var r=new Int32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=a[s];return this.makeOutput(r,n.shape,"int32")},t.prototype.sigmoid=function(n){ae(n,"sigmoid");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=1/(1+Math.exp(-a[s]));return this.makeOutput(r,n.shape,"float32")},t.prototype.softplus=function(n){ae(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,a=new Float32Array(n.size),s=this.readSync(n.dataId),o=0;o<s.length;++o){var l=s[o]>-r,c=s[o]<r,u=Math.exp(s[o]),d=void 0;d=c?u:l?s[o]:Math.log(1+u),a[o]=d}return this.makeOutput(a,n.shape,"float32")},t.prototype.sin=function(n){ae(n,"sin");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.sin(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cos=function(n){ae(n,"cos");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.cos(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tan=function(n){ae(n,"tan");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.tan(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asin=function(n){ae(n,"asin");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.asin(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acos=function(n){ae(n,"acos");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.acos(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan=function(n){ae(n,"atan");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.atan(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan2=function(n,r){return ae([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return Math.atan2(a,s)})},t.prototype.sinh=function(n){ae(n,"sinh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.sinh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cosh=function(n){ae(n,"cosh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.cosh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tanh=function(n){ae(n,"tanh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=lj(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asinh=function(n){ae(n,"asinh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.asinh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acosh=function(n){ae(n,"acosh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.acosh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atanh=function(n){ae(n,"atanh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.atanh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.erf=function(n){ae(n,"erf");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var o=Math.sign(a[s]),l=Math.abs(a[s]),c=1/(1+.3275911*l);r[s]=o*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-l*l))}return this.makeOutput(r,n.shape,"float32")},t.prototype.step=function(n,r){r===void 0&&(r=0),ae(n,"step");for(var a=new Float32Array(n.size),s=this.readSync(n.dataId),o=0;o<s.length;++o){var l=s[o];isNaN(l)?a[o]=NaN:a[o]=l>0?1:r}return this.makeOutput(a,n.shape,"float32")},t.prototype.fusedConv2d=function(n){var r=n.input,a=n.filter,s=n.convInfo,o=n.bias,l=n.activation,c=n.preluActivationWeights,u=this.conv2d(r,a,s);return o&&(u=this.add(u,o)),l&&(u=qu(this,u,l,c)),u},t.prototype.conv2d=function(n,r,a){ae([n,r],"conv2d");for(var s=a.filterHeight,o=a.filterWidth,l=a.dilationHeight,c=a.dilationWidth,u=a.padInfo.left,d=a.padInfo.top,h=a.dataFormat==="channelsLast",f=Te(a.outShape,n.dtype),p=n.strides[0],m=h?n.strides[1]:n.strides[2],x=h?n.strides[2]:1,y=h?1:n.strides[1],g=f.strides[0],v=h?f.strides[1]:f.strides[2],w=h?f.strides[2]:1,b=h?1:f.strides[1],N=this.readSync(n.dataId),_=this.readSync(r.dataId),k=f.values,j=0;j<a.batchSize;++j)for(var C=j*p,S=j*g,M=0;M<a.outHeight;++M)for(var T=S+M*v,A=M*a.strideHeight-d,L=0;L<s;L++){var O=A+L*l;if(!(O<0||O>=a.inHeight))for(var U=L*r.strides[0],z=C+O*m,F=0;F<a.outWidth;++F)for(var W=T+F*w,I=F*a.strideWidth-u,q=0;q<o;q++){var K=I+q*c;if(!(K<0||K>=a.inWidth))for(var re=z+K*x,ie=U+q*r.strides[1],ce=0;ce<a.inChannels;++ce){for(var me=N[re+ce*y],je=0;je<a.outChannels;++je)k[W+je*b]+=me*_[ie+je];ie+=a.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(n,r,a){for(var s=a.filterDepth,o=a.filterHeight,l=a.filterWidth,c=a.dilationDepth,u=a.dilationHeight,d=a.dilationWidth,h=a.padInfo.front,f=a.padInfo.left,p=a.padInfo.top,m=Te(a.outShape,n.dtype),x=this.readSync(n.dataId),y=this.readSync(r.dataId),g=m.values,v=0;v<a.batchSize;++v)for(var w=v*n.strides[0],b=v*m.strides[0],N=0;N<a.outDepth;++N)for(var _=b+N*m.strides[1],k=N*a.strideDepth-h,j=0;j<s;j++){var C=k+j*c;if(!(C<0||C>=a.inDepth))for(var S=j*r.strides[0],M=w+C*n.strides[1],T=0;T<a.outHeight;++T)for(var A=_+T*m.strides[2],L=T*a.strideHeight-p,O=0;O<o;O++){var U=L+O*u;if(!(U<0||U>=a.inHeight))for(var z=S+O*r.strides[1],F=M+U*n.strides[2],W=0;W<a.outWidth;++W)for(var I=A+W*a.outChannels,q=W*a.strideWidth-f,K=0;K<l;K++){var re=q+K*d;if(!(re<0||re>=a.inWidth))for(var ie=z+K*r.strides[2],ce=F+re*a.inChannels,me=ie,je=0;je<a.inChannels;++je){for(var G=x[ce+je],se=0;se<a.outChannels;++se)g[I+se]+=G*y[me+se];me+=a.outChannels}}}}return m.toTensor()},t.prototype.conv2dDerInput=function(n,r,a){ae([n,r],"conv2dDerInput");for(var s=Te(a.inShape,"float32"),o=s.values,l=this.readSync(n.dataId),c=this.readSync(r.dataId),u=r.strides,d=u[0],h=u[1],f=u[2],p=a.batchSize,m=a.filterHeight,x=a.filterWidth,y=a.inChannels,g=a.inHeight,v=a.inWidth,w=a.outChannels,b=a.outHeight,N=a.outWidth,_=a.strideHeight,k=a.strideWidth,j=a.dataFormat,C=m-1-a.padInfo.top,S=x-1-a.padInfo.left,M=j==="channelsLast",T=s.strides[0],A=M?s.strides[1]:s.strides[2],L=M?s.strides[2]:1,O=M?1:s.strides[1],U=n.strides[0],z=M?n.strides[1]:n.strides[2],F=M?n.strides[2]:1,W=M?1:n.strides[1],I=0;I<p;++I)for(var q=0;q<y;++q)for(var K=0;K<g;++K)for(var re=K-C,ie=Math.max(0,Math.ceil(re/_)),ce=Math.min(b,(m+re)/_),me=0;me<v;++me){for(var je=me-S,G=Math.max(0,Math.ceil(je/k)),se=Math.min(N,(x+je)/k),Ce=0,R=ie;R<ce;++R)for(var Y=R*_-re,ne=G;ne<se;++ne)for(var fe=U*I+z*R+F*ne,Se=d*(m-1-Y)+h*(x-1-(ne*k-je))+f*q,$=0;$<w;++$)Ce+=l[fe+W*$]*c[Se+$];o[T*I+A*K+L*me+O*q]=Ce}return s.toTensor()},t.prototype.conv3dDerInput=function(n,r,a){for(var s=Te(a.inShape,"float32"),o=s.values,l=s.strides,c=l[0],u=l[1],d=l[2],h=l[3],f=this.readSync(n.dataId),p=n.strides,m=p[0],x=p[1],y=p[2],g=p[3],v=this.readSync(r.dataId),w=r.strides,b=w[0],N=w[1],_=w[2],k=w[3],j=a.batchSize,C=a.filterDepth,S=a.filterHeight,M=a.filterWidth,T=a.inChannels,A=a.inDepth,L=a.inHeight,O=a.inWidth,U=a.outChannels,z=a.outDepth,F=a.outHeight,W=a.outWidth,I=a.strideDepth,q=a.strideHeight,K=a.strideWidth,re=C-1-a.padInfo.front,ie=S-1-a.padInfo.top,ce=M-1-a.padInfo.left,me=0;me<j;++me)for(var je=0;je<T;++je)for(var G=0;G<A;++G)for(var se=G-re,Ce=Math.max(0,Math.ceil(se/I)),R=Math.min(z,(C+se)/I),Y=0;Y<L;++Y)for(var ne=Y-ie,fe=Math.max(0,Math.ceil(ne/q)),Se=Math.min(F,(S+ne)/q),$=0;$<O;++$){for(var le=$-ce,ve=Math.max(0,Math.ceil(le/K)),ue=Math.min(W,(M+le)/K),Ee=0,De=Ce;De<R;++De)for(var We=De*I-se,J=fe;J<Se;++J)for(var H=J*q-ne,ee=ve;ee<ue;++ee)for(var he=m*me+x*De+y*J+g*ee,$e=b*(C-1-We)+N*(S-1-H)+_*(M-1-(ee*K-le))+k*je,Pe=0;Pe<U;++Pe)Ee+=f[he+Pe]*v[$e+Pe];o[c*me+u*G+d*Y+h*$+je]=Ee}return s.toTensor()},t.prototype.conv2dDerFilter=function(n,r,a){ae([n,r],"conv2dDerFilter");for(var s=a.strideHeight,o=a.strideWidth,l=a.filterHeight,c=a.filterWidth,u=a.dataFormat==="channelsLast",d=Te(a.filterShape,"float32"),h=a.padInfo.left,f=a.padInfo.top,p=this.bufferSync(n),m=this.bufferSync(r),x=0;x<l;++x)for(var y=Math.max(0,Math.ceil((f-x)/s)),g=Math.min(a.outHeight,(a.inHeight+f-x)/s),v=0;v<c;++v)for(var w=Math.max(0,Math.ceil((h-v)/o)),b=Math.min(a.outWidth,(a.inWidth+h-v)/o),N=0;N<a.inChannels;++N)for(var _=0;_<a.outChannels;++_){for(var k=0,j=0;j<a.batchSize;++j)for(var C=y;C<g;++C)for(var S=x+C*s-f,M=w;M<b;++M){var T=v+M*o-h;k+=u?p.get(j,S,T,N)*m.get(j,C,M,_):p.get(j,N,S,T)*m.get(j,_,C,M)}d.set(k,x,v,N,_)}return d.toTensor()},t.prototype.conv3dDerFilter=function(n,r,a){for(var s=a.strideDepth,o=a.strideHeight,l=a.strideWidth,c=a.filterDepth,u=a.filterHeight,d=a.filterWidth,h=Te(a.filterShape,"float32"),f=h.values,p=h.strides,m=p[0],x=p[1],y=p[2],g=p[3],v=this.readSync(r.dataId),w=r.strides,b=w[0],N=w[1],_=w[2],k=w[3],j=this.readSync(n.dataId),C=n.strides,S=C[0],M=C[1],T=C[2],A=C[3],L=a.padInfo.front,O=a.padInfo.left,U=a.padInfo.top,z=0;z<c;++z)for(var F=Math.max(0,Math.ceil((L-z)/s)),W=Math.min(a.outDepth,(a.inDepth+L-z)/s),I=z*m,q=0;q<u;++q)for(var K=Math.max(0,Math.ceil((U-q)/o)),re=Math.min(a.outHeight,(a.inHeight+U-q)/o),ie=q*x+I,ce=0;ce<d;++ce)for(var me=Math.max(0,Math.ceil((O-ce)/l)),je=Math.min(a.outWidth,(a.inWidth+O-ce)/l),G=ce*y+ie,se=0;se<a.inChannels;++se)for(var Ce=se*g+G,R=0;R<a.outChannels;++R){for(var Y=0,ne=0;ne<a.batchSize;++ne)for(var fe=ne*S,Se=ne*b,$=F;$<W;++$)for(var le=(z+$*s-L)*M+fe,ve=$*N+Se,ue=K;ue<re;++ue)for(var Ee=(q+ue*o-U)*T+le,De=ue*_+ve,We=me;We<je;++We){var J=We*k+De;Y+=j[(ce+We*l-O)*A+Ee+se]*v[J+R]}f[Ce+R]=Y}return h.toTensor()},t.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,a=n.filter,s=n.convInfo,o=n.bias,l=n.activation,c=n.preluActivationWeights,u=this.depthwiseConv2D(r,a,s);return o&&(u=this.add(u,o)),l&&(u=qu(this,u,l,c)),u},t.prototype.depthwiseConv2D=function(n,r,a){ae([n,r],"depthwiseConv2D");for(var s=a.filterHeight,o=a.filterWidth,l=a.dilationHeight,c=a.dilationWidth,u=a.padInfo.left,d=a.padInfo.top,h=a.outChannels/a.inChannels,f=Te(a.outShape,n.dtype),p=this.readSync(n.dataId),m=this.readSync(r.dataId),x=f.values,y=0;y<a.batchSize;++y)for(var g=y*n.strides[0],v=y*f.strides[0],w=0;w<a.outHeight;++w)for(var b=v+w*f.strides[1],N=w*a.strideHeight-u,_=0;_<s;++_){var k=N+_*l;if(!(k<0||k>=a.inHeight))for(var j=_*r.strides[0],C=g+k*n.strides[1],S=0;S<a.outWidth;++S)for(var M=b+S*f.strides[2],T=S*a.strideWidth-d,A=0;A<o;++A){var L=T+A*c;if(!(L<0||L>=a.inWidth))for(var O=j+A*r.strides[1],U=C+L*a.inChannels,z=M,F=O,W=0;W<a.inChannels;++W){for(var I=p[U+W],q=0;q<h;++q)x[z+q]+=I*m[F+q];z+=h,F+=h}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(n,r,a){ae([n,r],"depthwiseConv2DDerInput");for(var s=Te(a.inShape,"float32"),o=s.values,l=s.strides,c=l[0],u=l[1],d=l[2],h=this.readSync(n.dataId),f=n.strides,p=f[0],m=f[1],x=f[2],y=this.readSync(r.dataId),g=r.strides,v=g[0],w=g[1],b=g[2],N=a.batchSize,_=a.filterHeight,k=a.filterWidth,j=a.inChannels,C=a.inHeight,S=a.inWidth,M=a.outChannels,T=a.outHeight,A=a.outWidth,L=a.strideHeight,O=a.strideWidth,U=_-1-a.padInfo.top,z=k-1-a.padInfo.left,F=M/j,W=0;W<N;++W)for(var I=0;I<j;++I)for(var q=0;q<C;++q)for(var K=q-U,re=Math.max(0,Math.ceil(K/L)),ie=Math.min(T,(_+K)/L),ce=0;ce<S;++ce){for(var me=ce-z,je=Math.max(0,Math.ceil(me/O)),G=Math.min(A,(k+me)/O),se=0,Ce=re;Ce<ie;++Ce)for(var R=Ce*L-K,Y=je;Y<G;++Y)for(var ne=p*W+m*Ce+x*Y,fe=v*(_-1-R)+w*(k-1-(Y*O-me))+b*I,Se=0;Se<F;++Se)se+=h[ne+(I*F+Se)]*y[fe+Se];o[c*W+u*q+d*ce+I]=se}return s.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(n,r,a){ae([n,r],"depthwiseConv2DDerFilter");for(var s=a.strideHeight,o=a.strideWidth,l=a.filterHeight,c=a.filterWidth,u=Te(a.filterShape,"float32"),d=a.padInfo.left,h=a.padInfo.top,f=a.outChannels/a.inChannels,p=this.bufferSync(n),m=this.bufferSync(r),x=0;x<l;++x)for(var y=Math.max(0,Math.ceil((h-x)/s)),g=Math.min(a.outHeight,(a.inHeight+h-x)/s),v=0;v<c;++v)for(var w=Math.max(0,Math.ceil((d-v)/o)),b=Math.min(a.outWidth,(a.inWidth+d-v)/o),N=0;N<a.outChannels;++N){for(var _=Math.trunc(N/f),k=N%f,j=0,C=0;C<a.batchSize;++C)for(var S=y;S<g;++S)for(var M=x+S*s-h,T=w;T<b;++T){var A=v+T*o-d;j+=p.get(C,M,A,_)*m.get(C,S,T,N)}u.set(j,x,v,_,k)}return u.toTensor()},t.prototype.tile=function(n,r){return ae(n,"tile"),xy(this.bufferSync(n),r)},t.prototype.pad=function(n,r,a){ae(n,"pad");var s=r.map(function(f,p){return f[0]+n.shape[p]+f[1]}),o=r.map(function(f){return f[0]}),l=this.bufferSync(n),c=Te(s,n.dtype);a!==0&&c.values.fill(a);for(var u=0;u<n.size;u++){var d=l.indexToLoc(u),h=d.map(function(f,p){return f+o[p]});c.set.apply(c,[l.get.apply(l,d)].concat(h))}return c.toTensor()},t.prototype.transpose=function(n,r){ae(n,"transpose");for(var a=new Array(n.rank),s=0;s<a.length;s++)a[s]=n.shape[r[s]];var o=this.readSync(n.dataId),l=Te(a,n.dtype),c=this.bufferSync(n);for(s=0;s<n.size;++s){for(var u=c.indexToLoc(s),d=new Array(u.length),h=0;h<d.length;h++)d[h]=u[r[h]];var f=l.locToIndex(d);l.values[f]=o[s]}return l.toTensor()},t.prototype.gather=function(n,r,a){ae([n,r],"gather");var s=n.shape.slice(),o=this.readSync(r.dataId);s[a]=o.length;for(var l=Te(s,n.dtype),c=this.bufferSync(n),u=0;u<l.size;++u){var d=l.indexToLoc(u),h=d.slice();h[a]=o[d[a]];var f=c.locToIndex(h);l.values[u]=c.values[f]}return l.toTensor()},t.prototype.batchToSpaceND=function(n,r,a){ae([n],"batchToSpaceND");var s=r.reduce(function(h,f){return h*f}),o=oc(n.shape,r,s),l=ic(o.length,r.length),c=lc(n.shape,r,s),u=sy(a,r.length),d=oy(c,a,r.length);return n.reshape(o).transpose(l).reshape(c).slice(u,d)},t.prototype.spaceToBatchND=function(n,r,a){ae([n],"spaceToBatchND");var s=r.reduce(function(f,p){return f*p}),o=[[0,0]];o.push.apply(o,a);for(var l=1+r.length;l<n.shape.length;++l)o.push([0,0]);var c=n.pad(o),u=oc(c.shape,r,s,!1),d=ic(u.length,r.length,!1),h=lc(c.shape,r,s,!1);return c.reshape(u).transpose(d).reshape(h)},t.prototype.pool=function(n,r,a){ae(n,"pool");for(var s=r.strideHeight,o=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,p=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(n.dataId),x=Te(r.outShape,n.dtype),y=x.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],v=r.outShape[2]*r.outShape[3],w=r.outShape[3],b=0;b<r.batchSize;++b)for(var N=b*g,_=b*n.strides[0],k=0;k<r.inChannels;++k)for(var j=0;j<r.outHeight;++j)for(var C=j*s-h,S=Math.max(0,C),M=Math.min(r.inHeight,u+C),T=N+j*v,A=0;A<r.outWidth;++A){for(var L=A*o-f,O=Math.max(0,L),U=Math.min(r.inWidth,d+L),z=p,F=0,W=0,I=S;I<M;I+=l){for(var q=_+I*n.strides[1],K=O;K<U;K+=c){var re=m[q+K*n.strides[2]+k];a==="max"&&re>z?z=re:a==="avg"&&(F+=re,W++)}if(isNaN(z))break}y[T+A*w+k]=a==="avg"?F/W:z}return x.toTensor()},t.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},t.prototype.maxPoolPositions=function(n,r){for(var a=Te(r.outShape,"int32"),s=r.strideHeight,o=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,p=this.bufferSync(n),m=0;m<r.batchSize;++m)for(var x=0;x<r.inChannels;++x)for(var y=0;y<r.outHeight;++y){for(var g=y*s-h,v=g;v<0;)v+=l;for(var w=Math.min(r.inHeight,u+g),b=0;b<r.outWidth;++b){for(var N=b*o-f,_=N;_<0;)_+=c;for(var k=Math.min(r.inWidth,d+N),j=Number.NEGATIVE_INFINITY,C=-1,S=v;S<w;S+=l)for(var M=S-g,T=_;T<k;T+=c){var A=T-N,L=p.get(m,S,T,x);L>j&&(j=L,C=M*d+A)}a.set(C,m,y,b,x)}}return a.toTensor()},t.prototype.maxPoolBackprop=function(n,r,a,s){ae([r,a],"maxPoolBackprop");for(var o=this.maxPoolPositions(r,s),l=s.strideHeight,c=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,h=s.effectiveFilterHeight,f=s.effectiveFilterWidth,p=f-1-s.padInfo.left,m=h-1-s.padInfo.top,x=Te(r.shape,"float32"),y=this.bufferSync(o),g=this.bufferSync(n),v=0;v<s.batchSize;++v)for(var w=0;w<s.inChannels;++w)for(var b=0;b<s.inHeight;++b)for(var N=0;N<s.inWidth;++N){for(var _=b-m,k=N-p,j=0,C=0;C<h;C+=u){var S=(_+C)/l;if(!(S<0||S>=s.outHeight||Math.floor(S)!==S))for(var M=0;M<f;M+=d){var T=(k+M)/c;if(!(T<0||T>=s.outWidth||Math.floor(T)!==T)){var A=h*f-1-y.get(v,S,T,w)===C*f+M?1:0;A!==0&&(j+=g.get(v,S,T,w)*A)}}}x.set(j,v,b,N,w)}return x.toTensor()},t.prototype.avgPoolBackprop=function(n,r,a){ae([n,r],"avgPoolBackprop");for(var s=a.strideHeight,o=a.strideWidth,l=a.filterHeight,c=a.filterWidth,u=a.dilationHeight,d=a.dilationWidth,h=a.effectiveFilterHeight,f=a.effectiveFilterWidth,p=f-1-a.padInfo.left,m=h-1-a.padInfo.top,x=Te(r.shape,"float32"),y=1/(l*c),g=this.bufferSync(n),v=0;v<a.batchSize;++v)for(var w=0;w<a.inChannels;++w)for(var b=0;b<a.inHeight;++b)for(var N=0;N<a.inWidth;++N){for(var _=b-m,k=N-p,j=0,C=0;C<h;C+=u){var S=(_+C)/s;if(!(S<0||S>=a.outHeight||Math.floor(S)!==S))for(var M=0;M<f;M+=d){var T=(k+M)/o;T<0||T>=a.outWidth||Math.floor(T)!==T||(j+=g.get(v,S,T,w))}}x.set(j*y,v,b,N,w)}return x.toTensor()},t.prototype.pool3d=function(n,r,a){ae(n,"pool3d");for(var s=r.strideDepth,o=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,g=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(n.dataId),w=Te(r.outShape,n.dtype),b=w.values,N=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[3]*r.outShape[4],j=r.outShape[4],C=0;C<r.batchSize;++C)for(var S=C*N,M=C*n.strides[0],T=0;T<r.inChannels;++T)for(var A=0;A<r.outDepth;++A){for(var L=A*s-m,O=L;O<0;)O+=c;for(var U=Math.min(r.inDepth,h+L),z=S+A*_,F=0;F<r.outHeight;++F){for(var W=F*o-x,I=W;I<0;)I+=u;for(var q=Math.min(r.inHeight,f+W),K=z+F*k,re=0;re<r.outWidth;++re){for(var ie=re*l-y,ce=ie;ce<0;)ce+=d;for(var me=Math.min(r.inWidth,p+ie),je=K+re*j,G=g,se=0,Ce=0,R=O;R<U;R+=c){for(var Y=M+R*n.strides[1],ne=I;ne<q;ne+=u){for(var fe=Y+ne*n.strides[2],Se=ce;Se<me;Se+=d){var $=v[fe+Se*n.strides[3]+T];if(a==="max"&&$>G?G=$:a==="avg"&&(se+=$,Ce++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}b[je+T]=a==="avg"?se/Ce:G}}}return w.toTensor()},t.prototype.avgPool3d=function(n,r){return ae(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(n,r,a){ae([n,r],"avgPool3dBackprop");for(var s=a.strideDepth,o=a.strideHeight,l=a.strideWidth,c=a.filterDepth,u=a.filterHeight,d=a.filterWidth,h=a.dilationDepth,f=a.dilationHeight,p=a.dilationWidth,m=a.effectiveFilterDepth,x=a.effectiveFilterHeight,y=a.effectiveFilterWidth,g=m-1-a.padInfo.front,v=y-1-a.padInfo.left,w=x-1-a.padInfo.top,b=Te(r.shape,"float32"),N=1/(c*u*d),_=this.bufferSync(n),k=0;k<a.batchSize;++k)for(var j=0;j<a.inChannels;++j)for(var C=0;C<a.inDepth;++C)for(var S=0;S<a.inHeight;++S)for(var M=0;M<a.inWidth;++M){for(var T=C-g,A=S-w,L=M-v,O=0,U=0;U<m;U+=h){var z=(T+U)/s;if(!(z<0||z>=a.outDepth||Math.floor(z)!==z))for(var F=0;F<x;F+=f){var W=(A+F)/o;if(!(W<0||W>=a.outHeight||Math.floor(W)!==W))for(var I=0;I<y;I+=p){var q=(L+I)/l;q<0||q>=a.outWidth||Math.floor(q)!==q||(O+=_.get(k,z,W,q,j))}}}b.set(O*N,k,C,S,M,j)}return b.toTensor()},t.prototype.maxPool3d=function(n,r){return ae(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(n,r){for(var a=Te(r.outShape,"int32"),s=r.strideDepth,o=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,g=this.bufferSync(n),v=0;v<r.batchSize;++v)for(var w=0;w<r.inChannels;++w)for(var b=0;b<r.outDepth;++b){for(var N=b*s-m,_=N;_<0;)_+=c;for(var k=Math.min(r.inDepth,h+N),j=0;j<r.outHeight;++j){for(var C=j*o-x,S=C;S<0;)S+=u;for(var M=Math.min(r.inHeight,f+C),T=0;T<r.outWidth;++T){for(var A=T*l-y,L=A;L<0;)L+=d;for(var O=Math.min(r.inWidth,p+A),U=Number.NEGATIVE_INFINITY,z=-1,F=_;F<k;F+=c)for(var W=F-N,I=S;I<M;I+=u)for(var q=I-C,K=L;K<O;K+=d){var re=K-A,ie=g.get(v,F,I,K,w);ie>=U&&(U=ie,z=W*f*p+q*f+re)}a.set(z,v,b,j,T,w)}}}return a.toTensor()},t.prototype.maxPool3dBackprop=function(n,r,a,s){ae([r,a],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(r,s),l=s.strideDepth,c=s.strideHeight,u=s.strideWidth,d=s.dilationDepth,h=s.dilationHeight,f=s.dilationWidth,p=s.effectiveFilterDepth,m=s.effectiveFilterHeight,x=s.effectiveFilterWidth,y=p-1-s.padInfo.front,g=x-1-s.padInfo.left,v=m-1-s.padInfo.top,w=Te(r.shape,"float32"),b=this.bufferSync(o),N=this.bufferSync(n),_=0;_<s.batchSize;++_)for(var k=0;k<s.inChannels;++k)for(var j=0;j<s.inDepth;++j)for(var C=0;C<s.inHeight;++C)for(var S=0;S<s.inWidth;++S){for(var M=j-y,T=C-v,A=S-g,L=0,O=0;O<p;O+=d){var U=(M+O)/l;if(!(U<0||U>=s.outDepth||Math.floor(U)!==U))for(var z=0;z<m;z+=h){var F=(T+z)/c;if(!(F<0||F>=s.outHeight||Math.floor(F)!==F))for(var W=0;W<x;W+=f){var I=(A+W)/u;if(!(I<0||I>=s.outWidth||Math.floor(I)!==I)){var q=p*m*x-1-b.get(_,U,F,I,k)===O*m*x+z*x+W?1:0;q!==0&&(L+=N.get(_,U,F,I,k)*q)}}}}w.set(L,_,j,C,S,k)}return w.toTensor()},t.prototype.cast=function(n,r){return py(n,r,this)},t.prototype.reshape=function(n,r){return mh(n,r)},t.prototype.avgPool=function(n,r){return ae(n,"avgPool"),this.pool(n,r,"avg").toFloat()},t.prototype.resizeBilinear=function(n,r,a,s){ae(n,"resizeBilinear");for(var o=n.shape,l=o[0],c=o[1],u=o[2],d=o[3],h=this.readSync(n.dataId),f=new Float32Array(be([l,r,a,d])),p=[s&&r>1?c-1:c,s&&a>1?u-1:u],m=[s&&r>1?r-1:r,s&&a>1?a-1:a],x=0,y=p[0]/m[0],g=p[1]/m[1],v=0;v<l;v++)for(var w=0;w<r;w++)for(var b=y*w,N=Math.floor(b),_=b-N,k=Math.min(c-1,Math.ceil(b)),j=v*n.strides[0]+N*n.strides[1],C=v*n.strides[0]+k*n.strides[1],S=0;S<a;S++)for(var M=g*S,T=Math.floor(M),A=M-T,L=Math.min(u-1,Math.ceil(M)),O=j+T*n.strides[2],U=C+T*n.strides[2],z=j+L*n.strides[2],F=C+L*n.strides[2],W=0;W<d;W++){var I=h[O+W],q=h[U+W],K=I+(h[z+W]-I)*A,re=K+(q+(h[F+W]-q)*A-K)*_;f[x++]=re}return Mt(f,[l,r,a,d])},t.prototype.resizeBilinearBackprop=function(n,r,a){ae([n,r],"resizeBilinearBackprop");for(var s=r.shape,o=s[0],l=s[1],c=s[2],u=s[3],d=n.shape,h=d[1],f=d[2],p=new Float32Array(o*l*c*u),m=[a&&h>1?l-1:l,a&&f>1?c-1:c],x=[a&&h>1?h-1:h,a&&f>1?f-1:f],y=m[0]/x[0],g=m[1]/x[1],v=this.readSync(n.dataId),w=0,b=0;b<o;b++)for(var N=b*r.strides[0],_=0;_<h;_++)for(var k=_*y,j=Math.floor(k),C=Math.min(Math.ceil(k),l-1),S=N+j*r.strides[1],M=N+C*r.strides[1],T=k-j,A=1-T,L=0;L<f;L++)for(var O=L*g,U=Math.floor(O),z=Math.min(Math.ceil(O),c-1),F=O-U,W=1-F,I=S+U*r.strides[2],q=S+z*r.strides[2],K=M+U*r.strides[2],re=M+z*r.strides[2],ie=A*W,ce=A*F,me=T*W,je=T*F,G=0;G<u;G++){var se=v[w++];p[I+G]+=se*ie,p[q+G]+=se*ce,p[K+G]+=se*me,p[re+G]+=se*je}return sn(p,[o,c,l,u],r.dtype)},t.prototype.resizeNearestNeighbor=function(n,r,a,s){ae(n,"resizeNearestNeighbor");for(var o=n.shape,l=o[0],c=o[1],u=o[2],d=o[3],h=this.readSync(n.dataId),f=new Float32Array(l*r*a*d),p=[s&&r>1?c-1:c,s&&a>1?u-1:u],m=[s&&r>1?r-1:r,s&&a>1?a-1:a],x=p[0]/m[0],y=p[1]/m[1],g=0,v=0;v<l;v++)for(var w=v*n.strides[0],b=0;b<r;b++)for(var N=x*b,_=w+Math.min(c-1,s?Math.round(N):Math.floor(N))*n.strides[1],k=0;k<a;k++)for(var j=y*k,C=_+Math.min(u-1,s?Math.round(j):Math.floor(j))*n.strides[2],S=0;S<d;S++){var M=h[C+S];f[g++]=M}return Mt(f,[l,r,a,d],n.dtype)},t.prototype.resizeNearestNeighborBackprop=function(n,r,a){ae([n,r],"resizeNearestNeighborBackprop");for(var s=r.shape,o=s[0],l=s[1],c=s[2],u=s[3],d=n.shape,h=d[1],f=d[2],p=new Float32Array(o*l*c*u),m=this.readSync(n.dataId),x=[a&&h>1?l-1:l,a&&f>1?c-1:c],y=[a&&h>1?h-1:h,a&&f>1?f-1:f],g=x[0]/y[0],v=x[1]/y[1],w=1/g,b=1/v,N=2*Math.ceil(w)+2,_=2*Math.ceil(b)+2,k=0;k<o;k++)for(var j=k*r.strides[0],C=0;C<l;C++)for(var S=j+C*r.strides[1],M=Math.floor(C*w),T=Math.floor(M-N/2),A=0;A<c;A++)for(var L=S+A*r.strides[2],O=Math.floor(A*b),U=Math.floor(O-_/2),z=0;z<u;z++){for(var F=0,W=0;W<N;W++){var I=W+T;if(!(I<0||I>=h)){var q=j+I*n.strides[1],K=I*g;if(C===Math.min(l-1,a?Math.round(K):Math.floor(K)))for(var re=0;re<_;re++){var ie=re+U;if(!(ie<0||ie>=f)){var ce=q+ie*n.strides[2],me=ie*v;A===Math.min(c-1,a?Math.round(me):Math.floor(me))&&(F+=m[ce+z])}}}}p[L+z]=F}return sn(p,r.shape,r.dtype)},t.prototype.batchNormalization=function(n,r,a,s,o,l){ae([n,r,a,o,l],"batchNorm");for(var c=this.readSync(n.dataId),u=this.readSync(r.dataId),d=this.readSync(a.dataId),h=o?this.readSync(o.dataId):new Float32Array([1]),f=l?this.readSync(l.dataId):new Float32Array([0]),p=new Float32Array(c.length),m=f.length,x=h.length,y=d.length,g=u.length,v=0,w=0,b=0,N=0,_=0;_<c.length;++_)p[_]=f[v++]+(c[_]-u[w++])*h[b++]/Math.sqrt(d[N++]+s),v>=m&&(v=0),w>=g&&(w=0),b>=x&&(b=0),N>=y&&(N=0);return sn(p,n.shape)},t.prototype.localResponseNormalization4D=function(n,r,a,s,o){ae(n,"localResponseNormalization4D");var l=n.shape[3],c=l-1,u=this.readSync(n.dataId),d=n.size,h=new Float32Array(d);function f(y){for(var g=y%l,v=y-g+Math.max(0,g-r),w=y-g+Math.min(g+r,c),b=0;v<=w;v++){var N=u[v];b+=N*N}return b}for(var p=0;p<d;p++){var m=f(p),x=u[p]*Math.pow(a+s*m,-o);h[p]=x}return sn(h,n.shape)},t.prototype.LRNGrad=function(n,r,a,s,o,l,c){ae(n,"LRNGrad");for(var u=n.shape[3],d=this.readSync(n.dataId),h=this.readSync(r.dataId),f=this.readSync(a.dataId),p=new Float32Array(n.size),m=n.size,x=0;x<m;x++){for(var y=x%u,g=x-y+Math.max(0,y-s),v=x-y+Math.min(u,y+s+1),w=0,b=g;b<v;b++)w+=Math.pow(h[b],2);for(w=l*w+o,b=g;b<v;b++){var N=-2*l*c*h[b]*f[x]/w;x===b&&(N+=Math.pow(w,-c)),N*=d[x],p[b]+=N}}return sn(p,n.shape)},t.prototype.multinomial=function(n,r,a,s){ae(n,"multinomial");for(var o=r?n:Lr(n),l=o.shape[0],c=o.shape[1],u=Ye([l,a],"int32"),d=this.readSync(u.dataId),h=this.readSync(o.dataId),f=0;f<l;++f){var p=f*c,m=new Float32Array(c-1);m[0]=h[p];for(var x=1;x<m.length;++x)m[x]=m[x-1]+h[p+x];for(var y=Bc(s.toString()),g=f*a,v=0;v<a;++v){var w=y();d[g+v]=m.length;for(var b=0;b<m.length;b++)if(w<m[b]){d[g+v]=b;break}}}return u},t.prototype.oneHot=function(n,r,a,s){ae(n,"oneHot");var o=new Float32Array(n.size*r);o.fill(s);for(var l=this.readSync(n.dataId),c=0;c<n.size;++c)l[c]>=0&&l[c]<r&&(o[c*r+l[c]]=a);return ha(o,[n.size,r],"int32")},t.prototype.nonMaxSuppression=function(n,r,a,s,o){return ae(n,"nonMaxSuppression"),Of(this.readSync(n.dataId),this.readSync(r.dataId),a,s,o)},t.prototype.fft=function(n){return this.fftBatch(n,!1)},t.prototype.ifft=function(n){return this.fftBatch(n,!0)},t.prototype.fftBatch=function(n,r){for(var a=n.shape[0],s=n.shape[1],o=Te(n.shape,"float32"),l=Te(n.shape,"float32"),c=Pn(n).as2D(a,s),u=cr(n).as2D(a,s),d=0;d<a;d++)for(var h=c.slice([d,0],[1,s]),f=u.slice([d,0],[1,s]),p=Pt(h,f),m=this.readSync(this.fftImpl(p,r).dataId),x=0;x<s;x++){var y=gg(m,x);o.values[d*s+x]=y.real,l.values[d*s+x]=y.imag}return Pt(o.toTensor(),l.toTensor()).as2D(a,s)},t.prototype.fftImpl=function(n,r){var a=n.as1D(),s=a.size;if(this.isExponentOf2(s)){var o=this.fftRadix2(a,s,r).as2D(n.shape[0],n.shape[1]);return r&&(o=Pt(Pn(o).div(de(s)),cr(o).div(de(s)))),o}var l=this.readSync(n.dataId),c=function(u){for(var d=new Float32Array(u.length/2),h=new Float32Array(u.length/2),f=0;f<u.length;f+=2)d[f/2]=u[f],h[f/2]=u[f+1];return{real:d,imag:h}}(this.fourierTransformByMatmul(l,s,r));return Pt(c.real,c.imag).as2D(n.shape[0],n.shape[1])},t.prototype.isExponentOf2=function(n){return(n&n-1)==0},t.prototype.fftRadix2=function(n,r,a){if(r===1)return n;var s=this.readSync(n.dataId),o=r/2,l=function(g){for(var v=Math.ceil(g.length/4),w=new Float32Array(v),b=new Float32Array(v),N=0;N<g.length;N+=4)w[Math.floor(N/4)]=g[N],b[Math.floor(N/4)]=g[N+1];return{real:w,imag:b}}(s),c=Pt(l.real,l.imag).as1D(),u=function(g){for(var v=Math.floor(g.length/4),w=new Float32Array(v),b=new Float32Array(v),N=2;N<g.length;N+=4)w[Math.floor(N/4)]=g[N],b[Math.floor(N/4)]=g[N+1];return{real:w,imag:b}}(s),d=Pt(u.real,u.imag).as1D();c=this.fftRadix2(c,o,a),d=this.fftRadix2(d,o,a);var h=function(g,v){for(var w=new Float32Array(g/2),b=new Float32Array(g/2),N=0;N<Math.ceil(g/2);N++){var _=(v?2:-2)*Math.PI*(N/g);w[N]=Math.cos(_),b[N]=Math.sin(_)}return{real:w,imag:b}}(r,a),f=Pt(h.real,h.imag).mul(d),p=c.add(f),m=c.sub(f),x=Pn(p).concat(Pn(m)),y=cr(p).concat(cr(m));return Pt(x,y).as1D()},t.prototype.fourierTransformByMatmul=function(n,r,a){for(var s=new Float32Array(2*r),o=0;o<r;o++){for(var l=0,c=0,u=0;u<r;u++){var d=$k(o*u,r,a),h=gg(n,u);l+=h.real*d.real-h.imag*d.imag,c+=h.real*d.imag+h.imag*d.real}a&&(l/=r,c/=r),Wk(s,l,c,o)}return s},t.prototype.depthToSpace=function(n,r,a){P(a==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+a}),P(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var s=n.shape[0],o=n.shape[1],l=n.shape[2],c=n.shape[3],u=o*r,d=l*r,h=c/(r*r),f=this.readSync(n.dataId),p=new Float32Array(s*u*d*h),m=0,x=0;x<s;++x)for(var y=0;y<u;++y)for(var g=Math.floor(y/r),v=y%r,w=0;w<d;++w)for(var b=Math.floor(w/r),N=(v*r+w%r)*h,_=0;_<h;++_){var k=_+N+c*(b+l*(g+o*x));p[m++]=f[k]}return sn(p,[s,u,d,h])},t.prototype.broadcastedBinaryOp=function(n,r,a,s){var o=Le(n.shape,r.shape),l=Te(o,a),c=this.readSync(n.dataId),u=this.readSync(r.dataId),d=ea(n.shape,o),h=ea(r.shape,o),f=l.values;if(d.length+h.length===0)for(var p=0;p<f.length;++p)f[p]=s(c[p%c.length],u[p%u.length]);else{var m=this.bufferSync(n),x=this.bufferSync(r),y=function(g){var v=l.indexToLoc(g),w=v.slice(-n.rank);d.forEach(function(k){return w[k]=0});var b=m.locToIndex(w),N=v.slice(-r.rank);h.forEach(function(k){return N[k]=0});var _=x.locToIndex(N);f[g]=s(c[b],u[_])};for(p=0;p<f.length;++p)y(p)}return l.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(n,r,a){var s=Le(n.shape,r.shape),o=Te(s,"float32"),l=Te(s,"float32"),c=this.readSync(n.dataId),u=this.readSync(r.dataId),d=ea(n.shape,s),h=ea(r.shape,s),f=o.values,p=l.values;if(d.length+h.length===0)for(var m=0;m<f.length;m++){var x=m%c.length,y=m%u.length,g=a(c[2*x],c[2*x+1],u[2*y],u[2*y+1]);f[m]=g.real,p[m]=g.imag}else{var v=this.bufferSync(this.data.get(n.dataId).complexTensors.real),w=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(N){var _=o.indexToLoc(N),k=_.slice(-n.rank);d.forEach(function(T){return k[T]=0});var j=v.locToIndex(k),C=_.slice(-r.rank);h.forEach(function(T){return C[T]=0});var S=w.locToIndex(C),M=a(c[2*j],c[2*j+1],u[2*S],u[2*S+1]);f[N]=M.real,p[N]=M.imag};for(m=0;m<f.length;m++)b(m)}return this.complex(o.toTensor(),l.toTensor())},t.prototype.split=function(n,r,a){return vy(n,r,a)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(n,r,a,s,o,l){for(var c=n.shape,u=c[0],d=c[1],h=c[2],f=c[3],p=r.shape[0],m=s[0],x=s[1],y=Te([p,m,x,f],"float32"),g=this.readSync(r.dataId),v=this.readSync(a.dataId),w=this.readSync(n.dataId),b=n.strides,N=y.strides,_=0;_<p;_++){var k=4*_,j=g[k],C=g[k+1],S=g[k+2],M=g[k+3],T=v[_];if(!(T>=u))for(var A=m>1?(S-j)*(d-1)/(m-1):0,L=x>1?(M-C)*(h-1)/(x-1):0,O=0;O<m;O++){var U=m>1?j*(d-1)+O*A:.5*(j+S)*(d-1);if(U<0||U>d-1)for(var z=0;z<x;z++)for(var F=0;F<f;F++){var W=F+z*N[2]+O*N[1]+_*N[0];y.values[W]=l}else if(o==="bilinear"){var I=Math.floor(U),q=Math.ceil(U),K=U-I;for(z=0;z<x;z++)if((R=x>1?C*(h-1)+z*L:.5*(C+M)*(h-1))<0||R>h-1)for(F=0;F<f;F++)W=F+z*N[2]+O*N[1]+_*N[0],y.values[W]=l;else{var re=Math.floor(R),ie=Math.ceil(R),ce=R-re;for(F=0;F<f;F++){var me=w[W=F+re*b[2]+I*b[1]+T*b[0]],je=w[W=F+ie*b[2]+I*b[1]+T*b[0]],G=w[W=F+re*b[2]+q*b[1]+T*b[0]],se=me+(je-me)*ce,Ce=G+(w[W=F+ie*b[2]+q*b[1]+T*b[0]]-G)*ce;W=F+z*N[2]+O*N[1]+_*N[0],y.values[W]=se+(Ce-se)*K}}}else for(z=0;z<x;++z){var R;if((R=x>1?C*(h-1)+z*L:.5*(C+M)*(h-1))<0||R>h-1)for(F=0;F<f;F++)W=F+z*N[2]+O*N[1]+_*N[0],y.values[W]=l;else{var Y=Math.round(R),ne=Math.round(U);for(F=0;F<f;F++){var fe=F+Y*b[2]+ne*b[1]+T*b[0],Se=F+z*N[2]+O*N[1]+_*N[0];y.values[Se]=w[fe]}}}}}return y.toTensor()},t.prototype.sparseToDense=function(n,r,a,s){var o=cc(0,n,a),l=o.sliceRank,c=o.numUpdates,u=o.sliceSize,d=o.strides,h=o.outputSize;return this.scatter(n,r,a,h,u,c,l,d,s,!1)},t.prototype.gatherND=function(n,r){var a=r.shape,s=a[a.length-1],o=iy(n,r),l=o[0],c=o[1],u=o[2],d=o[3];if(c===0)return Mt([],l,n.dtype);for(var h=new di([c,u],n.dtype),f=this.readSync(r.dataId),p=this.readSync(n.dataId),m=0;m<c;m++){for(var x=[],y=0,g=0;g<s;g++){var v=f[m*s+g];y+=v*d[g],x.push(v)}if(y<0||y>=n.size/u)throw new Error("Invalid indices: "+x+" does not index into "+n.shape);for(var w=0;w<u;w++)h.values[m*u+w]=p[y*u+w]}return h.toTensor().reshape(l)},t.prototype.scatterND=function(n,r,a){var s=cc(0,n,a),o=s.sliceRank,l=s.numUpdates,c=s.sliceSize,u=s.strides,d=s.outputSize,h=de(0);return this.scatter(n,r,a,d,c,l,o,u,h,!0)},t.prototype.fill=function(n,r,a){var s=Zl(a=a||Ni(r),be(n));return s.fill(r),V.makeTensor(s,n,a,this)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){var r=Zl(n.dtype,be(n.shape));return this.makeOutput(r,n.shape,n.dtype)},t.prototype.linspace=function(n,r,a){return my(n,r,a)},t.prototype.scatter=function(n,r,a,s,o,l,c,u,d,h){var f=[s/o,o],p=this.readSync(n.dataId),m=this.readSync(r.dataId);if(s===0)return Mt([],a,r.dtype);var x=new di(f,r.dtype);x.values.fill(this.readSync(d.dataId)[0]);for(var y=0;y<l;y++){for(var g=[],v=0,w=0;w<c;w++){var b=p[y*c+w];g.push(b),v+=b*u[w]}if(v<0||v>=s/o)throw new Error("Invalid indices: "+g+" does not index into "+a);for(var N=0;N<o;N++)h?x.values[v*o+N]+=m[y*o+N]:x.values[v*o+N]=r.rank===0?m[0]:m[y*o+N]}return x.toTensor().reshape(a)},t}(hy);V.registerBackend("cpu",function(){return new i3},1);for(var Hu=0,Lg=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t,s=a.boxes,o=a.scores,l=r,c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h=l.softNmsSigma,f=n;ae(s,"NonMaxSuppressionWithScore");var p=Lf(f.data.get(s.dataId).values,f.data.get(o.dataId).values,c,u,d,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;ae(r,"square");for(var s=a.data.get(r.dataId).values,o=new Float32Array(s.length),l=0;l<s.length;++l){var c=s[l];o[l]=c*c}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:pi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,s=r.b,o=n;ae([a,s],pi);var l=o.data.get(a.dataId).values,c=o.data.get(s.dataId).values,u=function(f,p,m,x,y,g){var v=Le(f,p),w=v.length,b=pr(v),N=ui(y,be(v)),_=f.length,k=p.length,j=pr(f),C=pr(p),S=ea(f,v),M=ea(p,v);if(S.length+M.length===0)for(var T=0;T<N.length;++T)N[T]=g(m[T%m.length],x[T%x.length]);else{var A=function(L){var O=vj(L,w,b),U=O.slice(-_);S.forEach(function(I){return U[I]=0});var z=ig(U,_,j),F=O.slice(-k);M.forEach(function(I){return F[I]=0});var W=ig(F,k,C);N[L]=g(m[z],x[W])};for(T=0;T<N.length;++T)A(T)}return[N,v]}(a.shape,s.shape,l,c,a.dtype,function(f,p){var m=f-p;return m*m}),d=u[0],h=u[1];return{dataId:o.write(d,h,a.dtype),shape:h,dtype:a.dtype}}}];Hu<Lg.length;Hu++)W0(Lg[Hu]);var ss,l3=function(e){this.variableNames=["A"];var t=qt(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},c3=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=qt(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "};for(var Gu=0,Bg=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,s=r.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,c=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],u=c[0],d=c[1],h=[d,u],f=[d,u,s];(l||o)&&(ss==null&&(ss=document.createElement("canvas").getContext("2d")),ss.canvas.width=u,ss.canvas.height=d,ss.drawImage(a,0,0,u,d),a=ss.canvas);var p=n.makeTensorInfo(h,"int32");n.texData.get(p.dataId).usage=wn.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);var m=Z().getBool("WEBGL_PACK")?new c3(f):new l3(f),x=n.runWebGLProgram(m,[p],"int32");return n.disposeData(p.dataId),x}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;rc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t,s=a.boxes,o=a.scores,l=r,c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h=l.softNmsSigma,f=n,p=Lf(f.readSync(s.dataId),f.readSync(o.dataId),c,u,d,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n,s=new Me(r.shape,"return x * x;");return a.runWebGLProgram(s,[r],r.dtype)}},{kernelName:pi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,s=r.b,o=n,l=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new _r("return (a - b) * (a - b);",a.shape,s.shape):new ct("return (a - b) * (a - b);",a.shape,s.shape);return o.compileAndRun(l,[a,s])}}];Gu<Bg.length;Gu++)W0(Bg[Gu]);for(var Ku=0,Wg=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:pi,gradFunc:function(e,t){var n=t[0],r=t[1],a=de(2);return{a:function(){return Gt(e,Gt(a,jt(n,r)))},b:function(){return Gt(e,Gt(a,jt(r,n)))}}}}];Ku<Wg.length;Ku++)oj(Wg[Ku]);var u3=function(){function e(){}return e.prototype.fetch=function(t,n){return fetch(t,n)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return new TextDecoder(n).decode(t)},e}();Z().get("IS_BROWSER")&&Z().setPlatform("browser",new u3);var Xu,d3=function(){return require("node-fetch")},h3=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(t,n){return Z().global.fetch!=null?Z().global.fetch(t,n):(Xu==null&&(Xu=d3()),Xu(t,n))},e.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)},e}();Z().get("IS_NODE")&&Z().setPlatform("node",new h3);var xh={float32:4,int32:4,uint16:2,uint8:1,bool:1},gc=4;function cb(e,t){for(var n={},r=0,a=function(l){var c=l.name,u=l.dtype,d=l.shape,h=be(d),f=void 0;if("quantization"in l){var p=l.quantization;if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error("Weight "+l.name+" has unknown quantization dtype "+p.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var m=xh[p.dtype],x=e.slice(r,r+h*m),y=p.dtype==="uint8"?new Uint8Array(x):new Uint16Array(x);if(u==="float32")f=Float32Array.from(y,function(_){return _*p.scale+p.min});else{if(u!=="int32")throw new Error("Unsupported dtype in weight '"+c+"': "+u);f=Int32Array.from(y,function(_){return Math.round(_*p.scale+p.min)})}r+=h*m}else if(u==="string"){var g=be(l.shape);f=[];for(var v=0;v<g;v++){var w=new Uint32Array(e.slice(r,r+gc))[0];r+=gc;var b=new Uint8Array(e.slice(r,r+w));f.push(b),r+=w}}else{var N=xh[u];if(x=e.slice(r,r+h*N),u==="float32")f=new Float32Array(x);else if(u==="int32")f=new Int32Array(x);else{if(u!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+u);f=new Uint8Array(x)}r+=h*N}n[c]=Mt(f,d,u)},s=0,o=t;s<o.length;s++)a(o[s]);return n}function f3(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(s){if(t+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+s.constructor.name)});var r=new Uint8Array(t),a=0;return n.forEach(function(s){r.set(new Uint8Array(s.buffer),a),a+=s.byteLength}),r.buffer}var yh=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function $g(e){return yh?Buffer.byteLength(e):new Blob([e]).size}function rp(e){var t=0;e.forEach(function(a){t+=a.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(a){n.set(new Uint8Array(a),r),r+=a.byteLength}),n.buffer}function zg(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Ri(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:$g(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:$g(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var Nn=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var a=[];return(n==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(s){var o=s(t,r);o!==null&&a.push(o)}),a},e}(),Ms="://",fa=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(t,n){P(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(Ms)&&(t=t.slice(0,t.indexOf(Ms))),P(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();P(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(t){var n=this.getInstance().managers[t];if(n==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return n},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function jl(e){if(e.indexOf(Ms)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+fa.getSchemes().join(","));return{scheme:e.split(Ms)[0],path:e.split(Ms)[1]}}function Ug(e,t,n){return n===void 0&&(n=!1),xe(this,void 0,void 0,function(){var r,a,s,o,l,c,u,d,h;return ye(this,function(f){switch(f.label){case 0:return P(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),P((r=Nn.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),P(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),a=r[0],P((s=Nn.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),P(s.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),o=s[0],l=jl(e).scheme,c=jl(e).path,u=l===jl(e).scheme,[4,a.load()];case 1:return d=f.sent(),n&&u?[4,fa.getManager(l).removeModel(c)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,o.save(d)];case 4:return h=f.sent(),!n||u?[3,6]:[4,fa.getManager(l).removeModel(c)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var La="models_store",ta="model_info_store";function ub(){if(!Z().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function bh(e){var t=e.result;t.createObjectStore(La,{keyPath:"modelPath"}),t.createObjectStore(ta,{keyPath:"modelPath"})}var Os=function(){function e(t){if(this.indexedDB=ub(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return e.prototype.save=function(t){return xe(this,void 0,void 0,function(){return ye(this,function(n){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return xe(this,void 0,void 0,function(){return ye(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(t,n){var r=this;return new Promise(function(a,s){var o=r.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return bh(o)},o.onsuccess=function(){var l=o.result;if(n==null){var c=l.transaction(La,"readonly"),u=c.objectStore(La).get(r.modelPath);u.onsuccess=function(){if(u.result==null)return l.close(),s(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));a(u.result.modelArtifacts)},u.onerror=function(x){return l.close(),s(u.error)},c.oncomplete=function(){return l.close()}}else{var d,h=Ri(n),f=l.transaction(ta,"readwrite"),p=f.objectStore(ta),m=p.put({modelPath:r.modelPath,modelArtifactsInfo:h});m.onsuccess=function(){var x=(d=l.transaction(La,"readwrite")).objectStore(La).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:h});x.onsuccess=function(){return a({modelArtifactsInfo:h})},x.onerror=function(y){var g=(p=f.objectStore(ta)).delete(r.modelPath);g.onsuccess=function(){return l.close(),s(x.error)},g.onerror=function(v){return l.close(),s(x.error)}}},m.onerror=function(x){return l.close(),s(m.error)},f.oncomplete=function(){d==null?l.close():d.oncomplete=function(){return l.close()}}}},o.onerror=function(l){return s(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),Vg=function(e){return Z().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Os.URL_SCHEME)?(t=e.slice(Os.URL_SCHEME.length),new Os(t)):null;var t};Nn.registerSaveRouter(Vg),Nn.registerLoadRouter(Vg);var p3=function(){function e(){this.indexedDB=ub()}return e.prototype.listModels=function(){return xe(this,void 0,void 0,function(){var t=this;return ye(this,function(n){return[2,new Promise(function(r,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return bh(s)},s.onsuccess=function(){var o=s.result,l=o.transaction(ta,"readonly"),c=l.objectStore(ta).getAll();c.onsuccess=function(){for(var u={},d=0,h=c.result;d<h.length;d++){var f=h[d];u[f.modelPath]=f.modelArtifactsInfo}r(u)},c.onerror=function(u){return o.close(),a(c.error)},l.oncomplete=function(){return o.close()}},s.onerror=function(o){return a(s.error)}})]})})},e.prototype.removeModel=function(t){return xe(this,void 0,void 0,function(){var n=this;return ye(this,function(r){var a;return t=(a=t).startsWith(Os.URL_SCHEME)?a.slice(Os.URL_SCHEME.length):a,[2,new Promise(function(s,o){var l=n.indexedDB.open("tensorflowjs",1);l.onupgradeneeded=function(){return bh(l)},l.onsuccess=function(){var c,u=l.result,d=u.transaction(ta,"readwrite"),h=d.objectStore(ta),f=h.get(t);f.onsuccess=function(){if(f.result==null)return u.close(),o(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var p=h.delete(t),m=function(){var x=(c=u.transaction(La,"readwrite")).objectStore(La).delete(t);x.onsuccess=function(){return s(f.result.modelArtifactsInfo)},x.onerror=function(y){return o(f.error)}};p.onsuccess=m,p.onerror=function(x){return m(),u.close(),o(f.error)}},f.onerror=function(p){return u.close(),o(f.error)},d.oncomplete=function(){c==null?u.close():c.oncomplete=function(){return u.close()}}},l.onerror=function(c){return o(l.error)}})]})})},e}();if(Z().getBool("IS_BROWSER"))try{fa.registerManager(Os.URL_SCHEME,new p3)}catch(e){}var Cr="/",ds="tensorflowjs_models",db="info",m3="model_topology",g3="weight_specs",v3="weight_data",x3="model_metadata";function hb(e){return{info:[ds,e,db].join(Cr),topology:[ds,e,m3].join(Cr),weightSpecs:[ds,e,g3].join(Cr),weightData:[ds,e,v3].join(Cr),modelMetadata:[ds,e,x3].join(Cr)}}function y3(e){var t=e.split(Cr);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Cr)}var Ls=function(){function e(t){if(!Z().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=hb(this.modelPath)}return e.prototype.save=function(t){return xe(this,void 0,void 0,function(){var n,r,a;return ye(this,function(s){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Ri(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(o){if(yh)return Buffer.from(o).toString("base64");for(var l=new Uint8Array(o),c="",u=0,d=l.length;u<d;u++)c+=String.fromCharCode(l[u]);return btoa(c)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:a}]}catch(o){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return xe(this,void 0,void 0,function(){var t,n,r,a,s,o,l;return ye(this,function(c){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=a,(s=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(s),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,n.userDefinedMetadata=o.userDefinedMetadata),(l=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(u){if(yh){var d=Buffer.from(u,"base64");return d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}for(var h=atob(u),f=new Uint8Array(h.length),p=0;p<h.length;++p)f.set([h.charCodeAt(p)],p);return f.buffer}(l),[2,n]})})},e.URL_SCHEME="localstorage://",e}(),qg=function(e){return Z().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ls.URL_SCHEME)?(t=e.slice(Ls.URL_SCHEME.length),new Ls(t)):null;var t};Nn.registerSaveRouter(qg),Nn.registerLoadRouter(qg);var b3=function(){function e(){P(Z().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),P(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return xe(this,void 0,void 0,function(){var t,n,r,a,s,o;return ye(this,function(l){for(t={},n=ds+Cr,r=Cr+db,a=0;a<this.LS.length;++a)(s=this.LS.key(a)).startsWith(n)&&s.endsWith(r)&&(o=y3(s),t[o]=JSON.parse(this.LS.getItem(s)));return[2,t]})})},e.prototype.removeModel=function(t){return xe(this,void 0,void 0,function(){var n,r;return ye(this,function(a){var s;if(t=(s=t).startsWith(Ls.URL_SCHEME)?s.slice(Ls.URL_SCHEME.length):s,n=hb(t),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(Z().getBool("IS_BROWSER"))try{fa.registerManager(Ls.URL_SCHEME,new b3)}catch(e){}var w3="model",N3=".json",_3=".weights.bin";function Hg(e){return new Promise(function(t){return setTimeout(t)}).then(e)}var Yu=function(){function e(t){if(!Z().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),t!=null&&t.length!==0||(t=w3),this.modelTopologyFileName=t+N3,this.weightDataFileName=t+_3}return e.prototype.save=function(t){return xe(this,void 0,void 0,function(){var n,r,a,s,o,l;return ye(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},s=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=s,[4,Hg(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),t.weightData==null?[3,4]:((l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,l.href=n,[4,Hg(function(){return l.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Ri(t)}]}})})},e.URL_SCHEME="downloads://",e}(),j3=function(){function e(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return e.prototype.load=function(){return xe(this,void 0,void 0,function(){var t,n,r=this;return ye(this,function(a){return t=this.files[0],n=this.files.slice(1),[2,new Promise(function(s,o){var l=new FileReader;l.onload=function(c){var u=JSON.parse(c.target.result),d=u.modelTopology;if(d!=null){n.length===0&&s({modelTopology:d});var h=u.weightsManifest;if(h!=null){var f;try{f=r.checkManifestAndWeightFiles(h,n)}catch(y){return void o(y)}var p=[],m=[],x=[];h.forEach(function(y){y.paths.forEach(function(g){m.push(g),x.push(null)}),p.push.apply(p,y.weights)}),h.forEach(function(y){y.paths.forEach(function(g){var v=new FileReader;v.onload=function(w){var b=w.target.result,N=m.indexOf(g);x[N]=b,x.indexOf(null)===-1&&s({modelTopology:d,weightSpecs:p,weightData:rp(x),format:u.format,generatedBy:u.generatedBy,convertedBy:u.convertedBy,userDefinedMetadata:u.userDefinedMetadata})},v.onerror=function(w){return o("Failed to weights data from file of path '"+g+"'.")},v.readAsArrayBuffer(f[g])})})}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},l.onerror=function(c){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},l.readAsText(t)})]})})},e.prototype.checkManifestAndWeightFiles=function(t,n){for(var r=[],a=n.map(function(c){return zg(c.name)}),s={},o=0,l=t;o<l.length;o++)l[o].paths.forEach(function(c){var u=zg(c);if(r.indexOf(u)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+u+"'");if(r.push(u),a.indexOf(u)===-1)throw new Error("Weight file with basename '"+u+"' is not provided.");s[c]=n[a.indexOf(u)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return s},e}();function Gg(e,t,n,r){(function(s){P(s!=null&&Array.isArray(s)&&s.length>0,function(){return"promises must be a none empty array"})})(e),function(s,o){P(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+s}),P(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),P(o>=s,function(){return"startFraction must be no more than endFraction, but got startFraction "+s+" and endFraction "+o})}(n=n==null?0:n,r=r==null?1:r);var a=0;return Promise.all(e.map(function(s){return s.then(function(o){var l=n+ ++a/e.length*(r-n);return t(l),o}),s}))}function fb(e,t){return xe(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d;return ye(this,function(h){switch(h.label){case 0:return t==null&&(t={}),n=t.fetchFunc==null?Z().platform.fetch:t.fetchFunc,r=e.map(function(f){return n(f,t.requestInit,{isBinary:!0})}),a=0,s=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return o=h.sent(),[3,4];case 2:return[4,Gg(r,t.onProgress,a,s)];case 3:o=h.sent(),h.label=4;case 4:return l=o.map(function(f){return f.arrayBuffer()}),c=.5,u=1,t.onProgress!=null?[3,6]:[4,Promise.all(l)];case 5:return d=h.sent(),[3,8];case 6:return[4,Gg(l,t.onProgress,c,u)];case 7:d=h.sent(),h.label=8;case 8:return[2,d]}})})}function Kg(e){var t=this;return function(n,r,a){return r===void 0&&(r=""),xe(t,void 0,void 0,function(){var s,o,l,c,u,d,h,f,p,m;return ye(this,function(x){switch(x.label){case 0:if(s=n.map(function(){return!1}),o={},l=a!=null?a.map(function(){return!1}):[],c=[],n.forEach(function(y,g){var v=0;y.weights.forEach(function(w){var b="quantization"in w?w.quantization.dtype:w.dtype,N=xh[b]*be(w.shape),_=function(){s[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:w,groupOffset:v,sizeBytes:N})};a!=null?a.forEach(function(k,j){k===w.name&&(_(),l[j]=!0)}):_(),c.push(w.name),v+=N})}),!l.every(function(y){return y}))throw u=a.filter(function(y,g){return!l[g]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+c.join(", ")+".");return d=s.reduce(function(y,g,v){return g&&y.push(v),y},[]),h=[],d.forEach(function(y){n[y].paths.forEach(function(g){var v=r+(r.endsWith("/")?"":"/")+g;h.push(v)})}),[4,e(h)];case 1:return f=x.sent(),p={},m=0,d.forEach(function(y){for(var g=n[y].paths.length,v=0,w=0;w<g;w++)v+=f[m+w].byteLength;for(var b=new ArrayBuffer(v),N=new Uint8Array(b),_=0,k=0;k<g;k++){var j=new Uint8Array(f[m+k]);N.set(j,_),_+=j.byteLength}o[y].forEach(function(C){var S=cb(b.slice(C.groupOffset,C.groupOffset+C.sizeBytes),[C.manifestEntry]);for(var M in S)p[M]=S[M]}),m+=g}),[2,p]}})})}}Nn.registerSaveRouter(function(e){return Z().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Yu.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new Yu(t)}(e.slice(Yu.URL_SCHEME.length)):null});var pb=function(){function e(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(P(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=Z().platform.fetch,P(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&P(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return e.prototype.save=function(t){return xe(this,void 0,void 0,function(){var n,r,a,s;return ye(this,function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((s=o.sent()).ok)return[2,{modelArtifactsInfo:Ri(t),responses:[s]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+s.status+".")}})})},e.prototype.load=function(){return xe(this,void 0,void 0,function(){var t,n,r,a,s,o,l,c,u,d,h,f;return ye(this,function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,t.json()];case 3:return n=p.sent(),[3,5];case 4:throw p.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=n.modelTopology,s=n.weightsManifest,o=n.generatedBy,l=n.convertedBy,c=n.format,u=n.userDefinedMetadata,a==null&&s==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return s==null?[3,7]:[4,this.loadWeights(s)];case 6:f=p.sent(),d=f[0],h=f[1],p.label=7;case 7:return[2,{modelTopology:a,weightSpecs:d,weightData:h,userDefinedMetadata:u,generatedBy:o,convertedBy:l,format:c}]}})})},e.prototype.loadWeights=function(t){return xe(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d,h,f;return ye(this,function(p){switch(p.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(m){var x=m.lastIndexOf("/"),y=m.lastIndexOf("?"),g=m.substring(0,x),v=y>x?m.substring(y):"";return[g+"/",v]}(n),a=r[0],s=r[1],o=this.weightPathPrefix||a,l=[],c=0,u=t;c<u.length;c++)d=u[c],l.push.apply(l,d.weights);return h=[],t.forEach(function(m){m.paths.forEach(function(x){h.push(o+x+s)})}),[4,fb(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=p.sent(),[2,[l,rp(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function wh(e){return e.match(pb.URL_SCHEME_REGEX)!=null}var Xg=function(e,t){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(n){return wh(n)}):wh(e))?Nh(e,{onProgress:t}):null};function Nh(e,t){return new pb(e,t)}Nn.registerSaveRouter(Xg),Nn.registerLoadRouter(Xg);var Qu=function(){function e(t){this.modelArtifacts=t}return e.prototype.load=function(){return xe(this,void 0,void 0,function(){return ye(this,function(t){return[2,this.modelArtifacts]})})},e}(),k3=function(){function e(t){this.saveHandler=t}return e.prototype.save=function(t){return xe(this,void 0,void 0,function(){return ye(this,function(n){return[2,this.saveHandler(t)]})})},e}(),mb=Object.freeze({browserFiles:function(e){return new j3(e)},browserHTTPRequest:function(e,t){return Nh(e,t)},concatenateArrayBuffers:rp,decodeWeights:cb,encodeWeights:function(e,t){return xe(this,void 0,void 0,function(){var n,r,a,s,o,l=this;return ye(this,function(c){switch(c.label){case 0:for(n=[],r=[],a=Array.isArray(e)?e.map(function(u){return u.name}):Object.keys(e),s=function(u){var d=a[u],h=Array.isArray(e)?e[u].tensor:e[d];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+d+"': "+h.dtype);var f={name:d,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var p=new Promise(function(m){return xe(l,void 0,void 0,function(){var x,y,g,v,w,b,N;return ye(this,function(_){switch(_.label){case 0:return[4,h.bytes()];case 1:for(x=_.sent(),y=x.reduce(function(k,j){return k+j.length},0)+gc*x.length,g=new Uint8Array(y),v=0,w=0;w<x.length;w++)b=x[w],N=new Uint8Array(new Uint32Array([b.length]).buffer),g.set(N,v),v+=gc,g.set(b,v),v+=b.length;return m(g),[2]}})})});r.push(p)}else r.push(h.data());t!=null&&(f.group=t),n.push(f)},o=0;o<a.length;++o)s(o);return[4,Promise.all(r)];case 1:return[2,{data:f3(c.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new Qu(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Qu({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Qu({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return Nn.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:Ri,getSaveHandlers:function(e){return Nn.getSaveHandlers(e)},http:Nh,isHTTPScheme:wh,loadWeights:function(e,t,n,r){return t===void 0&&(t=""),xe(this,void 0,void 0,function(){return ye(this,function(a){return[2,Kg(function(s){return fb(s,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return Nn.registerLoadRouter(e)},registerSaveRouter:function(e){return Nn.registerSaveRouter(e)},weightsLoaderFactory:Kg,withSaveHandler:function(e){return new k3(e)},copyModel:function(e,t){return xe(this,void 0,void 0,function(){return ye(this,function(n){return[2,Ug(e,t,!1)]})})},listModels:function(){return xe(this,void 0,void 0,function(){var e,t,n,r,a,s,o;return ye(this,function(l){switch(l.label){case 0:e=fa.getSchemes(),t={},n=0,r=e,l.label=1;case 1:return n<r.length?(a=r[n],[4,fa.getManager(a).listModels()]):[3,4];case 2:for(o in s=l.sent())t[a+Ms+o]=s[o];l.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return xe(this,void 0,void 0,function(){return ye(this,function(n){return[2,Ug(e,t,!0)]})})},removeModel:function(e){return xe(this,void 0,void 0,function(){var t;return ye(this,function(n){return t=jl(e),[2,fa.getManager(t.scheme).removeModel(t.path)]})})}}),os;B({confusionMatrix_:function(e,t,n){var r=D(e,"labels","confusionMatrix"),a=D(t,"predictions","confusionMatrix");P(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),P(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),P(a.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+a.rank}),P(r.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."}),P(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var s=fh(r.asType("int32"),n),o=fh(a.asType("int32"),n);return s.transpose().matMul(o).asType("int32")}});var C3=B({fromPixels_:function(e,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,s=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(a&&a&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(B0("FromPixels",V.backendName)!=null)return V.runKernel("FromPixels",{pixels:e},{numChannels:t});var l,c,u=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],d=u[0],h=u[1];if(o?l=e.getContext("2d").getImageData(0,0,d,h).data:r||n?l=e.data:(s||a)&&(os==null&&(os=document.createElement("canvas").getContext("2d")),os.canvas.width=d,os.canvas.height=h,os.drawImage(e,0,0,d,h),l=os.getImageData(0,0,d,h).data),t===4)c=new Int32Array(l);else{var f=d*h;c=new Int32Array(f*t);for(var p=0;p<f;p++)for(var m=0;m<t;++m)c[p*t+m]=l[4*p+m]}return Af(c,[h,d,t],"int32")}}),ap=Object.freeze({toPixels:function(e,t){return xe(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,k,j;return ye(this,function(C){switch(C.label){case 0:if(n=D(e,"img","toPixels"),e instanceof at||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),a=r[0],s=r[1],(o=n.rank===2?1:n.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return l=C.sent(),c=n.min(),u=n.max(),[4,Promise.all([c.data(),u.data()])];case 2:if(d=C.sent(),h=d[0],f=d[1],p=h[0],m=f[0],c.dispose(),u.dispose(),n.dtype==="float32"){if(p<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+m+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+m+"].")}for(x=n.dtype==="float32"?255:1,y=new Uint8ClampedArray(s*a*4),g=0;g<a*s;++g)v=void 0,w=void 0,b=void 0,N=void 0,o===1?(v=l[g]*x,w=l[g]*x,b=l[g]*x,N=255):o===3?(v=l[3*g]*x,w=l[3*g+1]*x,b=l[3*g+2]*x,N=255):o===4&&(v=l[4*g]*x,w=l[4*g+1]*x,b=l[4*g+2]*x,N=l[4*g+3]*x),y[(_=4*g)+0]=Math.round(v),y[_+1]=Math.round(w),y[_+2]=Math.round(b),y[_+3]=Math.round(N);return t!=null&&(t.width=s,t.height=a,k=t.getContext("2d"),j=new ImageData(y,s,a),k.putImageData(j,0,0)),n!==e&&n.dispose(),[2,y]}})})},fromPixels:C3}),S3=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(t,n){return new t(n)},e}(),E3=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function ts(e){P(e.className!=null,function(){return"Class being registered does not have the static className property defined."}),P(typeof e.className=="string",function(){return"className is required to be a string, but got type "+typeof e.className}),P(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),E3.register(e)}var ns=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return er(t,e),t.prototype.minimize=function(n,r,a){r===void 0&&(r=!1);var s=this.computeGradients(n,a),o=s.value,l=s.grads;if(a!=null){var c=a.map(function(u){return{name:u.name,tensor:l[u.name]}});this.applyGradients(c)}else this.applyGradients(l);return hn(l),r?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(n,r){return Lk(n,r)},t.prototype.dispose=function(){this.iterations_!=null&&hn(this.iterations_)},t.prototype.saveIterations=function(){return xe(this,void 0,void 0,function(){return ye(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:de(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return xe(this,void 0,void 0,function(){return ye(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(n){return xe(this,void 0,void 0,function(){return ye(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(n){return xe(this,void 0,void 0,function(){var r;return ye(this,function(a){switch(a.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,n.slice(1)]}})})},t}(S3);Object.defineProperty(ns,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var R3=function(e){function t(n,r,a){a===void 0&&(a=null);var s=e.call(this)||this;return s.learningRate=n,s.rho=r,s.epsilon=a,s.accumulatedGrads=[],s.accumulatedUpdates=[],a==null&&(s.epsilon=V.backend.epsilon()),s}return er(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=V.registeredVariables[a];r.accumulatedGrads[s]==null&&(r.accumulatedGrads[s]={originalName:a+"/accum_grad",variable:pe(function(){return ze(o).variable(!1)})}),r.accumulatedUpdates[s]==null&&(r.accumulatedUpdates[s]={originalName:a+"/accum_var",variable:pe(function(){return ze(o).variable(!1)})});var l=Array.isArray(n)?n[s].tensor:n[a];if(l!=null){var c=r.accumulatedGrads[s].variable,u=r.accumulatedUpdates[s].variable;pe(function(){var d=c.mul(r.rho).add(l.square().mul(1-r.rho)),h=u.add(r.epsilon).sqrt().div(c.add(r.epsilon).sqrt()).mul(l),f=u.mul(r.rho).add(h.square().mul(1-r.rho));c.assign(d),u.assign(f);var p=h.mul(-r.learningRate).add(o);o.assign(p)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(hn(this.accumulatedGrads.map(function(n){return n.variable})),hn(this.accumulatedUpdates.map(function(n){return n.variable})))},t.prototype.getWeights=function(){return xe(this,void 0,void 0,function(){var n;return ye(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(n){return xe(this,void 0,void 0,function(){var r;return ye(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(n)];case 1:return n=a.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(ns);ts(R3);var D3=function(e){function t(n,r){r===void 0&&(r=.1);var a=e.call(this)||this;return a.learningRate=n,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return er(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=V.registeredVariables[a];r.accumulatedGrads[s]==null&&(r.accumulatedGrads[s]={originalName:a+"/accumulator",variable:pe(function(){return mr(o.shape,r.initialAccumulatorValue).variable(!1)})});var l=Array.isArray(n)?n[s].tensor:n[a];if(l!=null){var c=r.accumulatedGrads[s].variable;pe(function(){var u=c.add(l.square());c.assign(u);var d=l.div(u.add(V.backend.epsilon()).sqrt()).mul(-r.learningRate).add(o);o.assign(d)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&hn(this.accumulatedGrads.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return xe(this,void 0,void 0,function(){return ye(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return xe(this,void 0,void 0,function(){return ye(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(ns);ts(D3);var I3=function(e){function t(n,r,a,s){s===void 0&&(s=null);var o=e.call(this)||this;return o.learningRate=n,o.beta1=r,o.beta2=a,o.epsilon=s,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],pe(function(){o.accBeta1=de(r).variable(),o.accBeta2=de(a).variable()}),s==null&&(o.epsilon=V.backend.epsilon()),o}return er(t,e),t.prototype.applyGradients=function(n){var r=this,a=Array.isArray(n)?n.map(function(s){return s.name}):Object.keys(n);pe(function(){var s=jt(1,r.accBeta1),o=jt(1,r.accBeta2);a.forEach(function(l,c){var u=V.registeredVariables[l];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:l+"/m",variable:pe(function(){return ze(u).variable(!1)})}),r.accumulatedSecondMoment[c]==null&&(r.accumulatedSecondMoment[c]={originalName:l+"/v",variable:pe(function(){return ze(u).variable(!1)})});var d=Array.isArray(n)?n[c].tensor:n[l];if(d!=null){var h=r.accumulatedFirstMoment[c].variable,f=r.accumulatedSecondMoment[c].variable,p=h.mul(r.beta1).add(d.mul(1-r.beta1)),m=f.mul(r.beta2).add(d.square().mul(1-r.beta2)),x=p.div(s),y=m.div(o);h.assign(p),f.assign(m);var g=x.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(u);u.assign(g)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&hn(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&hn(this.accumulatedSecondMoment.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return xe(this,void 0,void 0,function(){var n;return ye(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(n){return xe(this,void 0,void 0,function(){var r,a=this;return ye(this,function(s){switch(s.label){case 0:return[4,this.extractIterations(n)];case 1:return n=s.sent(),pe(function(){a.accBeta1.assign(pc(a.beta1,a.iterations_+1)),a.accBeta2.assign(pc(a.beta2,a.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(ns);ts(I3);var A3=function(e){function t(n,r,a,s,o){s===void 0&&(s=null),o===void 0&&(o=0);var l=e.call(this)||this;return l.learningRate=n,l.beta1=r,l.beta2=a,l.epsilon=s,l.decay=o,l.accumulatedFirstMoment=[],l.accumulatedWeightedInfNorm=[],pe(function(){l.iteration=de(0).variable(),l.accBeta1=de(r).variable()}),s==null&&(l.epsilon=V.backend.epsilon()),l}return er(t,e),t.prototype.applyGradients=function(n){var r=this,a=Array.isArray(n)?n.map(function(s){return s.name}):Object.keys(n);pe(function(){var s=jt(1,r.accBeta1),o=Hn(-r.learningRate,r.iteration.mul(r.decay).add(1));a.forEach(function(l,c){var u=V.registeredVariables[l];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:l+"/m",variable:ze(u).variable(!1)}),r.accumulatedWeightedInfNorm[c]==null&&(r.accumulatedWeightedInfNorm[c]={originalName:l+"/v",variable:ze(u).variable(!1)});var d=Array.isArray(n)?n[c].tensor:n[l];if(d!=null){var h=r.accumulatedFirstMoment[c].variable,f=r.accumulatedWeightedInfNorm[c].variable,p=h.mul(r.beta1).add(d.mul(1-r.beta1)),m=f.mul(r.beta2),x=d.abs(),y=m.maximum(x);h.assign(p),f.assign(y);var g=o.div(s).mul(p.div(y.add(r.epsilon))).add(u);u.assign(g)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&hn(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&hn(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return xe(this,void 0,void 0,function(){return ye(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(n){return xe(this,void 0,void 0,function(){return ye(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(ns);ts(A3);var gb=function(e){function t(n){var r=e.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return er(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=Array.isArray(n)?n[s].tensor:n[a];if(o!=null){var l=V.registeredVariables[a];pe(function(){var c=r.c.mul(o).add(l);l.assign(c)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=Jj(de(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return xe(this,void 0,void 0,function(){return ye(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},t.prototype.setWeights=function(n){return xe(this,void 0,void 0,function(){return ye(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,r){return new n(r.learningRate)},t.className="SGD",t}(ns);ts(gb);var T3=function(e){function t(n,r,a){a===void 0&&(a=!1);var s=e.call(this,n)||this;return s.learningRate=n,s.momentum=r,s.useNesterov=a,s.accumulations=[],s.m=de(s.momentum),s}return er(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=V.registeredVariables[a];r.accumulations[s]==null&&(r.accumulations[s]={originalName:a+"/momentum",variable:pe(function(){return ze(o).variable(!1)})});var l=r.accumulations[s].variable,c=Array.isArray(n)?n[s].tensor:n[a];c!=null&&pe(function(){var u,d=r.m.mul(l).add(c);u=r.useNesterov?r.c.mul(c.add(d.mul(r.m))).add(o):r.c.mul(d).add(o),l.assign(d),o.assign(u)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&hn(this.accumulations.map(function(n){return n.variable}))},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getWeights=function(){return xe(this,void 0,void 0,function(){return ye(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return xe(this,void 0,void 0,function(){return ye(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(gb);ts(T3);var P3=function(e){function t(n,r,a,s,o){r===void 0&&(r=.9),a===void 0&&(a=0),s===void 0&&(s=null),o===void 0&&(o=!1);var l=e.call(this)||this;if(l.learningRate=n,l.decay=r,l.momentum=a,l.epsilon=s,l.accumulatedMeanSquares=[],l.accumulatedMoments=[],l.accumulatedMeanGrads=[],l.centered=o,s==null&&(l.epsilon=V.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return l}return er(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=V.registeredVariables[a];r.accumulatedMeanSquares[s]==null&&(r.accumulatedMeanSquares[s]={originalName:a+"/rms",variable:pe(function(){return ze(o).variable(!1)})}),r.accumulatedMoments[s]==null&&(r.accumulatedMoments[s]={originalName:a+"/momentum",variable:pe(function(){return ze(o).variable(!1)})}),r.accumulatedMeanGrads[s]==null&&r.centered&&(r.accumulatedMeanGrads[s]={originalName:a+"/mg",variable:pe(function(){return ze(o).variable(!1)})});var l=Array.isArray(n)?n[s].tensor:n[a];if(l!=null){var c=r.accumulatedMeanSquares[s].variable,u=r.accumulatedMoments[s].variable;pe(function(){var d=c.mul(r.decay).add(l.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[s].variable,f=h.mul(r.decay).add(l.mul(1-r.decay)),p=u.mul(r.momentum).add(l.mul(r.learningRate).div(d.sub(f.square().add(r.epsilon)).sqrt()));c.assign(d),h.assign(f),u.assign(p);var m=o.sub(p);o.assign(m)}else{var x=c.mul(r.decay).add(l.square().mul(1-r.decay));p=u.mul(r.momentum).add(l.mul(r.learningRate).div(x.add(r.epsilon).sqrt())),c.assign(x),u.assign(p),m=o.sub(p),o.assign(m)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&hn(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&hn(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&hn(this.accumulatedMoments.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return xe(this,void 0,void 0,function(){var n;return ye(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(n){return xe(this,void 0,void 0,function(){var r;return ye(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(n)];case 1:return n=a.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(ns);ts(P3);at.prototype.squaredDifference=function(e){return Iy(this,e)},Q=o3;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var _h=function(e,t){return _h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)r.hasOwnProperty(a)&&(n[a]=r[a])},_h(e,t)};function Ae(e,t){_h(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Vt=function(){return Vt=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Vt.apply(this,arguments)};function Ne(e,t,n,r){function a(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?s(d.value):a(d.value).then(l,c)}u((r=r.apply(e,t||[])).next())})}function _e(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,a,s,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(d){return c([u,d])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,a&&(s=u[0]&2?a.return:u[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,u[1])).done)return s;switch(a=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,a=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=t.call(e,n)}catch(d){u=[6,d],a=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Lo(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),a=0,t=0;t<n;t++)for(var s=arguments[t],o=0,l=s.length;o<l;o++,a++)r[a]=s[o];return r}var Bs=function(){function e(t,n){if(!$a(t)||!$a(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:n}));this._width=t,this._height=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Gc(e,t){return e instanceof at&&e.shape.length===t}function F3(e){return Gc(e,2)}function Kc(e){return Gc(e,3)}function pa(e){return Gc(e,4)}function M3(e){return e%1!==0}function Yg(e){return e%2===0}function O3(e,t){t===void 0&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function Qg(e){return e&&e.width&&e.height}function L3(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new Bs(Math.round(n*a),Math.round(r*a))}function sp(e){return e.reduce(function(t,n){return t.add(n)},new Ve(0,0)).div(new Ve(e.length,e.length))}function mi(e,t,n){return Array(e).fill(0).map(function(r,a){return t+a*n})}function $a(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function Jg(e){return $a(e)&&0<=e&&e<=1}var Ve=function(){function e(t,n){this._x=t,this._y=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),xa=function(){function e(t,n){n===void 0&&(n=!0);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every($a),s=[r.x,r.y,r.width,r.height].every($a);if(!s&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=s?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],l=o[0],c=o[1],u=o[2],d=o[3];e.assertIsValidBox({x:l,y:c,width:u,height:d},"Box.constructor",n),this._x=l,this._y=c,this._width=u,this._height=d}return e.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every($a)},e.assertIsValidBox=function(t,n,r){if(r===void 0&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Ve(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Ve(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Ve(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Ve(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),n=t[0],r=t[1],a=t[2],s=t[3];return new e({x:n,y:r,width:a,height:s})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),n=t[0],r=t[1],a=t[2],s=t[3];return new e({x:n,y:r,width:a,height:s})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,a=t.width,s=t.height,o=Math.abs(a-s);return a<s&&(n-=o/2,a+=o),s<a&&(r-=o/2,s+=o),new e({x:n,y:r,width:a,height:s})},e.prototype.rescale=function(t){var n=Qg(t)?t.width:t,r=Qg(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n],a=r[0],s=r[1],o=r[2],l=r[3];return new e({x:a,y:s,width:o,height:l})},e.prototype.clipAtImageBorders=function(t,n){var r=this,a=r.x,s=r.y,o=r.right,l=r.bottom,c=Math.max(a,0),u=Math.max(s,0),d=o-c,h=l-u,f=Math.min(d,t-c),p=Math.min(h,n-u);return new e({x:c,y:u,width:f,height:p}).floor()},e.prototype.shift=function(t,n){var r=this,a=r.width,s=r.height,o=this.x+t,l=this.y+n;return new e({x:o,y:l,width:a,height:s})},e.prototype.padAtBorders=function(t,n){var r=this.width+1,a=this.height+1,s=1,o=1,l=r,c=a,u=this.left,d=this.top,h=this.right,f=this.bottom;return h>n&&(l=-h+n+r,h=n),f>t&&(c=-f+t+a,f=t),u<1&&(c=2-u,u=1),d<1&&(c=2-d,d=1),{dy:o,edy:c,dx:s,edx:l,y:d,ey:f,x:u,ex:h,w:r,h:a}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),Xc=function(e){Ae(t,e);function t(n,r,a,s,o){return o===void 0&&(o=!1),e.call(this,{left:n,top:r,right:a,bottom:s},o)||this}return t}(xa),vb=function(){function e(t,n,r,a,s){this._imageDims=new Bs(s.width,s.height),this._score=t,this._classScore=n,this._className=r,this._box=new xa(a).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new xa(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),br=function(e){Ae(t,e);function t(n,r,a){return e.call(this,n,n,"",r,a)||this}return t.prototype.forSize=function(n,r){var a=e.prototype.forSize.call(this,n,r),s=a.score,o=a.relativeBox,l=a.imageDims;return new t(s,o,l)},t}(vb);function B3(e,t,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),s=r*a;return n?s/(e.area+t.area-s):s/Math.min(e.area,t.area)}function W3(e){var t=e.map(function(l){return l.x}),n=e.map(function(l){return l.y}),r=t.reduce(function(l,c){return c<l?c:l},1/0),a=n.reduce(function(l,c){return c<l?c:l},1/0),s=t.reduce(function(l,c){return l<c?c:l},0),o=n.reduce(function(l,c){return l<c?c:l},0);return new Xc(r,a,s,o)}function gi(e,t,n,r){r===void 0&&(r=!0);for(var a=t.map(function(l,c){return{score:l,boxIndex:c}}).sort(function(l,c){return l.score-c.score}).map(function(l){return l.boxIndex}),s=[],o=function(){var l=a.pop();s.push(l);for(var c=a,u=[],d=0;d<c.length;d++){var h=c[d],f=e[l],p=e[h];u.push(B3(f,p,r))}a=a.filter(function(m,x){return u[x]<=n})};a.length>0;)o();return s}function Di(e,t){return pe(function(){var n=t[0],r=t[1],a=t[2],s=mr(Lo(e.shape.slice(0,3),[1]),n),o=mr(Lo(e.shape.slice(0,3),[1]),r),l=mr(Lo(e.shape.slice(0,3),[1]),a),c=wt([s,o,l],3);return jt(e,c)})}function $3(e,t){return t===void 0&&(t=!1),pe(function(){var n=e.shape.slice(1),r=n[0],a=n[1];if(r===a)return e;var s=Math.abs(r-a),o=Math.round(s*(t?.5:1)),l=r>a?2:1,c=function(p){var m=e.shape.slice();return m[l]=p,mr(m,0)},u=c(o),d=s-u.shape[l],h=t&&d?c(d):null,f=[h,e,u].filter(function(p){return!!p}).map(function(p){return p.toFloat()});return wt(f,l)})}function Ju(e){return 1/(1+Math.exp(-e))}var op=function(e){Ae(t,e);function t(n,r,a,s,o){return o===void 0&&(o=!1),e.call(this,{x:n,y:r,width:a,height:s},o)||this}return t}(xa),z3=.5,U3=.43,V3=.45,vc=function(){function e(t,n,r){r===void 0&&(r=new Ve(0,0));var a=n.width,s=n.height;this._imgDims=new Bs(a,s),this._shift=r,this._positions=t.map(function(o){return o.mul(new Ve(a,s)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Ve(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(n){return n.sub(t._shift).div(new Ve(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new this.constructor(this.relativePositions,{width:t,height:n})},e.prototype.shiftBy=function(t,n){return new this.constructor(this.relativePositions,this._imgDims,new Ve(t,n))},e.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},e.prototype.align=function(t,n){if(n===void 0&&(n={}),t){var r=t instanceof br?t.box.floor():new xa(t);return this.shiftBy(r.x,r.y).align(null,n)}var a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),s=a.useDlibAlignment,o=a.minBoxPadding;return s?this.alignDlib():this.alignMinBbox(o)},e.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),n=t[0],r=t[1],a=t[2],s=function(h){return a.sub(h).magnitude()},o=(s(n)+s(r))/2,l=Math.floor(o/V3),c=sp(t),u=Math.floor(Math.max(0,c.x-z3*l)),d=Math.floor(Math.max(0,c.y-U3*l));return new op(u,d,Math.min(l,this.imageWidth+u),Math.min(l,this.imageHeight+d))},e.prototype.alignMinBbox=function(t){var n=W3(this.positions);return n.pad(n.width*t,n.height*t)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),q3=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],sp([n[3],n[4]])]},t}(vc),H3=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(sp)},t}(vc),Zg=function(){function e(t,n){this._label=t,this._distance=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+O3(this.distance)+")":"")},e}(),ev=function(e){Ae(t,e);function t(n,r){var a=e.call(this,n)||this;return a._label=r,a}return t.assertIsValidLabeledBox=function(n,r){if(xa.assertIsValidBox(n,r),!$a(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(xa),al=function(){function e(t,n){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(r){return new Float32Array(r)});return new e(t.label,n)},e}();(function(e){Ae(t,e);function t(n,r,a,s){var o=e.call(this,n,r)||this;return o._score=a,o._classScore=s,o}return t.assertIsValidPredictedBox=function(n,r){if(ev.assertIsValidLabeledBox(n,r),!Jg(n.score)||!Jg(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(ev);function G3(e){return e.detection instanceof br}function ip(e,t){var n={detection:t};return Object.assign({},e,n)}function xb(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:t}}function yb(e){var t="";if(!e)try{e=require("fs")}catch(r){t=r.toString()}var n=e?function(r){return new Promise(function(a,s){e.readFile(r,function(o,l){return o?s(o):a(l)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:n}}function bb(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},s=yb();return Vt({Canvas:e||function(){function o(){}return o}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function o(){}return o}(),Image:t||function(){function o(){}return o}(),ImageData:global.ImageData||function(){function o(){}return o}(),Video:global.HTMLVideoElement||function(){function o(){}return o}(),createCanvasElement:n,createImageElement:r,fetch:a},s)}function wb(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Nb(){return typeof global=="object"&&typeof require=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var xt;function K3(){if(!xt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return xt}function jh(e){xt=e}function lp(){wb()&&jh(xb()),Nb()&&jh(bb())}function X3(e){if(xt||lp(),!xt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=t===void 0?xt.Canvas:t,r=e.Image,a=r===void 0?xt.Image:r;xt.Canvas=n,xt.Image=a,xt.createCanvasElement=e.createCanvasElement||function(){return new n},xt.createImageElement=e.createImageElement||function(){return new a},xt.ImageData=e.ImageData||xt.ImageData,xt.Video=e.Video||xt.Video,xt.fetch=e.fetch||xt.fetch,xt.readFile=e.readFile||xt.readFile}var Xt={getEnv:K3,setEnv:jh,initialize:lp,createBrowserEnv:xb,createFileSystem:yb,createNodejsEnv:bb,monkeyPatch:X3,isBrowser:wb,isNodejs:Nb};lp();function _b(e){return!Xt.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function Xa(e){var t=Xt.getEnv(),n=t.Canvas,r=t.CanvasRenderingContext2D;if(e instanceof r)return e;var a=_b(e);if(!(a instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var s=a.getContext("2d");if(!s)throw new Error("resolveContext2d - canvas 2d context is null");return s}var tv;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(tv||(tv={}));function jb(e){var t=Xt.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function Y3(e){return new Promise(function(t,n){if(e instanceof Xt.getEnv().Canvas||jb(e))return t();function r(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",r),s.currentTarget.removeEventListener("error",a),t(s))}function a(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",r),s.currentTarget.removeEventListener("error",a),n(s))}e.addEventListener("load",r),e.addEventListener("error",a)})}function kb(e){var t=Xt.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new Bs(e.naturalWidth,e.naturalHeight):e instanceof r?new Bs(e.videoWidth,e.videoHeight):new Bs(e.width,e.height)}function Yc(e){var t=e.width,n=e.height,r=Xt.getEnv().createCanvasElement,a=r();return a.width=t,a.height=n,a}function cp(e,t){var n=Xt.getEnv().ImageData;if(!(e instanceof n)&&!jb(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||kb(e),a=r.width,s=r.height,o=Yc({width:a,height:s});return e instanceof n?Xa(o).putImageData(e,0,0):Xa(o).drawImage(e,0,0,a,s),o}function Q3(e,t){return Ne(this,void 0,void 0,function(){var n,r,a,s,o,l;return _e(this,function(c){switch(c.label){case 0:return n=t||Xt.getEnv().createCanvasElement(),r=e.shape.slice(pa(e)?1:0),a=r[0],s=r[1],o=r[2],l=pe(function(){return e.as3D(a,s,o).toInt()}),[4,ap.toPixels(l,n)];case 1:return c.sent(),l.dispose(),[2,n]}})})}function nv(e){var t=Xt.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}function J3(e,t,n){n===void 0&&(n=!1);var r=Xt.getEnv(),a=r.Image,s=r.Canvas;if(!(e instanceof a||e instanceof s))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=kb(e),l=t/Math.max(o.height,o.width),c=l*o.width,u=l*o.height,d=Yc({width:t,height:t}),h=e instanceof s?e:cp(e),f=Math.abs(c-u)/2,p=n&&c<u?f:0,m=n&&u<c?f:0;return Xa(d).drawImage(h,p,m,c,u),d}var xc=function(){function e(t,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=n,this._batchSize=t.length,t.forEach(function(a,s){if(Kc(a)){r._imageTensors[s]=a,r._inputDimensions[s]=a.shape;return}if(pa(a)){var o=a.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");r._imageTensors[s]=a,r._inputDimensions[s]=a.shape.slice(1);return}var l=a instanceof Xt.getEnv().Canvas?a:cp(a);r._canvases[s]=l,r._inputDimensions[s]=[l.height,l.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var t=this;return mi(this.batchSize,0,1).map(function(n,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},e.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},e.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},e.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},e.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(t),r=this.getInputHeight(t);return L3({width:n,height:r},this.inputSize)},e.prototype.toBatchTensor=function(t,n){var r=this;return n===void 0&&(n=!0),this._inputSize=t,pe(function(){var a=mi(r.batchSize,0,1).map(function(o){var l=r.getInput(o);if(l instanceof at){var c=pa(l)?l:l.expandDims();return c=$3(c,n),(c.shape[1]!==t||c.shape[2]!==t)&&(c=Jf.resizeBilinear(c,[t,t])),c.as3D(t,t,3)}if(l instanceof Xt.getEnv().Canvas)return ap.fromPixels(J3(l,t,n));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+l)}),s=Cn(a.map(function(o){return o.toFloat()})).as4D(r.batchSize,t,t,3);return s})},e}();function At(e){return Ne(this,void 0,void 0,function(){var t,n,r;return _e(this,function(a){switch(a.label){case 0:if(e instanceof xc)return[2,e];if(t=Array.isArray(e)?e:[e],!t.length)throw new Error("toNetInput - empty array passed as input");return n=function(s){return Array.isArray(e)?" at input index "+s+":":""},r=t.map(_b),r.forEach(function(s,o){if(!nv(s)&&!Kc(s)&&!pa(s))throw typeof t[o]=="string"?new Error("toNetInput -"+n(o)+" string passed, but could not resolve HTMLElement for element id "+t[o]):new Error("toNetInput -"+n(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(pa(s)){var l=s.shape[0];if(l!==1)throw new Error("toNetInput -"+n(o)+" tf.Tensor4D with batchSize "+l+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(s){return nv(s)&&Y3(s)}))];case 1:return a.sent(),[2,new xc(r,Array.isArray(e))]}})})}function up(e,t){return Ne(this,void 0,void 0,function(){var n,r,a,s,o,l,c;return _e(this,function(u){switch(u.label){case 0:return n=Xt.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,At(e)];case 1:if(a=u.sent(),a.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return s=a.getInput(0),s instanceof n?(o=s,[3,4]):[3,2];case 2:return[4,Q3(s)];case 3:o=u.sent(),u.label=4;case 4:r=o,u.label=5;case 5:return l=Xa(r),c=t.map(function(d){return d instanceof br?d.forSize(r.width,r.height).box.floor():d}).map(function(d){return d.clipAtImageBorders(r.width,r.height)}),[2,c.map(function(d){var h=d.x,f=d.y,p=d.width,m=d.height,x=Yc({width:p,height:m});return Xa(x).putImageData(l.getImageData(h,f,p,m),0,0),x})]}})})}function dp(e,t){return Ne(this,void 0,void 0,function(){return _e(this,function(n){if(!Kc(e)&&!pa(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(pa(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,pe(function(){var r=e.shape.slice(pa(e)?1:0),a=r[0],s=r[1],o=r[2],l=t.map(function(u){return u instanceof br?u.forSize(s,a).box:u}).map(function(u){return u.clipAtImageBorders(s,a)}),c=l.map(function(u){var d=u.x,h=u.y,f=u.width,p=u.height;return Jy(e.as3D(a,s,o),[h,d,0],[p,f,o])});return c})]})})}function Z3(e,t){return Ne(this,void 0,void 0,function(){var n,r;return _e(this,function(a){switch(a.label){case 0:return n=Xt.getEnv().fetch,[4,n(e,t)];case 1:if(r=a.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function eR(e){return Ne(this,void 0,void 0,function(){return _e(this,function(t){switch(t.label){case 0:return[4,Z3(e)];case 1:return[2,t.sent().json()]}})})}function Cb(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var a=e.split("/").filter(function(l){return l}),s=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return o=e.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+s:o+"/"+s}}function tR(e,t){return Ne(this,void 0,void 0,function(){var n,r,a,s;return _e(this,function(o){switch(o.label){case 0:return n=Cb(e,t),r=n.manifestUri,a=n.modelBaseUri,[4,eR(r)];case 1:return s=o.sent(),[2,mb.loadWeights(s,a)]}})})}var Wr=function(){function e(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(t){var n=this.traversePropertyPath(t),r=n.obj,a=n.objProp;return r[a]},e.prototype.reassignParamFromPath=function(t,n){var r=this.traversePropertyPath(t),a=r.obj,s=r.objProp;a[s].dispose(),a[s]=n},e.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Ys})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Ys)})},e.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(n){var r=n.path,a=n.tensor;t.reassignParamFromPath(r,a.variable())})},e.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(n){var r=n.path,a=n.tensor,s=Mt(a.dataSync());a.dispose(),t.reassignParamFromPath(r,s)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(n){if(t&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var n=t.tensor;return Array.from(n.dataSync())}).reduce(function(t,n){return t.concat(n)}))},e.prototype.load=function(t){return Ne(this,void 0,void 0,function(){return _e(this,function(n){switch(n.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return n.sent(),[2]}})})},e.prototype.loadFromUri=function(t){return Ne(this,void 0,void 0,function(){var n;return _e(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,tR(t,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},e.prototype.loadFromDisk=function(t){return Ne(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d,h;return _e(this,function(f){switch(f.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=Xt.getEnv().readFile,r=Cb(t,this.getDefaultModelName()),a=r.manifestUri,s=r.modelBaseUri,o=function(p){return Promise.all(p.map(function(m){return n(m).then(function(x){return x.buffer})}))},l=mb.weightsLoaderFactory(o),d=(u=JSON).parse,[4,n(a)];case 1:return c=d.apply(u,[f.sent().toString()]),[4,l(c,s)];case 2:return h=f.sent(),this.loadFromWeightMap(h),[2]}})})},e.prototype.loadFromWeightMap=function(t){var n=this.extractParamsFromWeigthMap(t),r=n.paramMappings,a=n.params;this._paramMappings=r,this._params=a},e.prototype.extractWeights=function(t){var n=this.extractParams(t),r=n.paramMappings,a=n.params;this._paramMappings=r,this._params=a},e.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=t.split("/").reduce(function(s,o){if(!s.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+t);return{obj:s.nextObj,objProp:o,nextObj:s.nextObj[o]}},{nextObj:this.params}),r=n.obj,a=n.objProp;if(!r||!a||!(r[a]instanceof at))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:a}},e}();function _n(e,t,n){return pe(function(){var r=Gf(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Oe(r,t.bias),r})}function Zu(e,t,n){return n===void 0&&(n=!1),pe(function(){var r=st(n?Oe(Wn(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):_n(e,t.conv0,[2,2])),a=_n(r,t.conv1,[1,1]),s=st(Oe(r,a)),o=_n(s,t.conv2,[1,1]);return st(Oe(r,Oe(a,o)))})}function sl(e,t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),pe(function(){var a=st(n?Oe(Wn(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):_n(e,t.conv0,r?[2,2]:[1,1])),s=_n(a,t.conv1,[1,1]),o=st(Oe(a,s)),l=_n(o,t.conv2,[1,1]),c=st(Oe(a,Oe(s,l))),u=_n(c,t.conv3,[1,1]);return st(Oe(a,Oe(s,Oe(l,u))))})}function Qn(e,t,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),pe(function(){var a=Oe(Wn(e,t.filters,[1,1],n),t.bias);return r?st(a):a})}function $r(e,t){Object.keys(e).forEach(function(n){t.some(function(r){return r.originalPath===n})||e[n].dispose()})}function Qc(e,t){return function(n,r,a,s){var o=sn(e(n*r*a*a),[a,a,n,r]),l=vt(e(r));return t.push({paramPath:s+"/filters"},{paramPath:s+"/bias"}),{filters:o,bias:l}}}function hp(e,t){return function(n,r,a){var s=ha(e(n*r),[n,r]),o=vt(e(r));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:s,bias:o}}}var Sb=function(){function e(t,n,r){this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}return e}();function fp(e,t){return function(n,r,a){var s=sn(e(9*n),[3,3,n,1]),o=sn(e(n*r),[1,1,n,r]),l=vt(e(r));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new Sb(s,o,l)}}function pp(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),a=e(t+"/bias",1);return new Sb(n,r,a)}}function ka(e,t){return function(n,r,a){var s=e[n];if(!Gc(s,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+s);return t.push({originalPath:n,paramPath:a||n}),s}}function zr(e){var t=e;function n(a){var s=t.slice(0,a);return t=t.slice(a),s}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function Eb(e,t){var n=Qc(e,t),r=fp(e,t);function a(o,l,c,u){u===void 0&&(u=!1);var d=u?n(o,l,3,c+"/conv0"):r(o,l,c+"/conv0"),h=r(l,l,c+"/conv1"),f=r(l,l,c+"/conv2");return{conv0:d,conv1:h,conv2:f}}function s(o,l,c,u){u===void 0&&(u=!1);var d=a(o,l,c,u),h=d.conv0,f=d.conv1,p=d.conv2,m=r(l,l,c+"/conv3");return{conv0:h,conv1:f,conv2:p,conv3:m}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:s}}function nR(e){var t=[],n=zr(e),r=n.extractWeights,a=n.getRemainingWeights,s=Eb(r,t).extractDenseBlock4Params,o=s(3,32,"dense0",!0),l=s(32,64,"dense1"),c=s(64,128,"dense2"),u=s(128,256,"dense3");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:l,dense2:c,dense3:u}}}function Rb(e){return function(t){var n=e(t+"/filters",4),r=e(t+"/bias",1);return{filters:n,bias:r}}}function Db(e,t){var n=ka(e,t),r=Rb(n),a=pp(n);function s(l,c){c===void 0&&(c=!1);var u=c?r(l+"/conv0"):a(l+"/conv0"),d=a(l+"/conv1"),h=a(l+"/conv2");return{conv0:u,conv1:d,conv2:h}}function o(l,c){c===void 0&&(c=!1);var u=c?r(l+"/conv0"):a(l+"/conv0"),d=a(l+"/conv1"),h=a(l+"/conv2"),f=a(l+"/conv3");return{conv0:u,conv1:d,conv2:h,conv3:f}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:o}}function rR(e){var t=[],n=Db(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return $r(e,t),{params:r,paramMappings:t}}var Ib=function(e){Ae(t,e);function t(){return e.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return pe(function(){var a=n.toBatchTensor(112,!0),s=[122.782,117.001,104.298],o=Di(a,s).div(de(255)),l=sl(o,r.dense0,!0);return l=sl(l,r.dense1),l=sl(l,r.dense2),l=sl(l,r.dense3),l=Ei(l,[7,7],[2,2],"valid"),l})},t.prototype.forward=function(n){return Ne(this,void 0,void 0,function(){var r;return _e(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(n){return rR(n)},t.prototype.extractParams=function(n){return nR(n)},t}(Wr);function ur(e,t){return pe(function(){return Oe(Vc(e,t.weights),t.bias)})}function aR(e,t,n){var r=[],a=zr(e),s=a.extractWeights,o=a.getRemainingWeights,l=hp(s,r),c=l(t,n,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:c}}}function sR(e){var t=[],n=ka(e,t);function r(s){var o=n(s+"/weights",2),l=n(s+"/bias",1);return{weights:o,bias:l}}var a={fc:r("fc")};return $r(e,t),{params:a,paramMappings:t}}function Ab(e){var t={},n={};return Object.keys(e).forEach(function(r){var a=r.startsWith("fc")?n:t;a[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var Tb=function(e){Ae(t,e);function t(n,r){var a=e.call(this,n)||this;return a._faceFeatureExtractor=r,a}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return pe(function(){var s=n instanceof xc?r.faceFeatureExtractor.forwardInput(n):n;return ur(s.as2D(s.shape[0],-1),a.fc)})},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),a=r.params,s=r.paramMappings;this._params=a,this._paramMappings=s},t.prototype.extractClassifierParams=function(n){return aR(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(n){var r=Ab(n),a=r.featureExtractorMap,s=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),sR(s)},t.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),s=a*r+a,o=n.slice(0,n.length-s),l=n.slice(n.length-s);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(l)},t}(Wr),rv=["neutral","happy","sad","angry","fearful","disgusted","surprised"],oR=function(){function e(t){var n=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);rv.forEach(function(r,a){n[r]=t[a]})}return e.prototype.asSortedArray=function(){var t=this;return rv.map(function(n){return{expression:n,probability:t[n]}}).sort(function(n,r){return r.probability-n.probability})},e}(),iR=function(e){Ae(t,e);function t(n){return n===void 0&&(n=new Ib),e.call(this,"FaceExpressionNet",n)||this}return t.prototype.forwardInput=function(n){var r=this;return pe(function(){return Lr(r.runNet(n))})},t.prototype.forward=function(n){return Ne(this,void 0,void 0,function(){var r;return _e(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.predictExpressions=function(n){return Ne(this,void 0,void 0,function(){var r,a,s,o,l=this;return _e(this,function(c){switch(c.label){case 0:return[4,At(n)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return a=c.sent(),[4,Promise.all(Nt(a).map(function(u){return Ne(l,void 0,void 0,function(){var d;return _e(this,function(h){switch(h.label){case 0:return[4,u.data()];case 1:return d=h.sent(),u.dispose(),[2,d]}})})}))];case 3:return s=c.sent(),a.dispose(),o=s.map(function(u){return new oR(u)}),[2,r.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(Tb);function Pb(e,t){var n={expressions:t};return Object.assign({},e,n)}function lR(e){return G3(e)&&e.landmarks instanceof vc&&e.unshiftedLandmarks instanceof vc&&e.alignedRect instanceof br}function mp(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),s=e.detection.imageDims,o=new br(e.detection.score,a.rescale(s.reverse()),s),l={landmarks:r,unshiftedLandmarks:t,alignedRect:o};return Object.assign({},e,l)}function cR(e,t){var n=Qc(e,t),r=fp(e,t);function a(o,l,c){var u=r(o,l,c+"/separable_conv0"),d=r(l,l,c+"/separable_conv1"),h=n(o,l,1,c+"/expansion_conv");return{separable_conv0:u,separable_conv1:d,expansion_conv:h}}function s(o,l){var c=r(o,o,l+"/separable_conv0"),u=r(o,o,l+"/separable_conv1"),d=r(o,o,l+"/separable_conv2");return{separable_conv0:c,separable_conv1:u,separable_conv2:d}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:a,extractMainBlockParams:s}}function uR(e,t){var n=[],r=zr(e),a=r.extractWeights,s=r.getRemainingWeights,o=cR(a,n),l=o.extractConvParams,c=o.extractSeparableConvParams,u=o.extractReductionBlockParams,d=o.extractMainBlockParams,h=l(3,32,3,"entry_flow/conv_in"),f=u(32,64,"entry_flow/reduction_block_0"),p=u(64,128,"entry_flow/reduction_block_1"),m={conv_in:h,reduction_block_0:f,reduction_block_1:p},x={};mi(t,0,1).forEach(function(w){x["main_block_"+w]=d(128,"middle_flow/main_block_"+w)});var y=u(128,256,"exit_flow/reduction_block"),g=c(256,512,"exit_flow/separable_conv"),v={reduction_block:y,separable_conv:g};if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:n,params:{entry_flow:m,middle_flow:x,exit_flow:v}}}function dR(e,t){var n=ka(e,t),r=Rb(n),a=pp(n);function s(l){var c=a(l+"/separable_conv0"),u=a(l+"/separable_conv1"),d=r(l+"/expansion_conv");return{separable_conv0:c,separable_conv1:u,expansion_conv:d}}function o(l){var c=a(l+"/separable_conv0"),u=a(l+"/separable_conv1"),d=a(l+"/separable_conv2");return{separable_conv0:c,separable_conv1:u,separable_conv2:d}}return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:s,extractMainBlockParams:o}}function hR(e,t){var n=[],r=dR(e,n),a=r.extractConvParams,s=r.extractSeparableConvParams,o=r.extractReductionBlockParams,l=r.extractMainBlockParams,c=a("entry_flow/conv_in"),u=o("entry_flow/reduction_block_0"),d=o("entry_flow/reduction_block_1"),h={conv_in:c,reduction_block_0:u,reduction_block_1:d},f={};mi(t,0,1).forEach(function(y){f["main_block_"+y]=l("middle_flow/main_block_"+y)});var p=o("exit_flow/reduction_block"),m=s("exit_flow/separable_conv"),x={reduction_block:p,separable_conv:m};return $r(e,n),{params:{entry_flow:h,middle_flow:f,exit_flow:x},paramMappings:n}}function Fb(e,t,n){return Oe(Wn(e,t.filters,n,"same"),t.bias)}function ed(e,t,n){n===void 0&&(n=!0);var r=n?st(e):e;return r=_n(r,t.separable_conv0,[1,1]),r=_n(st(r),t.separable_conv1,[1,1]),r=St(r,[3,3],[2,2],"same"),r=Oe(r,Fb(e,t.expansion_conv,[2,2])),r}function fR(e,t){var n=_n(st(e),t.separable_conv0,[1,1]);return n=_n(st(n),t.separable_conv1,[1,1]),n=_n(st(n),t.separable_conv2,[1,1]),n=Oe(n,e),n}var pR=function(e){Ae(t,e);function t(n){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return t.prototype.forwardInput=function(n){var r=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return pe(function(){var s=n.toBatchTensor(112,!0),o=[122.782,117.001,104.298],l=Di(s,o).div(de(256)),c=st(Fb(l,a.entry_flow.conv_in,[2,2]));return c=ed(c,a.entry_flow.reduction_block_0,!1),c=ed(c,a.entry_flow.reduction_block_1),mi(r._numMainBlocks,0,1).forEach(function(u){c=fR(c,a.middle_flow["main_block_"+u])}),c=ed(c,a.exit_flow.reduction_block),c=st(_n(c,a.exit_flow.separable_conv,[1,1])),c})},t.prototype.forward=function(n){return Ne(this,void 0,void 0,function(){var r;return _e(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(n){return hR(n,this._numMainBlocks)},t.prototype.extractParams=function(n){return uR(n,this._numMainBlocks)},t}(Wr);function mR(e){var t=[],n=zr(e),r=n.extractWeights,a=n.getRemainingWeights,s=hp(r,t),o=s(512,1,"fc/age"),l=s(512,2,"fc/gender");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:o,gender:l}}}}function gR(e){var t=[],n=ka(e,t);function r(s){var o=n(s+"/weights",2),l=n(s+"/bias",1);return{weights:o,bias:l}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return $r(e,t),{params:a,paramMappings:t}}var yc;(function(e){e.FEMALE="female",e.MALE="male"})(yc||(yc={}));var vR=function(e){Ae(t,e);function t(n){n===void 0&&(n=new pR(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return pe(function(){var s=n instanceof xc?r.faceFeatureExtractor.forwardInput(n):n,o=Ei(s,[7,7],[2,2],"valid").as2D(s.shape[0],-1),l=ur(o,a.fc.age).as1D(),c=ur(o,a.fc.gender);return{age:l,gender:c}})},t.prototype.forwardInput=function(n){var r=this;return pe(function(){var a=r.runNet(n),s=a.age,o=a.gender;return{age:s,gender:Lr(o)}})},t.prototype.forward=function(n){return Ne(this,void 0,void 0,function(){var r;return _e(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.predictAgeAndGender=function(n){return Ne(this,void 0,void 0,function(){var r,a,s,o,l,c,u=this;return _e(this,function(d){switch(d.label){case 0:return[4,At(n)];case 1:return r=d.sent(),[4,this.forwardInput(r)];case 2:return a=d.sent(),s=Nt(a.age),o=Nt(a.gender),l=s.map(function(h,f){return{ageTensor:h,genderTensor:o[f]}}),[4,Promise.all(l.map(function(h){var f=h.ageTensor,p=h.genderTensor;return Ne(u,void 0,void 0,function(){var m,x,y,g,v;return _e(this,function(w){switch(w.label){case 0:return[4,f.data()];case 1:return m=w.sent()[0],[4,p.data()];case 2:return x=w.sent()[0],y=x>.5,g=y?yc.MALE:yc.FEMALE,v=y?x:1-x,f.dispose(),p.dispose(),[2,{age:m,gender:g,genderProbability:v}]}})})}))];case 3:return c=d.sent(),a.age.dispose(),a.gender.dispose(),[2,r.isBatchInput?c:c[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),a=r.params,s=r.paramMappings;this._params=a,this._paramMappings=s},t.prototype.extractClassifierParams=function(n){return mR(n)},t.prototype.extractParamsFromWeigthMap=function(n){var r=Ab(n),a=r.featureExtractorMap,s=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),gR(s)},t.prototype.extractParams=function(n){var r=1539,a=n.slice(0,n.length-r),s=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},t}(Wr),Mb=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.postProcess=function(n,r,a){var s=a.map(function(l){var c=l.width,u=l.height,d=r/Math.max(u,c);return{width:c*d,height:u*d}}),o=s.length;return pe(function(){var l=function(f,p){return Cn([mr([68],f),mr([68],p)],1).as2D(1,136).as1D()},c=function(f,p){var m=s[f],x=m.width,y=m.height;return p(x,y)?Math.abs(x-y)/2:0},u=function(f){return c(f,function(p,m){return p<m})},d=function(f){return c(f,function(p,m){return m<p})},h=n.mul(mr([o,136],r)).sub(Cn(Array.from(Array(o),function(f,p){return l(u(p),d(p))}))).div(Cn(Array.from(Array(o),function(f,p){return l(s[p].width,s[p].height)})));return h})},t.prototype.forwardInput=function(n){var r=this;return pe(function(){var a=r.runNet(n);return r.postProcess(a,n.inputSize,n.inputDimensions.map(function(s){var o=s[0],l=s[1];return{height:o,width:l}}))})},t.prototype.forward=function(n){return Ne(this,void 0,void 0,function(){var r;return _e(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.detectLandmarks=function(n){return Ne(this,void 0,void 0,function(){var r,a,s,o=this;return _e(this,function(l){switch(l.label){case 0:return[4,At(n)];case 1:return r=l.sent(),a=pe(function(){return Nt(o.forwardInput(r))}),[4,Promise.all(a.map(function(c,u){return Ne(o,void 0,void 0,function(){var d,h,f,p,m;return _e(this,function(x){switch(x.label){case 0:return f=(h=Array).from,[4,c.data()];case 1:return d=f.apply(h,[x.sent()]),p=d.filter(function(y,g){return Yg(g)}),m=d.filter(function(y,g){return!Yg(g)}),[2,new H3(Array(68).fill(0).map(function(y,g){return new Ve(p[g],m[g])}),{height:r.getInputHeight(u),width:r.getInputWidth(u)})]}})})}))];case 2:return s=l.sent(),a.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?s:s[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(Tb),Ob=function(e){Ae(t,e);function t(n){return n===void 0&&(n=new Ib),e.call(this,"FaceLandmark68Net",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Mb);function xR(e){var t=[],n=Db(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return $r(e,t),{params:r,paramMappings:t}}function yR(e){var t=[],n=zr(e),r=n.extractWeights,a=n.getRemainingWeights,s=Eb(r,t).extractDenseBlock3Params,o=s(3,32,"dense0",!0),l=s(32,64,"dense1"),c=s(64,128,"dense2");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:l,dense2:c}}}var bR=function(e){Ae(t,e);function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return pe(function(){var a=n.toBatchTensor(112,!0),s=[122.782,117.001,104.298],o=Di(a,s).div(de(255)),l=Zu(o,r.dense0,!0);return l=Zu(l,r.dense1),l=Zu(l,r.dense2),l=Ei(l,[14,14],[2,2],"valid"),l})},t.prototype.forward=function(n){return Ne(this,void 0,void 0,function(){var r;return _e(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(n){return xR(n)},t.prototype.extractParams=function(n){return yR(n)},t}(Wr),wR=function(e){Ae(t,e);function t(n){return n===void 0&&(n=new bR),e.call(this,"FaceLandmark68TinyNet",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Mb);(function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(Ob);function NR(e,t){return Oe(Gt(e,t.weights),t.biases)}function gp(e,t,n,r,a){a===void 0&&(a="same");var s=t.conv,o=s.filters,l=s.bias,c=Wn(e,o,n,a);return c=Oe(c,l),c=NR(c,t.scale),r?st(c):c}function _R(e,t){return gp(e,t,[1,1],!0)}function Lb(e,t){return gp(e,t,[1,1],!1)}function Bb(e,t){return gp(e,t,[2,2],!0,"valid")}function jR(e,t){function n(l,c,u){var d=e(l),h=d.length/(c*u*u);if(M3(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+d.length+", numFilters: "+c+", filterSize: "+u);return pe(function(){return va(sn(d,[c,h,u,u]),[2,3,1,0])})}function r(l,c,u,d){var h=n(l,c,u),f=vt(e(c));return t.push({paramPath:d+"/filters"},{paramPath:d+"/bias"}),{filters:h,bias:f}}function a(l,c){var u=vt(e(l)),d=vt(e(l));return t.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:u,biases:d}}function s(l,c,u,d){var h=r(l,c,u,d+"/conv"),f=a(c,d+"/scale");return{conv:h,scale:f}}function o(l,c,u,d,h){h===void 0&&(h=!1);var f=s((h?.5:1)*l,c,u,d+"/conv1"),p=s(l,c,u,d+"/conv2");return{conv1:f,conv2:p}}return{extractConvLayerParams:s,extractResidualLayerParams:o}}function kR(e){var t=zr(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],s=jR(n,a),o=s.extractConvLayerParams,l=s.extractResidualLayerParams,c=o(4704,32,7,"conv32_down"),u=l(9216,32,3,"conv32_1"),d=l(9216,32,3,"conv32_2"),h=l(9216,32,3,"conv32_3"),f=l(36864,64,3,"conv64_down",!0),p=l(36864,64,3,"conv64_1"),m=l(36864,64,3,"conv64_2"),x=l(36864,64,3,"conv64_3"),y=l(147456,128,3,"conv128_down",!0),g=l(147456,128,3,"conv128_1"),v=l(147456,128,3,"conv128_2"),w=l(589824,256,3,"conv256_down",!0),b=l(589824,256,3,"conv256_1"),N=l(589824,256,3,"conv256_2"),_=l(589824,256,3,"conv256_down_out"),k=pe(function(){return va(ha(n(256*128),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var j={conv32_down:c,conv32_1:u,conv32_2:d,conv32_3:h,conv64_down:f,conv64_1:p,conv64_2:m,conv64_3:x,conv128_down:y,conv128_1:g,conv128_2:v,conv256_down:w,conv256_1:b,conv256_2:N,conv256_down_out:_,fc:k};return{params:j,paramMappings:a}}function CR(e,t){var n=ka(e,t);function r(o){var l=n(o+"/scale/weights",1),c=n(o+"/scale/biases",1);return{weights:l,biases:c}}function a(o){var l=n(o+"/conv/filters",4),c=n(o+"/conv/bias",1),u=r(o);return{conv:{filters:l,bias:c},scale:u}}function s(o){return{conv1:a(o+"/conv1"),conv2:a(o+"/conv2")}}return{extractConvLayerParams:a,extractResidualLayerParams:s}}function SR(e){var t=[],n=CR(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,s=r("conv32_down"),o=a("conv32_1"),l=a("conv32_2"),c=a("conv32_3"),u=a("conv64_down"),d=a("conv64_1"),h=a("conv64_2"),f=a("conv64_3"),p=a("conv128_down"),m=a("conv128_1"),x=a("conv128_2"),y=a("conv256_down"),g=a("conv256_1"),v=a("conv256_2"),w=a("conv256_down_out"),b=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!F3(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var N={conv32_down:s,conv32_1:o,conv32_2:l,conv32_3:c,conv64_down:u,conv64_1:d,conv64_2:h,conv64_3:f,conv128_down:p,conv128_1:m,conv128_2:x,conv256_down:y,conv256_1:g,conv256_2:v,conv256_down_out:w,fc:b};return $r(e,t),{params:N,paramMappings:t}}function rr(e,t){var n=_R(e,t.conv1);return n=Lb(n,t.conv2),n=Oe(n,e),n=st(n),n}function ol(e,t){var n=Bb(e,t.conv1);n=Lb(n,t.conv2);var r=Ei(e,2,2,"valid"),a=Ye(r.shape),s=r.shape[3]!==n.shape[3],o=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(o){var l=Lo(n.shape);l[1]=1;var c=Ye(l);n=wt([n,c],1);var u=Lo(n.shape);u[2]=1;var d=Ye(u);n=wt([n,d],2)}return r=s?wt([r,a],3):r,n=Oe(r,n),n=st(n),n}var ER=function(e){Ae(t,e);function t(){return e.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return pe(function(){var a=n.toBatchTensor(150,!0).toFloat(),s=[122.782,117.001,104.298],o=Di(a,s).div(de(256)),l=Bb(o,r.conv32_down);l=St(l,3,2,"valid"),l=rr(l,r.conv32_1),l=rr(l,r.conv32_2),l=rr(l,r.conv32_3),l=ol(l,r.conv64_down),l=rr(l,r.conv64_1),l=rr(l,r.conv64_2),l=rr(l,r.conv64_3),l=ol(l,r.conv128_down),l=rr(l,r.conv128_1),l=rr(l,r.conv128_2),l=ol(l,r.conv256_down),l=rr(l,r.conv256_1),l=rr(l,r.conv256_2),l=ol(l,r.conv256_down_out);var c=l.mean([1,2]),u=Vc(c,r.fc);return u})},t.prototype.forward=function(n){return Ne(this,void 0,void 0,function(){var r;return _e(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.computeFaceDescriptor=function(n){return Ne(this,void 0,void 0,function(){var r,a,s,o=this;return _e(this,function(l){switch(l.label){case 0:return[4,At(n)];case 1:return r=l.sent(),a=pe(function(){return Nt(o.forwardInput(r))}),[4,Promise.all(a.map(function(c){return c.data()}))];case 2:return s=l.sent(),a.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?s:s[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(n){return SR(n)},t.prototype.extractParams=function(n){return kR(n)},t}(Wr);function Wb(e,t){var n={descriptor:t};return Object.assign({},e,n)}function $b(e,t){var n={age:t};return Object.assign({},e,n)}function zb(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var Ub=function(){function e(t){var n=t===void 0?{}:t,r=n.minFaceSize,a=n.scaleFactor,s=n.maxNumScales,o=n.scoreThresholds,l=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=a||.709,this._maxNumScales=s||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=l,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(c){return typeof c!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return typeof c!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function RR(e,t){function n(c,u){var d=sn(e(9*c),[3,3,c,1]),h=vt(e(c)),f=vt(e(c)),p=vt(e(c)),m=vt(e(c));return t.push({paramPath:u+"/filters"},{paramPath:u+"/batch_norm_scale"},{paramPath:u+"/batch_norm_offset"},{paramPath:u+"/batch_norm_mean"},{paramPath:u+"/batch_norm_variance"}),{filters:d,batch_norm_scale:h,batch_norm_offset:f,batch_norm_mean:p,batch_norm_variance:m}}function r(c,u,d,h,f){var p=sn(e(c*u*d*d),[d,d,c,u]),m=vt(e(u));return t.push({paramPath:h+"/filters"},{paramPath:h+"/"+(f?"batch_norm_offset":"bias")}),{filters:p,bias:m}}function a(c,u,d,h){var f=r(c,u,d,h,!0),p=f.filters,m=f.bias;return{filters:p,batch_norm_offset:m}}function s(c,u,d){var h=n(c,d+"/depthwise_conv"),f=a(c,u,1,d+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:f}}function o(){var c=a(3,32,3,"mobilenetv1/conv_0"),u=s(32,64,"mobilenetv1/conv_1"),d=s(64,128,"mobilenetv1/conv_2"),h=s(128,128,"mobilenetv1/conv_3"),f=s(128,256,"mobilenetv1/conv_4"),p=s(256,256,"mobilenetv1/conv_5"),m=s(256,512,"mobilenetv1/conv_6"),x=s(512,512,"mobilenetv1/conv_7"),y=s(512,512,"mobilenetv1/conv_8"),g=s(512,512,"mobilenetv1/conv_9"),v=s(512,512,"mobilenetv1/conv_10"),w=s(512,512,"mobilenetv1/conv_11"),b=s(512,1024,"mobilenetv1/conv_12"),N=s(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:u,conv_2:d,conv_3:h,conv_4:f,conv_5:p,conv_6:m,conv_7:x,conv_8:y,conv_9:g,conv_10:v,conv_11:w,conv_12:b,conv_13:N}}function l(){var c=a(1024,256,1,"prediction_layer/conv_0"),u=a(256,512,3,"prediction_layer/conv_1"),d=a(512,128,1,"prediction_layer/conv_2"),h=a(128,256,3,"prediction_layer/conv_3"),f=a(256,128,1,"prediction_layer/conv_4"),p=a(128,256,3,"prediction_layer/conv_5"),m=a(256,64,1,"prediction_layer/conv_6"),x=a(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),v=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),w=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),N=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),k=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),j=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),C=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),S=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),M=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),T={box_encoding_predictor:y,class_predictor:g},A={box_encoding_predictor:v,class_predictor:w},L={box_encoding_predictor:b,class_predictor:N},O={box_encoding_predictor:_,class_predictor:k},U={box_encoding_predictor:j,class_predictor:C},z={box_encoding_predictor:S,class_predictor:M};return{conv_0:c,conv_1:u,conv_2:d,conv_3:h,conv_4:f,conv_5:p,conv_6:m,conv_7:x,box_predictor_0:T,box_predictor_1:A,box_predictor_2:L,box_predictor_3:O,box_predictor_4:U,box_predictor_5:z}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:l}}function DR(e){var t=[],n=zr(e),r=n.extractWeights,a=n.getRemainingWeights,s=RR(r,t),o=s.extractMobilenetV1Params,l=s.extractPredictionLayerParams,c=o(),u=l(),d=Af(r(5118*4),[1,5118,4]),h={extra_dim:d};if(t.push({paramPath:"output_layer/extra_dim"}),a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:c,prediction_layer:u,output_layer:h},paramMappings:t}}function IR(e,t){var n=ka(e,t);function r(u,d,h){var f=n(u+"/Conv2d_"+d+"_pointwise/weights",4,h+"/filters"),p=n(u+"/Conv2d_"+d+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:f,batch_norm_offset:p}}function a(u){var d="mobilenetv1/conv_"+u,h="MobilenetV1/Conv2d_"+u+"_depthwise",f=d+"/depthwise_conv",p=d+"/pointwise_conv",m=n(h+"/depthwise_weights",4,f+"/filters"),x=n(h+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),y=n(h+"/BatchNorm/beta",1,f+"/batch_norm_offset"),g=n(h+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),v=n(h+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:m,batch_norm_scale:x,batch_norm_offset:y,batch_norm_mean:g,batch_norm_variance:v},pointwise_conv:r("MobilenetV1",u,p)}}function s(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function o(u,d){var h=n(u+"/weights",4,d+"/filters"),f=n(u+"/biases",1,d+"/bias");return{filters:h,bias:f}}function l(u){var d=o("Prediction/BoxPredictor_"+u+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+u+"/box_encoding_predictor"),h=o("Prediction/BoxPredictor_"+u+"/ClassPredictor","prediction_layer/box_predictor_"+u+"/class_predictor");return{box_encoding_predictor:d,class_predictor:h}}function c(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:l(0),box_predictor_1:l(1),box_predictor_2:l(2),box_predictor_3:l(3),box_predictor_4:l(4),box_predictor_5:l(5)}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:c}}function AR(e){var t=[],n=IR(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,s=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Kc(s))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+s);var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:s}};return $r(e,t),{params:o,paramMappings:t}}function sr(e,t,n){return pe(function(){var r=Wn(e,t.filters,n,"same");return r=Oe(r,t.batch_norm_offset),Uf(r,0,6)})}var TR=.0010000000474974513;function PR(e,t,n){return pe(function(){var r=Uc(e,t.filters,n,"same");return r=Oy(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,TR),Uf(r,0,6)})}function FR(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}function MR(e,t){return pe(function(){var n=null,r=sr(e,t.conv_0,[2,2]),a=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(a.forEach(function(s,o){var l=o+1,c=FR(l);r=PR(r,s.depthwise_conv,c),r=sr(r,s.pointwise_conv,[1,1]),l===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function OR(e,t,n,r,a){var s=e.shape[0],o=Math.min(n,s),l=t.map(function(d,h){return{score:d,boxIndex:h}}).filter(function(d){return d.score>a}).sort(function(d,h){return h.score-d.score}),c=function(d){return d<=r?1:0},u=[];return l.forEach(function(d){if(!(u.length>=o)){for(var h=d.score,f=u.length-1;f>=0;--f){var p=LR(e,d.boxIndex,u[f]);if(p!==0&&(d.score*=c(p),d.score<=a))break}h===d.score&&u.push(d.boxIndex)}}),u}function LR(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),s=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),l=Math.max(r[t][1],r[t][3]),c=Math.min(r[n][0],r[n][2]),u=Math.min(r[n][1],r[n][3]),d=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),f=(o-a)*(l-s),p=(d-c)*(h-u);if(f<=0||p<=0)return 0;var m=Math.max(a,c),x=Math.max(s,u),y=Math.min(o,d),g=Math.min(l,h),v=Math.max(y-m,0)*Math.max(g-x,0);return v/(f+p-v)}function BR(e){var t=Nt(va(e,[1,0])),n=[jt(t[2],t[0]),jt(t[3],t[1])],r=[Oe(t[0],Hn(n[0],de(2))),Oe(t[1],Hn(n[1],de(2)))];return{sizes:n,centers:r}}function WR(e,t){var n=BR(e),r=n.sizes,a=n.centers,s=Nt(va(t,[1,0])),o=Hn(Gt(vh(Hn(s[2],de(5))),r[0]),de(2)),l=Oe(Gt(Hn(s[0],de(10)),r[0]),a[0]),c=Hn(Gt(vh(Hn(s[3],de(5))),r[1]),de(2)),u=Oe(Gt(Hn(s[1],de(10)),r[1]),a[1]);return va(Cn([jt(l,o),jt(u,c),Oe(l,o),Oe(u,c)]),[1,0])}function $R(e,t,n){return pe(function(){var r=e.shape[0],a=WR(Kn(Ps(n.extra_dim,[r,1,1]),[-1,4]),Kn(e,[-1,4]));a=Kn(a,[r,a.shape[0]/r,4]);var s=Ty(gr(t,[0,0,1],[-1,-1,-1])),o=gr(s,[0,0,0],[-1,-1,1]);o=Kn(o,[r,o.shape[1]]);var l=Nt(a),c=Nt(o);return{boxes:l,scores:c}})}function is(e,t){return pe(function(){var n=e.shape[0],r=Kn(Qn(e,t.box_encoding_predictor),[n,-1,1,4]),a=Kn(Qn(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:a}})}function zR(e,t,n){return pe(function(){var r=sr(e,n.conv_0,[1,1]),a=sr(r,n.conv_1,[2,2]),s=sr(a,n.conv_2,[1,1]),o=sr(s,n.conv_3,[2,2]),l=sr(o,n.conv_4,[1,1]),c=sr(l,n.conv_5,[2,2]),u=sr(c,n.conv_6,[1,1]),d=sr(u,n.conv_7,[2,2]),h=is(t,n.box_predictor_0),f=is(e,n.box_predictor_1),p=is(a,n.box_predictor_2),m=is(o,n.box_predictor_3),x=is(c,n.box_predictor_4),y=is(d,n.box_predictor_5),g=wt([h.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,x.boxPredictionEncoding,y.boxPredictionEncoding],1),v=wt([h.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,x.classPrediction,y.classPrediction],1);return{boxPredictions:g,classPredictions:v}})}var io=function(){function e(t){var n=t===void 0?{}:t,r=n.minConfidence,a=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=a||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),Vb=function(e){Ae(t,e);function t(){return e.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return pe(function(){var a=n.toBatchTensor(512,!1).toFloat(),s=jt(Gt(a,de(.007843137718737125)),de(1)),o=MR(s,r.mobilenetv1),l=zR(o.out,o.conv11,r.prediction_layer),c=l.boxPredictions,u=l.classPredictions;return $R(c,u,r.output_layer)})},t.prototype.forward=function(n){return Ne(this,void 0,void 0,function(){var r;return _e(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),Ne(this,void 0,void 0,function(){var a,s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,k,j;return _e(this,function(C){switch(C.label){case 0:return a=new io(r),s=a.maxResults,o=a.minConfidence,[4,At(n)];case 1:for(l=C.sent(),c=this.forwardInput(l),u=c.boxes,d=c.scores,h=u[0],f=d[0],p=1;p<u.length;p++)u[p].dispose(),d[p].dispose();return y=(x=Array).from,[4,f.data()];case 2:return m=y.apply(x,[C.sent()]),g=.5,v=OR(h,m,s,g,o),w=l.getReshapedInputDimensions(0),b=l.inputSize,N=b/w.width,_=b/w.height,k=h.arraySync(),j=v.map(function(S){var M=[Math.max(0,k[S][0]),Math.min(1,k[S][2])].map(function(z){return z*_}),T=M[0],A=M[1],L=[Math.max(0,k[S][1]),Math.min(1,k[S][3])].map(function(z){return z*N}),O=L[0],U=L[1];return new br(m[S],new op(O,T,U-O,A-T),{height:l.getInputHeight(0),width:l.getInputWidth(0)})}),h.dispose(),f.dispose(),[2,j]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(n){return AR(n)},t.prototype.extractParams=function(n){return DR(n)},t}(Wr);(function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(Vb);var UR=.4,VR=[new Ve(.738768,.874946),new Ve(2.42204,2.65704),new Ve(4.30971,7.04493),new Ve(10.246,4.59428),new Ve(12.6868,11.8741)],qR=[new Ve(1.603231,2.094468),new Ve(6.041143,7.080126),new Ve(2.882459,3.518061),new Ve(4.266906,5.178857),new Ve(9.041765,10.66308)],HR=[117.001,114.697,97.404],GR="tiny_yolov2_model",KR="tiny_yolov2_separable_conv_model",il=function(e){return typeof e=="number"};function XR(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!il(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(t){return t||{}}).every(function(t){return il(t.x)&&il(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(il)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function vp(e){return pe(function(){var t=Gt(e,de(.10000000149011612));return Oe(st(jt(e,t)),t)})}function qr(e,t){return pe(function(){var n=Za(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Wn(n,t.conv.filters,[1,1],"valid"),n=jt(n,t.bn.sub),n=Gt(n,t.bn.truediv),n=Oe(n,t.conv.bias),vp(n)})}function Hr(e,t){return pe(function(){var n=Za(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Gf(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=Oe(n,t.bias),vp(n)})}function YR(e,t){var n=Qc(e,t);function r(o,l){var c=vt(e(o)),u=vt(e(o));return t.push({paramPath:l+"/sub"},{paramPath:l+"/truediv"}),{sub:c,truediv:u}}function a(o,l,c){var u=n(o,l,3,c+"/conv"),d=r(l,c+"/bn");return{conv:u,bn:d}}var s=fp(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}}function QR(e,t,n,r){var a=zr(e),s=a.extractWeights,o=a.getRemainingWeights,l=[],c=YR(s,l),u=c.extractConvParams,d=c.extractConvWithBatchNormParams,h=c.extractSeparableConvParams,f;if(t.withSeparableConvs){var p=r[0],m=r[1],x=r[2],y=r[3],g=r[4],v=r[5],w=r[6],b=r[7],N=r[8],_=t.isFirstLayerConv2d?u(p,m,3,"conv0"):h(p,m,"conv0"),k=h(m,x,"conv1"),j=h(x,y,"conv2"),C=h(y,g,"conv3"),S=h(g,v,"conv4"),M=h(v,w,"conv5"),T=b?h(w,b,"conv6"):void 0,A=N?h(b,N,"conv7"):void 0,L=u(N||b||w,5*n,1,"conv8");f={conv0:_,conv1:k,conv2:j,conv3:C,conv4:S,conv5:M,conv6:T,conv7:A,conv8:L}}else{var p=r[0],m=r[1],x=r[2],y=r[3],g=r[4],v=r[5],w=r[6],b=r[7],N=r[8],_=d(p,m,"conv0"),k=d(m,x,"conv1"),j=d(x,y,"conv2"),C=d(y,g,"conv3"),S=d(g,v,"conv4"),M=d(v,w,"conv5"),T=d(w,b,"conv6"),A=d(b,N,"conv7"),L=u(N,5*n,1,"conv8");f={conv0:_,conv1:k,conv2:j,conv3:C,conv4:S,conv5:M,conv6:T,conv7:A,conv8:L}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:f,paramMappings:l}}function JR(e,t){var n=ka(e,t);function r(l){var c=n(l+"/sub",1),u=n(l+"/truediv",1);return{sub:c,truediv:u}}function a(l){var c=n(l+"/filters",4),u=n(l+"/bias",1);return{filters:c,bias:u}}function s(l){var c=a(l+"/conv"),u=r(l+"/bn");return{conv:c,bn:u}}var o=pp(n);return{extractConvParams:a,extractConvWithBatchNormParams:s,extractSeparableConvParams:o}}function ZR(e,t){var n=[],r=JR(e,n),a=r.extractConvParams,s=r.extractConvWithBatchNormParams,o=r.extractSeparableConvParams,l;if(t.withSeparableConvs){var c=t.filterSizes&&t.filterSizes.length||9;l={conv0:t.isFirstLayerConv2d?a("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:c>7?o("conv6"):void 0,conv7:c>8?o("conv7"):void 0,conv8:a("conv8")}}else l={conv0:s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:s("conv6"),conv7:s("conv7"),conv8:a("conv8")};return $r(e,n),{params:l,paramMappings:n}}var av;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(av||(av={}));var xp=function(){function e(t){var n=t===void 0?{}:t,r=n.inputSize,a=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=a||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),qb=function(e){Ae(t,e);function t(n){var r=e.call(this,"TinyYolov2")||this;return XR(n),r._config=n,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(n,r){var a=qr(n,r.conv0);return a=St(a,[2,2],[2,2],"same"),a=qr(a,r.conv1),a=St(a,[2,2],[2,2],"same"),a=qr(a,r.conv2),a=St(a,[2,2],[2,2],"same"),a=qr(a,r.conv3),a=St(a,[2,2],[2,2],"same"),a=qr(a,r.conv4),a=St(a,[2,2],[2,2],"same"),a=qr(a,r.conv5),a=St(a,[2,2],[1,1],"same"),a=qr(a,r.conv6),a=qr(a,r.conv7),Qn(a,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(n,r){var a=this.config.isFirstLayerConv2d?vp(Qn(n,r.conv0,"valid",!1)):Hr(n,r.conv0);return a=St(a,[2,2],[2,2],"same"),a=Hr(a,r.conv1),a=St(a,[2,2],[2,2],"same"),a=Hr(a,r.conv2),a=St(a,[2,2],[2,2],"same"),a=Hr(a,r.conv3),a=St(a,[2,2],[2,2],"same"),a=Hr(a,r.conv4),a=St(a,[2,2],[2,2],"same"),a=Hr(a,r.conv5),a=St(a,[2,2],[1,1],"same"),a=r.conv6?Hr(a,r.conv6):a,a=r.conv7?Hr(a,r.conv7):a,Qn(a,r.conv8,"valid",!1)},t.prototype.forwardInput=function(n,r){var a=this,s=this.params;if(!s)throw new Error("TinyYolov2 - load model before inference");return pe(function(){var o=n.toBatchTensor(r,!1).toFloat();return o=a.config.meanRgb?Di(o,a.config.meanRgb):o,o=o.div(de(256)),a.config.withSeparableConvs?a.runMobilenet(o,s):a.runTinyYolov2(o,s)})},t.prototype.forward=function(n,r){return Ne(this,void 0,void 0,function(){var a;return _e(this,function(s){switch(s.label){case 0:return a=this.forwardInput,[4,At(n)];case 1:return[4,a.apply(this,[s.sent(),r])];case 2:return[2,s.sent()]}})})},t.prototype.detect=function(n,r){return r===void 0&&(r={}),Ne(this,void 0,void 0,function(){var a,s,o,l,c,u,d,h,f,p,m,x,y,g,v=this;return _e(this,function(w){switch(w.label){case 0:return a=new xp(r),s=a.inputSize,o=a.scoreThreshold,[4,At(n)];case 1:return l=w.sent(),[4,this.forwardInput(l,s)];case 2:return c=w.sent(),u=pe(function(){return Nt(c)[0].expandDims()}),d={width:l.getInputWidth(0),height:l.getInputHeight(0)},[4,this.extractBoxes(u,l.getReshapedInputDimensions(0),o)];case 3:return h=w.sent(),c.dispose(),u.dispose(),f=h.map(function(b){return b.box}),p=h.map(function(b){return b.score}),m=h.map(function(b){return b.classScore}),x=h.map(function(b){return v.config.classes[b.label]}),y=gi(f.map(function(b){return b.rescale(s)}),p,this.config.iouThreshold,!0),g=y.map(function(b){return new vb(p[b],m[b],x[b],f[b],d)}),[2,g]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(n){return ZR(n,this.config)},t.prototype.extractParams=function(n){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,a=r?r.length:void 0;if(a!==7&&a!==8&&a!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+a+" filterSizes in config");return QR(n,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(n,r,a){return Ne(this,void 0,void 0,function(){var s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,k,j,C,S,M,T,A,L,O,U,z,F=this;return _e(this,function(W){switch(W.label){case 0:return s=r.width,o=r.height,l=Math.max(s,o),c=l/s,u=l/o,d=n.shape[1],h=this.config.anchors.length,f=pe(function(){var I=n.reshape([d,d,h,F.boxEncodingSize]),q=I.slice([0,0,0,0],[d,d,h,4]),K=I.slice([0,0,0,4],[d,d,h,1]),re=F.withClassScores?Lr(I.slice([0,0,0,5],[d,d,h,F.config.classes.length]),3):de(0);return[q,K,re]}),p=f[0],m=f[1],x=f[2],y=[],[4,m.array()];case 1:return g=W.sent(),[4,p.array()];case 2:v=W.sent(),w=0,W.label=3;case 3:if(!(w<d))return[3,12];b=0,W.label=4;case 4:if(!(b<d))return[3,11];N=0,W.label=5;case 5:return N<h?(_=Ju(g[w][b][N][0]),!a||_>a?(k=(b+Ju(v[w][b][N][0]))/d*c,j=(w+Ju(v[w][b][N][1]))/d*u,C=Math.exp(v[w][b][N][2])*this.config.anchors[N].x/d*c,S=Math.exp(v[w][b][N][3])*this.config.anchors[N].y/d*u,M=k-C/2,T=j-S/2,A={row:w,col:b,anchor:N},this.withClassScores?[4,this.extractPredictedClass(x,A)]:[3,7]):[3,9]):[3,10];case 6:return z=W.sent(),[3,8];case 7:z={classScore:1,label:0},W.label=8;case 8:L=z,O=L.classScore,U=L.label,y.push(Vt({box:new Xc(M,T,M+C,T+S),score:_,classScore:_*O,label:U},A)),W.label=9;case 9:return N++,[3,5];case 10:return b++,[3,4];case 11:return w++,[3,3];case 12:return p.dispose(),m.dispose(),x.dispose(),[2,y]}})})},t.prototype.extractPredictedClass=function(n,r){return Ne(this,void 0,void 0,function(){var a,s,o,l;return _e(this,function(c){switch(c.label){case 0:return a=r.row,s=r.col,o=r.anchor,[4,n.array()];case 1:return l=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(u,d){return l[a][s][o][d]}).map(function(u,d){return{classScore:u,label:d}}).reduce(function(u,d){return u.classScore>d.classScore?u:d})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Wr),eD=function(e){Ae(t,e);function t(n){n===void 0&&(n=!0);var r=this,a=Object.assign({},{withSeparableConvs:n,iouThreshold:UR,classes:["face"]},n?{anchors:qR,meanRgb:HR}:{anchors:VR,withClassScores:!0});return r=e.call(this,a)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return Ne(this,void 0,void 0,function(){var a;return _e(this,function(s){switch(s.label){case 0:return[4,this.detect(n,r)];case 1:return a=s.sent(),[2,a.map(function(o){return new br(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?KR:GR},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(qb),tD=function(e){Ae(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return t}(xp),Ii=function(){function e(){}return e.prototype.then=function(t){return Ne(this,void 0,void 0,function(){var n;return _e(this,function(r){switch(r.label){case 0:return n=t,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return Ne(this,void 0,void 0,function(){return _e(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},e}();function Jc(e,t,n,r,a){return a===void 0&&(a=function(s){var o=s.alignedRect;return o}),Ne(this,void 0,void 0,function(){var s,o,l,c,u;return _e(this,function(d){switch(d.label){case 0:return s=e.map(function(h){return lR(h)?a(h):h.detection}),l=r,l?[3,5]:t instanceof at?[4,dp(t,s)]:[3,2];case 1:return c=d.sent(),[3,4];case 2:return[4,up(t,s)];case 3:c=d.sent(),d.label=4;case 4:l=c,d.label=5;case 5:return o=l,[4,n(o)];case 6:return u=d.sent(),o.forEach(function(h){return h instanceof at&&h.dispose()}),[2,u]}})})}function yp(e,t,n,r,a){return Ne(this,void 0,void 0,function(){var s=this;return _e(this,function(o){return[2,Jc([e],t,function(l){return Ne(s,void 0,void 0,function(){return _e(this,function(c){return[2,n(l[0])]})})},r,a)]})})}function nD(e){return pe(function(){return Cn(Nt(e,3).reverse(),3)})}var ll=2,bc=12;function rD(e,t){var n=Qc(e,t),r=hp(e,t);function a(u,d){var h=vt(e(u));return t.push({paramPath:d}),h}function s(u,d,h){h===void 0&&(h=!1);var f=n(u[0],u[1],3,d+"/conv1"),p=a(u[1],d+"/prelu1_alpha"),m=n(u[1],u[2],3,d+"/conv2"),x=a(u[2],d+"/prelu2_alpha"),y=n(u[2],u[3],h?2:3,d+"/conv3"),g=a(u[3],d+"/prelu3_alpha");return{conv1:f,prelu1_alpha:p,conv2:m,prelu2_alpha:x,conv3:y,prelu3_alpha:g}}function o(){var u=s([3,10,16,32],"pnet"),d=n(32,2,1,"pnet/conv4_1"),h=n(32,4,1,"pnet/conv4_2");return Vt(Vt({},u),{conv4_1:d,conv4_2:h})}function l(){var u=s([3,28,48,64],"rnet",!0),d=r(576,128,"rnet/fc1"),h=a(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),p=r(128,4,"rnet/fc2_2");return Vt(Vt({},u),{fc1:d,prelu4_alpha:h,fc2_1:f,fc2_2:p})}function c(){var u=s([3,32,64,64],"onet"),d=n(64,128,2,"onet/conv4"),h=a(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),p=a(256,"onet/prelu5_alpha"),m=r(256,2,"onet/fc2_1"),x=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return Vt(Vt({},u),{conv4:d,prelu4_alpha:h,fc1:f,prelu5_alpha:p,fc2_1:m,fc2_2:x,fc2_3:y})}return{extractPNetParams:o,extractRNetParams:l,extractONetParams:c}}function aD(e){var t=zr(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],s=rD(n,a),o=s.extractPNetParams,l=s.extractRNetParams,c=s.extractONetParams,u=o(),d=l(),h=c();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:u,rnet:d,onet:h},paramMappings:a}}function sD(e,t){var n=ka(e,t);function r(d){var h=n(d+"/weights",4,d+"/filters"),f=n(d+"/bias",1);return{filters:h,bias:f}}function a(d){var h=n(d+"/weights",2),f=n(d+"/bias",1);return{weights:h,bias:f}}function s(d){return n(d,1)}function o(d){var h=r(d+"/conv1"),f=s(d+"/prelu1_alpha"),p=r(d+"/conv2"),m=s(d+"/prelu2_alpha"),x=r(d+"/conv3"),y=s(d+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:p,prelu2_alpha:m,conv3:x,prelu3_alpha:y}}function l(){var d=o("pnet"),h=r("pnet/conv4_1"),f=r("pnet/conv4_2");return Vt(Vt({},d),{conv4_1:h,conv4_2:f})}function c(){var d=o("rnet"),h=a("rnet/fc1"),f=s("rnet/prelu4_alpha"),p=a("rnet/fc2_1"),m=a("rnet/fc2_2");return Vt(Vt({},d),{fc1:h,prelu4_alpha:f,fc2_1:p,fc2_2:m})}function u(){var d=o("onet"),h=r("onet/conv4"),f=s("onet/prelu4_alpha"),p=a("onet/fc1"),m=s("onet/prelu5_alpha"),x=a("onet/fc2_1"),y=a("onet/fc2_2"),g=a("onet/fc2_3");return Vt(Vt({},d),{conv4:h,prelu4_alpha:f,fc1:p,prelu5_alpha:m,fc2_1:x,fc2_2:y,fc2_3:g})}return{extractPNetParams:l,extractRNetParams:c,extractONetParams:u}}function oD(e){var t=[],n=sD(e,t),r=n.extractPNetParams,a=n.extractRNetParams,s=n.extractONetParams,o=r(),l=a(),c=s();return $r(e,t),{params:{pnet:o,rnet:l,onet:c},paramMappings:t}}function kh(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}function iD(e,t,n){for(var r=n[0],a=n[1],s=bc/e,o=[],l=Math.min(r,a)*s,c=0;l>=12;)o.push(s*Math.pow(t,c)),l=l*t,c+=1;return o}var bp=function(e){Ae(t,e);function t(n,r,a,s){return e.call(this,{left:n,top:r,right:a,bottom:s},!0)||this}return t}(xa);function Hb(e){return pe(function(){return Gt(jt(e,de(127.5)),de(.0078125))})}function Ws(e,t){return pe(function(){return Oe(st(e),Gt(t,fc(st(fc(e)))))})}function wp(e,t,n){return n===void 0&&(n=!1),pe(function(){var r=Qn(e,t.conv1,"valid");return r=Ws(r,t.prelu1_alpha),r=St(r,n?[2,2]:[3,3],[2,2],"same"),r=Qn(r,t.conv2,"valid"),r=Ws(r,t.prelu2_alpha),r=n?r:St(r,[3,3],[2,2],"valid"),r=Qn(r,t.conv3,"valid"),r=Ws(r,t.prelu3_alpha),r})}function lD(e,t){return pe(function(){var n=wp(e,t,!0),r=Qn(n,t.conv4_1,"valid"),a=Tn(qc(r,3),3),s=Lr(jt(r,a),3),o=Qn(n,t.conv4_2,"valid");return{prob:s,regions:o}})}function cD(e,t){return pe(function(){var n=kh(t,e.shape.slice(1)),r=n.height,a=n.width,s=Jf.resizeBilinear(e,[r,a]),o=Hb(s);return va(o,[0,2,1,3])})}function uD(e,t,n,r){for(var a=[],s=e.arraySync(),o=0;o<e.shape[0];o++)for(var l=0;l<e.shape[1];l++)s[o][l]>=r&&a.push(new Ve(l,o));var c=a.map(function(u){var d=new Xc(Math.round((u.y*ll+1)/n),Math.round((u.x*ll+1)/n),Math.round((u.y*ll+bc)/n),Math.round((u.x*ll+bc)/n)),h=s[u.y][u.x],f=t.arraySync(),p=new bp(f[u.y][u.x][0],f[u.y][u.x][1],f[u.y][u.x][2],f[u.y][u.x][3]);return{cell:d,score:h,region:p}});return c}function dD(e,t,n,r,a){a.stage1=[];var s=t.map(function(f){return pe(function(){var p={scale:f},m=cD(e,f),x=Date.now(),y=lD(m,r),g=y.prob,v=y.regions;p.pnet=Date.now()-x;var w=Nt(Nt(g,3)[1])[0],b=Nt(v)[0];return{scoresTensor:w,regionsTensor:b,scale:f,statsForScale:p}})}),o=s.map(function(f){var p=f.scoresTensor,m=f.regionsTensor,x=f.scale,y=f.statsForScale,g=uD(p,m,x,n);if(p.dispose(),m.dispose(),!g.length)return a.stage1.push(y),[];var v=Date.now(),w=gi(g.map(function(b){return b.cell}),g.map(function(b){return b.score}),.5);return y.nms=Date.now()-v,y.numBoxes=w.length,a.stage1.push(y),w.map(function(b){return g[b]})}),l=o.reduce(function(f,p){return f.concat(p)},[]),c=[],u=[];if(l.length>0){var d=Date.now(),h=gi(l.map(function(f){return f.cell}),l.map(function(f){return f.score}),.7);a.stage1_nms=Date.now()-d,u=h.map(function(f){return l[f].score}),c=h.map(function(f){return l[f]}).map(function(f){var p=f.cell,m=f.region;return new Xc(p.left+m.left*p.width,p.top+m.top*p.height,p.right+m.right*p.width,p.bottom+m.bottom*p.height).toSquare().round()})}return{boxes:c,scores:u}}function Gb(e,t,n){var r=n.width,a=n.height;return Ne(this,void 0,void 0,function(){var s,o,l,c=this;return _e(this,function(u){switch(u.label){case 0:return s=Xa(e),[4,Promise.all(t.map(function(d){return Ne(c,void 0,void 0,function(){var h,f,p,m,x,y,g,v;return _e(this,function(w){return h=d.padAtBorders(e.height,e.width),f=h.y,p=h.ey,m=h.x,x=h.ex,y=m-1,g=f-1,v=s.getImageData(y,g,x-y,p-g),[2,Xt.isNodejs()?cp(v):createImageBitmap(v)]})})}))];case 1:return o=u.sent(),l=[],o.forEach(function(d){var h=Yc({width:r,height:a}),f=Xa(h);f.drawImage(d,0,0,r,a);for(var p=f.getImageData(0,0,r,a).data,m=[],x=0;x<p.length;x+=4)m.push(p[x+2]),m.push(p[x+1]),m.push(p[x]);l.push(m)}),[2,l.map(function(d){var h=pe(function(){var f=va(sn(d,[1,r,a,3]),[0,2,1,3]).toFloat();return Hb(f)});return h})]}})})}function hD(e,t){return pe(function(){var n=wp(e,t),r=Kn(n,[n.shape[0],t.fc1.weights.shape[0]]),a=ur(r,t.fc1),s=Ws(a,t.prelu4_alpha),o=ur(s,t.fc2_1),l=Tn(qc(o,1),1),c=Lr(jt(o,l),1),u=ur(s,t.fc2_2),d=Nt(c,1)[1];return{scores:d,regions:u}})}function fD(e,t,n,r,a){return Ne(this,void 0,void 0,function(){var s,o,l,c,u,d,h,f,p,m,x,y,g,v;return _e(this,function(w){switch(w.label){case 0:return s=Date.now(),[4,Gb(e,t,{width:24,height:24})];case 1:return o=w.sent(),a.stage2_extractImagePatches=Date.now()-s,s=Date.now(),l=o.map(function(b){var N=hD(b,r);return b.dispose(),N}),a.stage2_rnet=Date.now()-s,c=l.length>1?wt(l.map(function(b){return b.scores})):l[0].scores,h=(d=Array).from,[4,c.data()];case 2:return u=h.apply(d,[w.sent()]),c.dispose(),f=u.map(function(b,N){return{score:b,idx:N}}).filter(function(b){return b.score>n}).map(function(b){var N=b.idx;return N}),p=f.map(function(b){return t[b]}),m=f.map(function(b){return u[b]}),x=[],y=[],p.length>0&&(s=Date.now(),g=gi(p,m,.7),a.stage2_nms=Date.now()-s,v=g.map(function(b){var N=l[f[b]].regions.arraySync();return new bp(N[0][0],N[0][1],N[0][2],N[0][3])}),y=g.map(function(b){return m[b]}),x=g.map(function(b,N){return p[b].calibrate(v[N])})),l.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:x,scores:y}]}})})}function pD(e,t){return pe(function(){var n=wp(e,t);n=St(n,[2,2],[2,2],"same"),n=Qn(n,t.conv4,"valid"),n=Ws(n,t.prelu4_alpha);var r=Kn(n,[n.shape[0],t.fc1.weights.shape[0]]),a=ur(r,t.fc1),s=Ws(a,t.prelu5_alpha),o=ur(s,t.fc2_1),l=Tn(qc(o,1),1),c=Lr(jt(o,l),1),u=ur(s,t.fc2_2),d=ur(s,t.fc2_3),h=Nt(c,1)[1];return{scores:h,regions:u,points:d}})}function mD(e,t,n,r,a){return Ne(this,void 0,void 0,function(){var s,o,l,c,u,d,h,f,p,m,x,y,g,v,w;return _e(this,function(b){switch(b.label){case 0:return s=Date.now(),[4,Gb(e,t,{width:48,height:48})];case 1:return o=b.sent(),a.stage3_extractImagePatches=Date.now()-s,s=Date.now(),l=o.map(function(N){var _=pD(N,r);return N.dispose(),_}),a.stage3_onet=Date.now()-s,c=l.length>1?wt(l.map(function(N){return N.scores})):l[0].scores,h=(d=Array).from,[4,c.data()];case 2:return u=h.apply(d,[b.sent()]),c.dispose(),f=u.map(function(N,_){return{score:N,idx:_}}).filter(function(N){return N.score>n}).map(function(N){var _=N.idx;return _}),p=f.map(function(N){var _=l[N].regions.arraySync();return new bp(_[0][0],_[0][1],_[0][2],_[0][3])}),m=f.map(function(N,_){return t[N].calibrate(p[_])}),x=f.map(function(N){return u[N]}),y=[],g=[],v=[],m.length>0&&(s=Date.now(),w=gi(m,x,.7,!1),a.stage3_nms=Date.now()-s,y=w.map(function(N){return m[N]}),g=w.map(function(N){return x[N]}),v=w.map(function(N,_){return Array(5).fill(0).map(function(k,j){var C=l[N].points.arraySync();return new Ve(C[0][j]*(y[_].width+1)+y[_].left,C[0][j+5]*(y[_].height+1)+y[_].top)})})),l.forEach(function(N){N.regions.dispose(),N.scores.dispose(),N.points.dispose()}),[2,{boxes:y,scores:g,points:v}]}})})}var gD=function(e){Ae(t,e);function t(){return e.call(this,"Mtcnn")||this}return t.prototype.load=function(n){return Ne(this,void 0,void 0,function(){return _e(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,n)]})})},t.prototype.loadFromDisk=function(n){return Ne(this,void 0,void 0,function(){return _e(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,n)]})})},t.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),Ne(this,void 0,void 0,function(){var a,s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,k,j;return _e(this,function(C){switch(C.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(s=n.canvases[0],!s)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},l=Date.now(),c=pe(function(){return nD(Tn(ap.fromPixels(s)).toFloat())}),u=function(S){return c.dispose(),o.total=Date.now()-l,S},d=c.shape.slice(1),h=d[0],f=d[1],p=new Ub(r),m=p.minFaceSize,x=p.scaleFactor,y=p.maxNumScales,g=p.scoreThresholds,v=p.scaleSteps,w=(v||iD(m,x,[h,f])).filter(function(S){var M=kh(S,[h,f]);return Math.min(M.width,M.height)>bc}).slice(0,y),o.scales=w,o.pyramid=w.map(function(S){return kh(S,[h,f])}),b=Date.now(),[4,dD(c,w,g[0],a.pnet,o)];case 1:return N=C.sent(),o.total_stage1=Date.now()-b,N.boxes.length?(o.stage2_numInputBoxes=N.boxes.length,b=Date.now(),[4,fD(s,N.boxes,g[1],a.rnet,o)]):[2,u({results:[],stats:o})];case 2:return _=C.sent(),o.total_stage2=Date.now()-b,_.boxes.length?(o.stage3_numInputBoxes=_.boxes.length,b=Date.now(),[4,mD(s,_.boxes,g[2],a.onet,o)]):[2,u({results:[],stats:o})];case 3:return k=C.sent(),o.total_stage3=Date.now()-b,j=k.boxes.map(function(S,M){return mp(ip({},new br(k.scores[M],new op(S.left/f,S.top/h,S.width/f,S.height/h),{height:h,width:f})),new q3(k.points[M].map(function(T){return T.sub(new Ve(S.left,S.top)).div(new Ve(S.width,S.height))}),{width:S.width,height:S.height}))}),[2,u({results:j,stats:o})]}})})},t.prototype.forward=function(n,r){return r===void 0&&(r={}),Ne(this,void 0,void 0,function(){var a;return _e(this,function(s){switch(s.label){case 0:return a=this.forwardInput,[4,At(n)];case 1:return[4,a.apply(this,[s.sent(),r])];case 2:return[2,s.sent().results]}})})},t.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),Ne(this,void 0,void 0,function(){var a;return _e(this,function(s){switch(s.label){case 0:return a=this.forwardInput,[4,At(n)];case 1:return[2,a.apply(this,[s.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(n){return oD(n)},t.prototype.extractParams=function(n){return aD(n)},t}(Wr),vD=.4,xD=[new Ve(1.603231,2.094468),new Ve(6.041143,7.080126),new Ve(2.882459,3.518061),new Ve(4.266906,5.178857),new Ve(9.041765,10.66308)],yD=[117.001,114.697,97.404],bD=function(e){Ae(t,e);function t(){var n=this,r={withSeparableConvs:!0,iouThreshold:vD,classes:["face"],anchors:xD,meanRgb:yD,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=e.call(this,r)||this,n}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return Ne(this,void 0,void 0,function(){var a;return _e(this,function(s){switch(s.label){case 0:return[4,this.detect(n,r)];case 1:return a=s.sent(),[2,a.map(function(o){return new br(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(qb),Jt={ssdMobilenetv1:new Vb,tinyFaceDetector:new bD,tinyYolov2:new eD,mtcnn:new gD,faceLandmark68Net:new Ob,faceLandmark68TinyNet:new wR,faceRecognitionNet:new ER,faceExpressionNet:new iR,ageGenderNet:new vR},Kb=function(e){Ae(t,e);function t(n,r,a){var s=e.call(this)||this;return s.parentTask=n,s.input=r,s.extractedFaces=a,s}return t}(Ii),Np=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r,a=this;return _e(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),[4,Jc(n,this.input,function(o){return Ne(a,void 0,void 0,function(){return _e(this,function(l){switch(l.label){case 0:return[4,Promise.all(o.map(function(c){return Jt.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,l.sent()]}})})},this.extractedFaces)];case 2:return r=s.sent(),[2,n.map(function(o,l){return Pb(o,r[l])})]}})})},t.prototype.withAgeAndGender=function(){return new Cp(this,this.input)},t}(Kb),_p=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r;return _e(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),n?[4,yp(n,this.input,function(s){return Jt.faceExpressionNet.predictExpressions(s)},this.extractedFaces)]:[2];case 2:return r=a.sent(),[2,Pb(n,r)]}})})},t.prototype.withAgeAndGender=function(){return new Sp(this,this.input)},t}(Kb),jp=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Ep(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Dp(this,this.input)},t}(Np),kp=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Rp(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Ip(this,this.input)},t}(_p),Xb=function(e){Ae(t,e);function t(n,r,a){var s=e.call(this)||this;return s.parentTask=n,s.input=r,s.extractedFaces=a,s}return t}(Ii),Cp=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r,a=this;return _e(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),[4,Jc(n,this.input,function(o){return Ne(a,void 0,void 0,function(){return _e(this,function(l){switch(l.label){case 0:return[4,Promise.all(o.map(function(c){return Jt.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,l.sent()]}})})},this.extractedFaces)];case 2:return r=s.sent(),[2,n.map(function(o,l){var c=r[l],u=c.age,d=c.gender,h=c.genderProbability;return $b(zb(o,d,h),u)})]}})})},t.prototype.withFaceExpressions=function(){return new Np(this,this.input)},t}(Xb),Sp=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r,a,s,o;return _e(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return n=l.sent(),n?[4,yp(n,this.input,function(c){return Jt.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return r=l.sent(),a=r.age,s=r.gender,o=r.genderProbability,[2,$b(zb(n,s,o),a)]}})})},t.prototype.withFaceExpressions=function(){return new _p(this,this.input)},t}(Xb),Ep=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new jp(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Dp(this,this.input)},t}(Cp),Rp=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new kp(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Ip(this,this.input)},t}(Sp),Yb=function(e){Ae(t,e);function t(n,r){var a=e.call(this)||this;return a.parentTask=n,a.input=r,a}return t}(Ii),Dp=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r;return _e(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),[4,Jc(n,this.input,function(s){return Promise.all(s.map(function(o){return Jt.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(s){return s.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=a.sent(),[2,r.map(function(s,o){return Wb(n[o],s)})]}})})},t.prototype.withFaceExpressions=function(){return new jp(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ep(this,this.input)},t}(Yb),Ip=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r;return _e(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),n?[4,yp(n,this.input,function(s){return Jt.faceRecognitionNet.computeFaceDescriptor(s)},null,function(s){return s.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=a.sent(),[2,Wb(n,r)]}})})},t.prototype.withFaceExpressions=function(){return new kp(this,this.input)},t.prototype.withAgeAndGender=function(){return new Rp(this,this.input)},t}(Yb),Qb=function(e){Ae(t,e);function t(n,r,a){var s=e.call(this)||this;return s.parentTask=n,s.input=r,s.useTinyLandmarkNet=a,s}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Jt.faceLandmark68TinyNet:Jt.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Ii),wD=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r,a,s,o,l=this;return _e(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return n=c.sent(),r=n.map(function(u){return u.detection}),this.input instanceof at?[4,dp(this.input,r)]:[3,3];case 2:return s=c.sent(),[3,5];case 3:return[4,up(this.input,r)];case 4:s=c.sent(),c.label=5;case 5:return a=s,[4,Promise.all(a.map(function(u){return l.landmarkNet.detectLandmarks(u)}))];case 6:return o=c.sent(),a.forEach(function(u){return u instanceof at&&u.dispose()}),[2,n.map(function(u,d){return mp(u,o[d])})]}})})},t.prototype.withFaceExpressions=function(){return new jp(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ep(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Dp(this,this.input)},t}(Qb),ND=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r,a,s,o;return _e(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return n=l.sent(),n?(r=n.detection,this.input instanceof at?[4,dp(this.input,[r])]:[3,3]):[2];case 2:return s=l.sent(),[3,5];case 3:return[4,up(this.input,[r])];case 4:s=l.sent(),l.label=5;case 5:return a=s,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return o=l.sent(),a.forEach(function(c){return c instanceof at&&c.dispose()}),[2,mp(n,o)]}})})},t.prototype.withFaceExpressions=function(){return new kp(this,this.input)},t.prototype.withAgeAndGender=function(){return new Rp(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Ip(this,this.input)},t}(Qb),Jb=function(e){Ae(t,e);function t(n,r){r===void 0&&(r=new io);var a=e.call(this)||this;return a.input=n,a.options=r,a}return t}(Ii),_D=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r,a,s;return _e(this,function(o){switch(o.label){case 0:return n=this,r=n.input,a=n.options,a instanceof Ub?[4,Jt.mtcnn.forward(r,a)]:[3,2];case 1:return[2,o.sent().map(function(l){return l.detection})];case 2:if(s=a instanceof tD?function(l){return Jt.tinyFaceDetector.locateFaces(l,a)}:a instanceof io?function(l){return Jt.ssdMobilenetv1.locateFaces(l,a)}:a instanceof xp?function(l){return Jt.tinyYolov2.locateFaces(l,a)}:null,!s)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,s(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return Ne(n,void 0,void 0,function(){var a;return _e(this,function(s){switch(s.label){case 0:return[4,this.run()];case 1:return a=s.sent(),[2,r(a.map(function(o){return ip({},o)}))]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new wD(this.runAndExtendWithFaceDetections(),this.input,n)},t.prototype.withFaceExpressions=function(){return new Np(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Cp(this.runAndExtendWithFaceDetections(),this.input)},t}(Jb),jD=function(e){Ae(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return Ne(this,void 0,void 0,function(){var n,r;return _e(this,function(a){switch(a.label){case 0:return[4,new _D(this.input,this.options)];case 1:return n=a.sent(),r=n[0],n.forEach(function(s){s.score>r.score&&(r=s)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return Ne(n,void 0,void 0,function(){var a;return _e(this,function(s){switch(s.label){case 0:return[4,this.run()];case 1:return a=s.sent(),[2,r(a?ip({},a):void 0)]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new ND(this.runAndExtendWithFaceDetection(),this.input,n)},t.prototype.withFaceExpressions=function(){return new _p(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Sp(this.runAndExtendWithFaceDetection(),this.input)},t}(Jb);function Zb(e,t){return t===void 0&&(t=new io),new jD(e,t)}function kD(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(a,s){return a-r[s]}).reduce(function(a,s){return a+Math.pow(s,2)},0))}(function(){function e(t,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,s=function(){return"person "+a++};this._labeledDescriptors=r.map(function(o){if(o instanceof al)return o;if(o instanceof Float32Array)return new al(s(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new al(s(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(t,n){return n.map(function(r){return kD(r,t)}).reduce(function(r,a){return r+a},0)/(n.length||1)},e.prototype.matchDescriptor=function(t){var n=this;return this.labeledDescriptors.map(function(r){var a=r.descriptors,s=r.label;return new Zg(s,n.computeMeanDistance(t,a))}).reduce(function(r,a){return r.distance<a.distance?r:a})},e.prototype.findBestMatch=function(t){var n=this.matchDescriptor(t);return n.distance<this.distanceThreshold?n:new Zg("unknown",n.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(r){return al.fromJSON(r)});return new e(n,t.distanceThreshold)},e})();class CD{constructor(){this.isLoaded=!1,this.loadingPromise=null}async loadModels(){return this.isLoaded?!0:this.loadingPromise?this.loadingPromise:(this.loadingPromise=(async()=>{try{return console.log("FaceModelService: Starting parallel model loading..."),await Promise.all([Jt.ssdMobilenetv1.loadFromUri("/models"),Jt.faceLandmark68Net.loadFromUri("/models"),Jt.faceRecognitionNet.loadFromUri("/models")]),this.isLoaded=!0,this.loadingPromise=null,console.log("FaceModelService: Models loaded successfully"),!0}catch(t){throw console.error("FaceModelService: Failed to load models:",t),this.loadingPromise=null,t}})(),this.loadingPromise)}}const Ap=new CD,Bo=e=>e.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),SD=e=>{const t=e.time||e.timestamp||e.created_at||e.createdAt||e.date;if(!t)return e;let n;return/^\d{1,2}:\d{2}$/.test(t)?n=new Date("2000-01-01T".concat(t)):n=new Date(t),isNaN(n.getTime())?e:{...e,time:Bo(n)}},ED=()=>i.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx("div",{className:"w-6 h-6 border-4 border-white border-t-transparent rounded-full animate-spin"}),i.jsx("span",{className:"text-white text-lg font-medium",children:"Loading..."})]}),kl=[],$t=e=>{const t=document.createElement("div");t.innerText="[".concat(Bo(new Date),"] ").concat(e),kl.unshift(t),kl.length>10&&kl.pop(),RD()},RD=()=>{const e=document.getElementById("attendance-notifications");e&&(e.innerHTML="",kl.forEach(t=>e.appendChild(t)))},sv=({registerCleanup:e})=>{Zn();const[t,n]=E.useState(!1),[r,a]=E.useState("ready"),[s,o]=E.useState(null),[l,c]=E.useState(null),[u,d]=E.useState(!1),[h,f]=E.useState(15),[p,m]=E.useState([]),[x,y]=E.useState(null),g=E.useRef(null),v=E.useRef(null),w=E.useRef(null),b=E.useRef(!1);E.useEffect(()=>{if(b.current)return;b.current=!0,localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("isAuthenticated");const j=async()=>{try{await Ap.loadModels(),d(!0);try{const S=await navigator.mediaDevices.getUserMedia({video:!0});w.current=S}catch(S){console.error("Failed to pre-acquire camera stream:",S)}}catch(S){console.error("Failed to load face-api models:",S),$t("Failed to load face recognition models")}},C=async()=>{try{const M=(await ke.getLiveActivity()).map(T=>SD(T));m(M)}catch(S){console.error("Failed to fetch live activity:",S)}};return j(),C(),e&&e(()=>{w.current&&(w.current.getTracks().forEach(S=>S.stop()),w.current=null)}),()=>{w.current&&(w.current.getTracks().forEach(S=>S.stop()),w.current=null)}},[e]);const N=async()=>{if(w.current&&g.current)g.current.srcObject=w.current;else try{const j=await navigator.mediaDevices.getUserMedia({video:!0});g.current.srcObject=j,w.current=j}catch(j){console.error("Camera error:",j),a("Camera access denied")}},_=()=>{g.current&&(g.current.srcObject=null,g.current.pause(),g.current.load())},k=async()=>{if(!u){a("Models not loaded yet"),$t("Models not loaded yet");return}n(!0),a("analyzing"),o(null),f(15),$t("Starting face scan..."),await N();let j=!1,C=!1,S=!1,M=!1,T=null,A=null,L=null;L=setInterval(()=>{f(z=>{const F=Math.max(0,z-1);return F===0&&(clearInterval(L),C||(C=!0,clearInterval(A),n(!1),a("Face not recognized"),_(),setTimeout(()=>{a("ready")},2e3))),F})},1e3);let O=!1;const U=async()=>{if(!(j||C||O))try{$t("Detecting face...");const z=await Zb(g.current,new io({minConfidence:.5})).withFaceLandmarks().withFaceDescriptor();if(z){$t("Face detected, extracting features...");const F=Array.from(z.descriptor);$t("Recognizing face..."),O=!0;const W=await ke.recognizeFace(F,.4);if(W.match&&!S&&!M){j=!0,C=!0,S=!0,M=!0,clearInterval(L),A&&clearInterval(A),T&&clearTimeout(T),n(!1),f(0),_(),o({...W}),a("Face recognized"),$t("Recognized ".concat(W.employee_name," (ID: ").concat(W.employee_id,")"));try{const I=await ke.markAttendance(W.employee_id);console.log("markAttendance response:",I);const q=new Date;c(q),$t("Attendance marked successfully!"),o(ce=>{var me,je;return{...ce,department:(je=(me=I==null?void 0:I.attendance)==null?void 0:me.employee)==null?void 0:je.department}}),a("Attendance marked successfully!");let K="Check-In";I.message&&I.message.includes("Break start")?K="Break Start":I.message&&I.message.includes("Break end")?K="Break End":I.message&&I.message.includes("Check-out")?K="Check-Out":I.message&&I.message.includes("Check-in")&&(K="Check-In"),y(K);const re=Bo(q),ie={name:W.employee_name,action:K,time:re,employee_id:W.employee_id};m(ce=>[ie,...ce.slice(0,19)]),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}catch(I){console.log("Attendance marking error response:",I.response);const q=I.response;if(q&&q.status===403&&q.data&&typeof q.data.message=="string"){const K=q.data.message.toLowerCase();if(K.includes("inactive employee")||K.includes("inactive employees")||K.includes("inactive")&&K.includes("not allowed"))c(new Date),a("Inactive employees cannot mark attendance"),$t("Inactive employees cannot mark attendance"),setTimeout(()=>{a("ready"),o(null),c(null)},2e3);else if(I.message&&I.message.includes("already marked")){const re=new Date;c(re),a("Attendance marked successfully!"),$t("Attendance already marked for today");const ie=Bo(re),ce={name:W.employee_name,action:"Already Checked-In",time:ie,employee_id:W.employee_id};m(me=>[ce,...me.slice(0,19)]),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}else console.error("Attendance marking error:",I),a("Face recognized but attendance marking failed"),$t("Face recognized but attendance marking failed"),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}else if(I.message&&I.message.includes("already marked")){const K=new Date;c(K),a("Attendance marked successfully!"),$t("Attendance already marked for today");const re=Bo(K),ie={name:W.employee_name,action:"Already Checked-In",time:re,employee_id:W.employee_id};m(ce=>[ie,...ce.slice(0,19)]),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}else console.error("Attendance marking error:",I),a("Face recognized but attendance marking failed"),$t("Face recognized but attendance marking failed"),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}finally{M=!1}}else W.match||$t("Face detected but not recognized, trying again...")}else $t("No face detected, trying again...")}catch(z){console.error("Recognition error:",z),$t("Recognition attempt failed: "+z.message)}finally{O=!1}};A=setInterval(U,2e3),await U(),T=setTimeout(()=>{C||(C=!0,clearInterval(L),clearInterval(A),n(!1),a("Face not recognized"),_(),setTimeout(()=>{a("ready")},2e3))},15e3)};return i.jsxs("div",{className:"min-h-screen w-full overflow-x-hidden bg-gradient-to-br from-slate-900 to-slate-800 flex flex-col",children:[i.jsx("style",{children:"\n          .custom-scrollbar::-webkit-scrollbar {\n            width: 2px;\n          }\n          .custom-scrollbar::-webkit-scrollbar-thumb {\n            background: rgba(255, 255, 255, 0.15);\n            border-radius: 1px;\n          }\n          .custom-scrollbar::-webkit-scrollbar-track {\n            background: transparent.\n          }\n          .custom-scrollbar::-webkit-scrollbar-thumb:hover {\n            background: rgba(255, 255, 255, 0.25);\n          }\n        "}),i.jsx(F0,{}),i.jsxs("main",{className:"flex-1 flex flex-col lg:flex-row gap-4 md:gap-6 p-4 md:p-8 max-w-7xl mx-auto w-full overflow-x-hidden",children:[i.jsxs("div",{className:"flex-1 flex flex-col",children:[i.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border-2 border-white/20 overflow-hidden flex-1 flex flex-col",children:[i.jsxs("div",{className:"bg-slate-800 relative flex flex-col flex-1 pt-3 pb-5",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-500/20"}),i.jsxs("div",{className:"flex justify-between p-4 z-20",children:[i.jsx("div",{className:"px-4 py-2 rounded-full text-sm font-medium text-white ".concat(r==="success"||r.includes("successfully")?"bg-green-600":r==="Face not recognized"||r==="No face detected"||r.includes("failed")?"bg-red-600":"bg-black/50"),children:r==="ready"?"Ready":r}),i.jsx("div",{className:"bg-red-500 w-3 h-3 rounded-full animate-pulse"})]}),i.jsx("div",{className:"flex-1 relative z-10 text-center px-4 flex items-center justify-center",children:u?r==="Attendance marked successfully!"&&s&&l?i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:[i.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[i.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",children:i.jsx(Qt,{className:"w-12 h-12 text-green-500"})}),i.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:i.jsx("span",{className:"text-2xl font-bold text-white",children:s.employee_name.split(" ").map(j=>j[0]).join("")})}),i.jsxs("div",{className:"text-center space-y-1",children:[i.jsx("h2",{className:"text-white text-xl font-semibold",children:s.employee_name}),i.jsxs("p",{className:"text-gray-300 text-sm",children:["ID: ",s.employee_id]}),(s==null?void 0:s.department)&&i.jsx("p",{className:"text-gray-400 text-xs",children:s.department})]})]}),i.jsxs("button",{className:"px-6 py-3 bg-green-500 hover:bg-green-600 transition-colors text-white font-semibold rounded-full text-sm",children:[x||"Check-In"," Successful"]})]}):r==="Face not recognized"?i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:[i.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[i.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",children:i.jsx(ao,{className:"w-14 h-14 text-red-500"})}),i.jsxs("div",{className:"text-center space-y-1",children:[i.jsx("h2",{className:"text-white text-xl font-semibold",children:"Face Not Recognized"}),i.jsx("p",{className:"text-gray-300 text-sm",children:"Please try again or contact support"})]})]}),i.jsx("button",{className:"px-6 py-3 bg-red-500 hover:bg-red-600 transition-colors text-white font-semibold rounded-full text-sm",children:"Try Again"})]}):r==="Inactive employees cannot mark attendance"?i.jsx("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:i.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[i.jsx("div",{className:"w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center",children:i.jsx(Dt,{className:"w-8 h-8 text-white"})}),i.jsxs("div",{className:"text-center space-y-1",children:[i.jsx("h2",{className:"text-white text-xl font-semibold",children:"Attendance Denied"}),i.jsx("p",{className:"text-gray-300 text-sm",children:"Inactive employees are not allowed to mark attendance."})]})]})}):t?i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2 w-full",children:[i.jsx("div",{className:"w-full flex justify-center px-2",children:i.jsxs("div",{className:"\r\n                          relative\r\n                          w-full\r\n                          max-w-xs\r\n                          sm:max-w-sm\r\n                          md:max-w-md\r\n                          h-64\r\n                          md:h-72\r\n                          lg:h-80\r\n                          rounded-xl\r\n                          border-4 border-blue-400/40\r\n                          overflow-hidden\r\n                          bg-black\r\n                          mx-auto\r\n                        ",children:[i.jsx("video",{ref:g,autoPlay:!0,muted:!0,playsInline:!0,className:"\r\n                            absolute\r\n                            inset-0\r\n                            w-full\r\n                            h-full\r\n                            object-cover\r\n                          ",style:{transform:"scaleX(1)"}}),i.jsx("canvas",{ref:v,className:"\r\n                            absolute\r\n                            inset-0\r\n                            w-full\r\n                            h-full\r\n                            pointer-events-none\r\n                          ",style:{transform:"scaleX(1)"}})]})}),i.jsx("div",{className:"flex flex-col items-center space-y-1 mt-4",children:i.jsxs("div",{className:"text-center px-4",children:[i.jsxs("p",{className:"text-lg text-white font-medium",children:["Analyzing face... (",h,"s)"]}),i.jsx("p",{className:"text-sm text-gray-400",children:"Please keep your face in the frame"})]})}),s&&i.jsxs("div",{className:"p-4 rounded-lg border border-green-500/30 max-w-sm w-full",children:[i.jsxs("div",{className:"flex items-center gap-2 text-green-400 mb-2",children:[i.jsx(Qt,{className:"w-5 h-5"}),i.jsx("span",{className:"font-medium",children:"Recognized!"})]}),i.jsx("p",{className:"text-white font-medium",children:s.employee_name}),i.jsxs("p",{className:"text-gray-300 text-sm",children:["Employee ID: ",s.employee_id]})]})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 mb-4",children:[i.jsx(ks,{className:"w-16 h-16 text-white/70"}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-lg text-white font-medium mb-1",children:"Position your face in the frame"}),i.jsx("p",{className:"text-sm text-gray-400",children:"Camera is active and scanning"})]})]}):i.jsx(ED,{})})]}),i.jsx("div",{className:"p-4 md:p-6 text-center",children:i.jsx("button",{onClick:k,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 md:px-8 py-2 md:py-3 rounded-lg font-semibold transition-colors text-sm md:text-base ".concat(u?"":"opacity-50 cursor-not-allowed"),disabled:!u,children:"Simulate Face Recognition"})})]}),i.jsx("div",{className:"w-full lg:w-96 flex flex-col gap-4 md:gap-6"})]}),i.jsxs("div",{className:"w-full lg:w-96 flex flex-col gap-4 md:gap-6",children:[i.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border border-white/20 p-6",children:[i.jsxs("h2",{className:"text-white text-lg font-semibold mb-4 flex items-center gap-2",children:[i.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Recent Activity"]}),i.jsxs("div",{className:"space-y-3 h-60 overflow-y-auto scrollbar-w-1 scrollbar-thumb-white/20 scrollbar-track-transparent",children:[p.map((j,C)=>i.jsxs("div",{className:"bg-white/5 rounded-lg p-3 flex items-center gap-3 hover:bg-white/10 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:j.name.split(" ").map(S=>S[0]).join("")}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-white text-sm font-medium truncate",children:j.name}),i.jsx("p",{className:"text-slate-400 text-xs",children:j.action})]}),i.jsx("div",{className:"text-slate-300 text-xs",children:j.time})]},C)),p.length===0&&i.jsx("div",{className:"text-center text-gray-400 text-sm py-8",children:"No recent activities yet"})]})]}),i.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border border-white/20 p-6",children:[i.jsx("h3",{className:"text-white text-lg font-semibold mb-4",children:"Instructions"}),i.jsxs("ul",{className:"space-y-3 text-slate-300 text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-400 font-bold",children:"1."})," Stand 2-3 feet away from the screen"]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-400 font-bold",children:"2."})," Look directly at the camera"]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-400 font-bold",children:"3."})," Wait for automatic recognition"]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-400 font-bold",children:"4."})," Confirmation will appear on screen"]})]})]})]})]}),i.jsx(M0,{})]})},td=e=>{if(!e)return"N/A";const t=new Date(e);if(!isNaN(t.getTime()))return t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});const n=e.split(":");if(n.length<2)return e;const r=parseInt(n[0],10),a=parseInt(n[1],10);if(isNaN(r)||isNaN(a))return e;const s=r>=12?"PM":"AM",o=r%12===0?12:r%12,l=String(o).padStart(2,"0"),c=String(a).padStart(2,"0");return"".concat(l,":").concat(c," ").concat(s)},ov=e=>{if(e==null)return"N/A";const t=Math.abs(Number(e));if(Number.isNaN(t))return"N/A";const n=Math.floor(t/60),r=t%60,a=[];return n>0&&a.push("".concat(n," hr").concat(n>1?"s":"")),r>0&&a.push("".concat(r," min").concat(r>1?"s":"")),a.length===0?"0 mins":a.join(" ")},e1=e=>{if(!e||typeof e!="object")return null;for(const[t,n]of Object.entries(e)){const r=t.toLowerCase();if(typeof n=="string"&&n.trim()!==""&&(r.includes("email")||r.includes("mail")))return n;if(n&&typeof n=="object"){const a=e1(n);if(a)return a}}return null},DD=e=>{var r,a,s,o,l,c,u,d;const t=e.email||e.mail||e.employee_email||e.employee_mail||e.work_email||e.work_mail||e.office_email||e.office_mail||((r=e.employee)==null?void 0:r.email)||((a=e.employee)==null?void 0:a.mail)||((s=e.employee)==null?void 0:s.work_email)||((o=e.employee)==null?void 0:o.work_mail)||((l=e.employee)==null?void 0:l.official_email)||((c=e.employee)==null?void 0:c.official_mail)||((u=e.user)==null?void 0:u.email)||((d=e.user)==null?void 0:d.mail);return t&&t.trim()!==""?t:e1(e)||"N/A"},ID=({isOpen:e,onClose:t,statType:n,statValue:r})=>{const[a,s]=E.useState([]),[o,l]=E.useState(!1),[c,u]=E.useState(null);E.useEffect(()=>{e&&n&&d()},[e,n]);const d=async()=>{l(!0),u(null);try{let p;switch(n){case"total_employees":p=await ke.getEmployees();break;case"present_today":p=await ke.getPresentToday();break;case"absent_today":p=await ke.getAbsentToday();break;case"on_leave":p=await ke.getOnLeaveToday();break;case"late_arrivals":p=await ke.getLateArrivalsToday();break;case"early_departures":p=await ke.getEarlyDeparturesToday();break;default:p=[]}s(p)}catch(p){u(p.message||"Failed to load data")}finally{l(!1)}},h=()=>{switch(n){case"total_employees":return"All Employees";case"present_today":return"Employees Present Today";case"absent_today":return"Employees Absent Today";case"on_leave":return"Employees On Leave";case"late_arrivals":return"Late Arrivals Today";case"early_departures":return"Early Departures Today";default:return"Details"}},f=p=>p?p.split(" ").filter(Boolean).map(m=>m[0]).join("").toUpperCase():"N/A";return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 md:p-6 flex items-center justify-between z-10 rounded-t-2xl",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:h()}),i.jsxs("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:[r," records"]})]}),i.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(kn,{className:"w-6 h-6"})})]}),i.jsxs("div",{className:"flex-1 p-4 md:p-6 overflow-y-auto",children:[o&&i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),i.jsx("p",{className:"text-gray-600",children:"Loading..."})]}),c&&i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-red-600",children:c})}),!o&&!c&&a.length===0&&i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-gray-500",children:"No data available"})}),!o&&!c&&a.length>0&&i.jsx("div",{className:"space-y-3",children:a.map((p,m)=>{var L,O,U,z,F,W,I,q,K,re,ie,ce;const x=p.name||((L=p.employee)==null?void 0:L.name)||"Employee ".concat(p.employee_id||p.id),y=p.department||((O=p.employee)==null?void 0:O.department)||"N/A",g=DD(p),v=p.phone||((U=p.employee)==null?void 0:U.phone)||((z=p.user)==null?void 0:z.phone)||"N/A",w=p.check_in_time||((F=p.employee)==null?void 0:F.check_in_time),b=p.check_out_time||((W=p.employee)==null?void 0:W.check_out_time),N=(K=(q=p.early_minutes)!=null?q:(I=p.employee)==null?void 0:I.early_minutes)!=null?K:null,_=(ce=(ie=p.late_minutes)!=null?ie:(re=p.employee)==null?void 0:re.late_minutes)!=null?ce:null,k=p.leave_type||p.leave_reason||p.type||"On Leave",j=p.leave_days||p.duration_days||p.days||null,C=p.reason||p.absence_reason||"No show",M=(p.employment_status||p.status||"").toLowerCase();let T="Active",A="bg-green-100 text-green-700";return M.includes("leave")?(T="On Leave",A="bg-blue-100 text-blue-700"):M.includes("inactive")||M.includes("not_active")||M.includes("terminated")?(T="Not Active",A="bg-gray-200 text-gray-700"):M===""&&(T="Active",A="bg-green-100 text-green-700"),n==="present_today"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:v})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Qe,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Check-in: ",td(w)]})]})]})]})})},m):n==="early_departures"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Qe,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Check-out: ",td(b)]})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-purple-600",children:[i.jsx(Dt,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Early by:"," ",ov(N)]})]})]})]})})},m):n==="on_leave"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-blue-600",children:[i.jsx(I_,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:[k,j!=null?" (".concat(j," day").concat(j===1?"":"s",")"):""]})]})]})]})})},m):n==="late_arrivals"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Qe,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Check-in: ",td(w)]})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600",children:[i.jsx(Dt,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Late by:"," ",ov(_)]})]})]})]})})},m):n==="absent_today"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:v})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600",children:[i.jsx(Dt,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Reason: ",C]})]})]})]})})},m):n==="total_employees"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:v})]}),i.jsx("div",{className:"flex items-center gap-2 text-xs",children:i.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(A),children:T})})]})]})})},m):i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:v})]})]})]})})},m)})})]}),i.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 p-4 md:p-6 flex justify-end gap-3 rounded-b-2xl",children:[i.jsx("button",{onClick:()=>window.location.href="/employees",className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-100 transition-colors",children:"Manage Employees"}),i.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Close"})]})]})}):null},AD=()=>{const e=Zn(),[t,n]=E.useState(!0),[r,a]=E.useState(null),[s,o]=E.useState({total_employees:0,present_today:0,absent_today:0,on_leave:0,late_arrivals:0,early_departures:0,changes:{present:0,absent:0,on_leave:0,late_arrivals:0,early_departures:0}}),[l,c]=E.useState([]),[u,d]=E.useState({average_check_in:"00:00",average_work_hours:0,punctuality_rate:0}),[h,f]=E.useState([]),[p,m]=E.useState(0),[x,y]=E.useState({isOpen:!1,statType:null,statValue:0});E.useEffect(()=>{const C=async()=>{n(!0),a(null);try{const M=await ke.getDashboardData();o(M.stats),c(M.departments),d(M.trends),f(M.live_activity)}catch(M){console.error("Error fetching dashboard data:",M),a(M.message||"Failed to load dashboard data")}finally{n(!1)}};C();const S=setInterval(()=>{C()},6e4);return()=>clearInterval(S)},[p]);const[g,v]=E.useState(new Date);E.useEffect(()=>{const C=setInterval(()=>{v(new Date)},1e3);return()=>clearInterval(C)},[]);const w=()=>g.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),b=()=>g.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),N=C=>{if(!C)return"";try{return new Date("2000-01-01T".concat(C)).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(S){return C}},_=C=>C==="Check-In"?"bg-green-100 text-green-700":C==="Re-Check-In"?"bg-blue-100 text-blue-700":C==="Check-Out"?"bg-gray-100 text-gray-700":C==="Early Departure"?"bg-orange-100 text-orange-700":C==="Break Start"?"bg-yellow-100 text-yellow-700":C==="Break End"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700",k=(C,S)=>{y({isOpen:!0,statType:C,statValue:S})},j=()=>{y({isOpen:!1,statType:null,statValue:0})};return i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Real-time attendance monitoring"})]}),i.jsxs("div",{className:"text-left md:text-right",children:[i.jsx("div",{className:"text-xl md:text-2xl font-bold text-gray-900",children:w()}),i.jsx("div",{className:"text-xs md:text-sm text-gray-600",children:b()})]})]}),r&&i.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[i.jsx("p",{className:"text-red-600",children:r}),i.jsx("button",{onClick:()=>m(C=>C+1),className:"mt-2 text-sm text-red-600 hover:text-red-700",children:"Try again"})]}),t&&i.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),i.jsx("p",{className:"text-gray-600",children:"Loading dashboard data..."})]})}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:[i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>k("total_employees",s.total_employees),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Employees"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.total_employees}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current Count"})})]}),i.jsx("div",{className:"bg-blue-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(ci,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>k("present_today",s.present_today),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Present Today"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.present_today}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:"text-xs font-medium ".concat(s.changes.present>=0?"text-green-600":"text-red-600"),children:[s.changes.present>0?"+":"",s.changes.present," from yesterday"]})})]}),i.jsx("div",{className:"bg-green-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-user-check text-white",children:[i.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),i.jsx("circle",{cx:"9",cy:"7",r:"4"}),i.jsx("polyline",{points:"16 11 18 13 22 9"})]})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>k("absent_today",s.absent_today),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Absent"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.absent_today}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:"text-xs font-medium ".concat(s.changes.absent<=0?"text-green-600":"text-red-600"),children:[s.changes.absent>0?"+":"",s.changes.absent," from yesterday"]})})]}),i.jsx("div",{className:"bg-red-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-user-x text-white",children:[i.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),i.jsx("circle",{cx:"9",cy:"7",r:"4"}),i.jsx("line",{x1:"17",x2:"22",y1:"8",y2:"13"}),i.jsx("line",{x1:"22",x2:"17",y1:"8",y2:"13"})]})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>k("on_leave",s.on_leave),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"On Leave"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.on_leave}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:"text-xs font-medium ".concat(s.changes.on_leave>=0?"text-green-600":"text-red-600"),children:[s.changes.on_leave>0?"+":"",s.changes.on_leave," from yesterday"]})})]}),i.jsx("div",{className:"bg-yellow-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx("div",{className:"bg-yellow-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-activity text-white",children:i.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>k("late_arrivals",s.late_arrivals),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Late Arrivals"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.late_arrivals}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:"text-xs font-medium ".concat(s.changes.late_arrivals>=0?"text-green-600":"text-red-600"),children:[s.changes.late_arrivals>0?"+":"",s.changes.late_arrivals," from yesterday"]})})]}),i.jsx("div",{className:"bg-orange-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Qe,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>k("early_departures",s.early_departures),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Early Departures"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.early_departures}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:"text-xs font-medium ".concat(s.changes.early_departures<=0?"text-green-600":"text-red-600"),children:[s.changes.early_departures>0?"+":"",s.changes.early_departures," from yesterday"]})})]}),i.jsx("div",{className:"bg-purple-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Dt,{className:"w-6 h-6 text-white"})})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:[i.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),"Live Activity Feed"]}),i.jsx("button",{onClick:()=>e("/reports"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),i.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:h.map((C,S)=>i.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:C.name.split(" ").map(M=>M[0]).join("").toUpperCase()}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:C.name}),i.jsxs("p",{className:"text-xs text-gray-500",children:[N(C.time)," "]})]}),i.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(_(C.action)),children:C.action})]},S))})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Department Attendance"}),i.jsx("div",{className:"space-y-4",children:l.map((C,S)=>i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700",children:C.department}),i.jsxs("span",{className:"text-sm text-gray-600",children:[C.present,"/",C.total]})]}),i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:i.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all",style:{width:"".concat(C.percentage,"%")}})}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[C.percentage,"% present"]})]},S))})]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Attendance Trends"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Average Check-in Time"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.average_check_in&&u.average_check_in!=="00:00:00"?new Date("2000-01-01T".concat(u.average_check_in)).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"No Data"})]}),i.jsx(nh,{className:"w-8 h-8 text-green-500"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Average Work Hours"}),i.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[typeof u.average_work_hours=="number"&&!isNaN(u.average_work_hours)?u.average_work_hours.toFixed(1):"0.0"," hrs"]})]}),i.jsx(Qe,{className:"w-8 h-8 text-blue-500"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Punctuality Rate"}),i.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[u.punctuality_rate,"%"]})]}),i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-activity text-purple-500",children:i.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Quick Actions"}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("button",{onClick:()=>e("/employees"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left",children:[i.jsx(ci,{className:"w-6 h-6 text-blue-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Manage Employees"})]}),i.jsxs("button",{onClick:()=>e("/reports"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-left",children:[i.jsx(nh,{className:"w-6 h-6 text-green-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"View Reports"})]}),i.jsxs("button",{onClick:()=>e("/policies"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-colors text-left",children:[i.jsx(Qe,{className:"w-6 h-6 text-purple-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Manage Policies"})]}),i.jsxs("button",{onClick:()=>k("late_arrivals",s.late_arrivals),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-colors text-left",children:[i.jsx(Dt,{className:"w-6 h-6 text-orange-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"View Alerts"})]})]})]})]}),x.isOpen&&i.jsx(ID,{isOpen:x.isOpen,onClose:j,statType:x.statType,statValue:x.statValue})]})})};function TD(){const e=Zn(),t=new Date,[n,r]=E.useState(null),[a,s]=E.useState(t.getFullYear()),[o,l]=E.useState(t.getMonth()),[c,u]=E.useState([]),[d,h]=E.useState(1),f=5,[p,m]=E.useState(!1),[x,y]=E.useState(null),[g,v]=E.useState({}),[w,b]=E.useState("monthly"),[N,_]=E.useState(""),[k,j]=E.useState(""),[C,S]=E.useState(!1),[M,T]=E.useState(null),[A,L]=E.useState(!1),[O,U]=E.useState(!1),[z,F]=E.useState(""),[W,I]=E.useState([]),[q,K]=E.useState([]),re=()=>{o===0?(l(11),s(a-1)):l(o-1)},ie=()=>{o===11?(l(0),s(a+1)):l(o+1)},ce=new Date(a,o,1),me=ce.toLocaleDateString("en-US",{month:"long",year:"numeric"}),je=new Date(a,o+1,0).getDate(),G=new Date(a,o,1).getDay(),se=J=>{const H=J.getFullYear(),ee=String(J.getMonth()+1).padStart(2,"0"),he=String(J.getDate()).padStart(2,"0");return"".concat(H,"-").concat(ee,"-").concat(he)},Ce=(J,H,ee)=>"".concat(J,"-").concat(String(H+1).padStart(2,"0"),"-").concat(String(ee).padStart(2,"0"));function R(J){switch(J){case"Present":return"bg-green-500 text-white";case"Late Arrival":return"bg-purple-500 text-white";case"Absent":return"bg-red-500 text-white";case"Holiday":return"bg-blue-500 text-white";case"On Leave":return"bg-orange-500 text-white";case"Early Departure":return"bg-pink-500 text-white";case"Half Day":return"bg-yellow-500 text-white";default:return""}}const Y=async()=>{var J;try{const H=await ke.getEmployees();u(H||[]);const ee=[...new Set((H||[]).map(he=>he.department).filter(Boolean))];I(ee),K(H||[]),H&&H.length>0&&!n&&r(H[0].employee_id)}catch(H){((J=H==null?void 0:H.response)==null?void 0:J.status)===401&&e("/login"),y("Failed to fetch employees")}},ne=async()=>{var J;if(n){m(!0),y(null);try{const H=ce.getFullYear(),ee=ce.getMonth()+1,he=await ke.getEmployeeMonthlyAttendance(n,H,ee),$e={};(he||[]).forEach(Pe=>{const nt=Pe.date;$e[nt]={status:Pe.status,checkIn:Pe.check_in?new Date(Pe.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",checkOut:Pe.check_out?new Date(Pe.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",totalHours:Pe.total_hours||"-",breaks:Pe.breaks||[],holiday:Pe.holiday||null,leaveReason:Pe.leave_reason||null}}),v($e)}catch(H){console.error(H),((J=H==null?void 0:H.response)==null?void 0:J.status)===401&&e("/login"),y("Failed to fetch attendance records")}finally{m(!1)}}};E.useEffect(()=>{Y()},[]),E.useEffect(()=>{ne()},[n,a,o]),E.useEffect(()=>{const J=setInterval(()=>{n&&ne()},3e4);return()=>clearInterval(J)},[n,a,o]),E.useEffect(()=>{const J=M?c.filter(H=>H.department===M):c;K(J),n&&!J.some(H=>H.employee_id===n)&&r(J.length>0?J[0].employee_id:null)},[M,c]);const fe=()=>{L(!1)},Se=()=>{T(null),L(!1)},le=(()=>{const J=[],H=ce.getFullYear(),ee=ce.getMonth();se(new Date);for(let he=0;he<G;he++)J.push(null);for(let he=1;he<=je;he++){const $e=Ce(H,ee,he),Pe=new Date(H,ee,he),nt=se(Pe);let mt=g[$e];if(!mt){const nn=new Date(t);nn.setDate(nn.getDate()-1);const wr=se(nn),Dn=Pe.getDay();nt<=wr&&n&&Dn!==0&&Dn!==6&&(mt={status:"Absent",checkIn:"-",checkOut:"-",totalHours:"-",holiday:null})}J.push({day:he,key:$e,rec:mt,date:Pe})}return J})(),ve=le.filter(Boolean).filter(J=>J.rec).map(J=>({date:J.key,...J.rec})).sort((J,H)=>J.date<H.date?1:-1),ue=p?Array(f).fill({skeleton:!0}):ve.slice((d-1)*f,d*f),Ee=Math.max(1,Math.ceil(ve.length/f)),De=async()=>{var J;if(n){if(w==="custom"&&(!N||!k)){y("Please select both start and end dates for custom range");return}if(w==="custom"&&new Date(N)>new Date(k)){y("Start date cannot be after end date");return}try{let H,ee;const he=ce.getFullYear(),$e=ce.getMonth()+1;if(w==="daily"){const mt=new Date().toISOString().split("T")[0];H=await ke.exportEmployeeDailyAttendance(n,mt),ee="attendance-daily-".concat(n,"-").concat(mt,".csv")}else w==="monthly"?(H=await ke.exportEmployeeMonthlyAttendance(n,he,$e),ee="attendance-monthly-".concat(n,"-").concat(he,"-").concat($e,".csv")):w==="custom"&&(H=await ke.exportEmployeeCustomRangeAttendance(n,N,k),ee="attendance-custom-".concat(n,"-").concat(N,"-to-").concat(k,".csv"));const Pe=window.URL.createObjectURL(H),nt=document.createElement("a");nt.href=Pe,nt.download=ee,document.body.appendChild(nt),nt.click(),window.URL.revokeObjectURL(Pe),document.body.removeChild(nt),S(!1)}catch(H){((J=H==null?void 0:H.response)==null?void 0:J.status)===401&&e("/login"),y("Failed to download attendance records")}}},We=async()=>{var J;if(!n||!z){y("Please select an employee and enter an email address");return}if(w==="custom"&&(!N||!k)){y("Please select both start and end dates for custom range");return}if(w==="custom"&&new Date(N)>new Date(k)){y("Start date cannot be after end date");return}try{const H=ce.getFullYear(),ee=ce.getMonth()+1;await ke.emailEmployeeAttendanceReport(n,z,w,H,ee,N,k),U(!1),F(""),y(null)}catch(H){((J=H==null?void 0:H.response)==null?void 0:J.status)===401&&e("/login"),y("Failed to send email report")}};return i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"p-3 space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Attendance Calendar"}),i.jsx("p",{className:"text-md text-gray-500",children:"View attendance records"})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("button",{onClick:()=>L(!0),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors flex items-center gap-2",children:[i.jsx(Sf,{className:"w-5 h-5"}),"Filter"]}),i.jsxs("button",{onClick:()=>U(!0),disabled:p||!n,className:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md shadow hover:bg-green-700 disabled:opacity-60 disabled:cursor-not-allowed",children:[i.jsx(Vn,{className:"w-4 h-4"}),"Email Report"]}),i.jsxs("button",{onClick:()=>S(!0),disabled:p||!n,className:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md shadow hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",children:[i.jsx(si,{className:"w-4 h-4"}),"Export"]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[i.jsxs("div",{className:"flex-1 max-w-xs",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee"}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",value:n||"",onChange:J=>r(J.target.value),disabled:p,children:q.map(J=>i.jsx("option",{value:J.employee_id,children:J.name},J.employee_id))}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:re,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(A0,{className:"w-5 h-5"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:me}),i.jsx("button",{onClick:ie,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Cf,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"flex-1"})]}),x&&i.jsx("div",{className:"text-rose-500 text-sm",children:x}),i.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2 mb-2",children:[i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sun"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Mon"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Tue"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Wed"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Thu"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Fri"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sat"})]}),i.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2",children:[le.slice(0,G).map((J,H)=>i.jsx("div",{className:"aspect-square"},"lead-".concat(H))),le.slice(G).map((J,H)=>{var Pe,nt;const ee=(Pe=J.rec)==null?void 0:Pe.status,he=R(ee),$e=new Date(J.key).getDay()===0||new Date(J.key).getDay()===6;return i.jsx("div",{className:"aspect-square border-2 rounded-lg p-2 cursor-pointer transition-all hover:shadow-md ".concat(ee?he:$e?"bg-gray-100 border-gray-200":"bg-white border-gray-200"),children:i.jsxs("div",{className:"h-full flex flex-col",children:[i.jsx("span",{className:"text-sm font-semibold mb-1 ".concat(ee?"text-white":"text-gray-700"),children:J.day}),i.jsx("div",{className:"flex-1 flex flex-col justify-center text-xs",children:J.rec?i.jsx(i.Fragment,{children:ee==="Holiday"?i.jsx("span",{className:"font-medium ".concat(ee?"text-white":"text-gray-700"),children:((nt=J.rec.holiday)==null?void 0:nt.name)||"Holiday"}):ee==="On Leave"?i.jsx("span",{className:"font-medium ".concat(ee?"text-white":"text-gray-700"),children:J.rec.leaveReason||"On Leave"}):ee==="Present"||ee==="Late Arrival"||ee==="Early Departure"||ee==="Half Day"?i.jsxs(i.Fragment,{children:[i.jsxs("span",{className:"".concat(ee?"text-white":"text-gray-700"),children:["In: ",J.rec.checkIn]}),i.jsxs("span",{className:"".concat(ee?"text-white":"text-gray-700"),children:["Out: ",J.rec.checkOut]})]}):i.jsx("span",{children:""})}):i.jsx("span",{children:""})})]})},"".concat(J.key,"-").concat(H))})]}),i.jsxs("div",{className:"mt-4 md:mt-6 pt-4 md:pt-6 border-t border-gray-200 grid grid-cols-2 sm:flex sm:flex-wrap gap-3 md:gap-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Present"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Half Day"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Absent"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Holiday"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"On Leave"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Late Arrival"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-pink-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Early Departure"})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2",children:[i.jsx(Je,{className:"w-5 h-5"})," Detailed Attendance Logs"]}),i.jsx("div",{className:"space-y-4",children:ue.map((J,H)=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors",children:[i.jsx("div",{className:"flex items-start justify-between mb-3",children:J.skeleton?i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})]}),i.jsx("div",{className:"h-4 w-40 bg-gray-200 rounded animate-pulse mt-2"})]}),i.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(ee=>i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded animate-pulse mt-1"}),i.jsxs("div",{children:[i.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse mt-1"})]})]},ee))})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-lg font-semibold text-gray-900",children:new Date(J.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),i.jsx("p",{className:"text-sm text-gray-600",children:(()=>{const ee=c.find($e=>$e.employee_id===n),he=ee==null?void 0:ee.policy;return he?"".concat(he.name," (").concat(he.status==="active"?"Active":"Inactive",")"):"No Policy"})()})]}),i.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(J.status==="Present"?"bg-green-100 text-green-700":J.status==="Absent"?"bg-red-100 text-red-800":J.status==="Late Arrival"?"bg-purple-100 text-purple-800":J.status==="Early Departure"?"bg-pink-100 text-pink-800":J.status==="Holiday"?"bg-blue-100 text-blue-800":J.status==="On Leave"?"bg-orange-100 text-orange-800":J.status==="Half Day"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:J.status})]})}),!J.skeleton&&i.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Qe,{className:"w-5 h-5 text-green-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Check-In"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:J.checkIn})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ks,{className:"w-5 h-5 text-red-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Check-Out"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:J.checkOut})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Qe,{className:"w-5 h-5 text-blue-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Total Duration"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:J.totalHours})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Je,{className:"w-5 h-5 text-purple-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Re-entries"}),i.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[Array.isArray(J.breaks)?J.breaks.length:J.breaks||0," times"]})]})]})]}),J.breaks&&J.breaks.length>0&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Break Details:"}),J.breaks.map((ee,he)=>i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsxs("span",{className:"text-gray-700",children:["Start: ",ee.break_start?new Date(ee.break_start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]}),i.jsxs("span",{className:"text-gray-700",children:["End: ",ee.break_end?new Date(ee.break_end).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]})]},he))]})})]},J.skeleton?H:J.date))}),i.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 pt-4 border-t border-gray-200 gap-4",children:[i.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",ue.length," of ",ve.length," records"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>h(J=>Math.max(1,J-1)),disabled:d===1,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ".concat(d===1?"opacity-50 cursor-not-allowed":""),children:"Previous"}),i.jsx("button",{className:"px-4 py-2 rounded-lg text-sm font-medium bg-blue-600 text-white",children:d}),i.jsx("button",{onClick:()=>h(J=>Math.min(Ee,J+1)),disabled:d===Ee,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ".concat(d===Ee?"opacity-50 cursor-not-allowed":""),children:"Next"})]})]})]}),C&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Export Attendance Report"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),i.jsxs("div",{className:"relative",children:[i.jsxs("select",{value:w,onChange:J=>b(J.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",children:[i.jsx("option",{value:"daily",children:"Daily (CSV)"}),i.jsx("option",{value:"monthly",children:"Monthly (CSV)"}),i.jsx("option",{value:"custom",children:"Custom range (CSV)"})]}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),w==="custom"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),i.jsx("input",{type:"date",value:N,onChange:J=>_(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),i.jsx("input",{type:"date",value:k,onChange:J=>j(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[i.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{onClick:De,disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",children:p?"Downloading...":"Download"})]})]})}),A&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filter Employees"}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),i.jsxs("div",{className:"relative",children:[i.jsxs("select",{value:M||"",onChange:J=>T(J.target.value||null),className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",children:[i.jsx("option",{value:"",children:"All Departments"}),W.map(J=>i.jsx("option",{value:J,children:J},J))]}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),i.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[i.jsx("button",{onClick:Se,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Reset"}),i.jsx("button",{onClick:fe,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Apply"})]})]})}),O&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Attendance Report"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),i.jsx("input",{type:"email",value:z,onChange:J=>F(J.target.value),placeholder:"Enter email address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),i.jsxs("select",{value:w,onChange:J=>b(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[i.jsx("option",{value:"daily",children:"Daily"}),i.jsx("option",{value:"monthly",children:"Monthly"}),i.jsx("option",{value:"custom",children:"Custom range"})]})]}),w==="custom"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),i.jsx("input",{type:"date",value:N,onChange:J=>_(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),i.jsx("input",{type:"date",value:k,onChange:J=>j(J.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[i.jsx("button",{onClick:()=>{U(!1),F("")},className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{onClick:We,disabled:p,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-60 disabled:cursor-not-allowed",children:p?"Sending...":"Send Email"})]})]})})]})})}const PD=()=>{const[e,t]=E.useState(""),[n,r]=E.useState(""),[a,s]=E.useState(!1),[o,l]=E.useState(""),[c,u]=E.useState(!1),d=Zn();E.useEffect(()=>{localStorage.getItem("authToken")&&d("/dashboard")},[d]);const h=async f=>{f.preventDefault(),l(""),u(!0);try{const p=await ke.login({email:e,password:n});d("/dashboard")}catch(p){if(console.error("Login failed:",p),p.errors){const m=Object.values(p.errors).flat();l(m.join(" "))}else l(p.message||"Invalid username or password. Please try again.")}finally{u(!1)}};return i.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4 overflow-y-auto",children:[i.jsx("div",{className:"absolute top-4 left-4",children:i.jsx("button",{onClick:()=>d("/"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 font-medium transition-colors",children:" Back to Kiosk"})}),i.jsxs("div",{className:"max-w-md w-full",children:[i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-4",children:i.jsx(ii,{className:"w-8 h-8 text-white"})}),i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Login"}),i.jsx("p",{className:"text-gray-600",children:"Access the administration panel"})]}),i.jsxs("form",{className:"space-y-6",onSubmit:h,children:[o&&i.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:i.jsxs("div",{className:"flex",children:[i.jsx(Dt,{className:"h-5 w-5 text-red-400"}),i.jsx("div",{className:"ml-3",children:i.jsx("p",{className:"text-sm text-red-700",children:o})})]})}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Username"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Gn,{className:"h-5 w-5 text-gray-400"})}),i.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,value:e,onChange:f=>t(f.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter username"})]})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ii,{className:"h-5 w-5 text-gray-400"})}),i.jsx("input",{id:"password",name:"password",type:a?"text":"password",autoComplete:"current-password",required:!0,value:n,onChange:f=>r(f.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter password"}),i.jsx("button",{type:"button",onClick:()=>s(!a),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:i.jsx(T0,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})]}),i.jsx("button",{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-400 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-[1.02] disabled:scale-100 disabled:cursor-not-allowed",children:c?i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing In..."]}):"Sign In"})]}),i.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:i.jsxs("p",{className:"text-xs text-gray-600 text-center",children:[i.jsx("strong",{children:"Demo Credentials:"}),i.jsx("br",{}),"Username: admin@kiosk.com | Password: admin123"]})})]}),i.jsx("div",{className:"text-center mt-6",children:i.jsx("p",{className:"text-sm text-gray-500",children:"Attendance Kiosk System v1.0"})})]})]})},FD=({registerCleanup:e})=>{const[t,n]=E.useState([]),[r,a]=E.useState([]),[s,o]=E.useState([]),[l,c]=E.useState(""),[u,d]=E.useState(!1),[h,f]=E.useState(null),[p,m]=E.useState({firstName:"",lastName:"",employeeId:"",email:"",phone:"",department:"",designation:"",policyId:"",joinDate:"",status:"active",leavePolicyIds:[],password:""}),[x,y]=E.useState({}),[g,v]=E.useState(null),[w,b]=E.useState(!0),[N,_]=E.useState(!1),k=E.useRef(!1),[j,C]=E.useState(!1),[S,M]=E.useState(null),[T,A]=E.useState(!1),[L,O]=E.useState(null),[U,z]=E.useState(!1),[F,W]=E.useState(0),[I,q]=E.useState(null),[K,re]=E.useState(""),[ie,ce]=E.useState("ssdMobilenetv1"),[me,je]=E.useState([]),G=E.useRef([]),[se,Ce]=E.useState([]),R=E.useRef([]),[Y,ne]=E.useState(!1),fe=E.useRef(!1),[Se,$]=E.useState(!1);E.useRef(!1);const le=E.useRef(null),ve=E.useRef(null);E.useRef(null);const ue=E.useRef(null);E.useEffect(()=>((async()=>{try{const[Fe,et,rn]=await Promise.all([ke.getEmployees(),ke.getPolicies(),ke.getLeavePolicies()]);n(Fe),a(et),o(rn)}catch(Fe){console.error("Failed to load data:",Fe)}finally{b(!1)}})(),e&&e(()=>{Ur()}),()=>{Ur()}),[]);const Ee=async()=>{try{await Ap.loadModels(),_(!0)}catch(te){throw console.error("Failed to load face-api models:",te),te}},De=t.filter(te=>te.name.toLowerCase().includes(l.toLowerCase())||te.email.toLowerCase().includes(l.toLowerCase())||te.employee_id.toLowerCase().includes(l.toLowerCase())||te.department.toLowerCase().includes(l.toLowerCase())),We=te=>te.split(" ").map(Fe=>Fe[0]).join("").toUpperCase(),J=()=>{m({firstName:"",lastName:"",employeeId:"",email:"",phone:"",department:"",designation:"",policyId:"",joinDate:"",status:"active",leavePolicyIds:[],password:""}),y({}),f(null)},H=()=>{J(),d(!0)},ee=te=>{m({firstName:te.name.split(" ")[0],lastName:te.name.split(" ").slice(1).join(" ")||"",employeeId:te.employee_id,email:te.email,phone:te.phone||"",department:te.department,designation:te.designation,policyId:te.policy?te.policy.id.toString():"",joinDate:te.join_date,status:te.status||"active",leavePolicyIds:(te.leave_policies||[]).map(Fe=>Fe.id.toString()),password:""}),f(te),d(!0)},he=()=>{d(!1),J()},$e=()=>{const te={};return p.firstName.trim()||(te.firstName="First name is required"),p.lastName.trim()||(te.lastName="Last name is required"),p.employeeId.trim()||(te.employeeId="Employee ID is required"),p.email.trim()?/\S+@\S+\.\S+/.test(p.email)||(te.email="Email is invalid"):te.email="Email is required",p.department.trim()||(te.department="Department is required"),p.designation.trim()||(te.designation="Designation is required"),p.policyId||(te.policyId="Policy is required"),p.joinDate||(te.joinDate="Join date is required"),y(te),Object.keys(te).length===0},Pe=async te=>{if(te.preventDefault(),!$e())return;const Fe={employee_id:p.employeeId.trim(),name:"".concat(p.firstName.trim()," ").concat(p.lastName.trim()),email:p.email.trim(),phone:p.phone.trim(),department:p.department.trim(),designation:p.designation.trim(),join_date:p.joinDate,status:p.status,face_enrolled:h?h.face_enrolled:!1,policy_id:parseInt(p.policyId,10),leave_policy_ids:p.leavePolicyIds.map(et=>parseInt(et,10))};p.password.trim()&&(Fe.password=p.password.trim());try{if(h){const et=await ke.updateEmployee(h.id,Fe),rn=await ke.getEmployees();n(rn),O(et),A(!0),he()}else{const et=await ke.createEmployee(Fe);n([...t,et]),M(et),d(!1),C(!0)}}catch(et){console.error("Failed to save employee:",et),alert("Failed to save employee. Please try again.")}},nt=te=>{m(Fe=>{const rn=Fe.leavePolicyIds.includes(te)?Fe.leavePolicyIds.filter(mn=>mn!==te):[...Fe.leavePolicyIds,te];return{...Fe,leavePolicyIds:rn}})},mt=async()=>{try{await ke.deleteEmployee(g.id),n(t.filter(te=>te.id!==g.id)),v(null)}catch(te){console.error("Failed to delete employee:",te),alert("Failed to delete employee. Please try again.")}},nn=()=>{const te=[["Name","Employee ID","Email","Phone","Department","Designation","Face Enrolled","Join Date"],...De.map(mn=>[mn.name,mn.employee_id,mn.email,mn.phone||"",mn.department,mn.designation,mn.face_enrolled?"Yes":"No",mn.join_date])].map(mn=>mn.join(",")).join("\n"),Fe=new Blob([te],{type:"text/csv"}),et=window.URL.createObjectURL(Fe),rn=document.createElement("a");rn.href=et,rn.download="employees_".concat(new Date().toISOString().split("T")[0],".csv"),rn.click(),window.URL.revokeObjectURL(et)},wr=async te=>{if(q(te),W(0),z(!0),re(""),je([]),G.current=[],Ce([]),R.current=[],!N&&!k.current){k.current=!0;try{await Ee()}finally{k.current=!1}}},Dn=()=>{z(!1),W(0),q(null),Ur()},lo=async()=>{try{const te=await navigator.mediaDevices.getUserMedia({video:!0});if(le.current){le.current.srcObject=te,ue.current=te;const Fe=le.current.play();Fe!=null&&Fe.catch&&Fe.catch(()=>{})}}catch(te){console.error("Camera error",te),re("Camera access denied or unavailable.")}},Ur=()=>{ue.current&&(ue.current.getTracks().forEach(te=>te.stop()),ue.current=null)},n1=async()=>{W(1),ce("ssdMobilenetv1"),re("Initializing camera..."),await lo();const te=(Fe,et,rn=0)=>{if(!le.current)return et(new Error("No video element"));if(le.current.readyState>=2)return Fe();if(rn>50)return et(new Error("Video not ready"));setTimeout(()=>te(Fe,et,rn+1),100)};new Promise(te).then(()=>{ne(!0),fe.current=!0,re("Capturing your face..."),Pp()}).catch(()=>re("Video not ready. Please try again."))},Pp=async()=>{if(!(!fe.current||G.current.length>=10)){try{let te=await Zb(le.current,new io({minConfidence:.5})).withFaceLandmarks().withFaceDescriptor();if(te){G.current.push(te.descriptor),je([...G.current]);const Fe=document.createElement("canvas");Fe.width=160,Fe.height=120;const et=Fe.getContext("2d");try{et.drawImage(le.current,0,0,Fe.width,Fe.height)}catch(mn){}const rn=Fe.toDataURL("image/jpeg");R.current.push(rn),Ce([...R.current]),re("Capturing your face...\nImage ".concat(G.current.length," of 10")),G.current.length>=10&&(ne(!1),fe.current=!1,re("All 10 images captured. Ready to enroll."),r1())}}catch(te){console.error("Detection error",te),re("Error during detection.")}fe.current&&setTimeout(Pp,250)}},r1=async()=>{if(G.current.length<5){alert("Please capture at least 5 images.");return}try{$(!0),re("Registering face...");const te={method:"auto-10",intervalMs:250,totalSamples:G.current.length,detectionMethod:ie};await ke.enrollFace(I.employee_id,G.current,te),n(Fe=>Fe.map(et=>et.id===I.id?{...et,face_enrolled:!0}:et)),Ur(),W(2)}catch(te){console.error("Enrollment error:",te),re("Enrollment failed. Please try again.")}finally{$(!1)}};return w?i.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),i.jsx("p",{className:"text-gray-600",children:"Loading employees..."})]})}):i.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-6",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsx("div",{className:"mb-6",children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Employee Management"}),i.jsx("p",{className:"text-md text-gray-600 mt-1",children:"Manage employees and face enrollment"})]}),i.jsxs("button",{onClick:H,className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-3 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm",children:[i.jsx(Ga,{className:"w-4 h-4"}),i.jsx("span",{children:"Add Employee"})]})]})}),i.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 mb-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(ng,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),i.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:te=>c(te.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row md:flex-row lg:flex-row gap-2",children:[i.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[i.jsx(Sf,{className:"w-4 h-4"}),i.jsx("span",{className:"inline",children:"Filter"})]}),i.jsxs("button",{onClick:nn,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[i.jsx(si,{className:"w-4 h-4"}),i.jsx("span",{className:"inline",children:"Export"})]})]})]}),i.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-5",children:De.map(te=>i.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-blue-500 hover:shadow-md transition-all",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-lg font-bold",children:We(te.name)}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:()=>ee(te),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-pen text-gray-600",children:i.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})}),i.jsx("button",{onClick:()=>v(te),className:"p-1.5 hover:bg-red-50 rounded-lg transition-colors",children:i.jsx(li,{className:"w-4 h-4"})})]})]}),i.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:te.name}),i.jsx("p",{className:"text-xs text-gray-600 mb-3",children:te.employee_id}),i.jsxs("div",{className:"space-y-2 mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-4 h-4"}),i.jsx("span",{className:"truncate",children:te.email})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-4 h-4"}),i.jsx("span",{children:te.phone||"+1 234 567 8902"})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Gn,{className:"w-4 h-4"}),i.jsx("span",{children:te.department})]})]}),te.face_enrolled?i.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 border border-green-200 rounded-lg mb-3",children:[i.jsx(Qt,{className:"w-4 h-4 text-green-600"}),i.jsx("span",{className:"text-xs font-medium text-green-700",children:"Face Enrolled"})]}):i.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-50 border border-red-200 rounded-lg mb-3",children:[i.jsx(ao,{className:"w-4 h-4 text-red-600"}),i.jsx("span",{className:"text-xs font-medium text-red-700",children:"Face Not Enrolled"})]}),i.jsxs("button",{onClick:()=>wr(te),className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors",children:[i.jsx(ks,{className:"w-4 h-4"}),i.jsx("span",{children:te.face_enrolled?"Re-enroll Face":"Enroll Face"})]})]},te.id))}),De.length===0&&i.jsxs("div",{className:"text-center py-12 bg-white rounded-xl border border-gray-200",children:[i.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(ng,{className:"w-8 h-8 text-gray-400"})}),i.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"No employees found"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Try adjusting your search or add a new employee"})]}),u&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between z-10",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:h?"Edit Employee":"Add New Employee"}),i.jsx("button",{onClick:he,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(kn,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"overflow-y-auto px-6 py-6 flex-1 space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),i.jsx("input",{type:"text",placeholder:"John",value:p.firstName,onChange:te=>m({...p,firstName:te.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),i.jsx("input",{type:"text",placeholder:"Smith",value:p.lastName,onChange:te=>m({...p,lastName:te.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee ID"}),i.jsx("input",{type:"text",placeholder:"EMP-001",value:p.employeeId,onChange:te=>m({...p,employeeId:te.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),i.jsx("input",{type:"email",placeholder:"john.smith@techcorp.com",value:p.email,onChange:te=>m({...p,email:te.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),i.jsx("input",{type:"tel",placeholder:"+1 234 567 8901",value:p.phone,onChange:te=>m({...p,phone:te.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),i.jsx("input",{type:"text",placeholder:"Engineering",value:p.department,onChange:te=>m({...p,department:te.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designation"}),i.jsx("input",{type:"text",placeholder:"Senior Developer",value:p.designation,onChange:te=>m({...p,designation:te.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attendance Policy"}),i.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p.policyId,onChange:te=>m({...p,policyId:te.target.value}),children:[i.jsx("option",{value:"",children:"Select a policy"}),r.filter(te=>te.status==="active").map(te=>i.jsx("option",{value:te.id,children:te.name},te.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Join Date"}),i.jsx("input",{type:"date",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p.joinDate,onChange:te=>m({...p,joinDate:te.target.value})})]})]}),i.jsxs("div",{className:"border border-dashed border-gray-300 rounded-xl p-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Leave Policies"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Select the leave types this employee can access."})]}),i.jsxs("span",{className:"text-xs text-gray-500",children:[p.leavePolicyIds.length," selected"]})]}),s.length===0?i.jsx("p",{className:"text-xs text-gray-500",children:"No leave policies found. Create leave policies first."}):i.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(te=>{const Fe=p.leavePolicyIds.includes(te.id.toString());return i.jsxs("label",{className:"px-3 py-2 rounded-lg border text-xs font-medium cursor-pointer transition-colors ".concat(Fe?"bg-blue-600 text-white border-blue-600":"bg-gray-50 text-gray-700 border-gray-200 hover:border-blue-300"),children:[i.jsx("input",{type:"checkbox",className:"hidden",checked:Fe,onChange:()=>nt(te.id.toString())}),te.name,"  ",te.yearly_quota," days"]},te.id)})})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),i.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p.status,onChange:te=>m({...p,status:te.target.value}),children:[i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"inactive",children:"Inactive"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Portal Password (optional)"}),i.jsx("input",{type:"password",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:h?"Leave blank to keep current password":"Set initial password",value:p.password,onChange:te=>m({...p,password:te.target.value})}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Employees use this password to access their portal."})]})]})]}),i.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-6 flex gap-3",children:[i.jsx("button",{onClick:he,type:"button",className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{onClick:Pe,type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",children:h?"Update Employee":"Add Employee"})]})]})}),j&&S&&i.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 text-center",children:[i.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-50 flex items-center justify-center mx-auto mb-4",children:i.jsx(ks,{className:"w-7 h-7 text-blue-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Employee Added!"}),i.jsxs("p",{className:"text-gray-700 mb-6",children:[i.jsx("span",{className:"font-semibold",children:S.name})," has been added successfully. Would you like to enroll their face now?"]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>{C(!1),M(null)},className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg font-medium",children:"Enroll Later"}),i.jsxs("button",{onClick:()=>{C(!1),wr(S)},className:"flex-1 px-4 py-2.5 rounded-lg font-medium bg-blue-600 text-white inline-flex items-center justify-center gap-2",children:[i.jsx(ks,{className:"w-4 h-4"}),"Enroll Now"]})]})]})}),U&&I&&i.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-[#0f1a2b] text-white rounded-2xl w-full max-w-md overflow-hidden",children:[i.jsxs("div",{className:"p-4 sm:p-6 flex items-center justify-between",children:[i.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white",children:"Face Enrollment"}),i.jsx("button",{onClick:Dn,className:"text-white/60 hover:text-white",children:i.jsx(kn,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),i.jsxs("div",{className:"flex items-center justify-between mb-6 sm:mb-8 px-4 sm:px-6",children:[i.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-green-500",children:i.jsx(Qt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),i.jsx("div",{className:"flex-1 h-1 mx-1 sm:mx-2 bg-gray-700"}),i.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full ".concat(F>=1?"bg-green-500":"bg-gray-700"),children:i.jsx(ks,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),i.jsx("div",{className:"flex-1 h-1 mx-1 sm:mx-2 bg-gray-700"}),i.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full ".concat(F>=2?"bg-green-500":"bg-gray-700"),children:i.jsx(Qt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})})]}),i.jsxs("div",{className:"p-4 sm:p-6",children:[F===0&&i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-2xl sm:text-3xl font-bold mx-auto mb-4",children:We(I.name)}),i.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:I.name}),i.jsx("p",{className:"text-gray-400 mb-1 text-sm sm:text-base",children:I.employee_id}),i.jsx("p",{className:"text-gray-400 mb-4 sm:mb-6 text-sm sm:text-base",children:I.department}),i.jsxs("div",{className:"bg-slate-800 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6 text-left",children:[i.jsx("h4",{className:"text-sm font-semibold text-white mb-2 sm:mb-3",children:"Instructions:"}),i.jsxs("ul",{className:"space-y-1 sm:space-y-2 text-xs sm:text-sm text-gray-300",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsx("span",{children:"Position your face in the camera frame"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsx("span",{children:"Look directly at the camera"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsx("span",{children:"Ensure good lighting"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsx("span",{children:"10 images will be captured automatically"})]})]})]}),i.jsx("button",{onClick:n1,className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 sm:py-3 rounded-lg font-semibold transition-colors text-sm sm:text-base",children:"Start Capture"})]}),F===1&&i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"relative bg-slate-900 rounded-xl overflow-hidden mb-4",children:[i.jsx("video",{ref:le,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-48 sm:h-64 object-cover",style:{transform:"scaleX(1)"}}),i.jsx("canvas",{ref:ve,className:"absolute top-0 left-0 w-full h-48 sm:h-64 hidden",style:{transform:"scaleX(1)"}})]}),i.jsx("div",{className:"text-slate-200 mb-2 whitespace-pre-line text-sm sm:text-base",children:K||"Capturing your face..."}),i.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2 mb-2",children:i.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all",style:{width:"".concat(me.length/10*100,"%")}})}),i.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2 mb-4",children:se.map((te,Fe)=>i.jsx("img",{src:te,alt:"sample-".concat(Fe),className:"w-full h-12 sm:h-16 object-cover rounded border border-slate-700"},Fe))}),i.jsx("p",{className:"text-center text-slate-400 text-xs sm:text-sm",children:"Capturing 10 images automatically..."}),Se&&i.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400",children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-400"}),i.jsx("span",{className:"text-sm",children:"Processing enrollment..."})]})]}),F===2&&i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-green-500 grid place-items-center mx-auto mb-4",children:i.jsx(Qt,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),i.jsx("h4",{className:"text-xl sm:text-2xl font-semibold mb-1",children:"Enrollment Successful!"}),i.jsx("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:"Face has been registered successfully"}),i.jsx("button",{onClick:Dn,className:"w-full bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl py-2 sm:py-3 text-sm sm:text-base",children:"Continue"})]})]})]})}),T&&L&&i.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 text-center",children:[i.jsx("div",{className:"w-14 h-14 rounded-full bg-green-50 flex items-center justify-center mx-auto mb-4",children:i.jsx(Qt,{className:"w-7 h-7 text-green-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Employee Updated Successfully"}),i.jsxs("p",{className:"text-gray-700 mb-6",children:[i.jsx("span",{className:"font-semibold",children:L.name})," has been updated successfully."]}),i.jsx("div",{className:"flex gap-3",children:i.jsx("button",{onClick:()=>{A(!1),O(null)},className:"flex-1 px-4 py-2.5 rounded-lg font-medium bg-green-600 text-white",children:"Continue"})})]})}),g&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:i.jsx(li,{className:"w-6 h-6 text-red-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Delete Employee"})]}),i.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete ",i.jsx("strong",{children:g.name}),"? This action cannot be undone and will remove all associated data."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>v(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{onClick:mt,className:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700",children:"Delete"})]})]})})})]})]})})},MD=()=>{const[e,t]=E.useState([]),[n,r]=E.useState(!0),[a,s]=E.useState(!1),[o,l]=E.useState(null),[c,u]=E.useState(null),[d,h]=E.useState(null),[f,p]=E.useState(null),[m,x]=E.useState(null),[y,g]=E.useState({show:!1,type:"success",message:""}),[v,w]=E.useState({policyName:"",effectiveFrom:"",effectiveTo:"",includeBreak:!1,breakHours:1,breakMinutes:0,fullDayHours:8,fullDayMinutes:30,halfDayHours:4,halfDayMinutes:30,enableLateTracking:!0,workStartTime:"09:00",lateGracePeriod:15,enableEarlyTracking:!0,workEndTime:"18:00",earlyGracePeriod:15});E.useEffect(()=>{(async()=>{try{const L=await ke.getPolicies();t(L)}catch(L){console.error("Failed to load policies:",L)}finally{r(!1)}})()},[]);const b=A=>{const L=O=>{if(!O)return"";try{let U;if(O.includes("T")?U=new Date(O):U=new Date(O+"T00:00:00"),isNaN(U.getTime()))return"";const z=U.getFullYear(),F=String(U.getMonth()+1).padStart(2,"0"),W=String(U.getDate()).padStart(2,"0");return"".concat(z,"-").concat(F,"-").concat(W)}catch(U){return console.error("Error parsing date:",O,U),""}};l(A),w({policyName:A.name||"",effectiveFrom:L(A.effective_from),effectiveTo:L(A.effective_to),includeBreak:A.include_break||!1,breakHours:A.break_hours||1,breakMinutes:A.break_minutes||0,fullDayHours:A.full_day_hours||8,fullDayMinutes:A.full_day_minutes||30,halfDayHours:A.half_day_hours||4,halfDayMinutes:A.half_day_minutes||30,enableLateTracking:A.enable_late_tracking!==void 0?A.enable_late_tracking:!0,workStartTime:A.work_start_time?A.work_start_time.substring(0,5):"09:00",lateGracePeriod:A.late_grace_period||15,enableEarlyTracking:A.enable_early_tracking!==void 0?A.enable_early_tracking:!0,workEndTime:A.work_end_time?A.work_end_time.substring(0,5):"18:00",earlyGracePeriod:A.early_grace_period||15}),s(!0)},N=()=>{l(null),w({policyName:"",effectiveFrom:"",effectiveTo:"",includeBreak:!1,breakHours:1,breakMinutes:0,fullDayHours:8,fullDayMinutes:30,halfDayHours:4,halfDayMinutes:30,enableLateTracking:!0,workStartTime:"09:00",lateGracePeriod:15,enableEarlyTracking:!0,workEndTime:"18:00",earlyGracePeriod:15}),s(!0)},_=async A=>{A.preventDefault();const L={name:v.policyName,effective_from:v.effectiveFrom?v.effectiveFrom:null,effective_to:v.effectiveTo?v.effectiveTo:null,include_break:v.includeBreak,break_hours:v.breakHours,break_minutes:v.breakMinutes,full_day_hours:v.fullDayHours,full_day_minutes:v.fullDayMinutes,half_day_hours:v.halfDayHours,half_day_minutes:v.halfDayMinutes,enable_late_tracking:v.enableLateTracking,work_start_time:v.workStartTime,late_grace_period:v.lateGracePeriod,enable_early_tracking:v.enableEarlyTracking,work_end_time:v.workEndTime,early_grace_period:v.earlyGracePeriod};try{if(o){const O=await ke.updatePolicy(o.id,L);t(e.map(U=>U.id===o.id?O:U)),g({show:!0,type:"success",message:"Policy updated successfully!"})}else{const O=await ke.createPolicy(L);t([...e,O]),g({show:!0,type:"success",message:"Policy created successfully!"})}setTimeout(()=>g({show:!1,type:"success",message:""}),2e3),s(!1)}catch(O){console.error("Failed to save policy:",O),g({show:!0,type:"error",message:"Failed to save policy. Please try again."}),setTimeout(()=>g({show:!1,type:"error",message:""}),3e3)}},k=A=>{h(A)},j=async()=>{try{const A=await ke.togglePolicyStatus(d.id);t(e.map(L=>L.id===d.id?A.policy:L)),h(null),g({show:!0,type:"success",message:A.message||"Policy status updated successfully!"}),setTimeout(()=>g({show:!1,type:"success",message:""}),2e3)}catch(A){console.error("Failed to toggle policy status:",A);const L=A.error||"Failed to update policy status. Please try again.";g({show:!0,type:"error",message:L}),setTimeout(()=>g({show:!1,type:"error",message:""}),2e3),h(null)}},C=async()=>{var A,L,O,U;if(!c.id){g({show:!0,type:"error",message:"Invalid policy selected. Please try again."}),setTimeout(()=>g({show:!1,type:"error",message:""}),2e3),u(null);return}try{await ke.deletePolicy(c.id),t(e.filter(z=>z.id!==c.id)),u(null),g({show:!0,type:"success",message:"Policy deleted successfully!"}),setTimeout(()=>g({show:!1,type:"success",message:""}),2e3)}catch(z){if(console.error("Failed to delete policy:",z),z.response&&z.response.status===422&&z.response.data.error)x(z.response.data),u(null);else{const F=((L=(A=z.response)==null?void 0:A.data)==null?void 0:L.message)||((U=(O=z.response)==null?void 0:O.data)==null?void 0:U.error)||"Failed to delete policy. Please try again.";g({show:!0,type:"error",message:F}),setTimeout(()=>g({show:!1,type:"error",message:""}),2e3)}}},S=A=>{p(A)},M=async()=>{if(!f){g({show:!0,type:"error",message:"Invalid policy selected. Please try again."}),setTimeout(()=>g({show:!1,type:"error",message:""}),3e3),p(null);return}const A=f,L={name:"Copy of ".concat(A.name),effective_from:A.effective_from,effective_to:A.effective_to,include_break:A.include_break,break_hours:A.break_hours,break_minutes:A.break_minutes,full_day_hours:A.full_day_hours,full_day_minutes:A.full_day_minutes,half_day_hours:A.half_day_hours,half_day_minutes:A.half_day_minutes,enable_late_tracking:A.enable_late_tracking,work_start_time:A.work_start_time?A.work_start_time.substring(0,5):"09:00",late_grace_period:A.late_grace_period,enable_early_tracking:A.enable_early_tracking,work_end_time:A.work_end_time?A.work_end_time.substring(0,5):"18:00",early_grace_period:A.early_grace_period,enable_absence_tracking:A.enable_absence_tracking};try{const O=await ke.createPolicy(L);t([...e,O]),g({show:!0,type:"success",message:"Policy copied successfully!"}),setTimeout(()=>g({show:!1,type:"success",message:""}),3e3),p(null)}catch(O){console.error("Failed to copy policy:",O),g({show:!0,type:"error",message:"Failed to copy policy. Please try again."}),setTimeout(()=>g({show:!1,type:"error",message:""}),3e3),p(null)}},T=A=>A?A.substring(0,5):"-";return n?i.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):i.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsx("div",{className:"mb-8",children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Policy Management"}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure attendance policies"})]}),i.jsxs("button",{onClick:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 md:px-6 py-2 md:py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-colors text-sm md:text-base",children:[i.jsx(Ga,{className:"w-5 h-5"}),i.jsx("span",{children:"Create Policy"})]})]})}),y.show&&i.jsxs("div",{className:"mb-6 p-4 border rounded-lg flex items-center shadow-sm ".concat(y.type==="success"?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[y.type==="success"?i.jsx(Qt,{className:"w-5 h-5 mr-3 flex-shrink-0"}):i.jsx(ao,{className:"w-5 h-5 mr-3 flex-shrink-0"}),i.jsx("span",{className:"font-medium",children:y.message})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:e.map((A,L)=>i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow",children:[i.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-200",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsx("h3",{className:"text-lg font-bold text-gray-900",children:A.name}),i.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(A.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:A.status==="active"?"Active":"Inactive"})]}),i.jsxs("p",{className:"text-sm text-gray-600",children:[A.employees_count||0," employees assigned"]})]}),i.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Qe,{className:"w-5 h-5 text-blue-600"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Work Hours"}),i.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[T(A.work_start_time)," - ",T(A.work_end_time)]})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Je,{className:"w-5 h-5 text-green-600"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Full Day / Half Day"}),i.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[A.full_day_hours,".",A.full_day_minutes," hrs / ",A.half_day_hours,".",A.half_day_minutes," hrs"]})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(f_,{className:"w-5 h-5 text-orange-600"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Break Duration"}),i.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[A.break_hours,".",A.break_minutes," hr ",A.include_break?"(Included)":"(Excluded)"]})]})]})]}),i.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-200 flex gap-2",children:[i.jsxs("button",{onClick:()=>b(A),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors flex items-center justify-center gap-2",children:[i.jsx(da,{className:"w-4 h-4"}),"Edit"]}),i.jsx("button",{onClick:()=>S(A),className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",title:"Copy",children:i.jsx(eh,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>k(A),className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",title:A.status==="active"?"Deactivate":"Activate",children:i.jsx(Zd,{className:"w-4 h-4"})})]})]},A.id||"policy-".concat(L)))}),e.length===0&&i.jsxs("div",{className:"text-center py-12 text-gray-500",children:[i.jsx("p",{className:"text-lg",children:"No policies found"}),i.jsx("p",{className:"text-sm mt-2",children:"Create your first policy to get started"})]}),a&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 md:p-6 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:o?"Edit Policy":"Create Policy"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:o?o.name:"New Policy"})]}),i.jsx("button",{onClick:()=>s(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(kn,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"overflow-y-auto max-h-[60vh] p-6",children:i.jsxs("form",{onSubmit:_,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"policyName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Policy Name"}),i.jsx("input",{id:"policyName",type:"text",placeholder:"e.g., Standard Office Policy",value:v.policyName,onChange:A=>w({...v,policyName:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Effective From"}),i.jsx("input",{type:"date",value:v.effectiveFrom,onChange:A=>w({...v,effectiveFrom:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Effective To"}),i.jsx("input",{type:"date",value:v.effectiveTo,onChange:A=>w({...v,effectiveTo:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-5 h-5 text-blue-600"}),"Work Duration Settings"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("input",{type:"checkbox",id:"breakHandlingEdit",checked:v.includeBreak,onChange:A=>w({...v,includeBreak:A.target.checked}),className:"w-4 h-4 text-blue-600"}),i.jsx("label",{htmlFor:"breakHandlingEdit",className:"text-sm font-medium text-gray-700",children:"Include break time in work duration calculation"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Duration (Hours)"}),i.jsx("input",{type:"number",step:"0.5",placeholder:"1.0",value:v.breakHours,onChange:A=>w({...v,breakHours:parseFloat(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Duration (Minutes)"}),i.jsx("input",{type:"number",step:"15",placeholder:"0",value:v.breakMinutes,onChange:A=>w({...v,breakMinutes:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Je,{className:"w-5 h-5 text-green-600"}),"Attendance Classification"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Day Minimum Hours"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("input",{type:"number",placeholder:"8",value:v.fullDayHours,onChange:A=>w({...v,fullDayHours:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),i.jsx("input",{type:"number",placeholder:"30",value:v.fullDayMinutes,onChange:A=>w({...v,fullDayMinutes:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours and Minutes"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Half Day Minimum Hours"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("input",{type:"number",placeholder:"4",value:v.halfDayHours,onChange:A=>w({...v,halfDayHours:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),i.jsx("input",{type:"number",placeholder:"30",value:v.halfDayMinutes,onChange:A=>w({...v,halfDayMinutes:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours and Minutes"})]})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Dt,{className:"w-5 h-5 text-orange-600"}),"Late Arrival Tracking"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("input",{type:"checkbox",id:"enableLateEdit",checked:v.enableLateTracking,onChange:A=>w({...v,enableLateTracking:A.target.checked}),className:"w-4 h-4 text-blue-600"}),i.jsx("label",{htmlFor:"enableLateEdit",className:"text-sm font-medium text-gray-700",children:"Enable late arrival tracking"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Work Start Time"}),i.jsx("input",{type:"time",value:v.workStartTime,onChange:A=>w({...v,workStartTime:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grace Period (minutes)"}),i.jsx("input",{type:"number",placeholder:"15",value:v.lateGracePeriod,onChange:A=>w({...v,lateGracePeriod:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Dt,{className:"w-5 h-5 text-red-600"}),"Early Departure Tracking"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("input",{type:"checkbox",id:"enableEarlyEdit",checked:v.enableEarlyTracking,onChange:A=>w({...v,enableEarlyTracking:A.target.checked}),className:"w-4 h-4 text-blue-600"}),i.jsx("label",{htmlFor:"enableEarlyEdit",className:"text-sm font-medium text-gray-700",children:"Enable early departure tracking"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Work End Time"}),i.jsx("input",{type:"time",value:v.workEndTime,onChange:A=>w({...v,workEndTime:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grace Period (minutes)"}),i.jsx("input",{type:"number",placeholder:"15",value:v.earlyGracePeriod,onChange:A=>w({...v,earlyGracePeriod:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]})]})}),i.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-4 md:p-6 flex gap-3",children:[i.jsx("button",{type:"button",onClick:()=>s(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{type:"submit",onClick:_,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:o?"Update Policy":"Create Policy"})]})]})}),c&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:i.jsx(li,{className:"w-6 h-6 text-red-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Delete Policy"})]}),i.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete ",i.jsx("strong",{children:c.name}),"? This action cannot be undone."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>u(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{onClick:C,className:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors",children:"Delete"})]})]})})}),m&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[80vh] overflow-y-auto",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:i.jsx(li,{className:"w-6 h-6 text-red-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cannot Delete Policy"})]}),i.jsx("p",{className:"text-red-600 mb-4 font-medium",children:m.error}),i.jsx("p",{className:"text-gray-600 mb-6",children:"The following employees are currently assigned to this policy:"}),i.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 max-h-48 overflow-y-auto",children:i.jsx("ul",{className:"space-y-2",children:m.assigned_employees.map((A,L)=>i.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[i.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full flex-shrink-0"}),i.jsx("span",{className:"font-medium",children:A.employee_id}),i.jsxs("span",{className:"text-gray-600",children:["- ",A.name]})]},L))})}),i.jsx("div",{className:"flex gap-3",children:i.jsx("button",{onClick:()=>x(null),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"OK"})})]})})}),d&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center",children:i.jsx(Zd,{className:"w-6 h-6 text-orange-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:d.status==="active"?"Deactivate Policy":"Activate Policy"})]}),i.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to ",d.status==="active"?"deactivate":"activate"," ",i.jsx("strong",{children:d.name}),"?"]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>h(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{onClick:j,className:"flex-1 px-4 py-2.5 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition-colors",children:d.status==="active"?"Deactivate":"Activate"})]})]})})}),f&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:i.jsx(eh,{className:"w-6 h-6 text-blue-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Copy Policy"})]}),i.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to copy ",i.jsx("strong",{children:f.name}),"?"]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>p(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{onClick:M,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Copy"})]})]})})})]})})},cl={toBackend:{monthly_accrual:"monthly_accrual_value",carry_forward_quarter_cap:"carry_forward_max_per_quarter",carry_forward_reset_mode:"carry_forward_reset_frequency",max_balance:"annual_maximum",status:"is_active",carry_forward_enabled:"carry_forward_allowed",auto_reset_quarter_end:"carry_forward_auto_reset_enabled",sandwich_rule_enabled:"sandwich_rule_enabled"},fromBackend:{monthly_accrual_value:"monthly_accrual",carry_forward_max_per_quarter:"carry_forward_quarter_cap",carry_forward_reset_frequency:"carry_forward_reset_mode",annual_maximum:"max_balance",is_active:"status",carry_forward_allowed:"carry_forward_enabled",carry_forward_auto_reset_enabled:"auto_reset_quarter_end",sandwich_rule_enabled:"sandwich_rule_enabled"}},ul={name:"",code:"",description:"",yearly_quota:12,monthly_accrual:1,accrual_day_of_month:1,join_date_proration:!0,carry_forward_enabled:!0,carry_forward_quarter_cap:3,carry_forward_reset_mode:"quarterly",auto_reset_quarter_end:!0,reset_notice_days:3,sandwich_rule_enabled:!0,max_balance:12,status:"active",eligibility_departments:[],eligibility_designations:[]},iv=(e=[])=>i.jsx("div",{className:"flex flex-wrap gap-2",children:e.length===0?i.jsx("span",{className:"text-xs text-gray-500",children:"All"}):e.map(t=>i.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full",children:t},t))}),OD=()=>{const[e,t]=E.useState([]),[n,r]=E.useState(!0),[a,s]=E.useState(!1),[o,l]=E.useState(ul),[c,u]=E.useState(null),[d,h]=E.useState(null),[f,p]=E.useState(null),[m,x]=E.useState(null),[y,g]=E.useState([]),[v,w]=E.useState([]),[b,N]=E.useState([]),[_,k]=E.useState(!1),j=I=>{if(Array.isArray(I))return I.map(K=>j(K));const q={...I};return Object.keys(cl.fromBackend).forEach(K=>{const re=cl.fromBackend[K];q[K]!==void 0&&(q[re]=q[K],K!==re&&delete q[K])}),typeof q.status=="boolean"&&(q.status=q.status?"active":"inactive"),q.carry_forward_enabled=!!q.carry_forward_enabled,q.auto_reset_quarter_end=!!q.auto_reset_quarter_end,q.sandwich_rule_enabled=!!q.sandwich_rule_enabled,q.eligibility_departments=q.eligibility_departments||[],q.eligibility_designations=q.eligibility_designations||[],q},C=I=>{const q={...I};return Object.keys(cl.toBackend).forEach(K=>{const re=cl.toBackend[K];if(q[K]!==void 0){let ie=q[K];K==="status"&&(ie=ie==="active"),K==="carry_forward_reset_mode"&&(ie={quarterly:"QUARTERLY",annual:"ANNUAL"}[ie]||"QUARTERLY"),q[re]=ie,re!==K&&delete q[K]}}),q.carry_forward_allowed||(q.carry_forward_max_per_quarter=3,q.carry_forward_reset_frequency="QUARTERLY",q.carry_forward_auto_reset_enabled=!0,q.reset_notice_days=3),q.join_date_proration_rule="ACCRUE_FROM_NEXT_MONTH",q},S=async()=>{try{r(!0);const I=await ke.getLeavePolicies();t(j(I))}catch(I){console.error("Failed to load leave policies",I),h({type:"error",message:"Unable to load leave policies."})}finally{r(!1)}},M=async()=>{try{k(!0);const I=await ke.getEmployees();g(I||[]);const q=new Set,K=new Set;(I||[]).forEach(re=>{re.department&&q.add(re.department),re.designation&&K.add(re.designation)}),w(Array.from(q)),N(Array.from(K))}catch(I){console.error("Failed to load employees / departments",I),h(q=>q||{type:"error",message:"Unable to load departments and designations."})}finally{k(!1)}};E.useEffect(()=>{S(),M()},[]),E.useEffect(()=>{if(d){const I=setTimeout(()=>{h(null)},2e3);return()=>clearTimeout(I)}},[d]);const T=()=>{s(!1),u(null),l(ul)},A=()=>{u(null),l(ul),s(!0)},L=I=>{var q;u(I),l({...ul,...I,code:I.code,name:I.name,description:(q=I.description)!=null?q:"",yearly_quota:I.yearly_quota,monthly_accrual:I.monthly_accrual,carry_forward_enabled:I.carry_forward_enabled,sandwich_rule_enabled:I.sandwich_rule_enabled,eligibility_departments:I.eligibility_departments||[],eligibility_designations:I.eligibility_designations||[],metadataObject:I.metadataObject||{}}),s(!0)},O=(I,q)=>{l(K=>({...K,[I]:q}))},U=E.useMemo(()=>[{title:"Basic Details",description:"Name, description & status",content:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Policy Name"}),i.jsx("input",{type:"text",value:o.name,onChange:I=>O("name",I.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"e.g., Casual Leave"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Policy Code"}),i.jsx("input",{type:"text",value:o.code,onChange:I=>O("code",I.target.value.toUpperCase()),className:"w-full border border-gray-300 rounded-lg px-4 py-2 uppercase",placeholder:"CL",maxLength:6})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),i.jsx("textarea",{value:o.description,onChange:I=>O("description",I.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2",rows:3,placeholder:"Explain what this leave type covers"})]})]})},{title:"Accrual Rules",description:"Monthly accrual and quotas",content:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Yearly Quota"}),i.jsx("input",{type:"number",value:o.yearly_quota,onChange:I=>O("yearly_quota",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2",min:0}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Annual maximum 12 leaves"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monthly Accrual"}),i.jsx("input",{type:"number",step:"0.5",value:o.monthly_accrual,onChange:I=>O("monthly_accrual",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1 leave added monthly"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Accrual Day of Month *"}),i.jsx("input",{type:"number",value:o.accrual_day_of_month,onChange:I=>O("accrual_day_of_month",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2",min:1,max:31,required:!0}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Day of month for accruals"})]})]})},{title:"Carry-forward Settings",description:"Quarter limits & reset notifications",content:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-800",children:"Carry-forward allowed"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Auto reset at quarter end"})]}),i.jsx("label",{className:"inline-flex items-center cursor-pointer",children:i.jsx("input",{type:"checkbox",checked:o.carry_forward_enabled,onChange:I=>O("carry_forward_enabled",I.target.checked),className:"w-5 h-5 text-blue-600 rounded"})})]}),o.carry_forward_enabled&&i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quarter Cap (max leaves)"}),i.jsx("input",{type:"number",min:0,value:o.carry_forward_quarter_cap,onChange:I=>O("carry_forward_quarter_cap",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max 3 leaves carry forward"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reset Mode"}),i.jsxs("select",{value:o.carry_forward_reset_mode,onChange:I=>O("carry_forward_reset_mode",I.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2",children:[i.jsx("option",{value:"quarterly",children:"Quarterly"}),i.jsx("option",{value:"annual",children:"Annual"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reset Notification (days)"}),i.jsx("input",{type:"number",min:0,value:o.reset_notice_days,onChange:I=>O("reset_notice_days",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Alert 3 days before reset"})]})]})]})},{title:"Sandwich Rule",description:"Weekend/holiday counted if leave spans both sides",content:i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"flex items-center justify-between border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-800",children:"Sandwich Rule"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Weekend/holiday counted if leave spans both sides"})]}),i.jsx("label",{htmlFor:"sandwich_rule_enabled",className:"inline-flex items-center cursor-pointer",children:i.jsx("input",{id:"sandwich_rule_enabled",name:"sandwich_rule_enabled",type:"checkbox",checked:o.sandwich_rule_enabled,onChange:I=>O("sandwich_rule_enabled",I.target.checked),className:"w-5 h-5 text-blue-600 rounded"})})]})})},{title:"Eligibility",description:"Departments / designations the policy applies to",content:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departments (Multi-select)"}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{multiple:!0,value:o.eligibility_departments,onChange:I=>{const q=Array.from(I.target.selectedOptions,K=>K.value);O("eligibility_departments",q)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[120px]",children:v.map(I=>i.jsx("option",{value:I,children:I},I))}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple. Leave empty for all departments."}),_&&i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Loading departments"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Designations (Multi-select)"}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{multiple:!0,value:o.eligibility_designations,onChange:I=>{const q=Array.from(I.target.selectedOptions,K=>K.value);O("eligibility_designations",q)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[120px]",children:b.map(I=>i.jsx("option",{value:I,children:I},I))}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple. Leave empty for all designations."}),_&&i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Loading designations"})]})]})}],[o,v,b,_]),z=async I=>{I.preventDefault();try{const q=C(o);c?await ke.updateLeavePolicy(c.id,q):await ke.createLeavePolicy(q),await S(),h({type:"success",message:"Policy ".concat(c?"updated":"created"," successfully.")}),T()}catch(q){console.error("Failed to save policy",q),h({type:"error",message:(q==null?void 0:q.message)||"Unable to save policy. Please check inputs."})}},F=async()=>{if(f)try{await ke.toggleLeavePolicyStatus(f.id),await S(),h({type:"success",message:"Policy status updated."})}catch(I){h({type:"error",message:"Failed to update status."})}finally{p(null)}},W=async()=>{if(m)try{await ke.copyLeavePolicy(m.id),await S(),h({type:"success",message:"Policy copied successfully."})}catch(I){h({type:"error",message:"Failed to copy policy."})}finally{x(null)}};return i.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[i.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Leave Policies"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Configure CL, SL, EL accruals & sandwich rule."})]}),i.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[i.jsx(Ga,{className:"w-4 h-4"}),"Create Policy"]})]}),d&&i.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-lg ".concat(d.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:[d.type==="success"?i.jsx(Qt,{className:"w-5 h-5"}):i.jsx(Dt,{className:"w-5 h-5"}),i.jsx("span",{className:"font-medium text-sm",children:d.message})]}),n?i.jsx("div",{className:"flex justify-center py-16",children:"Loading policies..."}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:e.map(I=>i.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-5 flex flex-col gap-4",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:I.code}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:I.name}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:I.description})]}),i.jsx("span",{className:"px-3 py-1 text-xs font-semibold rounded-full ".concat(I.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),children:I.status})]}),i.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(U_,{className:"w-4 h-4 text-blue-500"}),i.jsxs("span",{children:["Quota: ",I.yearly_quota," / year  +",I.monthly_accrual," monthly"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(th,{className:"w-4 h-4 text-orange-500"}),i.jsxs("span",{children:["Carry forward:"," ",I.carry_forward_enabled?"Yes  ".concat(I.carry_forward_quarter_cap," per quarter"):"No"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Dt,{className:"w-4 h-4 ".concat(I.sandwich_rule_enabled?"text-red-500":"text-gray-400")}),i.jsxs("span",{children:["Sandwich rule: ",I.sandwich_rule_enabled?"Enabled":"Disabled"]})]})]}),i.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[i.jsx("p",{className:"font-semibold text-gray-700",children:"Eligibility"}),iv(I.eligibility_departments),iv(I.eligibility_designations)]}),i.jsxs("div",{className:"flex items-center gap-2 mt-auto",children:[i.jsxs("button",{onClick:()=>L(I),className:"flex-1 inline-flex items-center justify-center gap-2 border border-gray-200 rounded-lg px-3 py-2 text-sm font-medium hover:bg-gray-50",children:[i.jsx(da,{className:"w-4 h-4"}),"Edit"]}),i.jsx("button",{onClick:()=>x(I),className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50",title:"Copy policy",children:i.jsx(eh,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>p(I),className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50",title:"Archive policy",children:i.jsx(Zd,{className:"w-4 h-4"})})]})]},I.id))})]}),a&&i.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-3xl shadow-xl max-h-[90vh] flex flex-col",children:[i.jsxs("div",{className:"flex items-start justify-between border-b border-gray-200 px-6 py-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:c?"Edit Leave Policy":"Create Leave Policy"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Multi-section setup covering accrual, carry-forward, sandwich & eligibility."})]}),i.jsx("button",{onClick:T,className:"p-2 rounded-full hover:bg-gray-100",children:i.jsx(kn,{className:"w-5 h-5 text-gray-500"})})]}),i.jsx("form",{onSubmit:z,className:"overflow-y-auto px-6 py-4 space-y-6",children:U.map(I=>i.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-sm font-semibold text-gray-800",children:I.title}),i.jsx("p",{className:"text-xs text-gray-500",children:I.description})]}),I.content]},I.title))}),i.jsxs("div",{className:"border-t border-gray-200 px-6 py-4 flex items-center gap-3 justify-end",children:[i.jsx("button",{type:"button",onClick:T,className:"px-4 py-2 border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{type:"submit",onClick:z,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:c?"Update Policy":"Create Policy"})]})]})}),f&&i.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6 space-y-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:f.status==="active"?"Archive Policy":"Activate Policy"}),i.jsx("p",{className:"text-sm text-gray-600",children:f.status==="active"?"Archiving will disable accruals. Employees keep existing balance.":"Activating will resume accruals for eligible employees."}),i.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[i.jsx("button",{onClick:()=>p(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),i.jsx("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Confirm"})]})]})}),m&&i.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6 space-y-4",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Copy ",m.name,"?"]}),i.jsx("p",{className:"text-sm text-gray-600",children:"A new inactive policy will be created with the same rules."}),i.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[i.jsx("button",{onClick:()=>x(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),i.jsx("button",{onClick:W,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Copy Policy"})]})]})})]})},LD=({onClose:e,onSuccess:t})=>{var me,je,G,se,Ce;const[n,r]=E.useState(1),[a,s]=E.useState(""),[o,l]=E.useState(!1),[c,u]=E.useState([]),[d,h]=E.useState([]),[f,p]=E.useState(""),[m,x]=E.useState(""),[y,g]=E.useState([]),[v,w]=E.useState([]),[b,N]=E.useState({}),[_,k]=E.useState(""),[j,C]=E.useState({employee_id:"",policy_id:"",adjustment_days:"",adjustment_type:"add",reason:"",from_date:"",to_date:"",leave_request_id:"",leave_type:"Full Day"}),S=[{id:"adjust_balance",title:"Adjust Balance",description:"Add or subtract days from leave balance",icon:tg},{id:"add_leave",title:"Add Leave Manually",description:"Create a new leave entry",icon:Ga},{id:"edit_leave",title:"Edit Existing Leave",description:"Modify an existing leave request",icon:da},{id:"delete_leave",title:"Delete Existing Leave",description:"Remove an existing leave entry",icon:li}];E.useEffect(()=>{M(),A()},[]),E.useEffect(()=>{f?T():(h([]),x(""))},[f]);const M=async()=>{try{const R=await ke.getDepartments();u(R.departments||[])}catch(R){console.error("Failed to load departments:",R),N({submit:"Failed to load departments. Please check your authentication and try again."}),setTimeout(()=>N(Y=>({...Y,submit:""})),5e3)}},T=async()=>{try{const R=await ke.getEmployeesByDepartment(f);h(R.employees||[])}catch(R){console.error("Failed to load employees:",R),N({submit:"Failed to load employees. Please check your authentication and try again."}),setTimeout(()=>N(Y=>({...Y,submit:""})),5e3)}},A=async()=>{l(!0);try{const R=await ke.getCorrectionData();g(R.policies||[]),w(R.leave_requests||[])}catch(R){console.error("Failed to load correction data",R),N({submit:"Failed to load required data"}),setTimeout(()=>N(Y=>({...Y,submit:""})),2e3)}finally{l(!1)}},L=()=>{C({employee_id:"",policy_id:"",adjustment_days:"",adjustment_type:"add",reason:"",from_date:"",to_date:"",leave_request_id:"",leave_type:"Full Day"}),N({}),k("")},O=R=>{s(R),L(),r(2)},U=()=>{n<3&&r(n+1)},z=()=>{n>1&&r(n-1)},F=R=>{(R<=n||R===2&&a||R===3&&a)&&r(R)},W=R=>{var Y,ne,fe,Se,$,le,ve;return R&&(ve=(le=($=(fe=(Y=R.leave_policy_id)!=null?Y:R.policy_id)!=null?fe:(ne=R.policy)==null?void 0:ne.id)!=null?$:(Se=R.policy)==null?void 0:Se.policy_id)!=null?le:R.policy_name)!=null?ve:""},I=R=>{if(!R)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(R))return R;const Y=String(R),ne=new Date(Y);if(!isNaN(ne.getTime())){const fe=ne.getFullYear(),Se=String(ne.getMonth()+1).padStart(2,"0"),$=String(ne.getDate()).padStart(2,"0");return"".concat(fe,"-").concat(Se,"-").concat($)}return""},q=(R,Y,ne=!1)=>{if(!R||!Y)return 0;const fe=ue=>{if(!ue)return null;const Ee=String(ue).split("-").map(Number);if(Ee.length!==3)return null;const[De,We,J]=Ee;return!De||!We||!J?null:new Date(De,We-1,J)},Se=fe(R),$=fe(Y);if(!Se||!$)return 0;const le=$.getTime()-Se.getTime(),ve=Math.floor(le/(24*60*60*1e3))+1;return ve<=0?0:ne?ve-.5:ve},K=()=>{var Y,ne,fe;const R={};return m||(R.employee_id="Employee is required"),a==="adjust_balance"&&(j.policy_id||(R.policy_id="Leave policy is required"),(j.adjustment_days===""||isNaN(Number(j.adjustment_days)))&&(R.adjustment_days="Please enter a valid number of days"),(Y=j.reason)!=null&&Y.trim()||(R.reason="Reason is required")),a==="add_leave"&&(j.policy_id||(R.policy_id="Leave policy is required"),j.from_date||(R.from_date="From date is required"),j.to_date||(R.to_date="To date is required"),j.from_date&&j.to_date&&j.from_date>j.to_date&&(R.to_date="End date must be after start date"),(ne=j.reason)!=null&&ne.trim()||(R.reason="Reason is required")),(a==="edit_leave"||a==="delete_leave")&&(j.leave_request_id||(R.leave_request_id="Leave request is required"),j.policy_id||(R.policy_id="Leave policy is required (from selected leave)"),a==="edit_leave"&&(j.from_date||(R.from_date="From date required"),j.to_date||(R.to_date="To date required"),j.from_date&&j.to_date&&j.from_date>j.to_date&&(R.to_date="End date must be after start date"),(fe=j.reason)!=null&&fe.trim()||(R.reason="Reason is required"))),N(R),Object.keys(R).length===0},re=async()=>{var R,Y,ne,fe,Se,$,le,ve;if(K()){l(!0),N({}),k("");try{const ue={add_leave:"create",edit_leave:"update",delete_leave:"delete",adjust_balance:"adjust_balance"};let Ee=j.policy_id,De;if(a==="delete_leave"){const he=(v||[]).find(nn=>String(nn.id)===String(j.leave_request_id)),$e=I((R=he==null?void 0:he.from_date)!=null?R:j.from_date),Pe=I((Y=he==null?void 0:he.to_date)!=null?Y:j.to_date),nt=!!(he!=null&&he.leave_type&&String(he.leave_type).toLowerCase().includes("half"))||j.leave_type==="Half Day",mt=q($e,Pe,nt);De=Number(mt),Ee=Ee||W(he),j.reason||C(nn=>({...nn,reason:"Deleted leave returned ".concat(mt," day(s)")}))}else if(a==="adjust_balance"){await ke.adjustLeaveBalance(j.employee_id||m,{leave_policy_id:j.policy_id,type:j.adjustment_type==="add"?"credit":"debit",amount:j.adjustment_days,reason:j.reason}),await A(),k("Updated successfully"),setTimeout(()=>{k(""),typeof t=="function"&&t(),e()},1500),l(!1);return}const We=I(j.from_date),J=I(j.to_date),H=j.employee_id||m,ee={action:ue[a],employee_id:H||void 0,leave_policy_id:Ee||void 0,leave_request_id:j.leave_request_id||void 0,from_date:We||void 0,to_date:J||void 0,reason:j.reason||void 0,comment:(fe=(ne=j.reason)==null?void 0:ne.trim())!=null?fe:"",adjustment_days:De!==void 0?De:void 0,update_balance:a==="delete_leave"?!0:void 0,balance_adjustment:a==="delete_leave"?De:void 0,leave_type:j.leave_type||void 0};Object.keys(ee).forEach(he=>ee[he]===void 0&&delete ee[he]),console.debug("applyLeaveCorrection payload:",ee),await ke.applyLeaveCorrection(ee),await A(),k("Updated successfully"),setTimeout(()=>{k(""),typeof t=="function"&&t(),e()},1500)}catch(ue){console.error("Failed to apply correction",ue);const Ee=(le=($=(Se=ue==null?void 0:ue.response)==null?void 0:Se.data)!=null?$:ue==null?void 0:ue.data)!=null?le:null;if(((ve=ue==null?void 0:ue.response)==null?void 0:ve.status)===422&&Ee){const De={};Ee.errors&&typeof Ee.errors=="object"?Object.entries(Ee.errors).forEach(([We,J])=>{const H=We==="leave_policy_id"?"policy_id":We;Array.isArray(J)?De[H]=J.join(" "):De[H]=String(J)}):typeof Ee=="object"?Object.entries(Ee).forEach(([We,J])=>{We==="message"?De.submit=String(J):Array.isArray(J)?De[We]=J.join(" "):De[We]=String(J)}):De.submit="Validation failed",N(De),De.submit&&setTimeout(()=>N(We=>({...We,submit:""})),2e3)}else if(ue!=null&&ue.response){const De=(Ee==null?void 0:Ee.message)||(Ee==null?void 0:Ee.error)||"Server error ".concat(ue.response.status);N({submit:De}),setTimeout(()=>N(We=>({...We,submit:""})),2e3)}else N({submit:(ue==null?void 0:ue.message)||"Failed to apply correction"}),setTimeout(()=>N(De=>({...De,submit:""})),2e3)}finally{l(!1)}}},ie=v.filter(R=>String(R.employee_id)===String(m)),ce=(()=>{var ne,fe,Se;const R=d.find($=>String($.id)===String(m));if(!R||!Array.isArray(R.balances))return null;const Y=R.balances.find($=>String($.policy_id)===String(j.policy_id)||String($.leave_policy_id)===String(j.policy_id));return Y&&(Se=(fe=(ne=Y.balance)!=null?ne:Y.remaining)!=null?fe:Y.days)!=null?Se:null})();return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 md:p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Manual Leave Correction"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Apply corrections to employee leave records"})]}),i.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(kn,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[1,2,3].map(R=>i.jsxs("div",{className:"flex items-center",children:[i.jsx("button",{onClick:()=>F(R),disabled:R>n&&!(R===2&&a)&&!(R===3&&a),className:"flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors ".concat(n>=R?"bg-blue-600 text-white":R===2&&a?"bg-blue-100 text-blue-600 border-2 border-blue-600":"bg-gray-200 text-gray-600"," ").concat(R>n&&!(R===2&&a)&&!(R===3&&a)?"cursor-not-allowed opacity-50":"cursor-pointer hover:bg-blue-700 hover:text-white"),children:R}),i.jsx("span",{className:"ml-2 text-sm font-medium ".concat(n>=R?"text-blue-600":"text-gray-500"),children:R===1?"Action":R===2?"Details":"Review"}),R<3&&i.jsx("div",{className:"hidden sm:block w-8 sm:w-12 h-0.5 mx-2 sm:mx-4 ".concat(n>R?"bg-blue-600":"bg-gray-300")})]},R))})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pb-32",children:[n===1&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Dt,{className:"w-5 h-5 text-blue-600"}),"Select Correction Type"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.map(R=>{const Y=R.icon;return i.jsx("button",{onClick:()=>O(R.id),className:"p-4 border rounded-lg text-left hover:bg-blue-50 transition-colors ".concat(a===R.id?"bg-blue-50 border-blue-300":"bg-white border-gray-200"),children:i.jsxs("div",{className:"flex gap-3",children:[i.jsx(Y,{className:"w-6 h-6 ".concat(a===R.id?"text-blue-600":"text-gray-600")}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-900",children:R.title}),i.jsx("p",{className:"text-sm text-gray-600",children:R.description})]})]})},R.id)})})]}),n===2&&a&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(xn,{className:"w-5 h-5 text-green-600"}),"Employee Selection"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Department"}),i.jsxs("select",{value:f,onChange:R=>{p(R.target.value),x(""),C(Y=>({...Y,employee_id:"",leave_request_id:"",policy_id:""}))},className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select Department"}),c.map(R=>i.jsx("option",{value:R,children:R},R))]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employee *"}),i.jsxs("select",{value:m,onChange:R=>{x(R.target.value),C(Y=>({...Y,employee_id:R.target.value,leave_request_id:"",policy_id:""}))},disabled:!f,className:"w-full border px-3 py-2 rounded-lg disabled:bg-gray-100",children:[i.jsx("option",{value:"",children:"Select Employee"}),d.map(R=>i.jsxs("option",{value:R.id,children:[R.name," (",R.employee_id,")"]},R.id))]}),b.employee_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.employee_id})]})]})]}),(a==="adjust_balance"||a==="add_leave")&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Je,{className:"w-5 h-5 text-purple-600"}),"Leave Policy Configuration"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Leave Policy *"}),i.jsxs("select",{value:j.policy_id,onChange:R=>C(Y=>({...Y,policy_id:R.target.value})),className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select Policy"}),y.map(R=>i.jsx("option",{value:R.id,children:R.name},R.id))]}),b.policy_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.policy_id})]}),ce!==null&&i.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:i.jsxs("p",{className:"text-sm text-blue-800",children:[i.jsx("strong",{children:"Current Balance:"})," ",ce," days"]})})]})]}),a==="adjust_balance"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(tg,{className:"w-5 h-5 text-orange-600"}),"Balance Adjustment"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adjustment Type *"}),i.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[i.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"radio",name:"adj_type",checked:j.adjustment_type==="add",onChange:()=>C(R=>({...R,adjustment_type:"add"}))}),i.jsx("span",{className:"text-sm",children:"Add Days"})]}),i.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"radio",name:"adj_type",checked:j.adjustment_type==="subtract",onChange:()=>C(R=>({...R,adjustment_type:"subtract"}))}),i.jsx("span",{className:"text-sm",children:"Subtract Days"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Days *"}),i.jsx("input",{type:"number",step:"0.5",value:j.adjustment_days,onChange:R=>{const Y=String(R.target.value).replace(/\+/g,"");C(ne=>({...ne,adjustment_days:Y}))},className:"w-full border px-3 py-2 rounded-lg",placeholder:"e.g., 2 or 1.5"}),b.adjustment_days&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.adjustment_days})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),i.jsx("textarea",{value:j.reason,onChange:R=>C(Y=>({...Y,reason:R.target.value})),rows:3,className:"w-full border px-3 py-2 rounded-lg"}),b.reason&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.reason})]})]})]}),a==="add_leave"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Ga,{className:"w-5 h-5 text-green-600"}),"Leave Entry Details"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date *"}),i.jsx("input",{type:"date",value:j.from_date,onChange:R=>C(Y=>({...Y,from_date:R.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),b.from_date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.from_date})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date *"}),i.jsx("input",{type:"date",value:j.to_date,onChange:R=>C(Y=>({...Y,to_date:R.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),b.to_date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.to_date})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Leave Type *"}),i.jsxs("select",{value:j.leave_type,onChange:R=>C(Y=>({...Y,leave_type:R.target.value})),className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"Full Day",children:"Full Day"}),i.jsx("option",{value:"Half Day",children:"Half Day"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),i.jsx("textarea",{value:j.reason,onChange:R=>C(Y=>({...Y,reason:R.target.value})),rows:3,className:"w-full border px-3 py-2 rounded-lg"}),b.reason&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.reason})]})]})]}),(a==="edit_leave"||a==="delete_leave")&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(da,{className:"w-5 h-5 text-indigo-600"}),"Select Leave Request"]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Leave Request *"}),i.jsxs("select",{value:j.leave_request_id,onChange:R=>{const Y=R.target.value,ne=ie.find(ve=>String(ve.id)===String(Y))||(v||[]).find(ve=>String(ve.id)===String(Y)),fe=I(ne==null?void 0:ne.from_date),Se=I(ne==null?void 0:ne.to_date),$=!!(ne!=null&&ne.leave_type&&String(ne.leave_type).toLowerCase().includes("half"))||(ne==null?void 0:ne.half_day)===!0,le=q(fe,Se,$);C(ve=>{var ue,Ee;return{...ve,leave_request_id:Y,from_date:fe,to_date:Se,policy_id:W(ne),adjustment_days:a==="delete_leave"?String(le):ve.adjustment_days,adjustment_type:a==="delete_leave"?"add":ve.adjustment_type,reason:(ue=ne==null?void 0:ne.reason)!=null?ue:ve.reason,leave_type:(Ee=ne==null?void 0:ne.leave_type)!=null?Ee:ve.leave_type}}),N(ve=>({...ve,leave_request_id:void 0,policy_id:void 0}))},className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select leave"}),ie.map(R=>{var Y,ne,fe;return i.jsxs("option",{value:R.id,children:[I(R.from_date),"  ",I(R.to_date)," (",(fe=(ne=(Y=R.policy)==null?void 0:Y.name)!=null?ne:R.policy_name)!=null?fe:"",")"]},R.id)})]}),b.leave_request_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.leave_request_id}),b.policy_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.policy_id})]})})]}),a==="edit_leave"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-5 h-5 text-blue-600"}),"Update Leave Details"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date *"}),i.jsx("input",{type:"date",value:j.from_date,onChange:R=>C(Y=>({...Y,from_date:R.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),b.from_date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.from_date})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date *"}),i.jsx("input",{type:"date",value:j.to_date,onChange:R=>C(Y=>({...Y,to_date:R.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),b.to_date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.to_date})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),i.jsx("textarea",{value:j.reason,onChange:R=>C(Y=>({...Y,reason:R.target.value})),rows:3,className:"w-full border px-3 py-2 rounded-lg"}),b.reason&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.reason})]})]})]}),b.submit&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg mb-6",children:i.jsx("p",{className:"text-red-600 text-sm",children:b.submit})}),_&&i.jsx("div",{className:"bg-green-50 p-3 border border-green-200 rounded-lg mb-6",children:i.jsx("p",{className:"text-green-700 text-sm",children:_})})]}),n===3&&a&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Qt,{className:"w-5 h-5 text-green-600"}),"Review Your Changes"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Correction Type"}),i.jsx("p",{className:"text-gray-700",children:(me=S.find(R=>R.id===a))==null?void 0:me.title})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Employee"}),i.jsx("p",{className:"text-gray-700",children:((je=d.find(R=>String(R.id)===String(m)))==null?void 0:je.name)||"Not selected"})]})]}),a==="adjust_balance"&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Balance Adjustment"}),i.jsxs("p",{className:"text-gray-700",children:[j.adjustment_type==="add"?"Add":"Subtract"," ",j.adjustment_days," days",j.policy_id&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-1",children:["Policy: ",(G=y.find(R=>String(R.id)===String(j.policy_id)))==null?void 0:G.name]})]})]}),a==="add_leave"&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"New Leave Entry"}),i.jsxs("p",{className:"text-gray-700",children:[j.from_date," to ",j.to_date," (",j.leave_type,")",j.policy_id&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-1",children:["Policy: ",(se=y.find(R=>String(R.id)===String(j.policy_id)))==null?void 0:se.name]})]})]}),(a==="edit_leave"||a==="delete_leave")&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:a==="edit_leave"?"Edit Leave":"Delete Leave"}),i.jsxs("p",{className:"text-gray-700",children:[j.from_date," to ",j.to_date,j.policy_id&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-1",children:["Policy: ",(Ce=y.find(R=>String(R.id)===String(j.policy_id)))==null?void 0:Ce.name]})]})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Reason"}),i.jsx("p",{className:"text-gray-700",children:j.reason||"No reason provided"})]})]})]}),b.submit&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-red-600 text-sm",children:b.submit})}),_&&i.jsx("div",{className:"bg-green-50 p-3 border border-green-200 rounded-lg",children:i.jsx("p",{className:"text-green-700 text-sm",children:_})})]})]}),i.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-4 md:p-6 flex gap-3 justify-between",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),n>1&&i.jsx("button",{type:"button",onClick:z,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Previous"})]}),i.jsxs("div",{className:"flex gap-3",children:[n<3&&a&&i.jsx("button",{type:"button",onClick:U,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Next"}),n===3&&a&&i.jsxs("button",{type:"button",onClick:re,disabled:o,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[o?i.jsx(oi,{className:"w-4 h-4 animate-spin"}):i.jsx(Qt,{className:"w-4 h-4"}),"Apply Correction"]})]})]})]})})},dl={pending:{label:"Pending",className:"bg-amber-100 text-amber-700"},approved:{label:"Approved",className:"bg-green-100 text-green-700"},rejected:{label:"Rejected",className:"bg-red-100 text-red-700"},clarification:{label:"Clarification",className:"bg-blue-100 text-blue-700"}},BD={status:"pending",department:"",leave_policy_id:"",start_date:"",end_date:""},WD=()=>{var re,ie,ce,me,je;const[e,t]=E.useState([]),[n,r]=E.useState([]),[a,s]=E.useState(BD),[o,l]=E.useState(1),[c,u]=E.useState({current_page:1,last_page:1}),[d,h]=E.useState(!0),[f,p]=E.useState(null),[m,x]=E.useState(!1),[y,g]=E.useState(null),[v,w]=E.useState({comment:"",from_date:"",to_date:"",admin_reason:"",reject_choice:"reject"}),[b,N]=E.useState(!1),[_,k]=E.useState(null),[j,C]=E.useState(!1),S=E.useMemo(()=>"https://kiosk.quriousclick.es/api".replace(/\/api\/?$/,""),[]),M="https://kiosk.quriousclick.es/api",T=G=>{if(!G)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(G))return G;const se=String(G),Ce=new Date(se);if(!isNaN(Ce.getTime())){const R=Ce.getFullYear(),Y=String(Ce.getMonth()+1).padStart(2,"0"),ne=String(Ce.getDate()).padStart(2,"0");return"".concat(R,"-").concat(Y,"-").concat(ne)}return""},A=async()=>{try{const G=await ke.getLeavePolicies();r(G||[])}catch(G){console.error("Failed to load leave policies",G)}},L=async()=>{h(!0);try{const G={page:o};a.status&&(G.status=a.status),a.department&&String(a.department).trim()!==""&&(G.department=a.department.trim()),a.leave_policy_id&&(G.leave_policy_id=a.leave_policy_id),a.start_date&&(G.start_date=a.start_date),a.end_date&&(G.end_date=a.end_date);const se=await ke.getLeaveApprovals(G),Ce=(se.data||[]).map(R=>({...R,from_date:T(R.from_date),to_date:T(R.to_date)}));t(Ce),u({current_page:se.current_page,last_page:se.last_page})}catch(G){console.error("Failed to load leave approvals",G),k({type:"error",message:"Unable to load leave requests."})}finally{h(!1)}};E.useEffect(()=>{A()},[]),E.useEffect(()=>{l(1),L()},[a]),E.useEffect(()=>{L()},[o]),E.useEffect(()=>{if(_){const G=setTimeout(()=>{k(null)},2e3);return()=>clearTimeout(G)}},[_]);const O=async G=>{x(!0),p(null);try{const se=await ke.getLeaveRequest(G.id),Ce={...se,from_date:T(se.from_date),to_date:T(se.to_date),timelines:(se.timelines||[]).map(R=>({...R,created_at:R.created_at}))};p(Ce)}catch(se){console.error("Failed to load leave request detail",se),k({type:"error",message:"Unable to load leave details."})}finally{x(!1)}},U=()=>{g(null),w({comment:"",from_date:"",to_date:"",admin_reason:"",reject_choice:"reject"})},z=(G,se)=>{g({type:G,request:se}),w({comment:"",from_date:T(se.from_date),to_date:T(se.to_date),admin_reason:"",reject_choice:"reject"})},F=async()=>{if(!y)return;const{type:G,request:se}=y;if(G==="approve"&&(!v.from_date||!v.to_date)){k({type:"error",message:"Please provide valid from and to dates."});return}if(G==="reject"){if(v.reject_choice==="clarify"&&!v.comment.trim()){k({type:"error",message:"Clarification comment is required."});return}if(v.reject_choice==="reject"&&!v.admin_reason.trim()){k({type:"error",message:"Rejection reason is required."});return}}N(!0);try{G==="approve"?(await ke.approveLeaveRequest(se.id,{comment:v.comment,from_date:v.from_date,to_date:v.to_date}),k({type:"success",message:"Request approved successfully."})):G==="reject"&&(v.reject_choice==="clarify"?(await ke.requestLeaveClarification(se.id,{comment:v.comment}),k({type:"success",message:"Clarification requested successfully."})):(await ke.rejectLeaveRequest(se.id,{comment:v.admin_reason}),k({type:"success",message:"Request rejected successfully."}))),U(),L(),f&&f.id===se.id&&O(se)}catch(Ce){console.error("Action failed",Ce),k({type:"error",message:(Ce==null?void 0:Ce.message)||"Action failed. Please try again."})}finally{N(!1)}},W=(G,se)=>{const Ce=localStorage.getItem("authToken");if(se){const R=new URL("".concat(M,"/leave/requests/").concat(se,"/download"));return R.searchParams.set("token",Ce),R.toString()}return G?"".concat(S,"/storage/").concat(G):null},I=Object.keys(dl),q=(f==null?void 0:f.timelines)||[],K=G=>{const se=dl[G]||dl.pending;return i.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat(se.className),children:se.label})};return i.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 md:p-6",children:[i.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Leave Approvals"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Review leave requests, apply sandwich rules, and manage workflows."})]}),i.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[i.jsx(Ef,{className:"w-4 h-4"}),"Manual Leave Correction"]})]}),_&&i.jsx("div",{className:"px-4 py-3 rounded-lg text-sm font-medium ".concat(_.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:_.message}),i.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm p-4 space-y-4",children:[i.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(G=>i.jsx("button",{onClick:()=>{s(se=>({...se,status:G}))},className:"px-4 py-2 rounded-full text-sm font-medium border transition-colors ".concat(a.status===G?"bg-blue-600 text-white border-blue-600":"border-gray-200 text-gray-600 hover:bg-gray-50"),children:dl[G].label},G))}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[i.jsx(ci,{className:"w-4 h-4 text-gray-400"}),"Department"]}),i.jsx("input",{type:"text",value:a.department,onChange:G=>{s(se=>({...se,department:G.target.value}))},placeholder:"All departments",className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[i.jsx(Je,{className:"w-4 h-4 text-gray-400"}),"From date"]}),i.jsx("input",{type:"date",value:a.start_date,onChange:G=>{s(se=>({...se,start_date:G.target.value}))},className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[i.jsx(Je,{className:"w-4 h-4 text-gray-400"}),"To date"]}),i.jsx("input",{type:"date",value:a.end_date,onChange:G=>{s(se=>({...se,end_date:G.target.value}))},className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[i.jsx(Sf,{className:"w-4 h-4 text-gray-400"}),"Leave type"]}),i.jsxs("select",{value:a.leave_policy_id,onChange:G=>{s(se=>({...se,leave_policy_id:G.target.value}))},className:"w-full border border-gray-200 rounded-lg px-3 py-2",children:[i.jsx("option",{value:"",children:"All leave types"}),n.map(G=>i.jsx("option",{value:G.id,children:G.name},G.id))]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"xl:col-span-2 space-y-4",children:[d?i.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-6 flex justify-center items-center",children:i.jsx(oi,{className:"w-6 h-6 animate-spin text-blue-600"})}):e.length===0?i.jsx("div",{className:"bg-white rounded-2xl border border-dashed border-gray-300 p-10 text-center text-gray-500",children:"No leave requests found for the selected filters."}):e.map(G=>{var se,Ce,R;return i.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-4 md:p-5 flex flex-col gap-3",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:((se=G.employee)==null?void 0:se.department)||"General"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:(Ce=G.employee)==null?void 0:Ce.name}),i.jsx("p",{className:"text-xs text-gray-500",children:(R=G.policy)==null?void 0:R.name})]}),K(G.status)]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm text-gray-600",children:[i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wide",children:"Dates"}),i.jsxs("p",{className:"font-semibold text-gray-800",children:[T(G.from_date),"  ",T(G.to_date)]}),i.jsxs("p",{className:"text-xs text-gray-500",children:[G.estimated_days," days"]})]}),i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wide",children:"Sandwich rule"}),i.jsx("p",{className:"font-semibold text-gray-800",children:G.sandwich_rule_applied?"".concat(G.sandwich_applied_days," days added"):"Not applied"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Policy setting controls reset"})]}),i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wide",children:"Reason"}),i.jsx("p",{className:"font-semibold text-gray-800 line-clamp-2",children:G.reason||"N/A"})]})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[G.attachment_path&&i.jsxs("a",{href:W(G.attachment_path,G.id),target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700",children:[i.jsx(si,{className:"w-4 h-4"}),"Attachment"]}),i.jsxs("button",{onClick:()=>O(G),className:"inline-flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900 ml-auto",children:["View timeline",i.jsx(Cf,{className:"w-4 h-4"})]})]}),G.status==="pending"&&i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs("button",{onClick:()=>z("approve",G),className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-green-50 text-green-700 hover:bg-green-100",children:[i.jsx(s_,{className:"w-4 h-4"}),"Approve"]}),i.jsxs("button",{onClick:()=>z("reject",G),className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100",children:[i.jsx(ao,{className:"w-4 h-4"}),"Reject"]})]})]},G.id)}),c.last_page>1&&i.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm p-4 flex items-center justify-between",children:[i.jsx("button",{disabled:c.current_page===1,onClick:()=>l(G=>Math.max(1,G-1)),className:"px-4 py-2 rounded-lg border text-sm font-medium disabled:opacity-50",children:"Previous"}),i.jsxs("p",{className:"text-sm text-gray-500",children:["Page ",c.current_page," of ",c.last_page]}),i.jsx("button",{disabled:c.current_page===c.last_page,onClick:()=>l(G=>G+1),className:"px-4 py-2 rounded-lg border text-sm font-medium disabled:opacity-50",children:"Next"})]})]}),i.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm p-5 sticky top-4 h-fit",children:[i.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(xn,{className:"w-5 h-5 text-blue-600"}),"Request detail"]}),m?i.jsx("div",{className:"flex items-center justify-center py-12 text-gray-500",children:i.jsx(oi,{className:"w-5 h-5 animate-spin"})}):f?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Employee"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:(re=f.employee)==null?void 0:re.name}),i.jsx("p",{className:"text-xs text-gray-500",children:(ie=f.employee)==null?void 0:ie.department})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-600",children:[i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Policy"}),i.jsx("p",{className:"font-semibold text-gray-900",children:(ce=f.policy)==null?void 0:ce.name}),i.jsx("p",{className:"text-xs text-gray-500",children:(me=f.policy)==null?void 0:me.code})]}),i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Duration"}),i.jsxs("p",{className:"font-semibold text-gray-900",children:[T(f.from_date),"  ",T(f.to_date)]}),i.jsxs("p",{className:"text-xs text-gray-500",children:[f.estimated_days," days + ",f.sandwich_applied_days," sandwich"]})]})]}),i.jsxs("div",{className:"border border-gray-100 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Reason"}),i.jsx("p",{className:"text-sm text-gray-800",children:f.reason||"No reason provided"})]}),f.attachment_path&&i.jsxs("a",{className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700",href:W(f.attachment_path,f.id),target:"_blank",rel:"noreferrer",children:[i.jsx(si,{className:"w-4 h-4"}),"Download document"]}),i.jsxs("div",{children:[i.jsxs("p",{className:"text-xs text-gray-500 uppercase mb-2 flex items-center gap-2",children:[i.jsx(N_,{className:"w-4 h-4 text-gray-400"}),"Timeline"]}),i.jsx("div",{className:"space-y-3 max-h-72 overflow-y-auto pr-2",children:q.length===0?i.jsx("p",{className:"text-sm text-gray-500",children:"No timeline entries yet."}):q.map(G=>i.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 text-sm",children:[i.jsx("p",{className:"font-semibold text-gray-800 capitalize",children:G.action.replace("_"," ")}),i.jsx("p",{className:"text-xs text-gray-500",children:new Date(G.created_at).toLocaleString()}),G.notes&&i.jsx("p",{className:"text-sm text-gray-700 mt-1",children:G.notes})]},G.id))})]})]}):i.jsx("div",{className:"text-sm text-gray-500",children:"Select a request to view its timeline & attachments."})]})]})]}),y&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-xl",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 capitalize",children:y.type==="reject"?"Reject / Ask clarification":"".concat(y.type," leave")}),i.jsxs("p",{className:"text-sm text-gray-500",children:["For ",(je=y.request.employee)==null?void 0:je.name]})]}),i.jsxs("div",{className:"px-6 py-4 space-y-4",children:[y.type==="approve"&&i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"From date"}),i.jsx("input",{type:"date",value:v.from_date,onChange:G=>w(se=>({...se,from_date:G.target.value})),className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"To date"}),i.jsx("input",{type:"date",value:v.to_date,onChange:G=>w(se=>({...se,to_date:G.target.value})),className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]})]}),y.type==="reject"&&i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Action"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-2 border rounded-lg cursor-pointer ".concat(v.reject_choice==="reject"?"bg-red-50 border-red-200":"bg-white"),children:[i.jsx("input",{type:"radio",name:"reject_choice",value:"reject",checked:v.reject_choice==="reject",onChange:G=>w(se=>({...se,reject_choice:G.target.value}))}),"Reject"]}),i.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-2 border rounded-lg cursor-pointer ".concat(v.reject_choice==="clarify"?"bg-blue-50 border-blue-200":"bg-white"),children:[i.jsx("input",{type:"radio",name:"reject_choice",value:"clarify",checked:v.reject_choice==="clarify",onChange:G=>w(se=>({...se,reject_choice:G.target.value}))}),"Ask for clarification"]})]}),v.reject_choice==="reject"?i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Reason (required)"}),i.jsx("textarea",{value:v.admin_reason,onChange:G=>w(se=>({...se,admin_reason:G.target.value})),rows:3,className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}):i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Clarification required (required)"}),i.jsx("textarea",{value:v.comment,onChange:G=>w(se=>({...se,comment:G.target.value})),rows:3,className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]})]}),y.type!=="reject"&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Comment"}),i.jsx("textarea",{value:v.comment,onChange:G=>w(se=>({...se,comment:G.target.value})),rows:3,placeholder:y.type==="clarify"?"Explain what details you need from the employee.":"Optional note to the employee.",className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]})]}),i.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center gap-3 justify-end",children:[i.jsx("button",{onClick:U,className:"px-4 py-2 rounded-lg border text-sm font-medium text-gray-600 hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{onClick:F,disabled:b,className:"px-4 py-2 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:b?"Processing...":"Submit"})]})]})}),j&&i.jsx(LD,{onClose:()=>C(!1),onSuccess:()=>{C(!1),L(),k({type:"success",message:"Leave correction completed successfully."})}})]})},$D=({onClose:e,onSuccess:t,selectedEmployee:n,startDate:r,endDate:a,attendanceLogs:s})=>{var fe,Se;const[o,l]=E.useState(1),[c,u]=E.useState(""),[d,h]=E.useState(!1),[f,p]=E.useState({}),[m,x]=E.useState(""),[y,g]=E.useState(""),[v,w]=E.useState([]),[b,N]=E.useState([]),[_,k]=E.useState(""),[j,C]=E.useState(n||""),[S,M]=E.useState("today"),[T,A]=E.useState(r||""),[L,O]=E.useState(a||""),[U,z]=E.useState(s||[]),[F,W]=E.useState({date:r||"",check_in:"",check_out:"",reason:"",breaks:[],attendance_id:""}),I=[{id:"add_attendance",title:"Add New Attendance",description:"Create a new attendance record",icon:Ga},{id:"edit_attendance",title:"Edit Existing Attendance",description:"Modify an existing attendance record",icon:da}];E.useEffect(()=>{K()},[]),E.useEffect(()=>{_?re():(N([]),C(""))},[_]),E.useEffect(()=>{c==="edit_attendance"&&(U==null?void 0:U.length)>0&&se(U[0].id)},[c,U]);const q=()=>{W({date:r||"",check_in:"",check_out:"",reason:"",breaks:[],attendance_id:""}),p({}),x(""),g("")},K=async()=>{try{const $=await ke.getDepartments();w($.departments||[])}catch($){console.error("Failed to load departments:",$),p({submit:"Failed to load departments. Please check your authentication and try again."}),setTimeout(()=>p(le=>({...le,submit:""})),5e3)}},re=async()=>{try{const $=await ke.getEmployeesByDepartment(_);N($.employees||[])}catch($){console.error("Failed to load employees:",$)}},ie=async()=>{if(!j||!T||!L){p({submit:"Please select employee and date range"}),setTimeout(()=>p($=>({...$,submit:""})),2e3);return}h(!0),p({});try{const le=(await ke.getAttendanceLogs(j,T,L)).attendances||[];z(le),le.length>0?(x("Attendance logs loaded successfully"),setTimeout(()=>x(""),2e3)):(g("No logs found for the selected period"),setTimeout(()=>g(""),2e3))}catch($){p({submit:"Failed to fetch attendance logs"}),setTimeout(()=>p(le=>({...le,submit:""})),2e3)}finally{h(!1)}},ce=async $=>{if(u($),q(),$==="edit_attendance"&&U.length===0){h(!0);try{if(await ie(),U.length===0){p({action:"No attendance records found for the selected period. Please check the date range or add a new attendance record instead."}),setTimeout(()=>p(le=>({...le,action:""})),3e3),u(""),h(!1);return}}catch(le){p({action:"Failed to fetch attendance logs. Please try again."}),setTimeout(()=>p(ve=>({...ve,action:""})),3e3),u(""),h(!1);return}h(!1)}l(3)},me=()=>{o===1?l(2):o===2&&c&&l(3)},je=()=>{o>1&&l(o-1)},G=$=>{($<=o||$===2&&U.length>0||$===3&&c)&&l($)},se=$=>{const le=U.find(ve=>ve.id===parseInt($));le&&W({date:le.date,check_in:le.check_in||"",check_out:le.check_out||"",reason:"",breaks:le.breaks?le.breaks.map(ve=>({break_start:ve.break_start||"",break_end:ve.break_end||""})):[],attendance_id:le.id})},Ce=()=>{W($=>({...$,breaks:[...$.breaks||[],{break_start:"",break_end:""}]}))},R=$=>{W(le=>({...le,breaks:le.breaks.filter((ve,ue)=>ue!==$)}))},Y=()=>{var le,ve;const $={};return c==="add_attendance"&&(j||($.employee="Employee selection is required"),F.date||($.date="Date is required"),(le=F.reason)!=null&&le.trim()||($.reason="Reason is required"),F.check_in||F.check_out||F.breaks&&F.breaks.some(Ee=>Ee.break_start||Ee.break_end)||($.timing="At least one timing field (check-in, check-out, or break) is required")),c==="edit_attendance"&&(j||($.employee="Employee selection is required"),F.attendance_id||($.attendance_id="Attendance record is required"),(ve=F.reason)!=null&&ve.trim()||($.reason="Reason is required"),F.check_in||F.check_out||F.breaks&&F.breaks.some(Ee=>Ee.break_start||Ee.break_end)||($.timing="At least one timing field (check-in, check-out, or break) is required")),p($),Object.keys($).length===0},ne=async()=>{if(Y()){h(!0),p({}),x("");try{const $={reason:F.reason,check_in:F.check_in||null,check_out:F.check_out||null};F.breaks&&Array.isArray(F.breaks)&&($.breaks=F.breaks.map(le=>({break_start:le.break_start||null,break_end:le.break_end||null}))),c==="add_attendance"?($.employee_id=j,$.date=F.date,await ke.addNewAttendance($)):c==="edit_attendance"&&await ke.updateAttendanceRecord(F.attendance_id,$),x("Attendance updated successfully"),setTimeout(()=>{x(""),typeof t=="function"&&t(),e()},1500)}catch($){p({submit:$.message||"Failed to update attendance"}),setTimeout(()=>p(le=>({...le,submit:""})),2e3)}finally{h(!1)}}};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden",children:[i.jsxs("div",{className:"flex-shrink-0 bg-white border-b border-gray-200 p-4 md:p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Attendance Correction Wizard"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Apply corrections to employee attendance records"})]}),i.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(kn,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[1,2,3].map($=>i.jsxs("div",{className:"flex items-center",children:[i.jsx("button",{onClick:()=>G($),disabled:$>o&&!($===2&&c)&&!($===3&&c),className:"flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors ".concat(o>=$?"bg-blue-600 text-white":$===2&&c?"bg-blue-100 text-blue-600 border-2 border-blue-600":"bg-gray-200 text-gray-600"," ").concat($>o&&!($===2&&c)&&!($===3&&c)?"cursor-not-allowed opacity-50":"cursor-pointer hover:bg-blue-700 hover:text-white"),children:$}),i.jsx("span",{className:"ml-2 text-xs sm:text-sm font-medium ".concat(o>=$?"text-blue-600":"text-gray-500"),children:$===1?"Emp & Date":$===2?"Select Action":"Config Details"}),$<3&&i.jsx("div",{className:"hidden sm:block w-8 sm:w-12 h-0.5 mx-2 sm:mx-4 ".concat(o>$?"bg-blue-600":"bg-gray-300")})]},$))})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[o===1&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Gn,{className:"w-5 h-5 text-blue-600"}),"Employee Selection"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Department"}),i.jsxs("select",{value:_,onChange:$=>{k($.target.value),C(""),z([])},className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select Department"}),v.map($=>i.jsx("option",{value:$,children:$},$))]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employee"}),i.jsxs("select",{value:j,onChange:$=>{C($.target.value),z([])},disabled:!_,className:"w-full border px-3 py-2 rounded-lg disabled:bg-gray-100",children:[i.jsx("option",{value:"",children:"Select Employee"}),b.map($=>i.jsxs("option",{value:$.id,children:[$.name," (",$.employee_id,")"]},$.id))]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date Range"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"radio",id:"wizard-today",name:"wizard-dateRange",value:"today",checked:S==="today",onChange:$=>{M($.target.value);const le=new Date().toISOString().split("T")[0];A(le),O(le)}}),i.jsx("label",{htmlFor:"wizard-today",className:"text-sm",children:"Today"}),i.jsx("input",{type:"radio",id:"wizard-custom",name:"wizard-dateRange",value:"custom",checked:S==="custom",onChange:$=>{M($.target.value),A(""),O("")}}),i.jsx("label",{htmlFor:"wizard-custom",className:"text-sm",children:"Custom"})]})]})]}),S==="custom"&&i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),i.jsx("input",{type:"date",value:T,onChange:$=>A($.target.value),className:"w-full border px-3 py-2 rounded-lg"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Date"}),i.jsx("input",{type:"date",value:L,onChange:$=>O($.target.value),className:"w-full border px-3 py-2 rounded-lg"})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsxs("button",{onClick:ie,disabled:!j||!T||!L||d,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[d&&i.jsx(oi,{className:"w-4 h-4 animate-spin"}),"Fetch Attendance Logs"]}),f.employee&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.employee})]}),y&&i.jsx("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:i.jsx("p",{className:"text-sm text-orange-800",children:y})})]}),U.length>0&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Je,{className:"w-5 h-5 text-green-600"}),"Attendance Records (",U.length,")"]}),i.jsx("div",{className:"max-h-60 overflow-y-auto",children:i.jsx("div",{className:"space-y-2",children:U.map($=>{const le=ve=>{if(!ve)return"";const ue=new Date(ve),Ee=String(ue.getDate()).padStart(2,"0"),De=String(ue.getMonth()+1).padStart(2,"0"),We=ue.getFullYear();return"".concat(Ee,"-").concat(De,"-").concat(We)};return i.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Je,{className:"w-4 h-4 text-gray-500"}),i.jsx("span",{className:"font-medium text-gray-900",children:le($.date)})]}),i.jsxs("div",{className:"text-sm text-gray-600",children:[$.check_in||"No check-in"," - ",$.check_out||"No check-out"]})]}),$.breaks&&$.breaks.length>0&&i.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[i.jsx("span",{className:"font-medium",children:"Breaks:"})," ",$.breaks.map((ve,ue)=>i.jsxs("span",{children:[ve.break_start||"??:??"," - ",ve.break_end||"??:??",ue<$.breaks.length-1?", ":""]},ue))]})]},$.id)})})})]})]}),o===2&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Dt,{className:"w-5 h-5 text-blue-600"}),"Select Correction Type"]}),f.action&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg mb-4",children:i.jsx("p",{className:"text-red-600 text-sm",children:f.action})}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:I.map($=>{const le=$.icon;return i.jsx("button",{onClick:()=>!d&&ce($.id),disabled:d,className:"p-4 border rounded-lg text-left transition-colors ".concat(d?"bg-gray-100 border-gray-200 cursor-not-allowed opacity-50":c===$.id?"bg-blue-50 border-blue-300 hover:bg-blue-50":"bg-white border-gray-200 hover:bg-blue-50"),children:i.jsxs("div",{className:"flex gap-3",children:[i.jsx(le,{className:"w-6 h-6 ".concat(c===$.id?"text-blue-600":"text-gray-600")}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-900",children:$.title}),i.jsx("p",{className:"text-sm text-gray-600",children:$.description})]})]})},$.id)})})]}),o===3&&c&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Gn,{className:"w-5 h-5 text-blue-600"}),"Employee Selection"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Department"}),i.jsxs("select",{value:_,onChange:$=>{k($.target.value),C(""),z([])},className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select Department"}),v.map($=>i.jsx("option",{value:$,children:$},$))]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employee"}),i.jsxs("select",{value:j,onChange:$=>{C($.target.value),z([])},disabled:!_,className:"w-full border px-3 py-2 rounded-lg disabled:bg-gray-100",children:[i.jsx("option",{value:"",children:"Select Employee"}),b.map($=>i.jsxs("option",{value:$.id,children:[$.name," (",$.employee_id,")"]},$.id))]})]})]}),U.length>0&&i.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:i.jsxs("p",{className:"text-sm text-green-800",children:["Found ",U.length," attendance record(s) for the selected period"]})})]}),c==="add_attendance"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Je,{className:"w-5 h-5 text-green-600"}),"Attendance Date"]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date *"}),i.jsx("input",{type:"date",value:F.date,onChange:$=>W(le=>({...le,date:$.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),f.date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.date})]})})]}),c==="edit_attendance"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(xn,{className:"w-5 h-5 text-indigo-600"}),"Select Attendance Record"]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attendance Record *"}),i.jsxs("select",{value:F.attendance_id,onChange:$=>se($.target.value),className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select attendance record"}),U.map($=>{const le=ve=>{if(!ve)return"";const ue=new Date(ve),Ee=String(ue.getDate()).padStart(2,"0"),De=String(ue.getMonth()+1).padStart(2,"0"),We=ue.getFullYear();return"".concat(Ee,"-").concat(De,"-").concat(We)};return i.jsxs("option",{value:$.id,children:[le($.date)," - ",$.check_in||"No check-in"," to ",$.check_out||"No check-out"]},$.id)})]}),f.attendance_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.attendance_id})]})})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-5 h-5 text-blue-600"}),"Timing Details"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Check In"}),i.jsx("input",{type:"time",value:F.check_in,onChange:$=>W(le=>({...le,check_in:$.target.value})),className:"w-full border px-3 py-2 rounded-lg"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Check Out"}),i.jsx("input",{type:"time",value:F.check_out,onChange:$=>W(le=>({...le,check_out:$.target.value})),className:"w-full border px-3 py-2 rounded-lg"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Breaks"}),i.jsxs("div",{className:"space-y-3",children:[(F.breaks||[]).map(($,le)=>i.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg border border-gray-200",children:[i.jsx("input",{type:"time",value:$.break_start,onChange:ve=>{const ue=[...F.breaks];ue[le].break_start=ve.target.value,W(Ee=>({...Ee,breaks:ue}))},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Start time"}),i.jsx("span",{className:"text-gray-500",children:"-"}),i.jsx("input",{type:"time",value:$.break_end,onChange:ve=>{const ue=[...F.breaks];ue[le].break_end=ve.target.value,W(Ee=>({...Ee,breaks:ue}))},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"End time"}),i.jsx("button",{onClick:()=>R(le),className:"text-red-500 hover:text-red-700 transition-colors p-1",type:"button",children:i.jsx(kn,{className:"w-4 h-4"})})]},le)),i.jsxs("button",{onClick:Ce,className:"text-indigo-600 hover:text-indigo-800 transition-colors flex items-center gap-2 text-sm font-medium",type:"button",children:[i.jsx(Ga,{className:"w-4 h-4"}),"Add Break"]})]})]}),f.timing&&i.jsx("p",{className:"text-red-600 text-sm",children:f.timing})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(xn,{className:"w-5 h-5 text-purple-600"}),"Correction Reason"]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),i.jsx("textarea",{value:F.reason,onChange:$=>W(le=>({...le,reason:$.target.value})),rows:4,className:"w-full border px-3 py-2 rounded-lg",placeholder:"Please explain the reason for this attendance correction"}),f.reason&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.reason})]})})]}),f.submit&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg mb-6",children:i.jsx("p",{className:"text-red-600 text-sm",children:f.submit})}),m&&i.jsx("div",{className:"bg-green-50 p-3 border border-green-200 rounded-lg mb-6",children:i.jsx("p",{className:"text-green-700 text-sm",children:m})})]}),o===3&&c&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Qt,{className:"w-5 h-5 text-green-600"}),"Review Your Changes"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Correction Type"}),i.jsx("p",{className:"text-gray-700",children:(fe=I.find($=>$.id===c))==null?void 0:fe.title})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Employee"}),i.jsx("p",{className:"text-gray-700",children:((Se=b.find($=>String($.id)===String(j)))==null?void 0:Se.name)||"Not selected"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Date"}),i.jsx("p",{className:"text-gray-700",children:F.date||"Not specified"})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Date Range"}),i.jsxs("p",{className:"text-gray-700",children:[T," to ",L]})]})]}),c==="add_attendance"&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"New Attendance Entry"}),i.jsxs("p",{className:"text-gray-700",children:["Check-in: ",F.check_in||"Not specified",i.jsx("br",{}),"Check-out: ",F.check_out||"Not specified",F.breaks&&F.breaks.length>0&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-2",children:["Breaks: ",F.breaks.filter($=>$.break_start||$.break_end).length," break(s)"]})]})]}),c==="edit_attendance"&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Edit Existing Attendance"}),i.jsxs("p",{className:"text-gray-700",children:["Check-in: ",F.check_in||"Not specified",i.jsx("br",{}),"Check-out: ",F.check_out||"Not specified",F.breaks&&F.breaks.length>0&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-2",children:["Breaks: ",F.breaks.filter($=>$.break_start||$.break_end).length," break(s)"]})]})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Reason"}),i.jsx("p",{className:"text-gray-700",children:F.reason||"No reason provided"})]})]})]}),f.submit&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-red-600 text-sm",children:f.submit})}),m&&i.jsx("div",{className:"bg-green-50 p-3 border border-green-200 rounded-lg",children:i.jsx("p",{className:"text-green-700 text-sm",children:m})})]})]}),i.jsxs("div",{className:"flex-shrink-0 bg-white border-t border-gray-200 p-4 md:p-6 flex gap-3 justify-between",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),o>1&&i.jsx("button",{type:"button",onClick:je,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Previous"})]}),i.jsxs("div",{className:"flex gap-3",children:[o===1&&i.jsx("button",{type:"button",onClick:me,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Continue"}),o===2&&c&&i.jsx("button",{type:"button",onClick:me,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Next"}),o===3&&c&&i.jsxs("button",{type:"button",onClick:ne,disabled:d,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[d?i.jsx(oi,{className:"w-4 h-4 animate-spin"}):i.jsx(Qt,{className:"w-4 h-4"}),"Apply Correction"]})]})]})]})})},zD=()=>{const[e,t]=E.useState([]),[n,r]=E.useState(!0),[a,s]=E.useState(null),[o,l]=E.useState("pending"),[c,u]=E.useState({show:!1,type:"success",message:""}),[d,h]=E.useState(!1),[f,p]=E.useState(null),[m,x]=E.useState({check_in:"",check_out:"",reason:""});E.useEffect(()=>{if(!localStorage.getItem("authToken")){u({show:!0,type:"error",message:"Authentication required. Please log in again."});return}y()},[o]),E.useEffect(()=>{if(c.show){const N=setTimeout(()=>{u({show:!1,type:"success",message:""})},2e3);return()=>clearTimeout(N)}},[c.show]);const y=async()=>{r(!0);try{const N=await ke.get("/admin/correction-requests?status=".concat(o));t(N.requests||[])}catch(N){console.error("Error loading correction requests:",N),N.message&&N.message.includes("Authentication")?(u({show:!0,type:"error",message:"Authentication failed. Please log in again."}),localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("isAuthenticated"),setTimeout(()=>{window.location.href="/login"},2e3)):N.message&&N.message.includes("permission")?u({show:!0,type:"error",message:"You do not have permission to access this resource."}):N.message&&N.message.includes("Server error")?u({show:!0,type:"error",message:"Server error. Please try again later."}):u({show:!0,type:"error",message:N.message||"Failed to load correction requests"})}finally{r(!1)}},g=async N=>{s(N);try{await ke.post("/admin/correction-requests/".concat(N,"/approve")),u({show:!0,type:"success",message:"Correction request approved successfully"}),y()}catch(_){u({show:!0,type:"error",message:_.message||"An error occurred while approving request"})}finally{s(null)}},v=async N=>{s(N);try{await ke.post("/admin/correction-requests/".concat(N,"/reject")),u({show:!0,type:"success",message:"Correction request rejected successfully"}),y()}catch(_){u({show:!0,type:"error",message:_.message||"An error occurred while rejecting request"})}finally{s(null)}},w=()=>{const N=[];if(!m.check_in&&!m.check_out&&N.push("At least one time field (check-in or check-out) must be provided"),m.check_in){const[_,k]=m.check_in.split(":").map(Number);(_<0||_>23||k<0||k>59)&&N.push("Invalid check-in time format")}if(m.check_out){const[_,k]=m.check_out.split(":").map(Number);(_<0||_>23||k<0||k>59)&&N.push("Invalid check-out time format")}return m.check_in&&m.check_out&&m.check_out<=m.check_in&&N.push("Check-out time must be after check-in time"),m.reason.trim()?m.reason.trim().length<10?N.push("Reason must be at least 10 characters long"):m.reason.trim().length>500&&N.push("Reason cannot exceed 500 characters"):N.push("Reason for edit is required"),N},b=async N=>{N.preventDefault();const _=w();if(_.length>0){u({show:!0,type:"error",message:"Validation errors: ".concat(_.join(", "))});return}s("edit");try{const k={check_in:m.check_in||null,check_out:m.check_out||null,reason:m.reason.trim()};await ke.put("/admin/attendance/".concat(f.id),k),u({show:!0,type:"success",message:"Attendance record updated successfully"}),p(null),x({check_in:"",check_out:"",reason:""}),y()}catch(k){console.error("Error updating attendance:",k),k.message&&k.message.includes("Validation error")?u({show:!0,type:"error",message:k.message}):k.message&&k.message.includes("not found")?u({show:!0,type:"error",message:"Attendance record not found"}):k.message&&k.message.includes("exists")?u({show:!0,type:"error",message:"Another attendance record exists for this time slot"}):k.name==="TypeError"&&k.message.includes("fetch")?u({show:!0,type:"error",message:"Network error. Please check your connection and try again."}):u({show:!0,type:"error",message:k.message||"An error occurred while updating attendance. Please try again."})}finally{s(null)}};return i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Attendance Correction Requests"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Manage employee attendance correction requests"})]}),i.jsx("div",{className:"flex items-center gap-4",children:i.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium",children:[i.jsx(Ef,{className:"w-4 h-4"}),i.jsx("span",{children:"Admin Attendance Correction"})]})})]}),c.show&&i.jsx("div",{className:"px-4 py-3 rounded-lg text-sm font-medium ".concat(c.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:c.message}),f&&i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(eg,{className:"w-5 h-5 text-gray-600"}),"Edit Attendance Record"]}),i.jsxs("form",{onSubmit:b,className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),"Check-in Time"]}),i.jsx("input",{type:"time",value:m.check_in,onChange:N=>x({...m,check_in:N.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),"Check-out Time"]}),i.jsx("input",{type:"time",value:m.check_out,onChange:N=>x({...m,check_out:N.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xn,{className:"w-4 h-4 text-gray-500"}),"Reason for Edit"]}),i.jsx("textarea",{value:m.reason,onChange:N=>x({...m,reason:N.target.value}),rows:4,className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors resize-none",placeholder:"Please explain the reason for editing this attendance record",required:!0})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:i.jsxs("div",{className:"flex space-x-3",children:[i.jsxs("button",{type:"button",onClick:()=>p(null),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",children:[i.jsx(ao,{className:"w-4 h-4"}),"Cancel"]}),i.jsx("button",{type:"submit",disabled:a==="edit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:a==="edit"?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(eg,{className:"w-4 h-4"}),"Update Attendance"]})})]})})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow",children:[i.jsx("div",{className:"border-b border-gray-200",children:i.jsx("nav",{className:"flex space-x-4 md:space-x-8 px-4 md:px-6 overflow-x-auto",children:[{id:"pending",label:"Pending"},{id:"approved",label:"Approved"},{id:"rejected",label:"Rejected"},{id:"all",label:"All"}].map(N=>i.jsx("button",{onClick:()=>l(N.id),className:"py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ".concat(o===N.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:N.label},N.id))})}),i.jsx("div",{className:"p-6",children:n?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"}),i.jsx("p",{className:"text-gray-500 mt-2",children:"Loading requests..."})]}):e.length===0?i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-gray-500",children:"No correction requests found."})}):i.jsx("div",{className:"space-y-4",children:e.map(N=>i.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-900",children:N.employee.name}),i.jsx("span",{className:"text-sm text-gray-500",children:N.employee.employee_id}),i.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(N.status==="approved"?"bg-green-100 text-green-800":N.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:N.status})]}),i.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Request Type"}),i.jsx("p",{className:"font-medium text-gray-900 capitalize",children:N.type?N.type.replace("_"," "):"Type not specified"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Submitted"}),i.jsx("p",{className:"font-medium text-gray-900",children:N.submitted_at})]}),N.type!=="wrong_break"&&(N.requested_check_in||N.requested_check_out)&&i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Requested Times"}),i.jsxs("p",{className:"font-medium text-gray-900",children:[N.requested_check_in||"N/A"," - ",N.requested_check_out||"N/A"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Requested Breaks"}),N.requested_breaks&&Array.isArray(N.requested_breaks)&&N.requested_breaks.length>0?i.jsx("div",{className:"space-y-1",children:N.requested_breaks.map((_,k)=>i.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:["Break ",k+1,": ",(_==null?void 0:_.break_start)||"N/A"," - ",(_==null?void 0:_.break_end)||"N/A"]},k))}):i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"No breaks requested"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Current Breaks"}),N.attendance&&N.attendance.breaks&&Array.isArray(N.attendance.breaks)&&N.attendance.breaks.length>0?i.jsx("div",{className:"space-y-1",children:N.attendance.breaks.map((_,k)=>i.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:["Break ",k+1,": ",(_==null?void 0:_.break_start)||"N/A"," - ",(_==null?void 0:_.break_end)||"N/A"]},k))}):i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"No breaks"})]}),N.attendance&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Current Attendance"}),i.jsxs("p",{className:"font-medium text-gray-900",children:[N.attendance.check_in||"N/A"," - ",N.attendance.check_out||"N/A"]})]}),N.attendance&&i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Current Breaks"}),N.attendance.breaks&&Array.isArray(N.attendance.breaks)&&N.attendance.breaks.length>0?i.jsx("div",{className:"space-y-1",children:N.attendance.breaks.map((_,k)=>i.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:["Break ",k+1,": ",(_==null?void 0:_.break_start)||"N/A"," - ",(_==null?void 0:_.break_end)||"N/A"]},k))}):i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"No breaks"})]})]})]}),i.jsxs("div",{className:"mt-3",children:[i.jsx("p",{className:"text-gray-500 text-sm",children:"Reason"}),i.jsx("p",{className:"text-gray-900 mt-1",children:N.reason})]})]}),N.status==="pending"&&i.jsxs("div",{className:"flex space-x-2 ml-4",children:[i.jsx("button",{onClick:()=>g(N.id),disabled:a===N.id,className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 disabled:opacity-50",children:a===N.id?"Approving...":"Approve"}),i.jsx("button",{onClick:()=>v(N.id),disabled:a===N.id,className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 disabled:opacity-50",children:a===N.id?"Rejecting...":"Reject"})]})]})},N.id))})})]}),d&&i.jsx($D,{onClose:()=>h(!1),onSuccess:()=>{h(!1),y()},selectedEmployee:"",startDate:"",endDate:"",attendanceLogs:[]})]})})},UD="https://kiosk.quriousclick.es/api",nd="employeeAuthToken";class VD{constructor(){this.baseURL=UD}get token(){return localStorage.getItem(nd)}set token(t){t?localStorage.setItem(nd,t):localStorage.removeItem(nd)}async request(t,n={}){const r="".concat(this.baseURL).concat(t),a={Accept:"application/json",...n.headers||{}};n.body instanceof FormData||(a["Content-Type"]="application/json"),this.token&&(a.Authorization="Bearer ".concat(this.token));const o=await fetch(r,{...n,headers:a});if(!o.ok){let l;try{l=await o.json()}catch(c){l={message:"Something went wrong."}}throw l}return n.responseType==="blob"?o.blob():o.json()}async login(t){const n=await this.request("/employee/login",{method:"POST",body:JSON.stringify(t)});return this.token=n.token,localStorage.setItem("employeeProfile",JSON.stringify(n.employee)),n}async logout(){try{await this.request("/employee/logout",{method:"POST"})}finally{this.token=null,localStorage.removeItem("employeeProfile")}}async requestPasswordOtp(t){return this.request("/employee/password/otp",{method:"POST",body:JSON.stringify({email:t})})}async resetPassword(t){return this.request("/employee/password/reset",{method:"POST",body:JSON.stringify(t)})}async getProfile(){return this.request("/employee/portal/profile")}async updateProfile(t){const n=t instanceof FormData;return this.request("/employee/portal/profile",{method:"PUT",body:n?t:JSON.stringify(t)})}async changePassword(t){return this.request("/employee/portal/change-password",{method:"POST",body:JSON.stringify(t)})}async getDashboard(){return this.request("/employee/portal/dashboard")}async getLeaveBalances(){return this.request("/employee/portal/leave-balances")}async getAttendanceReport(t={}){const n=new URLSearchParams(t).toString(),r=n?"/employee/portal/attendance?".concat(n):"/employee/portal/attendance";return this.request(r)}async exportAttendanceReport(t={}){const n=new URLSearchParams(t).toString(),r=n?"/employee/portal/attendance/export?".concat(n):"/employee/portal/attendance/export";return this.request(r,{responseType:"blob"})}async getLeaveRequests(t={}){const n=new URLSearchParams(t).toString(),r=n?"/leave/requests?".concat(n):"/leave/requests";return this.request(r)}async createLeaveRequest(t){return this.request("/leave/requests",{method:"POST",body:t})}async estimateLeave(t){return this.request("/leave/estimate",{method:"POST",body:JSON.stringify(t)})}async cancelLeaveRequest(t){return this.request("/leave/requests/".concat(t,"/cancel"),{method:"POST"})}async getHolidays(t=new Date().getFullYear()){return this.request("/employee/portal/holidays?year=".concat(t))}async submitCorrectionRequest(t){return this.request("/employee/portal/correction-requests",{method:"POST",body:JSON.stringify(t)})}async getCorrectionRequests(){return this.request("/employee/portal/correction-requests")}async respondToClarification(t,n){return this.request("/employee/portal/leave/requests/".concat(t,"/respond-clarification"),{method:"POST",body:JSON.stringify(n)})}}const dt=new VD,qD=()=>{const e=Zn(),[t,n]=E.useState(""),[r,a]=E.useState(""),[s,o]=E.useState(!1),[l,c]=E.useState(""),[u,d]=E.useState(!1),[h,f]=E.useState(""),[p,m]=E.useState(!1),[x,y]=E.useState(""),[g,v]=E.useState(""),[w,b]=E.useState(""),[N,_]=E.useState(""),[k,j]=E.useState(""),[C,S]=E.useState(!1);E.useEffect(()=>{localStorage.getItem("employeeAuthToken")&&e("/employee/dashboard",{replace:!0})},[e]);const M=async L=>{L.preventDefault(),c(""),d(!0);try{await dt.login({identifier:t,password:r}),e("/employee/dashboard")}catch(O){c((O==null?void 0:O.message)||"Invalid credentials. Please try again.")}finally{d(!1)}},T=async()=>{j(""),_("");try{await dt.requestPasswordOtp(h),m(!0),_("OTP sent! Check your email (valid for 10 minutes).")}catch(L){j((L==null?void 0:L.message)||"Unable to send OTP. Please try again.")}},A=async()=>{if(j(""),_(""),g!==w){j("Passwords do not match.");return}try{await dt.resetPassword({email:h,otp:x,password:g,password_confirmation:w}),_("Password updated. You can now log in."),m(!1),y(""),v(""),b("")}catch(L){j((L==null?void 0:L.message)||"Failed to reset password. Check your OTP.")}};return i.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 flex items-center justify-center p-4 overflow-y-auto",children:[i.jsx("div",{className:"absolute top-4 left-4",children:i.jsx("button",{onClick:()=>e("/"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 font-medium transition-colors",children:" Back to Kiosk"})}),i.jsxs("div",{className:"max-w-md w-full",children:[i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-blue-500 rounded-2xl flex items-center justify-center mx-auto mb-4",children:i.jsx(ii,{className:"w-8 h-8 text-white"})}),i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Employee Login"}),i.jsx("p",{className:"text-gray-600",children:"Access your employee portal"})]}),i.jsxs("form",{className:"space-y-6",onSubmit:M,children:[l&&i.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:i.jsxs("div",{className:"flex",children:[i.jsx(Dt,{className:"h-5 w-5 text-red-400"}),i.jsx("div",{className:"ml-3",children:i.jsx("p",{className:"text-sm text-red-700",children:l})})]})}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"identifier",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email or Employee ID"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Gn,{className:"h-5 w-5 text-gray-400"})}),i.jsx("input",{id:"identifier",name:"identifier",type:"text",autoComplete:"username",required:!0,value:t,onChange:L=>n(L.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",placeholder:"e.g. EMP001 or you@email.com"})]})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ii,{className:"h-5 w-5 text-gray-400"})}),i.jsx("input",{id:"password",name:"password",type:s?"text":"password",autoComplete:"current-password",required:!0,value:r,onChange:L=>a(L.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",placeholder:"Enter your portal password"}),i.jsx("button",{type:"button",onClick:()=>o(!s),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:i.jsx(T0,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})]}),i.jsx("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 disabled:from-gray-400 disabled:to-gray-400 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-[1.02] disabled:scale-100 disabled:cursor-not-allowed",children:u?i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing In..."]}):"Sign In"})]}),i.jsx("button",{className:"mt-4 w-full text-sm text-green-600 hover:text-green-800 font-medium",onClick:()=>S(L=>!L),children:C?"Hide password reset":"Forgot password?"}),C&&i.jsxs("div",{className:"mt-6 border border-gray-200 rounded-lg p-4 space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[i.jsx(Vn,{className:"w-4 h-4 text-green-500"}),"Password reset via email OTP"]}),i.jsx("input",{type:"email",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Your registered email",value:h,onChange:L=>f(L.target.value)}),i.jsx("button",{type:"button",onClick:T,className:"w-full border border-green-200 text-green-600 hover:bg-green-50 rounded-lg py-2 text-sm font-semibold",children:"Send OTP"}),p&&i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"text",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter 6-digit OTP",value:x,onChange:L=>y(L.target.value)}),i.jsx("input",{type:"password",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"New password",value:g,onChange:L=>v(L.target.value)}),i.jsx("input",{type:"password",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Confirm new password",value:w,onChange:L=>b(L.target.value)}),i.jsx("button",{type:"button",onClick:A,className:"w-full bg-green-600 text-white rounded-lg py-2 text-sm font-semibold hover:bg-green-700",children:"Reset Password"})]}),N&&i.jsx("p",{className:"text-xs text-green-600",children:N}),k&&i.jsxs("p",{className:"text-xs text-red-600 flex items-center gap-1",children:[i.jsx(Dt,{className:"w-3 h-3"}),k]})]})]}),i.jsx("div",{className:"text-center mt-6",children:i.jsx("p",{className:"text-sm text-gray-500",children:"Attendance Kiosk System v1.0"})})]})]})},t1=E.createContext(null),Tp=()=>Cs.useContext(t1),lv=[{label:"Dashboard",path:"/employee/dashboard",icon:b_},{label:"Leave",path:"/employee/leaves",icon:GN},{label:"Attendance",path:"/employee/attendance",icon:zN},{label:"Profile",path:"/employee/profile",icon:l_}],HD=()=>{const e=localStorage.getItem("employeeAuthToken"),[t,n]=E.useState(()=>{const p=localStorage.getItem("employeeProfile");return p?JSON.parse(p):null}),[r,a]=E.useState(!0),[s,o]=E.useState(!1),l=Zn(),c=Mr(),u=p=>c.pathname===p||c.pathname.startsWith("".concat(p,"/")),d=E.useCallback(async()=>{if(e){a(!0);try{const p=await dt.getProfile();n(p),localStorage.setItem("employeeProfile",JSON.stringify(p))}catch(p){console.error("Failed to load employee profile",p),(p==null?void 0:p.status)===401&&(await dt.logout(),l("/employee/login",{replace:!0}))}finally{a(!1)}}},[e,l]);E.useEffect(()=>{e&&d()},[e,d]);const h=async()=>{await dt.logout(),l("/employee/login")},f=E.useMemo(()=>({profile:t,setProfile:n,refreshProfile:d}),[t,d]);return e?r&&!t?i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"h-12 w-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-gray-500 text-sm",children:"Loading your portal..."})]})}):i.jsx(t1.Provider,{value:f,children:i.jsxs("div",{className:"min-h-screen bg-gray-50",children:[i.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-3 shadow-sm sticky top-0 z-50",children:[i.jsx("div",{className:"max-w-7xl mx-auto",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h1",{className:"text-base md:text-lg font-semibold text-gray-900",children:"Employee Portal"}),i.jsxs("span",{className:"hidden md:inline-block text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["Logged in as ",(t==null?void 0:t.name)||"Employee"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"hidden lg:flex items-center gap-2",children:[lv.map(p=>{const m=p.icon,x=u(p.path);return i.jsxs(js,{to:p.path,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[i.jsx(m,{className:"w-4 h-4"}),i.jsx("span",{children:p.label})]},p.path)}),i.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),i.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[i.jsx(Ks,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]}),i.jsx("button",{className:"lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors ml-auto",onClick:()=>o(!s),children:s?i.jsx(kn,{className:"w-6 h-6"}):i.jsx(P0,{className:"w-6 h-6"})})]})]})}),s&&i.jsxs("div",{className:"lg:hidden mt-4 space-y-2",children:[i.jsx("hr",{className:"border-gray-200"}),i.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:lv.map(p=>{const m=p.icon,x=u(p.path);return i.jsxs(js,{to:p.path,onClick:()=>o(!1),className:"flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium transition-colors\n                        ".concat(x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[i.jsx(m,{className:"w-4 h-4"}),i.jsx("span",{children:p.label})]},p.path)})}),i.jsxs("button",{onClick:async()=>{await h(),o(!1)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[i.jsx(Ks,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]})]}),i.jsx("main",{className:"max-w-7xl mx-auto px-2 py-2",children:i.jsx(_N,{})})]})}):i.jsx(kf,{to:"/employee/login",replace:!0,state:{from:c}})},cv={present:"text-green-600 bg-green-50",absent:"text-red-600 bg-red-50",late:"text-amber-600 bg-amber-50",default:"text-gray-600 bg-gray-100"},GD=()=>{var m,x,y,g,v,w,b;const{profile:e}=Tp(),t=Zn(),[n,r]=E.useState(null),[a,s]=E.useState(!0),[o,l]=E.useState(""),[c,u]=E.useState(new Date);E.useEffect(()=>{(async()=>{try{const _=await dt.getDashboard();r(_)}catch(_){l((_==null?void 0:_.message)||"Unable to load dashboard.")}finally{s(!1)}})()},[]),E.useEffect(()=>{const N=setInterval(()=>{u(new Date)},1e3);return()=>clearInterval(N)},[]);const d=()=>c.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),h=()=>c.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),f=N=>{if(!N||N===0)return"0 h 0 min";const _=Math.round(N*60),k=Math.floor(_/60),j=_%60;return"".concat(k," h ").concat(j," min")},p=N=>{if(!N)return"";const _=new Date(N),k=String(_.getDate()).padStart(2,"0"),j=String(_.getMonth()+1).padStart(2,"0"),C=_.getFullYear();return"".concat(k,"-").concat(j,"-").concat(C)};return a?i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-8 text-center",children:[i.jsx("div",{className:"h-10 w-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Preparing your dashboard..."})]}):o?i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-sm text-red-600 flex items-center gap-2",children:[i.jsx(Dt,{className:"w-4 h-4"}),o]}):(cv[(m=n==null?void 0:n.today)==null?void 0:m.status]||cv.default,i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Employee Dashboard"}),i.jsxs("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:["Welcome back, ",e==null?void 0:e.name]})]}),i.jsxs("div",{className:"text-left md:text-right",children:[i.jsx("div",{className:"text-xl md:text-2xl font-bold text-gray-900",children:d()}),i.jsx("div",{className:"text-xs md:text-sm text-gray-600",children:h()})]})]}),o&&i.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-red-600",children:o})}),a&&i.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),i.jsx("p",{className:"text-gray-600",children:"Loading dashboard data..."})]})}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8",children:[i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Today's Attendance Status"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:((x=n==null?void 0:n.today)==null?void 0:x.status)||"Pending"}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:(y=n==null?void 0:n.today)!=null&&y.check_in?"Checked In":"Not Checked In"})})]}),i.jsx("div",{className:"bg-green-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Qt,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Hours worked this week"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:f(n==null?void 0:n.weekly_hours)}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current week hours"})})]}),i.jsx("div",{className:"bg-blue-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Qe,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Leave Requests"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:(v=(g=n==null?void 0:n.pending_leaves)==null?void 0:g.length)!=null?v:0}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Awaiting Approval"})})]}),i.jsx("div",{className:"bg-yellow-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Je,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Profile Status"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2 capitalize",children:(e==null?void 0:e.status)||"Active"}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:e==null?void 0:e.designation})})]}),i.jsx("div",{className:"bg-purple-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Gn,{className:"w-6 h-6 text-white"})})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:[i.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("div",{className:"flex items-center justify-between mb-6",children:i.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),"Recent Activities"]})}),i.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[(w=n==null?void 0:n.last_check_ins)==null?void 0:w.map(N=>{var _;return i.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:((_=e==null?void 0:e.name)==null?void 0:_.split(" ").map(k=>k[0]).join("").toUpperCase())||"U"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:(e==null?void 0:e.name)||"You"}),i.jsx("p",{className:"text-xs text-gray-500",children:new Date(N.time).toLocaleString()})]}),i.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium border ".concat(N.action==="Check-In"?"bg-green-100 text-green-700":N.action==="Check-Out"?"bg-gray-100 text-gray-700":N.action==="Break Start"?"bg-yellow-100 text-yellow-700":(N.action==="Break End","bg-blue-100 text-blue-700")),children:N.action})]},N.id)}),(!(n!=null&&n.last_check_ins)||n.last_check_ins.length===0)&&i.jsx("p",{className:"text-xs text-gray-500",children:"No recent activities yet."})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Pending Leave Requests"}),i.jsxs("div",{className:"space-y-4",children:[(b=n==null?void 0:n.pending_leaves)==null?void 0:b.map(N=>i.jsxs("div",{className:"border border-gray-100 rounded-lg p-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:N.policy_name||"Leave"}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[p(N.from_date),"  ",p(N.to_date)," - ",N.days," day",N.days>1?"s":""]})]},N.id)),(!(n!=null&&n.pending_leaves)||n.pending_leaves.length===0)&&i.jsx("p",{className:"text-xs text-gray-500",children:"You have no pending leave requests."})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Quick Actions"}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[i.jsxs("button",{onClick:()=>t("/employee/leaves"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left",children:[i.jsx(Je,{className:"w-6 h-6 text-blue-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Leave Dashboard"})]}),i.jsxs("button",{onClick:()=>t("/employee/attendance"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-left",children:[i.jsx(nh,{className:"w-6 h-6 text-green-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"View My Attendance Report"})]}),i.jsxs("button",{onClick:()=>t("/employee/profile"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-colors text-left",children:[i.jsx(Gn,{className:"w-6 h-6 text-purple-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"My Profile"})]})]})]})]})}))},KD=()=>{var We,J;const{profile:e}=Tp();Zn();const[t,n]=E.useState(null),[r,a]=E.useState(!0),[s,o]=E.useState(""),[l,c]=E.useState(null),[u,d]=E.useState(null),[h,f]=E.useState(""),[p,m]=E.useState(!1),[x,y]=E.useState(!1),[g,v]=E.useState(1),w=4,[b,N]=E.useState({leave_policy_id:"",from_date:"",to_date:"",partial_day:"full_day",partial_session:"first_half",reason:"",attachment:null}),[_,k]=E.useState([]);E.useState(!0);const[j,C]=E.useState([]),[S,M]=E.useState(""),[T,A]=E.useState(""),[L,O]=E.useState(!1),[U,z]=E.useState({estimated_days:0,sandwich_days:0,total_days:0}),[F,W]=E.useState(!1),I=H=>{if(!H)return"";const ee=new Date(H);return Number.isNaN(ee.getTime())?H:ee.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})},q=(H,ee)=>{const he=I(H),$e=I(ee);return"".concat(he,"  ").concat($e)};E.useEffect(()=>{(async()=>{try{const ee=await dt.getDashboard();n(ee)}catch(ee){o((ee==null?void 0:ee.message)||"Unable to load dashboard.")}finally{a(!1)}})()},[]),E.useEffect(()=>{(async()=>{try{const ee=await dt.getLeaveBalances();k(Array.isArray(ee.balances)?ee.balances:[])}catch(ee){console.error("Failed to load leave balances:",ee),k([])}})()},[]),E.useEffect(()=>{(async()=>{const ee=new Set;b.from_date&&ee.add(new Date(b.from_date).getFullYear()),b.to_date&&ee.add(new Date(b.to_date).getFullYear()),ee.size===0&&ee.add(new Date().getFullYear());const he=[];for(const $e of ee)try{const Pe=await dt.getHolidays($e);he.push(...Pe.holidays)}catch(Pe){console.error("Failed to load holidays for year",$e,Pe)}C(he)})()},[b.from_date,b.to_date]);const K=(t==null?void 0:t.leave_balances)||[],re=(H,ee)=>!ee||ee<=0?0:Math.min(100,Math.round(H/ee*100)),ie=(t==null?void 0:t.pending_leaves)||(t==null?void 0:t.pending_requests)||[],ce=(t==null?void 0:t.recent_leaves)||[],me=(t==null?void 0:t.pending_requests_count)!=null?t.pending_requests_count:ie.length,je=(We=t==null?void 0:t.approved_this_month)!=null?We:0,G=(J=t==null?void 0:t.total_leaves_taken)!=null?J:0,se=H=>{d(H),f("")},Ce=async()=>{if(!(!u||!h.trim())){m(!0);try{await dt.respondToClarification(u.id,{response:h.trim()});const H=await dt.getDashboard();n(H),d(null),f("")}catch(H){console.error("Failed to submit clarification:",H)}finally{m(!1)}}},R=()=>{y(!0),v(1),M("")},Y=()=>{y(!1),v(1),N({leave_policy_id:"",from_date:"",to_date:"",partial_day:"full_day",partial_session:"first_half",reason:"",attachment:null}),M("")},ne=()=>{Se()&&v(H=>Math.min(H+1,w))},fe=()=>{v(H=>Math.max(H-1,1))},Se=()=>{switch(M(""),g){case 1:return b.leave_policy_id?!0:(M("Please select a leave type."),!1);case 2:return b.from_date?b.partial_day!=="half_day"&&!b.to_date?(M("Please select an end date."),!1):!0:(M("Please select a date."),!1);case 3:return b.reason.trim()?(ue==null?void 0:ue.code)==="SL"&&De>=2&&!b.attachment?(M("Supporting document is required for medical leave of 2+ days."),!1):!0:(M("Please provide a reason for the leave request."),!1);default:return!0}},$=(H,ee)=>{N(he=>({...he,[H]:ee}))},le=H=>{var he;const ee=(he=H.target.files)==null?void 0:he[0];$("attachment",ee||null)},ve=async H=>{if(H.preventDefault(),M(""),A(""),!b.leave_policy_id){M("Please choose a leave policy.");return}if(!b.reason.trim()){M("Please provide a reason for the leave request.");return}if((ue==null?void 0:ue.code)==="SL"&&De>=2&&!b.attachment){M("Supporting document is required for medical leave of 2+ days.");return}O(!0);try{const ee=new FormData;ee.append("leave_policy_id",b.leave_policy_id),ee.append("from_date",b.from_date),ee.append("to_date",b.to_date),ee.append("partial_day",b.partial_day),b.partial_day==="half_day"&&ee.append("partial_session",b.partial_session),ee.append("reason",b.reason),b.attachment&&ee.append("attachment",b.attachment),await dt.createLeaveRequest(ee),A("Leave request submitted successfully.");const he=await dt.getDashboard();n(he),N({leave_policy_id:"",from_date:"",to_date:"",partial_day:"full_day",partial_session:"first_half",reason:"",attachment:null}),v(1),y(!1)}catch(ee){M((ee==null?void 0:ee.error)||(ee==null?void 0:ee.message)||"Failed to submit leave request.")}finally{O(!1)}},ue=E.useMemo(()=>{var H;return Array.isArray(_)?(H=_.find(ee=>{var he;return Number((he=ee.policy)==null?void 0:he.id)===Number(b.leave_policy_id)}))==null?void 0:H.policy:null},[_,b.leave_policy_id]),Ee=E.useMemo(()=>{if(!Array.isArray(_))return 0;const H=_.find(ee=>{var he;return Number((he=ee.policy)==null?void 0:he.id)===Number(b.leave_policy_id)});return H?H.available:0},[_,b.leave_policy_id]);E.useEffect(()=>{let H=!0;const he=setTimeout(async()=>{if(!b.from_date||!b.to_date||!b.leave_policy_id){z({estimated_days:0,sandwich_days:0,total_days:0});return}const $e=mt=>{if(!mt)return null;const[nn,wr,Dn]=mt.split("-").map(Number);return!nn||!wr||!Dn?null:new Date(Date.UTC(nn,wr-1,Dn))},Pe=$e(b.from_date),nt=$e(b.to_date);if(!Pe||!nt||Pe>nt){z({estimated_days:0,sandwich_days:0,total_days:0});return}W(!0);try{const mt=await dt.estimateLeave({employee_id:e==null?void 0:e.id,leave_policy_id:b.leave_policy_id,from_date:b.from_date,to_date:b.to_date,partial_day:b.partial_day,partial_session:b.partial_session});H&&z(mt)}catch(mt){console.error("Estimation failed",mt)}finally{H&&W(!1)}},500);return()=>{H=!1,clearTimeout(he)}},[b.from_date,b.to_date,b.leave_policy_id,b.partial_day,b.partial_session,e]);const De=U.total_days;return r?i.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-8 text-center",children:[i.jsx("div",{className:"h-10 w-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Preparing your leave dashboard..."})]})}):s?i.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-sm text-red-600 flex items-center gap-2",children:[i.jsx(Dt,{className:"w-4 h-4"}),s]})}):i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Leave Dashboard"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Manage your leave requests and view balances"})]}),i.jsx("button",{onClick:R,className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-cyan-500 text-white text-sm font-medium shadow-sm hover:bg-cyan-600 transition-colors self-start md:self-auto",children:i.jsx("span",{className:"text-base",children:" apply leave"})})]}),i.jsx("section",{className:"mb-6",children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:K.map(H=>{const ee=re(H.available,H.total),$e={CL:{bg:"bg-cyan-500",text:"text-cyan-500"},SL:{bg:"bg-emerald-500",text:"text-emerald-500"},EL:{bg:"bg-amber-500",text:"text-amber-500"}}[H.code]||{bg:"bg-blue-500",text:"text-blue-500"};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>c(H),children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-700",children:H.name}),i.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Available leaves"})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-3xl font-bold ".concat($e.text),children:H.available}),i.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["out of ",H.total||0]})]})]}),i.jsx("div",{className:"h-1.5 rounded-full bg-gray-100 overflow-hidden",children:i.jsx("div",{className:"h-1.5 ".concat($e.bg," rounded-full transition-all"),style:{width:"".concat(ee,"%")}})})]},H.id)})})}),i.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[i.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Pending Requests"}),i.jsx("p",{className:"text-4xl font-bold text-amber-500",children:me})]}),i.jsx("div",{className:"w-12 h-12 rounded-lg bg-amber-50 flex items-center justify-center flex-shrink-0",children:i.jsx(Je,{className:"w-6 h-6 text-amber-500"})})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Approved This Month"}),i.jsxs("p",{className:"text-4xl font-bold text-emerald-500",children:[je," days"]})]}),i.jsx("div",{className:"w-12 h-12 rounded-lg bg-emerald-50 flex items-center justify-center flex-shrink-0",children:i.jsx(Qt,{className:"w-6 h-6 text-emerald-500"})})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Leaves Taken"}),i.jsxs("p",{className:"text-4xl font-bold text-cyan-500",children:[G," days"]})]}),i.jsx("div",{className:"w-12 h-12 rounded-lg bg-cyan-50 flex items-center justify-center flex-shrink-0",children:i.jsx(Je,{className:"w-6 h-6 text-cyan-500"})})]})})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("section",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[i.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center gap-2",children:"Pending Requests"}),i.jsx("div",{className:"space-y-3",children:ie.length>0?ie.map(H=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:H.type||"Leave"}),i.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[H.days," day",H.days>1?"s":""]})]}),i.jsx("span",{className:"inline-flex items-center rounded-md px-2.5 py-1 text-xs font-medium bg-amber-100 text-amber-700",children:"Pending"})]}),i.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 mb-2",children:[i.jsx(Je,{className:"w-3.5 h-3.5"}),i.jsx("span",{children:q(H.from_date,H.to_date)})]}),H.reason&&i.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-gray-600 mb-2",children:[i.jsx("span",{className:"flex-shrink-0",children:""}),i.jsx("span",{children:H.reason})]}),H.submitted_at&&i.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Submitted on ",I(H.submitted_at)]})]},H.id)):i.jsx("p",{className:"text-sm text-gray-500",children:"You have no pending leave requests."})})]}),i.jsxs("section",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[i.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center gap-2",children:"Recent Requests"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:ce.length>0?ce.slice(0,3).map(H=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 ".concat(H.clarification_reason?"cursor-pointer hover:bg-gray-50":""),onClick:()=>H.clarification_reason&&se(H),children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:H.type||"Leave"}),i.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[H.days," day",H.days>1?"s":""]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[H.clarification_reason&&i.jsx(P_,{className:"w-4 h-4 text-blue-500"}),i.jsx("span",{className:"inline-flex items-center rounded-md px-2.5 py-1 text-xs font-medium ".concat(H.status==="Approved"?"bg-emerald-100 text-emerald-700":H.status==="Rejected"?"bg-red-100 text-red-700":H.clarification_reason?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:H.clarification_reason?"Clarification Needed":H.status||"Pending"})]})]}),i.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 mb-2",children:[i.jsx(Je,{className:"w-3.5 h-3.5"}),i.jsx("span",{children:q(H.from_date,H.to_date)})]}),H.reason&&i.jsx("div",{className:"flex items-start gap-1.5 text-xs text-gray-600 mb-2",children:i.jsxs("span",{children:["reason: ",H.reason]})}),H.submitted_at&&i.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Submitted on ",I(H.submitted_at)]})]},H.id)):i.jsx("p",{className:"text-sm text-gray-500",children:"No recent leave requests found."})})]})]}),l&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[l.name," Details"]}),i.jsx("button",{onClick:()=>c(null),className:"text-gray-400 hover:text-gray-600",children:i.jsx(kn,{className:"w-6 h-6"})})]}),i.jsxs("div",{className:"p-6 space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Available"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.available})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.total})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-600",children:"Current Balance:"}),i.jsx("span",{className:"font-medium",children:l.balance})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-600",children:"Carry Forward:"}),i.jsx("span",{className:"font-medium",children:l.carry_forward_balance})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-600",children:"Pending Deduction:"}),i.jsx("span",{className:"font-medium",children:l.pending_deduction})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-600",children:"Accrued This Year:"}),i.jsx("span",{className:"font-medium",children:l.accrued_this_year})]})]}),l.description&&i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Description"}),i.jsx("p",{className:"text-sm text-gray-900",children:l.description})]})]})]})}),u&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Clarification Required"}),i.jsx("button",{onClick:()=>d(null),className:"text-gray-400 hover:text-gray-600",children:i.jsx(kn,{className:"w-6 h-6"})})]}),i.jsxs("div",{className:"p-6 space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Admin Message:"}),i.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:i.jsx("p",{className:"text-sm text-blue-900",children:u.clarification_reason})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Response"}),i.jsx("textarea",{value:h,onChange:H=>f(H.target.value),placeholder:"Please provide clarification for your leave request...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:4,disabled:p})]}),i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:()=>d(null),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:p,children:"Cancel"}),i.jsx("button",{onClick:Ce,disabled:!h.trim()||p,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors",children:p?"Submitting...":"Submit Response"})]})]})]})}),x&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Apply for Leave"}),i.jsx("button",{onClick:Y,className:"text-gray-400 hover:text-gray-600",children:i.jsx(kn,{className:"w-6 h-6"})})]}),i.jsx("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200",children:i.jsx("div",{className:"flex items-center justify-between",children:Array.from({length:w},(H,ee)=>ee+1).map(H=>{const ee={1:"Select Leave Type",2:"Select Dates",3:"Provide Details",4:"Review & Submit"};return i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(H<g?"bg-green-500 text-white":H===g?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"),children:H<g?i.jsx(JN,{className:"w-4 h-4"}):H}),i.jsx("p",{className:"text-xs mt-2 text-center ".concat(H===g?"text-blue-600 font-medium":"text-gray-500"),children:ee[H]}),H<w&&i.jsx("div",{className:"w-12 h-0.5 mx-2 mt-4 ".concat(H<g?"bg-green-500":"bg-gray-300")})]},H)})})}),i.jsxs("div",{className:"p-6",children:[S&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-sm text-red-600",children:S})}),T&&i.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:i.jsx("p",{className:"text-sm text-green-600",children:T})}),g===1&&i.jsxs("div",{children:[i.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Select Leave Type"}),i.jsx("div",{className:"space-y-3",children:_.map(H=>{const ee=H.policy;return i.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[i.jsx("input",{type:"radio",name:"leave_policy",value:ee.id,checked:b.leave_policy_id==ee.id,onChange:he=>$("leave_policy_id",he.target.value),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),i.jsxs("div",{className:"ml-3 flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:ee.name}),i.jsxs("p",{className:"text-xs text-gray-600",children:["Available: ",H.available," days"]})]})]},ee.id)})})]}),g===2&&i.jsxs("div",{children:[i.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Select Dates"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Leave Type"}),i.jsxs("select",{value:b.partial_day,onChange:H=>$("partial_day",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[i.jsx("option",{value:"full_day",children:"Full Day"}),i.jsx("option",{value:"half_day",children:"Half Day"})]})]}),b.partial_day==="half_day"?i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),i.jsx("input",{type:"date",value:b.from_date,onChange:H=>$("from_date",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session"}),i.jsxs("select",{value:b.partial_session,onChange:H=>$("partial_session",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[i.jsx("option",{value:"first_half",children:"First Half"}),i.jsx("option",{value:"second_half",children:"Second Half"})]})]})]}):i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),i.jsx("input",{type:"date",value:b.from_date,onChange:H=>$("from_date",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),i.jsx("input",{type:"date",value:b.to_date,onChange:H=>$("to_date",H.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),i.jsx("div",{className:"min-h-[60px]",children:F?i.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),i.jsx("span",{className:"text-sm text-gray-600",children:"Calculating days..."})]}):De>0?i.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[i.jsxs("p",{className:"text-sm text-blue-900",children:["Estimated days: ",De," ",De===.5?"half day":"days"]}),U.sandwich_days>0&&i.jsxs("p",{className:"text-xs text-blue-700 mt-0.5",children:["(Includes ",U.sandwich_days," sandwich days)"]}),Ee<De&&i.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["Warning: Insufficient balance. Available: ",Ee," days"]})]}):null})]})]}),g===3&&i.jsxs("div",{children:[i.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Provide Details"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Leave"}),i.jsx("textarea",{value:b.reason,onChange:H=>$("reason",H.target.value),placeholder:"Please provide a reason for your leave request...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:4})]}),(ue==null?void 0:ue.code)==="SL"&&De>=2&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supporting Document"}),i.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:le,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Required for medical leave of 2+ days"})]})]})]}),g===4&&i.jsxs("div",{children:[i.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Review & Submit"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm text-gray-600",children:"Leave Type:"}),i.jsx("span",{className:"text-sm font-medium",children:ue==null?void 0:ue.name})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm text-gray-600",children:"Dates:"}),i.jsx("span",{className:"text-sm font-medium",children:b.partial_day==="half_day"?"".concat(I(b.from_date)," (").concat(b.partial_session,")"):q(b.from_date,b.to_date)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm text-gray-600",children:"Days:"}),i.jsxs("span",{className:"text-sm font-medium",children:[De," ",De===.5?"half day":"days"]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm text-gray-600",children:"Reason:"}),i.jsx("span",{className:"text-sm font-medium",children:b.reason})]}),b.attachment&&i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-sm text-gray-600",children:"Attachment:"}),i.jsx("span",{className:"text-sm font-medium",children:b.attachment.name})]})]})]})]}),i.jsxs("div",{className:"flex justify-between items-center px-6 py-4 bg-gray-50 border-t border-gray-200",children:[i.jsx("button",{onClick:fe,disabled:g===1,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),i.jsxs("div",{className:"flex space-x-3",children:[i.jsx("button",{onClick:Y,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),g<w?i.jsx("button",{onClick:ne,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:"Next"}):i.jsx("button",{onClick:ve,disabled:L,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:L?"Submitting...":"Submit Request"})]})]})]})})]})})};function XD(){const e=Zn(),t=new Date,[n,r]=E.useState(t.getFullYear()),[a,s]=E.useState(t.getMonth()),[o,l]=E.useState(1),c=5,[u,d]=E.useState(!1),[h,f]=E.useState(null),[p,m]=E.useState({}),x=()=>{a===0?(s(11),r(n-1)):s(a-1)},y=()=>{a===11?(s(0),r(n+1)):s(a+1)},g=async()=>{try{const O=v.getFullYear(),U=v.getMonth()+1,z=k(O,U-1,1),F=k(O,U-1,b),W=await dt.exportAttendanceReport({start_date:z,end_date:F}),I=window.URL.createObjectURL(W),q=document.createElement("a");q.href=I,q.download="attendance-".concat(O,"-").concat(String(U).padStart(2,"0"),".csv"),document.body.appendChild(q),q.click(),window.URL.revokeObjectURL(I),document.body.removeChild(q)}catch(O){console.error("Download failed:",O),f("Failed to download attendance report")}},v=new Date(n,a,1),w=v.toLocaleDateString("en-US",{month:"long",year:"numeric"}),b=new Date(n,a+1,0).getDate(),N=new Date(n,a,1).getDay(),_=O=>{const U=O.getFullYear(),z=String(O.getMonth()+1).padStart(2,"0"),F=String(O.getDate()).padStart(2,"0");return"".concat(U,"-").concat(z,"-").concat(F)},k=(O,U,z)=>"".concat(O,"-").concat(String(U+1).padStart(2,"0"),"-").concat(String(z).padStart(2,"0"));function j(O){switch(O){case"Present":return"bg-green-500 text-white";case"Late Arrival":return"bg-purple-500 text-white";case"Absent":return"bg-red-500 text-white";case"Holiday":return"bg-blue-500 text-white";case"On Leave":return"bg-orange-500 text-white";case"Early Departure":return"bg-pink-500 text-white";case"Half Day":return"bg-yellow-500 text-white";default:return""}}const C=async()=>{var O;d(!0),f(null);try{const U=v.getFullYear(),z=v.getMonth()+1,F=k(U,z-1,1),W=k(U,z-1,b),I=await dt.getAttendanceReport({start_date:F,end_date:W}),q={};(I.records||[]).forEach(K=>{const re=K.date;q[re]={status:K.status,checkIn:K.check_in?new Date(K.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",checkOut:K.check_out?new Date(K.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",totalHours:K.total_hours||"-",breaks:K.breaks||[],holiday:K.holiday||null,leaveReason:K.leave_reason||null}}),m(q)}catch(U){console.error(U),((O=U==null?void 0:U.response)==null?void 0:O.status)===401&&e("/login"),f("Failed to fetch attendance records")}finally{d(!1)}};E.useEffect(()=>{C()},[n,a]),E.useEffect(()=>{const O=setInterval(()=>{C()},3e4);return()=>clearInterval(O)},[n,a]);const M=(()=>{const O=[],U=v.getFullYear(),z=v.getMonth();_(new Date);for(let F=0;F<N;F++)O.push(null);for(let F=1;F<=b;F++){const W=k(U,z,F),I=new Date(U,z,F),q=_(I);let K=p[W];if(!K){const re=new Date(t);re.setDate(re.getDate()-1);const ie=_(re),ce=I.getDay();q<=ie&&ce!==0&&ce!==6&&(K={status:"Absent",checkIn:"-",checkOut:"-",totalHours:"-",holiday:null})}O.push({day:F,key:W,rec:K,date:I})}return O})(),T=M.filter(Boolean).filter(O=>O.rec).map(O=>({date:O.key,...O.rec})).sort((O,U)=>O.date<U.date?1:-1),A=u?Array(c).fill({skeleton:!0}):T.slice((o-1)*c,o*c),L=Math.max(1,Math.ceil(T.length/c));return i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"p-3 space-y-4",children:[i.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"My Attendance Calendar"}),i.jsx("p",{className:"text-md text-gray-500",children:"View your attendance records"})]})}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(A0,{className:"w-5 h-5"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:w}),i.jsx("button",{onClick:y,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Cf,{className:"w-5 h-5"})})]}),i.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors w-full sm:w-auto",children:[i.jsx(si,{className:"w-4 h-4"}),"Download CSV"]})]}),h&&i.jsx("div",{className:"text-rose-500 text-sm",children:h}),i.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2 mb-2",children:[i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sun"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Mon"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Tue"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Wed"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Thu"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Fri"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sat"})]}),i.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2",children:[M.slice(0,N).map((O,U)=>i.jsx("div",{className:"aspect-square"},"lead-".concat(U))),M.slice(N).map((O,U)=>{var I,q;const z=(I=O.rec)==null?void 0:I.status,F=j(z),W=new Date(O.key).getDay()===0||new Date(O.key).getDay()===6;return i.jsx("div",{className:"aspect-square border-2 rounded-lg p-2 cursor-pointer transition-all hover:shadow-md ".concat(z?F:W?"bg-gray-100 border-gray-200":"bg-white border-gray-200"),children:i.jsxs("div",{className:"h-full flex flex-col",children:[i.jsx("span",{className:"text-sm font-semibold mb-1 ".concat(z?"text-white":"text-gray-700"),children:O.day}),i.jsx("div",{className:"flex-1 flex flex-col justify-center text-xs",children:O.rec?i.jsx(i.Fragment,{children:z==="Holiday"?i.jsx("span",{className:"font-medium ".concat(z?"text-white":"text-gray-700"),children:((q=O.rec.holiday)==null?void 0:q.name)||"Holiday"}):z==="On Leave"?i.jsx("span",{className:"font-medium ".concat(z?"text-white":"text-gray-700"),children:O.rec.leaveReason||"On Leave"}):z==="Present"||z==="Late Arrival"||z==="Early Departure"||z==="Half Day"?i.jsxs(i.Fragment,{children:[i.jsxs("span",{className:"".concat(z?"text-white":"text-gray-700"),children:["In: ",O.rec.checkIn]}),i.jsxs("span",{className:"".concat(z?"text-white":"text-gray-700"),children:["Out: ",O.rec.checkOut]})]}):i.jsx("span",{children:""})}):i.jsx("span",{children:""})})]})},"".concat(O.key,"-").concat(U))})]}),i.jsxs("div",{className:"mt-4 md:mt-6 pt-4 md:pt-6 border-t border-gray-200 grid grid-cols-2 sm:flex sm:flex-wrap gap-3 md:gap-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Present"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Half Day"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Absent"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Holiday"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"On Leave"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Late Arrival"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-pink-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Early Departure"})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2",children:[i.jsx(Je,{className:"w-5 h-5"})," Detailed Attendance Logs"]}),i.jsx("div",{className:"space-y-4",children:A.map((O,U)=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors",children:[i.jsx("div",{className:"flex items-start justify-between mb-3",children:O.skeleton?i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})]}),i.jsx("div",{className:"h-4 w-40 bg-gray-200 rounded animate-pulse mt-2"})]}),i.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(z=>i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded animate-pulse mt-1"}),i.jsxs("div",{children:[i.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse mt-1"})]})]},z))})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{children:i.jsx("p",{className:"text-lg font-semibold text-gray-900",children:new Date(O.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})})}),i.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(O.status==="Present"?"bg-green-100 text-green-700":O.status==="Absent"?"bg-red-100 text-red-800":O.status==="Late Arrival"?"bg-purple-100 text-purple-800":O.status==="Early Departure"?"bg-pink-100 text-pink-800":O.status==="Holiday"?"bg-blue-100 text-blue-800":O.status==="On Leave"?"bg-orange-100 text-orange-800":O.status==="Half Day"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:O.status})]})}),!O.skeleton&&i.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Qe,{className:"w-5 h-5 text-green-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Check-In"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:O.checkIn})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ks,{className:"w-5 h-5 text-red-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Check-Out"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:O.checkOut})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Qe,{className:"w-5 h-5 text-blue-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Total Duration"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:O.totalHours})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Je,{className:"w-5 h-5 text-purple-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Re-entries"}),i.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[Array.isArray(O.breaks)?O.breaks.length:O.breaks||0," times"]})]})]})]}),O.breaks&&O.breaks.length>0&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Break Details:"}),O.breaks.map((z,F)=>i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsxs("span",{className:"text-gray-700",children:["Start: ",z.break_start?new Date(z.break_start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]}),i.jsxs("span",{className:"text-gray-700",children:["End: ",z.break_end?new Date(z.break_end).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]})]},F))]})})]},O.skeleton?U:O.date))}),i.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 pt-4 border-t border-gray-200 gap-4",children:[i.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",A.length," of ",T.length," records"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>l(O=>Math.max(1,O-1)),disabled:o===1,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ".concat(o===1?"opacity-50 cursor-not-allowed":""),children:"Previous"}),i.jsx("button",{className:"px-4 py-2 rounded-lg text-sm font-medium bg-blue-600 text-white",children:o}),i.jsx("button",{onClick:()=>l(O=>Math.min(L,O+1)),disabled:o===L,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ".concat(o===L?"opacity-50 cursor-not-allowed":""),children:"Next"})]})]})]})]})})}const YD=()=>{var Ce;const{profile:e,setProfile:t,refreshProfile:n}=Tp(),[r,a]=E.useState("view"),[s,o]=E.useState(!1),[l,c]=E.useState("");Cs.useEffect(()=>{if(!l)return;const R=setTimeout(()=>c(""),2e3);return()=>clearTimeout(R)},[l]);const u=E.useRef(null),[d,h]=E.useState({phone:"",emergency_contact_number:"",profile_photo:null}),[f,p]=E.useState({current_password:"",password:"",password_confirmation:""}),[m,x]=E.useState("today"),[y,g]=E.useState(new Date().toISOString().split("T")[0]),[v,w]=E.useState([]),[b,N]=E.useState(null),[_,k]=E.useState(!1),[j,C]=E.useState(null),[S,M]=E.useState(!1),[T,A]=E.useState({type:"missing",requested_check_in:"",requested_check_out:"",reason:"",breaks:[]}),[L,O]=E.useState([]),[U,z]=E.useState(!1),[F,W]=E.useState(null);function I(R){switch(R){case"approved":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}Cs.useEffect(()=>{e&&h({phone:e.phone||"",emergency_contact_number:e.emergency_contact_number||"",profile_photo:null})},[e]);const q=async R=>{R.preventDefault(),o(!0),c(""),console.log("Profile form data:",d),console.log("Profile photo file:",d.profile_photo);try{let Y;d.profile_photo?(console.log("File detected, creating FormData"),Y=new FormData,Y.append("phone",d.phone),Y.append("emergency_contact_number",d.emergency_contact_number),Y.append("profile_photo",d.profile_photo),console.log("FormData created with file")):(console.log("No file, sending as JSON"),Y={phone:d.phone,emergency_contact_number:d.emergency_contact_number});const ne=await dt.updateProfile(Y);c(ne.message),t(ne.employee),localStorage.setItem("employeeProfile",JSON.stringify(ne.employee)),h({phone:ne.employee.phone||"",emergency_contact_number:ne.employee.emergency_contact_number||"",profile_photo:null}),u.current&&(u.current.value="")}catch(Y){Y.errors?c(Object.values(Y.errors).flat().join(", ")):c(Y.message||"Failed to update profile")}finally{o(!1)}},K=async R=>{if(R.preventDefault(),o(!0),c(""),f.password!==f.password_confirmation){c("Passwords do not match"),o(!1);return}try{await dt.changePassword({current_password:f.current_password,password:f.password,password_confirmation:f.password_confirmation}),c("Password changed successfully"),p({current_password:"",password:"",password_confirmation:""})}catch(Y){Y.errors?c(Object.values(Y.errors).flat().join(", ")):c(Y.message||"Failed to change password")}finally{o(!1)}},re=async()=>{if(!y){C("Please select a date");return}k(!0),C("");try{const R={start_date:y,end_date:y},Y=await dt.getAttendanceReport(R);w((Y==null?void 0:Y.records)||[]),N(null),M(!0)}catch(R){console.error("Failed to fetch attendance logs:",R),C("Failed to fetch attendance logs")}finally{k(!1)}},ie=R=>{const Y=ne=>{if(!ne)return"";const fe=new Date(ne),Se=fe.getHours().toString().padStart(2,"0"),$=fe.getMinutes().toString().padStart(2,"0");return"".concat(Se,":").concat($)};A({...T,type:R,requested_check_in:R==="missing"?T.requested_check_in:b?Y(b.check_in):"",requested_check_out:R==="missing"?T.requested_check_out:b?Y(b.check_out):""})},ce=R=>{N(R);const Y=ne=>{if(!ne)return"";const fe=new Date(ne),Se=fe.getHours().toString().padStart(2,"0"),$=fe.getMinutes().toString().padStart(2,"0");return"".concat(Se,":").concat($)};A({...T,requested_check_in:Y(R.check_in),requested_check_out:Y(R.check_out),breaks:R.breaks?R.breaks.map(ne=>({break_start:ne.break_start?Y(ne.break_start):"",break_end:ne.break_end?Y(ne.break_end):""})):[]})},me=()=>{if(T.requested_check_in&&T.requested_check_out){const R=T.requested_check_in;if(T.requested_check_out<=R)return"Check-out time must be after check-in time"}return null},je=async R=>{R.preventDefault(),o(!0),c("");const Y=me();if(Y){c(Y),o(!1);return}try{const ne={...T,attendance_id:T.type==="missing"?null:b.id,date:b.date};await dt.submitCorrectionRequest(ne),c("Correction request submitted successfully"),A({type:"missing",requested_check_in:"",requested_check_out:"",reason:"",breaks:[]}),N(null),w([]),G()}catch(ne){c(ne.message||"Failed to submit correction request")}finally{o(!1)}},G=async()=>{z(!0),W(null);try{const R=await dt.getCorrectionRequests();O(Array.isArray(R==null?void 0:R.requests)?R.requests:[])}catch(R){console.error("Failed to load correction requests:",R),W("Failed to load correction requests"),O([])}finally{z(!1)}};if(Cs.useEffect(()=>{r==="corrections"&&G()},[r]),!e)return null;const se=[{id:"view",label:"Profile",icon:Gn},{id:"edit",label:"Edit Profile",icon:da},{id:"corrections",label:"Attendance Corrections",icon:xn}];return i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex items-center justify-between gap-4 mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Employee Profile"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Manage your personal information and account settings"})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[e!=null&&e.profile_photo?i.jsx("img",{src:"/storage/".concat(e.profile_photo),alt:e.name,className:"w-12 h-12 rounded-full object-cover flex-shrink-0"}):i.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:((Ce=e==null?void 0:e.name)==null?void 0:Ce.split(" ").map(R=>R[0]).join("").toUpperCase())||"U"}),i.jsxs("div",{className:"hidden md:block",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.name}),i.jsx("p",{className:"text-xs text-gray-500",children:e.employee_id})]})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow",children:[i.jsx("div",{className:"border-b border-gray-200",children:i.jsx("nav",{className:"flex space-x-8 px-6",children:se.map(R=>i.jsx("button",{onClick:()=>a(R.id),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat(r===R.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:R.label},R.id))})}),i.jsxs("div",{className:"p-6",children:[l&&i.jsx("div",{className:"mb-4 p-4 rounded-md ".concat(l.includes("successfully")?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:l}),r==="view"&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Gn,{className:"w-5 h-5 text-gray-600"}),"Personal Information"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(Vn,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{className:"min-w-0 flex-1",children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Email Address"}),i.jsx("p",{className:"font-medium text-gray-900 break-all",children:e.email})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(Ma,{className:"w-5 h-5 text-green-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Phone Number"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.phone||"Not provided"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-orange-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(rg,{className:"w-5 h-5 text-orange-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Emergency Contact Number"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.emergency_contact_number||"Not provided"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(qN,{className:"w-5 h-5 text-purple-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Department"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.department||"General"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(Gn,{className:"w-5 h-5 text-indigo-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Designation"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.designation||"N/A"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-cyan-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(Je,{className:"w-5 h-5 text-cyan-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Join Date"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.join_date?new Date(e.join_date).toLocaleDateString("en-GB"):"N/A"})]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Je,{className:"w-5 h-5 text-gray-600"}),"Assigned Leave Policies"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(e.leave_policies||[]).map(R=>i.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 border border-green-100",children:i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center",children:i.jsx(Je,{className:"w-4 h-4 text-white"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-gray-900",children:R.name}),i.jsxs("p",{className:"text-xs text-green-600 font-medium",children:[R.yearly_quota," days/year"]})]})]})},R.id)),(!e.leave_policies||e.leave_policies.length===0)&&i.jsxs("div",{className:"col-span-full p-8 text-center",children:[i.jsx(Je,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"No leave policies assigned."})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-5 h-5 text-gray-600"}),"Assigned Attendance Policy"]}),e.attendance_policy?i.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:i.jsx(Qe,{className:"w-5 h-5 text-white"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-lg font-semibold text-gray-900",children:e.attendance_policy.name}),i.jsx("p",{className:"text-sm text-blue-600",children:"Work Schedule Policy"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-blue-200",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Work Start"}),i.jsx("p",{className:"text-sm font-semibold text-gray-900",children:e.attendance_policy.work_start_time})]}),i.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-blue-200",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Work End"}),i.jsx("p",{className:"text-sm font-semibold text-gray-900",children:e.attendance_policy.work_end_time})]}),i.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-blue-200",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Break Duration"}),i.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[e.attendance_policy.break_duration," mins"]})]}),i.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-blue-200",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Grace Period"}),i.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[e.attendance_policy.grace_period," mins"]})]})]})]}):i.jsxs("div",{className:"p-8 text-center",children:[i.jsx(Qe,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"No attendance policy assigned."})]})]})]}),r==="edit"&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(da,{className:"w-5 h-5 text-gray-600"}),"Update Personal Information"]}),i.jsxs("form",{onSubmit:q,className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Ma,{className:"w-4 h-4 text-gray-500"}),"Phone Number"]}),i.jsx("input",{type:"text",value:d.phone,onChange:R=>h({...d,phone:R.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Enter phone number"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(rg,{className:"w-4 h-4 text-gray-500"}),"Emergency Contact Number"]}),i.jsx("input",{type:"text",value:d.emergency_contact_number,onChange:R=>h({...d,emergency_contact_number:R.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Enter emergency contact number"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Gn,{className:"w-4 h-4 text-gray-500"}),"Profile Photo"]}),i.jsx("input",{type:"file",ref:u,accept:"image/*",onChange:R=>{const Y=R.target.files[0];console.log("File selected:",Y),h({...d,profile_photo:Y})},className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"}),(e==null?void 0:e.profile_photo)&&i.jsx("p",{className:"text-xs text-gray-500",children:"Current photo will be replaced if you select a new one."})]})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:i.jsx("button",{type:"submit",disabled:s,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:s?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(da,{className:"w-4 h-4"}),"Update Profile"]})})})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(xo,{className:"w-5 h-5 text-gray-600"}),"Change Password"]}),i.jsxs("form",{onSubmit:K,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xo,{className:"w-4 h-4 text-gray-500"}),"Current Password"]}),i.jsx("input",{type:"password",value:f.current_password,onChange:R=>p({...f,current_password:R.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Enter current password",required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xo,{className:"w-4 h-4 text-gray-500"}),"New Password"]}),i.jsx("input",{type:"password",value:f.password,onChange:R=>p({...f,password:R.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Enter new password",required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xo,{className:"w-4 h-4 text-gray-500"}),"Confirm New Password"]}),i.jsx("input",{type:"password",value:f.password_confirmation,onChange:R=>p({...f,password_confirmation:R.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Confirm new password",required:!0})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:i.jsx("button",{type:"submit",disabled:s,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:s?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Changing..."]}):i.jsxs(i.Fragment,{children:[i.jsx(xo,{className:"w-4 h-4"}),"Change Password"]})})})]})]})]}),r==="corrections"&&i.jsxs("div",{className:"space-y-6",children:[j&&i.jsxs("div",{className:"p-4 rounded-xl shadow-lg border-l-4 bg-red-50 text-red-800 border-red-400 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(Dt,{className:"h-6 w-6 text-red-600"}),i.jsx("span",{className:"font-medium",children:j})]}),i.jsx("button",{onClick:()=>C(""),className:"text-red-400 hover:text-red-600 transition-colors duration-200",children:i.jsx(ao,{className:"h-5 w-5"})})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Je,{className:"w-4 h-4 text-gray-500"}),"Date Range"]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"today",name:"dateRange",value:"today",checked:m==="today",onChange:R=>{x(R.target.value);const Y=new Date().toISOString().split("T")[0];g(Y)},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"today",className:"ml-2 block text-sm text-gray-900",children:"Today"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"custom",name:"dateRange",value:"custom",checked:m==="custom",onChange:R=>{x(R.target.value),g("")},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"custom",className:"ml-2 block text-sm text-gray-900",children:"Custom Date"})]})]})]}),m==="custom"&&i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),i.jsx("input",{type:"date",value:y,onChange:R=>{g(R.target.value),M(!1)},className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]})})]}),i.jsx("div",{className:"mt-4 flex flex-col sm:flex-row gap-4",children:i.jsxs("button",{onClick:re,disabled:!y||_,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[_&&i.jsx(th,{className:"w-4 h-4 animate-spin"}),_?"Loading...":"Fetch Attendance Logs"]})})]}),v.length>0&&i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[i.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:i.jsx("h2",{className:"text-lg font-semibold",children:"Your Attendance Logs"})}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check In"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check Out"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Breaks"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Break Duration"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Hours"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),i.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(v||[]).map(R=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(R.date).toLocaleDateString("en-GB")}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.check_in?new Date(R.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.check_out?new Date(R.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.breaks&&R.breaks.length>0?i.jsx("div",{className:"space-y-1",children:R.breaks.map((Y,ne)=>i.jsxs("div",{className:"text-xs",children:["Break ",ne+1,": ",Y.break_start?new Date(Y.break_start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"," - ",Y.break_end?new Date(Y.break_end).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]},Y.id||ne))}):"No breaks"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.breaks&&R.breaks.length>0?"".concat(R.breaks.length*30," min"):"N/A"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.total_hours||"-"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:i.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(R.status==="Present"?"bg-green-100 text-green-800":R.status==="Absent"?"bg-red-100 text-red-800":R.status==="Late Arrival"?"bg-purple-100 text-purple-800":R.status==="Early Departure"?"bg-pink-100 text-pink-800":R.status==="Holiday"?"bg-blue-100 text-blue-800":R.status==="On Leave"?"bg-orange-100 text-orange-800":R.status==="Half Day"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:R.status})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:i.jsx("button",{type:"button",onClick:()=>ce(R),className:"px-3 py-1 rounded text-xs font-medium transition-colors ".concat((b==null?void 0:b.id)===R.id?"bg-indigo-600 text-white":"bg-indigo-100 text-indigo-700 hover:bg-indigo-200"),children:(b==null?void 0:b.id)===R.id?"Selected":"Select"})})]},R.id))})]})})]}),v.length===0&&S&&!_&&i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 text-center",children:i.jsx("p",{className:"text-gray-500",children:"No log found"})}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(xn,{className:"w-5 h-5 text-gray-600"}),"Attendance Correction request"]}),b?i.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:i.jsxs("p",{className:"text-sm text-blue-800",children:[i.jsx("strong",{children:"Selected Log:"})," ",new Date(b.date).toLocaleDateString()," ","- Check-in: ",b.check_in?new Date(b.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"N/A"," ","- Check-out: ",b.check_out?new Date(b.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"N/A"]})}):i.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:i.jsx("p",{className:"text-sm text-yellow-800",children:"Please select an attendance log from the table above to submit a correction request."})}),i.jsxs("form",{onSubmit:je,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xn,{className:"w-4 h-4 text-gray-500"}),"Correction Type *"]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"missing",name:"correctionType",value:"missing",checked:T.type==="missing",onChange:R=>ie(R.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"missing",className:"ml-2 block text-sm text-gray-900",children:"Change Attendance - Request for a completely missing attendance record"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"wrong_checkin",name:"correctionType",value:"wrong_checkin",checked:T.type==="wrong_checkin",onChange:R=>ie(R.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"wrong_checkin",className:"ml-2 block text-sm text-gray-900",children:"Wrong Check-in Time - Correct only the check-in time"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"wrong_checkout",name:"correctionType",value:"wrong_checkout",checked:T.type==="wrong_checkout",onChange:R=>ie(R.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"wrong_checkout",className:"ml-2 block text-sm text-gray-900",children:"Wrong Check-out Time - Correct only the check-out time"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"wrong_break",name:"correctionType",value:"wrong_break",checked:T.type==="wrong_break",onChange:R=>ie(R.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"wrong_break",className:"ml-2 block text-sm text-gray-900",children:"Wrong Break Times - Correct break start and end times"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(T.type==="missing"||T.type==="wrong_checkin")&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),"Check-in Time *"]}),i.jsx("input",{type:"time",value:T.requested_check_in,onChange:R=>A({...T,requested_check_in:R.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:!0})]}),(T.type==="missing"||T.type==="wrong_checkout")&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),"Check-out Time *"]}),i.jsx("input",{type:"time",value:T.requested_check_out,onChange:R=>A({...T,requested_check_out:R.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:!0})]})]}),(T.type==="missing"||T.type==="wrong_break")&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Qe,{className:"w-4 h-4 text-gray-500"}),"Breaks"]}),i.jsx("button",{type:"button",onClick:()=>A({...T,breaks:[...T.breaks||[],{break_start:"",break_end:""}]}),className:"px-3 py-1 text-sm bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition-colors",children:"Add Break"})]}),(T.breaks||[]).map((R,Y)=>i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Break Start Time"}),i.jsx("input",{type:"time",value:R.break_start,onChange:ne=>{const fe=[...T.breaks||[]];fe[Y].break_start=ne.target.value,A({...T,breaks:fe})},className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Break End Time"}),i.jsx("input",{type:"time",value:R.break_end,onChange:ne=>{const fe=[...T.breaks||[]];fe[Y].break_end=ne.target.value,A({...T,breaks:fe})},className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]}),i.jsx("div",{className:"flex items-end",children:i.jsx("button",{type:"button",onClick:()=>{const ne=(T.breaks||[]).filter((fe,Se)=>Se!==Y);A({...T,breaks:ne})},className:"px-3 py-2 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:"Remove"})})]},"break-".concat(Y)))]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xn,{className:"w-4 h-4 text-gray-500"}),"Reason for Edit *"]}),i.jsx("textarea",{value:T.reason,onChange:R=>A({...T,reason:R.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors resize-none",rows:4,placeholder:"Please explain the reason for editing this attendance record",required:!0})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:i.jsxs("button",{type:"submit",disabled:s||!b,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[s&&i.jsx(th,{className:"w-4 h-4 animate-spin"}),i.jsx(xn,{className:"w-4 h-4"}),s?"Submitting...":"Submit Request"]})})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[i.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:i.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[i.jsx(xn,{className:"w-5 h-5"}),"Your Correction Requests"]})}),i.jsx("div",{className:"overflow-x-auto",children:L.length>0?i.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested Times"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Submitted"})]})}),i.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(Array.isArray(L)?L:[]).map((R,Y)=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.date?new Date(R.date).toLocaleDateString("en-GB"):"N/A"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.type==="missing"?"Change Attendance":R.type==="wrong_checkin"?"Wrong Check-in":R.type==="wrong_checkout"?"Wrong Check-out":R.type==="wrong_break"?"Wrong Break Times":R.type==="break"?"Break Correction":R.type}),i.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[R.requested_check_in||"-"," - ",R.requested_check_out||"-"]}),i.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate",children:R.reason}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:i.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(I(R.status)),children:R.status.charAt(0).toUpperCase()+R.status.slice(1)})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:R.submitted_at?new Date(R.submitted_at).toLocaleDateString("en-GB"):"N/A"})]},R.id||"correction-".concat(Y)))})]}):i.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"No correction requests found"})})]})]})]})]})]})})};function QD({cleanupRef:e}){const t=Mr();return E.useEffect(()=>{e.current&&typeof e.current=="function"&&(e.current(),e.current=null)},[t,e]),null}function JD(){const e=E.useRef(null);return E.useEffect(()=>{Ap.loadModels().catch(t=>{console.warn("App: Initial model pre-load failed (will retry on usage):",t)})},[]),i.jsxs(AN,{children:[i.jsx(QD,{cleanupRef:e}),i.jsxs(kN,{children:[i.jsx(Ct,{path:"/login",element:i.jsx(PD,{})}),i.jsx(Ct,{path:"/",element:i.jsx(sv,{registerCleanup:t=>e.current=t})}),i.jsx(Ct,{path:"/attendance",element:i.jsx(sv,{registerCleanup:t=>e.current=t})}),i.jsx(Ct,{path:"/dashboard",element:i.jsx(Ca,{children:i.jsx(AD,{})})}),i.jsx(Ct,{path:"/policies",element:i.jsx(Ca,{children:i.jsx(MD,{})})}),i.jsx(Ct,{path:"/leave/policies",element:i.jsx(Ca,{children:i.jsx(OD,{})})}),i.jsx(Ct,{path:"/leave/approvals",element:i.jsx(Ca,{children:i.jsx(WD,{})})}),i.jsx(Ct,{path:"/admin/correction-requests",element:i.jsx(Ca,{children:i.jsx(zD,{})})}),i.jsx(Ct,{path:"/employee/login",element:i.jsx(qD,{})}),i.jsxs(Ct,{path:"/employee",element:i.jsx(HD,{}),children:[i.jsx(Ct,{index:!0,element:i.jsx(kf,{to:"/employee/dashboard",replace:!0})}),i.jsx(Ct,{path:"dashboard",element:i.jsx(GD,{})}),i.jsx(Ct,{path:"leaves",element:i.jsx(KD,{})}),i.jsx(Ct,{path:"attendance",element:i.jsx(XD,{})}),i.jsx(Ct,{path:"profile",element:i.jsx(YD,{})})]}),i.jsx(Ct,{path:"/employees",element:i.jsx(Ca,{children:i.jsx(FD,{registerCleanup:t=>e.current=t})})}),i.jsx(Ct,{path:"/reports",element:i.jsx(Ca,{children:i.jsx(TD,{})})})]})]})}const ZD=rd.createRoot(document.getElementById("root"));ZD.render(i.jsx(Cs.StrictMode,{children:i.jsx(JD,{})}));export{eI as __vite_legacy_guard};
