var S1=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var FI=S1((MI,N1)=>{function R1(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in e)){const a=Object.getOwnPropertyDescriptor(r,o);a&&Object.defineProperty(e,o,a.get?a:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();function I1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jv={exports:{}},rl={},Mv={exports:{}},_e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ji=Symbol.for("react.element"),D1=Symbol.for("react.portal"),T1=Symbol.for("react.fragment"),A1=Symbol.for("react.strict_mode"),P1=Symbol.for("react.profiler"),F1=Symbol.for("react.provider"),j1=Symbol.for("react.context"),M1=Symbol.for("react.forward_ref"),O1=Symbol.for("react.suspense"),L1=Symbol.for("react.memo"),B1=Symbol.for("react.lazy"),lp=Symbol.iterator;function W1(e){return e===null||typeof e!="object"?null:(e=lp&&e[lp]||e["@@iterator"],typeof e=="function"?e:null)}var Ov={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Lv=Object.assign,Bv={};function Wa(e,t,n){this.props=e,this.context=t,this.refs=Bv,this.updater=n||Ov}Wa.prototype.isReactComponent={};Wa.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Wa.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Wv(){}Wv.prototype=Wa.prototype;function of(e,t,n){this.props=e,this.context=t,this.refs=Bv,this.updater=n||Ov}var af=of.prototype=new Wv;af.constructor=of;Lv(af,Wa.prototype);af.isPureReactComponent=!0;var cp=Array.isArray,zv=Object.prototype.hasOwnProperty,sf={current:null},Uv={key:!0,ref:!0,__self:!0,__source:!0};function $v(e,t,n){var r,o={},a=null,i=null;if(t!=null)for(r in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(a=""+t.key),t)zv.call(t,r)&&!Uv.hasOwnProperty(r)&&(o[r]=t[r]);var s=arguments.length-2;if(s===1)o.children=n;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];o.children=u}if(e&&e.defaultProps)for(r in s=e.defaultProps,s)o[r]===void 0&&(o[r]=s[r]);return{$$typeof:Ji,type:e,key:a,ref:i,props:o,_owner:sf.current}}function z1(e,t){return{$$typeof:Ji,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function uf(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ji}function U1(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var dp=/\/+/g;function jl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?U1(""+e.key):t.toString(36)}function Hs(e,t,n,r,o){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(a){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case Ji:case D1:i=!0}}if(i)return i=e,o=o(i),e=r===""?"."+jl(i,0):r,cp(o)?(n="",e!=null&&(n=e.replace(dp,"$&/")+"/"),Hs(o,t,n,"",function(l){return l})):o!=null&&(uf(o)&&(o=z1(o,n+(!o.key||i&&i.key===o.key?"":(""+o.key).replace(dp,"$&/")+"/")+e)),t.push(o)),1;if(i=0,r=r===""?".":r+":",cp(e))for(var s=0;s<e.length;s++){a=e[s];var u=r+jl(a,s);i+=Hs(a,t,n,u,o)}else if(u=W1(e),typeof u=="function")for(e=u.call(e),s=0;!(a=e.next()).done;)a=a.value,u=r+jl(a,s++),i+=Hs(a,t,n,u,o);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function hs(e,t,n){if(e==null)return e;var r=[],o=0;return Hs(e,r,"","",function(a){return t.call(n,a,o++)}),r}function $1(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Vt={current:null},Gs={transition:null},V1={ReactCurrentDispatcher:Vt,ReactCurrentBatchConfig:Gs,ReactCurrentOwner:sf};function Vv(){throw Error("act(...) is not supported in production builds of React.")}_e.Children={map:hs,forEach:function(e,t,n){hs(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return hs(e,function(){t++}),t},toArray:function(e){return hs(e,function(t){return t})||[]},only:function(e){if(!uf(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};_e.Component=Wa;_e.Fragment=T1;_e.Profiler=P1;_e.PureComponent=of;_e.StrictMode=A1;_e.Suspense=O1;_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V1;_e.act=Vv;_e.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Lv({},e.props),o=e.key,a=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,i=sf.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)zv.call(t,u)&&!Uv.hasOwnProperty(u)&&(r[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:Ji,type:e.type,key:o,ref:a,props:r,_owner:i}};_e.createContext=function(e){return e={$$typeof:j1,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:F1,_context:e},e.Consumer=e};_e.createElement=$v;_e.createFactory=function(e){var t=$v.bind(null,e);return t.type=e,t};_e.createRef=function(){return{current:null}};_e.forwardRef=function(e){return{$$typeof:M1,render:e}};_e.isValidElement=uf;_e.lazy=function(e){return{$$typeof:B1,_payload:{_status:-1,_result:e},_init:$1}};_e.memo=function(e,t){return{$$typeof:L1,type:e,compare:t===void 0?null:t}};_e.startTransition=function(e){var t=Gs.transition;Gs.transition={};try{e()}finally{Gs.transition=t}};_e.unstable_act=Vv;_e.useCallback=function(e,t){return Vt.current.useCallback(e,t)};_e.useContext=function(e){return Vt.current.useContext(e)};_e.useDebugValue=function(){};_e.useDeferredValue=function(e){return Vt.current.useDeferredValue(e)};_e.useEffect=function(e,t){return Vt.current.useEffect(e,t)};_e.useId=function(){return Vt.current.useId()};_e.useImperativeHandle=function(e,t,n){return Vt.current.useImperativeHandle(e,t,n)};_e.useInsertionEffect=function(e,t){return Vt.current.useInsertionEffect(e,t)};_e.useLayoutEffect=function(e,t){return Vt.current.useLayoutEffect(e,t)};_e.useMemo=function(e,t){return Vt.current.useMemo(e,t)};_e.useReducer=function(e,t,n){return Vt.current.useReducer(e,t,n)};_e.useRef=function(e){return Vt.current.useRef(e)};_e.useState=function(e){return Vt.current.useState(e)};_e.useSyncExternalStore=function(e,t,n){return Vt.current.useSyncExternalStore(e,t,n)};_e.useTransition=function(){return Vt.current.useTransition()};_e.version="18.3.1";Mv.exports=_e;var M=Mv.exports;const Hv=I1(M),H1=R1({__proto__:null,default:Hv},[M]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G1=M,q1=Symbol.for("react.element"),K1=Symbol.for("react.fragment"),X1=Object.prototype.hasOwnProperty,Y1=G1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Q1={key:!0,ref:!0,__self:!0,__source:!0};function Gv(e,t,n){var r,o={},a=null,i=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(i=t.ref);for(r in t)X1.call(t,r)&&!Q1.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:q1,type:e,key:a,ref:i,props:o,_owner:Y1.current}}rl.Fragment=K1;rl.jsx=Gv;rl.jsxs=Gv;jv.exports=rl;var p=jv.exports,Mc={},qv={exports:{}},mn={},Kv={exports:{}},Xv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(F,O){var L=F.length;F.push(O);e:for(;0<L;){var G=L-1>>>1,Y=F[G];if(0<o(Y,O))F[G]=O,F[L]=Y,L=G;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var O=F[0],L=F.pop();if(L!==O){F[0]=L;e:for(var G=0,Y=F.length,Z=Y>>>1;G<Z;){var de=2*(G+1)-1,ne=F[de],ae=de+1,pe=F[ae];if(0>o(ne,L))ae<Y&&0>o(pe,ne)?(F[G]=pe,F[ae]=L,G=ae):(F[G]=ne,F[de]=L,G=de);else if(ae<Y&&0>o(pe,L))F[G]=pe,F[ae]=L,G=ae;else break e}}return O}function o(F,O){var L=F.sortIndex-O.sortIndex;return L!==0?L:F.id-O.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var i=Date,s=i.now();e.unstable_now=function(){return i.now()-s}}var u=[],l=[],c=1,d=null,f=3,h=!1,v=!1,y=!1,x=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(F){for(var O=n(l);O!==null;){if(O.callback===null)r(l);else if(O.startTime<=F)r(l),O.sortIndex=O.expirationTime,t(u,O);else break;O=n(l)}}function w(F){if(y=!1,b(F),!v)if(n(u)!==null)v=!0,U(C);else{var O=n(l);O!==null&&$(w,O.startTime-F)}}function C(F,O){v=!1,y&&(y=!1,m(k),k=-1),h=!0;var L=f;try{for(b(O),d=n(u);d!==null&&(!(d.expirationTime>O)||F&&!P());){var G=d.callback;if(typeof G=="function"){d.callback=null,f=d.priorityLevel;var Y=G(d.expirationTime<=O);O=e.unstable_now(),typeof Y=="function"?d.callback=Y:d===n(u)&&r(u),b(O)}else r(u);d=n(u)}if(d!==null)var Z=!0;else{var de=n(l);de!==null&&$(w,de.startTime-O),Z=!1}return Z}finally{d=null,f=L,h=!1}}var _=!1,E=null,k=-1,R=5,N=-1;function P(){return!(e.unstable_now()-N<R)}function T(){if(E!==null){var F=e.unstable_now();N=F;var O=!0;try{O=E(!0,F)}finally{O?D():(_=!1,E=null)}}else _=!1}var D;if(typeof g=="function")D=function(){g(T)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,W=B.port2;B.port1.onmessage=T,D=function(){W.postMessage(null)}}else D=function(){x(T,0)};function U(F){E=F,_||(_=!0,D())}function $(F,O){k=x(function(){F(e.unstable_now())},O)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_continueExecution=function(){v||h||(v=!0,U(C))},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(F){switch(f){case 1:case 2:case 3:var O=3;break;default:O=f}var L=f;f=O;try{return F()}finally{f=L}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(F,O){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var L=f;f=F;try{return O()}finally{f=L}},e.unstable_scheduleCallback=function(F,O,L){var G=e.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?G+L:G):L=G,F){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=L+Y,F={id:c++,callback:O,priorityLevel:F,startTime:L,expirationTime:Y,sortIndex:-1},L>G?(F.sortIndex=L,t(l,F),n(u)===null&&F===n(l)&&(y?(m(k),k=-1):y=!0,$(w,L-G))):(F.sortIndex=Y,t(u,F),v||h||(v=!0,U(C))),F},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(F){var O=f;return function(){var L=f;f=O;try{return F.apply(this,arguments)}finally{f=L}}}})(Xv);Kv.exports=Xv;var J1=Kv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z1=M,pn=J1;function Q(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Yv=new Set,ki={};function Bo(e,t){Ia(e,t),Ia(e+"Capture",t)}function Ia(e,t){for(ki[e]=t,e=0;e<t.length;e++)Yv.add(t[e])}var gr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Oc=Object.prototype.hasOwnProperty,eb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fp={},hp={};function tb(e){return Oc.call(hp,e)?!0:Oc.call(fp,e)?!1:eb.test(e)?hp[e]=!0:(fp[e]=!0,!1)}function nb(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function rb(e,t,n,r){if(t===null||typeof t>"u"||nb(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ht(e,t,n,r,o,a,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var Dt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Dt[e]=new Ht(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Dt[t]=new Ht(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Dt[e]=new Ht(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Dt[e]=new Ht(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Dt[e]=new Ht(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Dt[e]=new Ht(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Dt[e]=new Ht(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Dt[e]=new Ht(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Dt[e]=new Ht(e,5,!1,e.toLowerCase(),null,!1,!1)});var lf=/[\-:]([a-z])/g;function cf(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(lf,cf);Dt[t]=new Ht(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(lf,cf);Dt[t]=new Ht(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(lf,cf);Dt[t]=new Ht(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Dt[e]=new Ht(e,1,!1,e.toLowerCase(),null,!1,!1)});Dt.xlinkHref=new Ht("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Dt[e]=new Ht(e,1,!1,e.toLowerCase(),null,!0,!0)});function df(e,t,n,r){var o=Dt.hasOwnProperty(t)?Dt[t]:null;(o!==null?o.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(rb(t,n,o,r)&&(n=null),r||o===null?tb(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,r=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var wr=Z1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ps=Symbol.for("react.element"),na=Symbol.for("react.portal"),ra=Symbol.for("react.fragment"),ff=Symbol.for("react.strict_mode"),Lc=Symbol.for("react.profiler"),Qv=Symbol.for("react.provider"),Jv=Symbol.for("react.context"),hf=Symbol.for("react.forward_ref"),Bc=Symbol.for("react.suspense"),Wc=Symbol.for("react.suspense_list"),pf=Symbol.for("react.memo"),Fr=Symbol.for("react.lazy"),Zv=Symbol.for("react.offscreen"),pp=Symbol.iterator;function Ya(e){return e===null||typeof e!="object"?null:(e=pp&&e[pp]||e["@@iterator"],typeof e=="function"?e:null)}var Ye=Object.assign,Ml;function ui(e){if(Ml===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ml=t&&t[1]||""}return`
`+Ml+e}var Ol=!1;function Ll(e,t){if(!e||Ol)return"";Ol=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var o=l.stack.split(`
`),a=r.stack.split(`
`),i=o.length-1,s=a.length-1;1<=i&&0<=s&&o[i]!==a[s];)s--;for(;1<=i&&0<=s;i--,s--)if(o[i]!==a[s]){if(i!==1||s!==1)do if(i--,s--,0>s||o[i]!==a[s]){var u=`
`+o[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=i&&0<=s);break}}}finally{Ol=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?ui(e):""}function ob(e){switch(e.tag){case 5:return ui(e.type);case 16:return ui("Lazy");case 13:return ui("Suspense");case 19:return ui("SuspenseList");case 0:case 2:case 15:return e=Ll(e.type,!1),e;case 11:return e=Ll(e.type.render,!1),e;case 1:return e=Ll(e.type,!0),e;default:return""}}function zc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ra:return"Fragment";case na:return"Portal";case Lc:return"Profiler";case ff:return"StrictMode";case Bc:return"Suspense";case Wc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Jv:return(e.displayName||"Context")+".Consumer";case Qv:return(e._context.displayName||"Context")+".Provider";case hf:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case pf:return t=e.displayName||null,t!==null?t:zc(e.type)||"Memo";case Fr:t=e._payload,e=e._init;try{return zc(e(t))}catch{}}return null}function ab(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zc(t);case 8:return t===ff?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function no(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function eg(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ib(e){var t=eg(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(i){r=""+i,a.call(this,i)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(i){r=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ms(e){e._valueTracker||(e._valueTracker=ib(e))}function tg(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=eg(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function au(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Uc(e,t){var n=t.checked;return Ye({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function mp(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=no(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function ng(e,t){t=t.checked,t!=null&&df(e,"checked",t,!1)}function $c(e,t){ng(e,t);var n=no(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Vc(e,t.type,n):t.hasOwnProperty("defaultValue")&&Vc(e,t.type,no(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function vp(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Vc(e,t,n){(t!=="number"||au(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var li=Array.isArray;function ma(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+no(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,r&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function Hc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Q(91));return Ye({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function gp(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Q(92));if(li(n)){if(1<n.length)throw Error(Q(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:no(n)}}function rg(e,t){var n=no(t.value),r=no(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function yp(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function og(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Gc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?og(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var vs,ag=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(vs=vs||document.createElement("div"),vs.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=vs.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ei(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var fi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sb=["Webkit","ms","Moz","O"];Object.keys(fi).forEach(function(e){sb.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fi[t]=fi[e]})});function ig(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||fi.hasOwnProperty(e)&&fi[e]?(""+t).trim():t+"px"}function sg(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=ig(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}var ub=Ye({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qc(e,t){if(t){if(ub[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Q(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Q(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Q(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Q(62))}}function Kc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xc=null;function mf(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Yc=null,va=null,ga=null;function xp(e){if(e=ts(e)){if(typeof Yc!="function")throw Error(Q(280));var t=e.stateNode;t&&(t=ul(t),Yc(e.stateNode,e.type,t))}}function ug(e){va?ga?ga.push(e):ga=[e]:va=e}function lg(){if(va){var e=va,t=ga;if(ga=va=null,xp(e),t)for(e=0;e<t.length;e++)xp(t[e])}}function cg(e,t){return e(t)}function dg(){}var Bl=!1;function fg(e,t,n){if(Bl)return e(t,n);Bl=!0;try{return cg(e,t,n)}finally{Bl=!1,(va!==null||ga!==null)&&(dg(),lg())}}function Ni(e,t){var n=e.stateNode;if(n===null)return null;var r=ul(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Q(231,t,typeof n));return n}var Qc=!1;if(gr)try{var Qa={};Object.defineProperty(Qa,"passive",{get:function(){Qc=!0}}),window.addEventListener("test",Qa,Qa),window.removeEventListener("test",Qa,Qa)}catch{Qc=!1}function lb(e,t,n,r,o,a,i,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var hi=!1,iu=null,su=!1,Jc=null,cb={onError:function(e){hi=!0,iu=e}};function db(e,t,n,r,o,a,i,s,u){hi=!1,iu=null,lb.apply(cb,arguments)}function fb(e,t,n,r,o,a,i,s,u){if(db.apply(this,arguments),hi){if(hi){var l=iu;hi=!1,iu=null}else throw Error(Q(198));su||(su=!0,Jc=l)}}function Wo(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function hg(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function bp(e){if(Wo(e)!==e)throw Error(Q(188))}function hb(e){var t=e.alternate;if(!t){if(t=Wo(e),t===null)throw Error(Q(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(o===null)break;var a=o.alternate;if(a===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return bp(o),e;if(a===r)return bp(o),t;a=a.sibling}throw Error(Q(188))}if(n.return!==r.return)n=o,r=a;else{for(var i=!1,s=o.child;s;){if(s===n){i=!0,n=o,r=a;break}if(s===r){i=!0,r=o,n=a;break}s=s.sibling}if(!i){for(s=a.child;s;){if(s===n){i=!0,n=a,r=o;break}if(s===r){i=!0,r=a,n=o;break}s=s.sibling}if(!i)throw Error(Q(189))}}if(n.alternate!==r)throw Error(Q(190))}if(n.tag!==3)throw Error(Q(188));return n.stateNode.current===n?e:t}function pg(e){return e=hb(e),e!==null?mg(e):null}function mg(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=mg(e);if(t!==null)return t;e=e.sibling}return null}var vg=pn.unstable_scheduleCallback,wp=pn.unstable_cancelCallback,pb=pn.unstable_shouldYield,mb=pn.unstable_requestPaint,rt=pn.unstable_now,vb=pn.unstable_getCurrentPriorityLevel,vf=pn.unstable_ImmediatePriority,gg=pn.unstable_UserBlockingPriority,uu=pn.unstable_NormalPriority,gb=pn.unstable_LowPriority,yg=pn.unstable_IdlePriority,ol=null,Zn=null;function yb(e){if(Zn&&typeof Zn.onCommitFiberRoot=="function")try{Zn.onCommitFiberRoot(ol,e,void 0,(e.current.flags&128)===128)}catch{}}var Mn=Math.clz32?Math.clz32:wb,xb=Math.log,bb=Math.LN2;function wb(e){return e>>>=0,e===0?32:31-(xb(e)/bb|0)|0}var gs=64,ys=4194304;function ci(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function lu(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes,i=n&268435455;if(i!==0){var s=i&~o;s!==0?r=ci(s):(a&=i,a!==0&&(r=ci(a)))}else i=n&~o,i!==0?r=ci(i):a!==0&&(r=ci(a));if(r===0)return 0;if(t!==0&&t!==r&&!(t&o)&&(o=r&-r,a=t&-t,o>=a||o===16&&(a&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Mn(t),o=1<<n,r|=e[n],t&=~o;return r}function Cb(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _b(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-Mn(a),s=1<<i,u=o[i];u===-1?(!(s&n)||s&r)&&(o[i]=Cb(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}function Zc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function xg(){var e=gs;return gs<<=1,!(gs&4194240)&&(gs=64),e}function Wl(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Zi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Mn(t),e[t]=n}function kb(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-Mn(n),a=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~a}}function gf(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Mn(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var Me=0;function bg(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var wg,yf,Cg,_g,kg,ed=!1,xs=[],Vr=null,Hr=null,Gr=null,Si=new Map,Ri=new Map,Mr=[],Eb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Cp(e,t){switch(e){case"focusin":case"focusout":Vr=null;break;case"dragenter":case"dragleave":Hr=null;break;case"mouseover":case"mouseout":Gr=null;break;case"pointerover":case"pointerout":Si.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ri.delete(t.pointerId)}}function Ja(e,t,n,r,o,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},t!==null&&(t=ts(t),t!==null&&yf(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function Nb(e,t,n,r,o){switch(t){case"focusin":return Vr=Ja(Vr,e,t,n,r,o),!0;case"dragenter":return Hr=Ja(Hr,e,t,n,r,o),!0;case"mouseover":return Gr=Ja(Gr,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return Si.set(a,Ja(Si.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,Ri.set(a,Ja(Ri.get(a)||null,e,t,n,r,o)),!0}return!1}function Eg(e){var t=ko(e.target);if(t!==null){var n=Wo(t);if(n!==null){if(t=n.tag,t===13){if(t=hg(n),t!==null){e.blockedOn=t,kg(e.priority,function(){Cg(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function qs(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=td(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);Xc=r,n.target.dispatchEvent(r),Xc=null}else return t=ts(n),t!==null&&yf(t),e.blockedOn=n,!1;t.shift()}return!0}function _p(e,t,n){qs(e)&&n.delete(t)}function Sb(){ed=!1,Vr!==null&&qs(Vr)&&(Vr=null),Hr!==null&&qs(Hr)&&(Hr=null),Gr!==null&&qs(Gr)&&(Gr=null),Si.forEach(_p),Ri.forEach(_p)}function Za(e,t){e.blockedOn===t&&(e.blockedOn=null,ed||(ed=!0,pn.unstable_scheduleCallback(pn.unstable_NormalPriority,Sb)))}function Ii(e){function t(o){return Za(o,e)}if(0<xs.length){Za(xs[0],e);for(var n=1;n<xs.length;n++){var r=xs[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Vr!==null&&Za(Vr,e),Hr!==null&&Za(Hr,e),Gr!==null&&Za(Gr,e),Si.forEach(t),Ri.forEach(t),n=0;n<Mr.length;n++)r=Mr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Mr.length&&(n=Mr[0],n.blockedOn===null);)Eg(n),n.blockedOn===null&&Mr.shift()}var ya=wr.ReactCurrentBatchConfig,cu=!0;function Rb(e,t,n,r){var o=Me,a=ya.transition;ya.transition=null;try{Me=1,xf(e,t,n,r)}finally{Me=o,ya.transition=a}}function Ib(e,t,n,r){var o=Me,a=ya.transition;ya.transition=null;try{Me=4,xf(e,t,n,r)}finally{Me=o,ya.transition=a}}function xf(e,t,n,r){if(cu){var o=td(e,t,n,r);if(o===null)Yl(e,t,r,du,n),Cp(e,r);else if(Nb(o,e,t,n,r))r.stopPropagation();else if(Cp(e,r),t&4&&-1<Eb.indexOf(e)){for(;o!==null;){var a=ts(o);if(a!==null&&wg(a),a=td(e,t,n,r),a===null&&Yl(e,t,r,du,n),a===o)break;o=a}o!==null&&r.stopPropagation()}else Yl(e,t,r,null,n)}}var du=null;function td(e,t,n,r){if(du=null,e=mf(r),e=ko(e),e!==null)if(t=Wo(e),t===null)e=null;else if(n=t.tag,n===13){if(e=hg(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return du=e,null}function Ng(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vb()){case vf:return 1;case gg:return 4;case uu:case gb:return 16;case yg:return 536870912;default:return 16}default:return 16}}var Br=null,bf=null,Ks=null;function Sg(){if(Ks)return Ks;var e,t=bf,n=t.length,r,o="value"in Br?Br.value:Br.textContent,a=o.length;for(e=0;e<n&&t[e]===o[e];e++);var i=n-e;for(r=1;r<=i&&t[n-r]===o[a-r];r++);return Ks=o.slice(e,1<r?1-r:void 0)}function Xs(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function bs(){return!0}function kp(){return!1}function vn(e){function t(n,r,o,a,i){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=a,this.target=i,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(n=e[s],this[s]=n?n(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?bs:kp,this.isPropagationStopped=kp,this}return Ye(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=bs)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=bs)},persist:function(){},isPersistent:bs}),t}var za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wf=vn(za),es=Ye({},za,{view:0,detail:0}),Db=vn(es),zl,Ul,ei,al=Ye({},es,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cf,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ei&&(ei&&e.type==="mousemove"?(zl=e.screenX-ei.screenX,Ul=e.screenY-ei.screenY):Ul=zl=0,ei=e),zl)},movementY:function(e){return"movementY"in e?e.movementY:Ul}}),Ep=vn(al),Tb=Ye({},al,{dataTransfer:0}),Ab=vn(Tb),Pb=Ye({},es,{relatedTarget:0}),$l=vn(Pb),Fb=Ye({},za,{animationName:0,elapsedTime:0,pseudoElement:0}),jb=vn(Fb),Mb=Ye({},za,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ob=vn(Mb),Lb=Ye({},za,{data:0}),Np=vn(Lb),Bb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ub(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=zb[e])?!!t[e]:!1}function Cf(){return Ub}var $b=Ye({},es,{key:function(e){if(e.key){var t=Bb[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Xs(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Wb[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cf,charCode:function(e){return e.type==="keypress"?Xs(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Xs(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Vb=vn($b),Hb=Ye({},al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sp=vn(Hb),Gb=Ye({},es,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cf}),qb=vn(Gb),Kb=Ye({},za,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xb=vn(Kb),Yb=Ye({},al,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Qb=vn(Yb),Jb=[9,13,27,32],_f=gr&&"CompositionEvent"in window,pi=null;gr&&"documentMode"in document&&(pi=document.documentMode);var Zb=gr&&"TextEvent"in window&&!pi,Rg=gr&&(!_f||pi&&8<pi&&11>=pi),Rp=String.fromCharCode(32),Ip=!1;function Ig(e,t){switch(e){case"keyup":return Jb.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dg(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var oa=!1;function ew(e,t){switch(e){case"compositionend":return Dg(t);case"keypress":return t.which!==32?null:(Ip=!0,Rp);case"textInput":return e=t.data,e===Rp&&Ip?null:e;default:return null}}function tw(e,t){if(oa)return e==="compositionend"||!_f&&Ig(e,t)?(e=Sg(),Ks=bf=Br=null,oa=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Rg&&t.locale!=="ko"?null:t.data;default:return null}}var nw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!nw[e.type]:t==="textarea"}function Tg(e,t,n,r){ug(r),t=fu(t,"onChange"),0<t.length&&(n=new wf("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var mi=null,Di=null;function rw(e){Ug(e,0)}function il(e){var t=sa(e);if(tg(t))return e}function ow(e,t){if(e==="change")return t}var Ag=!1;if(gr){var Vl;if(gr){var Hl="oninput"in document;if(!Hl){var Tp=document.createElement("div");Tp.setAttribute("oninput","return;"),Hl=typeof Tp.oninput=="function"}Vl=Hl}else Vl=!1;Ag=Vl&&(!document.documentMode||9<document.documentMode)}function Ap(){mi&&(mi.detachEvent("onpropertychange",Pg),Di=mi=null)}function Pg(e){if(e.propertyName==="value"&&il(Di)){var t=[];Tg(t,Di,e,mf(e)),fg(rw,t)}}function aw(e,t,n){e==="focusin"?(Ap(),mi=t,Di=n,mi.attachEvent("onpropertychange",Pg)):e==="focusout"&&Ap()}function iw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return il(Di)}function sw(e,t){if(e==="click")return il(t)}function uw(e,t){if(e==="input"||e==="change")return il(t)}function lw(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Bn=typeof Object.is=="function"?Object.is:lw;function Ti(e,t){if(Bn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!Oc.call(t,o)||!Bn(e[o],t[o]))return!1}return!0}function Pp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Fp(e,t){var n=Pp(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Pp(n)}}function Fg(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Fg(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function jg(){for(var e=window,t=au();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=au(e.document)}return t}function kf(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function cw(e){var t=jg(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Fg(n.ownerDocument.documentElement,n)){if(r!==null&&kf(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,a=Math.min(r.start,o);r=r.end===void 0?a:Math.min(r.end,o),!e.extend&&a>r&&(o=r,r=a,a=o),o=Fp(n,a);var i=Fp(n,r);o&&i&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var dw=gr&&"documentMode"in document&&11>=document.documentMode,aa=null,nd=null,vi=null,rd=!1;function jp(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;rd||aa==null||aa!==au(r)||(r=aa,"selectionStart"in r&&kf(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),vi&&Ti(vi,r)||(vi=r,r=fu(nd,"onSelect"),0<r.length&&(t=new wf("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=aa)))}function ws(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ia={animationend:ws("Animation","AnimationEnd"),animationiteration:ws("Animation","AnimationIteration"),animationstart:ws("Animation","AnimationStart"),transitionend:ws("Transition","TransitionEnd")},Gl={},Mg={};gr&&(Mg=document.createElement("div").style,"AnimationEvent"in window||(delete ia.animationend.animation,delete ia.animationiteration.animation,delete ia.animationstart.animation),"TransitionEvent"in window||delete ia.transitionend.transition);function sl(e){if(Gl[e])return Gl[e];if(!ia[e])return e;var t=ia[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Mg)return Gl[e]=t[n];return e}var Og=sl("animationend"),Lg=sl("animationiteration"),Bg=sl("animationstart"),Wg=sl("transitionend"),zg=new Map,Mp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function so(e,t){zg.set(e,t),Bo(t,[e])}for(var ql=0;ql<Mp.length;ql++){var Kl=Mp[ql],fw=Kl.toLowerCase(),hw=Kl[0].toUpperCase()+Kl.slice(1);so(fw,"on"+hw)}so(Og,"onAnimationEnd");so(Lg,"onAnimationIteration");so(Bg,"onAnimationStart");so("dblclick","onDoubleClick");so("focusin","onFocus");so("focusout","onBlur");so(Wg,"onTransitionEnd");Ia("onMouseEnter",["mouseout","mouseover"]);Ia("onMouseLeave",["mouseout","mouseover"]);Ia("onPointerEnter",["pointerout","pointerover"]);Ia("onPointerLeave",["pointerout","pointerover"]);Bo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bo("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var di="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pw=new Set("cancel close invalid load scroll toggle".split(" ").concat(di));function Op(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,fb(r,t,void 0,e),e.currentTarget=null}function Ug(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&o.isPropagationStopped())break e;Op(o,s,l),a=u}else for(i=0;i<r.length;i++){if(s=r[i],u=s.instance,l=s.currentTarget,s=s.listener,u!==a&&o.isPropagationStopped())break e;Op(o,s,l),a=u}}}if(su)throw e=Jc,su=!1,Jc=null,e}function ze(e,t){var n=t[ud];n===void 0&&(n=t[ud]=new Set);var r=e+"__bubble";n.has(r)||($g(t,e,2,!1),n.add(r))}function Xl(e,t,n){var r=0;t&&(r|=4),$g(n,e,r,t)}var Cs="_reactListening"+Math.random().toString(36).slice(2);function Ai(e){if(!e[Cs]){e[Cs]=!0,Yv.forEach(function(n){n!=="selectionchange"&&(pw.has(n)||Xl(n,!1,e),Xl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Cs]||(t[Cs]=!0,Xl("selectionchange",!1,t))}}function $g(e,t,n,r){switch(Ng(t)){case 1:var o=Rb;break;case 4:o=Ib;break;default:o=xf}n=o.bind(null,t,n,e),o=void 0,!Qc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),r?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Yl(e,t,n,r,o){var a=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var i=r.tag;if(i===3||i===4){var s=r.stateNode.containerInfo;if(s===o||s.nodeType===8&&s.parentNode===o)break;if(i===4)for(i=r.return;i!==null;){var u=i.tag;if((u===3||u===4)&&(u=i.stateNode.containerInfo,u===o||u.nodeType===8&&u.parentNode===o))return;i=i.return}for(;s!==null;){if(i=ko(s),i===null)return;if(u=i.tag,u===5||u===6){r=a=i;continue e}s=s.parentNode}}r=r.return}fg(function(){var l=a,c=mf(n),d=[];e:{var f=zg.get(e);if(f!==void 0){var h=wf,v=e;switch(e){case"keypress":if(Xs(n)===0)break e;case"keydown":case"keyup":h=Vb;break;case"focusin":v="focus",h=$l;break;case"focusout":v="blur",h=$l;break;case"beforeblur":case"afterblur":h=$l;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Ep;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=Ab;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=qb;break;case Og:case Lg:case Bg:h=jb;break;case Wg:h=Xb;break;case"scroll":h=Db;break;case"wheel":h=Qb;break;case"copy":case"cut":case"paste":h=Ob;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Sp}var y=(t&4)!==0,x=!y&&e==="scroll",m=y?f!==null?f+"Capture":null:f;y=[];for(var g=l,b;g!==null;){b=g;var w=b.stateNode;if(b.tag===5&&w!==null&&(b=w,m!==null&&(w=Ni(g,m),w!=null&&y.push(Pi(g,w,b)))),x)break;g=g.return}0<y.length&&(f=new h(f,v,null,n,c),d.push({event:f,listeners:y}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",h=e==="mouseout"||e==="pointerout",f&&n!==Xc&&(v=n.relatedTarget||n.fromElement)&&(ko(v)||v[yr]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(v=n.relatedTarget||n.toElement,h=l,v=v?ko(v):null,v!==null&&(x=Wo(v),v!==x||v.tag!==5&&v.tag!==6)&&(v=null)):(h=null,v=l),h!==v)){if(y=Ep,w="onMouseLeave",m="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(y=Sp,w="onPointerLeave",m="onPointerEnter",g="pointer"),x=h==null?f:sa(h),b=v==null?f:sa(v),f=new y(w,g+"leave",h,n,c),f.target=x,f.relatedTarget=b,w=null,ko(c)===l&&(y=new y(m,g+"enter",v,n,c),y.target=b,y.relatedTarget=x,w=y),x=w,h&&v)t:{for(y=h,m=v,g=0,b=y;b;b=qo(b))g++;for(b=0,w=m;w;w=qo(w))b++;for(;0<g-b;)y=qo(y),g--;for(;0<b-g;)m=qo(m),b--;for(;g--;){if(y===m||m!==null&&y===m.alternate)break t;y=qo(y),m=qo(m)}y=null}else y=null;h!==null&&Lp(d,f,h,y,!1),v!==null&&x!==null&&Lp(d,x,v,y,!0)}}e:{if(f=l?sa(l):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var C=ow;else if(Dp(f))if(Ag)C=uw;else{C=iw;var _=aw}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=sw);if(C&&(C=C(e,l))){Tg(d,C,n,c);break e}_&&_(e,f,l),e==="focusout"&&(_=f._wrapperState)&&_.controlled&&f.type==="number"&&Vc(f,"number",f.value)}switch(_=l?sa(l):window,e){case"focusin":(Dp(_)||_.contentEditable==="true")&&(aa=_,nd=l,vi=null);break;case"focusout":vi=nd=aa=null;break;case"mousedown":rd=!0;break;case"contextmenu":case"mouseup":case"dragend":rd=!1,jp(d,n,c);break;case"selectionchange":if(dw)break;case"keydown":case"keyup":jp(d,n,c)}var E;if(_f)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else oa?Ig(e,n)&&(k="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(Rg&&n.locale!=="ko"&&(oa||k!=="onCompositionStart"?k==="onCompositionEnd"&&oa&&(E=Sg()):(Br=c,bf="value"in Br?Br.value:Br.textContent,oa=!0)),_=fu(l,k),0<_.length&&(k=new Np(k,e,null,n,c),d.push({event:k,listeners:_}),E?k.data=E:(E=Dg(n),E!==null&&(k.data=E)))),(E=Zb?ew(e,n):tw(e,n))&&(l=fu(l,"onBeforeInput"),0<l.length&&(c=new Np("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:l}),c.data=E))}Ug(d,t)})}function Pi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function fu(e,t){for(var n=t+"Capture",r=[];e!==null;){var o=e,a=o.stateNode;o.tag===5&&a!==null&&(o=a,a=Ni(e,n),a!=null&&r.unshift(Pi(e,a,o)),a=Ni(e,t),a!=null&&r.push(Pi(e,a,o))),e=e.return}return r}function qo(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Lp(e,t,n,r,o){for(var a=t._reactName,i=[];n!==null&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(u!==null&&u===r)break;s.tag===5&&l!==null&&(s=l,o?(u=Ni(n,a),u!=null&&i.unshift(Pi(n,u,s))):o||(u=Ni(n,a),u!=null&&i.push(Pi(n,u,s)))),n=n.return}i.length!==0&&e.push({event:t,listeners:i})}var mw=/\r\n?/g,vw=/\u0000|\uFFFD/g;function Bp(e){return(typeof e=="string"?e:""+e).replace(mw,`
`).replace(vw,"")}function _s(e,t,n){if(t=Bp(t),Bp(e)!==t&&n)throw Error(Q(425))}function hu(){}var od=null,ad=null;function id(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var sd=typeof setTimeout=="function"?setTimeout:void 0,gw=typeof clearTimeout=="function"?clearTimeout:void 0,Wp=typeof Promise=="function"?Promise:void 0,yw=typeof queueMicrotask=="function"?queueMicrotask:typeof Wp<"u"?function(e){return Wp.resolve(null).then(e).catch(xw)}:sd;function xw(e){setTimeout(function(){throw e})}function Ql(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){e.removeChild(o),Ii(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);Ii(t)}function qr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function zp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Ua=Math.random().toString(36).slice(2),Xn="__reactFiber$"+Ua,Fi="__reactProps$"+Ua,yr="__reactContainer$"+Ua,ud="__reactEvents$"+Ua,bw="__reactListeners$"+Ua,ww="__reactHandles$"+Ua;function ko(e){var t=e[Xn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[yr]||n[Xn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=zp(e);e!==null;){if(n=e[Xn])return n;e=zp(e)}return t}e=n,n=e.parentNode}return null}function ts(e){return e=e[Xn]||e[yr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function sa(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Q(33))}function ul(e){return e[Fi]||null}var ld=[],ua=-1;function uo(e){return{current:e}}function $e(e){0>ua||(e.current=ld[ua],ld[ua]=null,ua--)}function Be(e,t){ua++,ld[ua]=e.current,e.current=t}var ro={},Wt=uo(ro),Qt=uo(!1),Ao=ro;function Da(e,t){var n=e.type.contextTypes;if(!n)return ro;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={},a;for(a in n)o[a]=t[a];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Jt(e){return e=e.childContextTypes,e!=null}function pu(){$e(Qt),$e(Wt)}function Up(e,t,n){if(Wt.current!==ro)throw Error(Q(168));Be(Wt,t),Be(Qt,n)}function Vg(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in t))throw Error(Q(108,ab(e)||"Unknown",o));return Ye({},n,r)}function mu(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ro,Ao=Wt.current,Be(Wt,e),Be(Qt,Qt.current),!0}function $p(e,t,n){var r=e.stateNode;if(!r)throw Error(Q(169));n?(e=Vg(e,t,Ao),r.__reactInternalMemoizedMergedChildContext=e,$e(Qt),$e(Wt),Be(Wt,e)):$e(Qt),Be(Qt,n)}var fr=null,ll=!1,Jl=!1;function Hg(e){fr===null?fr=[e]:fr.push(e)}function Cw(e){ll=!0,Hg(e)}function lo(){if(!Jl&&fr!==null){Jl=!0;var e=0,t=Me;try{var n=fr;for(Me=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}fr=null,ll=!1}catch(o){throw fr!==null&&(fr=fr.slice(e+1)),vg(vf,lo),o}finally{Me=t,Jl=!1}}return null}var la=[],ca=0,vu=null,gu=0,yn=[],xn=0,Po=null,pr=1,mr="";function xo(e,t){la[ca++]=gu,la[ca++]=vu,vu=e,gu=t}function Gg(e,t,n){yn[xn++]=pr,yn[xn++]=mr,yn[xn++]=Po,Po=e;var r=pr;e=mr;var o=32-Mn(r)-1;r&=~(1<<o),n+=1;var a=32-Mn(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,pr=1<<32-Mn(t)+o|n<<o|r,mr=a+e}else pr=1<<a|n<<o|r,mr=e}function Ef(e){e.return!==null&&(xo(e,1),Gg(e,1,0))}function Nf(e){for(;e===vu;)vu=la[--ca],la[ca]=null,gu=la[--ca],la[ca]=null;for(;e===Po;)Po=yn[--xn],yn[xn]=null,mr=yn[--xn],yn[xn]=null,pr=yn[--xn],yn[xn]=null}var fn=null,un=null,He=!1,An=null;function qg(e,t){var n=Cn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Vp(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,fn=e,un=qr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,fn=e,un=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Po!==null?{id:pr,overflow:mr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Cn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,fn=e,un=null,!0):!1;default:return!1}}function cd(e){return(e.mode&1)!==0&&(e.flags&128)===0}function dd(e){if(He){var t=un;if(t){var n=t;if(!Vp(e,t)){if(cd(e))throw Error(Q(418));t=qr(n.nextSibling);var r=fn;t&&Vp(e,t)?qg(r,n):(e.flags=e.flags&-4097|2,He=!1,fn=e)}}else{if(cd(e))throw Error(Q(418));e.flags=e.flags&-4097|2,He=!1,fn=e}}}function Hp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;fn=e}function ks(e){if(e!==fn)return!1;if(!He)return Hp(e),He=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!id(e.type,e.memoizedProps)),t&&(t=un)){if(cd(e))throw Kg(),Error(Q(418));for(;t;)qg(e,t),t=qr(t.nextSibling)}if(Hp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Q(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){un=qr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}un=null}}else un=fn?qr(e.stateNode.nextSibling):null;return!0}function Kg(){for(var e=un;e;)e=qr(e.nextSibling)}function Ta(){un=fn=null,He=!1}function Sf(e){An===null?An=[e]:An.push(e)}var _w=wr.ReactCurrentBatchConfig;function ti(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Q(309));var r=n.stateNode}if(!r)throw Error(Q(147,e));var o=r,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(i){var s=o.refs;i===null?delete s[a]:s[a]=i},t._stringRef=a,t)}if(typeof e!="string")throw Error(Q(284));if(!n._owner)throw Error(Q(290,e))}return e}function Es(e,t){throw e=Object.prototype.toString.call(t),Error(Q(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Gp(e){var t=e._init;return t(e._payload)}function Xg(e){function t(m,g){if(e){var b=m.deletions;b===null?(m.deletions=[g],m.flags|=16):b.push(g)}}function n(m,g){if(!e)return null;for(;g!==null;)t(m,g),g=g.sibling;return null}function r(m,g){for(m=new Map;g!==null;)g.key!==null?m.set(g.key,g):m.set(g.index,g),g=g.sibling;return m}function o(m,g){return m=Qr(m,g),m.index=0,m.sibling=null,m}function a(m,g,b){return m.index=b,e?(b=m.alternate,b!==null?(b=b.index,b<g?(m.flags|=2,g):b):(m.flags|=2,g)):(m.flags|=1048576,g)}function i(m){return e&&m.alternate===null&&(m.flags|=2),m}function s(m,g,b,w){return g===null||g.tag!==6?(g=ac(b,m.mode,w),g.return=m,g):(g=o(g,b),g.return=m,g)}function u(m,g,b,w){var C=b.type;return C===ra?c(m,g,b.props.children,w,b.key):g!==null&&(g.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Fr&&Gp(C)===g.type)?(w=o(g,b.props),w.ref=ti(m,g,b),w.return=m,w):(w=nu(b.type,b.key,b.props,null,m.mode,w),w.ref=ti(m,g,b),w.return=m,w)}function l(m,g,b,w){return g===null||g.tag!==4||g.stateNode.containerInfo!==b.containerInfo||g.stateNode.implementation!==b.implementation?(g=ic(b,m.mode,w),g.return=m,g):(g=o(g,b.children||[]),g.return=m,g)}function c(m,g,b,w,C){return g===null||g.tag!==7?(g=Do(b,m.mode,w,C),g.return=m,g):(g=o(g,b),g.return=m,g)}function d(m,g,b){if(typeof g=="string"&&g!==""||typeof g=="number")return g=ac(""+g,m.mode,b),g.return=m,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case ps:return b=nu(g.type,g.key,g.props,null,m.mode,b),b.ref=ti(m,null,g),b.return=m,b;case na:return g=ic(g,m.mode,b),g.return=m,g;case Fr:var w=g._init;return d(m,w(g._payload),b)}if(li(g)||Ya(g))return g=Do(g,m.mode,b,null),g.return=m,g;Es(m,g)}return null}function f(m,g,b,w){var C=g!==null?g.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return C!==null?null:s(m,g,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case ps:return b.key===C?u(m,g,b,w):null;case na:return b.key===C?l(m,g,b,w):null;case Fr:return C=b._init,f(m,g,C(b._payload),w)}if(li(b)||Ya(b))return C!==null?null:c(m,g,b,w,null);Es(m,b)}return null}function h(m,g,b,w,C){if(typeof w=="string"&&w!==""||typeof w=="number")return m=m.get(b)||null,s(g,m,""+w,C);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ps:return m=m.get(w.key===null?b:w.key)||null,u(g,m,w,C);case na:return m=m.get(w.key===null?b:w.key)||null,l(g,m,w,C);case Fr:var _=w._init;return h(m,g,b,_(w._payload),C)}if(li(w)||Ya(w))return m=m.get(b)||null,c(g,m,w,C,null);Es(g,w)}return null}function v(m,g,b,w){for(var C=null,_=null,E=g,k=g=0,R=null;E!==null&&k<b.length;k++){E.index>k?(R=E,E=null):R=E.sibling;var N=f(m,E,b[k],w);if(N===null){E===null&&(E=R);break}e&&E&&N.alternate===null&&t(m,E),g=a(N,g,k),_===null?C=N:_.sibling=N,_=N,E=R}if(k===b.length)return n(m,E),He&&xo(m,k),C;if(E===null){for(;k<b.length;k++)E=d(m,b[k],w),E!==null&&(g=a(E,g,k),_===null?C=E:_.sibling=E,_=E);return He&&xo(m,k),C}for(E=r(m,E);k<b.length;k++)R=h(E,m,k,b[k],w),R!==null&&(e&&R.alternate!==null&&E.delete(R.key===null?k:R.key),g=a(R,g,k),_===null?C=R:_.sibling=R,_=R);return e&&E.forEach(function(P){return t(m,P)}),He&&xo(m,k),C}function y(m,g,b,w){var C=Ya(b);if(typeof C!="function")throw Error(Q(150));if(b=C.call(b),b==null)throw Error(Q(151));for(var _=C=null,E=g,k=g=0,R=null,N=b.next();E!==null&&!N.done;k++,N=b.next()){E.index>k?(R=E,E=null):R=E.sibling;var P=f(m,E,N.value,w);if(P===null){E===null&&(E=R);break}e&&E&&P.alternate===null&&t(m,E),g=a(P,g,k),_===null?C=P:_.sibling=P,_=P,E=R}if(N.done)return n(m,E),He&&xo(m,k),C;if(E===null){for(;!N.done;k++,N=b.next())N=d(m,N.value,w),N!==null&&(g=a(N,g,k),_===null?C=N:_.sibling=N,_=N);return He&&xo(m,k),C}for(E=r(m,E);!N.done;k++,N=b.next())N=h(E,m,k,N.value,w),N!==null&&(e&&N.alternate!==null&&E.delete(N.key===null?k:N.key),g=a(N,g,k),_===null?C=N:_.sibling=N,_=N);return e&&E.forEach(function(T){return t(m,T)}),He&&xo(m,k),C}function x(m,g,b,w){if(typeof b=="object"&&b!==null&&b.type===ra&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case ps:e:{for(var C=b.key,_=g;_!==null;){if(_.key===C){if(C=b.type,C===ra){if(_.tag===7){n(m,_.sibling),g=o(_,b.props.children),g.return=m,m=g;break e}}else if(_.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Fr&&Gp(C)===_.type){n(m,_.sibling),g=o(_,b.props),g.ref=ti(m,_,b),g.return=m,m=g;break e}n(m,_);break}else t(m,_);_=_.sibling}b.type===ra?(g=Do(b.props.children,m.mode,w,b.key),g.return=m,m=g):(w=nu(b.type,b.key,b.props,null,m.mode,w),w.ref=ti(m,g,b),w.return=m,m=w)}return i(m);case na:e:{for(_=b.key;g!==null;){if(g.key===_)if(g.tag===4&&g.stateNode.containerInfo===b.containerInfo&&g.stateNode.implementation===b.implementation){n(m,g.sibling),g=o(g,b.children||[]),g.return=m,m=g;break e}else{n(m,g);break}else t(m,g);g=g.sibling}g=ic(b,m.mode,w),g.return=m,m=g}return i(m);case Fr:return _=b._init,x(m,g,_(b._payload),w)}if(li(b))return v(m,g,b,w);if(Ya(b))return y(m,g,b,w);Es(m,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,g!==null&&g.tag===6?(n(m,g.sibling),g=o(g,b),g.return=m,m=g):(n(m,g),g=ac(b,m.mode,w),g.return=m,m=g),i(m)):n(m,g)}return x}var Aa=Xg(!0),Yg=Xg(!1),yu=uo(null),xu=null,da=null,Rf=null;function If(){Rf=da=xu=null}function Df(e){var t=yu.current;$e(yu),e._currentValue=t}function fd(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function xa(e,t){xu=e,Rf=da=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Yt=!0),e.firstContext=null)}function En(e){var t=e._currentValue;if(Rf!==e)if(e={context:e,memoizedValue:t,next:null},da===null){if(xu===null)throw Error(Q(308));da=e,xu.dependencies={lanes:0,firstContext:e}}else da=da.next=e;return t}var Eo=null;function Tf(e){Eo===null?Eo=[e]:Eo.push(e)}function Qg(e,t,n,r){var o=t.interleaved;return o===null?(n.next=n,Tf(t)):(n.next=o.next,o.next=n),t.interleaved=n,xr(e,r)}function xr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var jr=!1;function Af(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Jg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function vr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Kr(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Ie&2){var o=r.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),r.pending=t,xr(e,n)}return o=r.interleaved,o===null?(t.next=t,Tf(r)):(t.next=o.next,o.next=t),r.interleaved=t,xr(e,n)}function Ys(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,gf(e,n)}}function qp(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?o=a=i:a=a.next=i,n=n.next}while(n!==null);a===null?o=a=t:a=a.next=t}else o=a=t;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function bu(e,t,n,r){var o=e.updateQueue;jr=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(s!==null){o.shared.pending=null;var u=s,l=u.next;u.next=null,i===null?a=l:i.next=l,i=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==i&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(a!==null){var d=o.baseState;i=0,c=l=u=null,s=a;do{var f=s.lane,h=s.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var v=e,y=s;switch(f=t,h=n,y.tag){case 1:if(v=y.payload,typeof v=="function"){d=v.call(h,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=y.payload,f=typeof v=="function"?v.call(h,d,f):v,f==null)break e;d=Ye({},d,f);break e;case 2:jr=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=o.effects,f===null?o.effects=[s]:f.push(s))}else h={eventTime:h,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=h,u=d):c=c.next=h,i|=f;if(s=s.next,s===null){if(s=o.shared.pending,s===null)break;f=s,s=f.next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}while(1);if(c===null&&(u=d),o.baseState=u,o.firstBaseUpdate=l,o.lastBaseUpdate=c,t=o.shared.interleaved,t!==null){o=t;do i|=o.lane,o=o.next;while(o!==t)}else a===null&&(o.shared.lanes=0);jo|=i,e.lanes=i,e.memoizedState=d}}function Kp(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(Q(191,o));o.call(r)}}}var ns={},er=uo(ns),ji=uo(ns),Mi=uo(ns);function No(e){if(e===ns)throw Error(Q(174));return e}function Pf(e,t){switch(Be(Mi,t),Be(ji,e),Be(er,ns),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Gc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Gc(t,e)}$e(er),Be(er,t)}function Pa(){$e(er),$e(ji),$e(Mi)}function Zg(e){No(Mi.current);var t=No(er.current),n=Gc(t,e.type);t!==n&&(Be(ji,e),Be(er,n))}function Ff(e){ji.current===e&&($e(er),$e(ji))}var Ge=uo(0);function wu(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Zl=[];function jf(){for(var e=0;e<Zl.length;e++)Zl[e]._workInProgressVersionPrimary=null;Zl.length=0}var Qs=wr.ReactCurrentDispatcher,ec=wr.ReactCurrentBatchConfig,Fo=0,Xe=null,ft=null,bt=null,Cu=!1,gi=!1,Oi=0,kw=0;function At(){throw Error(Q(321))}function Mf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Bn(e[n],t[n]))return!1;return!0}function Of(e,t,n,r,o,a){if(Fo=a,Xe=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qs.current=e===null||e.memoizedState===null?Rw:Iw,e=n(r,o),gi){a=0;do{if(gi=!1,Oi=0,25<=a)throw Error(Q(301));a+=1,bt=ft=null,t.updateQueue=null,Qs.current=Dw,e=n(r,o)}while(gi)}if(Qs.current=_u,t=ft!==null&&ft.next!==null,Fo=0,bt=ft=Xe=null,Cu=!1,t)throw Error(Q(300));return e}function Lf(){var e=Oi!==0;return Oi=0,e}function Gn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bt===null?Xe.memoizedState=bt=e:bt=bt.next=e,bt}function Nn(){if(ft===null){var e=Xe.alternate;e=e!==null?e.memoizedState:null}else e=ft.next;var t=bt===null?Xe.memoizedState:bt.next;if(t!==null)bt=t,ft=e;else{if(e===null)throw Error(Q(310));ft=e,e={memoizedState:ft.memoizedState,baseState:ft.baseState,baseQueue:ft.baseQueue,queue:ft.queue,next:null},bt===null?Xe.memoizedState=bt=e:bt=bt.next=e}return bt}function Li(e,t){return typeof t=="function"?t(e):t}function tc(e){var t=Nn(),n=t.queue;if(n===null)throw Error(Q(311));n.lastRenderedReducer=e;var r=ft,o=r.baseQueue,a=n.pending;if(a!==null){if(o!==null){var i=o.next;o.next=a.next,a.next=i}r.baseQueue=o=a,n.pending=null}if(o!==null){a=o.next,r=r.baseState;var s=i=null,u=null,l=a;do{var c=l.lane;if((Fo&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=d,i=r):u=u.next=d,Xe.lanes|=c,jo|=c}l=l.next}while(l!==null&&l!==a);u===null?i=r:u.next=s,Bn(r,t.memoizedState)||(Yt=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=u,n.lastRenderedState=r}if(e=n.interleaved,e!==null){o=e;do a=o.lane,Xe.lanes|=a,jo|=a,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function nc(e){var t=Nn(),n=t.queue;if(n===null)throw Error(Q(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,a=t.memoizedState;if(o!==null){n.pending=null;var i=o=o.next;do a=e(a,i.action),i=i.next;while(i!==o);Bn(a,t.memoizedState)||(Yt=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function e0(){}function t0(e,t){var n=Xe,r=Nn(),o=t(),a=!Bn(r.memoizedState,o);if(a&&(r.memoizedState=o,Yt=!0),r=r.queue,Bf(o0.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||bt!==null&&bt.memoizedState.tag&1){if(n.flags|=2048,Bi(9,r0.bind(null,n,r,o,t),void 0,null),wt===null)throw Error(Q(349));Fo&30||n0(n,t,o)}return o}function n0(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Xe.updateQueue,t===null?(t={lastEffect:null,stores:null},Xe.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function r0(e,t,n,r){t.value=n,t.getSnapshot=r,a0(t)&&i0(e)}function o0(e,t,n){return n(function(){a0(t)&&i0(e)})}function a0(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Bn(e,n)}catch{return!0}}function i0(e){var t=xr(e,1);t!==null&&On(t,e,1,-1)}function Xp(e){var t=Gn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Li,lastRenderedState:e},t.queue=e,e=e.dispatch=Sw.bind(null,Xe,e),[t.memoizedState,e]}function Bi(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Xe.updateQueue,t===null?(t={lastEffect:null,stores:null},Xe.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function s0(){return Nn().memoizedState}function Js(e,t,n,r){var o=Gn();Xe.flags|=e,o.memoizedState=Bi(1|t,n,void 0,r===void 0?null:r)}function cl(e,t,n,r){var o=Nn();r=r===void 0?null:r;var a=void 0;if(ft!==null){var i=ft.memoizedState;if(a=i.destroy,r!==null&&Mf(r,i.deps)){o.memoizedState=Bi(t,n,a,r);return}}Xe.flags|=e,o.memoizedState=Bi(1|t,n,a,r)}function Yp(e,t){return Js(8390656,8,e,t)}function Bf(e,t){return cl(2048,8,e,t)}function u0(e,t){return cl(4,2,e,t)}function l0(e,t){return cl(4,4,e,t)}function c0(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function d0(e,t,n){return n=n!=null?n.concat([e]):null,cl(4,4,c0.bind(null,t,e),n)}function Wf(){}function f0(e,t){var n=Nn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Mf(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function h0(e,t){var n=Nn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Mf(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function p0(e,t,n){return Fo&21?(Bn(n,t)||(n=xg(),Xe.lanes|=n,jo|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Yt=!0),e.memoizedState=n)}function Ew(e,t){var n=Me;Me=n!==0&&4>n?n:4,e(!0);var r=ec.transition;ec.transition={};try{e(!1),t()}finally{Me=n,ec.transition=r}}function m0(){return Nn().memoizedState}function Nw(e,t,n){var r=Yr(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},v0(e))g0(t,n);else if(n=Qg(e,t,n,r),n!==null){var o=$t();On(n,e,r,o),y0(n,t,r)}}function Sw(e,t,n){var r=Yr(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(v0(e))g0(t,o);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,Bn(s,i)){var u=t.interleaved;u===null?(o.next=o,Tf(t)):(o.next=u.next,u.next=o),t.interleaved=o;return}}catch{}finally{}n=Qg(e,t,o,r),n!==null&&(o=$t(),On(n,e,r,o),y0(n,t,r))}}function v0(e){var t=e.alternate;return e===Xe||t!==null&&t===Xe}function g0(e,t){gi=Cu=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function y0(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,gf(e,n)}}var _u={readContext:En,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useInsertionEffect:At,useLayoutEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useMutableSource:At,useSyncExternalStore:At,useId:At,unstable_isNewReconciler:!1},Rw={readContext:En,useCallback:function(e,t){return Gn().memoizedState=[e,t===void 0?null:t],e},useContext:En,useEffect:Yp,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Js(4194308,4,c0.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Js(4194308,4,e,t)},useInsertionEffect:function(e,t){return Js(4,2,e,t)},useMemo:function(e,t){var n=Gn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Gn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Nw.bind(null,Xe,e),[r.memoizedState,e]},useRef:function(e){var t=Gn();return e={current:e},t.memoizedState=e},useState:Xp,useDebugValue:Wf,useDeferredValue:function(e){return Gn().memoizedState=e},useTransition:function(){var e=Xp(!1),t=e[0];return e=Ew.bind(null,e[1]),Gn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Xe,o=Gn();if(He){if(n===void 0)throw Error(Q(407));n=n()}else{if(n=t(),wt===null)throw Error(Q(349));Fo&30||n0(r,t,n)}o.memoizedState=n;var a={value:n,getSnapshot:t};return o.queue=a,Yp(o0.bind(null,r,a,e),[e]),r.flags|=2048,Bi(9,r0.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Gn(),t=wt.identifierPrefix;if(He){var n=mr,r=pr;n=(r&~(1<<32-Mn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=Oi++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=kw++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Iw={readContext:En,useCallback:f0,useContext:En,useEffect:Bf,useImperativeHandle:d0,useInsertionEffect:u0,useLayoutEffect:l0,useMemo:h0,useReducer:tc,useRef:s0,useState:function(){return tc(Li)},useDebugValue:Wf,useDeferredValue:function(e){var t=Nn();return p0(t,ft.memoizedState,e)},useTransition:function(){var e=tc(Li)[0],t=Nn().memoizedState;return[e,t]},useMutableSource:e0,useSyncExternalStore:t0,useId:m0,unstable_isNewReconciler:!1},Dw={readContext:En,useCallback:f0,useContext:En,useEffect:Bf,useImperativeHandle:d0,useInsertionEffect:u0,useLayoutEffect:l0,useMemo:h0,useReducer:nc,useRef:s0,useState:function(){return nc(Li)},useDebugValue:Wf,useDeferredValue:function(e){var t=Nn();return ft===null?t.memoizedState=e:p0(t,ft.memoizedState,e)},useTransition:function(){var e=nc(Li)[0],t=Nn().memoizedState;return[e,t]},useMutableSource:e0,useSyncExternalStore:t0,useId:m0,unstable_isNewReconciler:!1};function Dn(e,t){if(e&&e.defaultProps){t=Ye({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function hd(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Ye({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var dl={isMounted:function(e){return(e=e._reactInternals)?Wo(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=$t(),o=Yr(e),a=vr(r,o);a.payload=t,n!=null&&(a.callback=n),t=Kr(e,a,o),t!==null&&(On(t,e,o,r),Ys(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=$t(),o=Yr(e),a=vr(r,o);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=Kr(e,a,o),t!==null&&(On(t,e,o,r),Ys(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=$t(),r=Yr(e),o=vr(n,r);o.tag=2,t!=null&&(o.callback=t),t=Kr(e,o,r),t!==null&&(On(t,e,r,n),Ys(t,e,r))}};function Qp(e,t,n,r,o,a,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,a,i):t.prototype&&t.prototype.isPureReactComponent?!Ti(n,r)||!Ti(o,a):!0}function x0(e,t,n){var r=!1,o=ro,a=t.contextType;return typeof a=="object"&&a!==null?a=En(a):(o=Jt(t)?Ao:Wt.current,r=t.contextTypes,a=(r=r!=null)?Da(e,o):ro),t=new t(n,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=dl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function Jp(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&dl.enqueueReplaceState(t,t.state,null)}function pd(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Af(e);var a=t.contextType;typeof a=="object"&&a!==null?o.context=En(a):(a=Jt(t)?Ao:Wt.current,o.context=Da(e,a)),o.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(hd(e,t,a,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&dl.enqueueReplaceState(o,o.state,null),bu(e,n,o,r),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function Fa(e,t){try{var n="",r=t;do n+=ob(r),r=r.return;while(r);var o=n}catch(a){o=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:o,digest:null}}function rc(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function md(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Tw=typeof WeakMap=="function"?WeakMap:Map;function b0(e,t,n){n=vr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Eu||(Eu=!0,Ed=r),md(e,t)},n}function w0(e,t,n){n=vr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){md(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){md(e,t),typeof r!="function"&&(Xr===null?Xr=new Set([this]):Xr.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),n}function Zp(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Tw;var o=new Set;r.set(t,o)}else o=r.get(t),o===void 0&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Hw.bind(null,e,t,n),t.then(e,e))}function em(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function tm(e,t,n,r,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=vr(-1,1),t.tag=2,Kr(n,t,1))),n.lanes|=1),e)}var Aw=wr.ReactCurrentOwner,Yt=!1;function Ut(e,t,n,r){t.child=e===null?Yg(t,null,n,r):Aa(t,e.child,n,r)}function nm(e,t,n,r,o){n=n.render;var a=t.ref;return xa(t,o),r=Of(e,t,n,r,a,o),n=Lf(),e!==null&&!Yt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,br(e,t,o)):(He&&n&&Ef(t),t.flags|=1,Ut(e,t,r,o),t.child)}function rm(e,t,n,r,o){if(e===null){var a=n.type;return typeof a=="function"&&!Kf(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=a,C0(e,t,a,r,o)):(e=nu(n.type,null,r,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&o)){var i=a.memoizedProps;if(n=n.compare,n=n!==null?n:Ti,n(i,r)&&e.ref===t.ref)return br(e,t,o)}return t.flags|=1,e=Qr(a,r),e.ref=t.ref,e.return=t,t.child=e}function C0(e,t,n,r,o){if(e!==null){var a=e.memoizedProps;if(Ti(a,r)&&e.ref===t.ref)if(Yt=!1,t.pendingProps=r=a,(e.lanes&o)!==0)e.flags&131072&&(Yt=!0);else return t.lanes=e.lanes,br(e,t,o)}return vd(e,t,n,r,o)}function _0(e,t,n){var r=t.pendingProps,o=r.children,a=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Be(ha,on),on|=n;else{if(!(n&1073741824))return e=a!==null?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Be(ha,on),on|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,Be(ha,on),on|=r}else a!==null?(r=a.baseLanes|n,t.memoizedState=null):r=n,Be(ha,on),on|=r;return Ut(e,t,o,n),t.child}function k0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function vd(e,t,n,r,o){var a=Jt(n)?Ao:Wt.current;return a=Da(t,a),xa(t,o),n=Of(e,t,n,r,a,o),r=Lf(),e!==null&&!Yt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,br(e,t,o)):(He&&r&&Ef(t),t.flags|=1,Ut(e,t,n,o),t.child)}function om(e,t,n,r,o){if(Jt(n)){var a=!0;mu(t)}else a=!1;if(xa(t,o),t.stateNode===null)Zs(e,t),x0(t,n,r),pd(t,n,r,o),r=!0;else if(e===null){var i=t.stateNode,s=t.memoizedProps;i.props=s;var u=i.context,l=n.contextType;typeof l=="object"&&l!==null?l=En(l):(l=Jt(n)?Ao:Wt.current,l=Da(t,l));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof i.getSnapshotBeforeUpdate=="function";d||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(s!==r||u!==l)&&Jp(t,i,r,l),jr=!1;var f=t.memoizedState;i.state=f,bu(t,r,i,o),u=t.memoizedState,s!==r||f!==u||Qt.current||jr?(typeof c=="function"&&(hd(t,n,c,r),u=t.memoizedState),(s=jr||Qp(t,n,s,r,f,u,l))?(d||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),i.props=r,i.state=u,i.context=l,r=s):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,Jg(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:Dn(t.type,s),i.props=l,d=t.pendingProps,f=i.context,u=n.contextType,typeof u=="object"&&u!==null?u=En(u):(u=Jt(n)?Ao:Wt.current,u=Da(t,u));var h=n.getDerivedStateFromProps;(c=typeof h=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(s!==d||f!==u)&&Jp(t,i,r,u),jr=!1,f=t.memoizedState,i.state=f,bu(t,r,i,o);var v=t.memoizedState;s!==d||f!==v||Qt.current||jr?(typeof h=="function"&&(hd(t,n,h,r),v=t.memoizedState),(l=jr||Qp(t,n,l,r,f,v,u)||!1)?(c||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(r,v,u),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(r,v,u)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=v),i.props=r,i.state=v,i.context=u,r=l):(typeof i.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return gd(e,t,n,r,a,o)}function gd(e,t,n,r,o,a){k0(e,t);var i=(t.flags&128)!==0;if(!r&&!i)return o&&$p(t,n,!1),br(e,t,a);r=t.stateNode,Aw.current=t;var s=i&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&i?(t.child=Aa(t,e.child,null,a),t.child=Aa(t,null,s,a)):Ut(e,t,s,a),t.memoizedState=r.state,o&&$p(t,n,!0),t.child}function E0(e){var t=e.stateNode;t.pendingContext?Up(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Up(e,t.context,!1),Pf(e,t.containerInfo)}function am(e,t,n,r,o){return Ta(),Sf(o),t.flags|=256,Ut(e,t,n,r),t.child}var yd={dehydrated:null,treeContext:null,retryLane:0};function xd(e){return{baseLanes:e,cachePool:null,transitions:null}}function N0(e,t,n){var r=t.pendingProps,o=Ge.current,a=!1,i=(t.flags&128)!==0,s;if((s=i)||(s=e!==null&&e.memoizedState===null?!1:(o&2)!==0),s?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),Be(Ge,o&1),e===null)return dd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=r.children,e=r.fallback,a?(r=t.mode,a=t.child,i={mode:"hidden",children:i},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=i):a=pl(i,r,0,null),e=Do(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=xd(n),t.memoizedState=yd,e):zf(t,i));if(o=e.memoizedState,o!==null&&(s=o.dehydrated,s!==null))return Pw(e,t,i,r,s,o,n);if(a){a=r.fallback,i=t.mode,o=e.child,s=o.sibling;var u={mode:"hidden",children:r.children};return!(i&1)&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=u,t.deletions=null):(r=Qr(o,u),r.subtreeFlags=o.subtreeFlags&14680064),s!==null?a=Qr(s,a):(a=Do(a,i,n,null),a.flags|=2),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,i=e.child.memoizedState,i=i===null?xd(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},a.memoizedState=i,a.childLanes=e.childLanes&~n,t.memoizedState=yd,r}return a=e.child,e=a.sibling,r=Qr(a,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function zf(e,t){return t=pl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ns(e,t,n,r){return r!==null&&Sf(r),Aa(t,e.child,null,n),e=zf(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Pw(e,t,n,r,o,a,i){if(n)return t.flags&256?(t.flags&=-257,r=rc(Error(Q(422))),Ns(e,t,i,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=r.fallback,o=t.mode,r=pl({mode:"visible",children:r.children},o,0,null),a=Do(a,o,i,null),a.flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,t.mode&1&&Aa(t,e.child,null,i),t.child.memoizedState=xd(i),t.memoizedState=yd,a);if(!(t.mode&1))return Ns(e,t,i,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var s=r.dgst;return r=s,a=Error(Q(419)),r=rc(a,r,void 0),Ns(e,t,i,r)}if(s=(i&e.childLanes)!==0,Yt||s){if(r=wt,r!==null){switch(i&-i){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|i)?0:o,o!==0&&o!==a.retryLane&&(a.retryLane=o,xr(e,o),On(r,e,o,-1))}return qf(),r=rc(Error(Q(421))),Ns(e,t,i,r)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=Gw.bind(null,e),o._reactRetry=t,null):(e=a.treeContext,un=qr(o.nextSibling),fn=t,He=!0,An=null,e!==null&&(yn[xn++]=pr,yn[xn++]=mr,yn[xn++]=Po,pr=e.id,mr=e.overflow,Po=t),t=zf(t,r.children),t.flags|=4096,t)}function im(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),fd(e.return,t,n)}function oc(e,t,n,r,o){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function S0(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(Ut(e,t,r.children,n),r=Ge.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&im(e,n,t);else if(e.tag===19)im(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Be(Ge,r),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&wu(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),oc(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&wu(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}oc(t,!0,n,null,a);break;case"together":oc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Zs(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function br(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),jo|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Q(153));if(t.child!==null){for(e=t.child,n=Qr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Qr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Fw(e,t,n){switch(t.tag){case 3:E0(t),Ta();break;case 5:Zg(t);break;case 1:Jt(t.type)&&mu(t);break;case 4:Pf(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Be(yu,r._currentValue),r._currentValue=o;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Be(Ge,Ge.current&1),t.flags|=128,null):n&t.child.childLanes?N0(e,t,n):(Be(Ge,Ge.current&1),e=br(e,t,n),e!==null?e.sibling:null);Be(Ge,Ge.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return S0(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Be(Ge,Ge.current),r)break;return null;case 22:case 23:return t.lanes=0,_0(e,t,n)}return br(e,t,n)}var R0,bd,I0,D0;R0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};bd=function(){};I0=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,No(er.current);var a=null;switch(n){case"input":o=Uc(e,o),r=Uc(e,r),a=[];break;case"select":o=Ye({},o,{value:void 0}),r=Ye({},r,{value:void 0}),a=[];break;case"textarea":o=Hc(e,o),r=Hc(e,r),a=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=hu)}qc(n,r);var i;n=null;for(l in o)if(!r.hasOwnProperty(l)&&o.hasOwnProperty(l)&&o[l]!=null)if(l==="style"){var s=o[l];for(i in s)s.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(ki.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var u=r[l];if(s=o!=null?o[l]:void 0,r.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(i in s)!s.hasOwnProperty(i)||u&&u.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in u)u.hasOwnProperty(i)&&s[i]!==u[i]&&(n||(n={}),n[i]=u[i])}else n||(a||(a=[]),a.push(l,n)),n=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(a=a||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(a=a||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(ki.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&ze("scroll",e),a||s===u||(a=[])):(a=a||[]).push(l,u))}n&&(a=a||[]).push("style",n);var l=a;(t.updateQueue=l)&&(t.flags|=4)}};D0=function(e,t,n,r){n!==r&&(t.flags|=4)};function ni(e,t){if(!He)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Pt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function jw(e,t,n){var r=t.pendingProps;switch(Nf(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pt(t),null;case 1:return Jt(t.type)&&pu(),Pt(t),null;case 3:return r=t.stateNode,Pa(),$e(Qt),$e(Wt),jf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(ks(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,An!==null&&(Rd(An),An=null))),bd(e,t),Pt(t),null;case 5:Ff(t);var o=No(Mi.current);if(n=t.type,e!==null&&t.stateNode!=null)I0(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Q(166));return Pt(t),null}if(e=No(er.current),ks(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[Xn]=t,r[Fi]=a,e=(t.mode&1)!==0,n){case"dialog":ze("cancel",r),ze("close",r);break;case"iframe":case"object":case"embed":ze("load",r);break;case"video":case"audio":for(o=0;o<di.length;o++)ze(di[o],r);break;case"source":ze("error",r);break;case"img":case"image":case"link":ze("error",r),ze("load",r);break;case"details":ze("toggle",r);break;case"input":mp(r,a),ze("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},ze("invalid",r);break;case"textarea":gp(r,a),ze("invalid",r)}qc(n,a),o=null;for(var i in a)if(a.hasOwnProperty(i)){var s=a[i];i==="children"?typeof s=="string"?r.textContent!==s&&(a.suppressHydrationWarning!==!0&&_s(r.textContent,s,e),o=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&_s(r.textContent,s,e),o=["children",""+s]):ki.hasOwnProperty(i)&&s!=null&&i==="onScroll"&&ze("scroll",r)}switch(n){case"input":ms(r),vp(r,a,!0);break;case"textarea":ms(r),yp(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=hu)}r=o,t.updateQueue=r,r!==null&&(t.flags|=4)}else{i=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=og(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=i.createElement(n,{is:r.is}):(e=i.createElement(n),n==="select"&&(i=e,r.multiple?i.multiple=!0:r.size&&(i.size=r.size))):e=i.createElementNS(e,n),e[Xn]=t,e[Fi]=r,R0(e,t,!1,!1),t.stateNode=e;e:{switch(i=Kc(n,r),n){case"dialog":ze("cancel",e),ze("close",e),o=r;break;case"iframe":case"object":case"embed":ze("load",e),o=r;break;case"video":case"audio":for(o=0;o<di.length;o++)ze(di[o],e);o=r;break;case"source":ze("error",e),o=r;break;case"img":case"image":case"link":ze("error",e),ze("load",e),o=r;break;case"details":ze("toggle",e),o=r;break;case"input":mp(e,r),o=Uc(e,r),ze("invalid",e);break;case"option":o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=Ye({},r,{value:void 0}),ze("invalid",e);break;case"textarea":gp(e,r),o=Hc(e,r),ze("invalid",e);break;default:o=r}qc(n,o),s=o;for(a in s)if(s.hasOwnProperty(a)){var u=s[a];a==="style"?sg(e,u):a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&ag(e,u)):a==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Ei(e,u):typeof u=="number"&&Ei(e,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(ki.hasOwnProperty(a)?u!=null&&a==="onScroll"&&ze("scroll",e):u!=null&&df(e,a,u,i))}switch(n){case"input":ms(e),vp(e,r,!1);break;case"textarea":ms(e),yp(e);break;case"option":r.value!=null&&e.setAttribute("value",""+no(r.value));break;case"select":e.multiple=!!r.multiple,a=r.value,a!=null?ma(e,!!r.multiple,a,!1):r.defaultValue!=null&&ma(e,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=hu)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Pt(t),null;case 6:if(e&&t.stateNode!=null)D0(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Q(166));if(n=No(Mi.current),No(er.current),ks(t)){if(r=t.stateNode,n=t.memoizedProps,r[Xn]=t,(a=r.nodeValue!==n)&&(e=fn,e!==null))switch(e.tag){case 3:_s(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&_s(r.nodeValue,n,(e.mode&1)!==0)}a&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Xn]=t,t.stateNode=r}return Pt(t),null;case 13:if($e(Ge),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(He&&un!==null&&t.mode&1&&!(t.flags&128))Kg(),Ta(),t.flags|=98560,a=!1;else if(a=ks(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(Q(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Q(317));a[Xn]=t}else Ta(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Pt(t),a=!1}else An!==null&&(Rd(An),An=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Ge.current&1?ht===0&&(ht=3):qf())),t.updateQueue!==null&&(t.flags|=4),Pt(t),null);case 4:return Pa(),bd(e,t),e===null&&Ai(t.stateNode.containerInfo),Pt(t),null;case 10:return Df(t.type._context),Pt(t),null;case 17:return Jt(t.type)&&pu(),Pt(t),null;case 19:if($e(Ge),a=t.memoizedState,a===null)return Pt(t),null;if(r=(t.flags&128)!==0,i=a.rendering,i===null)if(r)ni(a,!1);else{if(ht!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=wu(e),i!==null){for(t.flags|=128,ni(a,!1),r=i.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)a=n,e=r,a.flags&=14680066,i=a.alternate,i===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,a.type=i.type,e=i.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Be(Ge,Ge.current&1|2),t.child}e=e.sibling}a.tail!==null&&rt()>ja&&(t.flags|=128,r=!0,ni(a,!1),t.lanes=4194304)}else{if(!r)if(e=wu(i),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),ni(a,!0),a.tail===null&&a.tailMode==="hidden"&&!i.alternate&&!He)return Pt(t),null}else 2*rt()-a.renderingStartTime>ja&&n!==1073741824&&(t.flags|=128,r=!0,ni(a,!1),t.lanes=4194304);a.isBackwards?(i.sibling=t.child,t.child=i):(n=a.last,n!==null?n.sibling=i:t.child=i,a.last=i)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=rt(),t.sibling=null,n=Ge.current,Be(Ge,r?n&1|2:n&1),t):(Pt(t),null);case 22:case 23:return Gf(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?on&1073741824&&(Pt(t),t.subtreeFlags&6&&(t.flags|=8192)):Pt(t),null;case 24:return null;case 25:return null}throw Error(Q(156,t.tag))}function Mw(e,t){switch(Nf(t),t.tag){case 1:return Jt(t.type)&&pu(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Pa(),$e(Qt),$e(Wt),jf(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ff(t),null;case 13:if($e(Ge),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Q(340));Ta()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return $e(Ge),null;case 4:return Pa(),null;case 10:return Df(t.type._context),null;case 22:case 23:return Gf(),null;case 24:return null;default:return null}}var Ss=!1,jt=!1,Ow=typeof WeakSet=="function"?WeakSet:Set,te=null;function fa(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ze(e,t,r)}else n.current=null}function wd(e,t,n){try{n()}catch(r){Ze(e,t,r)}}var sm=!1;function Lw(e,t){if(od=cu,e=jg(),kf(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var i=0,s=-1,u=-1,l=0,c=0,d=e,f=null;t:for(;;){for(var h;d!==n||o!==0&&d.nodeType!==3||(s=i+o),d!==a||r!==0&&d.nodeType!==3||(u=i+r),d.nodeType===3&&(i+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===e)break t;if(f===n&&++l===o&&(s=i),f===a&&++c===r&&(u=i),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=s===-1||u===-1?null:{start:s,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(ad={focusedElem:e,selectionRange:n},cu=!1,te=t;te!==null;)if(t=te,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,te=e;else for(;te!==null;){t=te;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var y=v.memoizedProps,x=v.memoizedState,m=t.stateNode,g=m.getSnapshotBeforeUpdate(t.elementType===t.type?y:Dn(t.type,y),x);m.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Q(163))}}catch(w){Ze(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,te=e;break}te=t.return}return v=sm,sm=!1,v}function yi(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&e)===e){var a=o.destroy;o.destroy=void 0,a!==void 0&&wd(t,n,a)}o=o.next}while(o!==r)}}function fl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Cd(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function T0(e){var t=e.alternate;t!==null&&(e.alternate=null,T0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Xn],delete t[Fi],delete t[ud],delete t[bw],delete t[ww])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function A0(e){return e.tag===5||e.tag===3||e.tag===4}function um(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||A0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function _d(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=hu));else if(r!==4&&(e=e.child,e!==null))for(_d(e,t,n),e=e.sibling;e!==null;)_d(e,t,n),e=e.sibling}function kd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(kd(e,t,n),e=e.sibling;e!==null;)kd(e,t,n),e=e.sibling}var Et=null,Tn=!1;function Dr(e,t,n){for(n=n.child;n!==null;)P0(e,t,n),n=n.sibling}function P0(e,t,n){if(Zn&&typeof Zn.onCommitFiberUnmount=="function")try{Zn.onCommitFiberUnmount(ol,n)}catch{}switch(n.tag){case 5:jt||fa(n,t);case 6:var r=Et,o=Tn;Et=null,Dr(e,t,n),Et=r,Tn=o,Et!==null&&(Tn?(e=Et,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Et.removeChild(n.stateNode));break;case 18:Et!==null&&(Tn?(e=Et,n=n.stateNode,e.nodeType===8?Ql(e.parentNode,n):e.nodeType===1&&Ql(e,n),Ii(e)):Ql(Et,n.stateNode));break;case 4:r=Et,o=Tn,Et=n.stateNode.containerInfo,Tn=!0,Dr(e,t,n),Et=r,Tn=o;break;case 0:case 11:case 14:case 15:if(!jt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var a=o,i=a.destroy;a=a.tag,i!==void 0&&(a&2||a&4)&&wd(n,t,i),o=o.next}while(o!==r)}Dr(e,t,n);break;case 1:if(!jt&&(fa(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Ze(n,t,s)}Dr(e,t,n);break;case 21:Dr(e,t,n);break;case 22:n.mode&1?(jt=(r=jt)||n.memoizedState!==null,Dr(e,t,n),jt=r):Dr(e,t,n);break;default:Dr(e,t,n)}}function lm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Ow),t.forEach(function(r){var o=qw.bind(null,e,r);n.has(r)||(n.add(r),r.then(o,o))})}}function In(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var a=e,i=t,s=i;e:for(;s!==null;){switch(s.tag){case 5:Et=s.stateNode,Tn=!1;break e;case 3:Et=s.stateNode.containerInfo,Tn=!0;break e;case 4:Et=s.stateNode.containerInfo,Tn=!0;break e}s=s.return}if(Et===null)throw Error(Q(160));P0(a,i,o),Et=null,Tn=!1;var u=o.alternate;u!==null&&(u.return=null),o.return=null}catch(l){Ze(o,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)F0(t,e),t=t.sibling}function F0(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(In(t,e),Vn(e),r&4){try{yi(3,e,e.return),fl(3,e)}catch(y){Ze(e,e.return,y)}try{yi(5,e,e.return)}catch(y){Ze(e,e.return,y)}}break;case 1:In(t,e),Vn(e),r&512&&n!==null&&fa(n,n.return);break;case 5:if(In(t,e),Vn(e),r&512&&n!==null&&fa(n,n.return),e.flags&32){var o=e.stateNode;try{Ei(o,"")}catch(y){Ze(e,e.return,y)}}if(r&4&&(o=e.stateNode,o!=null)){var a=e.memoizedProps,i=n!==null?n.memoizedProps:a,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&ng(o,a),Kc(s,i);var l=Kc(s,a);for(i=0;i<u.length;i+=2){var c=u[i],d=u[i+1];c==="style"?sg(o,d):c==="dangerouslySetInnerHTML"?ag(o,d):c==="children"?Ei(o,d):df(o,c,d,l)}switch(s){case"input":$c(o,a);break;case"textarea":rg(o,a);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!a.multiple;var h=a.value;h!=null?ma(o,!!a.multiple,h,!1):f!==!!a.multiple&&(a.defaultValue!=null?ma(o,!!a.multiple,a.defaultValue,!0):ma(o,!!a.multiple,a.multiple?[]:"",!1))}o[Fi]=a}catch(y){Ze(e,e.return,y)}}break;case 6:if(In(t,e),Vn(e),r&4){if(e.stateNode===null)throw Error(Q(162));o=e.stateNode,a=e.memoizedProps;try{o.nodeValue=a}catch(y){Ze(e,e.return,y)}}break;case 3:if(In(t,e),Vn(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ii(t.containerInfo)}catch(y){Ze(e,e.return,y)}break;case 4:In(t,e),Vn(e);break;case 13:In(t,e),Vn(e),o=e.child,o.flags&8192&&(a=o.memoizedState!==null,o.stateNode.isHidden=a,!a||o.alternate!==null&&o.alternate.memoizedState!==null||(Vf=rt())),r&4&&lm(e);break;case 22:if(c=n!==null&&n.memoizedState!==null,e.mode&1?(jt=(l=jt)||c,In(t,e),jt=l):In(t,e),Vn(e),r&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&e.mode&1)for(te=e,c=e.child;c!==null;){for(d=te=c;te!==null;){switch(f=te,h=f.child,f.tag){case 0:case 11:case 14:case 15:yi(4,f,f.return);break;case 1:fa(f,f.return);var v=f.stateNode;if(typeof v.componentWillUnmount=="function"){r=f,n=f.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(y){Ze(r,n,y)}}break;case 5:fa(f,f.return);break;case 22:if(f.memoizedState!==null){dm(d);continue}}h!==null?(h.return=f,te=h):dm(d)}c=c.sibling}e:for(c=null,d=e;;){if(d.tag===5){if(c===null){c=d;try{o=d.stateNode,l?(a=o.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=d.stateNode,u=d.memoizedProps.style,i=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=ig("display",i))}catch(y){Ze(e,e.return,y)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(y){Ze(e,e.return,y)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:In(t,e),Vn(e),r&4&&lm(e);break;case 21:break;default:In(t,e),Vn(e)}}function Vn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(A0(n)){var r=n;break e}n=n.return}throw Error(Q(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(Ei(o,""),r.flags&=-33);var a=um(e);kd(e,a,o);break;case 3:case 4:var i=r.stateNode.containerInfo,s=um(e);_d(e,s,i);break;default:throw Error(Q(161))}}catch(u){Ze(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Bw(e,t,n){te=e,j0(e)}function j0(e,t,n){for(var r=(e.mode&1)!==0;te!==null;){var o=te,a=o.child;if(o.tag===22&&r){var i=o.memoizedState!==null||Ss;if(!i){var s=o.alternate,u=s!==null&&s.memoizedState!==null||jt;s=Ss;var l=jt;if(Ss=i,(jt=u)&&!l)for(te=o;te!==null;)i=te,u=i.child,i.tag===22&&i.memoizedState!==null?fm(o):u!==null?(u.return=i,te=u):fm(o);for(;a!==null;)te=a,j0(a),a=a.sibling;te=o,Ss=s,jt=l}cm(e)}else o.subtreeFlags&8772&&a!==null?(a.return=o,te=a):cm(e)}}function cm(e){for(;te!==null;){var t=te;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:jt||fl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!jt)if(n===null)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:Dn(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&Kp(t,a,r);break;case 3:var i=t.updateQueue;if(i!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Kp(t,i,n)}break;case 5:var s=t.stateNode;if(n===null&&t.flags&4){n=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Ii(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Q(163))}jt||t.flags&512&&Cd(t)}catch(f){Ze(t,t.return,f)}}if(t===e){te=null;break}if(n=t.sibling,n!==null){n.return=t.return,te=n;break}te=t.return}}function dm(e){for(;te!==null;){var t=te;if(t===e){te=null;break}var n=t.sibling;if(n!==null){n.return=t.return,te=n;break}te=t.return}}function fm(e){for(;te!==null;){var t=te;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{fl(4,t)}catch(u){Ze(t,n,u)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var o=t.return;try{r.componentDidMount()}catch(u){Ze(t,o,u)}}var a=t.return;try{Cd(t)}catch(u){Ze(t,a,u)}break;case 5:var i=t.return;try{Cd(t)}catch(u){Ze(t,i,u)}}}catch(u){Ze(t,t.return,u)}if(t===e){te=null;break}var s=t.sibling;if(s!==null){s.return=t.return,te=s;break}te=t.return}}var Ww=Math.ceil,ku=wr.ReactCurrentDispatcher,Uf=wr.ReactCurrentOwner,kn=wr.ReactCurrentBatchConfig,Ie=0,wt=null,st=null,It=0,on=0,ha=uo(0),ht=0,Wi=null,jo=0,hl=0,$f=0,xi=null,qt=null,Vf=0,ja=1/0,dr=null,Eu=!1,Ed=null,Xr=null,Rs=!1,Wr=null,Nu=0,bi=0,Nd=null,eu=-1,tu=0;function $t(){return Ie&6?rt():eu!==-1?eu:eu=rt()}function Yr(e){return e.mode&1?Ie&2&&It!==0?It&-It:_w.transition!==null?(tu===0&&(tu=xg()),tu):(e=Me,e!==0||(e=window.event,e=e===void 0?16:Ng(e.type)),e):1}function On(e,t,n,r){if(50<bi)throw bi=0,Nd=null,Error(Q(185));Zi(e,n,r),(!(Ie&2)||e!==wt)&&(e===wt&&(!(Ie&2)&&(hl|=n),ht===4&&Or(e,It)),Zt(e,r),n===1&&Ie===0&&!(t.mode&1)&&(ja=rt()+500,ll&&lo()))}function Zt(e,t){var n=e.callbackNode;_b(e,t);var r=lu(e,e===wt?It:0);if(r===0)n!==null&&wp(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&wp(n),t===1)e.tag===0?Cw(hm.bind(null,e)):Hg(hm.bind(null,e)),yw(function(){!(Ie&6)&&lo()}),n=null;else{switch(bg(r)){case 1:n=vf;break;case 4:n=gg;break;case 16:n=uu;break;case 536870912:n=yg;break;default:n=uu}n=$0(n,M0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function M0(e,t){if(eu=-1,tu=0,Ie&6)throw Error(Q(327));var n=e.callbackNode;if(ba()&&e.callbackNode!==n)return null;var r=lu(e,e===wt?It:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Su(e,r);else{t=r;var o=Ie;Ie|=2;var a=L0();(wt!==e||It!==t)&&(dr=null,ja=rt()+500,Io(e,t));do try{$w();break}catch(s){O0(e,s)}while(1);If(),ku.current=a,Ie=o,st!==null?t=0:(wt=null,It=0,t=ht)}if(t!==0){if(t===2&&(o=Zc(e),o!==0&&(r=o,t=Sd(e,o))),t===1)throw n=Wi,Io(e,0),Or(e,r),Zt(e,rt()),n;if(t===6)Or(e,r);else{if(o=e.current.alternate,!(r&30)&&!zw(o)&&(t=Su(e,r),t===2&&(a=Zc(e),a!==0&&(r=a,t=Sd(e,a))),t===1))throw n=Wi,Io(e,0),Or(e,r),Zt(e,rt()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(Q(345));case 2:bo(e,qt,dr);break;case 3:if(Or(e,r),(r&130023424)===r&&(t=Vf+500-rt(),10<t)){if(lu(e,0)!==0)break;if(o=e.suspendedLanes,(o&r)!==r){$t(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=sd(bo.bind(null,e,qt,dr),t);break}bo(e,qt,dr);break;case 4:if(Or(e,r),(r&4194240)===r)break;for(t=e.eventTimes,o=-1;0<r;){var i=31-Mn(r);a=1<<i,i=t[i],i>o&&(o=i),r&=~a}if(r=o,r=rt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ww(r/1960))-r,10<r){e.timeoutHandle=sd(bo.bind(null,e,qt,dr),r);break}bo(e,qt,dr);break;case 5:bo(e,qt,dr);break;default:throw Error(Q(329))}}}return Zt(e,rt()),e.callbackNode===n?M0.bind(null,e):null}function Sd(e,t){var n=xi;return e.current.memoizedState.isDehydrated&&(Io(e,t).flags|=256),e=Su(e,t),e!==2&&(t=qt,qt=n,t!==null&&Rd(t)),e}function Rd(e){qt===null?qt=e:qt.push.apply(qt,e)}function zw(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!Bn(a(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Or(e,t){for(t&=~$f,t&=~hl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Mn(t),r=1<<n;e[n]=-1,t&=~r}}function hm(e){if(Ie&6)throw Error(Q(327));ba();var t=lu(e,0);if(!(t&1))return Zt(e,rt()),null;var n=Su(e,t);if(e.tag!==0&&n===2){var r=Zc(e);r!==0&&(t=r,n=Sd(e,r))}if(n===1)throw n=Wi,Io(e,0),Or(e,t),Zt(e,rt()),n;if(n===6)throw Error(Q(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bo(e,qt,dr),Zt(e,rt()),null}function Hf(e,t){var n=Ie;Ie|=1;try{return e(t)}finally{Ie=n,Ie===0&&(ja=rt()+500,ll&&lo())}}function Mo(e){Wr!==null&&Wr.tag===0&&!(Ie&6)&&ba();var t=Ie;Ie|=1;var n=kn.transition,r=Me;try{if(kn.transition=null,Me=1,e)return e()}finally{Me=r,kn.transition=n,Ie=t,!(Ie&6)&&lo()}}function Gf(){on=ha.current,$e(ha)}function Io(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,gw(n)),st!==null)for(n=st.return;n!==null;){var r=n;switch(Nf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&pu();break;case 3:Pa(),$e(Qt),$e(Wt),jf();break;case 5:Ff(r);break;case 4:Pa();break;case 13:$e(Ge);break;case 19:$e(Ge);break;case 10:Df(r.type._context);break;case 22:case 23:Gf()}n=n.return}if(wt=e,st=e=Qr(e.current,null),It=on=t,ht=0,Wi=null,$f=hl=jo=0,qt=xi=null,Eo!==null){for(t=0;t<Eo.length;t++)if(n=Eo[t],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,a=n.pending;if(a!==null){var i=a.next;a.next=o,r.next=i}n.pending=r}Eo=null}return e}function O0(e,t){do{var n=st;try{if(If(),Qs.current=_u,Cu){for(var r=Xe.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}Cu=!1}if(Fo=0,bt=ft=Xe=null,gi=!1,Oi=0,Uf.current=null,n===null||n.return===null){ht=1,Wi=t,st=null;break}e:{var a=e,i=n.return,s=n,u=t;if(t=It,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=em(i);if(h!==null){h.flags&=-257,tm(h,i,s,a,t),h.mode&1&&Zp(a,l,t),t=h,u=l;var v=t.updateQueue;if(v===null){var y=new Set;y.add(u),t.updateQueue=y}else v.add(u);break e}else{if(!(t&1)){Zp(a,l,t),qf();break e}u=Error(Q(426))}}else if(He&&s.mode&1){var x=em(i);if(x!==null){!(x.flags&65536)&&(x.flags|=256),tm(x,i,s,a,t),Sf(Fa(u,s));break e}}a=u=Fa(u,s),ht!==4&&(ht=2),xi===null?xi=[a]:xi.push(a),a=i;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var m=b0(a,u,t);qp(a,m);break e;case 1:s=u;var g=a.type,b=a.stateNode;if(!(a.flags&128)&&(typeof g.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Xr===null||!Xr.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t;var w=w0(a,s,t);qp(a,w);break e}}a=a.return}while(a!==null)}W0(n)}catch(C){t=C,st===n&&n!==null&&(st=n=n.return);continue}break}while(1)}function L0(){var e=ku.current;return ku.current=_u,e===null?_u:e}function qf(){(ht===0||ht===3||ht===2)&&(ht=4),wt===null||!(jo&268435455)&&!(hl&268435455)||Or(wt,It)}function Su(e,t){var n=Ie;Ie|=2;var r=L0();(wt!==e||It!==t)&&(dr=null,Io(e,t));do try{Uw();break}catch(o){O0(e,o)}while(1);if(If(),Ie=n,ku.current=r,st!==null)throw Error(Q(261));return wt=null,It=0,ht}function Uw(){for(;st!==null;)B0(st)}function $w(){for(;st!==null&&!pb();)B0(st)}function B0(e){var t=U0(e.alternate,e,on);e.memoizedProps=e.pendingProps,t===null?W0(e):st=t,Uf.current=null}function W0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Mw(n,t),n!==null){n.flags&=32767,st=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ht=6,st=null;return}}else if(n=jw(n,t,on),n!==null){st=n;return}if(t=t.sibling,t!==null){st=t;return}st=t=e}while(t!==null);ht===0&&(ht=5)}function bo(e,t,n){var r=Me,o=kn.transition;try{kn.transition=null,Me=1,Vw(e,t,n,r)}finally{kn.transition=o,Me=r}return null}function Vw(e,t,n,r){do ba();while(Wr!==null);if(Ie&6)throw Error(Q(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Q(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(kb(e,a),e===wt&&(st=wt=null,It=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Rs||(Rs=!0,$0(uu,function(){return ba(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=kn.transition,kn.transition=null;var i=Me;Me=1;var s=Ie;Ie|=4,Uf.current=null,Lw(e,n),F0(n,e),cw(ad),cu=!!od,ad=od=null,e.current=n,Bw(n),mb(),Ie=s,Me=i,kn.transition=a}else e.current=n;if(Rs&&(Rs=!1,Wr=e,Nu=o),a=e.pendingLanes,a===0&&(Xr=null),yb(n.stateNode),Zt(e,rt()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Eu)throw Eu=!1,e=Ed,Ed=null,e;return Nu&1&&e.tag!==0&&ba(),a=e.pendingLanes,a&1?e===Nd?bi++:(bi=0,Nd=e):bi=0,lo(),null}function ba(){if(Wr!==null){var e=bg(Nu),t=kn.transition,n=Me;try{if(kn.transition=null,Me=16>e?16:e,Wr===null)var r=!1;else{if(e=Wr,Wr=null,Nu=0,Ie&6)throw Error(Q(331));var o=Ie;for(Ie|=4,te=e.current;te!==null;){var a=te,i=a.child;if(te.flags&16){var s=a.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(te=l;te!==null;){var c=te;switch(c.tag){case 0:case 11:case 15:yi(8,c,a)}var d=c.child;if(d!==null)d.return=c,te=d;else for(;te!==null;){c=te;var f=c.sibling,h=c.return;if(T0(c),c===l){te=null;break}if(f!==null){f.return=h,te=f;break}te=h}}}var v=a.alternate;if(v!==null){var y=v.child;if(y!==null){v.child=null;do{var x=y.sibling;y.sibling=null,y=x}while(y!==null)}}te=a}}if(a.subtreeFlags&2064&&i!==null)i.return=a,te=i;else e:for(;te!==null;){if(a=te,a.flags&2048)switch(a.tag){case 0:case 11:case 15:yi(9,a,a.return)}var m=a.sibling;if(m!==null){m.return=a.return,te=m;break e}te=a.return}}var g=e.current;for(te=g;te!==null;){i=te;var b=i.child;if(i.subtreeFlags&2064&&b!==null)b.return=i,te=b;else e:for(i=g;te!==null;){if(s=te,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:fl(9,s)}}catch(C){Ze(s,s.return,C)}if(s===i){te=null;break e}var w=s.sibling;if(w!==null){w.return=s.return,te=w;break e}te=s.return}}if(Ie=o,lo(),Zn&&typeof Zn.onPostCommitFiberRoot=="function")try{Zn.onPostCommitFiberRoot(ol,e)}catch{}r=!0}return r}finally{Me=n,kn.transition=t}}return!1}function pm(e,t,n){t=Fa(n,t),t=b0(e,t,1),e=Kr(e,t,1),t=$t(),e!==null&&(Zi(e,1,t),Zt(e,t))}function Ze(e,t,n){if(e.tag===3)pm(e,e,n);else for(;t!==null;){if(t.tag===3){pm(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Xr===null||!Xr.has(r))){e=Fa(n,e),e=w0(t,e,1),t=Kr(t,e,1),e=$t(),t!==null&&(Zi(t,1,e),Zt(t,e));break}}t=t.return}}function Hw(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=$t(),e.pingedLanes|=e.suspendedLanes&n,wt===e&&(It&n)===n&&(ht===4||ht===3&&(It&130023424)===It&&500>rt()-Vf?Io(e,0):$f|=n),Zt(e,t)}function z0(e,t){t===0&&(e.mode&1?(t=ys,ys<<=1,!(ys&130023424)&&(ys=4194304)):t=1);var n=$t();e=xr(e,t),e!==null&&(Zi(e,t,n),Zt(e,n))}function Gw(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),z0(e,n)}function qw(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Q(314))}r!==null&&r.delete(t),z0(e,n)}var U0;U0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Qt.current)Yt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Yt=!1,Fw(e,t,n);Yt=!!(e.flags&131072)}else Yt=!1,He&&t.flags&1048576&&Gg(t,gu,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Zs(e,t),e=t.pendingProps;var o=Da(t,Wt.current);xa(t,n),o=Of(null,t,r,e,o,n);var a=Lf();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Jt(r)?(a=!0,mu(t)):a=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Af(t),o.updater=dl,t.stateNode=o,o._reactInternals=t,pd(t,r,e,n),t=gd(null,t,r,!0,a,n)):(t.tag=0,He&&a&&Ef(t),Ut(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Zs(e,t),e=t.pendingProps,o=r._init,r=o(r._payload),t.type=r,o=t.tag=Xw(r),e=Dn(r,e),o){case 0:t=vd(null,t,r,e,n);break e;case 1:t=om(null,t,r,e,n);break e;case 11:t=nm(null,t,r,e,n);break e;case 14:t=rm(null,t,r,Dn(r.type,e),n);break e}throw Error(Q(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:Dn(r,o),vd(e,t,r,o,n);case 1:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:Dn(r,o),om(e,t,r,o,n);case 3:e:{if(E0(t),e===null)throw Error(Q(387));r=t.pendingProps,a=t.memoizedState,o=a.element,Jg(e,t),bu(t,r,null,n);var i=t.memoizedState;if(r=i.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){o=Fa(Error(Q(423)),t),t=am(e,t,r,n,o);break e}else if(r!==o){o=Fa(Error(Q(424)),t),t=am(e,t,r,n,o);break e}else for(un=qr(t.stateNode.containerInfo.firstChild),fn=t,He=!0,An=null,n=Yg(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ta(),r===o){t=br(e,t,n);break e}Ut(e,t,r,n)}t=t.child}return t;case 5:return Zg(t),e===null&&dd(t),r=t.type,o=t.pendingProps,a=e!==null?e.memoizedProps:null,i=o.children,id(r,o)?i=null:a!==null&&id(r,a)&&(t.flags|=32),k0(e,t),Ut(e,t,i,n),t.child;case 6:return e===null&&dd(t),null;case 13:return N0(e,t,n);case 4:return Pf(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Aa(t,null,r,n):Ut(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:Dn(r,o),nm(e,t,r,o,n);case 7:return Ut(e,t,t.pendingProps,n),t.child;case 8:return Ut(e,t,t.pendingProps.children,n),t.child;case 12:return Ut(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,a=t.memoizedProps,i=o.value,Be(yu,r._currentValue),r._currentValue=i,a!==null)if(Bn(a.value,i)){if(a.children===o.children&&!Qt.current){t=br(e,t,n);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var s=a.dependencies;if(s!==null){i=a.child;for(var u=s.firstContext;u!==null;){if(u.context===r){if(a.tag===1){u=vr(-1,n&-n),u.tag=2;var l=a.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}a.lanes|=n,u=a.alternate,u!==null&&(u.lanes|=n),fd(a.return,n,t),s.lanes|=n;break}u=u.next}}else if(a.tag===10)i=a.type===t.type?null:a.child;else if(a.tag===18){if(i=a.return,i===null)throw Error(Q(341));i.lanes|=n,s=i.alternate,s!==null&&(s.lanes|=n),fd(i,n,t),i=a.sibling}else i=a.child;if(i!==null)i.return=a;else for(i=a;i!==null;){if(i===t){i=null;break}if(a=i.sibling,a!==null){a.return=i.return,i=a;break}i=i.return}a=i}Ut(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,xa(t,n),o=En(o),r=r(o),t.flags|=1,Ut(e,t,r,n),t.child;case 14:return r=t.type,o=Dn(r,t.pendingProps),o=Dn(r.type,o),rm(e,t,r,o,n);case 15:return C0(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:Dn(r,o),Zs(e,t),t.tag=1,Jt(r)?(e=!0,mu(t)):e=!1,xa(t,n),x0(t,r,o),pd(t,r,o,n),gd(null,t,r,!0,e,n);case 19:return S0(e,t,n);case 22:return _0(e,t,n)}throw Error(Q(156,t.tag))};function $0(e,t){return vg(e,t)}function Kw(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cn(e,t,n,r){return new Kw(e,t,n,r)}function Kf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Xw(e){if(typeof e=="function")return Kf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===hf)return 11;if(e===pf)return 14}return 2}function Qr(e,t){var n=e.alternate;return n===null?(n=Cn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function nu(e,t,n,r,o,a){var i=2;if(r=e,typeof e=="function")Kf(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case ra:return Do(n.children,o,a,t);case ff:i=8,o|=8;break;case Lc:return e=Cn(12,n,t,o|2),e.elementType=Lc,e.lanes=a,e;case Bc:return e=Cn(13,n,t,o),e.elementType=Bc,e.lanes=a,e;case Wc:return e=Cn(19,n,t,o),e.elementType=Wc,e.lanes=a,e;case Zv:return pl(n,o,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Qv:i=10;break e;case Jv:i=9;break e;case hf:i=11;break e;case pf:i=14;break e;case Fr:i=16,r=null;break e}throw Error(Q(130,e==null?e:typeof e,""))}return t=Cn(i,n,t,o),t.elementType=e,t.type=r,t.lanes=a,t}function Do(e,t,n,r){return e=Cn(7,e,r,t),e.lanes=n,e}function pl(e,t,n,r){return e=Cn(22,e,r,t),e.elementType=Zv,e.lanes=n,e.stateNode={isHidden:!1},e}function ac(e,t,n){return e=Cn(6,e,null,t),e.lanes=n,e}function ic(e,t,n){return t=Cn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Yw(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wl(0),this.expirationTimes=Wl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wl(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Xf(e,t,n,r,o,a,i,s,u){return e=new Yw(e,t,n,s,u),t===1?(t=1,a===!0&&(t|=8)):t=0,a=Cn(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Af(a),e}function Qw(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:na,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function V0(e){if(!e)return ro;e=e._reactInternals;e:{if(Wo(e)!==e||e.tag!==1)throw Error(Q(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Jt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Q(171))}if(e.tag===1){var n=e.type;if(Jt(n))return Vg(e,n,t)}return t}function H0(e,t,n,r,o,a,i,s,u){return e=Xf(n,r,!0,e,o,a,i,s,u),e.context=V0(null),n=e.current,r=$t(),o=Yr(n),a=vr(r,o),a.callback=t??null,Kr(n,a,o),e.current.lanes=o,Zi(e,o,r),Zt(e,r),e}function ml(e,t,n,r){var o=t.current,a=$t(),i=Yr(o);return n=V0(n),t.context===null?t.context=n:t.pendingContext=n,t=vr(a,i),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Kr(o,t,i),e!==null&&(On(e,o,i,a),Ys(e,o,i)),i}function Ru(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function mm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Yf(e,t){mm(e,t),(e=e.alternate)&&mm(e,t)}function Jw(){return null}var G0=typeof reportError=="function"?reportError:function(e){console.error(e)};function Qf(e){this._internalRoot=e}vl.prototype.render=Qf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Q(409));ml(e,t,null,null)};vl.prototype.unmount=Qf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Mo(function(){ml(null,e,null,null)}),t[yr]=null}};function vl(e){this._internalRoot=e}vl.prototype.unstable_scheduleHydration=function(e){if(e){var t=_g();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Mr.length&&t!==0&&t<Mr[n].priority;n++);Mr.splice(n,0,e),n===0&&Eg(e)}};function Jf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function gl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function vm(){}function Zw(e,t,n,r,o){if(o){if(typeof r=="function"){var a=r;r=function(){var l=Ru(i);a.call(l)}}var i=H0(t,r,e,0,null,!1,!1,"",vm);return e._reactRootContainer=i,e[yr]=i.current,Ai(e.nodeType===8?e.parentNode:e),Mo(),i}for(;o=e.lastChild;)e.removeChild(o);if(typeof r=="function"){var s=r;r=function(){var l=Ru(u);s.call(l)}}var u=Xf(e,0,!1,null,null,!1,!1,"",vm);return e._reactRootContainer=u,e[yr]=u.current,Ai(e.nodeType===8?e.parentNode:e),Mo(function(){ml(t,u,n,r)}),u}function yl(e,t,n,r,o){var a=n._reactRootContainer;if(a){var i=a;if(typeof o=="function"){var s=o;o=function(){var u=Ru(i);s.call(u)}}ml(t,i,e,o)}else i=Zw(n,t,e,o,r);return Ru(i)}wg=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ci(t.pendingLanes);n!==0&&(gf(t,n|1),Zt(t,rt()),!(Ie&6)&&(ja=rt()+500,lo()))}break;case 13:Mo(function(){var r=xr(e,1);if(r!==null){var o=$t();On(r,e,1,o)}}),Yf(e,1)}};yf=function(e){if(e.tag===13){var t=xr(e,134217728);if(t!==null){var n=$t();On(t,e,134217728,n)}Yf(e,134217728)}};Cg=function(e){if(e.tag===13){var t=Yr(e),n=xr(e,t);if(n!==null){var r=$t();On(n,e,t,r)}Yf(e,t)}};_g=function(){return Me};kg=function(e,t){var n=Me;try{return Me=e,t()}finally{Me=n}};Yc=function(e,t,n){switch(t){case"input":if($c(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=ul(r);if(!o)throw Error(Q(90));tg(r),$c(r,o)}}}break;case"textarea":rg(e,n);break;case"select":t=n.value,t!=null&&ma(e,!!n.multiple,t,!1)}};cg=Hf;dg=Mo;var e2={usingClientEntryPoint:!1,Events:[ts,sa,ul,ug,lg,Hf]},ri={findFiberByHostInstance:ko,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},t2={bundleType:ri.bundleType,version:ri.version,rendererPackageName:ri.rendererPackageName,rendererConfig:ri.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:wr.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=pg(e),e===null?null:e.stateNode},findFiberByHostInstance:ri.findFiberByHostInstance||Jw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Is=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Is.isDisabled&&Is.supportsFiber)try{ol=Is.inject(t2),Zn=Is}catch{}}mn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=e2;mn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jf(t))throw Error(Q(200));return Qw(e,t,null,n)};mn.createRoot=function(e,t){if(!Jf(e))throw Error(Q(299));var n=!1,r="",o=G0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=Xf(e,1,!1,null,null,n,!1,r,o),e[yr]=t.current,Ai(e.nodeType===8?e.parentNode:e),new Qf(t)};mn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Q(188)):(e=Object.keys(e).join(","),Error(Q(268,e)));return e=pg(t),e=e===null?null:e.stateNode,e};mn.flushSync=function(e){return Mo(e)};mn.hydrate=function(e,t,n){if(!gl(t))throw Error(Q(200));return yl(null,e,t,!0,n)};mn.hydrateRoot=function(e,t,n){if(!Jf(e))throw Error(Q(405));var r=n!=null&&n.hydratedSources||null,o=!1,a="",i=G0;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),t=H0(t,null,e,1,n??null,o,!1,a,i),e[yr]=t.current,Ai(e),r)for(e=0;e<r.length;e++)n=r[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new vl(t)};mn.render=function(e,t,n){if(!gl(t))throw Error(Q(200));return yl(null,e,t,!1,n)};mn.unmountComponentAtNode=function(e){if(!gl(e))throw Error(Q(40));return e._reactRootContainer?(Mo(function(){yl(null,null,e,!1,function(){e._reactRootContainer=null,e[yr]=null})}),!0):!1};mn.unstable_batchedUpdates=Hf;mn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!gl(n))throw Error(Q(200));if(e==null||e._reactInternals===void 0)throw Error(Q(38));return yl(e,t,n,!1,r)};mn.version="18.3.1-next-f1338f8080-20240426";function q0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(q0)}catch(e){console.error(e)}}q0(),qv.exports=mn;var n2=qv.exports,gm=n2;Mc.createRoot=gm.createRoot,Mc.hydrateRoot=gm.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zi(){return zi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},zi.apply(this,arguments)}var zr;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(zr||(zr={}));const ym="popstate";function r2(e){e===void 0&&(e={});function t(r,o){let{pathname:a,search:i,hash:s}=r.location;return Id("",{pathname:a,search:i,hash:s},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){return typeof o=="string"?o:Iu(o)}return a2(t,n,null,e)}function at(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function K0(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function o2(){return Math.random().toString(36).substr(2,8)}function xm(e,t){return{usr:e.state,key:e.key,idx:t}}function Id(e,t,n,r){return n===void 0&&(n=null),zi({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?$a(t):t,{state:n,key:t&&t.key||r||o2()})}function Iu(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function $a(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function a2(e,t,n,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:a=!1}=r,i=o.history,s=zr.Pop,u=null,l=c();l==null&&(l=0,i.replaceState(zi({},i.state,{idx:l}),""));function c(){return(i.state||{idx:null}).idx}function d(){s=zr.Pop;let x=c(),m=x==null?null:x-l;l=x,u&&u({action:s,location:y.location,delta:m})}function f(x,m){s=zr.Push;let g=Id(y.location,x,m);n&&n(g,x),l=c()+1;let b=xm(g,l),w=y.createHref(g);try{i.pushState(b,"",w)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;o.location.assign(w)}a&&u&&u({action:s,location:y.location,delta:1})}function h(x,m){s=zr.Replace;let g=Id(y.location,x,m);n&&n(g,x),l=c();let b=xm(g,l),w=y.createHref(g);i.replaceState(b,"",w),a&&u&&u({action:s,location:y.location,delta:0})}function v(x){let m=o.location.origin!=="null"?o.location.origin:o.location.href,g=typeof x=="string"?x:Iu(x);return g=g.replace(/ $/,"%20"),at(m,"No window.location.(origin|href) available to create URL for href: "+g),new URL(g,m)}let y={get action(){return s},get location(){return e(o,i)},listen(x){if(u)throw new Error("A history only accepts one active listener");return o.addEventListener(ym,d),u=x,()=>{o.removeEventListener(ym,d),u=null}},createHref(x){return t(o,x)},createURL:v,encodeLocation(x){let m=v(x);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:f,replace:h,go(x){return i.go(x)}};return y}var bm;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(bm||(bm={}));function i2(e,t,n){return n===void 0&&(n="/"),s2(e,t,n,!1)}function s2(e,t,n,r){let o=typeof t=="string"?$a(t):t,a=Zf(o.pathname||"/",n);if(a==null)return null;let i=X0(e);u2(i);let s=null;for(let u=0;s==null&&u<i.length;++u){let l=x2(a);s=g2(i[u],l,r)}return s}function X0(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let o=(a,i,s)=>{let u={relativePath:s===void 0?a.path||"":s,caseSensitive:a.caseSensitive===!0,childrenIndex:i,route:a};u.relativePath.startsWith("/")&&(at(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let l=Jr([r,u.relativePath]),c=n.concat(u);a.children&&a.children.length>0&&(at(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),X0(a.children,t,c,l)),!(a.path==null&&!a.index)&&t.push({path:l,score:m2(l,a.index),routesMeta:c})};return e.forEach((a,i)=>{var s;if(a.path===""||!((s=a.path)!=null&&s.includes("?")))o(a,i);else for(let u of Y0(a.path))o(a,i,u)}),t}function Y0(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,o=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return o?[a,""]:[a];let i=Y0(r.join("/")),s=[];return s.push(...i.map(u=>u===""?a:[a,u].join("/"))),o&&s.push(...i),s.map(u=>e.startsWith("/")&&u===""?"/":u)}function u2(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:v2(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const l2=/^:[\w-]+$/,c2=3,d2=2,f2=1,h2=10,p2=-2,wm=e=>e==="*";function m2(e,t){let n=e.split("/"),r=n.length;return n.some(wm)&&(r+=p2),t&&(r+=d2),n.filter(o=>!wm(o)).reduce((o,a)=>o+(l2.test(a)?c2:a===""?f2:h2),r)}function v2(e,t){return e.length===t.length&&e.slice(0,-1).every((r,o)=>r===t[o])?e[e.length-1]-t[t.length-1]:0}function g2(e,t,n){n===void 0&&(n=!1);let{routesMeta:r}=e,o={},a="/",i=[];for(let s=0;s<r.length;++s){let u=r[s],l=s===r.length-1,c=a==="/"?t:t.slice(a.length)||"/",d=Cm({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),f=u.route;if(!d&&l&&n&&!r[r.length-1].route.index&&(d=Cm({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!d)return null;Object.assign(o,d.params),i.push({params:o,pathname:Jr([a,d.pathname]),pathnameBase:_2(Jr([a,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(a=Jr([a,d.pathnameBase]))}return i}function Cm(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=y2(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let a=o[0],i=a.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((l,c,d)=>{let{paramName:f,isOptional:h}=c;if(f==="*"){let y=s[d]||"";i=a.slice(0,a.length-y.length).replace(/(.)\/+$/,"$1")}const v=s[d];return h&&!v?l[f]=void 0:l[f]=(v||"").replace(/%2F/g,"/"),l},{}),pathname:a,pathnameBase:i,pattern:e}}function y2(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),K0(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,s,u)=>(r.push({paramName:s,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function x2(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return K0(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Zf(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function b2(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:o=""}=typeof e=="string"?$a(e):e;return{pathname:n?n.startsWith("/")?n:w2(n,t):t,search:k2(r),hash:E2(o)}}function w2(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function sc(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function C2(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function eh(e,t){let n=C2(e);return t?n.map((r,o)=>o===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function th(e,t,n,r){r===void 0&&(r=!1);let o;typeof e=="string"?o=$a(e):(o=zi({},e),at(!o.pathname||!o.pathname.includes("?"),sc("?","pathname","search",o)),at(!o.pathname||!o.pathname.includes("#"),sc("#","pathname","hash",o)),at(!o.search||!o.search.includes("#"),sc("#","search","hash",o)));let a=e===""||o.pathname==="",i=a?"/":o.pathname,s;if(i==null)s=n;else{let d=t.length-1;if(!r&&i.startsWith("..")){let f=i.split("/");for(;f[0]==="..";)f.shift(),d-=1;o.pathname=f.join("/")}s=d>=0?t[d]:"/"}let u=b2(o,s),l=i&&i!=="/"&&i.endsWith("/"),c=(a||i===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const Jr=e=>e.join("/").replace(/\/\/+/g,"/"),_2=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),k2=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,E2=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function N2(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Q0=["post","put","patch","delete"];new Set(Q0);const S2=["get",...Q0];new Set(S2);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ui(){return Ui=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ui.apply(this,arguments)}const nh=M.createContext(null),R2=M.createContext(null),co=M.createContext(null),xl=M.createContext(null),fo=M.createContext({outlet:null,matches:[],isDataRoute:!1}),J0=M.createContext(null);function I2(e,t){let{relative:n}=t===void 0?{}:t;Va()||at(!1);let{basename:r,navigator:o}=M.useContext(co),{hash:a,pathname:i,search:s}=ey(e,{relative:n}),u=i;return r!=="/"&&(u=i==="/"?r:Jr([r,i])),o.createHref({pathname:u,search:s,hash:a})}function Va(){return M.useContext(xl)!=null}function ho(){return Va()||at(!1),M.useContext(xl).location}function Z0(e){M.useContext(co).static||M.useLayoutEffect(e)}function Ha(){let{isDataRoute:e}=M.useContext(fo);return e?U2():D2()}function D2(){Va()||at(!1);let e=M.useContext(nh),{basename:t,future:n,navigator:r}=M.useContext(co),{matches:o}=M.useContext(fo),{pathname:a}=ho(),i=JSON.stringify(eh(o,n.v7_relativeSplatPath)),s=M.useRef(!1);return Z0(()=>{s.current=!0}),M.useCallback(function(l,c){if(c===void 0&&(c={}),!s.current)return;if(typeof l=="number"){r.go(l);return}let d=th(l,JSON.parse(i),a,c.relative==="path");e==null&&t!=="/"&&(d.pathname=d.pathname==="/"?t:Jr([t,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[t,r,i,a,e])}function ey(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=M.useContext(co),{matches:o}=M.useContext(fo),{pathname:a}=ho(),i=JSON.stringify(eh(o,r.v7_relativeSplatPath));return M.useMemo(()=>th(e,JSON.parse(i),a,n==="path"),[e,i,a,n])}function T2(e,t){return A2(e,t)}function A2(e,t,n,r){Va()||at(!1);let{navigator:o}=M.useContext(co),{matches:a}=M.useContext(fo),i=a[a.length-1],s=i?i.params:{};i&&i.pathname;let u=i?i.pathnameBase:"/";i&&i.route;let l=ho(),c;if(t){var d;let x=typeof t=="string"?$a(t):t;u==="/"||(d=x.pathname)!=null&&d.startsWith(u)||at(!1),c=x}else c=l;let f=c.pathname||"/",h=f;if(u!=="/"){let x=u.replace(/^\//,"").split("/");h="/"+f.replace(/^\//,"").split("/").slice(x.length).join("/")}let v=i2(e,{pathname:h}),y=O2(v&&v.map(x=>Object.assign({},x,{params:Object.assign({},s,x.params),pathname:Jr([u,o.encodeLocation?o.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?u:Jr([u,o.encodeLocation?o.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),a,n,r);return t&&y?M.createElement(xl.Provider,{value:{location:Ui({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:zr.Pop}},y):y}function P2(){let e=z2(),t=N2(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},a=null;return M.createElement(M.Fragment,null,M.createElement("h2",null,"Unexpected Application Error!"),M.createElement("h3",{style:{fontStyle:"italic"}},t),n?M.createElement("pre",{style:o},n):null,a)}const F2=M.createElement(P2,null);class j2 extends M.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?M.createElement(fo.Provider,{value:this.props.routeContext},M.createElement(J0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function M2(e){let{routeContext:t,match:n,children:r}=e,o=M.useContext(nh);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),M.createElement(fo.Provider,{value:t},r)}function O2(e,t,n,r){var o;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var a;if(!n)return null;if(n.errors)e=n.matches;else if((a=r)!=null&&a.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let i=e,s=(o=n)==null?void 0:o.errors;if(s!=null){let c=i.findIndex(d=>d.route.id&&(s==null?void 0:s[d.route.id])!==void 0);c>=0||at(!1),i=i.slice(0,Math.min(i.length,c+1))}let u=!1,l=-1;if(n&&r&&r.v7_partialHydration)for(let c=0;c<i.length;c++){let d=i[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=c),d.route.id){let{loaderData:f,errors:h}=n,v=d.route.loader&&f[d.route.id]===void 0&&(!h||h[d.route.id]===void 0);if(d.route.lazy||v){u=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}return i.reduceRight((c,d,f)=>{let h,v=!1,y=null,x=null;n&&(h=s&&d.route.id?s[d.route.id]:void 0,y=d.route.errorElement||F2,u&&(l<0&&f===0?($2("route-fallback",!1),v=!0,x=null):l===f&&(v=!0,x=d.route.hydrateFallbackElement||null)));let m=t.concat(i.slice(0,f+1)),g=()=>{let b;return h?b=y:v?b=x:d.route.Component?b=M.createElement(d.route.Component,null):d.route.element?b=d.route.element:b=c,M.createElement(M2,{match:d,routeContext:{outlet:c,matches:m,isDataRoute:n!=null},children:b})};return n&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?M.createElement(j2,{location:n.location,revalidation:n.revalidation,component:y,error:h,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}var ty=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ty||{}),Du=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Du||{});function L2(e){let t=M.useContext(nh);return t||at(!1),t}function B2(e){let t=M.useContext(R2);return t||at(!1),t}function W2(e){let t=M.useContext(fo);return t||at(!1),t}function ny(e){let t=W2(),n=t.matches[t.matches.length-1];return n.route.id||at(!1),n.route.id}function z2(){var e;let t=M.useContext(J0),n=B2(Du.UseRouteError),r=ny(Du.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function U2(){let{router:e}=L2(ty.UseNavigateStable),t=ny(Du.UseNavigateStable),n=M.useRef(!1);return Z0(()=>{n.current=!0}),M.useCallback(function(o,a){a===void 0&&(a={}),n.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,Ui({fromRouteId:t},a)))},[e,t])}const _m={};function $2(e,t,n){!t&&!_m[e]&&(_m[e]=!0)}function V2(e,t){e==null||e.v7_startTransition,(e==null?void 0:e.v7_relativeSplatPath)===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function H2(e){let{to:t,replace:n,state:r,relative:o}=e;Va()||at(!1);let{future:a,static:i}=M.useContext(co),{matches:s}=M.useContext(fo),{pathname:u}=ho(),l=Ha(),c=th(t,eh(s,a.v7_relativeSplatPath),u,o==="path"),d=JSON.stringify(c);return M.useEffect(()=>l(JSON.parse(d),{replace:n,state:r,relative:o}),[l,d,o,n,r]),null}function Pr(e){at(!1)}function G2(e){let{basename:t="/",children:n=null,location:r,navigationType:o=zr.Pop,navigator:a,static:i=!1,future:s}=e;Va()&&at(!1);let u=t.replace(/^\/*/,"/"),l=M.useMemo(()=>({basename:u,navigator:a,static:i,future:Ui({v7_relativeSplatPath:!1},s)}),[u,s,a,i]);typeof r=="string"&&(r=$a(r));let{pathname:c="/",search:d="",hash:f="",state:h=null,key:v="default"}=r,y=M.useMemo(()=>{let x=Zf(c,u);return x==null?null:{location:{pathname:x,search:d,hash:f,state:h,key:v},navigationType:o}},[u,c,d,f,h,v,o]);return y==null?null:M.createElement(co.Provider,{value:l},M.createElement(xl.Provider,{children:n,value:y}))}function q2(e){let{children:t,location:n}=e;return T2(Dd(t),n)}new Promise(()=>{});function Dd(e,t){t===void 0&&(t=[]);let n=[];return M.Children.forEach(e,(r,o)=>{if(!M.isValidElement(r))return;let a=[...t,o];if(r.type===M.Fragment){n.push.apply(n,Dd(r.props.children,a));return}r.type!==Pr&&at(!1),!r.props.index||!r.props.children||at(!1);let i={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=Dd(r.props.children,a)),n.push(i)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Td(){return Td=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Td.apply(this,arguments)}function K2(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,a;for(a=0;a<r.length;a++)o=r[a],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function X2(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Y2(e,t){return e.button===0&&(!t||t==="_self")&&!X2(e)}const Q2=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],J2="6";try{window.__reactRouterVersion=J2}catch{}const Z2="startTransition",km=H1[Z2];function eC(e){let{basename:t,children:n,future:r,window:o}=e,a=M.useRef();a.current==null&&(a.current=r2({window:o,v5Compat:!0}));let i=a.current,[s,u]=M.useState({action:i.action,location:i.location}),{v7_startTransition:l}=r||{},c=M.useCallback(d=>{l&&km?km(()=>u(d)):u(d)},[u,l]);return M.useLayoutEffect(()=>i.listen(c),[i,c]),M.useEffect(()=>V2(r),[r]),M.createElement(G2,{basename:t,children:n,location:s.location,navigationType:s.action,navigator:i,future:r})}const tC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",nC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,uc=M.forwardRef(function(t,n){let{onClick:r,relative:o,reloadDocument:a,replace:i,state:s,target:u,to:l,preventScrollReset:c,viewTransition:d}=t,f=K2(t,Q2),{basename:h}=M.useContext(co),v,y=!1;if(typeof l=="string"&&nC.test(l)&&(v=l,tC))try{let b=new URL(window.location.href),w=l.startsWith("//")?new URL(b.protocol+l):new URL(l),C=Zf(w.pathname,h);w.origin===b.origin&&C!=null?l=C+w.search+w.hash:y=!0}catch{}let x=I2(l,{relative:o}),m=rC(l,{replace:i,state:s,target:u,preventScrollReset:c,relative:o,viewTransition:d});function g(b){r&&r(b),b.defaultPrevented||m(b)}return M.createElement("a",Td({},f,{href:v||x,onClick:y||a?r:g,ref:n,target:u}))});var Em;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Em||(Em={}));var Nm;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Nm||(Nm={}));function rC(e,t){let{target:n,replace:r,state:o,preventScrollReset:a,relative:i,viewTransition:s}=t===void 0?{}:t,u=Ha(),l=ho(),c=ey(e,{relative:i});return M.useCallback(d=>{if(Y2(d,n)){d.preventDefault();let f=r!==void 0?r:Iu(l)===Iu(c);u(e,{replace:f,state:o,preventScrollReset:a,relative:i,viewTransition:s})}},[l,u,c,r,o,n,e,a,i,s])}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oC=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),aC=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),Sm=e=>{const t=aC(e);return t.charAt(0).toUpperCase()+t.slice(1)},ry=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),iC=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uC=M.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:o="",children:a,iconNode:i,...s},u)=>M.createElement("svg",{ref:u,...sC,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:ry("lucide",o),...!a&&!iC(s)&&{"aria-hidden":"true"},...s},[...i.map(([l,c])=>M.createElement(l,c)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=(e,t)=>{const n=M.forwardRef(({className:r,...o},a)=>M.createElement(uC,{ref:a,iconNode:t,className:ry(`lucide-${oC(Sm(e))}`,`lucide-${e}`,r),...o}));return n.displayName=Sm(e),n};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lC=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Rm=De("archive",lC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cC=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],$i=De("calendar",cC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dC=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],pa=De("camera",dC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fC=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Im=De("chart-column",fC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hC=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],pC=De("chevron-left",hC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mC=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],vC=De("chevron-right",mC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],oo=De("circle-alert",gC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yC=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Lr=De("circle-check-big",yC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xC=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],rh=De("circle-x",xC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bC=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Fn=De("clock",bC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wC=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],CC=De("coffee",wC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _C=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Dm=De("copy",_C);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kC=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],oy=De("download",kC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EC=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],NC=De("eye",EC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SC=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],RC=De("file-text",SC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IC=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ay=De("funnel",IC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DC=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],TC=De("layout-dashboard",DC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AC=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ad=De("log-out",AC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PC=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Pd=De("lock",PC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FC=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],oh=De("mail",FC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jC=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],MC=De("menu",jC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OC=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Fd=De("phone",OC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LC=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],iy=De("plus",LC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Tm=De("search",BC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WC=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],zC=De("settings",WC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UC=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],$C=De("square-pen",UC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VC=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Tu=De("trash-2",VC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HC=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Am=De("trending-up",HC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GC=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Au=De("users",GC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qC=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],sy=De("user",qC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KC=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],XC=De("wifi-off",KC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YC=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],QC=De("wifi",YC);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JC=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Vi=De("x",JC),ZC="http://localhost:8000/api";class e_{constructor(){this.baseURL=ZC}async request(t,n={}){const r=`${this.baseURL}${t}`,o=localStorage.getItem("authToken"),a={headers:{"Content-Type":"application/json",Accept:"application/json",...o&&{Authorization:`Bearer ${o}`},...n.headers},...n};try{const i=await fetch(r,a);if(!i.ok){let s;const u=i.headers.get("content-type");if(u&&u.includes("application/json")){if(s=await i.json(),i.status===422&&s.errors)throw{message:Object.values(s.errors).flat().join(" ")}}else s={message:await i.text()};throw s}return n.responseType==="blob"?i.blob():i.json()}catch(i){throw console.error("API request failed:",i),i}}async get(t,n={}){return this.request(t,{method:"GET",...n})}async post(t,n,r={}){return this.request(t,{method:"POST",body:JSON.stringify(n),...r})}async put(t,n,r={}){return this.request(t,{method:"PUT",body:JSON.stringify(n),...r})}async delete(t,n={}){return this.request(t,{method:"DELETE",...n})}async login(t){const n=await this.post("/login",t);return localStorage.setItem("authToken",n.token),n}async logout(){try{await this.request("/logout",{method:"POST"})}finally{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("isAuthenticated")}}async getCurrentUser(){return this.request("/user")}async getEmployees(){return this.request("/employees")}async createEmployee(t){return this.request("/employees",{method:"POST",body:JSON.stringify(t)})}async updateEmployee(t,n){return this.request(`/employees/${t}`,{method:"PUT",body:JSON.stringify(n)})}async deleteEmployee(t){return this.request(`/employees/${t}`,{method:"DELETE"})}async getPolicies(){return this.request("/policies")}async createPolicy(t){return this.request("/policies",{method:"POST",body:JSON.stringify(t)})}async updatePolicy(t,n){return this.request(`/policies/${t}`,{method:"PUT",body:JSON.stringify(n)})}async deletePolicy(t){return this.request(`/policies/${t}`,{method:"DELETE"})}async togglePolicyStatus(t){return this.request(`/policies/${t}/toggle-status`,{method:"PATCH"})}async getAttendances(t={}){const n=new URLSearchParams(t).toString(),r=n?`/attendances?${n}`:"/attendances";return this.request(r)}async createAttendance(t){return this.request("/attendances",{method:"POST",body:JSON.stringify(t)})}async updateAttendance(t,n){return this.request(`/attendances/${t}`,{method:"PUT",body:JSON.stringify(n)})}async deleteAttendance(t){return this.request(`/attendances/${t}`,{method:"DELETE"})}async markAttendance(t){return this.request("/attendances/mark",{method:"POST",body:JSON.stringify({employee_id:t})})}async enrollFace(t,n,r={}){return this.request("/faces/enroll",{method:"POST",body:JSON.stringify({employee_id:t,descriptors:n,metadata:r})})}async recognizeFace(t,n=.6){return this.request("/faces/recognize",{method:"POST",body:JSON.stringify({descriptor:t,threshold:n})})}async unenrollFace(t){return this.request("/faces/unenroll",{method:"POST",body:JSON.stringify({employee_id:t})})}async getDashboardData(){return this.request("/attendance/dashboard")}async getAttendanceStats(){return this.request("/attendance/stats")}async getDepartmentStats(){return this.request("/attendance/departments")}async getAttendanceTrends(){return this.request("/attendance/trends")}async getLiveActivity(){return this.request("/attendance/live")}async getPresentToday(){return this.request("/attendance/present-today")}async getAbsentToday(){return this.request("/attendance/absent-today")}async getOnLeaveToday(){return this.request("/attendance/on-leave-today")}async getLateArrivalsToday(){return this.request("/attendance/late-arrivals-today")}async getEarlyDeparturesToday(){return this.request("/attendance/early-departures-today")}async getEmployeeMonthlyAttendance(t,n,r){return this.request(`/attendance/employee/${t}/${n}/${r}`)}async exportEmployeeMonthlyAttendance(t,n,r){return this.request(`/attendance/export/employee/${t}/${n}/${r}`,{responseType:"blob"})}async exportEmployeeDailyAttendance(t,n){return this.request(`/attendance/export/daily/employee/${t}/${n}`,{responseType:"blob"})}async exportEmployeeCustomRangeAttendance(t,n,r){return this.request(`/attendance/export/custom/employee/${t}/${n}/${r}`,{responseType:"blob"})}async emailEmployeeAttendanceReport(t,n,r,o,a,i,s){return this.request("/attendance/email",{method:"POST",body:JSON.stringify({employee_id:t,email:n,report_type:r,year:o,month:a,start_date:i,end_date:s})})}}const Ae=new e_,uy=()=>{const[e,t]=M.useState(!1),[n,r]=M.useState(new Date),[o,a]=M.useState(navigator.onLine),i=ho();M.useEffect(()=>{const h=setInterval(()=>r(new Date),1e3);return()=>clearInterval(h)},[]),M.useEffect(()=>{const h=()=>a(!0),v=()=>a(!1);return window.addEventListener("online",h),window.addEventListener("offline",v),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",v)}},[]);const s=[{name:"Dashboard",href:"/dashboard",icon:TC},{name:"Policies",href:"/policies",icon:RC},{name:"Employees",href:"/employees",icon:Au},{name:"Attendance",href:"/reports",icon:$i}],u=[{name:"Dashboard",href:"/dashboard",icon:Im},{name:"Policies",href:"/policies",icon:zC},{name:"Employees",href:"/employees",icon:Au},{name:"Reports",href:"/reports",icon:Im}],l=h=>i.pathname===h||i.pathname.startsWith(`${h}/`),c=h=>h.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),d=h=>h.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),f=i.pathname==="/";return p.jsxs("header",{className:`${f?"bg-white/10 backdrop-blur-sm border-b border-white/20 px-4 md:px-8 py-4 md:py-6":"bg-white border-b border-gray-200 px-4 py-3 shadow-sm sticky top-0 z-50"}`,children:[p.jsx("div",{className:"max-w-7xl mx-auto",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("div",{className:"flex items-center gap-4",children:f?p.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[p.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-white rounded-xl flex items-center justify-center",children:p.jsx(pa,{className:" md:w-6 md:h-6 lg:w-6 lg:h-6 text-slate-900"})}),p.jsxs("div",{children:[p.jsx("h1",{className:"text-lg md:text-2xl font-bold text-white",children:"Attendance system"}),p.jsx("p",{className:"text-xs md:text-sm text-slate-300",children:"Attendance system"})]})]}):p.jsxs(p.Fragment,{children:[p.jsx("h1",{className:"text-base md:text-lg font-semibold text-gray-900",children:"Admin Panel"}),p.jsx("span",{className:"hidden md:inline-block text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:"Logged in as Admin"})]})}),f?p.jsxs("div",{className:"flex items-center gap-3 md:gap-6",children:[p.jsxs("div",{className:"text-right",children:[p.jsx("div",{className:"text-xl md:text-3xl font-bold text-white",children:c(n)}),p.jsx("div",{className:"text-xs md:text-sm text-slate-300",children:d(n)})]}),p.jsxs(uc,{to:"/login",className:"bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2",children:[p.jsx(Pd,{className:"w-4 h-4"}),p.jsx("span",{className:"hidden md:inline",children:"Admin"})]}),p.jsx("div",{className:"flex items-center gap-2",children:o?p.jsx(QC,{className:"w-5 h-5 text-green-400"}):p.jsx(XC,{className:"w-5 h-5 text-red-400"})})]}):p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("div",{className:"hidden lg:flex items-center gap-2",children:[s.map(h=>{const v=h.icon,y=l(h.href);return p.jsxs(uc,{to:h.href,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${y?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[p.jsx(v,{className:"w-4 h-4"}),p.jsx("span",{children:h.name})]},h.name)}),p.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),p.jsxs("button",{onClick:async()=>{try{await Ae.logout()}catch(h){console.error("Logout failed:",h)}finally{window.location.href="/login"}},className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[p.jsx(Ad,{className:"w-4 h-4"}),p.jsx("span",{children:"Logout"})]})]}),p.jsx("button",{className:"lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors ml-auto",onClick:()=>t(!e),children:e?p.jsx(Vi,{className:"w-6 h-6 "}):p.jsx(MC,{className:"w-6 h-6"})})]})]})}),e&&!f&&p.jsxs("div",{className:"lg:hidden mt-4 space-y-2",children:[p.jsx("hr",{className:"border-gray-200"}),p.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:u.map(h=>{const v=h.icon,y=l(h.href);return p.jsxs(uc,{to:h.href,onClick:()=>t(!1),className:`flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium transition-colors
                    ${y?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[p.jsx(v,{className:"w-4 h-4"}),p.jsx("span",{children:h.name})]},h.name)})}),p.jsxs("button",{onClick:async()=>{try{await Ae.logout()}catch(h){console.error("Logout failed:",h)}finally{window.location.href="/login"}},className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[p.jsx(Ad,{className:"w-4 h-4"}),p.jsx("span",{children:"Logout"})]})]})]})},ly=()=>p.jsx("footer",{className:"bg-white/5 backdrop-blur-sm border-t border-white/20 px-4 md:px-8 py-3 md:py-4",children:p.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 text-xs md:text-sm text-slate-400",children:[p.jsx("p",{children:"Powered by FaceRecognition AI v2.0"}),p.jsx("p",{className:"text-center md:text-right",children:"For support, contact IT Help Desk"})]})}),Ds=({children:e})=>{const t=localStorage.getItem("authToken"),n=ho();if(!t)return p.jsx(H2,{to:"/login",replace:!0});const r=n.pathname==="/";return p.jsxs("div",{className:"min-h-screen flex flex-col",children:[p.jsx(uy,{}),p.jsx("main",{children:e}),r&&p.jsx(ly,{})]})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cy=function(e,t){return(cy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])})(e,t)};function Wn(e,t){function n(){this.constructor=e}cy(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function re(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(l){try{u(r.next(l))}catch(c){a(c)}}function s(l){try{u(r.throw(l))}catch(c){a(c)}}function u(l){l.done?o(l.value):new n(function(c){c(l.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}function oe(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){i=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(c[0]===6&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(d){c=[6,d],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var t_=function(){function e(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(t,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=t,this.platform=n},e.prototype.registerFlag=function(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){var o=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+o+"."),this.set(t,o)}},e.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},e.prototype.getNumber=function(t){return this.get(t)},e.prototype.getBool=function(t){return this.get(t)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(t,n){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)},e.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},e.prototype.setFlags=function(t){this.flags=Object.assign({},t)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,o=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];return n_(r,i[0],i[1]),i.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(a){var i=a.split(":"),s=i[0],u=i[1];t.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},e}();function n_(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function H(){return dy}var dy=null,Pu=new Map,jd=new Map;function fy(e,t){var n=py(e,t);return Pu.get(n)}function r_(e){return jd.get(e)}function Pm(e){for(var t=Pu.entries(),n=[];;){var r=t.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===e&&n.push(s)}return n}function hy(e){var t=e.kernelName,n=e.backendName,r=py(t,n);if(Pu.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");Pu.set(r,e)}function o_(e){var t=e.kernelName;jd.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),jd.set(t,e)}function py(e,t){return t+"_"+e}function Md(e,t,n){return Math.max(e,Math.min(t,n))}function my(e){return e%2==0?e:e+1}function a_(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function I(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function je(e,t,n){n===void 0&&(n=""),I(Ct(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function Ga(e){I(e!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ma(e,t,n){if(t===void 0&&(t=[]),n===void 0&&(n=!1),t==null&&(t=[]),Array.isArray(e)||tr(e)&&!n)for(var r=0;r<e.length;++r)Ma(e[r],t,n);else t.push(e);return t}function se(e){if(e.length===0)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Ct(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function et(e){return e%1==0}function i_(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Od(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function wa(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Fm(e,t,n){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var a=0,i=function(){if(e())r();else{a++;var s=t(a);n!=null&&a>=n?o():setTimeout(i,s)}};i()})}function s_(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(e[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(r===-1){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(n===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function yt(e,t){var n=t.length;return I((e=e==null?t.map(function(r,o){return o}):[].concat(e)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),I(e.every(function(r){return et(r)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(r){return r<0?n+r:r})}function _o(e,t){for(var n=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,a=t==null||o?null:yt(t,e).sort(),i=0,s=0;s<e.length;++s){if(a!=null){if(a[i]===s&&e[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(a[i]==null||a[i]>s)&&e[s]===1&&(n.push(e[s]),r.push(s)),a[i]<=s&&i++}e[s]!==1&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Hi(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Fu(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else{if(e!=="string")throw new Error("Unknown data type "+e);n=new Array(t)}return n}function u_(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function l_(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function c_(e,t){return t!=="complex64"&&(t!=="float32"||e==="complex64")&&(t!=="int32"||e==="float32"||e==="complex64")&&(t!=="bool"||e!=="bool")}function tr(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function vy(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function d_(e){if(e==null)return 0;var t=0;return e.forEach(function(n){return t+=n.length}),t}function ah(e){return typeof e=="string"||e instanceof String}function f_(e){return typeof e=="boolean"}function h_(e){return typeof e=="number"}function rs(e){return Array.isArray(e)?rs(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":h_(e)?"float32":ah(e)?"string":f_(e)?"bool":"float32"}function Ld(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Bd(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function nr(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function gy(e,t,n){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Ma(e)),n&&u_(e,t),function(a,i){return a instanceof Float32Array&&i==="float32"||a instanceof Int32Array&&i==="int32"||a instanceof Uint8Array&&i==="bool"}(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)Math.round(e[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function jm(e,t){if(e.length===0)return t[0];var n=e.reduce(function(r,o){return r*o});if(n===0)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function r(o,a,i){var s=new Array;if(a.length===1)for(var u=a[0],l=0;l<u;l++)s[l]=i[o+l];else{u=a[0];var c=a.slice(1),d=c.reduce(function(f,h){return f*h});for(l=0;l<u;l++)s[l]=r(o+l*d,c,i)}return s}(0,e,t)}function yy(e,t){for(var n=os(e,t),r=0;r<n.length;r++)n[r]=1;return n}function os(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+t)}function Kn(){return H().platform.now()}function xy(e){e.forEach(function(t){I(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function p_(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",H().platform.encode(e,t)}function ju(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",H().platform.decode(e,t)}function Mm(e,t,n){if(t===0)return 0;if(t===1)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function m_(e,t,n){if(t===0)return[];if(t===1)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}var v_=function(){function e(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new g_)}return e.prototype.profileKernel=function(t,n,r){var o,a=this,i=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(l,c,d){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var h=l[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,s.dtype,t),i.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),a.logger.logKernelProfile(t,s,u,l.kernelMs,n,c)})})}),o},e}(),g_=function(){function e(){}return e.prototype.logKernelProfile=function(t,n,r,o,a,i){var s=typeof o=="number"?wa(o+"ms",9):o.error,u=wa(t,25),l=n.rank,c=n.size,d=wa(n.shape.toString(),14),f="";for(var h in a){var v=a[h].shape||n.shape,y=v.length;f+=h+": "+y+"D "+(y>0?v:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+d+"	%c"+c+"	%c"+f+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),Om=20,oi=3,lc=7;function y_(e,t,n,r){var o=nr(t),a=function(l,c,d,f){var h=se(c),v=f[f.length-1],y=new Array(v).fill(0),x=c.length,m=d==="complex64"?ii(l):l;if(x>1)for(var g=0;g<h/v;g++)for(var b=g*v,w=0;w<v;w++)y[w]=Math.max(y[w],ai(m[b+w],0,d).length);return y}(e,t,n,o),i=t.length,s=function l(c,d,f,h,v,y){y===void 0&&(y=!0);var x=f==="complex64"?2:1,m=d[0],g=d.length;if(g===0)return f==="complex64"?[ai(ii(c)[0],0,f)]:f==="bool"?[by(c[0])]:[c[0].toString()];if(g===1){if(m>Om){var b=oi*x,w=Array.from(c.slice(0,b)),C=Array.from(c.slice((m-oi)*x,m*x));return f==="complex64"&&(w=ii(w),C=ii(C)),["["+w.map(function(W,U){return ai(W,v[U],f)}).join(", ")+", ..., "+C.map(function(W,U){return ai(W,v[m-oi+U],f)}).join(", ")+"]"]}return["["+(f==="complex64"?ii(c):Array.from(c)).map(function(W,U){return ai(W,v[U],f)}).join(", ")+"]"]}var _=d.slice(1),E=h.slice(1),k=h[0]*x,R=[];if(m>Om){for(var N=0;N<oi;N++){var P=(T=N*k)+k;R.push.apply(R,l(c.slice(T,P),_,f,E,v,!1))}for(R.push("..."),N=m-oi;N<m;N++)P=(T=N*k)+k,R.push.apply(R,l(c.slice(T,P),_,f,E,v,N===m-1))}else for(N=0;N<m;N++){var T;P=(T=N*k)+k,R.push.apply(R,l(c.slice(T,P),_,f,E,v,N===m-1))}var D=g===2?",":"";for(R[0]="["+R[0]+D,N=1;N<R.length-1;N++)R[N]=" "+R[N]+D;var B=`,
`;for(N=2;N<g;N++)B+=`
`;return R[R.length-1]=" "+R[R.length-1]+"]"+(y?"":B),R}(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function ai(e,t,n){return wa(Array.isArray(e)?parseFloat(e[0].toFixed(lc))+" + "+parseFloat(e[1].toFixed(lc))+"j":ah(e)?"'"+e+"'":n==="bool"?by(e):parseFloat(e.toFixed(lc)).toString(),t)}function by(e){return e===0?"false":"true"}function ii(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Gi=function(){function e(t,n,r){var o=this;if(this.dtype=n,this.shape=t.slice(),this.size=se(t),r!=null){var a=r.length;I(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+o.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Fu(n,this.size),this.strides=nr(t)}return e.prototype.set=function(t){for(var n=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),I(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var a=this.locToIndex(r);this.values[a]=t},e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length===0&&(t=[0]);for(var r=0,o=0,a=t;o<a.length;o++){var i=a[o];if(i<0||i>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]},e.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n},e.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Yn().makeTensor(this.values,this.shape,this.dtype)},e}(),Yn=null,V=null,wy=null,qe=function(){function e(t,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=se(t),this.strides=nr(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),I(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(t,n){return this.throwIfDisposed(),this.reshape([t,n])},e.prototype.as3D=function(t,n,r){return this.throwIfDisposed(),this.reshape([t,n,r])},e.prototype.as4D=function(t,n,r,o){return this.throwIfDisposed(),this.reshape([t,n,r,o])},e.prototype.as5D=function(t,n,r,o,a){return this.throwIfDisposed(),this.reshape([t,n,r,o,a])},e.prototype.asType=function(t){return this.throwIfDisposed(),V.cast(this,t)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return re(this,void 0,void 0,function(){var t;return oe(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,V.buffer(this.shape,this.dtype,t)]}})})},e.prototype.bufferSync=function(){return V.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return re(this,void 0,void 0,function(){var t;return oe(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,jm(this.shape,t)]}})})},e.prototype.arraySync=function(){return jm(this.shape,this.dataSync())},e.prototype.data=function(){return re(this,void 0,void 0,function(){var t,n;return oe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=Yn().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:n=r.sent();try{return[2,n.map(function(o){return ju(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var t=Yn().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(n){return ju(n)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},e.prototype.bytes=function(){return re(this,void 0,void 0,function(){var t;return oe(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,Yn().read(this.dataId)];case 1:return t=n.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(Yn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(t){return t===void 0&&(t=!1),V.print(this,t)},e.prototype.reshape=function(t){return this.throwIfDisposed(),V.reshape(this,t)},e.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},e.prototype.expandDims=function(t){return t===void 0&&(t=0),V.expandDims(this,t)},e.prototype.cumsum=function(t,n,r){return t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1),V.cumsum(this,t,n,r)},e.prototype.squeeze=function(t){return this.throwIfDisposed(),V.squeeze(this,t)},e.prototype.clone=function(){return this.throwIfDisposed(),V.clone(this)},e.prototype.oneHot=function(t,n,r){return this.throwIfDisposed(),V.oneHot(this,t,n,r)},e.prototype.toString=function(t){return t===void 0&&(t=!1),y_(this.dataSync(),this.shape,this.dtype,t)},e.prototype.tile=function(t){return this.throwIfDisposed(),V.tile(this,t)},e.prototype.gather=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),V.gather(this,t,n)},e.prototype.matMul=function(t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),V.matMul(this,t,n,r)},e.prototype.dot=function(t){return this.throwIfDisposed(),V.dot(this,t)},e.prototype.norm=function(t,n,r){return t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),V.norm(this,t,n,r)},e.prototype.slice=function(t,n){return this.throwIfDisposed(),V.slice(this,t,n)},e.prototype.reverse=function(t){return this.throwIfDisposed(),V.reverse(this,t)},e.prototype.concat=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),V.concat([this].concat(t),n)},e.prototype.split=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),V.split(this,t,n)},e.prototype.stack=function(t,n){return n===void 0&&(n=0),V.stack([this,t],n)},e.prototype.unstack=function(t){return t===void 0&&(t=0),V.unstack(this,t)},e.prototype.pad=function(t,n){return n===void 0&&(n=0),V.pad(this,t,n)},e.prototype.batchNormalization=function(t,n,r,o,a){return r===void 0&&(r=.001),wy("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,n,a,o,r)},e.prototype.batchNorm=function(t,n,r,o,a){return a===void 0&&(a=.001),this.throwIfDisposed(),V.batchNorm(this,t,n,r,o,a)},e.prototype.all=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.all(this,t,n)},e.prototype.any=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.any(this,t,n)},e.prototype.logSumExp=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.logSumExp(this,t,n)},e.prototype.sum=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.sum(this,t,n)},e.prototype.prod=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.prod(this,t,n)},e.prototype.mean=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.mean(this,t,n)},e.prototype.min=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.min(this,t,n)},e.prototype.max=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.max(this,t,n)},e.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),V.argMin(this,t)},e.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),V.argMax(this,t)},e.prototype.cast=function(t){return this.throwIfDisposed(),V.cast(this,t)},e.prototype.add=function(t){return this.throwIfDisposed(),V.add(this,t)},e.prototype.addStrict=function(t){return this.throwIfDisposed(),V.addStrict(this,t)},e.prototype.atan2=function(t){return this.throwIfDisposed(),V.atan2(this,t)},e.prototype.sub=function(t){return this.throwIfDisposed(),V.sub(this,t)},e.prototype.subStrict=function(t){return this.throwIfDisposed(),V.subStrict(this,t)},e.prototype.pow=function(t){return this.throwIfDisposed(),V.pow(this,t)},e.prototype.powStrict=function(t){return this.throwIfDisposed(),V.powStrict(this,t)},e.prototype.mul=function(t){return this.throwIfDisposed(),V.mul(this,t)},e.prototype.mulStrict=function(t){return this.throwIfDisposed(),V.mulStrict(this,t)},e.prototype.div=function(t){return this.throwIfDisposed(),V.div(this,t)},e.prototype.divNoNan=function(t){return this.throwIfDisposed(),V.divNoNan(this,t)},e.prototype.floorDiv=function(t){return this.throwIfDisposed(),V.floorDiv(this,t)},e.prototype.divStrict=function(t){return this.throwIfDisposed(),V.divStrict(this,t)},e.prototype.minimum=function(t){return this.throwIfDisposed(),V.minimum(this,t)},e.prototype.minimumStrict=function(t){return this.throwIfDisposed(),V.minimumStrict(this,t)},e.prototype.maximum=function(t){return this.throwIfDisposed(),V.maximum(this,t)},e.prototype.maximumStrict=function(t){return this.throwIfDisposed(),V.maximumStrict(this,t)},e.prototype.mod=function(t){return this.throwIfDisposed(),V.mod(this,t)},e.prototype.modStrict=function(t){return this.throwIfDisposed(),V.modStrict(this,t)},e.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),V.squaredDifferenceStrict(this,t)},e.prototype.transpose=function(t){return this.throwIfDisposed(),V.transpose(this,t)},e.prototype.notEqual=function(t){return this.throwIfDisposed(),V.notEqual(this,t)},e.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),V.notEqualStrict(this,t)},e.prototype.less=function(t){return this.throwIfDisposed(),V.less(this,t)},e.prototype.lessStrict=function(t){return this.throwIfDisposed(),V.lessStrict(this,t)},e.prototype.equal=function(t){return this.throwIfDisposed(),V.equal(this,t)},e.prototype.equalStrict=function(t){return this.throwIfDisposed(),V.equalStrict(this,t)},e.prototype.lessEqual=function(t){return this.throwIfDisposed(),V.lessEqual(this,t)},e.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),V.lessEqualStrict(this,t)},e.prototype.greater=function(t){return this.throwIfDisposed(),V.greater(this,t)},e.prototype.greaterStrict=function(t){return this.throwIfDisposed(),V.greaterStrict(this,t)},e.prototype.greaterEqual=function(t){return this.throwIfDisposed(),V.greaterEqual(this,t)},e.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),V.greaterEqualStrict(this,t)},e.prototype.logicalAnd=function(t){return this.throwIfDisposed(),V.logicalAnd(this,t)},e.prototype.logicalOr=function(t){return this.throwIfDisposed(),V.logicalOr(this,t)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),V.logicalNot(this)},e.prototype.logicalXor=function(t){return this.throwIfDisposed(),V.logicalXor(this,t)},e.prototype.where=function(t,n){return this.throwIfDisposed(),V.where(t,this,n)},e.prototype.neg=function(){return this.throwIfDisposed(),V.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),V.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),V.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),V.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),V.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),V.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),V.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),V.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),V.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),V.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),V.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),V.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),V.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),V.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),V.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),V.abs(this)},e.prototype.clipByValue=function(t,n){return this.throwIfDisposed(),V.clipByValue(this,t,n)},e.prototype.relu=function(){return this.throwIfDisposed(),V.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),V.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),V.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),V.selu(this)},e.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),V.leakyRelu(this,t)},e.prototype.prelu=function(t){return this.throwIfDisposed(),V.prelu(this,t)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),V.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),V.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),V.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),V.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),V.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),V.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),V.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),V.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),V.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),V.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),V.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),V.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),V.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),V.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),V.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),V.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),V.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),V.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),V.round(this)},e.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),V.step(this,t)},e.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),V.softmax(this,t)},e.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),V.logSoftmax(this,t)},e.prototype.resizeBilinear=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),V.image.resizeBilinear(this,t,n)},e.prototype.resizeNearestNeighbor=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),V.image.resizeNearestNeighbor(this,t,n)},e.prototype.conv1d=function(t,n,r,o,a,i){return o===void 0&&(o="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),V.conv1d(this,t,n,r,o,a,i)},e.prototype.conv2d=function(t,n,r,o,a,i){return o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),V.conv2d(this,t,n,r,o,a,i)},e.prototype.conv2dTranspose=function(t,n,r,o,a){return this.throwIfDisposed(),V.conv2dTranspose(this,t,n,r,o,a)},e.prototype.depthwiseConv2D=function(t,n,r,o,a,i){return o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),V.depthwiseConv2d(this,t,n,r,o,a,i)},e.prototype.separableConv2d=function(t,n,r,o,a,i){return a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC"),this.throwIfDisposed(),V.separableConv2d(this,t,n,r,o,a,i)},e.prototype.avgPool=function(t,n,r,o){return this.throwIfDisposed(),V.avgPool(this,t,n,r,o)},e.prototype.maxPool=function(t,n,r,o){return this.throwIfDisposed(),V.maxPool(this,t,n,r,o)},e.prototype.localResponseNormalization=function(t,n,r,o){return t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5),V.localResponseNormalization(this,t,n,r,o)},e.prototype.pool=function(t,n,r,o,a){return this.throwIfDisposed(),V.pool(this,t,n,r,o,a)},e.prototype.variable=function(t,n,r){return t===void 0&&(t=!0),this.throwIfDisposed(),Yn().makeVariable(this,t,n,r)},e.prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),V.unsortedSegmentSum(this,t,n)},e.prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),V.batchToSpaceND(this,t,n)},e.prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),V.spaceToBatchND(this,t,n)},e.prototype.topk=function(t,n){return t===void 0&&(t=1),n===void 0&&(n=!0),this.throwIfDisposed(),V.topk(this,t,n)},e.prototype.stridedSlice=function(t,n,r,o,a,i,s,u){return o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),V.stridedSlice(this,t,n,r,o,a,i,s,u)},e.prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),V.depthToSpace(this,t,n)},e.prototype.fft=function(){return this.throwIfDisposed(),V.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),V.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),V.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),V.spectral.irfft(this)},e}();Object.defineProperty(qe,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var Lm,Wd,zd,Ud,$d,Oa=function(e){function t(n,r,o,a){var i=e.call(this,n.shape,n.dtype,n.dataId,a)||this;return i.trainable=r,i.name=o,i}return Wn(t,e),t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!Ct(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");Yn().disposeTensor(this),this.dataId=n.dataId,Yn().incRef(this,null)},t.prototype.dispose=function(){Yn().disposeVariable(this),this.isDisposedInternal=!0},t}(qe);Object.defineProperty(Oa,Symbol.hasInstance,{value:function(e){return e instanceof qe&&e.assign!=null&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Lm||(Lm={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Wd||(Wd={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(zd||(zd={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Ud||(Ud={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}($d||($d={}));var x_={float32:Ud,int32:Wd,bool:zd,complex64:$d};function St(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error("Can not upcast "+e+" with "+t)}return x_[e][t]}function cc(e){return St(e,"int32")}function Qe(e,t){if(e.dtype===t.dtype)return[e,t];var n=St(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function b_(e,t){I(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function Cy(e){var t=[];return function n(r,o,a){if(r!=null){if(r instanceof qe)return void o.push(r);if(i=r,!(!Array.isArray(i)&&typeof i!="object")){var i,s=r;for(var u in s){var l=s[u];a.has(l)||(a.add(l),n(l,o,a))}}}}(e,t,new Set),t}var dc,Bm=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},e}(),w_=function(){function e(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Bm}return e.prototype.ready=function(){return re(this,void 0,void 0,function(){var t,n,r;return oe(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),n=0,o.label=1;case 1:return n<t.length?(r=t[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),n=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},e.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},e.prototype.registerBackend=function(t,n,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:n,priority:r},!0)},e.prototype.setBackend=function(t){return re(this,void 0,void 0,function(){var n,r,o;return oe(this,function(a){switch(a.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return o=a.sent(),[3,3];case 2:o=r,a.label=3;case 3:if(!o)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new v_(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var t=this;Pm(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(t.backendInstance)})},e.prototype.disposeRegisteredKernels=function(t){var n=this;Pm(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[t])})},e.prototype.initializeBackend=function(t){var n=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var a=++this.pendingBackendInitId,i=o.then(function(s){return!(a<n.pendingBackendInitId)&&(n.registry[t]=s,n.pendingBackendInit=null,!0)}).catch(function(s){return!(a<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return t.registryFactory[r].priority-t.registryFactory[n].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),n=0;n<t.length;n++){var r=t[n],o=this.initializeBackend(r),a=o.success,i=o.asyncInit;if(i||a)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(t,n){var r=this.state.tensorInfo.get(n),o=r.backend,a=this.readSync(n);o.disposeData(n),r.backend=t,t.move(n,a,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(t,n){var r,o=this,a=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=t}return this.scopedRun(function(){return o.startScope(a)},function(){return o.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},e.prototype.scopedRun=function(t,n,r){t();try{var o=r();return n(),o}catch(a){throw n(),a}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(t){var n=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[n],function(o){return{x:function(){return o.toFloat()}}},[]),n},e.prototype.runKernel=function(t,n,r,o,a){return this.runKernelFunc(null,n,null,t,r,o,a)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(t,n,r){var o=this.backend.numDataIds(),a=0;r.forEach(function(u){a+=u.dtype==="complex64"?3:1});var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-n-a-i;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+t+"'")},e.prototype.runKernelFunc=function(t,n,r,o,a,i,s){var u,l=this;i===void 0&&(i=[]),s===void 0&&(s=[]);var c=[],d=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var f,h=function(g){d&&(c=g.map(function(b){return l.keep(l.clone(b))}))},v=this.state.numBytes,y=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var x,m=fy(o,this.backendName);return f=m!=null?function(){var g=l.backend.numDataIds();x=m.kernelFunc({inputs:n,attrs:a,backend:l.backend});var b=Array.isArray(x)?x:[x];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,g,b);var w=b.map(function(_){var E=_.dataId,k=_.shape,R=_.dtype;return l.makeTensorFromDataId(E,k,R)}),C=w.filter(function(_,E){return s[E]});return h((i||[]).slice().concat(C)),w}:function(){var g=l.backend.numDataIds();x=l.tidy(function(){return t(l.backend,h)});var b=Array.isArray(x)?x:[x];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,g,b),b},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(o,n,function(){return f()}):f()}),d&&this.addTapeNode(o,n,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-v,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-y,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(g){return n[g].shape}),outputShapes:u.map(function(g){return g.shape})}),Array.isArray(x)?u:u[0]},e.prototype.makeTensor=function(t,n,r,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var a=t;r==="string"&&ah(t[0])&&(a=t.map(function(c){return p_(c)}));var i=o.write(a,n,r),s=new qe(n,r,i,this.nextTensorId());if(this.incRef(s,o),r==="string"){var u=this.state.tensorInfo.get(i),l=d_(a);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},e.prototype.makeTensorFromDataId=function(t,n,r,o){var a=new qe(n,r=r||"float32",t,this.nextTensorId());return this.incRef(a,o),a},e.prototype.makeVariable=function(t,n,r,o){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.asType(o));var a=new Oa(t,n,r,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},e.prototype.incRef=function(t,n){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*vy(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Oa||this.track(t)},e.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(t.dataId);n.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var n=this.state.registeredVariables[t];this.disposeVariable(n)}},e.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},e.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},e.prototype.profile=function(t){return re(this,void 0,void 0,function(){var n,r;return oe(this,function(o){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(t,n,r,o,a){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:a},u=r_(t);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=function(l){return l=l.map(function(c,d){if(c==null){var f=r[d],h=os(f.size,f.dtype);return i.makeTensor(h,f.shape,f.dtype)}return c}),o(l.length>1?l:l[0],a)}),this.state.activeTape.push(s)},e.prototype.keep=function(t){return t.kept=!0,t},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(t){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n},e.prototype.endScope=function(t){for(var n=this,r=Cy(t),o=new Set(r.map(function(u){return u.id})),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||o.has(i.id)||i.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||n.track(u)})},e.prototype.gradients=function(t,n,r,o){var a=this;if(o===void 0&&(o=!1),I(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var i=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",t)});I(i instanceof qe,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var d={},f={},h=0;h<l.length;h++)d[l[h].id]=!0;for(h=0;h<u.length;h++){var v=(_=u[h]).inputs;for(var y in v){for(var x=v[y],m=!1,g=0;g<l.length;g++)if(d[x.id]){_.outputs.forEach(function(N){return d[N.id]=!0}),m=!0,f[_.id]=!0;break}if(m)break}}var b={};b[c.id]=!0;var w={};for(h=u.length-1;h>=0;h--)for(v=(_=u[h]).inputs,g=0;g<_.outputs.length;g++)if(b[_.outputs[g].id]){for(var y in v)b[v[y].id]=!0,w[_.id]=!0;break}var C=[];for(h=0;h<u.length;h++){var _;if(f[(_=u[h]).id]&&w[_.id]){var E={};for(var y in _.inputs){var k=_.inputs[y];d[k.id]&&(E[y]=k)}var R=Object.assign({},_);R.inputs=E,R.outputs=_.outputs,C.push(R)}}return C}(this.state.activeTape,n,i);if(!o&&s.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[i.id]=r??(u=i.shape,l=yy(se(u),"float32"),j.makeTensor(l,u,"float32")),function(f,h,v){for(var y=function(m){var g=h[m],b=[];if(g.outputs.forEach(function(E){var k=f[E.id];k!=null?b.push(k):b.push(null)}),g.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+g.kernelName+".");var w=g.gradient(b),C=function(E){if(!(E in w))throw new Error("Cannot backprop through input "+E+". Available gradients found: "+Object.keys(w)+".");var k=v(function(){return w[E]()});if(k.dtype!=="float32")throw new Error("Error in gradient for op "+g.kernelName+". The gradient of input "+E+" must have 'float32' dtype, but has '"+k.dtype+"'");var R=g.inputs[E];if(!Ct(k.shape,R.shape))throw new Error("Error in gradient for op "+g.kernelName+". The gradient of input '"+E+"' has shape '"+k.shape+"', which does not match the shape of the input '"+R.shape+"'");if(f[R.id]==null)f[R.id]=k;else{var N=f[R.id];f[R.id]=N.add(k),N.dispose()}};for(var _ in g.inputs)C(_)},x=h.length-1;x>=0;x--)y(x)}(c,s,function(f){return a.tidy(f)});var d=n.map(function(f){return c[f.id]});return a.state.gradientDepth===0&&(a.state.activeTape.forEach(function(f){for(var h=0,v=f.saved;h<v.length;h++)v[h].dispose()}),a.state.activeTape=null),{value:i,grads:d}})},e.prototype.customGrad=function(t){var n=this;return I(Ld(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];I(o.every(function(s){return s instanceof qe}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return o.forEach(function(s,u){i[u]=s}),n.runKernelFunc(function(s,u){return I((r=t.apply(void 0,o.concat([u]))).value instanceof qe,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),I(Ld(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},i,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];I(c.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),I(c.every(function(f){return f instanceof qe}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return c.forEach(function(f,h){d[h]=function(){return f}}),d})}},e.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},e.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},e.prototype.time=function(t){return re(this,void 0,void 0,function(){var n,r;return oe(this,function(o){switch(o.label){case 0:return n=Kn(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=Kn()-n,[2,r]}})})},e.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Bm,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),j=function(){var e=function(){if(dc==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}dc=n}return dc}();if(e._tfengine==null){var t=new t_(e);e._tfengine=new w_(t)}return function(n){dy=n}(e._tfengine.ENV),Yn=function(){return e._tfengine},e._tfengine}();function _y(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var lr=H();lr.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),lr.registerFlag("IS_BROWSER",function(){return _y()}),lr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),lr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),lr.registerFlag("PROD",function(){return!1}),lr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return lr.getBool("DEBUG")}),lr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),lr.registerFlag("IS_TEST",function(){return!1});var qi,ln,sn,wo={},fc={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function C_(e,t){wo[e]=t}function ar(e){e in wo||(wo[e]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete wo[n]},!1),n===1?r.getContext("webgl",fc)||r.getContext("experimental-webgl",fc):r.getContext("webgl2",fc)}(e));var t=wo[e];return t.isContextLost()?(delete wo[e],ar(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),wo[e])}function bl(e,t){return[t,e]}function wi(e){var t=se(e);return Od(Math.ceil(t/4))}function as(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function ih(e,t){var n,r,o,a,i,s,u,l,c,d=e;return H().getNumber("WEBGL_VERSION")===2?(n=d.R32F,r=d.R16F,o=d.RGBA16F,a=d.RGBA32F,i=d.RED,s=4,u=1,l=d.HALF_FLOAT,c=d.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=d.RGBA,i=e.RGBA,s=4,u=4,l=t!=null?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function ue(e,t,n){var r=n();return t&&function(o){var a=o.getError();if(a!==o.NO_ERROR)throw new Error("WebGL Error: "+N_(o,a))}(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(qi||(qi={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(ln||(ln={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(sn||(sn={}));var __=596e-10,k_=65504;function E_(e){return!!(H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||__<Math.abs(e)&&Math.abs(e)<k_)}function N_(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Ts(e,t,n){return Cr(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function S_(e,t,n){var r=Cr(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ue(e,t,function(){return e.shaderSource(r,n)}),ue(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function R_(e,t,n){var r=Cr(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ue(e,t,function(){return e.shaderSource(r,n)}),ue(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw function(o,a){var i=I_.exec(a);if(i==null)return console.log("Couldn't parse line number in error: "+a),void console.log(o);for(var s=+i[1],u=o.split(`
`),l=u.length.toString().length+2,c=u.map(function(x,m){return wa((m+1).toString(),l)+x}),d=0,f=0;f<c.length;f++)d=Math.max(c[f].length,d);var h=c.slice(0,s-1),v=c.slice(s-1,s),y=c.slice(s);console.log(h.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+wa(v[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(y.join(`
`))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var hc,pc,I_=/ERROR: [0-9]+:([0-9]+):/g;function D_(e,t){return Cr(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function T_(e,t,n){if(ue(e,t,function(){return e.linkProgram(n)}),e.getProgramParameter(n,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function mc(e,t,n){if(ue(e,t,function(){return e.validateProgram(n)}),e.getProgramParameter(n,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function A_(e,t,n){var r=Cr(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return ue(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),ue(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function P_(e,t,n){var r=Cr(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return ue(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),ue(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function F_(e,t){return Cr(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function j_(e,t){var n=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function M_(e,t){return Cr(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Wm(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return u!==-1&&(ue(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),ue(e,t,function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)}),ue(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function O_(e,t,n,r){U_(e,r),ue(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),ue(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function L_(e,t,n,r){return Cr(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function B_(e,t,n){return e.getUniformLocation(t,n)}function W_(e,t,n,r,o,a){ue(e,t,function(){return O_(e,t,r,a)}),ue(e,t,function(){return e.uniform1i(o,a)})}function vc(e,t,n,r){ue(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),ue(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function zm(e,t,n){ue(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),ue(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function As(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+z_(e,t))}function z_(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Cr(e,t,n,r){var o=ue(e,t,function(){return n()});if(o==null)throw new Error(r);return o}function U_(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function Mu(e,t){return t===void 0&&(t=2),se(e.slice(0,e.length-t))}function Ou(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function gc(e){var t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[Mu(e)].concat(Ou(e))),t}function $_(e,t){var n;t===void 0&&(t=!1);var r=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(e=e.map(function(l,c){return c>=e.length-2?my(e[c]):e[c]})).length===1&&(e=[2,e[0]])),e.length!==2){var o=_o(e);e=o.newShape}var a=se(e);if(e.length<=1&&a<=r)return[1,a];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=Mu(e),s=2,u=2;return e.length&&(s=(n=Ou(e))[0],u=n[1]),Od(a=i*(s/2)*(u/2)).map(function(l){return 2*l})}return Od(a)}function Ps(e){return e%2==0}function Fs(e,t){if(Ct(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||Ps(n)&&Ps(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&Ps(e[0])&&Ps(t[0])}function V_(e){if(hc==null){var t=ar(e);hc=t.getParameter(t.MAX_TEXTURE_SIZE)}return hc}function H_(e){if(pc==null){var t=ar(e);pc=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,pc)}function G_(e){if(e===0)return 0;var t=ar(e);return _n(t,"EXT_disjoint_timer_query_webgl2")&&e===2?2:_n(t,"EXT_disjoint_timer_query")?1:0}function _n(e,t){return e.getExtension(t)!=null}function Um(e){try{if(ar(e)!=null)return!0}catch{return!1}return!1}function q_(e){if(e===0)return!1;var t=ar(e);if(e===1){if(!_n(t,"OES_texture_float"))return!1}else if(!_n(t,"EXT_color_buffer_float"))return!1;return Vd(t)}function K_(e){if(e===0)return!1;var t=ar(e);if(e!==1){if(_n(t,"EXT_color_buffer_float"))return Vd(t);if(_n(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(r,o){var a=ih(r,o),i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(i),r.deleteFramebuffer(s),u}(t,n)}return!1}return!!_n(t,"OES_texture_float")&&!!_n(t,"WEBGL_color_buffer_float")&&Vd(t)}function Vd(e){var t=ih(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function X_(e){return e===2&&ar(e).fenceSync!=null}var he=H();function ky(e){H().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ee(e,t){return j.tidy(e,t)}function en(e){Cy(e).forEach(function(t){return t.dispose()})}function Y_(e){return j.keep(e)}function Lu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];H().getBool("IS_TEST")||console.warn.apply(console,e)}function po(e,t){var n=e;if(tr(e))return t==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||tr(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&H().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(a,i,s){if(s=s||[],!Array.isArray(a)&&!tr(a))return void I(i.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+i[0]+" elements"});I(i.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),I(a.length===i[0],function(){return"Element arr["+s.join("][")+"] should have "+i[0]+" elements, but has "+a.length+" elements"});for(var u=i.slice(1),l=0;l<a.length;++l)o(a[l],u,s.concat(l))}(e,r,[]),r}function $m(e,t,n,r){if(e!=null&&(e!=="numeric"&&e!==t||e==="numeric"&&t==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function S(e,t,n,r){if(r===void 0&&(r="numeric"),e instanceof qe)return $m(r,e.dtype,t,n),e;var o=rs(e);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),$m(r,o,t,n),e==null||!tr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var a=e==null?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=po(e,o);tr(e)||Array.isArray(e)||(e=[e]);var s=o!=="string"?gy(e,o,H().getBool("DEBUG")):Ma(e,[],!0);return j.makeTensor(s,i,o)}function Bu(e,t,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(o,a){return S(o,t+"["+a+"]",n)},r)}function Ey(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Q_(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)n.indexOf(s)===-1?o.push(e[a++]):o.push(t[i++]);return o}function Ft(e,t){for(var n=[],r=e.length,o=0;o<r;o++)t.indexOf(o)===-1&&n.push(e[o]);return[n,t.map(function(a){return e[a]})]}function tn(e,t){return Q_(e,t.map(function(n){return 1}),t)}function an(e,t,n){I(Ey(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function ir(e,t){if(Ey(e,t))return null;for(var n=[],r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(function(o){return n.push(o)}),n}function sh(e){return e.map(function(t,n){return[n,t]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})}function sr(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function J_(e,t){var n=e[0].length;e.forEach(function(o,a){I(o.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+n+")"})}),I(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(o,a){for(var i=0;i<n;i++)I(i===t||o[i]===r[i],function(){return"Error in concat"+n+"D: Shape of tensors["+a+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."})})}function La(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function A(e){var t=Object.keys(e);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];j.startScope(n);try{var s=r.apply(void 0,a);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),j.endScope(s),s}catch(u){throw j.endScope(null),u}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}he.registerFlag("HAS_WEBGL",function(){return he.getNumber("WEBGL_VERSION")>0}),he.registerFlag("WEBGL_VERSION",function(){return Um(2)?2:Um(1)?1:0}),he.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return he.get("WEBGL_VERSION")===2}),he.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),he.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),he.registerFlag("WEBGL_PACK",function(){return he.getBool("HAS_WEBGL")}),he.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_CLIP",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),he.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_PACK_REDUCE",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_LAZILY_UNPACK",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_CONV_IM2COL",function(){return he.getBool("WEBGL_PACK")}),he.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return V_(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return H_(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=he.getNumber("WEBGL_VERSION");return e===0?0:G_(e)}),he.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return he.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),he.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return q_(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!he.getBool("WEBGL_FORCE_F16_TEXTURES")&&he.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),he.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return K_(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return X_(he.getNumber("WEBGL_VERSION"))}),he.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return he.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),wy=ky;var Nt=A({complex_:function(e,t){var n=S(e,"real","complex"),r=S(t,"imag","complex");return je(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),j.runKernelFunc(function(o){return o.complex(n,r)},{$real:n,$imag:r})}}),wn=A({real_:function(e){var t=S(e,"input","real");return j.runKernelFunc(function(n){return n.real(t)},{$input:t})}}),Qn=A({imag_:function(e){var t=S(e,"input","imag");return j.runKernelFunc(function(n){return n.imag(t)},{$input:t})}});function Rt(e,t,n){return mo(e,t,po(e,n),n)}function mo(e,t,n,r){if(r==null&&(r=rs(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!tr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){xy(t);var o=se(t),a=se(n);I(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<n.length;++i){var s=n[i],u=i!==n.length-1||s!==se(t.slice(i));I(n[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return tr(e)||Array.isArray(e)||(e=[e]),t=t||n,e=r!=="string"?gy(e,r,H().getBool("DEBUG")):Ma(e,[],!0),j.makeTensor(e,t,r)}function J(e,t){if((tr(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&tr(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return mo(e,[],[],t)}function ut(e,t){Ga(e);var n=po(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return mo(e,null,n,t)}function Zr(e,t,n){if(Ga(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=po(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return mo(e,t,r,n)}function uh(e,t,n){if(Ga(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=po(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return mo(e,t,r,n)}function Kt(e,t,n){if(Ga(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=po(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return mo(e,t,r,n)}function Z_(e,t,n){if(Ga(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=po(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return mo(e,t,r,n)}function ek(e,t,n){if(Ga(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=po(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return mo(e,t=t||r,r,n)}function tk(e,t,n,r){return t===void 0&&(t=!0),j.makeVariable(e,t,n,r)}function qa(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=qa(e,"float32"),r=Ue(e,"float32");return Nt(n,r)}var o=yy(se(e),t);return j.makeTensor(o,e,t)}function Ue(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Ue(e,"float32"),r=Ue(e,"float32");return Nt(n,r)}var o=os(se(e),t);return j.makeTensor(o,e,t)}function rr(e,t,n){return j.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function nk(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return j.runKernelFunc(function(r){return r.linspace(e,t,n)},{})}function Wu(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Ue([0],r);var o=os(Math.abs(Math.ceil((t-e)/n)),r);t<e&&n===1&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return ut(o,r)}var Ny=A({onesLike_:function(e){var t=S(e,"x","onesLike");if(t.dtype==="complex64"){var n=Ny(wn(t)),r=Se(Qn(t));return Nt(n,r)}return j.runKernelFunc(function(o){return o.onesLike(t)},{$x:t},function(o,a){return{$x:function(){return Se(o)}}})}}),Se=A({zerosLike_:function(e){var t=S(e,"x","zerosLike");return j.runKernelFunc(function(n){return n.zerosLike(t)},{$x:t},function(n,r){return{$x:function(){return Se(n)}}})}}),pt=A({concat_:function(e,t){t===void 0&&(t=0),I(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=Bu(e,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),t=yt(t,n[0].shape)[0];var r=La(n.map(function(s){return s.shape}),t);if(se(r)===0)return Rt([],r);if((n=n.filter(function(s){return s.size>0})).length===1)return n[0];var o=n.map(function(s){return s.shape});J_(o,t);var a=n,i={axis:t};return j.runKernelFunc(function(s){return s.concat(n,t)},a,function(s){var u=o.map(function(l){return l[t]});return lh(s,u,t).map(function(l){return function(){return l}})},"Concat",i)}}),rk=A({concat1d_:function(e){return pt(e,0)}}),ok=A({concat2d_:function(e,t){return pt(e,t)}}),ak=A({concat3d_:function(e,t){return pt(e,t)}}),ik=A({concat4d_:function(e,t){return pt(e,t)}}),lh=A({split_:function(e,t,n){n===void 0&&(n=0);var r,o=S(e,"x","split");return n=yt(n,o.shape)[0],typeof t=="number"?(I(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(I(o.shape[n]===t.reduce(function(a,i){return a+i}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),j.runKernelFunc(function(a){return a.split(o,r,n)},{$x:o},function(a){return{$x:function(){return pt(a,n)}}})}});function zo(e,t){return e(t={exports:{}},t.exports),t.exports}var sk=zo(function(e){(function(t,n,r){function o(s){var u,l=this,c=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var d=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=0|d)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var l=new o(s),c=u&&u.state,d=l.next;return d.int32=function(){return 4294967296*l.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}n&&n.exports?n.exports=i:r&&r.amd?r(function(){return i}):this.alea=i})(0,e,!1)}),uk=zo(function(e){(function(t,n,r){function o(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function i(s,u){var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}n&&n.exports?n.exports=i:r&&r.amd?r(function(){return i}):this.xor128=i})(0,e,!1)}),lk=zo(function(e){(function(t,n,r){function o(s){var u=this,l="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}n&&n.exports?n.exports=i:r&&r.amd?r(function(){return i}):this.xorwow=i})(0,e,!1)}),ck=zo(function(e){(function(t,n,r){function o(s){var u=this;u.next=function(){var l,c,d=u.x,f=u.i;return l=d[f],c=(l^=l>>>7)^l<<24,c^=(l=d[f+1&7])^l>>>10,c^=(l=d[f+3&7])^l>>>3,c^=(l=d[f+4&7])^l<<7,l=d[f+7&7],c^=(l^=l<<13)^l<<9,d[f]=c,u.i=f+1&7,c},function(l,c){var d,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,d=0;d<c.length;++d)f[7&d]=f[7&d]<<15^c.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],l.x=f,l.i=0,d=256;d>0;--d)l.next()}(u,s)}function a(s,u){return u.x=s.x.slice(),u.i=s.i,u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(c.x&&a(c,l),d.state=function(){return a(l,{})}),d}n&&n.exports?n.exports=i:r&&r.amd?r(function(){return i}):this.xorshift7=i})(0,e,!1)}),dk=zo(function(e){(function(t,n,r){function o(s){var u=this;u.next=function(){var l,c,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,c=f[h+34&127],l=f[h=h+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[h]=c^l,u.i=h,c+(d^d>>>16)|0},function(l,c){var d,f,h,v,y,x=[],m=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,m=Math.max(m,c.length)),h=0,v=-32;v<m;++v)c&&(f^=c.charCodeAt((v+32)%c.length)),v===0&&(y=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,v>=0&&(y=y+1640531527|0,h=(d=x[127&v]^=f+y)==0?h+1:0);for(h>=128&&(x[127&(c&&c.length||0)]=-1),h=127,v=512;v>0;--v)f=x[h+34&127],d=x[h=h+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,x[h]=f^d;l.w=y,l.X=x,l.i=h}(u,s)}function a(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function i(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(c.X&&a(c,l),d.state=function(){return a(l,{})}),d}n&&n.exports?n.exports=i:r&&r.amd?r(function(){return i}):this.xor4096=i})(0,e,!1)}),fk=zo(function(e){(function(t,n,r){function o(s){var u=this,l="";u.next=function(){var d=u.b,f=u.c,h=u.d,v=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^v,v=v-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^v,u.a=v-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function a(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function i(s,u){var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&a(c,l),d.state=function(){return a(l,{})}),d}n&&n.exports?n.exports=i:r&&r.amd?r(function(){return i}):this.tychei=i})(0,e,!1)}),Co=zo(function(e){(function(t,n){var r,o=this,a=256,i=6,s="random",u=n.pow(a,i),l=n.pow(2,52),c=2*l,d=a-1;function f(m,g,b){var w=[],C=y(function k(R,N){var P,T=[],D=typeof R;if(N&&D=="object")for(P in R)try{T.push(k(R[P],N-1))}catch{}return T.length?T:D=="string"?R:R+"\0"}((g=g==1?{entropy:!0}:g||{}).entropy?[m,x(t)]:m??function(){try{var k;return r&&(k=r.randomBytes)?k=k(a):(k=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(k)),x(k)}catch{var R=o.navigator,N=R&&R.plugins;return[+new Date,o,N,o.screen,x(t)]}}(),3),w),_=new h(w),E=function(){for(var k=_.g(i),R=u,N=0;k<l;)k=(k+N)*a,R*=a,N=_.g(1);for(;k>=c;)k/=2,R/=2,N>>>=1;return(k+N)/R};return E.int32=function(){return 0|_.g(4)},E.quick=function(){return _.g(4)/4294967296},E.double=E,y(x(_.S),t),(g.pass||b||function(k,R,N,P){return P&&(P.S&&v(P,_),k.state=function(){return v(_,{})}),N?(n[s]=k,R):k})(E,C,"global"in g?g.global:this==n,g.state)}function h(m){var g,b=m.length,w=this,C=0,_=w.i=w.j=0,E=w.S=[];for(b||(m=[b++]);C<a;)E[C]=C++;for(C=0;C<a;C++)E[C]=E[_=d&_+m[C%b]+(g=E[C])],E[_]=g;(w.g=function(k){for(var R,N=0,P=w.i,T=w.j,D=w.S;k--;)R=D[P=d&P+1],N=N*a+D[d&(D[P]=D[T=d&T+R])+(D[T]=R)];return w.i=P,w.j=T,N})(a)}function v(m,g){return g.i=m.i,g.j=m.j,g.S=m.S.slice(),g}function y(m,g){for(var b,w=m+"",C=0;C<w.length;)g[d&C]=d&(b^=19*g[d&C])+w.charCodeAt(C++);return x(g)}function x(m){return String.fromCharCode.apply(0,m)}if(n["seed"+s]=f,y(n.random(),t),e.exports){e.exports=f;try{r=require("crypto")}catch{}}})([],Math)});Co.alea=sk,Co.xor128=uk,Co.xorwow=lk,Co.xorshift7=ck,Co.xor4096=dk,Co.tychei=fk;var wl=Co.alea,ch=function(){function e(t,n,r,o,a){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=wl(i.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var n,r,o=!1;!o;){var a=void 0,i=void 0,s=void 0;do s=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*a*u,r=this.mean+this.stdDev*i*u,this.truncated&&!this.isValidTruncated(n)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},e.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}(),hk=function(){function e(t,n,r,o){this.alpha=t,this.beta=1/n,this.dtype=r;var a=o||Math.random();this.randu=wl(a.toString()),this.randn=new ch(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var t,n,r,o,a,i;;){do o=this.randn.nextValue(),i=1+this.c*o;while(i<=0);if(i*=i*i,n=1-.331*(t=o*o)*t,r=.5*t+this.d*(1-i+Math.log(i)),(a=this.randu())<n||Math.log(a)<r)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},e.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},e}(),pk=function(){function e(t,n,r,o){var a=this;if(t===void 0&&(t=0),n===void 0&&(n=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=t,this.range=n-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+n+" <= 1 and dtype is not float");this.random=wl(o)}return e.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function ve(e,t,n){return t===void 0&&(t="float32"),t=t||"float32",xy(e),new Gi(e,t,n)}function mk(e,t){t===void 0&&(t=!1),console.log(e.toString(t))}var Sy=A({batchToSpaceND_:function(e,t,n){var r=S(e,"x","batchToSpaceND"),o=t.reduce(function(a,i){return a*i});return I(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),I(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),I(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),j.runKernelFunc(function(a){return a.batchToSpaceND(r,t,n)},{$x:r},function(a){return{$x:function(){return a.spaceToBatchND(t,n)}}})}}),vk=A({broadcastTo_:function(e,t){var n=S(e,"broadcastTo","x"),r=n.shape;if(t.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var a=Array.from(t),i=t.length-1;i>=0;i--)if(n.shape[i]===t[i])a[i]=1;else if(n.shape[i]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=a.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return s.length===0?n.clone():j.runKernelFunc(function(u){return u.tile(n,a)},{input:n},function(u){return{input:function(){return u.sum(s,!0)}}})}}),gk=A({cast_:function(e,t){var n=S(e,"x","cast");if(!l_(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return j.runKernelFunc(function(o){return o.cast(n,t)},{x:n},function(o){return{x:function(){return o.clone()}}},"Cast",r)}}),yk=A({clone_:function(e){var t=S(e,"x","clone",null);return j.runKernelFunc(function(){return j.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(n){return{$x:function(){return n.toFloat()}}})}}),xk=A({cumsum_:function(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=S(e,"x","cumsum"),a=ir([t|=0],o.rank),i=o;a!=null&&(i=o.transpose(a));var s=sr(1,o.rank)[0],u=j.runKernelFunc(function(l){return l.cumsum(i,s,n,r)},{permutedX:i},function(l){return{permutedX:function(){return l.cumsum(t,n,!r)}}});return a!=null&&(u=u.transpose(a)),u}}),bk=A({depthToSpace_:function(e,t,n){n===void 0&&(n="NHWC");var r=S(e,"x","depthToSpace"),o=n==="NHWC"?r.shape[1]:r.shape[2],a=n==="NHWC"?r.shape[2]:r.shape[3],i=n==="NHWC"?r.shape[3]:r.shape[1];return I(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),I(a*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+t+` for depthToSpace with input shape
          `+r.shape}),I(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),j.runKernelFunc(function(s){return s.depthToSpace(r,t,n)},{$x:r})}}),bn=A({expandDims_:function(e,t){t===void 0&&(t=0);var n=S(e,"x","expandDims",null);I(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(I(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),jn(n,r)}}),Ry=A({eye_:function(e,t,n,r){r===void 0&&(r="float32"),t==null&&(t=e);for(var o=ve([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(n==null)return s;if(n.length===1)return Ca(bn(s,0),[n[0],1,1]);if(n.length===2)return Ca(bn(bn(s,0),0),[n[0],n[1],1,1]);if(n.length===3)return Ca(bn(bn(bn(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),wk=A({multinomial_:function(e,t,n,r){r===void 0&&(r=!1);var o=S(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=i===1?o.as2D(1,-1):o,u=j.runKernelFunc(function(l){return l.multinomial(s,r,t,n)},{logits2D:s});return i===1?u.as1D():u}}),Hd=A({oneHot_:function(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=S(e,"indices","oneHot","int32"),a=o.shape.concat([t]);return o=o.flatten(),j.runKernelFunc(function(i){return i.oneHot(o,t,n,r)},{$indices:o},function(i){return{$indices:function(){return Ue(o.shape,"float32")}}}).reshape(a)}}),Uo=A({pad_:function(e,t,n){n===void 0&&(n=0);var r=S(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n};return j.runKernelFunc(function(a){return a.pad(r,t,n)},{x:r},function(a){var i=t.map(function(s){return s[0]});return{x:function(){return a.slice(i,r.shape)}}},"PadV2",o)}}),Ck=A({pad1d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Uo(e,[t],n)}}),_k=A({pad2d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Uo(e,t,n)}}),kk=A({pad3d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Uo(e,t,n)}}),Ek=A({pad4d_:function(e,t,n){return n===void 0&&(n=0),I(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Uo(e,t,n)}}),Nk=A({rand_:function(e,t,n){var r=se(e),o=null;if(n==null||n==="float32")o=new Float32Array(r);else if(n==="int32")o=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return j.makeTensor(o,e,n)}}),Sk=A({randomNormal_:function(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new ch(t,n,r,!1,o),i=ve(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Rk=A({randomGamma_:function(e,t,n,r,o){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var a=new hk(t,n,r,o),i=ve(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Iy=A({randomUniform_:function(e,t,n,r,o){t===void 0&&(t=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var a=ve(e,r),i=new pk(t,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),jn=A({reshape_:function(e,t){var n=S(e,"x","reshape",null);t=s_(t,n.size),I(n.size===se(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return j.runKernelFunc(function(o){return o.reshape(n,t)},{x:n},function(o){return{x:function(){return o.reshape(n.shape)}}},"Reshape",r)}}),Dy=A({spaceToBatchND_:function(e,t,n){var r=S(e,"x","spaceToBatchND");return I(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),I(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),I(r.shape.reduce(function(o,a,i){return i>0&&i<=t.length?o&&(a+n[i-1][0]+n[i-1][1])%t[i-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),j.runKernelFunc(function(o){return o.spaceToBatchND(r,t,n)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,n)}}})}}),Ty=A({squeeze_:function(e,t){var n=S(e,"x","squeeze");return jn(n,_o(n.shape,t).newShape)}}),hn=A({stack_:function(e,t){t===void 0&&(t=0);var n=Bu(e,"tensors","stack");if(I(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;I(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(s){je(o,s.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(s){I(a===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(s){return s.expandDims(t)});return pt(i,t)}}),Ca=A({tile_:function(e,t){var n=S(e,"x","tile",null);I(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={reps:t};return j.runKernelFunc(function(a,i){var s=a.tile(n,t);return i([n]),s},{x:n},function(a,i){var s=i[0];return{x:function(){var u=Se(s);if(s.rank===1)for(var l=0;l<t[0];++l)u=u.add(a.slice([l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(l=0;l<t[0];++l)for(var c=0;c<t[1];++c)u=u.add(a.slice([l*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(var d=0;d<t[2];++d)u=u.add(a.slice([l*s.shape[0],c*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(d=0;d<t[2];++d)for(var f=0;f<t[3];++f)u=u.add(a.slice([l*s.shape[0],c*s.shape[1],d*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",o,r)}}),Ik=A({truncatedNormal_:function(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var a=new ch(t,n,r,!0,o),i=ve(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),mt=A({unstack_:function(e,t){t===void 0&&(t=0),t=t||0;var n=S(e,"x","unstack");I(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return j.runKernelFunc(function(o){return o.unstack(n,t)},{x:n},function(o){return{x:function(){return hn(o,t)}}},"Unpack",r)}}),Dk=function(e,t){return re(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d;return oe(this,function(f){switch(f.label){case 0:return n=S(e,"x","setdiff1d"),r=S(t,"y","setdiff1d"),I(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),I(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),I(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=f.sent(),[4,r.data()];case 2:for(a=f.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new Gi([s],n.dtype),l=new Gi([s],"int32"),c=0,d=0;c<o.length;c++)i.has(o[c])||(u.values[d]=o[c],l.values[d]=c,d++);return[2,[u.toTensor(),l.toTensor()]]}})})};function zu(e,t,n,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function Uu(e,t,n){n===void 0&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function $u(e,t,n,r){r===void 0&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function Ay(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Py(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function Fy(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var l=nr(e.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,o,u,l]}var jy=30;function yc(e){return e<=jy?e:Bd(e,Math.floor(Math.sqrt(e)))}function Tk(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}function Ak(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Tk(n,t,e)}function Vu(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,a=n.length,i=1,s=o;s<a;++s)i*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:se(t.shape)/u,sliceSize:i,strides:nr(n.slice(0,o)).concat([1]),outputSize:se(n)}}function Pk(e,t,n){I(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),I(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(a){I(t[a]+n[a]<=e.shape[a],function(){return"Error in slice"+e.rank+"D: begin["+a+"] + size["+a+"] ("+(t[a]+n[a])+") would overflow input.shape["+a+"] ("+e.shape[a]+")"})},o=0;o<e.rank;++o)r(o)}function Vm(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function dh(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function Fk(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||a==null)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),a=Md(0,a,s-1)}function jk(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||a==null)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),a=i>0?Md(0,a,s):Md(-1,a,s-1)}function My(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function Oy(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Mk(e,t){I(Ld(e),function(){return"The f passed in variableGrads(f) must be a function"}),I(t==null||Array.isArray(t)&&t.every(function(c){return c instanceof Oa}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=t!=null;if(!n)for(var r in t=[],j.registeredVariables)t.push(j.registeredVariables[r]);var o=n?t.filter(function(c){return!c.trainable}):null,a=t.length;I((t=t.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=j.gradients(e,t,null,!0),s=i.value,u=i.grads;I(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),I(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(c,d){u[d]!=null&&(l[c.name]=u[d])}),o!=null&&o.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function Cl(e){return j.customGrad(e)}var _r=A({softmax_:function(e,t){t===void 0&&(t=-1);var n=S(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return j.runKernelFunc(function(r,o){var a=r.softmax(n,t);return o([a]),a},{logits:n},function(r,o){var a=o[0],i=r.mul(a);return{logits:function(){return i.sub(i.sum([t],!0).mul(a))}}},"Softmax",{dim:t},[],[!0])}}),Ok=A({logSoftmax_:function(e,t){t===void 0&&(t=-1);var n=S(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Cl(function(r,o){var a=r.max(t,!0),i=r.sub(a),s=i.toFloat().sub(i.exp().sum(t,!0).log());return o([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(t,!0).mul(c))}}})(n)}}),Ly=function(){function e(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},e.prototype.set=function(t,n){this.dataIdsCount++,this.data.set(t,n)},e.prototype.has=function(t){return this.data.has(t)},e.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),By=function(){function e(){}return e.prototype.time=function(t){return z("time")},e.prototype.read=function(t){return z("read")},e.prototype.readSync=function(t){return z("readSync")},e.prototype.numDataIds=function(){return z("numDataIds")},e.prototype.disposeData=function(t){return z("disposeData")},e.prototype.write=function(t,n,r){return z("write")},e.prototype.move=function(t,n,r,o){return z("move")},e.prototype.memory=function(){return z("memory")},e.prototype.floatPrecision=function(){return z("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(t,n,r,o){return z("batchMatMul")},e.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,z("fusedBatchMatMul")},e.prototype.slice=function(t,n,r){return z("slice")},e.prototype.stridedSlice=function(t,n,r,o){return z("stridedSlice")},e.prototype.unstack=function(t,n){return z("unstack")},e.prototype.reverse=function(t,n){return z("reverse")},e.prototype.concat=function(t,n){return z("concat")},e.prototype.neg=function(t){return z("neg")},e.prototype.add=function(t,n){return z("add")},e.prototype.addN=function(t){return z("addN")},e.prototype.subtract=function(t,n){return z("subtract")},e.prototype.multiply=function(t,n){return z("multiply")},e.prototype.realDivide=function(t,n){return z("realDivide")},e.prototype.floorDiv=function(t,n){return z("floorDiv")},e.prototype.sum=function(t,n){return z("sum")},e.prototype.prod=function(t,n){return z("prod")},e.prototype.unsortedSegmentSum=function(t,n,r){return z("unsortedSegmentSum")},e.prototype.argMin=function(t,n){return z("argMin")},e.prototype.argMax=function(t,n){return z("argMax")},e.prototype.equal=function(t,n){return z("equal")},e.prototype.notEqual=function(t,n){return z("notEqual")},e.prototype.less=function(t,n){return z("less")},e.prototype.lessEqual=function(t,n){return z("lessEqual")},e.prototype.greater=function(t,n){return z("greater")},e.prototype.greaterEqual=function(t,n){return z("greaterEqual")},e.prototype.logicalNot=function(t){return z("logicalNot")},e.prototype.logicalAnd=function(t,n){return z("logicalAnd")},e.prototype.logicalOr=function(t,n){return z("logicalOr")},e.prototype.where=function(t){return z("where")},e.prototype.select=function(t,n,r){return z("select")},e.prototype.topk=function(t,n,r){return z("topk")},e.prototype.min=function(t,n){return z("min")},e.prototype.minimum=function(t,n){return z("minimum")},e.prototype.mod=function(t,n){return z("mod")},e.prototype.max=function(t,n){return z("max")},e.prototype.maximum=function(t,n){return z("maximum")},e.prototype.all=function(t,n){return z("all")},e.prototype.any=function(t,n){return z("any")},e.prototype.squaredDifference=function(t,n){return z("squaredDifference")},e.prototype.ceil=function(t){return z("ceil")},e.prototype.floor=function(t){return z("floor")},e.prototype.round=function(t){return z("round")},e.prototype.sign=function(t){return z("sign")},e.prototype.isNaN=function(t){return z("isNaN")},e.prototype.isInf=function(t){return z("isInf")},e.prototype.isFinite=function(t){return z("isFinite")},e.prototype.pow=function(t,n){return z("pow")},e.prototype.exp=function(t){return z("exp")},e.prototype.expm1=function(t){return z("expm1")},e.prototype.softmax=function(t,n){return z("softmax")},e.prototype.log=function(t){return z("log")},e.prototype.log1p=function(t){return z("log1p")},e.prototype.sqrt=function(t){return z("sqrt")},e.prototype.rsqrt=function(t){return z("rsqrt")},e.prototype.square=function(t){return z("square")},e.prototype.reciprocal=function(t){return z("reciprocal")},e.prototype.relu=function(t){return z("relu")},e.prototype.relu6=function(t){return z("relu6")},e.prototype.prelu=function(t,n){return z("prelu")},e.prototype.elu=function(t){return z("elu")},e.prototype.eluDer=function(t,n){return z("eluDer")},e.prototype.selu=function(t){return z("selu")},e.prototype.int=function(t){return z("int")},e.prototype.clip=function(t,n,r){return z("clip")},e.prototype.abs=function(t){return z("abs")},e.prototype.complexAbs=function(t){return z("complexAbs")},e.prototype.sigmoid=function(t){return z("sigmoid")},e.prototype.softplus=function(t){return z("softplus")},e.prototype.sin=function(t){return z("sin")},e.prototype.cos=function(t){return z("cos")},e.prototype.tan=function(t){return z("tan")},e.prototype.asin=function(t){return z("asin")},e.prototype.acos=function(t){return z("acos")},e.prototype.atan=function(t){return z("atan")},e.prototype.atan2=function(t,n){return z("atan2")},e.prototype.sinh=function(t){return z("sinh")},e.prototype.cosh=function(t){return z("cosh")},e.prototype.tanh=function(t){return z("tanh")},e.prototype.asinh=function(t){return z("asinh")},e.prototype.acosh=function(t){return z("acosh")},e.prototype.atanh=function(t){return z("atanh")},e.prototype.erf=function(t){return z("erf")},e.prototype.step=function(t,n){return z("step")},e.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,z("fusedConv2d")},e.prototype.conv2d=function(t,n,r){return z("conv2d")},e.prototype.conv2dDerInput=function(t,n,r){return z("conv2dDerInput")},e.prototype.conv2dDerFilter=function(t,n,r){return z("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,z("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(t,n,r){return z("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(t,n,r){return z("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){return z("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(t,n,r){return z("conv3d")},e.prototype.conv3dDerInput=function(t,n,r){return z("conv3dDerInput")},e.prototype.conv3dDerFilter=function(t,n,r){return z("conv3dDerFilter")},e.prototype.maxPool=function(t,n){return z("maxPool")},e.prototype.maxPoolBackprop=function(t,n,r,o){return z("maxPoolBackprop")},e.prototype.avgPool=function(t,n){return z("avgPool")},e.prototype.avgPoolBackprop=function(t,n,r){return z("avgPoolBackprop")},e.prototype.avgPool3d=function(t,n){return z("avgPool3d")},e.prototype.avgPool3dBackprop=function(t,n,r){return z("avgPool3dBackprop")},e.prototype.maxPool3d=function(t,n){return z("maxPool3d")},e.prototype.maxPool3dBackprop=function(t,n,r,o){return z("maxPool3dBackprop")},e.prototype.reshape=function(t,n){return z("reshape")},e.prototype.cast=function(t,n){return z("cast")},e.prototype.tile=function(t,n){return z("tile")},e.prototype.pad=function(t,n,r){return z("pad")},e.prototype.transpose=function(t,n){return z("transpose")},e.prototype.gather=function(t,n,r){return z("gather")},e.prototype.gatherND=function(t,n){return z("gatherND")},e.prototype.scatterND=function(t,n,r){return z("scatterND")},e.prototype.batchToSpaceND=function(t,n,r){return z("batchToSpaceND")},e.prototype.spaceToBatchND=function(t,n,r){return z("spaceToBatchND")},e.prototype.resizeBilinear=function(t,n,r,o){return z("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(t,n,r){return z("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(t,n,r,o){return z("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){return z("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(t,n,r,o,a,i){return z("batchNormalization")},e.prototype.localResponseNormalization4D=function(t,n,r,o,a){return z("localResponseNormalization4D")},e.prototype.LRNGrad=function(t,n,r,o,a,i,s){return z("LRNGrad")},e.prototype.multinomial=function(t,n,r,o){return z("multinomial")},e.prototype.oneHot=function(t,n,r,o){return z("oneHot")},e.prototype.cumsum=function(t,n,r,o){return z("cumsum")},e.prototype.nonMaxSuppression=function(t,n,r,o,a){return z("nonMaxSuppression")},e.prototype.fft=function(t){return z("fft")},e.prototype.ifft=function(t){return z("ifft")},e.prototype.complex=function(t,n){return z("complex")},e.prototype.real=function(t){return z("real")},e.prototype.imag=function(t){return z("imag")},e.prototype.cropAndResize=function(t,n,r,o,a,i){return z("cropAndResize")},e.prototype.depthToSpace=function(t,n,r){return z("depthToSpace")},e.prototype.split=function(t,n,r){return z("split")},e.prototype.sparseToDense=function(t,n,r,o){return z("sparseToDense")},e.prototype.diag=function(t){return z("diag")},e.prototype.fill=function(t,n,r){return z("fill")},e.prototype.onesLike=function(t){return z("onesLike")},e.prototype.zerosLike=function(t){return z("zerosLike")},e.prototype.linspace=function(t,n,r){return z("linspace")},e.prototype.dispose=function(){return z("dispose")},e}();function z(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ur(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&i===1&&r.unshift(a)}return r}function vt(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(o==null||o===1&&i>1)&&n.unshift(a)}return n}function Ce(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];a==null&&(a=1);var i=t[t.length-o-1];if(i==null&&(i=1),a===1)n.unshift(i);else if(i===1)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function Ki(e,t,n,r,o,a,i){i===void 0&&(i="channelsLast");var s,u=qu(t),l=u[0],c=u[1];if(i==="channelsLast")s=[l,c,e[3],e[3]];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);s=[l,c,e[1],e[1]]}return $o(e,s,n,r,o,a,!1,i)}function Hu(e,t,n,r,o,a,i){i===void 0&&(i="NDHWC");var s,u,l=Gd(t),c=l[0],d=l[1],f=l[2];if(i==="NDHWC")u="channelsLast",s=[c,d,f,e[4],e[4]];else{if(i!=="NCDHW")throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[c,d,f,e[1],e[1]]}return Gu(e,s,n,r,o,!1,u,a)}function $o(e,t,n,r,o,a,i,s){i===void 0&&(i=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],f=u[3];if(s==="channelsLast")l=e[0],c=e[1],d=e[2],f=e[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=e[0],f=e[1],c=e[2],d=e[3]}var h,v=t[0],y=t[1],x=t[3],m=qu(n),g=m[0],b=m[1],w=qu(r),C=w[0],_=w[1],E=_a(v,C),k=_a(y,_),R=function(B,W,U,$,F,O,L,G){var Y,Z,de;if(typeof B=="number"){Y={top:B,bottom:B,left:B,right:B,type:B===0?"VALID":"NUMBER"};var ne=function(be,Ee,ke,Oe,Ne){Oe==null&&(Oe=Wy(be,Ee,ke));var Le=be[0],lt=be[1],Tt=Ci((Le-Ee+2*Oe)/ke+1,Ne);I(et(Tt),function(){return"The output # of rows ("+Tt+") must be an integer. Change the stride and/or zero pad parameters"});var it=Ci((lt-Ee+2*Oe)/ke+1,Ne);return I(et(it),function(){return"The output # of columns ("+it+") must be an integer. Change the stride and/or zero pad parameters"}),[Tt,it]}([W,U],O,$,B,G);Z=ne[0],de=ne[1]}else if(B==="same"){Z=Math.ceil(W/$),de=Math.ceil(U/F);var ae=Math.max(0,(Z-1)*$+O-W),pe=Math.max(0,(de-1)*F+L-U),ge=Math.floor(ae/2),ye=ae-ge,Ve=Math.floor(pe/2);Y={top:ge,bottom:ye,left:Ve,right:pe-Ve,type:"SAME"}}else{if(B!=="valid")throw Error("Unknown padding parameter: "+B);Y={top:0,bottom:0,left:0,right:0,type:"VALID"},Z=Math.ceil((W-O+1)/$),de=Math.ceil((U-L+1)/F)}return{padInfo:Y,outHeight:Z,outWidth:de}}(o,c,d,g,b,E,k,a),N=R.padInfo,P=R.outHeight,T=R.outWidth,D=i?x*f:x;return s==="channelsFirst"?h=[l,D,P,T]:s==="channelsLast"&&(h=[l,P,T,D]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:d,inChannels:f,outHeight:P,outWidth:T,outChannels:D,padInfo:N,strideHeight:g,strideWidth:b,filterHeight:v,filterWidth:y,effectiveFilterHeight:E,effectiveFilterWidth:k,dilationHeight:C,dilationWidth:_,inShape:e,outShape:h,filterShape:t}}function Gu(e,t,n,r,o,a,i,s){a===void 0&&(a=!1),i===void 0&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],f=u[3],h=u[4];if(i==="channelsLast")l=e[0],c=e[1],d=e[2],f=e[3],h=e[4];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);l=e[0],h=e[1],c=e[2],d=e[3],f=e[4]}var v,y=t[0],x=t[1],m=t[2],g=t[4],b=Gd(n),w=b[0],C=b[1],_=b[2],E=Gd(r),k=E[0],R=E[1],N=E[2],P=_a(y,k),T=_a(x,R),D=_a(m,N),B=function(L,G,Y,Z,de,ne,ae,pe,ge,ye,Ve){var be,Ee,ke,Oe;if(typeof L=="number"){be={top:L,bottom:L,left:L,right:L,front:L,back:L,type:L===0?"VALID":"NUMBER"};var Ne=function(ie,fe,Te,tt,Re,ct){Re==null&&(Re=Wy(ie,fe,tt));var Rn=ie[0],go=ie[1],Rr=ie[2],Ir=Ci((Rn-fe+2*Re)/tt+1,ct);I(et(Ir),function(){return"The output # of depths ("+Ir+") must be an integer. Change the stride and/or zero pad parameters"});var Go=Ci((go-fe+2*Re)/tt+1,ct);I(et(Go),function(){return"The output # of rows ("+Go+") must be an integer. Change the stride and/or zero pad parameters"});var Xa=Ci((Rr-fe+2*Re)/tt+1,ct);return I(et(Xa),function(){return"The output # of columns ("+Xa+") must be an integer. Change the stride and/or zero pad parameters"}),[Ir,Go,Xa,Te]}([G,Y,Z,1],pe,1,de,L,Ve);Ee=Ne[0],ke=Ne[1],Oe=Ne[2]}else if(L==="same"){Ee=Math.ceil(G/de),ke=Math.ceil(Y/ne),Oe=Math.ceil(Z/ae);var Le=(Ee-1)*de+pe-G,lt=(ke-1)*ne+ge-Y,Tt=(Oe-1)*ae+ye-Z,it=Math.floor(Le/2),rn=Le-it,Gt=Math.floor(lt/2),gn=lt-Gt,q=Math.floor(Tt/2);be={top:Gt,bottom:gn,left:q,right:Tt-q,front:it,back:rn,type:"SAME"}}else{if(L!=="valid")throw Error("Unknown padding parameter: "+L);be={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ee=Math.ceil((G-pe+1)/de),ke=Math.ceil((Y-ge+1)/ne),Oe=Math.ceil((Z-ye+1)/ae)}return{padInfo:be,outDepth:Ee,outHeight:ke,outWidth:Oe}}(o,c,d,f,w,C,_,P,T,D,s),W=B.padInfo,U=B.outDepth,$=B.outHeight,F=B.outWidth,O=a?g*h:g;return i==="channelsFirst"?v=[l,O,U,$,F]:i==="channelsLast"&&(v=[l,U,$,F,O]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:d,inWidth:f,inChannels:h,outDepth:U,outHeight:$,outWidth:F,outChannels:O,padInfo:W,strideDepth:w,strideHeight:C,strideWidth:_,filterDepth:y,filterHeight:x,filterWidth:m,effectiveFilterDepth:P,effectiveFilterHeight:T,effectiveFilterWidth:D,dilationDepth:k,dilationHeight:R,dilationWidth:N,inShape:e,outShape:v,filterShape:t}}function Wy(e,t,n,r){r===void 0&&(r=1);var o=_a(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function qu(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function Gd(e){return typeof e=="number"?[e,e,e]:e}function _a(e,t){return t<=1?e:e+(e-1)*(t-1)}function Ci(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Ba(e){var t=qu(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function nn(e,t){return Ba(e)||Ba(t)}function fh(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function zy(e,t,n){if(t==="complex64"){if(e.dtype==="complex64")return e.clone();var r=Ue(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!c_(e.dtype,t))return j.makeTensorFromDataId(e.dataId,e.shape,t);if(e.dtype==="complex64"){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if(t==="int32")return n.int(e);if(t==="bool"){var s=J(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function qd(e,t){return j.makeTensorFromDataId(e.dataId,t,e.dtype)}function Uy(e,t,n){var r=(t-e)/(n-1),o=os(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return ut(o,"float32")}function Kd(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Hm(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Lk(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Bk(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Wk(e,t,n){var r=function(a,i,s){return function(u,l,c){for(var d=0,f=u.length,h=0,v=!1;d<f;){var y=c(l,u[h=d+(f-d>>>1)]);y>0?d=h+1:(f=h,v=!y)}return v?d:-d-1}(a,i,s||zk)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function zk(e,t){return e>t?1:e<t?-1:0}function hh(e,t,n,r,o){return $y(e,t,n,r,o,0).selectedIndices}function ph(e,t,n,r,o,a){var i=$y(e,t,n,r,o,a);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function $y(e,t,n,r,o,a,i,s){s===void 0&&(s=!1);for(var u=Array.from(t).map(function(w,C){return{score:w,boxIndex:C,suppressBeginIndex:0}}).filter(function(w){return w.score>o}).sort(Gm),l=a>0?-.5/a:0,c=[],d=[];c.length<n&&u.length>0;){var f=u.pop(),h=f.score,v=f.boxIndex,y=f.suppressBeginIndex;if(h<o)break;for(var x=!1,m=c.length-1;m>=y;--m){var g=Uk(e,v,c[m]);if(g>=r){x=!0;break}if(f.score=f.score*$k(r,l,g),f.score<=o)break}f.suppressBeginIndex=c.length,x||(f.score===h?(c.push(v),d.push(f.score)):f.score>o&&Wk(u,f,Gm))}var b=c.length;return s&&(c.fill(0,b),d.fill(0,b)),{selectedIndices:ut(c,"int32"),selectedScores:ut(d,"float32"),numValidOutputs:J(b,"int32")}}function Uk(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),h=(s-a)*(u-i),v=(d-l)*(f-c);if(h<=0||v<=0)return 0;var y=Math.max(a,l),x=Math.max(i,c),m=Math.min(s,d),g=Math.min(u,f),b=Math.max(m-y,0)*Math.max(g-x,0);return b/(h+v-b)}function $k(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Gm(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Vy(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(a){o[n]=a;var i=e.slice(r,o);return r[n]+=a,i})}function Hy(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=ve(n,e.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(e.rank),s=0;s<i.length;s++)i[s]=a[s]%e.shape[s];var u=e.locToIndex(i);o.values[r]=e.values[u]}return o.toTensor()}function Gy(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],l=Hi(n,s*r),c=Hi("int32",s*r),d=0;d<s;d++){for(var f=d*u,h=e.subarray(f,f+u),v=[],y=0;y<h.length;y++)v.push({value:h[y],index:y});v.sort(function(w,C){return C.value-w.value});var x=d*r,m=l.subarray(x,x+r),g=c.subarray(x,x+r);for(y=0;y<r;y++)m[y]=v[y].value,g[y]=v[y].index}var b=t.slice();return b[b.length-1]=r,[Rt(l,b,n),Rt(c,b,"int32")]}function mh(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=ve(e,"int32"),a=ve([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}var Vk=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(o,a){return"T"+a});var n=[];this.variableNames.forEach(function(o){n.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},Hk=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(o,a){return"T"+a});var n=[];this.variableNames.forEach(function(o){n.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},Gk=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function qy(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(n){return e+"."+n})}function Xt(e,t){return t===1?[e]:qy(e,t)}function Ot(){var e,t,n,r,o,a,i,s,u,l;return H().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function So(e,t,n){n===void 0&&(n="index");var r=nr(t);return r.map(function(o,a){return"int "+e[a]+" = "+n+" / "+o+"; "+(a===r.length-1?"int "+e[a+1]+" = "+n+" - "+e[a]+" * "+o:"index -= "+e[a]+" * "+o)+";"}).join("")}function vh(e){var t=nr(e).map(function(n){return n.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var Ky=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function qk(e,t,n,r){var o=[];e.forEach(function(h){var v=se(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(v>1?"["+v+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var a,i,s=o.join(`
`),u=e.map(function(h){return function(v,y,x){x===void 0&&(x=!1);var m="";m+=x?Xy(v):Jo(v);var g=v.shapeInfo.logicalShape,b=y.logicalShape;return g.length<=b.length&&(m+=x?function(w,C){var _,E=w.name,k=E.charAt(0).toUpperCase()+E.slice(1),R="get"+k+"AtOutCoords",N=w.shapeInfo.logicalShape.length,P=C.logicalShape.length,T=Ur(w.shapeInfo.logicalShape,C.logicalShape),D=We(P),B=P-N,W=["x","y","z","w","u","v"];_=N===0?"":P<2&&T.length>=1?"coords = 0;":T.map(function(Y){return"coords."+W[Y+B]+" = 0;"}).join(`
`);var U="";U=P<2&&N>0?"coords":w.shapeInfo.logicalShape.map(function(Y,Z){return"coords."+W[Z+B]}).join(", ");var $="return outputValue;",F=se(w.shapeInfo.logicalShape)===1,O=se(C.logicalShape)===1;if(N!==1||F||O){if(F&&!O)$=P===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(T.length){var L=N-2,G=N-1;T.indexOf(L)>-1&&T.indexOf(G)>-1?$="return vec4(outputValue.x);":T.indexOf(L)>-1?$="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":T.indexOf(G)>-1&&($="return vec4(outputValue.xx, outputValue.zz);")}}else $=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+R+`() {
      `+D+` coords = getOutputCoords();
      `+_+`
      vec4 outputValue = get`+k+"("+U+`);
      `+$+`
    }
  `}(v,y):function(w,C){var _=w.name,E=_.charAt(0).toUpperCase()+_.slice(1),k="get"+E+"AtOutCoords",R=C.texShape,N=w.shapeInfo.texShape,P=w.shapeInfo.logicalShape.length,T=C.logicalShape.length;if(!w.shapeInfo.isUniform&&P===T&&w.shapeInfo.flatOffset==null&&Ct(N,R))return`
      float `+k+`() {
        return sampleTexture(`+_+`, resultUV);
      }
    `;var D,B=We(T),W=Ur(w.shapeInfo.logicalShape,C.logicalShape),U=T-P,$=["x","y","z","w","u","v"];D=P===0?"":T<2&&W.length>=1?"coords = 0;":W.map(function(O){return"coords."+$[O+U]+" = 0;"}).join(`
`);var F="";return F=T<2&&P>0?"coords":w.shapeInfo.logicalShape.map(function(O,L){return"coords."+$[L+U]}).join(", "),`
    float `+k+`() {
      `+B+` coords = getOutputCoords();
      `+D+`
      return get`+E+"("+F+`);
    }
  `}(v,y)),m}(h,t,r)}).join(`
`),l=t.texShape,c=Ot(),d=function(h){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+h.texture2D+`(textureSampler, uv).r;
    }
  `}(c),f=function(h){return h.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+h.varyingFs+` vec2 resultUV;
    `+h.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+h.defineSpecialNaN+`
    `+h.defineSpecialInf+`
    `+h.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Kk+`
    `+Xk+`
    `+Yk+`
  `}(c);return t.isPacked?(a=function(h,v){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(w,C){var _=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)];return _[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return 2 * (resTexRC.x * `+_[1]+` + resTexRC.y);
    }
  `}(0,v);case 2:return function(w,C){var _=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)];if(Ct(w,C))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `;var E=Math.ceil(w[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = 2 * (index / `+E+`);
      int c = imod(index, `+E+`) * 2;

      return ivec2(r, c);
    }
  `}(h,v);case 3:return y=h,x=v,m=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],g=Math.ceil(y[2]/2),b=g*Math.ceil(y[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;

      int b = index / `+b+`;
      index -= b * `+b+`;

      int r = 2 * (index / `+g+`);
      int c = imod(index, `+g+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(w,C){for(var _=[Math.ceil(C[0]/2),Math.ceil(C[1]/2)],E=Math.ceil(w[w.length-1]/2),k=E*Math.ceil(w[w.length-2]/2),R=k,N="",P="b, r, c",T=2;T<w.length-1;T++)R*=w[w.length-T-1],N=`
      int b`+T+" = index / "+R+`;
      index -= b`+T+" * "+R+`;
    `+N,P="b"+T+", "+P;return`
    ivec`+w.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+N+`

      int b = index / `+k+`;
      index -= b * `+k+`;

      int r = 2 * (index / `+E+`);
      int c = imod(index, `+E+`) * 2;

      return ivec`+w.length+"("+P+`);
    }
  `}(h,v)}var y,x,m,g,b}(t.logicalShape,l),i=function(h){return`
    void setOutput(vec4 val) {
      `+h.output+` = val;
    }
  `}(c)):(a=function(h,v){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(m,g){return g[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+g[1]+`.0);
      }
    `:g[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+g[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      return resTexRC.x * `+g[1]+` + resTexRC.y;
    }
  `}(0,v);case 2:return function(m,g){return Ct(m,g)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+g[0]+", "+g[1]+`));
      }
    `:m[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+g[0]+", "+g[1]+`));
        int index = resTexRC.x * `+g[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:m[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+g[0]+", "+g[1]+`));
        int index = resTexRC.x * `+g[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;
      int r = index / `+m[1]+`;
      int c = index - r * `+m[1]+`;
      return ivec2(r, c);
    }
  `}(h,v);case 3:return y=v,x=So(["r","c","d"],h),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      `+x+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(m,g){var b=So(["r","c","d","d2"],m);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;
      `+b+`
      return ivec4(r, c, d, d2);
    }
  `}(h,v);case 5:return function(m,g){var b=So(["r","c","d","d2","d3"],m);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+g[0]+`,
                             `+g[1]+`));

      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      `+b+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(h,v);case 6:return function(m,g){var b=So(["r","c","d","d2","d3","d4"],m);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      `+b+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(h,v);default:throw new Error(h.length+"-D output sampling is not yet supported")}var y,x}(t.logicalShape,l),i=function(h){return`
    void setOutput(float val) {
      `+h.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(f+=Qk),[f,d,i,s,a,u,n].join(`
`)}function Jo(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(n){var r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var a=n.shapeInfo.texShape,i=a[0],s=a[1];if(i===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=n.shapeInfo.texShape,l=u[0],c=u[1],d=yo(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 1:return function(n){var r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Ko(n)+`
      }
    `;var a=n.shapeInfo.texShape,i=a[0],s=a[1];if(s===1&&i===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=yo(r);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+i+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:i===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 2:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=n.shapeInfo.texShape;if(i!=null&&Ct(r,i)){var s=i[0],u=i[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var l=_o(r),c=l.newShape,d=l.keptDims,f=c;if(f.length<r.length){var h=Zo(n,f);return`
      `+Jo(h)+`
      float `+a+`(int row, int col) {
        return `+a+"("+ea(["row","col"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Ko(n)+`
      }
    `;var v=i[0],y=i[1],x=yo(o);return y===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+x+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+v+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:v===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+x+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+y+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+x+`;
    vec2 uv = uvFromFlat(`+v+", "+y+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(e);case 3:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[1]*r[2],s=r[2],u=_o(r),l=u.newShape,c=u.keptDims,d=l;if(d.length<r.length){var f=Zo(n,d);return`
        `+Jo(f)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+ea(["row","col","depth"],c)+`);
        }
      `}if(n.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+s+`, 1)));
        `+Ko(n)+`
      }
    `;var h=n.shapeInfo.texShape,v=h[0],y=h[1],x=n.shapeInfo.flatOffset;if(y===i&&x==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+y+".0, "+v+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(y===s&&x==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+y+".0, "+v+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var m=yo(o);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+s+" + depth + "+m+`;
        vec2 uv = uvFromFlat(`+v+", "+y+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(e);case 4:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[3],s=r[2]*i,u=r[1]*s,l=_o(r),c=l.newShape,d=l.keptDims;if(c.length<r.length){var f=Zo(n,c);return`
      `+Jo(f)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+ea(["row","col","depth","depth2"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+i+`, 1)));
        `+Ko(n)+`
      }
    `;var h=n.shapeInfo.flatOffset,v=n.shapeInfo.texShape,y=v[0],x=v[1];if(x===u&&h==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(x===i&&h==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var m=yo(o);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+y+", "+x+", index + "+m+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);case 5:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=r[4],s=r[3]*i,u=r[2]*s,l=r[1]*u,c=_o(r),d=c.newShape,f=c.keptDims;if(d.length<r.length){var h=Zo(n,d);return`
      `+Jo(h)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+ea(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+i+`)) +
          depth3;
        `+Ko(n)+`
      }
    `;var v=n.shapeInfo.flatOffset,y=n.shapeInfo.texShape,x=y[0],m=y[1];if(m===l&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+x+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(m===i&&v==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+x+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var g=yo(o);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+i+" + depth3 + "+g+`;
      vec2 uv = uvFromFlat(`+x+", "+m+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);case 6:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),i=_o(r),s=i.newShape,u=i.keptDims;if(s.length<r.length){var l=Zo(n,s);return`
      `+Jo(l)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+ea(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],d=r[4]*c,f=r[3]*d,h=r[2]*f,v=r[1]*h;if(n.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+v+", "+h+", "+f+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Ko(n)+`
      }
    `;var y=n.shapeInfo.flatOffset,x=n.shapeInfo.texShape,m=x[0],g=x[1];if(g===v&&y==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+f+", "+d+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===c&&y==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var b=yo(o);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+v+" + col * "+h+" + depth * "+f+` +
          depth2 * `+d+" + depth3 * "+c+" + depth4 + "+b+`;
      vec2 uv = uvFromFlat(`+m+", "+g+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Xy(e){var t,n,r;switch(e.shapeInfo.logicalShape.length){case 0:return t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Ot(),`
    vec4 `+n+`() {
      return `+r.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(o){var a=o.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=Ot();return`
    vec4 `+i+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+a+`, uv);
    }
  `}(e);case 2:return function(o){var a=o.shapeInfo.logicalShape,i=o.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=o.shapeInfo.texShape,l=u[0],c=u[1],d=Ot();if(u!=null&&Ct(a,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+d.texture2D+"("+i+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Math.ceil(a[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+h+", "+f[0]+", "+f[1]+`, row, col);
      return `+d.texture2D+"("+i+`, uv);
    }
  `}(e);case 3:return function(o){var a=o.shapeInfo.logicalShape,i=o.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=o.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(a[0]===1){var c=a.slice(1),d=Zo(o,c);return`
        `+Xy(d)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+ea(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],h=l[1],v=Math.ceil(a[2]/2),y=v*Math.ceil(a[1]/2),x=Ot();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+h+", "+y+", "+v+`, b, row, col);
      return `+x.texture2D+"("+i+`, uv);
    }
  `}(e);default:return function(o){for(var a=o.shapeInfo.logicalShape,i=a.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=o.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=c[0],f=c[1],h=Math.ceil(a[i-1]/2),v=h*Math.ceil(a[i-2]/2),y="int b, int row, int col",x="b * "+v+" + (row / 2) * "+h+" + (col / 2)",m=2;m<i-1;m++)y="int b"+m+", "+y,v*=a[i-m-1],x="b"+m+" * "+v+" + "+x;var g=Ot();return`
    vec4 `+u+"("+y+`) {
      int index = `+x+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+d+`);
      return `+g.texture2D+"("+s+`, uv);
    }
  `}(e)}}var Kk=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Xk=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Yk=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Qk=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function yo(e){return"offset"+e}function Ko(e){var t=e.name,n=se(e.shapeInfo.logicalShape);return n<2?"return "+t+";":`
    for (int i = 0; i < `+n+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function We(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Zo(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function ea(e,t){return t.map(function(n){return e[n]}).join(", ")}var Jk=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,I(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=We(l),d=Xt("coords",l);if(a===1){var f=We(s=l+1);i=`
        `+f+" sourceLocR = "+f+"("+d.join()+`, 0);
        ++`+d[l-1]+`;
        `+f+" sourceLocG = "+f+"("+d.join()+`, 0);
        ++`+d[l-2]+`;
        `+f+" sourceLocA = "+f+"("+d.join()+`, 0);
        --`+d[l-1]+`;
        `+f+" sourceLocB = "+f+"("+d.join()+`, 0);
        --`+d[l-2]+";"}else s=l,i=`
        `+c+` sourceLocR = coords;
        ++`+d[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+d[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+d[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+d[l-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),v="."+h[s-1],y=h.map(function(k){return"int "+k}),x=Xt("sourceLocR",s-1).concat("inIdx.r"),m=Xt("sourceLocG",s-1).concat("inIdx.g"),g=Xt("sourceLocB",s-1).concat("inIdx.b"),b=Xt("sourceLocA",s-1).concat("inIdx.a"),w=n==="max"?"greaterThan":"lessThan",C=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+b.join()+")));",_=`vec4(
            getAChannel(`+x.join()+`),
            hasNextCol ? getAChannel(`+m.join()+`) : 0.,
            hasNextRow ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+b.join()+") : 0.)",E=r?"":`
      float getBestIndicesAChannel(`+y.join()+`) {
        return getChannel(getBestIndicesA(`+h.join()+`),
                                          vec2(`+h.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+y.join()+`) {
        return getChannel(getA(`+h.join()+`),
                               vec2(`+h.slice(-2).join()+`));
      }
      `+E+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+d[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+d[l-2]+" < "+(u[l-2]-1)+`;
        `+i+`
        ivec4 srcIdx = ivec4(sourceLocR`+v+", sourceLocG"+v+`,
          sourceLocB`+v+", sourceLocA"+v+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+_+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+C+`
          vec4 candidate = `+_+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+w+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},Zk=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,d=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+i+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},eE=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=c-1-e.padInfo.front,v=d-1-e.padInfo.top,y=f-1-e.padInfo.left,x=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(`+h+", "+v+", "+y+`);
      const float avgMultiplier = float(`+x+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},tE=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Ce(e,t),Ce(e,n);var i="0.0";r!=null&&(Ce(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";o!=null&&(Ce(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+i+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},nE=function(e,t,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ce(e,t),Ce(e,n);var i="vec4(0.0)";r!=null&&(Ce(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(Ce(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+i+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `},rE="return areal * breal - aimag * bimag;",oE="return areal * bimag + aimag * breal;",qm=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ce(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},xc="return a + b;",bc="return a - b;",Km="return a * b;",Yy="return (a < 0.) ? b * a : a;",Je=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Ce(t,n),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Qy=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,cr=function(e,t,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ce(t,n);var o=this.outputShape.length,a="";if(r)if(o===0||se(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+We(o)+` coords = getOutputCoords();
        `,o===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var i=Xt("coords",o);a+=`
            bool nextRowOutOfBounds =
              (`+i[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+i[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `},aE=function(){function e(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(o,a){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(a,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,n)}},e}(),iE=function(){function e(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(o,a){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(a,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(a,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,n)}},e}(),sE=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},uE=function(e){this.outputShape=[],this.outputShape=La(e,1),this.variableNames=e.map(function(s,u){return"T"+u});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},lE=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=La(e,t);var n=this.outputShape,r=n.length,o=We(r),a=Xt("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(x,m){return"T"+m});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=i[t],c=i.slice(-2),d=i.join(),f="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var h=s[u-1];f+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+js(i,l,h)+`),
            vec2(`+js(c,l,h)+`));
        }`}var v=s.length,y=s[s.length-1];f+=`
        return getChannel(
          getT`+v+"("+js(i,l,y)+`),
          vec2(`+js(c,l,y)+"));",this.userCode=`
      float getValue(`+i.map(function(x){return"int "+x})+`) {
        `+f+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[r-1]+" = "+a[r-1]+` + 1;
        if (`+a[r-1]+" < "+n[r-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[r-2]+" = "+a[r-2]+` + 1;
        if (`+a[r-2]+" < "+n[r-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[r-1]+" = "+a[r-1]+` - 1;
        if (`+a[r-2]+" < "+n[r-2]+` &&
            `+a[r-1]+" < "+n[r-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `};function js(e,t,n){var r=e.indexOf(t);return e.map(function(o,a){return a===r?o+" - "+n:o}).join()}var cE=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},dE=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dataFormat==="channelsLast",i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},fE=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+a+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+i+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},hE=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},pE=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},mE=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Xm=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,a=e.padInfo.left,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,f=4*Math.floor(e.inChannels/4),h=e.inChannels%4,v=e.dataFormat==="channelsLast",y=v?1:2,x=v?2:3,m=v?3:1,g="",b="";n&&(g=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,b="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+g+`

      const ivec2 strides = ivec2(`+i+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+m+`];

        ivec2 xRCCorner =
            ivec2(coords[`+y+"], coords["+x+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+v+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(h===1)+`) {

              if (`+v+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(h===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+v+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(h===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+v+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+w+`
        `+b+`
        setOutput(result);
      }
    `},vE=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,f=e.filterWidth,h=4*Math.floor(e.inChannels/4),v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+a+", "+i+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+h+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(v===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+h+`) *
                  getW(wF, wR, wC, `+h+`, d2);
              } else if (`+(v===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(v===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1),
                  getX(batch, xF, xR, xC, `+h+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2),
                  getW(wF, wR, wC, `+h+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ym=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,v=e.outChannels/e.inChannels,y="",x="";n&&(y=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,x="result = activation(result);");var m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+v+`;
        int q = d2 - d1 * `+v+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+m+`
        `+x+`
        setOutput(result);
      }
    `},Qm=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,v=h,y="int xR; int xC; int xCOffset;",x=0;x<f;x++)for(var m=0;m<h;m++)y+=`
          vec4 xTexelR`+x+"C"+2*m+` = vec4(0.);
          vec4 wR`+x+"C"+m+` = vec4(0.);
          vec4 xR`+x+"C"+m+" = vec4(0.);";for(x=0;x<f;x++)for(var g=0;g<v;g++){if(y+=`
          xR = xRCorner + `+x*c+`;
          xC = xCCorner + `+(m=2*g)*d+`;
        `,l===1){if(m<h&&(y+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+x+"C"+m+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    xTexelR`+x+"C"+m+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+x+"C"+m+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+x+"C"+m+" = vec4(previous.zw, xTexelR"+x+"C"+m+`.xy);
                } else {
                  xR`+x+"C"+m+" = vec4(0, 0, xTexelR"+x+"C"+m+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+x+"C"+m+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+x+"C"+m+` = vec4(0.);
                }

                xR`+x+"C"+m+" = xTexelR"+x+"C"+m+`;
              `,m+1<h)){var b=s%2==0?my(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(y+=`
                  xCOffset = xC + `+s%2+" + "+b+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+x+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(y+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+x+"C"+m+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+x+"C"+m+` = vec4(0.);
                    }
                  `),y+=`
                  xR`+x+"C"+(m+1)+` = vec4(
                    xTexelR`+x+"C"+m+".zw, xTexelR"+x+"C"+(m+2)+`.xy);
                `):y+=`
                  xCOffset = xC + `+b+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+x+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+x+"C"+(m+1)+" = xTexelR"+x+"C"+(m+2)+`;
                `}}else m<h&&(y+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(y+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+x+"C"+m+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+x+"C"+m+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+x+"C"+(m+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+x+"C"+(m+2)+` = vec4(0.);
                }

                xR`+x+"C"+m+` = vec4(
                  xTexelR`+x+"C"+m+".zw, xTexelR"+x+"C"+(m+2)+`.zw);
              `,m+1<h&&(y+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+x+"C"+(m+1)+" = vec4(xTexelR"+x+"C"+(m+2)+`.xy, final.xy);
                `)):(y+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+x+"C"+m+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+x+"C"+m+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+x+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+x+"C"+(m+2)+` = vec4(0.);
                }

                xR`+x+"C"+m+` = vec4(
                  xTexelR`+x+"C"+m+".xy, xTexelR"+x+"C"+(m+2)+`.xy);
              `,m+1<h&&(y+=`
                  xR`+x+"C"+(m+1)+` = vec4(
                    xTexelR`+x+"C"+m+".zw, xTexelR"+x+"C"+(m+2)+`.zw);
                `)),y+="}");m<h&&(y+=`
            vec4 wTexelR`+x+"C"+m+" = getW("+x+", "+m+`, d1, q);
            wR`+x+"C"+m+" = vec4(wTexelR"+x+"C"+m+".xz, wTexelR"+x+"C"+m+`.xz);
          `,m+1<h&&(y+=`
              vec4 wTexelR`+x+"C"+(m+1)+" = getW("+x+", "+(m+1)+`, d1, q);
              wR`+x+"C"+(m+1)+` =
                vec4(wTexelR`+x+"C"+(m+1)+".xz, wTexelR"+x+"C"+(m+1)+".xz);"))}for(x=0;x<f;x++)for(m=0;m<h;m++)y+="dotProd += xR"+x+"C"+m+" * wR"+x+"C"+m+";";var w="",C="";n&&(w=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`vec4 activation(vec4 x) {
          `+n+`
        }`,C="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+y+`

        vec4 result = dotProd;
        `+_+`
        `+C+`
        setOutput(result);
      }
    `},gE=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],l=t[0],c=n[0],d=n[1];this.outputShape=[l,c,d,u];var f=r==="bilinear"?1:0,h=[i-1+".0",s-1+".0"],v=h[0],y=h[1],x=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+v+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+v],m=x[0],g=x[1],b=x[2],w=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+y+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+y],C=w[0],_=w[1],E=w[2];this.userCode=`
      const float height_ratio = float(`+m+`);
      const float width_ratio = float(`+C+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+g+`;
        float width_scale = `+_+`;

        float in_y = `+b+`;
        if( in_y < 0.0 || in_y > `+v+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+E+`;
        if( in_x < 0.0 || in_x > `+y+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},yE=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+We(r)+` coords = getOutputCoords();
        int end = `+Jm(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+Jm(r,"coords")+` = idx;
          val += getX(`+function(i,s){if(i===1)return""+s;if(i===2)return s+".x, "+s+".y";if(i===3)return s+".x, "+s+".y, "+s+".z";if(i===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+i+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function Jm(e,t){if(e===1)return""+t;if(e===2)return t+".y";if(e===3)return t+".z";if(e===4)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var xE=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=qi.DENSE;var t=wi(e),n=Ot();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+So(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+n.output+` = result;
      }
    `},bE=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=qi.DENSE;var t=wi(e),n=Ot();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+So(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+n.output+` = result;
      }
    `},wE=function(){function e(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),CE=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},_E=function(e){this.variableNames=["A"],this.outTexUsage=ln.DOWNLOAD;var t=Ot();this.outputShape=e,this.userCode=`
      `+Ky+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},kE=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ln.DOWNLOAD;var t=Ot();this.outputShape=e,this.userCode=`
      `+Ky+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},EE=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=Ot(),o=t[0],a=t[1];this.outputShape=e;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      `+vh(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+i+`, 0., 0., 0.);
      }
    `},NE=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ot(),o=t[0],a=t[1];this.outputShape=e;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+e[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+e[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+vh(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+i+`

        `+r.output+" = "+s+`;
      }
    `},SE="return real * expR - imag * expI;",RE="return real * expI + imag * expR;",Zm=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},IE=function(){function e(t,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(n.valueLoc,t)}},e}(),DE=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=We(this.rank),a=function(i,s){var u=i.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],d=0;d<i.length;d++)d===s?c.push("int(getIndices("+l[d]+"))"):c.push(""+l[d]);return c.join()}(e,n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},TE=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=We(t.length),o=We(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function AE(e,t){var n=Ot();return S_(e,t,n.version+`
    precision highp float;
    `+n.attribute+` vec3 clipSpacePos;
    `+n.attribute+` vec2 uv;
    `+n.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function PE(e,t){return A_(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function FE(e,t){return P_(e,t,new Uint16Array([0,1,2,2,1,3]))}function is(e,t,n,r,o,a,i){j_(n,r);var s=F_(e,t),u=e.TEXTURE_2D;return ue(e,t,function(){return e.bindTexture(u,s)}),ue(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),ue(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),ue(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),ue(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),ue(e,t,function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)}),ue(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function jE(e,t,n,r,o){var a=bl(n,r);return is(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function ME(e,t,n,r,o){var a=bl(n,r);return is(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function OE(e,t,n,r,o){var a=bl(n,r);return is(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function LE(e,t,n,r,o){var a=as(n,r);return is(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function BE(e,t,n,r,o){var a=as(n,r);return is(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function WE(e,t,n,r){return ue(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Wm(e,t,n,"clipSpacePos",r,3,20,0)&&Wm(e,t,n,"uv",r,2,20,12)}function zE(e,t,n,r,o,a,i){var s,u,l;ue(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),ue(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),ue(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function UE(e,t,n,r){ue(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?ue(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):ue(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),ue(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function $E(e,t,n,r,o){var a=e.createBuffer();ue(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)});var i=16*n*r;return ue(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),ue(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),ue(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),a}function VE(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function HE(e,t,n,r,o){var a=bl(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return ue(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function GE(e,t,n,r,o,a,i,s){var u=e,l=new Float32Array(function(c,d){var f=as(c,d);return f[0]*f[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function qE(e,t,n,r){var o=new Float32Array(n*r*4);return ue(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var KE=function(){function e(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=H().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,C_(n,t)):this.gl=ar(n);var r="WEBGL_color_buffer_float";if(H().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Ts(this.gl,this.debug,"OES_texture_float"),_n(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Ts(this.gl,this.debug,"OES_texture_half_float");else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),_n(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Ts(this.gl,this.debug,"EXT_color_buffer_half_float");else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",_n(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!_n(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=PE(this.gl,this.debug),this.indexBuffer=FE(this.gl,this.debug),this.framebuffer=M_(this.gl,this.debug),this.textureConfig=ih(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return H().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;ue(n,this.debug,function(){return n.finish()}),ue(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),ue(n,this.debug,function(){return n.deleteFramebuffer(t.framebuffer)}),ue(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),ue(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),ue(n,this.debug,function(){return n.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(t,n){return this.throwIfDisposed(),jE(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(t,n){return this.throwIfDisposed(),ME(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(t,n){return this.throwIfDisposed(),OE(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(t,n){this.throwIfDisposed(),UE(this.gl,this.debug,t,n)},e.prototype.uploadDenseMatrixToTexture=function(t,n,r,o){this.throwIfDisposed(),zE(this.gl,this.debug,t,n,r,o,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(t,n){return this.throwIfDisposed(),BE(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(t,n){return this.throwIfDisposed(),LE(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(t){var n=this;this.throwIfDisposed(),this.outputTexture===t&&(zm(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ue(this.gl,this.debug,function(){return n.gl.deleteTexture(t)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return HE(o.gl,o.debug,n,r,o.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(t,n,r,o,a,i){return GE(this.gl,t,0,0,0,a,i,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(t,n){return VE(this.gl,t,n)},e.prototype.createBufferFromTexture=function(t,n,r){this.bindTextureToFrameBuffer(t);var o=$E(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},e.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},e.prototype.createFence=function(t){var n,r,o=this;if(H().getBool("WEBGL_FENCE_API_ENABLED")){var a=t,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var s=a.clientWaitSync(i,0,0);return s===a.ALREADY_SIGNALED||s===a.CONDITION_SATISFIED},n=i}else H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return qE(o.gl,o.debug,n,r)})},e.prototype.createProgram=function(t){this.throwIfDisposed();var n=this.gl,r=R_(n,this.debug,t),o=AE(n,this.debug),a=D_(n,this.debug);return ue(n,this.debug,function(){return n.attachShader(a,o)}),ue(n,this.debug,function(){return n.attachShader(a,r)}),T_(n,this.debug,a),this.debug&&mc(n,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=WE(n,this.debug,this.program,this.vertexBuffer)),a},e.prototype.deleteProgram=function(t){var n=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&ue(this.gl,this.debug,function(){return n.gl.deleteProgram(t)})},e.prototype.setProgram=function(t){var n=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&mc(this.gl,this.debug,this.program),ue(this.gl,this.debug,function(){return n.gl.useProgram(t)})},e.prototype.getUniformLocation=function(t,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?L_(this.gl,this.debug,t,n):B_(this.gl,t,n)},e.prototype.getAttributeLocation=function(t,n){var r=this;return this.throwIfDisposed(),ue(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,n)})},e.prototype.getUniformLocationNoThrow=function(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)},e.prototype.setInputMatrixTexture=function(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),W_(this.gl,this.debug,this.program,t,n,r)},e.prototype.setOutputMatrixTexture=function(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)},e.prototype.setOutputPackedMatrixTexture=function(t,n,r){this.throwIfDisposed();var o=as(n,r),a=o[0],i=o[1];this.setOutputMatrixTextureDriver(t,a,i)},e.prototype.setOutputMatrixWriteRegion=function(t,n,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(t,n,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&mc(this.gl,this.debug,this.program),As(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),ue(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),ue(this.gl,this.debug,function(){return t.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Ts(this.gl,this.debug,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(n.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),a=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,a),a},e.prototype.endQuery=function(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(t){return re(this,void 0,void 0,function(){var n=this;return oe(this,function(r){switch(r.label){case 0:return[4,Fm(function(){return n.disposed||n.isQueryAvailable(t,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(t,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(t,n){if(n===0)return!0;if(n===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var t=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=t;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},e.prototype.addItemToPoll=function(t,n){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||Fm(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),vc(this.gl,this.debug,t,this.framebuffer),this.debug&&As(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(vc(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&As(this.gl)):zm(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(t,n){this.bindTextureToFrameBuffer(t);var r=n();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(t,n,r){this.throwIfDisposed();var o=this.gl;vc(o,this.debug,t,this.framebuffer),this.debug&&As(o),this.outputTexture=t,ue(o,this.debug,function(){return o.viewport(0,0,n,r)}),ue(o,this.debug,function(){return o.scissor(0,0,n,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(t,n,r,o){var a=this;this.throwIfDisposed(),ue(this.gl,this.debug,function(){return a.gl.scissor(t,n,r,o)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function ev(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(n,r){var o=n.logicalShape,a=t[r],i=a.shape;if(!Ct(o,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+i+" must match");if(!n.isUniform||!a.isUniform){var s=n.texShape,u=a.isUniform?null:a.texData.texShape;if(!Ct(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var XE=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,d=n.dataFormat,f=s.left,h=s.top,v=o*r,y=Ot(),x=d==="channelsLast",m=x?0:1,g=x?1:2,b="",w=0;w<=1;w++)for(var C=0;C<=1;C++)b+=`
          blockIndex = rc.y + `+C+`;
          pos = rc.x + `+w+`;

          if(blockIndex < `+e[1]+" && pos < "+e[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+i+" - "+h+`;
            d0 = offsetY + `+c+" * (pos / "+v+`);

            if(d0 < `+t[m]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+a+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+v+".) / "+o+`.));

              if(d1 < `+t[g]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+x+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*w+C)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*w+C)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+b+`

        `+y.output+` = result;
      }
    `},YE=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+i+"; j <= "+i+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `},QE=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},JE=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+i+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+i+"; j <= "+i+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `},ZE=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},eN=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.front,d=u-1-e.padInfo.top,f=l-1-e.padInfo.left,h=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+d+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+i+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+h+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},wc=function(e,t,n,r,o,a,i){n===void 0&&(n=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),a===void 0&&(a=null),i===void 0&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",d=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",v="";a&&(h=i?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,v="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+h+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+f[0]+`);
          result += (`+d[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+y+`

        `+v+`

        setOutput(result);
      }
    `},tN=function(){function e(t,n,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(n.seedLoc,t)}},e}(),nN=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `},rN=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=Xt("rc",t),r=We(t),o=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",d=s-2;d<s;d++)c+=l[d]+" >= "+u[d],d<s-1&&(c+="||");return c}(t,e,n),a=function(s,u,l,c){if(s===1)return"";var d=c.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(t,e[e.length-1],e[e.length-2],n),i=function(s,u){var l=s.length,c=function(d,f){for(var h=[],v=0;v<=1;v++)for(var y=0;y<=1;y++){for(var x=(v===0?"r":"rp1")+", "+(y===0?"c":"cp1"),m=2;m<d;m++)x=f[f.length-1-m]+","+x;h.push(x)}return h}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(e,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+i+`));
          }
        }
      `}},oN=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(u,l){return u[0]+e[l]+u[1]});var r=e.length,o=We(r),a=t.map(function(u){return u[0]}).join(","),i=t.map(function(u,l){return u[0]+e[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+a+`);
      `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+i+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},aN=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(x,m){return x[0]+e[m]+x[1]});for(var r=e.length,o=We(r),a=t.map(function(x){return x[0]}).join(","),i=t.map(function(x,m){return x[0]+e[m]}).join(","),s=Xt("rc",r),u=Xt("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",v=0,y=r===1?2:4;v<y;v++)h+=`
        `+d[v]+`
        if (`+f+`) {
          result[`+v+"] = float("+n+`);
        } else {
          `+o+` source = rc - start;
          result[`+v+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;h+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+a+`);
      const `+o+" end = "+o+"("+i+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+h+`
        setOutput(result);
      }
    `},Cc=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var f=t==="avg",h="0.0";if(f||(h="-1.0 / 1e-20"),n)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+a+`);
        const ivec2 pads = ivec2(`+c+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var v=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(v="avgValue / count");var y=4*Math.floor(r/4),x=r%4,m=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+c+", "+d+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+i+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+y+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+m+`
          }

          int xC = xCCorner + `+y+`;
          if (`+(x===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+m+`
          } else if (`+(x===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+m+`
          } else if (`+(x===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+m+`
          }
        }
        setOutput(`+v+`);
      }
    `}},_c=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,v=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var x=t==="avg",m="0.0";if(x||(m="-1.0 / 1e-20"),n)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+a+", "+i+`);
        const ivec3 pads = ivec3(`+h+", "+v+", "+y+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var g=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(g="avgValue / count");var b=4*Math.floor(r/4),w=r%4,C=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+a+", "+i+`);
      const ivec3 pads = ivec3(`+h+", "+v+", "+y+`);
      const float initializationValue = `+m+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+m+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+b+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+C+`
            }

            int xC = xCCorner + `+b+`;
            if (`+(w===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+C+`
            } else if (`+(w===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+C+`
            } else if (`+(w===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+C+`
            }
          }
          setOutput(`+g+`);
        }
      }
    `}},iN=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",s="min"):t==="max"&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,d=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";t==="all"?(i="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(i="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var h="";o%n>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+i+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+h+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+i+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+u+`);
      }
    `},sN=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+So(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+vh(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+n+`

        setOutput(result);
      }
    `},uN=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=l[0]/c[0],f=l[1]/c[1],h=1/d,v=1/f,y=2*Math.ceil(h)+2,x=2*Math.ceil(v)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+v+`);

        const int winHeight = int(`+y+`);
        const int winWidth = int(`+x+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},lN=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},cN=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+i+`.0,
                                     `+i+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},dN=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=l[0]/c[0],f=l[1]/c[1],h=1/d,v=1/f,y=2*Math.ceil(h)+2,x=2*Math.ceil(v)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+v+`);

        const int winHeight = int(`+y+`);
        const int winWidth = int(`+x+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},fN=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},hN=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n!==1){var r=e.map(function(a,i){return function(s){return t.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(i)}).join(","),o=We(n);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `},pN=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=Xt("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=We(n);function s(u){var l=e.map(function(c,d){return function(f,h){return t.indexOf(f)!==-1&&e[f]!==1?e[f]+" - "+h[f]+" - 1":""+h[f]}(d,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=n===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+i+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+o+`){
            result.g = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+a+`) {
            result.b = `+function(u){return u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+o+`) {
              result.a = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},tv=function(e,t,n,r,o,a,i){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=We(o.length),u=We(a.length),l="";n===1?l="i":n===2&&(l="i, j");var c="getIndices("+l+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var f="getUpdates("+d+")",h=t>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+h+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},mN=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";o%n>0&&(c=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var d="";o%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},vN=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=We(n);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},gN=function(){function e(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=We(this.rank),o="uniform int start["+this.rank+"];",a=function(i){if(i===1)return"sourceLoc";if(i<=6)return kc.slice(0,i).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+i+" is not yet supported")}(this.rank);n=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(i,s){return"sourceLoc."+kc[s]+" = start["+s+"] + coords."+kc[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+n+`
        setOutput(getSource(`+a+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),kc=["x","y","z","w","u","v"],yN=function(){function e(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=We(this.rank),r=Xt("coords",this.rank),o=Xt("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",i="getChannel(getSource("+o.join()+"), "+a+")",s=`
      result.x = `+i+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+i+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+i+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+i+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+n+"("+t.map(function(c,d){return"start["+d+"]"}).join()+");":t.map(function(c,d){return o[d]+" = "+r[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+n+` coords = getOutputCoords();
        `+n+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),xN=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=We(n.length),a=We(n.length),i="";if(r===1)i="coords * strides + begin";else{var s=0;i=n.map(function(u,l){return s++,n.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+e+`);
      `+o+" strides = "+o+"("+t+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+i+`));
      }
    `},bN=function(){function e(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(t,n,r){var o,a=nv(n,r),i=rv(t,a,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}return this.numUsedTextures++,this.log(),a===sn.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):a===sn.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):a===sn.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):a===sn.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):a===sn.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),o},e.prototype.releaseTexture=function(t,n,r,o){if(this.freeTextures!=null){var a=rv(n,nv(r,o),o);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],s=i.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(s,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function nv(e,t){if(e===ln.UPLOAD)return sn.PACKED_2X2_FLOAT32;if(e===ln.RENDER||e==null)return function(n){return H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?sn.PACKED_2X2_FLOAT32:sn.UNPACKED_FLOAT32:n?sn.PACKED_2X2_FLOAT16:sn.UNPACKED_FLOAT16}(t);if(e===ln.DOWNLOAD||e===ln.PIXELS)return sn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function rv(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var wN=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=We(this.rank),a=function(i){var s=i.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+i[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<i.length;c++)l.push("imod("+u[c]+", "+i[c]+")");return l.join()}(e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},CN=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=We(this.rank),a=function(i){var s=i.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<i.length;c++)l[i[c]]=u[c];return l.join()}(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `},_N=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=We(this.rank),a=qy("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},gh=1.7580993408473768,yh=1.0507009873554805,xe=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},zn="if (isnan(x)) return x;",kN="return x;",ov="return abs(x);",Jy=zn+`
  return (x < 0.0) ? 0.0 : x;
`,Zy=zn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ex="return (x >= 0.0) ? x : (exp(x) - 1.0);",EN=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+gh+`;
  float scale = `+yh+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,av="return -x;",iv="return ceil(x);",sv="return floor(x);",uv="return exp(x);",lv="return exp(x) - 1.0;",NN=zn+`
  return sin(x);
`,SN=zn+`
  return cos(x);
`,RN=zn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,IN=zn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,DN=zn+`
  return atan(x);
`,TN=zn+"return log(x + sqrt(x * x + 1.0));",AN=zn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,PN=zn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Ms="return x;",FN="return x;",tx=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,nx=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rx=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,si=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},jN=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=Xt("rc",t),r=We(t),o=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+i+`));
      }
    `},Os={};function Ls(e,t){if(t===void 0&&(t=!1),e==="linear")return t?FN:kN;if(e==="relu")return t?tx:Jy;if(e==="elu")return t?rx:ex;if(e==="relu6")return t?nx:Zy;if(e==="prelu")return t?Qy:Yy;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var MN=600,ON=function(e){function t(n){var r,o=e.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!H().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var a=ar(H().getNumber("WEBGL_VERSION"));o.binaryCache=((r=H().getNumber("WEBGL_VERSION"))in Os||(Os[r]={}),Os[r]),o.gpgpu=new KE(a),o.canvas=a.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=n,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=n.gl.canvas;return o.textureManager=new bN(o.gpgpu),o.numMBBeforeWarning=H().global.screen==null?1024:H().global.screen.height*H().global.screen.width*window.devicePixelRatio*MN/1024/1024,o.texData=new Ly(o,j),o}return Wn(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(n,r,o){if(H().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:r,dtype:o,values:n,usage:ln.UPLOAD}),a},t.prototype.move=function(n,r,o,a){if(H().getBool("DEBUG")&&this.checkNumericalProblems(r),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:o,dtype:a,values:r,usage:ln.UPLOAD})},t.prototype.readSync=function(n){var r=this.texData.get(n),o=r.values,a=r.dtype,i=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new si(u,Ms):new xe(u,Ms);var d=this.runWebGLProgram(c,[{dataId:n,shape:u,dtype:a}],a),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(o!=null)return this.convertAndCacheOnCPU(n);if(a==="string")return o;var h,v,y=this.activeTimers!=null;return y&&(h=Kn()),a==="complex64"?v=Kd(i.real.dataSync(),i.imag.dataSync()):v=this.getValuesFromTexture(n),y&&(this.downloadWaitMs+=Kn()-h),this.convertAndCacheOnCPU(n,v)},t.prototype.read=function(n){return re(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,d,f,h,v,y,x,m,g,b,w,C,_,E,k;return oe(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(N){return r.push(N)})];if(o=this.texData.get(n),a=o.values,i=o.shape,s=o.slice,u=o.dtype,l=o.complexTensors,c=o.isPacked,s!=null)return d=void 0,d=c?new si(i,Ms):new xe(i,Ms),f=this.runWebGLProgram(d,[{dataId:n,shape:i,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(a!=null)return[2,this.convertAndCacheOnCPU(n)];if(!H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&H().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return v=null,u!=="complex64"&&H().get("WEBGL_BUFFER_SUPPORTED")&&(y=this.decode(n),x=this.texData.get(y.dataId),v=(k=this.gpgpu).createBufferFromTexture.apply(k,[x.texture].concat(wi(i)))),this.pendingRead.set(n,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return g=R.sent(),b=g[0],w=g[1],m=Kd(b,w),[3,5];case 4:v==null?m=this.getValuesFromTexture(n):(C=se(i),m=this.gpgpu.downloadFloat32MatrixFromBuffer(v,C)),R.label=5;case 5:return y!=null&&this.disposeData(y.dataId),_=this.convertAndCacheOnCPU(n,m),E=this.pendingRead.get(n),this.pendingRead.delete(n),E.forEach(function(N){return N(_)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,_]}})})},t.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var o=n[r];if(!E_(o))throw H().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(n){var r,o=this.texData.get(n),a=o.shape,i=o.dtype,s=o.isPacked,u=se(a);if(H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(n),c=this.texData.get(l.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(wi(a))).subarray(0,u);return this.disposeData(l.dataId),d}var f=H().getBool("WEBGL_PACK")&&s===!0,h=f?gc(a):a,v=f?new kE(h):new _E(h),y=this.runWebGLProgram(v,[{shape:h,dtype:i,dataId:n}],"float32"),x=this.texData.get(y.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(x.texture,x.texShape[0],x.texShape[1]).subarray(0,u);return this.disposeData(y.dataId),m},t.prototype.time=function(n){return re(this,void 0,void 0,function(){var r,o,a,i,s,u,l;return oe(this,function(c){switch(c.label){case 0:return r=this.activeTimers,o=[],a=!1,this.programTimersStack==null?(this.programTimersStack=o,a=!0):this.activeTimers.push(o),this.activeTimers=o,n(),i=Ma(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),s=Ma(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=r,a&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return l=c.sent(),u.kernelMs=a_(l),u.getExtraProfileInfo=function(){return l.map(function(d,f){return{name:s[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Kn(),endMs:null}},t.prototype.endTimer=function(n){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=Kn(),n)},t.prototype.getQueryTime=function(n){return re(this,void 0,void 0,function(){var r;return oe(this,function(o){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},t.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},t.prototype.releaseGPUData=function(n){var r=this.texData.get(n),o=r.texture,a=r.dtype,i=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||n,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),o!=null&&(this.numBytesInGPU-=this.computeBytes(i,a),this.textureManager.releaseTexture(o,i,s,u)));var f=this.texData.get(n);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},t.prototype.getDataInfo=function(n){return this.texData.get(n)},t.prototype.getCPUBackend=function(){return H().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=j.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(n,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(a){return o.texData.get(a.dataId).texture==null&&a.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(n,r){var o=this.makeOutput(n.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:j.keep(n.clone()),imag:j.keep(r.clone())},o},t.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,o){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,o);if(se(o)===0)return Rt([],o,n.dtype);var a=this.texData.get(n.dataId).isPacked,i=My(n.shape,r,o);if(a||!i){var s=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yN(o):new gN(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[n],null,u)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,o)},t.prototype.shallowSlice=function(n,r,o){var a=this.texData.get(n.dataId),i=this.makeOutput(o,n.dtype),s=this.texData.get(i.dataId);Object.assign(s,a),s.shape=o,s.dtype=n.dtype;var u=Oy(r,n.strides);a.slice&&(u+=a.slice.flatOffset),s.slice={flatOffset:u,origDataId:a.slice&&a.slice.origDataId||n.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),i},t.prototype.stridedSlice=function(n,r,o,a){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,o,a);var i=dh(r,o,a);if(i.some(function(u){return u===0}))return Rt([],i);var s=new xN(r,a,i);return this.compileAndRun(s,[n])},t.prototype.reverse=function(n,r){var o=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pN(n.shape,r):new hN(n.shape,r);return this.compileAndRun(o,[n])},t.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var o=n.map(function(h){return wn(h)}),a=n.map(function(h){return Qn(h)});return Nt(this.concat(o,r),this.concat(a,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>H().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(n.length/2),s=this.concat(n.slice(0,i),r),u=this.concat(n.slice(i),r);return this.concat([s,u],r)}if(H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var l=new lE(n.map(function(h){return h.shape}),r);return this.compileAndRun(l,n)}var c=La(n.map(function(h){return h.shape}),r),d=n.map(function(h){return h.as2D(-1,se(h.shape.slice(r)))}),f=new uE(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(c)},t.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,av,n.dtype);var r=new xe(n.shape,av);return this.compileAndRun(r,[n])},t.prototype.batchMatMul=function(n,r,o,a){var i=o?n.shape[2]:n.shape[1],s=a?r.shape[1]:r.shape[2],u=o?n.shape[1]:n.shape[2],l=n.shape[0];if((i===1||s===1)&&u>1e3){o&&(n=n.transpose([0,2,1])),a&&(r=r.transpose([0,2,1]));var c=s===1?n:n.as3D(l,u,1),d=s===1?2:1,f=s===1?r.as3D(l,1,u):r;return this.multiply(c,f).sum(d,!0)}var h=St(n.dtype,r.dtype),v=new wc(n.shape,[l,i,s],o,a);return this.compileAndRun(v,[n,r],h)},t.prototype.fusedBatchMatMul=function(n){var r=n.a,o=n.b,a=n.transposeA,i=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=a?r.shape[2]:r.shape[1],d=i?o.shape[1]:o.shape[2],f=r.shape[0],h=St(r.dtype,o.dtype),v=s!=null,y=l!=null,x=u?Ls(u,!0):null,m=new wc(r.shape,[f,c,d],a,i,v,x,y),g=[r,o];return s&&g.push(s),l&&g.push(l),this.compileAndRun(m,g,h)},t.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var o=this.texData.get(n.dataId),a=this.texData.get(r.dataId),i=new qm(rE,n.shape,r.shape),s=new qm(oE,n.shape,r.shape),u=[this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,a.complexTensors.real),this.makeComplexComponentTensorInfo(r,a.complexTensors.imag)],l=this.compileAndRun(i,u),c=this.compileAndRun(s,u),d=this.complex(l,c);return l.dispose(),c.dispose(),d}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Km,n.dtype);var f=new Je(Km,n.shape,r.shape);return this.compileAndRun(f,[n,r],n.dtype)},t.prototype.batchNormalization=function(n,r,o,a,i,s){var u=[n,r,o],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(i!=null&&(c=i.shape,u.push(i)),H().getBool("WEBGL_PACK_NORMALIZATION")){var d=new nE(n.shape,r.shape,o.shape,l,c,a);return this.compileAndRun(d,u)}var f=new tE(n.shape,r.shape,o.shape,l,c,a);return this.compileAndRun(f,u)},t.prototype.localResponseNormalization4D=function(n,r,o,a,i){var s=H().getBool("WEBGL_PACK_NORMALIZATION")?new JE(n.shape,r,o,a,i):new YE(n.shape,r,o,a,i);return this.compileAndRun(s,[n])},t.prototype.LRNGrad=function(n,r,o,a,i,s,u){var l=new QE(r.shape,a,i,s,u);return this.compileAndRun(l,[r,o,n])},t.prototype.tile=function(n,r){if(n.dtype==="string"){var o=this.readSync(n.dataId).map(function(i){return ju(i)});return Hy(ve(n.shape,n.dtype,o),r)}var a=new wN(n.shape,r);return this.compileAndRun(a,[n])},t.prototype.pad=function(n,r,o){var a=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aN(n.shape,r,o):new oN(n.shape,r,o);return this.compileAndRun(a,[n])},t.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var o=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _N(n.shape,r):new CN(n.shape,r);return this.compileAndRun(o,[n])},t.prototype.gather=function(n,r,o){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,o);var a=new DE(n.shape,r.size,o);return this.compileAndRun(a,[n,r])},t.prototype.batchToSpaceND=function(n,r,o){I(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=r.reduce(function(d,f){return d*f}),i=zu(n.shape,r,a),s=Uu(i.length,r.length),u=$u(n.shape,r,a),l=Ay(o,r.length),c=Py(u,o,r.length);return n.reshape(i).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(n,r,o){I(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=r.reduce(function(f,h){return f*h}),i=[[0,0]];i.push.apply(i,o);for(var s=1+r.length;s<n.shape.length;++s)i.push([0,0]);var u=n.pad(i),l=zu(u.shape,r,a,!1),c=Uu(l.length,r.length,!1),d=$u(u.shape,r,a,!1);return u.reshape(l).transpose(c).reshape(d)},t.prototype.reduce=function(n,r,o){var a=n.shape[0],i=n.shape[1],s=yc(i),u=new iN({windowSize:s,inSize:i,batchSize:a},r),l=this.compileAndRun(u,[n],o);return l.shape[1]===1?l:this.reduce(l,r,o)},t.prototype.argReduce=function(n,r,o){o===void 0&&(o=null);var a=n.shape[0],i=n.shape[1];o!=null&&(a=o.shape[0],i=o.shape[1]);var s=yc(i),u=new Gk({windowSize:s,inSize:i,batchSize:a},r,o==null),l=[n];o!=null&&l.push(o);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(n,r,c)},t.prototype.argReducePacked=function(n,r,o){o===void 0&&(o=null);var a=o!=null?o.shape:n.shape,i=yc(a[a.length-1]),s=new Jk(a,i,r,o==null),u=o==null?[n]:[n,o],l=this.compileAndRun(s,u,"int32");return l.rank===n.rank?this.argReducePacked(n,r,l):l},t.prototype.sum=function(n,r){an("sum",r,n.rank);var o=Ft(n.shape,r),a=o[0],i=se(o[1]),s=n.as2D(-1,i),u=cc(n.dtype);return this.reduce(s,"sum",u).reshape(a)},t.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var o=Ft(n.shape,r),a=o[0],i=se(o[1]),s=n.as2D(-1,i),u=cc(n.dtype);return this.reduce(s,"prod",u).reshape(a)},t.prototype.unsortedSegmentSum=function(n,r,o){var a=0,i=ir([a],n.rank),s=n;i!=null&&(s=n.transpose(i),a=sr(1,n.rank)[0]);var u=function(h,v,y){for(var x=[],m=h.length,g=0;g<m;g++)g!==v?x.push(h[g]):x.push(y);return x}(s.shape,a,o),l=se([s.shape[a]]),c=s.as2D(-1,l),d=cc(n.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",r,d,o).reshape(u);return i!=null&&(f=f.transpose(sh(i))),f},t.prototype.segOpCompute=function(n,r,o,a,i){var s=n.shape[0],u=n.shape[1],l=function(f,h){var v,y=!1;for(f<=jy?(v=f,y=!0):v=Bd(f,Math.floor(Math.sqrt(f)));!y;)v>h||v===f?y=!0:v=Bd(f,v+1);return v}(u,i),c=new mN({windowSize:l,inSize:u,batchSize:s,numSegments:i}),d=this.compileAndRun(c,[n,o],a);return d.shape[1]===i?d:(o=Wu(0,i).tile([u/l]),this.segOpCompute(d,r,o,a,i))},t.prototype.argMinMaxReduce=function(n,r,o){var a=[r];if(an("arg"+o.charAt(0).toUpperCase()+o.slice(1),a,n.rank),!H().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var i=Ft(n.shape,a),s=i[0],u=se(i[1]),l=n.as2D(-1,u);return this.argReduce(l,o).reshape(s)}return this.argReducePacked(n,o)},t.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},t.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},t.prototype.cumsum=function(n,r,o,a){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var i=new yE(n.shape,o,a);return this.compileAndRun(i,[n])},t.prototype.equal=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(equal(a, b));
`,"bool");var o=new Je("return float(a == b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.notEqual=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new Je("return float(a != b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new Je("return float(a < b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.lessEqual=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new Je("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new Je("return float(a > b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.greaterEqual=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new Je("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.logicalNot=function(n){var r=new xe(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},t.prototype.logicalAnd=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new Je("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.logicalOr=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new Je("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.select=function(n,r,o){var a=new vN(n.rank,r.shape,r.rank);return this.compileAndRun(a,[n,r,o],St(r.dtype,o.dtype))},t.prototype.where=function(n){Lu("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return mh(n.shape,r)},t.prototype.topk=function(n,r,o){return Gy(n.dataSync(),n.shape,n.dtype,r)},t.prototype.min=function(n,r){an("min",r,n.rank);var o=Ft(n.shape,r),a=o[0],i=se(o[1]),s=n.as2D(-1,i);return this.reduce(s,"min",s.dtype).reshape(a)},t.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Je(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.mod=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Je(`if (b == 0.0) return NAN;
  return mod(a, b);`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);an("max",r,n.rank);var o=Ft(n.shape,r),a=o[0],i=se(o[1]),s=n.as2D(-1,i);return this.reduce(s,"max",s.dtype).reshape(a)},t.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Je(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.all=function(n,r){an("all",r,n.rank);var o=Ft(n.shape,r),a=o[0],i=se(o[1]),s=n.as2D(-1,i);return this.reduce(s,"all",s.dtype).reshape(a)},t.prototype.any=function(n,r){an("any",r,n.rank);var o=Ft(n.shape,r),a=o[0],i=se(o[1]),s=n.as2D(-1,i);return this.reduce(s,"any",s.dtype).reshape(a)},t.prototype.realDivide=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new Je(`
if (a == b) {
  return 1.0;
};
return a / b;`,n.shape,r.shape);return this.compileAndRun(o,[n,r],"float32")},t.prototype.floorDiv=function(n,r){if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new Je(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,n.shape,r.shape);return this.compileAndRun(o,[n,r],"int32")},t.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,xc);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var o=St(n.dtype,r.dtype);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,xc,o);var a=new Je(xc,n.shape,r.shape);return this.compileAndRun(a,[n,r],o)},t.prototype.packedUnaryOp=function(n,r,o){var a=new si(n.shape,r);return this.compileAndRun(a,[n],o)},t.prototype.packedBinaryOp=function(n,r,o,a,i){i===void 0&&(i=!1);var s=new cr(o,n.shape,r.shape,i);return this.compileAndRun(s,[n,r],a)},t.prototype.complexSeparableBinaryOp=function(n,r,o){var a=this,i=this.texData.get(n.dataId),s=this.texData.get(r.dataId),u=[[i.complexTensors.real,s.complexTensors.real],[i.complexTensors.imag,s.complexTensors.imag]].map(function(f){var h=f[0],v=f[1],y=a.makeComplexComponentTensorInfo(n,h),x=a.makeComplexComponentTensorInfo(r,v),m=new Je(o,n.shape,r.shape);return a.compileAndRun(m,[y,x],St(h.dtype,v.dtype))}),l=u[0],c=u[1],d=this.complex(l,c);return l.dispose(),c.dispose(),d},t.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},t.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>H().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),o=this.addN(n.slice(0,r)),a=this.addN(n.slice(r));return this.addN([o,a])}var i=n.map(function(l){return l.dtype}).reduce(function(l,c){return St(l,c)}),s=n.map(function(l){return l.shape}),u=H().getBool("WEBGL_PACK")?new Hk(n[0].shape,s):new Vk(n[0].shape,s);return this.compileAndRun(u,n,i)},t.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,bc);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var o=St(n.dtype,r.dtype);if(H().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,bc,n.dtype);var a=new Je(bc,n.shape,r.shape);return this.compileAndRun(a,[n,r],o)},t.prototype.pow=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Je(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n.shape,r.shape),a=St(n.dtype,r.dtype);return this.compileAndRun(o,[n,r],a)},t.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,iv,n.dtype);var r=new xe(n.shape,iv);return this.compileAndRun(r,[n])},t.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,sv,n.dtype);var r=new xe(n.shape,sv);return this.compileAndRun(r,[n])},t.prototype.sign=function(n){var r=new xe(n.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[n])},t.prototype.isNaN=function(n){var r=new xe(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isInf=function(n){var r=new xe(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isFinite=function(n){var r=new xe(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.round=function(n){var r=new xe(n.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[n])},t.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,uv,n.dtype);var r=new xe(n.shape,uv);return this.compileAndRun(r,[n])},t.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,lv,n.dtype);var r=new xe(n.shape,lv);return this.compileAndRun(r,[n])},t.prototype.softmax=function(n,r){var o=yt([r],n.shape),a=this.max(n,o),i=tn(a.shape,o),s=this.subtract(n,a.reshape(i)),u=this.exp(s),l=this.sum(u,o).reshape(i);return this.realDivide(u,l)},t.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,n.dtype);var r=new xe(n.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[n])},t.prototype.log1p=function(n){var r=new xe(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},t.prototype.sqrt=function(n){var r=new xe(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},t.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new xe(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},t.prototype.reciprocal=function(n){var r=new xe(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},t.prototype.relu=function(n){var r;return r=H().getBool("WEBGL_PACK")?new si(n.shape,tx):new xe(n.shape,Jy),this.compileAndRun(r,[n])},t.prototype.relu6=function(n){var r;return r=H().getBool("WEBGL_PACK")?new si(n.shape,nx):new xe(n.shape,Zy),this.compileAndRun(r,[n])},t.prototype.prelu=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cr(Qy,n.shape,r.shape):new Je(Yy,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.elu=function(n){if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,rx,n.dtype);var r=new xe(n.shape,ex);return this.compileAndRun(r,[n])},t.prototype.eluDer=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,n.shape,r.shape):new Je("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.selu=function(n){var r=new xe(n.shape,EN);return this.compileAndRun(r,[n])},t.prototype.int=function(n){var r=new xe(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},t.prototype.clip=function(n,r,o){var a,i=(a=H().getBool("WEBGL_PACK_CLIP")?new iE(n.shape):new aE(n.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(a,[n],null,i)},t.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,ov,n.dtype);var r=new xe(n.shape,ov);return this.compileAndRun(r,[n])},t.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),o=new sE(n.shape),a=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(o,a)},t.prototype.sigmoid=function(n){var r=new xe(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},t.prototype.softplus=function(n){var r=new xe(n.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[n])},t.prototype.sin=function(n){var r=new xe(n.shape,NN);return this.compileAndRun(r,[n])},t.prototype.cos=function(n){var r=new xe(n.shape,SN);return this.compileAndRun(r,[n])},t.prototype.tan=function(n){var r=new xe(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},t.prototype.asin=function(n){var r=new xe(n.shape,RN);return this.compileAndRun(r,[n])},t.prototype.acos=function(n){var r=new xe(n.shape,IN);return this.compileAndRun(r,[n])},t.prototype.atan=function(n){var r=new xe(n.shape,DN);return this.compileAndRun(r,[n])},t.prototype.atan2=function(n,r){var o=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new Je(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.sinh=function(n){var r=new xe(n.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.cosh=function(n){var r=new xe(n.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.tanh=function(n){var r=new xe(n.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[n])},t.prototype.asinh=function(n){var r=new xe(n.shape,TN);return this.compileAndRun(r,[n])},t.prototype.acosh=function(n){var r=new xe(n.shape,AN);return this.compileAndRun(r,[n])},t.prototype.atanh=function(n){var r=new xe(n.shape,PN);return this.compileAndRun(r,[n])},t.prototype.erf=function(n){var r=new xe(n.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[n])},t.prototype.step=function(n,r){var o=new xe(n.shape,function(a){return a===void 0&&(a=0),zn+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `}(r));return this.compileAndRun(o,[n])},t.prototype.conv2dByMatMul=function(n,r,o,a,i,s){var u=n.shape,l=this.texData.get(n.dataId),c=o.inChannels,d=u[0]*u[1]*u[2],f=o.outChannels,h=o.dataFormat==="channelsLast",v=(d===1||f===1)&&c>1e3,y=u[2]%2!=0&&!!l.isPacked;if(v||!H().getBool("WEBGL_LAZILY_UNPACK")||!H().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!y){var x=h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],m=this.reshape(n,[1,x,o.inChannels]),g=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:s}),o.outShape)}var b=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),w={dataId:n.dataId,shape:[1,b,o.inChannels],dtype:n.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,I(Fs(l.shape,w.shape),function(){return"packed reshape "+l.shape+" to "+w.shape+" isn't free"});var _=this.reshape(r,[1,o.inChannels,o.outChannels]),E=this.fusedBatchMatMul({a:w,b:_,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:s}),k=this.texData.get(E.dataId);return I(k.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=C,k.shape=o.outShape,j.makeTensorFromDataId(E.dataId,o.outShape,E.dtype)},t.prototype.conv2dWithIm2Row=function(n,r,o,a,i,s){var u=o.filterWidth,l=o.filterHeight,c=o.inChannels,d=o.outWidth,f=o.outHeight,h=o.dataFormat==="channelsLast",v=u*l*c,y=f*d,x=[v,y],m=n.squeeze([0]),g=r.reshape([1,v,-1]),b=new XE(x,m.shape,o),w=this.compileAndRun(b,[m]).reshape([1,x[0],x[1]]),C=a!=null,_=s!=null,E=i?Ls(i,!0):null,k=new wc(w.shape,[1,y,o.outChannels],!0,!1,C,E,_),R=[w,g];a&&R.push(a),_&&R.push(s);var N=this.compileAndRun(k,R);return h?N.reshape([1,f,d,o.outChannels]):N.reshape([1,o.outChannels,f,d])},t.prototype.fusedConv2d=function(n){var r=n.input,o=n.filter,a=n.convInfo,i=n.bias,s=n.activation,u=n.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,a,i,s,u);if(H().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,a,i,s,u);var l=i!=null,c=u!=null,d=s?Ls(s,!1):null,f=new Xm(a,l,d,c),h=[r,o];return i&&h.push(i),u&&h.push(u),this.compileAndRun(f,h)},t.prototype.conv2d=function(n,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,o);if(H().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,o);var a=new Xm(o);return this.compileAndRun(a,[n,r])},t.prototype.conv2dDerInput=function(n,r,o){var a=new dE(o);return this.compileAndRun(a,[n,r])},t.prototype.conv2dDerFilter=function(n,r,o){var a=new cE(o);return this.compileAndRun(a,[n,r])},t.prototype.fusedDepthwiseConv2D=function(n){var r,o=n.input,a=n.filter,i=n.convInfo,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=H().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,d=u?Ls(u,c):null,f=[o,a],h=s!=null,v=l!=null;return h&&f.push(s),v&&f.push(l),c?(r=new Qm(i,h,d,v),this.compileAndRun(r,f)):(r=new Ym(i,h,d,v),this.compileAndRun(r,f))},t.prototype.depthwiseConv2D=function(n,r,o){var a;return H().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(a=new Qm(o),this.compileAndRun(a,[n,r])):(a=new Ym(o),this.compileAndRun(a,[n,r]))},t.prototype.depthwiseConv2DDerInput=function(n,r,o){var a=new mE(o);return this.compileAndRun(a,[n,r])},t.prototype.depthwiseConv2DDerFilter=function(n,r,o){var a=new pE(o);return this.compileAndRun(a,[n,r])},t.prototype.conv3d=function(n,r,o){var a=new vE(o);return this.compileAndRun(a,[n,r])},t.prototype.conv3dDerInput=function(n,r,o){var a=new hE(o);return this.compileAndRun(a,[n,r])},t.prototype.conv3dDerFilter=function(n,r,o){var a=new fE(o);return this.compileAndRun(a,[n,r])},t.prototype.maxPool=function(n,r){var o=new Cc(r,"max",!1);return this.compileAndRun(o,[n])},t.prototype.avgPool=function(n,r){var o=new Cc(r,"avg",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.maxPoolBackprop=function(n,r,o,a){var i=new Cc(a,"max",!0),s=this.compileAndRun(i,[r]),u=new ZE(a),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},t.prototype.avgPoolBackprop=function(n,r,o){var a=new Zk(o);return this.compileAndRun(a,[n],r.dtype)},t.prototype.cast=function(n,r){return zy(n,r,this)},t.prototype.unstack=function(n,r){for(var o=n.shape[r],a=new Array(n.rank-1),i=0,s=0;s<n.rank;s++)s!==r&&(a[i++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(a);return c},t.prototype.avgPool3d=function(n,r){var o=new _c(r,"avg",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.avgPool3dBackprop=function(n,r,o){var a=new eE(o);return this.compileAndRun(a,[n],r.dtype)},t.prototype.maxPool3d=function(n,r){var o=new _c(r,"max",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.maxPool3dBackprop=function(n,r,o,a){var i=new _c(a,"max",!0),s=this.compileAndRun(i,[r]),u=new eN(a),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},t.prototype.reshape=function(n,r){var o=this.texData.get(n.dataId);if(o.isPacked&&!Fs(n.shape,r)&&(o.texture===null||!Fs(o.shape,r))){var a=this.packedReshape(n,r);return j.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return qd(n,r)},t.prototype.resizeBilinear=function(n,r,o,a){var i=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new cN(n.shape,r,o,a):new lN(n.shape,r,o,a);return this.compileAndRun(i,[n],"float32")},t.prototype.resizeBilinearBackprop=function(n,r,o){var a=new uN(n,r,o);return this.compileAndRun(a,[n])},t.prototype.resizeNearestNeighbor=function(n,r,o,a){var i=new fN(n.shape,r,o,a);return this.compileAndRun(i,[n])},t.prototype.resizeNearestNeighborBackprop=function(n,r,o){var a=new dN(n,r,o);return this.compileAndRun(a,[n])},t.prototype.multinomial=function(n,r,o,a){var i=r?n:_r(n),s=i.shape[0],u=i.shape[1],l=new tN(s,u,o),c=l.getCustomSetupFunc(a);return this.compileAndRun(l,[i],"int32",c)},t.prototype.oneHot=function(n,r,o,a){var i=new nN(n.size,r,o,a);return this.compileAndRun(i,[n])},t.prototype.diag=function(n){var r=new CE(n.size);return this.compileAndRun(r,[n])},t.prototype.nonMaxSuppression=function(n,r,o,a,i){return Lu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),hh(n.dataSync(),r.dataSync(),o,a,i)},t.prototype.cropAndResize=function(n,r,o,a,i,s){var u=new gE(n.shape,r.shape,a,i,s);return this.compileAndRun(u,[n,r,o],"float32")},t.prototype.depthToSpace=function(n,r,o){I(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var a=n.shape[0],i=o==="NHWC"?n.shape[1]:n.shape[2],s=o==="NHWC"?n.shape[2]:n.shape[3],u=o==="NHWC"?n.shape[3]:n.shape[1],l=i*r,c=s*r,d=u/(r*r),f=new wE(o==="NHWC"?[a,l,c,d]:[a,d,l,c],r,o);return this.compileAndRun(f,[n])},t.prototype.split=function(n,r,o){return Vy(n,r,o)},t.prototype.scatterND=function(n,r,o){var a=Vu(0,n,o),i=a.sliceRank,s=a.numUpdates,u=a.sliceSize,l=a.strides,c=a.outputSize,d=[c/u,u],f=n.reshape([s,i]),h=r.reshape([s,u]);if(c===0)return qd(Rt([]),o);var v=J(0),y=new tv(s,i,f.rank,h.rank,l,d);return this.compileAndRun(y,[h,f,v]).reshape(o)},t.prototype.sparseToDense=function(n,r,o,a){var i=Vu(0,n,o),s=i.sliceRank,u=i.numUpdates,l=i.strides,c=i.outputSize,d=new tv(u,s,n.rank,r.rank,l,[c,1]);return this.compileAndRun(d,[r,n,a]).reshape(o)},t.prototype.fft=function(n){return this.fftImpl(n,!1)},t.prototype.ifft=function(n){return this.fftImpl(n,!0)},t.prototype.fftImpl=function(n,r){var o=this.texData.get(n.dataId),a=new Zm(SE,n.shape,r),i=new Zm(RE,n.shape,r),s=[this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag)],u=this.compileAndRun(a,s),l=this.compileAndRun(i,s),c=this.complex(u,l).as2D(n.shape[0],n.shape[1]);return u.dispose(),l.dispose(),c},t.prototype.gatherND=function(n,r){var o=r.shape,a=o[o.length-1],i=Fy(n,r),s=i[0],u=i[1],l=i[2],c=i[3],d=r.reshape([u,a]),f=n.reshape([n.size/l,l]),h=new TE(a,c,[u,l]);return this.compileAndRun(h,[f,d]).reshape(s)},t.prototype.fill=function(n,r,o){if((o=o||rs(r))==="string"){var a=Fu(o,se(n));return a.fill(r),j.makeTensor(a,n,o,this)}var i=new IE(n,r),s=i.getCustomSetupFunc(r);return this.compileAndRun(i,[],o,s)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},t.prototype.linspace=function(n,r,o){return Uy(n,r,o)},t.prototype.makeTensorInfo=function(n,r){var o=this.write(null,n,r);return this.texData.get(o).usage=null,{dataId:o,shape:n,dtype:r}},t.prototype.makeOutput=function(n,r){var o=this.makeTensorInfo(n,r).dataId;return j.makeTensorFromDataId(o,n,r,this)},t.prototype.unpackTensor=function(n){var r=new jN(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},t.prototype.packTensor=function(n){var r=new rN(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},t.prototype.packedReshape=function(n,r){var o=[Mu(n.shape)].concat(Ou(n.shape)),a={dtype:n.dtype,shape:o,dataId:n.dataId},i=[Mu(r)].concat(Ou(r)),s=new sN(i,o),u=this.runWebGLProgram(s,[a],n.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},t.prototype.decode=function(n){var r,o=this.texData.get(n),a=o.isPacked,i=o.shape,s=o.dtype,u=gc(i);return r=a?new bE(u):new xE(u),{dtype:s,shape:i,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:n}],s,null,!0).dataId}},t.prototype.runWebGLProgram=function(n,r,o,a,i){var s=this;i===void 0&&(i=!1);var u=this.makeTensorInfo(n.outputShape,o),l=this.texData.get(u.dataId);if(n.packedOutput&&(l.isPacked=!0),n.outPackingScheme===qi.DENSE){var c=wi(n.outputShape);l.texShape=c.map(function(b){return 2*b})}if(n.outTexUsage!=null&&(l.usage=n.outTexUsage),se(u.shape)===0)return l.values=Hi(u.dtype,0),u;var d=[],f=r.map(function(b){if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=s.texData.get(b.dataId);if(w.texture==null){if(!n.packedInputs&&se(b.shape)<=H().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:w.values};n.packedInputs&&(w.isPacked=!0,w.shape=b.shape)}else if(!!w.isPacked!=!!n.packedInputs)b=w.isPacked?s.unpackTensor(b):s.packTensor(b),d.push(b),w=s.texData.get(b.dataId);else if(w.isPacked&&!Fs(w.shape,b.shape)){var C=b,_=b.shape;b.shape=w.shape,b=s.packedReshape(b,_),d.push(b),w=s.texData.get(b.dataId),C.shape=_}return s.uploadToGPU(b.dataId),{shape:b.shape,texData:w,isUniform:!1}});this.uploadToGPU(u.dataId);var h,v={shape:u.shape,texData:l,isUniform:!1},y=function(b,w,C){var _="";w.concat(C).forEach(function(R){var N=R.texData!=null&&R.texData.slice!=null&&R.texData.slice.flatOffset>0,P=R.isUniform?"uniform":R.texData.texShape;_+=R.shape+"_"+P+"_"+N});var E=b.userCode,k=b.constructor.name;return k+="_"+_+"_"+E}(n,f,v),x=this.getAndSaveBinary(y,function(){return function(b,w,C,_){var E=w.userCode,k=C.map(function(F,O){var L={logicalShape:F.shape,texShape:F.isUniform?null:F.texData.texShape,isUniform:F.isUniform,isPacked:!F.isUniform&&F.texData.isPacked,flatOffset:null};return F.texData!=null&&F.texData.slice!=null&&F.texData.slice.flatOffset>0&&(L.flatOffset=F.texData.slice.flatOffset),{name:w.variableNames[O],shapeInfo:L}}),R=k.map(function(F){return F.shapeInfo}),N={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},P=qk(k,N,E,w.packedInputs),T=b.createProgram(P),D=null,B=b.getUniformLocation(T,"NAN",!1);H().getNumber("WEBGL_VERSION")===1&&(D=b.getUniformLocation(T,"INFINITY",!1));for(var W={},U=0;U<w.variableNames.length;U++){var $=w.variableNames[U];W[$]=b.getUniformLocation(T,$,!1),W["offset"+$]=b.getUniformLocation(T,"offset"+$,!1)}return{program:w,source:P,webGLProgram:T,uniformLocations:W,inShapeInfos:R,outShapeInfo:N,infLoc:D,nanLoc:B}}(s.gpgpu,n,f,v)}),m=this.activeTimers!=null;if(m&&(h=this.startTimer()),function(b,w,C,_,E){ev(w.inShapeInfos,C),ev([w.outShapeInfo],[_]);var k=_.texData.texture,R=_.texData.texShape;_.texData.isPacked?b.setOutputPackedMatrixTexture(k,R[0],R[1]):b.setOutputMatrixTexture(k,R[0],R[1]),b.setProgram(w.webGLProgram),H().getNumber("WEBGL_VERSION")===1&&w.infLoc!==null&&b.gl.uniform1f(w.infLoc,1/0),w.nanLoc!==null&&b.gl.uniform1f(w.nanLoc,NaN),C.forEach(function(N,P){var T=w.program.variableNames[P],D=w.uniformLocations[T],B=w.uniformLocations["offset"+T];if(D!=null)if(N.isUniform)if(se(N.shape)<2)b.gl.uniform1f(D,N.uniformValues[0]);else{var W=N.uniformValues;W instanceof Float32Array||(W=new Float32Array(W)),b.gl.uniform1fv(D,W)}else N.texData.slice!=null&&B!=null&&b.gl.uniform1i(B,N.texData.slice.flatOffset),b.setInputMatrixTexture(N.texData.texture,D,P)}),E!=null&&E(b,w.webGLProgram),b.executeProgram()}(this.gpgpu,x,f,v,a),d.forEach(function(b){return s.disposeData(b.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(h)})),!H().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){var g=this.unpackTensor(u);return this.disposeData(u.dataId),g}return u},t.prototype.compileAndRun=function(n,r,o,a,i){i===void 0&&(i=!1),o=o||r[0].dtype;var s=this.runWebGLProgram(n,r,o,a,i);return j.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},t.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var n=this;this.disposed||(H().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ee(function(){if(!H().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=H().getBool("DEBUG");H().set("DEBUG",!1);var o=n.abs(J(1e-8)).dataSync()[0];if(H().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(n){var r,o=this.texData.get(n),a=o.shape,i=o.dtype,s=o.values,u=o.texture,l=o.usage,c=o.isPacked;if(u==null){var d,f=this.activeTimers!=null;f&&(d=Kn());var h=o.texShape;if(h==null&&(h=$_(a,c),o.texShape=h),s!=null){var v=gc(a),y=void 0,x=h[1],m=h[0],g=s instanceof Uint8Array;c?(x=(r=as(h[0],h[1]))[0],m=r[1],y=new NE(v,[m,x],g)):y=new EE(v,[m,x],g);var b=this.makeTensorInfo([m,x],i);this.texData.get(b.dataId).usage=g?ln.PIXELS:ln.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),x,m,s);var w=this.runWebGLProgram(y,[b],i,null,!0),C=this.texData.get(w.dataId);o.texture=C.texture,o.texShape=C.texShape,o.isPacked=C.isPacked,o.usage=C.usage,this.disposeData(b.dataId),this.texData.delete(w.dataId),o.values=null,f&&(this.uploadWaitMs+=Kn()-d)}else{var _=this.acquireTexture(h,l,i,c);o.texture=_}}},t.prototype.convertAndCacheOnCPU=function(n,r){var o=this.texData.get(n),a=o.dtype;return this.releaseGPUData(n),r!=null&&(o.values=function(i,s){if(s==="float32"||s==="complex64")return i;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(i.length):new Uint8Array(i.length),l=0;l<u.length;++l)u[l]=Math.round(i[l]);return u}throw new Error("Unknown dtype "+s)}(r,a)),o.values},t.prototype.acquireTexture=function(n,r,o,a){if(this.numBytesInGPU+=this.computeBytes(n,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,a)},t.prototype.computeBytes=function(n,r){return n[0]*n[1]*vy(r)},t}(By);_y()&&j.registerBackend("webgl",function(){return new ON},2);var LN=A({square_:function(e){var t=S(e,"x","square"),n=[t];return j.runKernelFunc(function(r,o){return o([t]),r.square(t)},{x:t},null,"Square",{},n,[])}}),Xi="SquaredDifference",ox=A({squaredDifference_:function(e,t){var n,r=S(e,"a","squaredDifference"),o=S(t,"b","squaredDifference");n=Qe(r,o),r=n[0],o=n[1],Ce(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return j.runKernelFunc(function(s,u){var l=s.squaredDifference(r,o);return u([r,o]),l},a,function(s,u){var l=u[0],c=u[1],d=J(2);return{a:function(){return s.mul(l.sub(c).mul(d))},b:function(){return s.mul(c.sub(l).mul(d))}}},Xi,{},i,[])}}),BN=A({abs_:function(e){var t=S(e,"x","abs");return t.dtype==="complex64"?j.runKernelFunc(function(n){return n.complexAbs(t)},{$x:t}):j.runKernelFunc(function(n,r){var o=n.abs(t);return r([t]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mul(o.toFloat().step(-1))}}},"Abs")}}),WN=A({acos_:function(e){var t=S(e,"x","acos");return j.runKernelFunc(function(n,r){var o=n.acos(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(J(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),zN=A({acosh_:function(e){var t=S(e,"x","acosh");return j.runKernelFunc(function(n,r){var o=n.acosh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),UN=A({asin_:function(e){var t=S(e,"x","asin");return j.runKernelFunc(function(n,r){var o=n.asin(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(J(1).sub(o.toFloat().square()).sqrt())}}})}}),$N=A({asinh_:function(e){var t=S(e,"x","asinh");return j.runKernelFunc(function(n,r){var o=n.asinh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(J(1).add(o.toFloat().square()).sqrt())}}})}}),VN=A({atan_:function(e){var t=S(e,"x","atan");return j.runKernelFunc(function(n,r){var o=n.atan(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.toFloat().square().add(1))}}})}}),HN=A({atanh_:function(e){var t=S(e,"x","atanh");return j.runKernelFunc(function(n,r){var o=n.atanh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(J(1).sub(o.toFloat().square()))}}})}}),GN=A({ceil_:function(e){var t=S(e,"x","ceil");return j.runKernelFunc(function(n){return n.ceil(t)},{$x:t},function(n){return{$x:function(){return Se(n)}}})}}),xh=A({clipByValue_:function(e,t,n){var r=S(e,"x","clipByValue");I(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],a={min:t,max:n};return j.runKernelFunc(function(i,s){var u=i.clip(r,t,n);return s([r]),u},{x:r},function(i,s){var u=s[0];return{x:function(){return i.where(u.greaterEqual(t).logicalAnd(u.lessEqual(n)),Se(i))}}},"ClipByValue",a,o)}}),qN=A({cos_:function(e){var t=S(e,"x","cos"),n=[t];return j.runKernelFunc(function(r,o){var a=r.cos(t);return o([t]),a},{x:t},function(r,o){var a=o[0];return{x:function(){return a.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),KN=A({cosh_:function(e){var t=S(e,"x","cosh");return j.runKernelFunc(function(n,r){var o=n.cosh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(n)}}})}}),XN=A({erf_:function(e){var t=S(e,"x","erf");return I(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),j.runKernelFunc(function(n,r){var o=n.erf(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Xd=A({exp_:function(e){var t=S(e,"x","exp");return j.runKernelFunc(function(n,r){var o=n.exp(t);return r([o]),o},{x:t},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),YN=A({expm1_:function(e){var t=S(e,"x","expm1");return j.runKernelFunc(function(n,r){var o=n.expm1(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.exp())}}})}}),QN=A({floor_:function(e){var t=S(e,"x","floor");return j.runKernelFunc(function(n){return n.floor(t)},{$x:t},function(n){return{$x:function(){return Se(n)}}})}}),JN=A({log_:function(e){var t=S(e,"x","log"),n=[t];return j.runKernelFunc(function(r,o){var a=r.log(t);return o([t]),a},{x:t},function(r,o){var a=o[0];return{x:function(){return r.div(a.toFloat())}}},"Log",{},n)}}),ZN=A({log1p_:function(e){var t=S(e,"x","log1p");return j.runKernelFunc(function(n,r){var o=n.log1p(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.add(1))}}})}}),eS=A({logSigmoid_:function(e){var t=S(e,"x","logSigmoid");return j.runKernelFunc(function(n,r){var o=n.softplus(t.neg()).neg();return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.neg().sigmoid())}}})}}),Ku=A({neg_:function(e){var t=S(e,"x","neg"),n=[t];return j.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),tS=A({reciprocal_:function(e){var t=S(e,"x","reciprocal");return j.runKernelFunc(function(n,r){var o=n.reciprocal(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.square().neg())}}})}}),nS=A({round_:function(e){var t=S(e,"x","round");return j.runKernelFunc(function(n){return n.round(t)},{$x:t},function(n){return{$x:function(){return Se(n)}}})}}),ax=A({rsqrt_:function(e){var t=S(e,"x","rsqrt"),n=[t];return j.runKernelFunc(function(r,o){var a=r.rsqrt(t);return o([t]),a},{x:t},function(r,o){var a=o[0];return{x:function(){return r.div(a.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),ix=A({sigmoid_:function(e){var t=S(e,"x","sigmoid");return j.runKernelFunc(function(n,r){var o=n.sigmoid(t);return r([o]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mul(o.mul(J(1).sub(o)))}}},"Sigmoid")}}),rS=A({sign_:function(e){var t=S(e,"x","sign");return j.runKernelFunc(function(n){return n.sign(t)},{$x:t},function(n){return{$x:function(){return Se(n)}}})}}),oS=A({isNaN_:function(e){var t=S(e,"x","isNaN");return j.runKernelFunc(function(n){return n.isNaN(t)},{$x:t},function(n){return{$x:function(){return Se(n)}}})}}),aS=A({isInf_:function(e){var t=S(e,"x","isInf");return j.runKernelFunc(function(n){return n.isInf(t)},{$x:t},function(n){return{$x:function(){return Se(n)}}})}}),iS=A({isFinite_:function(e){var t=S(e,"x","isFinite");return j.runKernelFunc(function(n){return n.isFinite(t)},{$x:t},function(n){return{$x:function(){return Se(n)}}})}}),sS=A({sin_:function(e){var t=S(e,"x","sin"),n=[t];return j.runKernelFunc(function(r,o){var a=r.sin(t);return o([t]),a},{x:t},function(r,o){var a=o[0];return{x:function(){return a.toFloat().cos().mul(r)}}},"Sin",{},n)}}),uS=A({sinh_:function(e){var t=S(e,"x","sinh");return j.runKernelFunc(function(n,r){var o=n.sinh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(n)}}})}}),lS=A({softplus_:function(e){var t=S(e,"x","softplus");return j.runKernelFunc(function(n,r){var o=n.softplus(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.sigmoid())}}})}}),cS=A({sqrt_:function(e){var t=S(e,"x","sqrt");return j.runKernelFunc(function(n,r){var o=n.sqrt(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.toFloat().sqrt().mul(2))}}})}}),dS=A({step_:function(e,t){t===void 0&&(t=0);var n=S(e,"x","step");return j.runKernelFunc(function(r){return r.step(n,t)},{$x:n},function(r){return{$x:function(){return Se(r)}}})}}),fS=A({tan_:function(e){var t=S(e,"x","tan");return j.runKernelFunc(function(n,r){var o=n.tan(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.cos().square())}}})}}),hS=A({tanh_:function(e){var t=S(e,"x","tanh");return j.runKernelFunc(function(n,r){var o=n.tanh(t);return r([o]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return J(1).sub(o.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function sx(e,t,n,r,o,a){var i,s,u=S(e,"x","batchNorm"),l=S(t,"mean","batchNorm"),c=S(n,"variance","batchNorm");return o!=null&&(i=S(o,"scale","batchNorm")),r!=null&&(s=S(r,"offset","batchNorm")),I(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),I(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),I(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),i!=null&&I(i.rank===2||i.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),s!=null&&I(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),ss(u,l,c,s,i,a)}function ux(e,t,n,r,o,a){var i,s,u=S(e,"x","batchNorm"),l=S(t,"mean","batchNorm"),c=S(n,"variance","batchNorm");return o!=null&&(i=S(o,"scale","batchNorm")),r!=null&&(s=S(r,"offset","batchNorm")),I(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),I(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),I(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),i!=null&&I(i.rank===3||i.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),s!=null&&I(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),ss(u,l,c,s,i,a)}function lx(e,t,n,r,o,a){var i,s,u=S(e,"x","batchNorm"),l=S(t,"mean","batchNorm"),c=S(n,"variance","batchNorm");return o!=null&&(i=S(o,"scale","batchNorm")),r!=null&&(s=S(r,"offset","batchNorm")),I(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),I(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),I(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),i!=null&&I(i.rank===4||i.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),s!=null&&I(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),ss(u,l,c,s,i,a)}function ss(e,t,n,r,o,a){a==null&&(a=.001);var i,s,u,l=S(e,"x","batchNorm"),c=S(t,"mean","batchNorm"),d=S(n,"variance","batchNorm");o!=null&&(i=S(o,"scale","batchNorm")),r!=null&&(s=S(r,"offset","batchNorm")),I(c.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),I(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),I(i==null||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var f=[l,c,d,i];return j.runKernelFunc(function(h,v){var y=h.batchNormalization(u,Bs(c),Bs(d),a,Bs(i),Bs(s));return v([l,c,d,i]),y},{x:l,mean:c,variance:d,scale:i,offset:s},function(h,v){var y=v,x=y[0],m=y[1],g=y[2],b=y[3],w=b??J(1),C=vt(m.shape,u.shape),_=[];if(m.rank===1){for(var E=0;E<u.shape.length-1;++E)_.push(u.shape[E]);_.push(1)}var k=x.sub(m),R=h.mul(w),N=ax(g.add(J(a))),P=N.mul(N).mul(N).mul(J(-.5));return{x:function(){return m.rank===1?h.mul(Ca(N.as4D(1,1,1,m.shape[0]),_)).mul(w).reshape(x.shape):h.mul(N).mul(w).reshape(x.shape)},mean:function(){var T=N.mul(J(-1)).mul(R);return m.rank===1&&(T=T.sum(C)),T.reshape(m.shape)},variance:function(){var T=P.mul(k).mul(R);return m.rank===1&&(T=T.sum(C)),T.reshape(m.shape)},scale:function(){var T=k.mul(N),D=h.mul(T);return m.rank===1&&(D=D.sum(C)),D.reshape(m.shape)},offset:function(){var T=h;return m.rank===1&&(T=T.sum(C)),T.reshape(m.shape)}}},"BatchNormalization",{varianceEpsilon:a},f).reshape(l.shape)}function Bs(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function _l(){ky("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var pS=A({batchNormalization2d_:function(e,t,n,r,o,a){return r===void 0&&(r=.001),_l(),sx(e,t,n,a,o,r)}}),mS=A({batchNormalization3d_:function(e,t,n,r,o,a){return r===void 0&&(r=.001),_l(),ux(e,t,n,a,o,r)}}),vS=A({batchNormalization4d_:function(e,t,n,r,o,a){return r===void 0&&(r=.001),_l(),lx(e,t,n,a,o,r)}}),gS=A({batchNormalization_:function(e,t,n,r,o,a){return r===void 0&&(r=.001),_l(),ss(e,t,n,a,o,r)}}),cx=A({batchNorm_:ss}),yS=A({batchNorm2d_:sx}),xS=A({batchNorm3d_:ux}),bS=A({batchNorm4d_:lx}),kl=A({logicalAnd_:function(e,t){var n=S(e,"a","logicalAnd","bool"),r=S(t,"b","logicalAnd","bool");return Ce(n.shape,r.shape),j.runKernelFunc(function(o){return o.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),wS=A({logicalNot_:function(e){var t=S(e,"x","logicalNot","bool");return j.runKernelFunc(function(n){return n.logicalNot(t)},{$x:t})}}),dx=A({logicalOr_:function(e,t){var n=S(e,"a","logicalOr","bool"),r=S(t,"b","logicalOr","bool");return Ce(n.shape,r.shape),j.runKernelFunc(function(o){return o.logicalOr(n,r)},{$a:n,$b:r})}}),CS=A({logicalXor_:function(e,t){var n=S(e,"a","logicalXor","bool"),r=S(t,"b","logicalXor","bool");return Ce(n.shape,r.shape),dx(e,t).logicalAnd(kl(e,t).logicalNot())}}),Oo=A({where_:function(e,t,n){var r=S(t,"a","where"),o=S(n,"b","where"),a=S(e,"condition","where","bool");return je(r.shape,o.shape,"Error in where: "),a.rank===1?I(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):je(a.shape,o.shape,"Error in where: "),j.runKernelFunc(function(i,s){var u=i.select(a,r,o);return s([a]),u},{$condition:a,$a:r,$b:o},function(i,s){var u=s[0];return{$condition:function(){return Se(u).toFloat()},$a:function(){return i.mul(u.cast(i.dtype))},$b:function(){return i.mul(u.logicalNot().cast(i.dtype))}}})}}),fx=function(e){return re(this,void 0,void 0,function(){var t,n,r;return oe(this,function(o){switch(o.label){case 0:return[4,(t=S(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=mh(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},we=A({add_:function(e,t){var n,r=S(e,"a","add"),o=S(t,"b","add");n=Qe(r,o),r=n[0],o=n[1];var a=Ce(r.shape,o.shape);return j.runKernelFunc(function(i){return i.add(r,o)},{a:r,b:o},function(i){return{a:function(){var s=i,u=vt(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=i,u=vt(o.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),_S=A({addN_:function(e){I(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),I(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(o,a){return S(o,"tensors"+a,"addN")}),n=t[0];t.forEach(function(o){if(o.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!Ct(o.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return j.runKernelFunc(function(o){return o.addN(t)},r,function(o){var a={};return t.forEach(function(i,s){a[s]=function(){return o.clone()}}),a},"AddN")}}),kS=A({addStrict_:function(e,t){var n=S(e,"a","addStrict"),r=S(t,"b","addStrict");return je(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),ES=A({atan2_:function(e,t){var n,r=S(e,"a","atan2"),o=S(t,"b","atan2");n=Qe(r,o),r=n[0],o=n[1];var a=Ce(r.shape,o.shape);return j.runKernelFunc(function(i,s){var u=i.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=we(u.square(),l.square()),d=i.mul(l.div(c)),f=vt(u.shape,a);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var c=we(u.square(),l.square()),d=Ku(i.mul(u.div(c))),f=vt(l.shape,a);return f.length>0&&(d=d.sum(f)),d.reshape(l.shape)}}})}}),Pn=A({div_:function(e,t){var n,r=S(e,"a","div"),o=S(t,"b","div");if(n=Qe(r,o),r=n[0],o=n[1],r.dtype==="int32"&&o.dtype==="int32")return hx(r,o);var a=Ce(r.shape,o.shape);return j.runKernelFunc(function(i,s){var u=i.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(i,s){var u=s[0],l=s[1];return{a:function(){var c=i.div(l.toFloat()),d=vt(u.shape,a);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=i.mul(u.toFloat()),d=vt(l.shape,a);d.length>0&&(c=c.sum(d).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"Div")}}),NS=A({divNoNan_:function(e,t){var n,r=S(e,"a","div"),o=S(t,"b","div");r=(n=Qe(r,o))[0],o=n[1];var a=Pn(r,o),i=Se(a),s=o.equal(i);return Oo(s,i,a)}}),SS=A({divStrict_:function(e,t){var n=S(e,"a","div"),r=S(t,"b","div");return je(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),hx=A({floorDiv_:function(e,t){var n,r=S(e,"a","floorDiv"),o=S(t,"b","floorDiv");n=Qe(r,o),r=n[0],o=n[1];var a=Ce(r.shape,o.shape);return j.runKernelFunc(function(i,s){var u=i.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(i,s){var u=s[0],l=s[1];return{a:function(){var c=i.div(l.toFloat()),d=vt(u.shape,a);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=i.mul(u.toFloat()),d=vt(l.shape,a);d.length>0&&(c=c.sum(d).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"FloorDiv")}}),bh=A({maximum_:function(e,t){var n,r=S(e,"a","maximum"),o=S(t,"b","maximum");return n=Qe(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Ce(r.shape,o.shape),j.runKernelFunc(function(a,i){var s=a.maximum(r,o);return i([r,o]),s},{a:r,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return a.mul(s.greaterEqual(u).toFloat())},b:function(){return a.mul(s.less(u).toFloat())}}},"Maximum")}}),RS=A({maximumStrict_:function(e,t){var n=S(e,"a","maximumStrict"),r=S(t,"b","maximumStrict");return je(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),px=A({minimum_:function(e,t){var n,r=S(e,"a","minimum"),o=S(t,"b","minimum");return n=Qe(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Ce(r.shape,o.shape),j.runKernelFunc(function(a,i){var s=a.minimum(r,o);return i([r,o]),s},{a:r,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return a.mul(s.lessEqual(u).toFloat())},b:function(){return a.mul(s.greater(u).toFloat())}}},"Minimum")}}),IS=A({minimumStrict_:function(e,t){var n=S(e,"a","minimumStrict"),r=S(t,"b","minimumStrict");return je(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),DS=A({mod_:function(e,t){var n,r=S(e,"a","mod"),o=S(t,"b","mod");n=Qe(r,o),r=n[0],o=n[1];var a=Ce(r.shape,o.shape);return j.runKernelFunc(function(i,s){var u=i.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=vt(u.shape,a);return c.length>0?i.sum(c).reshape(u.shape):i},$b:function(){var c=i.mul(u.div(l).floor().neg()),d=vt(l.shape,a);return d.length>0?c.sum(d).reshape(l.shape):c}}})}}),TS=A({modStrict_:function(e,t){var n=S(e,"a","modStrict"),r=S(t,"b","modStrict");return je(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Bt=A({mul_:function(e,t){var n,r=S(e,"a","mul"),o=S(t,"b","mul");n=Qe(r,o),r=n[0],o=n[1];var a=Ce(r.shape,o.shape);return j.runKernelFunc(function(i,s){var u=i.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(i,s){var u=s[0],l=s[1];return{a:function(){var c=i.mul(l.toFloat()),d=vt(u.shape,a);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=i.mul(u.toFloat()),d=vt(l.shape,a);return d.length>0?c.sum(d).reshape(l.shape):c}}},"Mul")}}),AS=A({mulStrict_:function(e,t){var n=S(e,"a","mul"),r=S(t,"b","mul");return je(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Xu=A({pow_:function(e,t){var n,r=S(e,"base","pow"),o=S(t,"exp","pow");n=Qe(r,o),r=n[0],o=n[1];var a=Ce(r.shape,o.shape),i=[r,o];return j.runKernelFunc(function(s,u){var l=s.pow(r,o);return u([r,o,l]),l},{a:r,b:o},function(s,u){var l=u[0],c=u[1],d=u[2];return{a:function(){var f=c.toFloat(),h=s.mul(f.mul(l.pow(f.sub(J(1))))),v=vt(l.shape,a);return v.length>0&&(h=h.sum(v)),h.reshape(l.shape)},b:function(){var f=l.greater(0),h=l.log().where(f,Se(l)),v=s.mul(d.mul(h)),y=vt(c.shape,a);return y.length>0&&(v=v.sum(y)),v.reshape(c.shape)}}},"Pow",{},i,[!0])}}),PS=A({powStrict_:function(e,t){return je(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),FS=A({squaredDifferenceStrict_:function(e,t){var n=S(e,"a","squaredDifferenceStrict"),r=S(t,"b","squaredDifferenceStrict");return je(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),gt=A({sub_:function(e,t){var n,r=S(e,"a","sub"),o=S(t,"b","sub");n=Qe(r,o),r=n[0],o=n[1];var a=Ce(r.shape,o.shape);return j.runKernelFunc(function(i){return i.subtract(r,o)},{a:r,b:o},function(i){return{a:function(){var s=i,u=vt(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=i,u=vt(o.shape,a);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),jS=A({subStrict_:function(e,t){var n=S(e,"a","subStrict"),r=S(t,"b","subStrict");return je(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),mx=A({equal_:function(e,t){var n,r=S(e,"a","equal"),o=S(t,"b","equal");return n=Qe(r,o),r=n[0],o=n[1],Ce(r.shape,o.shape),j.runKernelFunc(function(a){return a.equal(r,o)},{$a:r,$b:o})}}),MS=A({equalStrict_:function(e,t){var n=S(e,"a","equalStrict"),r=S(t,"b","equalStrict");return je(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),OS=A({greater_:function(e,t){var n,r=S(e,"a","greater"),o=S(t,"b","greater");return n=Qe(r,o),r=n[0],o=n[1],Ce(r.shape,o.shape),j.runKernelFunc(function(a){return a.greater(r,o)},{a:r,b:o},null,"Greater")}}),vx=A({greaterEqual_:function(e,t){var n,r=S(e,"a","greaterEqual"),o=S(t,"b","greaterEqual");return n=Qe(r,o),r=n[0],o=n[1],Ce(r.shape,o.shape),j.runKernelFunc(function(a,i){var s=a.greaterEqual(r,o);return i([r,o]),s},{a:r,b:o},function(a,i){var s=i[0],u=i[1];return{a:function(){return Se(s)},b:function(){return Se(u)}}},"GreaterEqual")}}),LS=A({greaterEqualStrict_:function(e,t){var n=S(e,"a","greaterEqualStrict"),r=S(t,"b","greaterEqualStrict");return je(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),BS=A({greaterStrict_:function(e,t){var n=S(e,"a","greaterStrict"),r=S(t,"b","greaterStrict");return je(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),WS=A({less_:function(e,t){var n,r=S(e,"a","less"),o=S(t,"b","less");return n=Qe(r,o),r=n[0],o=n[1],Ce(r.shape,o.shape),j.runKernelFunc(function(a){return a.less(r,o)},{a:r,b:o},null,"Less")}}),zS=A({lessEqual_:function(e,t){var n,r=S(e,"a","lessEqual"),o=S(t,"b","lessEqual");return n=Qe(r,o),r=n[0],o=n[1],Ce(r.shape,o.shape),j.runKernelFunc(function(a,i){var s=a.lessEqual(r,o);return i([r,o]),s},{a:r,b:o},null,"LessEqual")}}),US=A({lessEqualStrict_:function(e,t){var n=S(e,"a","lessEqualStrict"),r=S(t,"b","lessEqualStrict");return je(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),$S=A({lessStrict_:function(e,t){var n=S(e,"a","lessStrict"),r=S(t,"b","lessStrict");return je(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),VS=A({notEqual_:function(e,t){var n,r=S(e,"a","notEqual"),o=S(t,"b","notEqual");return n=Qe(r,o),r=n[0],o=n[1],Ce(r.shape,o.shape),j.runKernelFunc(function(a){return a.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),HS=A({notEqualStrict_:function(e,t){var n=S(e,"a","notEqualStrict"),r=S(t,"b","notEqualStrict");return je(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function cv(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function dv(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var wh=A({gather_:function(e,t,n){n===void 0&&(n=0);var r=S(e,"x","gather"),o=S(t,"indices","gather","int32");n=yt(n,r.shape)[0];var a=function(i,s,u){for(var l=i.shape[u],c=[],d=1,f=1,h=0;h<u;h++)c.push(i.shape[h]),d*=i.shape[h];for(h=0;h<s.rank;h++)c.push(s.shape[h]);for(h=u+1;h<i.rank;h++)c.push(i.shape[h]),f*=i.shape[h];return{batchSize:d,sliceSize:f,dimSize:l,outputShape:c}}(r,o,n);return j.runKernelFunc(function(i,s){var u=i.gather(r,o.flatten(),n);return s([o]),u},{x:r,indices:o},function(i,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,d=l.slice(0,n),f=d.length,h=l.slice(n,l.length).slice(1),v=h.length,y=cv(0,f),x=cv(f+1,f+1+v),m=dv([d,[c],h]),g=i.reshape(m),b=u.reshape([c]),w=dv([[f],y,x]),C=g.transpose(w),_=gx(C,b,r.shape[n]),E=sh(w);return _=_.transpose(E)},indices:function(){return u}}},"Gather",{axis:n}).reshape(a.outputShape)}}),gx=A({unsortedSegmentSum_:function(e,t,n){var r=S(e,"x","unsortedSegmentSum"),o=S(t,"segmentIds","unsortedSegmentSum","int32");return I(et(n),function(){return"numSegments must be of dtype int"}),j.runKernelFunc(function(a,i){var s=a.unsortedSegmentSum(r,o,n);return i([o]),s},{$x:r},function(a,i){var s=i[0];return{$x:function(){return function(u,l){for(var c=bh(l,Se(l)),d=wh(u,c),f=vx(l,J(0,"int32")),h=d.rank-f.rank,v=0;v<h;++v)f=bn(f,v+1);f=kl(f,qa(d.shape,"bool"));var y=Se(d);return Oo(f,d,y)}(a,s)}}})}}),GS=function(e,t,n){return re(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,d,f,h,v,y;return oe(this,function(x){switch(x.label){case 0:for(r=S(e,"tensor","boolMask"),o=S(t,"mask","boolMask","bool"),a=n??0,i=o.rank,s=r.shape,I(i>0,function(){return"mask cannot be scalar"}),je(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+i;l++)u*=s[l];return c=s.slice(0,a).concat([u],s.slice(a+i)),d=r.reshape(c),f=o.reshape([-1]),[4,fx(f)];case 1:return h=x.sent(),v=h.squeeze([1]),y=wh(d,v,a),e!==r&&r.dispose(),t!==o&&o.dispose(),v.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,y]}})})};function yx(e,t,n,r,o,a,i){a===void 0&&(a="NHWC"),I(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,l=!1;t.rank===3&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),I(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),I(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),I(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c=a==="NHWC"?s[3]:s[1],d=a==="NHWC"?u.shape[3]:u.shape[1];I(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),I(d===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+n.shape[3]+"."}),i!=null&&I(et(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var f=fh(a),h=$o(s,n.shape,r,1,o,i,!1,f),v=j.runKernelFunc(function(y,x){var m=y.conv2dDerInput(u,n,h);return x([n,u]),m},{dy4D:u,filter:n},function(y,x){var m=x[0],g=x[1];return{dy4D:function(){return Sn(y,m,r,o,a,1,i)},filter:function(){return Ch(y,g,m.shape,r,o,a,i)}}});return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function Ec(e){var t=function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a}(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function xx(e,t,n,r,o){I(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,i=t,s=!1;t.rank===4&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=i.shape[4];I(a.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),I(i.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),I(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),I(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),I(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Gu(a,n.shape,r,1,o),d=j.runKernelFunc(function(f){return f.conv3dDerInput(i,n,c)},{dy5D:i});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var qS=A({conv1d_:function(e,t,n,r,o,a,i){o===void 0&&(o="NWC"),a===void 0&&(a=1);var s=S(e,"x","conv1d"),u=S(t,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),I(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),I(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),i!=null&&I(et(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),I(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),I(nn(n,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"}),I(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),h=Sn(f,d,[1,n],r,"NHWC",[1,a],i);return c?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Sn=A({conv2d_:function(e,t,n,r,o,a,i){o===void 0&&(o="NHWC"),a===void 0&&(a=[1,1]);var s=S(e,"x","conv2d"),u=S(t,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),I(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),I(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),i!=null&&I(et(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var d=o==="NHWC"?l.shape[3]:l.shape[1];I(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),I(nn(n,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"});var f=fh(o),h=$o(l.shape,u.shape,n,a,r,i,!1,f),v=[u,l],y=j.runKernelFunc(function(x,m){var g=x.conv2d(l,u,h);return m([u,l]),g},{x:l,filter:u},function(x,m){var g=m,b=g[0],w=g[1];return I(Ba(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return bx(w.shape,x,b,n,r,o)},filter:function(){return Ch(w,x,b.shape,n,r,o)}}},"Conv2D",h,v);return c?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),KS=A({conv3d_:function(e,t,n,r,o,a){o===void 0&&(o="NDHWC"),a===void 0&&(a=[1,1,1]);var i=S(e,"x","conv3d"),s=S(t,"filter","conv3d"),u=i,l=!1;i.rank===4&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),I(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),I(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),I(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),I(function(f,h){return Ec(f)||Ec(h)}(n,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),I(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=Gu(u.shape,s.shape,n,a,r),d=j.runKernelFunc(function(f,h){var v=f.conv3d(u,s,c);return h([u,s]),v},{x:u,$filter:s},function(f,h){I(Ec(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var v=h[0],y=h[1];return{x:function(){return xx(v.shape,f,y,n,r)},$filter:function(){return function(x,m,g,b,w){var C=x;x.rank===4&&(C=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3]));var _=m;_.rank===4&&(_=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3])),I(C.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+C.shape+"."}),I(_.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),I(g.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+g+"."}),I(C.shape[4]===g[3],function(){return"Error in conv3dDerFilter: depth of input "+C.shape[4]+") must match input depth in filter ("+g[3]+"."}),I(_.shape[4]===g[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+g[4]+")."});var E=Gu(C.shape,g,b,1,w);return j.runKernelFunc(function(k){return k.conv3dDerFilter(C,_,E)},{x5D:C,dy5D:_})}(v,f,y.shape,n,r)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Ch=A({conv2dDerFilter_:function(e,t,n,r,o,a,i){a===void 0&&(a="NHWC");var s=e;e.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;u.rank===3&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),I(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),I(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),I(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l=a==="NHWC"?s.shape[3]:s.shape[1],c=a==="NHWC"?u.shape[3]:u.shape[1];I(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),I(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),i!=null&&I(et(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var d=fh(a),f=$o(s.shape,n,r,1,o,i,!1,d);return j.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),bx=A({conv2dDerInput_:yx}),El=A({depthwiseConv2d_:function(e,t,n,r,o,a,i){a===void 0&&(a=[1,1]);var s=S(e,"x","depthwiseConv2d"),u=S(t,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),I(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),I(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),I(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),a==null&&(a=[1,1]),I(nn(n,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),i!=null&&I(et(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var d=$o(l.shape,u.shape,n,a,r,i,!0),f=[l,u],h=j.runKernelFunc(function(v,y){var x=v.depthwiseConv2D(l,u,d);return y([l,u]),x},{x:l,filter:u},function(v,y){I(Ba(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var x=y[0],m=y[1];return{x:function(){return wx(x.shape,v,m,d)},filter:function(){return Cx(x,v,m.shape,d)}}},"DepthwiseConv2dNative",d,f);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),wx=A({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,a=!1;t.rank===3&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=j.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),Cx=A({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;e.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return a.rank===3&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),j.runKernelFunc(function(i){return i.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}}),_h=A({separableConv2d_:function(e,t,n,r,o,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var s=S(e,"x","separableConv2d"),u=S(t,"depthwiseFilter","separableConv2d"),l=S(n,"pointwiseFilter","separableConv2d"),c=s,d=!1;if(s.rank===3&&(d=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");I(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),I(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),I(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),I(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),I(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],h=u.shape[3];I(l.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+l.shape[2]+"."});var v=El(c,u,r,o,i,a),y=Sn(v,l,1,"valid",i);return d?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),XS=A({conv2dTranspose_:function(e,t,n,r,o,a){return yx(n,S(e,"x","conv2dTranspose"),S(t,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),YS=A({conv3dTranspose_:function(e,t,n,r,o){return xx(n,S(e,"x","conv3dTranspose"),S(t,"filter","conv3dTranspose"),r,o)}}),Nl=A({matMul_:function(e,t,n,r){var o;n===void 0&&(n=!1),r===void 0&&(r=!1);var a=S(e,"a","matMul"),i=S(t,"b","matMul");o=Qe(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],d=a.shape.slice(0,-2),f=i.shape.slice(0,-2),h=se(d),v=se(f);I(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),I(Ct(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),I(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var y=a.shape.slice(0,-2).concat([l,c]),x=n?a.as3D(h,s,l):a.as3D(h,l,s),m=r?i.as3D(v,c,u):i.as3D(v,u,c),g={transposeA:n,transposeB:r};return j.runKernelFunc(function(b,w){var C=b.batchMatMul(x,m,n,r);return w([x,m]),C},{a:x,b:m},function(b,w){var C=w,_=C[0],E=C[1];return n||r?!n&&r?{a:function(){return b.matMul(E,!1,!1)},b:function(){return b.matMul(_,!0,!1)}}:n&&!r?{a:function(){return E.matMul(b,!1,!0)},b:function(){return _.matMul(b,!1,!1)}}:{a:function(){return E.matMul(b,!0,!0)},b:function(){return b.matMul(_,!0,!0)}}:{a:function(){return b.matMul(E,!1,!0)},b:function(){return _.matMul(b,!0,!1)}}},"BatchMatMul",g).reshape(y)}}),QS=A({dot_:function(e,t){var n=S(e,"t1","dot"),r=S(t,"t2","dot");I(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=n.rank===1?n.size:n.shape[1],a=r.rank===1?r.size:r.shape[0];return I(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),JS=A({outerProduct_:function(e,t){var n=S(e,"v1","outerProduct"),r=S(t,"v2","outerProduct");return I(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),us=A({reverse_:function(e,t){var n=S(e,"x","reverse");if(n.rank===0)return n.clone();var r=yt(t,n.shape);return j.runKernelFunc(function(o){return o.reverse(n,r)},{$x:n},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(n)}}),ZS=A({reverse1d_:function(e){var t=S(e,"x","reverse");return I(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),us(t,0)}}),e4=A({reverse2d_:function(e,t){var n=S(e,"x","reverse");return I(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),us(n,t)}}),t4=A({reverse3d_:function(e,t){var n=S(e,"x","reverse");return I(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),us(n,t)}}),n4=A({reverse4d_:function(e,t){var n=S(e,"x","reverse");return I(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),us(n,t)}});function _x(e,t,n,r,o,a){var i=S(e,"x","maxPool"),s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),r==null&&(r=[1,1]),I(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),I(nn(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),a!=null&&I(et(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=Ki(s.shape,t,n,r,o,a);if(l.filterWidth===1&&l.filterHeight===1&&Ct(l.inShape,l.outShape))return i.clone();var c=[s],d=j.runKernelFunc(function(f,h){var v=f.maxPool(s,l);return h([s,v]),v},{x:s},function(f,h){var v=h[0],y=h[1];return{x:function(){return function(x,m,g,b,w,C,_,E){var k=S(x,"dy","maxPoolBackprop"),R=S(m,"input","maxPoolBackprop"),N=S(g,"output","maxPoolBackprop");I(R.rank===k.rank,function(){return"Rank of input ("+R.rank+") does not match rank of dy ("+k.rank+")"}),C==null&&(C=[1,1]),I(nn(w,C),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+C+"'"}),I(k.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),I(R.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+R.rank+"."}),E!=null&&I(et(_),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+E+" but got pad "+_+"."});var P=Ki(R.shape,b,w,C,_,E);return j.runKernelFunc(function(T){return T.maxPoolBackprop(k,R,N,P)},{$dy:k,$input:R})}(f,v,y,t,n,r,o)}}},"MaxPool",l,c);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function kx(e,t,n,r,o,a){var i=S(e,"x","avgPool","float32");r==null&&(r=[1,1]),I(nn(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),I(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),a!=null&&I(et(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=Ki(s.shape,t,n,r,o,a);if(l.filterWidth===1&&l.filterHeight===1&&Ct(l.inShape,l.outShape))return i.clone();var c=j.runKernelFunc(function(d){return d.avgPool(s,l)},{x:s},function(d){return{x:function(){return function(f,h,v,y,x,m){var g=S(f,"dy","avgPoolBackprop"),b=S(h,"input","avgPoolBackprop");I(b.rank===g.rank,function(){return"Rank of input ("+b.rank+") does not match rank of dy ("+g.rank+")"}),x==null&&(x=[1,1]),I(nn(y,x),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+x+"'"});var w=b,C=g,_=!1;b.rank===3&&(_=!0,w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]),C=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),I(C.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),I(w.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+"."});var E=Ki(w.shape,v,y,x,m),k=j.runKernelFunc(function(R){return R.avgPoolBackprop(C,w,E)},{dy4D:C,input4D:w});return _?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}(d,s,t,n,r,o)}}},"AvgPool",l);return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var xt=A({maxPool_:function(e,t,n,r,o){return _x(e,t,n,1,r,o)}}),ls=A({avgPool_:function(e,t,n,r,o){return kx(e,t,n,1,r,o)}}),r4=A({pool_:function(e,t,n,r,o,a){o==null&&(o=[1,1]),a==null&&(a=1),r===0&&(r="valid");var i=S(e,"x","maxPool"),s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),I(nn(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=Ki(s.shape,t,a,o,r),d=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(w,C){var _=w.map(function(R,N){return R+(R-1)*(C[N]-1)}).map(function(R){return R-1}),E=_.map(function(R){return Math.floor(R/2)}),k=_.map(function(R,N){return R-E[N]});return _.map(function(R,N){return[E[N],k[N]]})}([c.filterHeight,c.filterWidth],d):[[0,0],[0,0]];var f=d[0]===1&&d[1]===1,h=function(w,C,_){var E=_.map(function(B){return B[0]}),k=_.map(function(B){return B[1]}),R=w.concat(E,k),N=C.map(function(B,W){return(B-R[W]%B)%B}),P=k.map(function(B,W){return B+N[W]}),T=C.map(function(B,W){return[E[W],P[W]]}),D=C.map(function(B,W){return[0,N[W]]});return[T,D]}([c.inHeight,c.inWidth],d,l),v=h[0],y=h[1],x=f?r:"valid",m=f?s:Dy(s,d,v),g=(n==="avg"?function(){return kx(m,t,a,1,x)}:function(){return _x(m,t,a,1,x)})(),b=f?g:Sy(g,d,y);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),o4=A({maxPool3d_:function(e,t,n,r,o,a,i){a===void 0&&(a="NDHWC");var s=S(e,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),i==null&&(i=[1,1,1]),I(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),I(a==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),I(nn(n,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),o!=null&&I(et(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=Hu(u.shape,t,n,i,r,o,a),d=j.runKernelFunc(function(f,h){var v=f.maxPool3d(u,c);return h([u,v]),v},{x:u},function(f,h){var v=h[0],y=h[1];return{x:function(){return function(x,m,g,b,w,C,_,E){var k=S(x,"dy","maxPool3dBackprop"),R=S(m,"input","maxPool3dBackprop"),N=S(g,"output","maxPool3dBackprop"),P=k,T=R,D=N,B=!1;R.rank===4&&(B=!0,P=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),T=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),D=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),I(P.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+P.rank+"."}),I(T.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),I(D.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+D.rank+"."}),C==null&&(C=[1,1,1]),I(nn(w,C),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+C+"'"}),E!=null&&I(et(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+E+" but got pad "+_+"."});var W=Hu(T.shape,b,w,C,_,E),U=j.runKernelFunc(function($){return $.maxPool3dBackprop(P,T,D,W)},{dy5D:P,input5D:T});return B?U.as4D(U.shape[1],U.shape[2],U.shape[3],U.shape[4]):U}(f,v,y,t,n,i,r,o)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),a4=A({avgPool3d_:function(e,t,n,r,o,a,i){a===void 0&&(a="NDHWC");var s=S(e,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),i==null&&(i=[1,1,1]),I(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),I(a==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),I(nn(n,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),o!=null&&I(et(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=Hu(u.shape,t,n,i,r,o,a),d=j.runKernelFunc(function(f){return f.avgPool3d(u,c)},{x:u},function(f){return{x:function(){return function(h,v,y,x,m,g,b){var w=S(h,"dy","avgPool3dBackprop"),C=S(v,"input","avgPool3dBackprop"),_=w,E=C,k=!1;C.rank===4&&(k=!0,_=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]),E=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3])),I(_.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),I(E.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+E.rank+"."}),m==null&&(m=[1,1,1]),I(nn(x,m),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+m+"'"}),b!=null&&I(et(g),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+b+" but got pad "+g+"."});var R=Hu(E.shape,y,x,m,g,b),N=j.runKernelFunc(function(P){return P.avgPool3dBackprop(_,E,R)},{dy5D:_,input5D:E});return k?N.as4D(N.shape[1],N.shape[2],N.shape[3],N.shape[4]):N}(f,u,t,n,i,r,o)}}});return d=d.cast(u.dtype),l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),or=A({slice_:function(e,t,n){var r,o,a=S(e,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach(function(u){I(u!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=n==null?new Array(a.rank).fill(-1):typeof n=="number"?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map(function(u,l){return u>=0?u:(I(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),a.shape[l]-r[l])}),Pk(a,r,o);var i=a.shape,s={begin:r,size:o};return j.runKernelFunc(function(u){return u.slice(a,r,o)},{x:a},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],i[c]-r[c]-o[c]]);return{x:function(){return u.pad(l)}}},"Slice",s)}}),i4=A({slice1d_:function(e,t,n){var r=S(e,"x","slice1d");return I(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),or(r,[t],[n])}}),s4=A({slice2d_:function(e,t,n){var r=S(e,"x","slice2d");return I(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),or(r,t,n)}}),Ex=A({slice3d_:function(e,t,n){var r=S(e,"x","slice3d");return I(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),or(r,t,n)}}),u4=A({slice4d_:function(e,t,n){var r=S(e,"x","slice4d");return I(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),or(r,t,n)}});function Nx(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(tn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(tn(e.shape,r))),{x:function(){var a=e.mul(n.equal(t).cast(e.dtype));return o==null?a:a.transpose(o)}}}var l4=A({all_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=S(e,"x","all","bool"),o=yt(t,r.shape),a=o,i=ir(a,r.rank);i!=null&&(r=r.transpose(i),a=sr(a.length,r.rank));var s=j.runKernelFunc(function(l){return l.all(r,a)},{$x:r});if(n){var u=tn(s.shape,o);return s.reshape(u)}return s}}),c4=A({any_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=S(e,"x","any","bool"),o=yt(t,r.shape),a=o,i=ir(a,r.rank);i!=null&&(r=r.transpose(i),a=sr(a.length,r.rank));var s=j.runKernelFunc(function(l){return l.any(r,a)},{$x:r});if(n){var u=tn(s.shape,o);return s.reshape(u)}return s}}),d4=A({argMax_:function(e,t){t===void 0&&(t=0);var n=S(e,"x","argMax");t==null&&(t=0);var r=yt(t,n.shape),o=ir(r,n.rank);o!=null&&(n=n.transpose(o),r=sr(r.length,n.rank));var a={axis:r[0]},i=[n];return j.runKernelFunc(function(s,u){var l=s.argMax(n,r[0]);return u([n]),l},{x:n},function(s,u){var l=u[0];return{x:function(){return Se(l)}}},"ArgMax",a,i)}}),f4=A({argMin_:function(e,t){t===void 0&&(t=0);var n=S(e,"x","argMin");t==null&&(t=0);var r=yt(t,n.shape),o=ir(r,n.rank);return o!=null&&(n=n.transpose(o),r=sr(r.length,n.rank)),j.runKernelFunc(function(a,i){var s=a.argMin(n,r[0]);return i([n]),s},{$x:n},function(a,i){var s=i[0];return{$x:function(){return Se(s)}}})}}),h4=A({logSumExp_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=S(e,"x","logSumExp"),o=yt(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=tn(s.shape,o);return s.reshape(u)}return s}}),Sl=A({max_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=S(e,"x","max"),o=r,a=yt(t,r.shape),i=a,s=ir(i,r.rank);s!=null&&(r=r.transpose(s),i=sr(i.length,r.rank));var u=[r],l=j.runKernelFunc(function(d,f){var h=d.max(r,i);return f([o,h]),h},{x:r},function(d,f){return Nx(d,f[1],f[0],a,s)},"Max",{axes:i},u,[!0]);if(n){var c=tn(l.shape,a);l=l.reshape(c)}return l}}),p4=A({mean_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=S(e,"x","mean"),o=yt(t,r.shape),a=se(Ft(r.shape,o)[1]);return Cl(function(i){var s=J(a);return{value:(s.dtype===i.dtype?i:i.cast(s.dtype)).div(s).sum(t,n),gradFunc:function(u){var l=i.shape.slice();return o.forEach(function(c){l[c]=1}),u.reshape(l).mul(qa(i.shape,"float32")).div(a)}}})(r)}}),m4=A({min_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=S(e,"x","min"),o=r,a=yt(t,r.shape),i=a,s=ir(i,r.rank);s!=null&&(r=r.transpose(s),i=sr(i.length,r.rank));var u=[r],l=j.runKernelFunc(function(d,f){var h=d.min(r,i);return f([o,h]),h},{x:r},function(d,f){return Nx(d,f[1],f[0],a,s)},"Min",{axes:i},u,[!0]);if(n){var c=tn(l.shape,a);l=l.reshape(c)}return l}}),v4=A({moments_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=yt(t,(e=S(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;n||(a=tn(o.shape,r));var i=e.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),Sx=A({sum_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=S(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=yt(t,r.shape);return Cl(function(a){var i=ir(o,a.rank),s=o,u=a;i!=null&&(u=a.transpose(i),s=sr(s.length,a.rank));var l=function(h){var v=a.shape.slice();return o.forEach(function(y){v[y]=1}),h.reshape(v).mul(qa(a.shape,"float32"))},c={axes:s},d=j.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return l(h)}}},"Sum",c);if(n){var f=tn(d.shape,o);d=d.reshape(f)}return{value:d,gradFunc:l}})(r)}}),g4=A({prod_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=S(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=yt(t,r.shape),a=ir(o,r.rank),i=o,s=r;a!=null&&(s=r.transpose(a),i=sr(i.length,r.rank));var u=j.runKernelFunc(function(c){return c.prod(s,i)},{permutedX:s});if(n){var l=tn(u.shape,o);u=u.reshape(l)}return u}}),Rx=A({elu_:function(e){var t=S(e,"x","elu");return j.runKernelFunc(function(n,r){var o=n.elu(t);return r([o]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return j.runKernelFunc(function(a){return a.eluDer(n,o)},{dy:n,y:o})}}})}}),y4=A({leakyRelu_:function(e,t){t===void 0&&(t=.2);var n=S(e,"x","leakyRelu");return bh(J(t).mul(n),n)}}),Ix=A({prelu_:function(e,t){var n=S(e,"x","prelu"),r=S(t,"alpha","prelu");return j.runKernelFunc(function(o,a){var i=o.prelu(n,r);return a([n,r]),i},{x:n,alpha:r},function(o,a){var i=a[0],s=a[1],u=i.greater(0);return{x:function(){return Oo(u,o,o.mul(s))},alpha:function(){var l=Oo(u,Se(o),o.mul(i)),c=vt(s.shape,o.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),Ke=A({relu_:function(e){var t=S(e,"x","relu");return t.dtype==="bool"?t.toInt():j.runKernelFunc(function(n,r){var o=n.relu(t);return r([t]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mulStrict(o.step().toFloat())}}},"Relu")}}),Dx=A({relu6_:function(e){var t=S(e,"x","relu6");return t.dtype==="bool"?t.toInt():j.runKernelFunc(function(n,r){var o=n.relu6(t);return r([t]),o},{x:t},function(n,r){var o=r[0],a=o.lessEqual(6).mul(o.step());return{x:function(){return n.mulStrict(a.toFloat())}}},"Relu6")}}),x4=A({selu_:function(e){var t=S(e,"x","selu");return j.runKernelFunc(function(n,r){var o=n.selu(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){var a=o.greater(J(0)),i=J(gh),s=J(yh),u=n.mul(s),l=n.mul(i).mul(o.toFloat().exp());return Oo(a,u,l)}}})}}),ao=A({transpose_:function(e,t){var n=S(e,"x","transpose");if(t==null&&(t=n.shape.map(function(o,a){return a}).reverse()),I(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(o){I(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return j.runKernelFunc(function(o){return o.transpose(n,t)},{x:n},function(o){var a=sh(t);return{x:function(){return o.transpose(a)}}},"Transpose",r)}}),b4=A({localResponseNormalization_:function(e,t,n,r,o){t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5);var a=S(e,"x","localResponseNormalization");I(a.rank===4||a.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."}),I(et(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;a.rank===3&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=j.runKernelFunc(function(l,c){var d=l.localResponseNormalization4D(i,t,n,r,o);return c([i,d]),d},{x4D:i},function(l,c){var d=c[0],f=c[1];return{x4D:function(){return j.runKernelFunc(function(h){return h.LRNGrad(l,d,f,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Tx=A({norm_:function(e,t,n,r){t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var o=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(J(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(e=S(e,"x","norm"),t,n),a=o.shape;if(r){var i=yt(n,e.shape);a=tn(o.shape,i)}return o.reshape(a)}}),w4=A({basicLSTMCell_:function(e,t,n,r,o,a){var i=S(e,"forgetBias","basicLSTMCell"),s=S(t,"lstmKernel","basicLSTMCell"),u=S(n,"lstmBias","basicLSTMCell"),l=S(r,"data","basicLSTMCell"),c=S(o,"c","basicLSTMCell"),d=S(a,"h","basicLSTMCell"),f=l.concat(d,1).matMul(s).add(u),h=f.shape[0],v=f.shape[1]/4,y=[h,v],x=f.slice([0,0],y),m=f.slice([0,v],y),g=f.slice([0,2*v],y),b=f.slice([0,3*v],y),w=x.sigmoid().mulStrict(m.tanh()).addStrict(c.mulStrict(i.add(g).sigmoid())),C=w.tanh().mulStrict(b.sigmoid());return[w,C]}}),C4=A({multiRNNCell_:function(e,t,n,r){for(var o=S(t,"data","multiRNNCell"),a=Bu(n,"c","multiRNNCell"),i=Bu(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var d=[],f=[];for(l=0;l<u.length;l+=2)d.push(u[l]),f.push(u[l+1]);return[d,f]}}),_4=A({movingAverage_:function(e,t,n,r,o){o===void 0&&(o=!0);var a=S(e,"v","movingAverage"),i=S(t,"x","movingAverage"),s=S(n,"decay","movingAverage");b_(a,i),I(Ct(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=J(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){I(r!=null,function(){return"When using zeroDebias: true, step is required."});var d=S(r,"step","movingAverage");c=c.div(u.sub(Xu(s,d)))}return a.add(c)}}),k4=A({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(o===void 0&&(o=0),a===void 0&&(a=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(t.length)),i!==0)throw new Error("ellipsis mask is not yet supported");var l=S(e,"x","stridedSlice"),c=Vm(s),d=l.shape.slice();c.forEach(function(x){t[x]=0,n[x]=1,d.splice(x,0,1)}),l=l.reshape(d);for(var f=0;f<l.rank;f++)t[f]=Fk(o,t,r,l.shape,f),n[f]=jk(a,n,r,l.shape,f),r[f]=r[f]||1;var h=Vm(u);h.forEach(function(x){n[x]=t[x]+1,r[x]=1});var v=dh(t,n,r),y=v.filter(function(x,m){return h.indexOf(m)===-1});return r.every(function(x){return x===1})?or(l,t,v).reshape(y):j.runKernelFunc(function(x){return x.stridedSlice(l,t,n,r)},{$x:l}).reshape(y)}}),E4=A({topk_:function(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!0);var r=S(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=j.runKernelFunc(function(i){return i.topk(r,t,n)},{$x:r});return{values:a[0],indices:a[1]}}}),N4=A({scatterND_:function(e,t,n){var r=S(e,"indices","scatterND","int32"),o=S(t,"updates","scatterND");return Ak(o,r,n),j.runKernelFunc(function(a){return a.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),kh=A({fft_:function(e){I(e.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return j.runKernelFunc(function(o){return o.fft(r)},{input:e}).reshape(e.shape)}}),Yu=A({ifft_:function(e){I(e.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return j.runKernelFunc(function(o){return o.ifft(r)},{input:e}).reshape(e.shape)}}),Eh=A({rfft_:function(e,t){I(e.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(t!=null&&t<r){var a=e.shape.map(function(m){return 0}),i=e.shape.map(function(m){return m});i[e.shape.length-1]=t,n=e.slice(a,i),r=t}else if(t!=null&&t>r){var s=e.shape.map(function(m){return m});s[e.shape.length-1]=t-r,n=e.concat(Ue(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=Nt(n,u).as2D(o,r),c=kh(l),d=Math.floor(r/2)+1,f=wn(c),h=Qn(c),v=f.split([d,r-d],f.shape.length-1),y=h.split([d,r-d],h.shape.length-1),x=n.shape.slice();return x[n.shape.length-1]=d,Nt(v[0],y[0]).reshape(x)}}),Ax=A({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=Yu(r);return wn(o)}var a=[n,2*(t-1)],i=wn(e).as2D(n,t),s=Qn(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(J(-1)),c=i.concat(u,1),d=s.concat(l,1);return r=Nt(c,d).as2D(a[0],a[1]),o=Yu(r),wn(o)}}),S4=Object.freeze({fft:kh,ifft:Yu,rfft:Eh,irfft:Ax}),R4=A({sparseToDense_:function(e,t,n,r){r===void 0&&(r=0);var o=S(e,"sparseIndices","sparseToDense","int32"),a=S(t,"sparseValues","sparseToDense"),i=S(r,"defaultValue","sparseToDense",a.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var h=u.size;if(u.rank!==0&&(u.rank!==1||h!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),j.runKernelFunc(function(s){return s.sparseToDense(o,a,n,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),I4=A({gatherND_:function(e,t){var n=S(t,"indices","gatherND","int32"),r=S(e,"x","gatherND");return j.runKernelFunc(function(o){return o.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),D4=A({diag_:function(e){var t=S(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return j.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(n)}}),T4=A({dropout_:function(e,t,n,r){var o=S(e,"x","dropout");if(I(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),I(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return e instanceof qe?o.clone():o;var a=function(u,l){if(l==null)return u.shape.slice();if(Ct(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],d=0;d<u.shape.length;d++)l[d]==null&&u.shape[d]!=null?c.push(u.shape[d]):c.push(l[d]);return c}return l}(o,n),i=1-t,s=Iy(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function Px(e,t,n){for(var r=1-e%2,o=new Float32Array(e),a=0;a<e;++a){var i=2*Math.PI*a/(e+r-1);o[a]=t-n*Math.cos(i)}return ut(o,"float32")}var Nh=A({hannWindow_:function(e){return Px(e,.5,.5)}}),Fx=A({hammingWindow_:function(e){return Px(e,.54,.46)}}),Sh=A({frame_:function(e,t,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var a=0,i=[];a+t<=e.size;)i.push(or(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=pt([or(e,a,t-s),rr([s],o)]);i.push(u),a+=n}return i.length===0?Zr([],[0,t]):pt(i).as2D(i.length,t)}}),jx=A({stft_:function(e,t,n,r,o){var a;o===void 0&&(o=Nh),r==null&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=Sh(e,t,n),s=Bt(i,o(t)),u=[],l=0;l<i.shape[0];l++)u.push(Eh(s.slice([l,0],[1,t]),r));return pt(u)}}),A4=Object.freeze({hannWindow:Nh,hammingWindow:Fx,frame:Sh,stft:jx}),Lt,P4=function(e,t,n){return n===void 0&&(n=1),re(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,d,f,h,v,y,x;return oe(this,function(m){switch(m.label){case 0:return r=S(e,"predictions","inTopK"),o=S(t,"targets","inTopK"),I(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),I(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),je(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],I(n>0&&n<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n}),[4,r.data()];case 1:return i=m.sent(),[4,o.data()];case 2:for(s=m.sent(),u=[i.length/a,a],c=u[1],d=Hi("bool",l=u[0]),f=0;f<l;f++){for(h=f*c,v=i.subarray(h,h+c),y=[],x=0;x<v.length;x++)y.push({value:v[x],index:x});for(y.sort(function(g,b){return b.value-g.value}),d[f]=0,x=0;x<n;x++)if(y[x].index===s[f]){d[f]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,Rt(d,o.shape,"bool")]}})})};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Lt||(Lt={}));var F4=A({absoluteDifference_:function(e,t,n,r){r===void 0&&(r=Lt.SUM_BY_NONZERO_WEIGHTS);var o=S(e,"labels","absoluteDifference"),a=S(t,"predictions","absoluteDifference"),i=null;n!=null&&(i=S(n,"weights","absoluteDifference")),je(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return kr(s,i,r)}}),kr=A({computeWeightedLoss_:function(e,t,n){n===void 0&&(n=Lt.SUM_BY_NONZERO_WEIGHTS);var r=S(e,"losses","computeWeightedLoss"),o=null;t!=null&&(o=S(t,"weights","computeWeightedLoss"));var a=o==null?r:r.mul(o);if(n===Lt.NONE)return a;if(n===Lt.SUM)return a.sum();if(n===Lt.MEAN){if(o==null)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(J(i)):s}if(n===Lt.SUM_BY_NONZERO_WEIGHTS){if(o==null)return a.sum().div(J(r.size));var u=o.mul(qa(r.shape)).notEqual(J(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),j4=A({cosineDistance_:function(e,t,n,r,o){o===void 0&&(o=Lt.SUM_BY_NONZERO_WEIGHTS);var a=S(e,"labels","cosineDistance"),i=S(t,"predictions","cosineDistance"),s=null;r!=null&&(s=S(r,"weights","cosineDistance")),je(a.shape,i.shape,"Error in cosineDistance: ");var u=J(1).sub(a.mul(i).sum(n,!0));return kr(u,s,o)}}),M4=A({hingeLoss_:function(e,t,n,r){r===void 0&&(r=Lt.SUM_BY_NONZERO_WEIGHTS);var o=S(e,"labels","hingeLoss"),a=S(t,"predictions","hingeLoss"),i=null;n!=null&&(i=S(n,"weights","hingeLoss")),je(o.shape,a.shape,"Error in hingeLoss: ");var s=J(1);o=J(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return kr(u,i,r)}}),O4=A({huberLoss_:function(e,t,n,r,o){r===void 0&&(r=1),o===void 0&&(o=Lt.SUM_BY_NONZERO_WEIGHTS);var a=S(e,"labels","huberLoss"),i=S(t,"predictions","huberLoss"),s=null;n!=null&&(s=S(n,"weights","huberLoss")),je(a.shape,i.shape,"Error in huberLoss: ");var u=J(r),l=i.sub(a).abs(),c=px(l,u),d=l.sub(c),f=J(.5).mul(c.square()).add(u.mul(d));return kr(f,s,o)}}),L4=A({logLoss_:function(e,t,n,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Lt.SUM_BY_NONZERO_WEIGHTS);var a=S(e,"labels","logLoss"),i=S(t,"predictions","logLoss"),s=null;n!=null&&(s=S(n,"weights","logLoss")),je(a.shape,i.shape,"Error in logLoss: ");var u=J(1),l=J(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return kr(c,s,o)}}),B4=A({meanSquaredError_:function(e,t,n,r){r===void 0&&(r=Lt.SUM_BY_NONZERO_WEIGHTS);var o=S(e,"labels","meanSquaredError"),a=S(t,"predictions","meanSquaredError"),i=null;n!=null&&(i=S(n,"weights","meanSquaredError")),je(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return kr(s,i,r)}}),W4=A({sigmoidCrossEntropy_:function(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Lt.SUM_BY_NONZERO_WEIGHTS);var a=S(e,"multiClassLabels","sigmoidCrossEntropy"),i=S(t,"logits","sigmoidCrossEntropy"),s=null;if(n!=null&&(s=S(n,"weights","sigmoidCrossEntropy")),je(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=J(r),l=J(1),c=J(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var d=function(f,h){var v=S(f,"labels","sigmoidCrossEntropyWithLogits"),y=S(h,"logits","sigmoidCrossEntropyWithLogits");je(v.shape,y.shape,"Error in sigmoidCrossEntropyWithLogits: ");var x=y.relu(),m=y.mul(v),g=y.abs().neg().exp().log1p();return x.sub(m).add(g)}(a,i);return kr(d,s,o)}}),z4=A({softmaxCrossEntropy_:function(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Lt.SUM_BY_NONZERO_WEIGHTS);var a=S(e,"onehotLabels","softmaxCrossEntropy"),i=S(t,"logits","softmaxCrossEntropy"),s=null;if(n!=null&&(s=S(n,"weights","softmaxCrossEntropy")),je(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=J(r),l=J(1),c=J(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var d=function(f,h,v){if(v===void 0&&(v=-1),v===-1&&(v=h.rank-1),v!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+v);return Cl(function(y,x,m){var g=x.logSumExp([v],!0),b=x.toFloat().sub(g);return m([y,b]),{value:b.mul(y).neg().sum([v]),gradFunc:function(w,C){var _=C[0],E=C[1],k=tn(w.shape,[v]);return[w.reshape(k).mul(_.toFloat().sub(E.exp())),w.reshape(k).mul(E.exp().sub(_.toFloat()))]}}})(f,h)}(a,i);return kr(d,s,o)}}),U4=Object.freeze({get Reduction(){return Lt},absoluteDifference:F4,computeWeightedLoss:kr,cosineDistance:j4,hingeLoss:M4,huberLoss:O4,logLoss:L4,meanSquaredError:B4,sigmoidCrossEntropy:W4,softmaxCrossEntropy:z4});function fv(e,t){return t===void 0&&(t=!1),j.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=Ry(n),a=e.clone(),i=Zr([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,l=function(d){var f,h=a,v=s,y=o;f=j.tidy(function(){var x=a.slice([d,d],[n-d,1]),m=x.norm(),g=a.slice([d,d],[1,1]),b=Zr([[-1]]).where(g.greater(0),Zr([[1]])),w=g.sub(b.mul(m)),C=x.div(w);s=C.shape[0]===1?i.clone():i.concat(C.slice([1,0],[C.shape[0]-1,C.shape[1]]),0);var _=b.matMul(w).div(m).neg(),E=a.slice([d,0],[n-d,r]),k=_.mul(s);if(d===0)a=E.sub(k.matMul(s.transpose().matMul(E)));else{var R=E.sub(k.matMul(s.transpose().matMul(E)));a=a.slice([0,0],[d,r]).concat(R,0)}var N=o.slice([0,d],[n,o.shape[1]-d]);if(d===0)o=N.sub(N.matMul(s).matMul(k.transpose()));else{var P=N.sub(N.matMul(s).matMul(k.transpose()));o=o.slice([0,0],[n,d]).concat(P,1)}return[s,a,o]}),s=f[0],a=f[1],o=f[2],en([h,v,y])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]})}var $4=A({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=S(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=i),n<0&&(n=s);var u=Wu(0,i,1,"int32").reshape([-1,1]),l=Wu(0,s,1,"int32"),c=gt(u,l),d=kl(c.lessEqual(J(+t,"int32")),c.greaterEqual(J(-n,"int32"))),f=Ue([i,s],r.dtype);return hn(mt(r.reshape([-1,i,s])).map(function(h){return Oo(d,h,f)})).reshape(o)}}),V4=A({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,I(e!=null&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(u){I(e[u].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[u].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=lh(e,e.shape[0],0).map(function(u){return Ty(u,[0])});I(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],i=e,s=function(u){a.push(j.tidy(function(){var l=i[u];if(u>0)for(var c=0;c<u;++c){var d=Sx(a[c].mulStrict(l)).mul(a[c]);l=l.sub(d)}return l.div(Tx(l,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?hn(a,0):a}}),H4=A({qr_:function(e,t){if(t===void 0&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return fv(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(i,s){return i*s}),r=mt(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return r.forEach(function(i){var s=fv(i,t),u=s[0],l=s[1];o.push(u),a.push(l)}),[hn(o,0).reshape(e.shape),hn(a,0).reshape(e.shape)]}}),G4=Object.freeze({bandPart:$4,gramSchmidt:V4,qr:H4});function Rl(e,t,n,r,o,a){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),a==null&&(a=0);var i=e.shape[0];return n=Math.min(n,i),I(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),I(e.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),I(e.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),I(t.rank===1,function(){return"scores must be a 1D tensor"}),I(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),I(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var q4=A({resizeBilinear_:function(e,t,n){n===void 0&&(n=!1);var r=S(e,"images","resizeBilinear");I(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),I(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;r.rank===3&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=j.runKernelFunc(function(l,c){return c([o]),l.resizeBilinear(o,i,s,n)},{x:o},function(l,c){return{x:function(){return j.runKernelFunc(function(d){return d.resizeBilinearBackprop(l,c[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),K4=A({resizeNearestNeighbor_:function(e,t,n){n===void 0&&(n=!1);var r=S(e,"images","resizeNearestNeighbor");I(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),I(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),I(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;r.rank===3&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=j.runKernelFunc(function(l,c){return c([o]),l.resizeNearestNeighbor(o,i,s,n)},{batchImages:o},function(l,c){return{batchImages:function(){return j.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(l,c[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),X4=A({nonMaxSuppression_:function(e,t,n,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var a=S(e,"boxes","nonMaxSuppression"),i=S(t,"scores","nonMaxSuppression"),s=Rl(a,i,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return j.runKernelFunc(function(l){return l.nonMaxSuppression(a,i,n,r,o)},{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),Y4=function(e,t,n,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),re(this,void 0,void 0,function(){var a,i,s,u,l,c,d;return oe(this,function(f){switch(f.label){case 0:return a=S(e,"boxes","nonMaxSuppressionAsync"),i=S(t,"scores","nonMaxSuppressionAsync"),s=Rl(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],d=hh(l,c,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,d]}})})},Q4=A({nonMaxSuppressionWithScore_:function(e,t,n,r,o,a){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),a===void 0&&(a=0);var i=S(e,"boxes","nonMaxSuppression"),s=S(t,"scores","nonMaxSuppression"),u=Rl(i,s,n,r,o,a),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},c=j.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),J4=function(e,t,n,r,o,a){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),a===void 0&&(a=0),re(this,void 0,void 0,function(){var i,s,u,l,c,d,f;return oe(this,function(h){switch(h.label){case 0:return i=S(e,"boxes","nonMaxSuppressionAsync"),s=S(t,"scores","nonMaxSuppressionAsync"),u=Rl(i,s,n,r,o,a),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return l=h.sent(),c=l[0],d=l[1],f=ph(c,d,n,r,o,a),i!==e&&i.dispose(),s!==t&&s.dispose(),[2,f]}})})},Z4=A({cropAndResize_:function(e,t,n,r,o,a){var i=S(e,"image","cropAndResize"),s=S(t,"boxes","cropAndResize","float32"),u=S(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return I(i.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),I(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),I(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),I(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),I(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),I(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),j.runKernelFunc(function(c,d){return c.cropAndResize(i,s,u,r,o,a)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),Rh=Object.freeze({resizeBilinear:q4,resizeNearestNeighbor:K4,nonMaxSuppression:X4,nonMaxSuppressionAsync:Y4,nonMaxSuppressionWithScore:Q4,nonMaxSuppressionWithScoreAsync:J4,cropAndResize:Z4}),Ih=function(e,t){return!(e>0)||t==="linear"},Dh=function(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Th=function(e,t){var n=t,r=vt(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Ah=function(e,t,n){if(t==="linear")return e;if(t==="relu")return Ke(e);if(t==="elu")return Rx(e);if(t==="relu6")return Dx(e);if(t==="prelu")return Ix(e,n);throw new Error("Unknown fused activation "+t+".")},e3=A({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,a=o!==void 0&&o,i=e.transposeB,s=i!==void 0&&i,u=e.bias,l=e.activation,c=l===void 0?"linear":l,d=e.preluActivationWeights;if(Ih(j.state.gradientDepth,c)===!1){var f=Nl(n,r,a,s);return u!=null&&(f=we(f,u)),Ah(f,c,d)}var h=S(n,"a","fused matMul"),v=S(r,"b","fused matMul");t=Qe(h,v),h=t[0],v=t[1];var y=a?h.shape[h.rank-2]:h.shape[h.rank-1],x=s?v.shape[v.rank-1]:v.shape[v.rank-2],m=a?h.shape[h.rank-1]:h.shape[h.rank-2],g=s?v.shape[v.rank-2]:v.shape[v.rank-1],b=h.shape.slice(0,-2),w=v.shape.slice(0,-2),C=se(b),_=se(w);I(h.rank>=2&&v.rank>=2&&h.rank===v.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+v.rank+"."}),I(Ct(b,w),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+w+") of Tensors with shapes "+h.shape+" and "+v.shape+" must match."}),I(y===x,function(){return"Error in fused matMul: inner shapes ("+y+") and ("+x+") of Tensors with shapes "+h.shape+" and "+v.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var E,k,R=h.shape.slice(0,-2).concat([m,g]),N=a?h.as3D(C,y,m):h.as3D(C,m,y),P=s?v.as3D(_,g,x):v.as3D(_,x,g);u!=null&&Ce(R,(E=Qe(E=S(u,"bias","fused matMul"),h)[0]).shape),d!=null&&(k=S(d,"prelu weights","fused matMul"));var T={a:N,b:P};u!=null&&(T.bias=E),d!=null&&(T.preluActivationWeights=k);var D=[N,P];return j.runKernelFunc(function(B,W){var U=B.fusedBatchMatMul({a:N,b:P,transposeA:a,transposeB:s,bias:E,activation:c,preluActivationWeights:k});return W([N,P,U]),U},T,function(B,W){var U=W[0],$=W[1],F=W[2],O=Dh(B,F,c),L={};return u!=null&&(L={bias:function(){return Th(E,O)}}),Object.assign(a||s?!a&&s?{a:function(){return O.matMul($,!1,!1)},b:function(){return O.matMul(U,!0,!1)}}:a&&!s?{a:function(){return $.matMul(O,!1,!0)},b:function(){return U.matMul(O,!1,!1)}}:{a:function(){return $.matMul(O,!0,!0)},b:function(){return O.matMul(U,!0,!0)}}:{a:function(){return O.matMul($,!1,!0)},b:function(){return U.matMul(O,!0,!1)}},L)},"_FusedMatMul",{transposeA:a,transposeB:s,activation:c},D,[!0]).reshape(R)}}),t3=A({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=a===void 0?"NHWC":a,s=e.dilations,u=s===void 0?[1,1]:s,l=e.dimRoundingMode,c=e.bias,d=e.activation,f=d===void 0?"linear":d,h=e.preluActivationWeights;if(f=f||"linear",Ih(j.state.gradientDepth,f)===!1){var v=Sn(t,n,r,o,i,u,l);return c!=null&&(v=we(v,c)),Ah(v,f,h)}var y=S(t,"x","conv2d"),x=S(n,"filter","conv2d"),m=y,g=!1;y.rank===3&&(g=!0,m=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),I(m.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),I(x.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+x.rank+"."}),l!=null&&I(et(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),I(m.shape[3]===x.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+x.shape[2]+"."}),I(nn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),I(i==="NHWC",function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var b,w,C=$o(m.shape,x.shape,r,u,o,l);c!=null&&(b=Qe(b=S(c,"bias","fused conv2d"),y)[0],Ce(C.outShape,b.shape)),h!=null&&(w=S(h,"prelu weights","fused conv2d"));var _={x:m,filter:x};c!=null&&(_.bias=b),h!=null&&(_.preluActivationWeights=w);var E=[x,m],k=j.runKernelFunc(function(R,N){var P=R.fusedConv2d({input:m,filter:x,convInfo:C,bias:b,activation:f,preluActivationWeights:w});return N([x,m,P]),P},_,function(R,N){var P=N,T=P[0],D=P[1],B=P[2],W=Dh(R,B,f);I(Ba(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var U={};return c!=null&&(U={bias:function(){return Th(b,W)}}),Object.assign({x:function(){return bx(D.shape,W,T,r,o)},filter:function(){return Ch(D,W,T.shape,r,o)}},U)},"FusedConv2D",{convInfo:C,activation:f},E,[!0]);return g?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),n3=A({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=a===void 0?"NHWC":a,s=e.dilations,u=s===void 0?[1,1]:s,l=e.dimRoundingMode,c=e.bias,d=e.activation,f=d===void 0?"linear":d,h=e.preluActivationWeights;if(Ih(j.state.gradientDepth,f)===!1){var v=El(t,n,r,o,i,u,l);return c!=null&&(v=we(v,c)),Ah(v,f,h)}var y=S(t,"x","depthwiseConv2d"),x=S(n,"filter","depthwiseConv2d"),m=y,g=!1;y.rank===3&&(g=!0,m=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),I(m.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),I(x.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+x.rank+"."}),I(m.shape[3]===x.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+x.shape[2]+"."}),u==null&&(u=[1,1]),I(nn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&I(et(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var b,w,C=$o(m.shape,x.shape,r,u,o,l,!0);c!=null&&(b=Qe(b=S(c,"bias","fused conv2d"),y)[0],Ce(C.outShape,b.shape)),h!=null&&(w=S(h,"prelu weights","fused depthwiseConv2d"));var _={x:m,filter:x};c!=null&&(_.bias=b),h!=null&&(_.preluActivationWeights=w);var E=[x,m],k=j.runKernelFunc(function(R,N){var P=R.fusedDepthwiseConv2D({input:m,filter:x,convInfo:C,bias:b,activation:f,preluActivationWeights:w});return N([x,m,P]),P},_,function(R,N){I(Ba(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var P=N[0],T=N[1],D=N[2],B=Dh(R,D,f),W={};return c!=null&&(W={bias:function(){return Th(b,B)}}),Object.assign({x:function(){return wx(T.shape,B,P,C)},filter:function(){return Cx(T,B,P.shape,C)}},W)},"FusedDepthwiseConv2D",{convInfo:C,activation:f},E,[!0]);return g?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),r3=Object.freeze({matMul:e3,conv2d:t3,depthwiseConv2d:n3}),o3=Object.freeze({image:Rh,linalg:G4,losses:U4,spectral:S4,fused:r3,signal:A4,square:LN,squaredDifference:ox,conv1d:qS,conv2d:Sn,conv3d:KS,depthwiseConv2d:El,separableConv2d:_h,conv2dTranspose:XS,conv3dTranspose:YS,op:A,batchNormalization2d:pS,batchNormalization3d:mS,batchNormalization4d:vS,batchNormalization:gS,batchNorm:cx,batchNorm2d:yS,batchNorm3d:xS,batchNorm4d:bS,booleanMaskAsync:GS,complex:Nt,real:wn,imag:Qn,concat:pt,concat1d:rk,concat2d:ok,concat3d:ak,concat4d:ik,split:lh,matMul:Nl,dot:QS,outerProduct:JS,reverse:us,reverse1d:ZS,reverse2d:e4,reverse3d:t4,reverse4d:n4,maxPool:xt,avgPool:ls,pool:r4,maxPool3d:o4,avgPool3d:a4,slice:or,slice1d:i4,slice2d:s4,slice3d:Ex,slice4d:u4,abs:BN,acos:WN,acosh:zN,asin:UN,asinh:$N,atan:VN,atanh:HN,ceil:GN,clipByValue:xh,cos:qN,cosh:KN,erf:XN,exp:Xd,expm1:YN,floor:QN,log:JN,log1p:ZN,logSigmoid:eS,neg:Ku,reciprocal:tS,round:nS,rsqrt:ax,sigmoid:ix,sign:rS,isNaN:oS,isInf:aS,isFinite:iS,sin:sS,sinh:uS,softplus:lS,sqrt:cS,step:dS,tan:fS,tanh:hS,all:l4,any:c4,argMax:d4,argMin:f4,logSumExp:h4,max:Sl,mean:p4,min:m4,moments:v4,sum:Sx,prod:g4,equal:mx,equalStrict:MS,greater:OS,greaterEqual:vx,greaterEqualStrict:LS,greaterStrict:BS,less:WS,lessEqual:zS,lessEqualStrict:US,lessStrict:$S,notEqual:VS,notEqualStrict:HS,add:we,addN:_S,addStrict:kS,atan2:ES,div:Pn,divNoNan:NS,divStrict:SS,floorDiv:hx,maximum:bh,maximumStrict:RS,minimum:px,minimumStrict:IS,mod:DS,modStrict:TS,mul:Bt,mulStrict:AS,pow:Xu,powStrict:PS,squaredDifferenceStrict:FS,sub:gt,subStrict:jS,elu:Rx,leakyRelu:y4,prelu:Ix,relu:Ke,relu6:Dx,selu:x4,logicalAnd:kl,logicalNot:wS,logicalOr:dx,logicalXor:CS,where:Oo,whereAsync:fx,buffer:ve,print:mk,batchToSpaceND:Sy,broadcastTo:vk,cast:gk,clone:yk,cumsum:xk,depthToSpace:bk,expandDims:bn,eye:Ry,multinomial:wk,oneHot:Hd,pad:Uo,pad1d:Ck,pad2d:_k,pad3d:kk,pad4d:Ek,rand:Nk,randomNormal:Sk,randomGamma:Rk,randomUniform:Iy,reshape:jn,spaceToBatchND:Dy,squeeze:Ty,stack:hn,tile:Ca,truncatedNormal:Ik,unstack:mt,setdiff1dAsync:Dk,fill:rr,linspace:nk,ones:qa,range:Wu,scalar:J,tensor:Rt,tensor1d:ut,tensor2d:Zr,tensor3d:uh,tensor4d:Kt,tensor5d:Z_,tensor6d:ek,variable:tk,zeros:Ue,onesLike:Ny,zerosLike:Se,transpose:ao,softmax:_r,logSoftmax:Ok,localResponseNormalization:b4,norm:Tx,gather:wh,unsortedSegmentSum:gx,basicLSTMCell:w4,multiRNNCell:C4,movingAverage:_4,stridedSlice:k4,topk:E4,scatterND:N4,fft:kh,ifft:Yu,rfft:Eh,irfft:Ax,sparseToDense:R4,gatherND:I4,diag:D4,dropout:T4,hannWindow:Nh,hammingWindow:Fx,frame:Sh,stft:jx,inTopKAsync:P4});function X(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(n){n!=null&&I(n.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function Nc(e,t,n,r){if(n==="linear")return e.linear(t);if(n==="relu")return e.relu(t);if(n==="elu")return e.elu(t);if(n==="relu6")return e.relu6(t);if(n==="prelu")return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var a3=function(e){function t(){var n=e.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new Ly(n,j),n}return Wn(t,e),t.prototype.write=function(n,r,o){this.firstUse&&(this.firstUse=!1,H().get("IS_NODE")&&Lu(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var a={};return this.data.set(a,{values:n,dtype:o}),a},t.prototype.move=function(n,r,o,a){this.data.set(n,{values:r,dtype:a})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(n){return re(this,void 0,void 0,function(){return oe(this,function(r){return[2,this.readSync(n)]})})},t.prototype.readSync=function(n){var r=this.data.get(n),o=r.dtype,a=r.complexTensors;return o==="complex64"?Kd(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(n).values},t.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),o=r;if(n.dtype==="string")try{o=r.map(function(a){return ju(a)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ve(n.shape,n.dtype,o)},t.prototype.makeOutput=function(n,r,o){var a=this.write(n,r,o);return j.makeTensorFromDataId(a,r,o,this)},t.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},t.prototype.time=function(n){return re(this,void 0,void 0,function(){var r;return oe(this,function(o){return r=Kn(),n(),[2,{kernelMs:Kn()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(n,r){var o=this.makeOutput(null,n.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:j.keep(n.clone()),imag:j.keep(r.clone())},o},t.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,o){if(X(n,"slice"),My(n.shape,r,o)){var a=Oy(r,n.strides),i=se(o);return Rt(this.readSync(n.dataId).subarray(a,a+i),o,n.dtype)}for(var s=ve(o,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(d,f){return d+r[f]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},t.prototype.stridedSlice=function(n,r,o,a){X(n,"stridedSlice");var i=dh(r,o,a);if(i.some(function(h){return h===0}))return Rt([],i);for(var s=ve(i,n.dtype),u=this.bufferSync(n),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),d=new Array(c.length),f=0;f<d.length;f++)d[f]=c[f]*a[f]+r[f];s.set.apply(s,[u.get.apply(u,d)].concat(c))}return s.toTensor()},t.prototype.diag=function(n){for(var r=this.readSync(n.dataId),o=ve([n.size,n.size],n.dtype),a=o.values,i=0;i<r.length;i++)a[i*n.size+i]=r[i];return o.toTensor()},t.prototype.unstack=function(n,r){for(var o=n.shape[r],a=new Array(n.rank-1),i=0,s=0;s<n.rank;s++)s!==r&&(a[i++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(a);return c},t.prototype.reverse=function(n,r){X(n,"reverse");for(var o=ve(n.shape,n.dtype),a=this.bufferSync(n),i=function(u){var l=o.indexToLoc(u),c=l.slice();r.forEach(function(d){return c[d]=n.shape[d]-1-c[d]}),o.set.apply(o,[a.get.apply(a,c)].concat(l))},s=0;s<o.size;s++)i(s);return o.toTensor()},t.prototype.concat=function(n,r){var o=this;if(n[0].dtype==="complex64"){var a=n.map(function(h){return wn(h)}),i=n.map(function(h){return Qn(h)});return Nt(this.concat(a,r),this.concat(i,r))}var s=n.map(function(h){var v=se(h.shape.slice(r));return h.as2D(-1,v)}),u=La(s.map(function(h){return h.shape}),1),l=ve(u,n[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(h){l.set(o.readSync(h.dataId),c),c+=h.size})}else{var d=0;s.forEach(function(h){for(var v=o.readSync(h.dataId),y=0,x=0;x<h.shape[0];++x)for(var m=x*u[1]+d,g=0;g<h.shape[1];++g)l[m+g]=v[y++];d+=h.shape[1]})}var f=La(n.map(function(h){return h.shape}),r);return Rt(l,f,n[0].dtype)},t.prototype.neg=function(n){return X(n,"neg"),this.multiply(J(-1),n)},t.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,a,i,s){return{real:o+i,imag:a+s}}):this.broadcastedBinaryOp(n,r,St(n.dtype,r.dtype),function(o,a){return o+a})},t.prototype.addN=function(n){var r=this;X(n,"addN");for(var o=n.map(function(c){return r.readSync(c.dataId)}),a=ve(n[0].shape,n[0].dtype),i=a.values,s=0;s<n.length;s++)for(var u=o[s],l=0;l<i.length;l++)i[l]+=u[l];return a.toTensor()},t.prototype.softmax=function(n,r){var o=yt([r],n.shape),a=this.max(n,o),i=tn(a.shape,o),s=this.subtract(n,a.reshape(i)),u=this.exp(s),l=this.sum(u,o).reshape(i);return this.realDivide(u,l)},t.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,a,i,s){return{real:o-i,imag:a-s}}):this.broadcastedBinaryOp(n,r,St(n.dtype,r.dtype),function(o,a){return o-a})},t.prototype.pow=function(n,r){return X([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,a){return Math.pow(o,a)})},t.prototype.batchMatMul=function(n,r,o,a){X([n,r],"matMul");for(var i=o?n.shape[1]:n.shape[2],s=o?n.shape[2]:n.shape[1],u=a?r.shape[1]:r.shape[2],l=n.shape[0],c=this.readSync(n.dataId),d=this.readSync(r.dataId),f=o?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],h=f[0],v=f[1],y=f[2],x=a?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],m=x[0],g=x[1],b=x[2],w=s*u,C=ve([l,s,u],n.dtype),_=C.values,E=this.blockSize,k=0;k<l;k++)for(var R=0;R<s;R+=E)for(var N=0;N<u;N+=E)for(var P=0;P<i;P+=E)for(var T=Math.min(R+E,s),D=Math.min(N+E,u),B=Math.min(P+E,i),W=R;W<T;W++)for(var U=N;U<D;U++){for(var $=0,F=P;F<B;F++)$+=c[k*h+W*v+F*y]*d[F*m+U*g+k*b];_[k*w+(W*u+U)]+=$}return C.toTensor()},t.prototype.fusedBatchMatMul=function(n){var r=n.a,o=n.b,a=n.transposeA,i=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=this.batchMatMul(r,o,a,i);return s&&(c=this.add(c,s)),u&&(c=Nc(this,c,u,l)),c},t.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,a,i,s){return{real:o*i-a*s,imag:o*s+a*i}}):this.broadcastedBinaryOp(n,r,St(n.dtype,r.dtype),function(o,a){return o*a})},t.prototype.realDivide=function(n,r){return X([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(o,a){return o/a})},t.prototype.floorDiv=function(n,r){return X([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(o,a){return Math.floor(o/a)})},t.prototype.sum=function(n,r){X(n,"sum"),an("sum",r,n.rank);for(var o=Ft(n.shape,r),a=o[0],i=o[1],s=Ue(a,St(n.dtype,"int32")),u=se(i),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=0,v=0;v<u;++v)h+=c[f+v];l[d]=h}return s},t.prototype.prod=function(n,r){X(n,"sum");for(var o=Ft(n.shape,r),a=o[0],i=o[1],s=Ue(a,St(n.dtype,"int32")),u=se(i),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=1,v=0;v<u;++v)h*=c[f+v];l[d]=h}return s},t.prototype.unsortedSegmentSum=function(n,r,o){X(n,"unsortedSegmentSum");for(var a=[],i=n.rank-r.rank,s=0;s<i;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=J(s,"int32"),l=mx(u,r).asType("float32").mul(n).sum(0);a.push(l)}return hn(a)},t.prototype.argMin=function(n,r){X(n,"argMin");var o=[r];an("argMin",o,n.rank);for(var a=Ft(n.shape,o),i=a[0],s=a[1],u=Ue(i,"int32"),l=se(s),c=this.readSync(u.dataId),d=this.readSync(n.dataId),f=0;f<c.length;++f){for(var h=f*l,v=d[h],y=0,x=0;x<l;++x){var m=d[h+x];m<v&&(v=m,y=x)}c[f]=y}return u},t.prototype.argMax=function(n,r){X(n,"argMax");var o=[r];an("argMax",o,n.rank);for(var a=Ft(n.shape,o),i=a[0],s=a[1],u=Ue(i,"int32"),l=se(s),c=this.readSync(u.dataId),d=this.readSync(n.dataId),f=0;f<c.length;++f){for(var h=f*l,v=d[h],y=0,x=0;x<l;++x){var m=d[h+x];m>v&&(v=m,y=x)}c[f]=y}return u},t.prototype.cumsum=function(n,r,o,a){if(X(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var i=St(n.dtype,"int32"),s=Ue(n.shape,i),u=this.readSync(s.dataId),l=this.readSync(n.dataId),c=n.shape[n.rank-1],d=a?function(x,m){return x+c-m-1}:function(x,m){return x+m},f=0;f<l.length;f+=c)for(var h=0;h<c;h++){var v=d(f,h);if(h===0)u[v]=o?0:l[v];else{var y=d(f,h-1);u[v]=o?l[y]+u[y]:l[v]+u[y]}}return s},t.prototype.equal=function(n,r){return X([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(o,a){return o===a?1:0})},t.prototype.notEqual=function(n,r){return X([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,a){return o!==a?1:0})},t.prototype.less=function(n,r){return X([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(o,a){return o<a?1:0})},t.prototype.lessEqual=function(n,r){return X([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,a){return o<=a?1:0})},t.prototype.greater=function(n,r){return X([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(o,a){return o>a?1:0})},t.prototype.greaterEqual=function(n,r){return X([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,a){return o>=a?1:0})},t.prototype.logicalNot=function(n){X(n,"logicalNot");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),a=0;a<r.length;++a)o[a]=r[a]?0:1;return this.makeOutput(o,n.shape,"bool")},t.prototype.logicalAnd=function(n,r){return X([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(o,a){return o&&a})},t.prototype.logicalOr=function(n,r){return X([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(o,a){return o||a})},t.prototype.select=function(n,r,o){X([n,r,o],"select");for(var a=this.readSync(n.dataId),i=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Ue(r.shape,St(r.dtype,o.dtype)),l=this.readSync(u.dataId),c=0,d=n.rank===0||n.rank>1||r.rank===1?1:se(r.shape.slice(1)),f=0;f<a.length;f++)for(var h=0;h<d;h++)a[f]===1?l[c++]=i[f]:l[c++]=s[f];return u},t.prototype.where=function(n){X([n],"where");var r=this.readSync(n.dataId);return mh(n.shape,r)},t.prototype.topk=function(n,r,o){return X(n,"topk"),Gy(this.readSync(n.dataId),n.shape,n.dtype,r)},t.prototype.min=function(n,r){X(n,"min"),an("min",r,n.rank);for(var o=Ft(n.shape,r),a=o[0],i=o[1],s=Ue(a,n.dtype),u=se(i),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],v=0;v<u;++v){var y=c[f+v];y<h&&(h=y)}l[d]=h}return s},t.prototype.minimum=function(n,r){return X([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,a){return Math.min(o,a)})},t.prototype.mod=function(n,r){return X([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,a){var i=o%a;return o<0&&a<0||o>=0&&a>=0?i:(i+a)%a})},t.prototype.max=function(n,r){X(n,"max"),an("max",r,n.rank);for(var o=Ft(n.shape,r),a=o[0],i=o[1],s=Ue(a,n.dtype),u=se(i),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],v=0;v<u;++v){var y=c[f+v];y>h&&(h=y)}l[d]=h}return s},t.prototype.maximum=function(n,r){return X([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,a){return Math.max(o,a)})},t.prototype.all=function(n,r){X(n,"all"),an("all",r,n.rank);for(var o=Ft(n.shape,r),a=o[0],i=o[1],s=Ue(a,n.dtype),u=se(i),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],v=0;v<u;++v){var y=c[f+v];h=h&&y}l[d]=h}return s},t.prototype.any=function(n,r){X(n,"any"),an("any",r,n.rank);for(var o=Ft(n.shape,r),a=o[0],i=o[1],s=Ue(a,n.dtype),u=se(i),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],v=0;v<u;++v){var y=c[f+v];h=h||y}l[d]=h}return s},t.prototype.squaredDifference=function(n,r){return X([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,a){var i=o-a;return i*i})},t.prototype.ceil=function(n){X(n,"ceil");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=Math.ceil(r[a]);return this.makeOutput(o,n.shape,"float32")},t.prototype.floor=function(n){X(n,"floor");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=Math.floor(r[a]);return this.makeOutput(o,n.shape,"float32")},t.prototype.sign=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)r[a]<0?o[a]=-1:r[a]>0?o[a]=1:o[a]=0;return this.makeOutput(o,n.shape,"float32")},t.prototype.isNaN=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isNaN(r[a])&&(o[a]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.isInf=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),a=0;a<r.length;++a)Math.abs(r[a])===1/0&&(o[a]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.isFinite=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),a=0;a<r.length;++a)Number.isFinite(r[a])&&(o[a]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.round=function(n){X(n,"round");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=Math.floor(r[a]);r[a]-i<.5?o[a]=Math.floor(r[a]):r[a]-i>.5?o[a]=Math.ceil(r[a]):o[a]=i%2==0?i:i+1}return this.makeOutput(o,n.shape,"float32")},t.prototype.exp=function(n){X(n,"exp");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=Math.exp(r[a]);return this.makeOutput(o,n.shape,"float32")},t.prototype.expm1=function(n){X(n,"expm1");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=Math.expm1(r[a]);return this.makeOutput(o,n.shape,"float32")},t.prototype.log=function(n){X(n,"log");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=r[a];o[a]=Math.log(i)}return this.makeOutput(o,n.shape,"float32")},t.prototype.log1p=function(n){X(n,"log1p");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=r[a];o[a]=Math.log1p(i)}return this.makeOutput(o,n.shape,"float32")},t.prototype.sqrt=function(n){X(n,"sqrt");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=r[a];o[a]=Math.sqrt(i)}return this.makeOutput(o,n.shape,"float32")},t.prototype.rsqrt=function(n){X(n,"rsqrt");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a){var i=r[a];o[a]=1/Math.sqrt(i)}return this.makeOutput(o,n.shape,"float32")},t.prototype.reciprocal=function(n){X(n,"reciprocal");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),a=0;a<r.length;++a)o[a]=1/r[a];return this.makeOutput(o,n.shape,"float32")},t.prototype.linear=function(n){return n},t.prototype.relu=function(n){X(n,"relu");for(var r=Ue(n.shape,n.dtype),o=this.readSync(r.dataId),a=this.readSync(n.dataId),i=0;i<a.length;++i)o[i]=Math.max(0,a[i]);return r},t.prototype.relu6=function(n){X(n,"relu");for(var r=Ue(n.shape,n.dtype),o=this.readSync(r.dataId),a=this.readSync(n.dataId),i=0;i<a.length;++i)o[i]=Math.min(Math.max(0,a[i]),6);return r},t.prototype.prelu=function(n,r){return X([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,a){return o<0?a*o:o})},t.prototype.elu=function(n){X(n,"elu");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?i:Math.exp(i)-1}return this.makeOutput(r,n.shape,"float32")},t.prototype.eluDer=function(n,r){X([n,r],"eluDer");for(var o=new Float32Array(r.size),a=this.readSync(r.dataId),i=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=1?i[s]:i[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},t.prototype.selu=function(n){X(n,"selu");for(var r=gh,o=yh,a=new Float32Array(n.size),i=this.readSync(n.dataId),s=0;s<i.length;++s){var u=i[s];a[s]=u>=0?o*u:r*(Math.exp(u)-1)}return this.makeOutput(a,n.shape,"float32")},t.prototype.clip=function(n,r,o){X(n,"clip");for(var a=new Float32Array(n.size),i=this.readSync(n.dataId),s=0;s<i.length;++s){var u=i[s];a[s]=u>o?o:u<r?r:u}return this.makeOutput(a,n.shape,"float32")},t.prototype.abs=function(n){for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.abs(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<n.size;++a){var i=o[2*a],s=o[2*a+1];r[a]=Math.hypot(i,s)}return this.makeOutput(r,n.shape,"float32")},t.prototype.int=function(n){X(n,"int");for(var r=new Int32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=o[a];return this.makeOutput(r,n.shape,"int32")},t.prototype.sigmoid=function(n){X(n,"sigmoid");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=1/(1+Math.exp(-o[a]));return this.makeOutput(r,n.shape,"float32")},t.prototype.softplus=function(n){X(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(n.size),a=this.readSync(n.dataId),i=0;i<a.length;++i){var s=a[i]>-r,u=a[i]<r,l=Math.exp(a[i]),c=void 0;c=u?l:s?a[i]:Math.log(1+l),o[i]=c}return this.makeOutput(o,n.shape,"float32")},t.prototype.sin=function(n){X(n,"sin");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.sin(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cos=function(n){X(n,"cos");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.cos(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tan=function(n){X(n,"tan");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.tan(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asin=function(n){X(n,"asin");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.asin(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acos=function(n){X(n,"acos");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.acos(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan=function(n){X(n,"atan");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.atan(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan2=function(n,r){return X([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,a){return Math.atan2(o,a)})},t.prototype.sinh=function(n){X(n,"sinh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.sinh(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cosh=function(n){X(n,"cosh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.cosh(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tanh=function(n){X(n,"tanh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=i_(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asinh=function(n){X(n,"asinh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.asinh(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acosh=function(n){X(n,"acosh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.acosh(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atanh=function(n){X(n,"atanh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a)r[a]=Math.atanh(o[a]);return this.makeOutput(r,n.shape,"float32")},t.prototype.erf=function(n){X(n,"erf");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a){var i=Math.sign(o[a]),s=Math.abs(o[a]),u=1/(1+.3275911*s);r[a]=i*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,n.shape,"float32")},t.prototype.step=function(n,r){r===void 0&&(r=0),X(n,"step");for(var o=new Float32Array(n.size),a=this.readSync(n.dataId),i=0;i<a.length;++i){var s=a[i];isNaN(s)?o[i]=NaN:o[i]=s>0?1:r}return this.makeOutput(o,n.shape,"float32")},t.prototype.fusedConv2d=function(n){var r=n.input,o=n.filter,a=n.convInfo,i=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.conv2d(r,o,a);return i&&(l=this.add(l,i)),s&&(l=Nc(this,l,s,u)),l},t.prototype.conv2d=function(n,r,o){X([n,r],"conv2d");for(var a=o.filterHeight,i=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,d=o.dataFormat==="channelsLast",f=ve(o.outShape,n.dtype),h=n.strides[0],v=d?n.strides[1]:n.strides[2],y=d?n.strides[2]:1,x=d?1:n.strides[1],m=f.strides[0],g=d?f.strides[1]:f.strides[2],b=d?f.strides[2]:1,w=d?1:f.strides[1],C=this.readSync(n.dataId),_=this.readSync(r.dataId),E=f.values,k=0;k<o.batchSize;++k)for(var R=k*h,N=k*m,P=0;P<o.outHeight;++P)for(var T=N+P*g,D=P*o.strideHeight-c,B=0;B<a;B++){var W=D+B*s;if(!(W<0||W>=o.inHeight))for(var U=B*r.strides[0],$=R+W*v,F=0;F<o.outWidth;++F)for(var O=T+F*b,L=F*o.strideWidth-l,G=0;G<i;G++){var Y=L+G*u;if(!(Y<0||Y>=o.inWidth))for(var Z=$+Y*y,de=U+G*r.strides[1],ne=0;ne<o.inChannels;++ne){for(var ae=C[Z+ne*x],pe=0;pe<o.outChannels;++pe)E[O+pe*w]+=ae*_[de+pe];de+=o.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(n,r,o){for(var a=o.filterDepth,i=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,l=o.dilationHeight,c=o.dilationWidth,d=o.padInfo.front,f=o.padInfo.left,h=o.padInfo.top,v=ve(o.outShape,n.dtype),y=this.readSync(n.dataId),x=this.readSync(r.dataId),m=v.values,g=0;g<o.batchSize;++g)for(var b=g*n.strides[0],w=g*v.strides[0],C=0;C<o.outDepth;++C)for(var _=w+C*v.strides[1],E=C*o.strideDepth-d,k=0;k<a;k++){var R=E+k*u;if(!(R<0||R>=o.inDepth))for(var N=k*r.strides[0],P=b+R*n.strides[1],T=0;T<o.outHeight;++T)for(var D=_+T*v.strides[2],B=T*o.strideHeight-h,W=0;W<i;W++){var U=B+W*l;if(!(U<0||U>=o.inHeight))for(var $=N+W*r.strides[1],F=P+U*n.strides[2],O=0;O<o.outWidth;++O)for(var L=D+O*o.outChannels,G=O*o.strideWidth-f,Y=0;Y<s;Y++){var Z=G+Y*c;if(!(Z<0||Z>=o.inWidth))for(var de=$+Y*r.strides[2],ne=F+Z*o.inChannels,ae=de,pe=0;pe<o.inChannels;++pe){for(var ge=y[ne+pe],ye=0;ye<o.outChannels;++ye)m[L+ye]+=ge*x[ae+ye];ae+=o.outChannels}}}}return v.toTensor()},t.prototype.conv2dDerInput=function(n,r,o){X([n,r],"conv2dDerInput");for(var a=ve(o.inShape,"float32"),i=a.values,s=this.readSync(n.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],d=l[1],f=l[2],h=o.batchSize,v=o.filterHeight,y=o.filterWidth,x=o.inChannels,m=o.inHeight,g=o.inWidth,b=o.outChannels,w=o.outHeight,C=o.outWidth,_=o.strideHeight,E=o.strideWidth,k=o.dataFormat,R=v-1-o.padInfo.top,N=y-1-o.padInfo.left,P=k==="channelsLast",T=a.strides[0],D=P?a.strides[1]:a.strides[2],B=P?a.strides[2]:1,W=P?1:a.strides[1],U=n.strides[0],$=P?n.strides[1]:n.strides[2],F=P?n.strides[2]:1,O=P?1:n.strides[1],L=0;L<h;++L)for(var G=0;G<x;++G)for(var Y=0;Y<m;++Y)for(var Z=Y-R,de=Math.max(0,Math.ceil(Z/_)),ne=Math.min(w,(v+Z)/_),ae=0;ae<g;++ae){for(var pe=ae-N,ge=Math.max(0,Math.ceil(pe/E)),ye=Math.min(C,(y+pe)/E),Ve=0,be=de;be<ne;++be)for(var Ee=be*_-Z,ke=ge;ke<ye;++ke)for(var Oe=U*L+$*be+F*ke,Ne=c*(v-1-Ee)+d*(y-1-(ke*E-pe))+f*G,Le=0;Le<b;++Le)Ve+=s[Oe+O*Le]*u[Ne+Le];i[T*L+D*Y+B*ae+W*G]=Ve}return a.toTensor()},t.prototype.conv3dDerInput=function(n,r,o){for(var a=ve(o.inShape,"float32"),i=a.values,s=a.strides,u=s[0],l=s[1],c=s[2],d=s[3],f=this.readSync(n.dataId),h=n.strides,v=h[0],y=h[1],x=h[2],m=h[3],g=this.readSync(r.dataId),b=r.strides,w=b[0],C=b[1],_=b[2],E=b[3],k=o.batchSize,R=o.filterDepth,N=o.filterHeight,P=o.filterWidth,T=o.inChannels,D=o.inDepth,B=o.inHeight,W=o.inWidth,U=o.outChannels,$=o.outDepth,F=o.outHeight,O=o.outWidth,L=o.strideDepth,G=o.strideHeight,Y=o.strideWidth,Z=R-1-o.padInfo.front,de=N-1-o.padInfo.top,ne=P-1-o.padInfo.left,ae=0;ae<k;++ae)for(var pe=0;pe<T;++pe)for(var ge=0;ge<D;++ge)for(var ye=ge-Z,Ve=Math.max(0,Math.ceil(ye/L)),be=Math.min($,(R+ye)/L),Ee=0;Ee<B;++Ee)for(var ke=Ee-de,Oe=Math.max(0,Math.ceil(ke/G)),Ne=Math.min(F,(N+ke)/G),Le=0;Le<W;++Le){for(var lt=Le-ne,Tt=Math.max(0,Math.ceil(lt/Y)),it=Math.min(O,(P+lt)/Y),rn=0,Gt=Ve;Gt<be;++Gt)for(var gn=Gt*L-ye,q=Oe;q<Ne;++q)for(var ie=q*G-ke,fe=Tt;fe<it;++fe)for(var Te=v*ae+y*Gt+x*q+m*fe,tt=w*(R-1-gn)+C*(N-1-ie)+_*(P-1-(fe*Y-lt))+E*pe,Re=0;Re<U;++Re)rn+=f[Te+Re]*g[tt+Re];i[u*ae+l*ge+c*Ee+d*Le+pe]=rn}return a.toTensor()},t.prototype.conv2dDerFilter=function(n,r,o){X([n,r],"conv2dDerFilter");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dataFormat==="channelsLast",c=ve(o.filterShape,"float32"),d=o.padInfo.left,f=o.padInfo.top,h=this.bufferSync(n),v=this.bufferSync(r),y=0;y<s;++y)for(var x=Math.max(0,Math.ceil((f-y)/a)),m=Math.min(o.outHeight,(o.inHeight+f-y)/a),g=0;g<u;++g)for(var b=Math.max(0,Math.ceil((d-g)/i)),w=Math.min(o.outWidth,(o.inWidth+d-g)/i),C=0;C<o.inChannels;++C)for(var _=0;_<o.outChannels;++_){for(var E=0,k=0;k<o.batchSize;++k)for(var R=x;R<m;++R)for(var N=y+R*a-f,P=b;P<w;++P){var T=g+P*i-d;E+=l?h.get(k,N,T,C)*v.get(k,R,P,_):h.get(k,C,N,T)*v.get(k,_,R,P)}c.set(E,y,g,C,_)}return c.toTensor()},t.prototype.conv3dDerFilter=function(n,r,o){for(var a=o.strideDepth,i=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,d=ve(o.filterShape,"float32"),f=d.values,h=d.strides,v=h[0],y=h[1],x=h[2],m=h[3],g=this.readSync(r.dataId),b=r.strides,w=b[0],C=b[1],_=b[2],E=b[3],k=this.readSync(n.dataId),R=n.strides,N=R[0],P=R[1],T=R[2],D=R[3],B=o.padInfo.front,W=o.padInfo.left,U=o.padInfo.top,$=0;$<u;++$)for(var F=Math.max(0,Math.ceil((B-$)/a)),O=Math.min(o.outDepth,(o.inDepth+B-$)/a),L=$*v,G=0;G<l;++G)for(var Y=Math.max(0,Math.ceil((U-G)/i)),Z=Math.min(o.outHeight,(o.inHeight+U-G)/i),de=G*y+L,ne=0;ne<c;++ne)for(var ae=Math.max(0,Math.ceil((W-ne)/s)),pe=Math.min(o.outWidth,(o.inWidth+W-ne)/s),ge=ne*x+de,ye=0;ye<o.inChannels;++ye)for(var Ve=ye*m+ge,be=0;be<o.outChannels;++be){for(var Ee=0,ke=0;ke<o.batchSize;++ke)for(var Oe=ke*N,Ne=ke*w,Le=F;Le<O;++Le)for(var lt=($+Le*a-B)*P+Oe,Tt=Le*C+Ne,it=Y;it<Z;++it)for(var rn=(G+it*i-U)*T+lt,Gt=it*_+Tt,gn=ae;gn<pe;++gn){var q=gn*E+Gt;Ee+=k[(ne+gn*s-W)*D+rn+ye]*g[q+be]}f[Ve+be]=Ee}return d.toTensor()},t.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,o=n.filter,a=n.convInfo,i=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.depthwiseConv2D(r,o,a);return i&&(l=this.add(l,i)),s&&(l=Nc(this,l,s,u)),l},t.prototype.depthwiseConv2D=function(n,r,o){X([n,r],"depthwiseConv2D");for(var a=o.filterHeight,i=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,d=o.outChannels/o.inChannels,f=ve(o.outShape,n.dtype),h=this.readSync(n.dataId),v=this.readSync(r.dataId),y=f.values,x=0;x<o.batchSize;++x)for(var m=x*n.strides[0],g=x*f.strides[0],b=0;b<o.outHeight;++b)for(var w=g+b*f.strides[1],C=b*o.strideHeight-l,_=0;_<a;++_){var E=C+_*s;if(!(E<0||E>=o.inHeight))for(var k=_*r.strides[0],R=m+E*n.strides[1],N=0;N<o.outWidth;++N)for(var P=w+N*f.strides[2],T=N*o.strideWidth-c,D=0;D<i;++D){var B=T+D*u;if(!(B<0||B>=o.inWidth))for(var W=k+D*r.strides[1],U=R+B*o.inChannels,$=P,F=W,O=0;O<o.inChannels;++O){for(var L=h[U+O],G=0;G<d;++G)y[$+G]+=L*v[F+G];$+=d,F+=d}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(n,r,o){X([n,r],"depthwiseConv2DDerInput");for(var a=ve(o.inShape,"float32"),i=a.values,s=a.strides,u=s[0],l=s[1],c=s[2],d=this.readSync(n.dataId),f=n.strides,h=f[0],v=f[1],y=f[2],x=this.readSync(r.dataId),m=r.strides,g=m[0],b=m[1],w=m[2],C=o.batchSize,_=o.filterHeight,E=o.filterWidth,k=o.inChannels,R=o.inHeight,N=o.inWidth,P=o.outChannels,T=o.outHeight,D=o.outWidth,B=o.strideHeight,W=o.strideWidth,U=_-1-o.padInfo.top,$=E-1-o.padInfo.left,F=P/k,O=0;O<C;++O)for(var L=0;L<k;++L)for(var G=0;G<R;++G)for(var Y=G-U,Z=Math.max(0,Math.ceil(Y/B)),de=Math.min(T,(_+Y)/B),ne=0;ne<N;++ne){for(var ae=ne-$,pe=Math.max(0,Math.ceil(ae/W)),ge=Math.min(D,(E+ae)/W),ye=0,Ve=Z;Ve<de;++Ve)for(var be=Ve*B-Y,Ee=pe;Ee<ge;++Ee)for(var ke=h*O+v*Ve+y*Ee,Oe=g*(_-1-be)+b*(E-1-(Ee*W-ae))+w*L,Ne=0;Ne<F;++Ne)ye+=d[ke+(L*F+Ne)]*x[Oe+Ne];i[u*O+l*G+c*ne+L]=ye}return a.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(n,r,o){X([n,r],"depthwiseConv2DDerFilter");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=ve(o.filterShape,"float32"),c=o.padInfo.left,d=o.padInfo.top,f=o.outChannels/o.inChannels,h=this.bufferSync(n),v=this.bufferSync(r),y=0;y<s;++y)for(var x=Math.max(0,Math.ceil((d-y)/a)),m=Math.min(o.outHeight,(o.inHeight+d-y)/a),g=0;g<u;++g)for(var b=Math.max(0,Math.ceil((c-g)/i)),w=Math.min(o.outWidth,(o.inWidth+c-g)/i),C=0;C<o.outChannels;++C){for(var _=Math.trunc(C/f),E=C%f,k=0,R=0;R<o.batchSize;++R)for(var N=x;N<m;++N)for(var P=y+N*a-d,T=b;T<w;++T){var D=g+T*i-c;k+=h.get(R,P,D,_)*v.get(R,N,T,C)}l.set(k,y,g,_,E)}return l.toTensor()},t.prototype.tile=function(n,r){return X(n,"tile"),Hy(this.bufferSync(n),r)},t.prototype.pad=function(n,r,o){X(n,"pad");var a=r.map(function(f,h){return f[0]+n.shape[h]+f[1]}),i=r.map(function(f){return f[0]}),s=this.bufferSync(n),u=ve(a,n.dtype);o!==0&&u.values.fill(o);for(var l=0;l<n.size;l++){var c=s.indexToLoc(l),d=c.map(function(f,h){return f+i[h]});u.set.apply(u,[s.get.apply(s,c)].concat(d))}return u.toTensor()},t.prototype.transpose=function(n,r){X(n,"transpose");for(var o=new Array(n.rank),a=0;a<o.length;a++)o[a]=n.shape[r[a]];var i=this.readSync(n.dataId),s=ve(o,n.dtype),u=this.bufferSync(n);for(a=0;a<n.size;++a){for(var l=u.indexToLoc(a),c=new Array(l.length),d=0;d<c.length;d++)c[d]=l[r[d]];var f=s.locToIndex(c);s.values[f]=i[a]}return s.toTensor()},t.prototype.gather=function(n,r,o){X([n,r],"gather");var a=n.shape.slice(),i=this.readSync(r.dataId);a[o]=i.length;for(var s=ve(a,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l),d=c.slice();d[o]=i[c[o]];var f=u.locToIndex(d);s.values[l]=u.values[f]}return s.toTensor()},t.prototype.batchToSpaceND=function(n,r,o){X([n],"batchToSpaceND");var a=r.reduce(function(d,f){return d*f}),i=zu(n.shape,r,a),s=Uu(i.length,r.length),u=$u(n.shape,r,a),l=Ay(o,r.length),c=Py(u,o,r.length);return n.reshape(i).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(n,r,o){X([n],"spaceToBatchND");var a=r.reduce(function(f,h){return f*h}),i=[[0,0]];i.push.apply(i,o);for(var s=1+r.length;s<n.shape.length;++s)i.push([0,0]);var u=n.pad(i),l=zu(u.shape,r,a,!1),c=Uu(l.length,r.length,!1),d=$u(u.shape,r,a,!1);return u.reshape(l).transpose(c).reshape(d)},t.prototype.pool=function(n,r,o){X(n,"pool");for(var a=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(n.dataId),y=ve(r.outShape,n.dtype),x=y.values,m=r.outShape[1]*r.outShape[2]*r.outShape[3],g=r.outShape[2]*r.outShape[3],b=r.outShape[3],w=0;w<r.batchSize;++w)for(var C=w*m,_=w*n.strides[0],E=0;E<r.inChannels;++E)for(var k=0;k<r.outHeight;++k)for(var R=k*a-d,N=Math.max(0,R),P=Math.min(r.inHeight,l+R),T=C+k*g,D=0;D<r.outWidth;++D){for(var B=D*i-f,W=Math.max(0,B),U=Math.min(r.inWidth,c+B),$=h,F=0,O=0,L=N;L<P;L+=s){for(var G=_+L*n.strides[1],Y=W;Y<U;Y+=u){var Z=v[G+Y*n.strides[2]+E];o==="max"&&Z>$?$=Z:o==="avg"&&(F+=Z,O++)}if(isNaN($))break}x[T+D*b+E]=o==="avg"?F/O:$}return y.toTensor()},t.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},t.prototype.maxPoolPositions=function(n,r){for(var o=ve(r.outShape,"int32"),a=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(n),v=0;v<r.batchSize;++v)for(var y=0;y<r.inChannels;++y)for(var x=0;x<r.outHeight;++x){for(var m=x*a-d,g=m;g<0;)g+=s;for(var b=Math.min(r.inHeight,l+m),w=0;w<r.outWidth;++w){for(var C=w*i-f,_=C;_<0;)_+=u;for(var E=Math.min(r.inWidth,c+C),k=Number.NEGATIVE_INFINITY,R=-1,N=g;N<b;N+=s)for(var P=N-m,T=_;T<E;T+=u){var D=T-C,B=h.get(v,N,T,y);B>k&&(k=B,R=P*c+D)}o.set(R,v,x,w,y)}}return o.toTensor()},t.prototype.maxPoolBackprop=function(n,r,o,a){X([r,o],"maxPoolBackprop");for(var i=this.maxPoolPositions(r,a),s=a.strideHeight,u=a.strideWidth,l=a.dilationHeight,c=a.dilationWidth,d=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=f-1-a.padInfo.left,v=d-1-a.padInfo.top,y=ve(r.shape,"float32"),x=this.bufferSync(i),m=this.bufferSync(n),g=0;g<a.batchSize;++g)for(var b=0;b<a.inChannels;++b)for(var w=0;w<a.inHeight;++w)for(var C=0;C<a.inWidth;++C){for(var _=w-v,E=C-h,k=0,R=0;R<d;R+=l){var N=(_+R)/s;if(!(N<0||N>=a.outHeight||Math.floor(N)!==N))for(var P=0;P<f;P+=c){var T=(E+P)/u;if(!(T<0||T>=a.outWidth||Math.floor(T)!==T)){var D=d*f-1-x.get(g,N,T,b)===R*f+P?1:0;D!==0&&(k+=m.get(g,N,T,b)*D)}}}y.set(k,g,w,C,b)}return y.toTensor()},t.prototype.avgPoolBackprop=function(n,r,o){X([n,r],"avgPoolBackprop");for(var a=o.strideHeight,i=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dilationHeight,c=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,v=d-1-o.padInfo.top,y=ve(r.shape,"float32"),x=1/(s*u),m=this.bufferSync(n),g=0;g<o.batchSize;++g)for(var b=0;b<o.inChannels;++b)for(var w=0;w<o.inHeight;++w)for(var C=0;C<o.inWidth;++C){for(var _=w-v,E=C-h,k=0,R=0;R<d;R+=l){var N=(_+R)/a;if(!(N<0||N>=o.outHeight||Math.floor(N)!==N))for(var P=0;P<f;P+=c){var T=(E+P)/i;T<0||T>=o.outWidth||Math.floor(T)!==T||(k+=m.get(g,N,T,b))}}y.set(k*x,g,w,C,b)}return y.toTensor()},t.prototype.pool3d=function(n,r,o){X(n,"pool3d");for(var a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,v=r.padInfo.front,y=r.padInfo.top,x=r.padInfo.left,m=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(n.dataId),b=ve(r.outShape,n.dtype),w=b.values,C=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],E=r.outShape[3]*r.outShape[4],k=r.outShape[4],R=0;R<r.batchSize;++R)for(var N=R*C,P=R*n.strides[0],T=0;T<r.inChannels;++T)for(var D=0;D<r.outDepth;++D){for(var B=D*a-v,W=B;W<0;)W+=u;for(var U=Math.min(r.inDepth,d+B),$=N+D*_,F=0;F<r.outHeight;++F){for(var O=F*i-y,L=O;L<0;)L+=l;for(var G=Math.min(r.inHeight,f+O),Y=$+F*E,Z=0;Z<r.outWidth;++Z){for(var de=Z*s-x,ne=de;ne<0;)ne+=c;for(var ae=Math.min(r.inWidth,h+de),pe=Y+Z*k,ge=m,ye=0,Ve=0,be=W;be<U;be+=u){for(var Ee=P+be*n.strides[1],ke=L;ke<G;ke+=l){for(var Oe=Ee+ke*n.strides[2],Ne=ne;Ne<ae;Ne+=c){var Le=g[Oe+Ne*n.strides[3]+T];if(o==="max"&&Le>ge?ge=Le:o==="avg"&&(ye+=Le,Ve++),isNaN(ge))break}if(isNaN(ge))break}if(isNaN(ge))break}w[pe+T]=o==="avg"?ye/Ve:ge}}}return b.toTensor()},t.prototype.avgPool3d=function(n,r){return X(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(n,r,o){X([n,r],"avgPool3dBackprop");for(var a=o.strideDepth,i=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,d=o.dilationDepth,f=o.dilationHeight,h=o.dilationWidth,v=o.effectiveFilterDepth,y=o.effectiveFilterHeight,x=o.effectiveFilterWidth,m=v-1-o.padInfo.front,g=x-1-o.padInfo.left,b=y-1-o.padInfo.top,w=ve(r.shape,"float32"),C=1/(u*l*c),_=this.bufferSync(n),E=0;E<o.batchSize;++E)for(var k=0;k<o.inChannels;++k)for(var R=0;R<o.inDepth;++R)for(var N=0;N<o.inHeight;++N)for(var P=0;P<o.inWidth;++P){for(var T=R-m,D=N-b,B=P-g,W=0,U=0;U<v;U+=d){var $=(T+U)/a;if(!($<0||$>=o.outDepth||Math.floor($)!==$))for(var F=0;F<y;F+=f){var O=(D+F)/i;if(!(O<0||O>=o.outHeight||Math.floor(O)!==O))for(var L=0;L<x;L+=h){var G=(B+L)/s;G<0||G>=o.outWidth||Math.floor(G)!==G||(W+=_.get(E,$,O,G,k))}}}w.set(W*C,E,R,N,P,k)}return w.toTensor()},t.prototype.maxPool3d=function(n,r){return X(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(n,r){for(var o=ve(r.outShape,"int32"),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,v=r.padInfo.front,y=r.padInfo.top,x=r.padInfo.left,m=this.bufferSync(n),g=0;g<r.batchSize;++g)for(var b=0;b<r.inChannels;++b)for(var w=0;w<r.outDepth;++w){for(var C=w*a-v,_=C;_<0;)_+=u;for(var E=Math.min(r.inDepth,d+C),k=0;k<r.outHeight;++k){for(var R=k*i-y,N=R;N<0;)N+=l;for(var P=Math.min(r.inHeight,f+R),T=0;T<r.outWidth;++T){for(var D=T*s-x,B=D;B<0;)B+=c;for(var W=Math.min(r.inWidth,h+D),U=Number.NEGATIVE_INFINITY,$=-1,F=_;F<E;F+=u)for(var O=F-C,L=N;L<P;L+=l)for(var G=L-R,Y=B;Y<W;Y+=c){var Z=Y-D,de=m.get(g,F,L,Y,b);de>=U&&(U=de,$=O*f*h+G*f+Z)}o.set($,g,w,k,T,b)}}}return o.toTensor()},t.prototype.maxPool3dBackprop=function(n,r,o,a){X([r,o],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(r,a),s=a.strideDepth,u=a.strideHeight,l=a.strideWidth,c=a.dilationDepth,d=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,v=a.effectiveFilterHeight,y=a.effectiveFilterWidth,x=h-1-a.padInfo.front,m=y-1-a.padInfo.left,g=v-1-a.padInfo.top,b=ve(r.shape,"float32"),w=this.bufferSync(i),C=this.bufferSync(n),_=0;_<a.batchSize;++_)for(var E=0;E<a.inChannels;++E)for(var k=0;k<a.inDepth;++k)for(var R=0;R<a.inHeight;++R)for(var N=0;N<a.inWidth;++N){for(var P=k-x,T=R-g,D=N-m,B=0,W=0;W<h;W+=c){var U=(P+W)/s;if(!(U<0||U>=a.outDepth||Math.floor(U)!==U))for(var $=0;$<v;$+=d){var F=(T+$)/u;if(!(F<0||F>=a.outHeight||Math.floor(F)!==F))for(var O=0;O<y;O+=f){var L=(D+O)/l;if(!(L<0||L>=a.outWidth||Math.floor(L)!==L)){var G=h*v*y-1-w.get(_,U,F,L,E)===W*v*y+$*y+O?1:0;G!==0&&(B+=C.get(_,U,F,L,E)*G)}}}}b.set(B,_,k,R,N,E)}return b.toTensor()},t.prototype.cast=function(n,r){return zy(n,r,this)},t.prototype.reshape=function(n,r){return qd(n,r)},t.prototype.avgPool=function(n,r){return X(n,"avgPool"),this.pool(n,r,"avg").toFloat()},t.prototype.resizeBilinear=function(n,r,o,a){X(n,"resizeBilinear");for(var i=n.shape,s=i[0],u=i[1],l=i[2],c=i[3],d=this.readSync(n.dataId),f=new Float32Array(se([s,r,o,c])),h=[a&&r>1?u-1:u,a&&o>1?l-1:l],v=[a&&r>1?r-1:r,a&&o>1?o-1:o],y=0,x=h[0]/v[0],m=h[1]/v[1],g=0;g<s;g++)for(var b=0;b<r;b++)for(var w=x*b,C=Math.floor(w),_=w-C,E=Math.min(u-1,Math.ceil(w)),k=g*n.strides[0]+C*n.strides[1],R=g*n.strides[0]+E*n.strides[1],N=0;N<o;N++)for(var P=m*N,T=Math.floor(P),D=P-T,B=Math.min(l-1,Math.ceil(P)),W=k+T*n.strides[2],U=R+T*n.strides[2],$=k+B*n.strides[2],F=R+B*n.strides[2],O=0;O<c;O++){var L=d[W+O],G=d[U+O],Y=L+(d[$+O]-L)*D,Z=Y+(G+(d[F+O]-G)*D-Y)*_;f[y++]=Z}return Rt(f,[s,r,o,c])},t.prototype.resizeBilinearBackprop=function(n,r,o){X([n,r],"resizeBilinearBackprop");for(var a=r.shape,i=a[0],s=a[1],u=a[2],l=a[3],c=n.shape,d=c[1],f=c[2],h=new Float32Array(i*s*u*l),v=[o&&d>1?s-1:s,o&&f>1?u-1:u],y=[o&&d>1?d-1:d,o&&f>1?f-1:f],x=v[0]/y[0],m=v[1]/y[1],g=this.readSync(n.dataId),b=0,w=0;w<i;w++)for(var C=w*r.strides[0],_=0;_<d;_++)for(var E=_*x,k=Math.floor(E),R=Math.min(Math.ceil(E),s-1),N=C+k*r.strides[1],P=C+R*r.strides[1],T=E-k,D=1-T,B=0;B<f;B++)for(var W=B*m,U=Math.floor(W),$=Math.min(Math.ceil(W),u-1),F=W-U,O=1-F,L=N+U*r.strides[2],G=N+$*r.strides[2],Y=P+U*r.strides[2],Z=P+$*r.strides[2],de=D*O,ne=D*F,ae=T*O,pe=T*F,ge=0;ge<l;ge++){var ye=g[b++];h[L+ge]+=ye*de,h[G+ge]+=ye*ne,h[Y+ge]+=ye*ae,h[Z+ge]+=ye*pe}return Kt(h,[i,u,s,l],r.dtype)},t.prototype.resizeNearestNeighbor=function(n,r,o,a){X(n,"resizeNearestNeighbor");for(var i=n.shape,s=i[0],u=i[1],l=i[2],c=i[3],d=this.readSync(n.dataId),f=new Float32Array(s*r*o*c),h=[a&&r>1?u-1:u,a&&o>1?l-1:l],v=[a&&r>1?r-1:r,a&&o>1?o-1:o],y=h[0]/v[0],x=h[1]/v[1],m=0,g=0;g<s;g++)for(var b=g*n.strides[0],w=0;w<r;w++)for(var C=y*w,_=b+Math.min(u-1,a?Math.round(C):Math.floor(C))*n.strides[1],E=0;E<o;E++)for(var k=x*E,R=_+Math.min(l-1,a?Math.round(k):Math.floor(k))*n.strides[2],N=0;N<c;N++){var P=d[R+N];f[m++]=P}return Rt(f,[s,r,o,c],n.dtype)},t.prototype.resizeNearestNeighborBackprop=function(n,r,o){X([n,r],"resizeNearestNeighborBackprop");for(var a=r.shape,i=a[0],s=a[1],u=a[2],l=a[3],c=n.shape,d=c[1],f=c[2],h=new Float32Array(i*s*u*l),v=this.readSync(n.dataId),y=[o&&d>1?s-1:s,o&&f>1?u-1:u],x=[o&&d>1?d-1:d,o&&f>1?f-1:f],m=y[0]/x[0],g=y[1]/x[1],b=1/m,w=1/g,C=2*Math.ceil(b)+2,_=2*Math.ceil(w)+2,E=0;E<i;E++)for(var k=E*r.strides[0],R=0;R<s;R++)for(var N=k+R*r.strides[1],P=Math.floor(R*b),T=Math.floor(P-C/2),D=0;D<u;D++)for(var B=N+D*r.strides[2],W=Math.floor(D*w),U=Math.floor(W-_/2),$=0;$<l;$++){for(var F=0,O=0;O<C;O++){var L=O+T;if(!(L<0||L>=d)){var G=k+L*n.strides[1],Y=L*m;if(R===Math.min(s-1,o?Math.round(Y):Math.floor(Y)))for(var Z=0;Z<_;Z++){var de=Z+U;if(!(de<0||de>=f)){var ne=G+de*n.strides[2],ae=de*g;D===Math.min(u-1,o?Math.round(ae):Math.floor(ae))&&(F+=v[ne+$])}}}}h[B+$]=F}return Kt(h,r.shape,r.dtype)},t.prototype.batchNormalization=function(n,r,o,a,i,s){X([n,r,o,i,s],"batchNorm");for(var u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=this.readSync(o.dataId),d=i?this.readSync(i.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),v=f.length,y=d.length,x=c.length,m=l.length,g=0,b=0,w=0,C=0,_=0;_<u.length;++_)h[_]=f[g++]+(u[_]-l[b++])*d[w++]/Math.sqrt(c[C++]+a),g>=v&&(g=0),b>=m&&(b=0),w>=y&&(w=0),C>=x&&(C=0);return Kt(h,n.shape)},t.prototype.localResponseNormalization4D=function(n,r,o,a,i){X(n,"localResponseNormalization4D");var s=n.shape[3],u=s-1,l=this.readSync(n.dataId),c=n.size,d=new Float32Array(c);function f(x){for(var m=x%s,g=x-m+Math.max(0,m-r),b=x-m+Math.min(m+r,u),w=0;g<=b;g++){var C=l[g];w+=C*C}return w}for(var h=0;h<c;h++){var v=f(h),y=l[h]*Math.pow(o+a*v,-i);d[h]=y}return Kt(d,n.shape)},t.prototype.LRNGrad=function(n,r,o,a,i,s,u){X(n,"LRNGrad");for(var l=n.shape[3],c=this.readSync(n.dataId),d=this.readSync(r.dataId),f=this.readSync(o.dataId),h=new Float32Array(n.size),v=n.size,y=0;y<v;y++){for(var x=y%l,m=y-x+Math.max(0,x-a),g=y-x+Math.min(l,x+a+1),b=0,w=m;w<g;w++)b+=Math.pow(d[w],2);for(b=s*b+i,w=m;w<g;w++){var C=-2*s*u*d[w]*f[y]/b;y===w&&(C+=Math.pow(b,-u)),C*=c[y],h[w]+=C}}return Kt(h,n.shape)},t.prototype.multinomial=function(n,r,o,a){X(n,"multinomial");for(var i=r?n:_r(n),s=i.shape[0],u=i.shape[1],l=Ue([s,o],"int32"),c=this.readSync(l.dataId),d=this.readSync(i.dataId),f=0;f<s;++f){var h=f*u,v=new Float32Array(u-1);v[0]=d[h];for(var y=1;y<v.length;++y)v[y]=v[y-1]+d[h+y];for(var x=wl(a.toString()),m=f*o,g=0;g<o;++g){var b=x();c[m+g]=v.length;for(var w=0;w<v.length;w++)if(b<v[w]){c[m+g]=w;break}}}return l},t.prototype.oneHot=function(n,r,o,a){X(n,"oneHot");var i=new Float32Array(n.size*r);i.fill(a);for(var s=this.readSync(n.dataId),u=0;u<n.size;++u)s[u]>=0&&s[u]<r&&(i[u*r+s[u]]=o);return Zr(i,[n.size,r],"int32")},t.prototype.nonMaxSuppression=function(n,r,o,a,i){return X(n,"nonMaxSuppression"),hh(this.readSync(n.dataId),this.readSync(r.dataId),o,a,i)},t.prototype.fft=function(n){return this.fftBatch(n,!1)},t.prototype.ifft=function(n){return this.fftBatch(n,!0)},t.prototype.fftBatch=function(n,r){for(var o=n.shape[0],a=n.shape[1],i=ve(n.shape,"float32"),s=ve(n.shape,"float32"),u=wn(n).as2D(o,a),l=Qn(n).as2D(o,a),c=0;c<o;c++)for(var d=u.slice([c,0],[1,a]),f=l.slice([c,0],[1,a]),h=Nt(d,f),v=this.readSync(this.fftImpl(h,r).dataId),y=0;y<a;y++){var x=Hm(v,y);i.values[c*a+y]=x.real,s.values[c*a+y]=x.imag}return Nt(i.toTensor(),s.toTensor()).as2D(o,a)},t.prototype.fftImpl=function(n,r){var o=n.as1D(),a=o.size;if(this.isExponentOf2(a)){var i=this.fftRadix2(o,a,r).as2D(n.shape[0],n.shape[1]);return r&&(i=Nt(wn(i).div(J(a)),Qn(i).div(J(a)))),i}var s=this.readSync(n.dataId),u=function(l){for(var c=new Float32Array(l.length/2),d=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],d[f/2]=l[f+1];return{real:c,imag:d}}(this.fourierTransformByMatmul(s,a,r));return Nt(u.real,u.imag).as2D(n.shape[0],n.shape[1])},t.prototype.isExponentOf2=function(n){return(n&n-1)==0},t.prototype.fftRadix2=function(n,r,o){if(r===1)return n;var a=this.readSync(n.dataId),i=r/2,s=function(m){for(var g=Math.ceil(m.length/4),b=new Float32Array(g),w=new Float32Array(g),C=0;C<m.length;C+=4)b[Math.floor(C/4)]=m[C],w[Math.floor(C/4)]=m[C+1];return{real:b,imag:w}}(a),u=Nt(s.real,s.imag).as1D(),l=function(m){for(var g=Math.floor(m.length/4),b=new Float32Array(g),w=new Float32Array(g),C=2;C<m.length;C+=4)b[Math.floor(C/4)]=m[C],w[Math.floor(C/4)]=m[C+1];return{real:b,imag:w}}(a),c=Nt(l.real,l.imag).as1D();u=this.fftRadix2(u,i,o),c=this.fftRadix2(c,i,o);var d=function(m,g){for(var b=new Float32Array(m/2),w=new Float32Array(m/2),C=0;C<Math.ceil(m/2);C++){var _=(g?2:-2)*Math.PI*(C/m);b[C]=Math.cos(_),w[C]=Math.sin(_)}return{real:b,imag:w}}(r,o),f=Nt(d.real,d.imag).mul(c),h=u.add(f),v=u.sub(f),y=wn(h).concat(wn(v)),x=Qn(h).concat(Qn(v));return Nt(y,x).as1D()},t.prototype.fourierTransformByMatmul=function(n,r,o){for(var a=new Float32Array(2*r),i=0;i<r;i++){for(var s=0,u=0,l=0;l<r;l++){var c=Bk(i*l,r,o),d=Hm(n,l);s+=d.real*c.real-d.imag*c.imag,u+=d.real*c.imag+d.imag*c.real}o&&(s/=r,u/=r),Lk(a,s,u,i)}return a},t.prototype.depthToSpace=function(n,r,o){I(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),I(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var a=n.shape[0],i=n.shape[1],s=n.shape[2],u=n.shape[3],l=i*r,c=s*r,d=u/(r*r),f=this.readSync(n.dataId),h=new Float32Array(a*l*c*d),v=0,y=0;y<a;++y)for(var x=0;x<l;++x)for(var m=Math.floor(x/r),g=x%r,b=0;b<c;++b)for(var w=Math.floor(b/r),C=(g*r+b%r)*d,_=0;_<d;++_){var E=_+C+u*(w+s*(m+i*y));h[v++]=f[E]}return Kt(h,[a,l,c,d])},t.prototype.broadcastedBinaryOp=function(n,r,o,a){var i=Ce(n.shape,r.shape),s=ve(i,o),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Ur(n.shape,i),d=Ur(r.shape,i),f=s.values;if(c.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=a(u[h%u.length],l[h%l.length]);else{var v=this.bufferSync(n),y=this.bufferSync(r),x=function(m){var g=s.indexToLoc(m),b=g.slice(-n.rank);c.forEach(function(E){return b[E]=0});var w=v.locToIndex(b),C=g.slice(-r.rank);d.forEach(function(E){return C[E]=0});var _=y.locToIndex(C);f[m]=a(u[w],l[_])};for(h=0;h<f.length;++h)x(h)}return s.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(n,r,o){var a=Ce(n.shape,r.shape),i=ve(a,"float32"),s=ve(a,"float32"),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Ur(n.shape,a),d=Ur(r.shape,a),f=i.values,h=s.values;if(c.length+d.length===0)for(var v=0;v<f.length;v++){var y=v%u.length,x=v%l.length,m=o(u[2*y],u[2*y+1],l[2*x],l[2*x+1]);f[v]=m.real,h[v]=m.imag}else{var g=this.bufferSync(this.data.get(n.dataId).complexTensors.real),b=this.bufferSync(this.data.get(r.dataId).complexTensors.real),w=function(C){var _=i.indexToLoc(C),E=_.slice(-n.rank);c.forEach(function(T){return E[T]=0});var k=g.locToIndex(E),R=_.slice(-r.rank);d.forEach(function(T){return R[T]=0});var N=b.locToIndex(R),P=o(u[2*k],u[2*k+1],l[2*N],l[2*N+1]);f[C]=P.real,h[C]=P.imag};for(v=0;v<f.length;v++)w(v)}return this.complex(i.toTensor(),s.toTensor())},t.prototype.split=function(n,r,o){return Vy(n,r,o)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(n,r,o,a,i,s){for(var u=n.shape,l=u[0],c=u[1],d=u[2],f=u[3],h=r.shape[0],v=a[0],y=a[1],x=ve([h,v,y,f],"float32"),m=this.readSync(r.dataId),g=this.readSync(o.dataId),b=this.readSync(n.dataId),w=n.strides,C=x.strides,_=0;_<h;_++){var E=4*_,k=m[E],R=m[E+1],N=m[E+2],P=m[E+3],T=g[_];if(!(T>=l))for(var D=v>1?(N-k)*(c-1)/(v-1):0,B=y>1?(P-R)*(d-1)/(y-1):0,W=0;W<v;W++){var U=v>1?k*(c-1)+W*D:.5*(k+N)*(c-1);if(U<0||U>c-1)for(var $=0;$<y;$++)for(var F=0;F<f;F++){var O=F+$*C[2]+W*C[1]+_*C[0];x.values[O]=s}else if(i==="bilinear"){var L=Math.floor(U),G=Math.ceil(U),Y=U-L;for($=0;$<y;$++)if((be=y>1?R*(d-1)+$*B:.5*(R+P)*(d-1))<0||be>d-1)for(F=0;F<f;F++)O=F+$*C[2]+W*C[1]+_*C[0],x.values[O]=s;else{var Z=Math.floor(be),de=Math.ceil(be),ne=be-Z;for(F=0;F<f;F++){var ae=b[O=F+Z*w[2]+L*w[1]+T*w[0]],pe=b[O=F+de*w[2]+L*w[1]+T*w[0]],ge=b[O=F+Z*w[2]+G*w[1]+T*w[0]],ye=ae+(pe-ae)*ne,Ve=ge+(b[O=F+de*w[2]+G*w[1]+T*w[0]]-ge)*ne;O=F+$*C[2]+W*C[1]+_*C[0],x.values[O]=ye+(Ve-ye)*Y}}}else for($=0;$<y;++$){var be;if((be=y>1?R*(d-1)+$*B:.5*(R+P)*(d-1))<0||be>d-1)for(F=0;F<f;F++)O=F+$*C[2]+W*C[1]+_*C[0],x.values[O]=s;else{var Ee=Math.round(be),ke=Math.round(U);for(F=0;F<f;F++){var Oe=F+Ee*w[2]+ke*w[1]+T*w[0],Ne=F+$*C[2]+W*C[1]+_*C[0];x.values[Ne]=b[Oe]}}}}}return x.toTensor()},t.prototype.sparseToDense=function(n,r,o,a){var i=Vu(0,n,o),s=i.sliceRank,u=i.numUpdates,l=i.sliceSize,c=i.strides,d=i.outputSize;return this.scatter(n,r,o,d,l,u,s,c,a,!1)},t.prototype.gatherND=function(n,r){var o=r.shape,a=o[o.length-1],i=Fy(n,r),s=i[0],u=i[1],l=i[2],c=i[3];if(u===0)return Rt([],s,n.dtype);for(var d=new Gi([u,l],n.dtype),f=this.readSync(r.dataId),h=this.readSync(n.dataId),v=0;v<u;v++){for(var y=[],x=0,m=0;m<a;m++){var g=f[v*a+m];x+=g*c[m],y.push(g)}if(x<0||x>=n.size/l)throw new Error("Invalid indices: "+y+" does not index into "+n.shape);for(var b=0;b<l;b++)d.values[v*l+b]=h[x*l+b]}return d.toTensor().reshape(s)},t.prototype.scatterND=function(n,r,o){var a=Vu(0,n,o),i=a.sliceRank,s=a.numUpdates,u=a.sliceSize,l=a.strides,c=a.outputSize,d=J(0);return this.scatter(n,r,o,c,u,s,i,l,d,!0)},t.prototype.fill=function(n,r,o){var a=Fu(o=o||rs(r),se(n));return a.fill(r),j.makeTensor(a,n,o,this)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){var r=Fu(n.dtype,se(n.shape));return this.makeOutput(r,n.shape,n.dtype)},t.prototype.linspace=function(n,r,o){return Uy(n,r,o)},t.prototype.scatter=function(n,r,o,a,i,s,u,l,c,d){var f=[a/i,i],h=this.readSync(n.dataId),v=this.readSync(r.dataId);if(a===0)return Rt([],o,r.dtype);var y=new Gi(f,r.dtype);y.values.fill(this.readSync(c.dataId)[0]);for(var x=0;x<s;x++){for(var m=[],g=0,b=0;b<u;b++){var w=h[x*u+b];m.push(w),g+=w*l[b]}if(g<0||g>=a/i)throw new Error("Invalid indices: "+m+" does not index into "+o);for(var C=0;C<i;C++)d?y.values[g*i+C]+=v[x*i+C]:y.values[g*i+C]=r.rank===0?v[0]:v[x*i+C]}return y.toTensor().reshape(o)},t}(By);j.registerBackend("cpu",function(){return new a3},1);for(var Sc=0,hv=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,d=s.softNmsSigma,f=n;X(a,"NonMaxSuppressionWithScore");var h=ph(f.data.get(a.dataId).values,f.data.get(i.dataId).values,u,l,c,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;X(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Xi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n;X([o,a],Xi);var s=i.data.get(o.dataId).values,u=i.data.get(a.dataId).values,l=function(f,h,v,y,x,m){var g=Ce(f,h),b=g.length,w=nr(g),C=Hi(x,se(g)),_=f.length,E=h.length,k=nr(f),R=nr(h),N=Ur(f,g),P=Ur(h,g);if(N.length+P.length===0)for(var T=0;T<C.length;++T)C[T]=m(v[T%v.length],y[T%y.length]);else{var D=function(B){var W=m_(B,b,w),U=W.slice(-_);N.forEach(function(L){return U[L]=0});var $=Mm(U,_,k),F=W.slice(-E);P.forEach(function(L){return F[L]=0});var O=Mm(F,E,R);C[B]=m(v[$],y[O])};for(T=0;T<C.length;++T)D(T)}return[C,g]}(o.shape,a.shape,s,u,o.dtype,function(f,h){var v=f-h;return v*v}),c=l[0],d=l[1];return{dataId:i.write(c,d,o.dtype),shape:d,dtype:o.dtype}}}];Sc<hv.length;Sc++)hy(hv[Sc]);var Xo,i3=function(e){this.variableNames=["A"];var t=Ot(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+n+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},s3=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Ot(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+n+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `};for(var Rc=0,pv=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,a=r.numChannels,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],d=[c,l],f=[c,l,a];(s||i)&&(Xo==null&&(Xo=document.createElement("canvas").getContext("2d")),Xo.canvas.width=l,Xo.canvas.height=c,Xo.drawImage(o,0,0,l,c),o=Xo.canvas);var h=n.makeTensorInfo(d,"int32");n.texData.get(h.dataId).usage=ln.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),o);var v=H().getBool("WEBGL_PACK")?new s3(f):new i3(f),y=n.runWebGLProgram(v,[h],"int32");return n.disposeData(h.dataId),y}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;Lu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,d=s.softNmsSigma,f=n,h=ph(f.readSync(a.dataId),f.readSync(i.dataId),u,l,c,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,a=new xe(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Xi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n,s=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cr("return (a - b) * (a - b);",o.shape,a.shape):new Je("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(s,[o,a])}}];Rc<pv.length;Rc++)hy(pv[Rc]);for(var Ic=0,mv=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Xi,gradFunc:function(e,t){var n=t[0],r=t[1],o=J(2);return{a:function(){return Bt(e,Bt(o,gt(n,r)))},b:function(){return Bt(e,Bt(o,gt(r,n)))}}}}];Ic<mv.length;Ic++)o_(mv[Ic]);var u3=function(){function e(){}return e.prototype.fetch=function(t,n){return fetch(t,n)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return new TextDecoder(n).decode(t)},e}();H().get("IS_BROWSER")&&H().setPlatform("browser",new u3);var Dc,l3=function(){return require("node-fetch")},c3=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(t,n){return H().global.fetch!=null?H().global.fetch(t,n):(Dc==null&&(Dc=l3()),Dc(t,n))},e.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)},e}();H().get("IS_NODE")&&H().setPlatform("node",new c3);var Yd={float32:4,int32:4,uint16:2,uint8:1,bool:1},Qu=4;function Mx(e,t){for(var n={},r=0,o=function(s){var u=s.name,l=s.dtype,c=s.shape,d=se(c),f=void 0;if("quantization"in s){var h=s.quantization;if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var v=Yd[h.dtype],y=e.slice(r,r+d*v),x=h.dtype==="uint8"?new Uint8Array(y):new Uint16Array(y);if(l==="float32")f=Float32Array.from(x,function(_){return _*h.scale+h.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(x,function(_){return Math.round(_*h.scale+h.min)})}r+=d*v}else if(l==="string"){var m=se(s.shape);f=[];for(var g=0;g<m;g++){var b=new Uint32Array(e.slice(r,r+Qu))[0];r+=Qu;var w=new Uint8Array(e.slice(r,r+b));f.push(w),r+=b}}else{var C=Yd[l];if(y=e.slice(r,r+d*C),l==="float32")f=new Float32Array(y);else if(l==="int32")f=new Int32Array(y);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(y)}r+=d*C}n[u]=Rt(f,c,l)},a=0,i=t;a<i.length;a++)o(i[a]);return n}function d3(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(a){if(t+=a.byteLength,n.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(a){r.set(new Uint8Array(a.buffer),o),o+=a.byteLength}),r.buffer}var Qd=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function vv(e){return Qd?Buffer.byteLength(e):new Blob([e]).size}function Ph(e){var t=0;e.forEach(function(o){t+=o.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(o){n.set(new Uint8Array(o),r),r+=o.byteLength}),n.buffer}function gv(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function cs(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:vv(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:vv(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var cn=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return(n==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(a){var i=a(t,r);i!==null&&o.push(i)}),o},e}(),ka="://",eo=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(t,n){I(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(ka)&&(t=t.slice(0,t.indexOf(ka))),I(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();I(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(t){var n=this.getInstance().managers[t];if(n==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return n},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function ru(e){if(e.indexOf(ka)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+eo.getSchemes().join(","));return{scheme:e.split(ka)[0],path:e.split(ka)[1]}}function yv(e,t,n){return n===void 0&&(n=!1),re(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,d;return oe(this,function(f){switch(f.label){case 0:return I(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),I((r=cn.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),I(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],I((a=cn.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),I(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=ru(e).scheme,u=ru(e).path,l=s===ru(e).scheme,[4,o.load()];case 1:return c=f.sent(),n&&l?[4,eo.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,i.save(c)];case 4:return d=f.sent(),!n||l?[3,6]:[4,eo.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var Ro="models_store",$r="model_info_store";function Ox(){if(!H().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Jd(e){var t=e.result;t.createObjectStore(Ro,{keyPath:"modelPath"}),t.createObjectStore($r,{keyPath:"modelPath"})}var Ea=function(){function e(t){if(this.indexedDB=Ox(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return e.prototype.save=function(t){return re(this,void 0,void 0,function(){return oe(this,function(n){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return re(this,void 0,void 0,function(){return oe(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(t,n){var r=this;return new Promise(function(o,a){var i=r.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Jd(i)},i.onsuccess=function(){var s=i.result;if(n==null){var u=s.transaction(Ro,"readonly"),l=u.objectStore(Ro).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),a(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(l.result.modelArtifacts)},l.onerror=function(y){return s.close(),a(l.error)},u.oncomplete=function(){return s.close()}}else{var c,d=cs(n),f=s.transaction($r,"readwrite"),h=f.objectStore($r),v=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});v.onsuccess=function(){var y=(c=s.transaction(Ro,"readwrite")).objectStore(Ro).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:d});y.onsuccess=function(){return o({modelArtifactsInfo:d})},y.onerror=function(x){var m=(h=f.objectStore($r)).delete(r.modelPath);m.onsuccess=function(){return s.close(),a(y.error)},m.onerror=function(g){return s.close(),a(y.error)}}},v.onerror=function(y){return s.close(),a(v.error)},f.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},i.onerror=function(s){return a(i.error)}})},e.URL_SCHEME="indexeddb://",e}(),xv=function(e){return H().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ea.URL_SCHEME)?(t=e.slice(Ea.URL_SCHEME.length),new Ea(t)):null;var t};cn.registerSaveRouter(xv),cn.registerLoadRouter(xv);var f3=function(){function e(){this.indexedDB=Ox()}return e.prototype.listModels=function(){return re(this,void 0,void 0,function(){var t=this;return oe(this,function(n){return[2,new Promise(function(r,o){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Jd(a)},a.onsuccess=function(){var i=a.result,s=i.transaction($r,"readonly"),u=s.objectStore($r).getAll();u.onsuccess=function(){for(var l={},c=0,d=u.result;c<d.length;c++){var f=d[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return i.close(),o(u.error)},s.oncomplete=function(){return i.close()}},a.onerror=function(i){return o(a.error)}})]})})},e.prototype.removeModel=function(t){return re(this,void 0,void 0,function(){var n=this;return oe(this,function(r){var o;return t=(o=t).startsWith(Ea.URL_SCHEME)?o.slice(Ea.URL_SCHEME.length):o,[2,new Promise(function(a,i){var s=n.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Jd(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction($r,"readwrite"),d=c.objectStore($r),f=d.get(t);f.onsuccess=function(){if(f.result==null)return l.close(),i(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var h=d.delete(t),v=function(){var y=(u=l.transaction(Ro,"readwrite")).objectStore(Ro).delete(t);y.onsuccess=function(){return a(f.result.modelArtifactsInfo)},y.onerror=function(x){return i(f.error)}};h.onsuccess=v,h.onerror=function(y){return v(),l.close(),i(f.error)}},f.onerror=function(h){return l.close(),i(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return i(s.error)}})]})})},e}();if(H().getBool("IS_BROWSER"))try{eo.registerManager(Ea.URL_SCHEME,new f3)}catch{}var hr="/",ta="tensorflowjs_models",Lx="info",h3="model_topology",p3="weight_specs",m3="weight_data",v3="model_metadata";function Bx(e){return{info:[ta,e,Lx].join(hr),topology:[ta,e,h3].join(hr),weightSpecs:[ta,e,p3].join(hr),weightData:[ta,e,m3].join(hr),modelMetadata:[ta,e,v3].join(hr)}}function g3(e){var t=e.split(hr);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(hr)}var Na=function(){function e(t){if(!H().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Bx(this.modelPath)}return e.prototype.save=function(t){return re(this,void 0,void 0,function(){var n,r,o;return oe(this,function(a){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=cs(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(i){if(Qd)return Buffer.from(i).toString("base64");for(var s=new Uint8Array(i),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return re(this,void 0,void 0,function(){var t,n,r,o,a,i,s;return oe(this,function(u){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=o,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(i=JSON.parse(a),n.format=i.format,n.generatedBy=i.generatedBy,n.convertedBy=i.convertedBy,n.userDefinedMetadata=i.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(l){if(Qd){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var d=atob(l),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(s),[2,n]})})},e.URL_SCHEME="localstorage://",e}(),bv=function(e){return H().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Na.URL_SCHEME)?(t=e.slice(Na.URL_SCHEME.length),new Na(t)):null;var t};cn.registerSaveRouter(bv),cn.registerLoadRouter(bv);var y3=function(){function e(){I(H().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),I(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return re(this,void 0,void 0,function(){var t,n,r,o,a,i;return oe(this,function(s){for(t={},n=ta+hr,r=hr+Lx,o=0;o<this.LS.length;++o)(a=this.LS.key(o)).startsWith(n)&&a.endsWith(r)&&(i=g3(a),t[i]=JSON.parse(this.LS.getItem(a)));return[2,t]})})},e.prototype.removeModel=function(t){return re(this,void 0,void 0,function(){var n,r;return oe(this,function(o){var a;if(t=(a=t).startsWith(Na.URL_SCHEME)?a.slice(Na.URL_SCHEME.length):a,n=Bx(t),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(H().getBool("IS_BROWSER"))try{eo.registerManager(Na.URL_SCHEME,new y3)}catch{}var x3="model",b3=".json",w3=".weights.bin";function wv(e){return new Promise(function(t){return setTimeout(t)}).then(e)}var Tc=function(){function e(t){if(!H().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),t!=null&&t.length!==0||(t=x3),this.modelTopologyFileName=t+b3,this.weightDataFileName=t+w3}return e.prototype.save=function(t){return re(this,void 0,void 0,function(){var n,r,o,a,i,s;return oe(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},a=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(i=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,wv(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),t.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,[4,wv(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:cs(t)}]}})})},e.URL_SCHEME="downloads://",e}(),C3=function(){function e(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return e.prototype.load=function(){return re(this,void 0,void 0,function(){var t,n,r=this;return oe(this,function(o){return t=this.files[0],n=this.files.slice(1),[2,new Promise(function(a,i){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){n.length===0&&a({modelTopology:c});var d=l.weightsManifest;if(d!=null){var f;try{f=r.checkManifestAndWeightFiles(d,n)}catch(x){return void i(x)}var h=[],v=[],y=[];d.forEach(function(x){x.paths.forEach(function(m){v.push(m),y.push(null)}),h.push.apply(h,x.weights)}),d.forEach(function(x){x.paths.forEach(function(m){var g=new FileReader;g.onload=function(b){var w=b.target.result,C=v.indexOf(m);y[C]=w,y.indexOf(null)===-1&&a({modelTopology:c,weightSpecs:h,weightData:Ph(y),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},g.onerror=function(b){return i("Failed to weights data from file of path '"+m+"'.")},g.readAsArrayBuffer(f[m])})})}else i(new Error("weightManifest field is missing from file "+t.name))}else i(new Error("modelTopology field is missing from file "+t.name))},s.onerror=function(u){return i("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(t)})]})})},e.prototype.checkManifestAndWeightFiles=function(t,n){for(var r=[],o=n.map(function(u){return gv(u.name)}),a={},i=0,s=t;i<s.length;i++)s[i].paths.forEach(function(u){var l=gv(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),o.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");a[u]=n[o.indexOf(l)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return a},e}();function Cv(e,t,n,r){(function(a){I(a!=null&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"})})(e),function(a,i){I(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),I(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+i}),I(i>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+i})}(n=n??0,r=r??1);var o=0;return Promise.all(e.map(function(a){return a.then(function(i){var s=n+ ++o/e.length*(r-n);return t(s),i}),a}))}function Wx(e,t){return re(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c;return oe(this,function(d){switch(d.label){case 0:return t==null&&(t={}),n=t.fetchFunc==null?H().platform.fetch:t.fetchFunc,r=e.map(function(f){return n(f,t.requestInit,{isBinary:!0})}),o=0,a=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return i=d.sent(),[3,4];case 2:return[4,Cv(r,t.onProgress,o,a)];case 3:i=d.sent(),d.label=4;case 4:return s=i.map(function(f){return f.arrayBuffer()}),u=.5,l=1,t.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=d.sent(),[3,8];case 6:return[4,Cv(s,t.onProgress,u,l)];case 7:c=d.sent(),d.label=8;case 8:return[2,c]}})})}function _v(e){var t=this;return function(n,r,o){return r===void 0&&(r=""),re(t,void 0,void 0,function(){var a,i,s,u,l,c,d,f,h,v;return oe(this,function(y){switch(y.label){case 0:if(a=n.map(function(){return!1}),i={},s=o!=null?o.map(function(){return!1}):[],u=[],n.forEach(function(x,m){var g=0;x.weights.forEach(function(b){var w="quantization"in b?b.quantization.dtype:b.dtype,C=Yd[w]*se(b.shape),_=function(){a[m]=!0,i[m]==null&&(i[m]=[]),i[m].push({manifestEntry:b,groupOffset:g,sizeBytes:C})};o!=null?o.forEach(function(E,k){E===b.name&&(_(),s[k]=!0)}):_(),u.push(b.name),g+=C})}),!s.every(function(x){return x}))throw l=o.filter(function(x,m){return!s[m]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=a.reduce(function(x,m,g){return m&&x.push(g),x},[]),d=[],c.forEach(function(x){n[x].paths.forEach(function(m){var g=r+(r.endsWith("/")?"":"/")+m;d.push(g)})}),[4,e(d)];case 1:return f=y.sent(),h={},v=0,c.forEach(function(x){for(var m=n[x].paths.length,g=0,b=0;b<m;b++)g+=f[v+b].byteLength;for(var w=new ArrayBuffer(g),C=new Uint8Array(w),_=0,E=0;E<m;E++){var k=new Uint8Array(f[v+E]);C.set(k,_),_+=k.byteLength}i[x].forEach(function(R){var N=Mx(w.slice(R.groupOffset,R.groupOffset+R.sizeBytes),[R.manifestEntry]);for(var P in N)h[P]=N[P]}),v+=m}),[2,h]}})})}}cn.registerSaveRouter(function(e){return H().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Tc.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new Tc(t)}(e.slice(Tc.URL_SCHEME.length)):null});var zx=function(){function e(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(I(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=H().platform.fetch,I(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&I(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return e.prototype.save=function(t){return re(this,void 0,void 0,function(){var n,r,o,a;return oe(this,function(i){switch(i.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((a=i.sent()).ok)return[2,{modelArtifactsInfo:cs(t),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},e.prototype.load=function(){return re(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,d,f;return oe(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,t.json()];case 3:return n=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=n.modelTopology,a=n.weightsManifest,i=n.generatedBy,s=n.convertedBy,u=n.format,l=n.userDefinedMetadata,o==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:f=h.sent(),c=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:c,weightData:d,userDefinedMetadata:l,generatedBy:i,convertedBy:s,format:u}]}})})},e.prototype.loadWeights=function(t){return re(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d,f;return oe(this,function(h){switch(h.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(v){var y=v.lastIndexOf("/"),x=v.lastIndexOf("?"),m=v.substring(0,y),g=x>y?v.substring(x):"";return[m+"/",g]}(n),o=r[0],a=r[1],i=this.weightPathPrefix||o,s=[],u=0,l=t;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return d=[],t.forEach(function(v){v.paths.forEach(function(y){d.push(i+y+a)})}),[4,Wx(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[s,Ph(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Zd(e){return e.match(zx.URL_SCHEME_REGEX)!=null}var kv=function(e,t){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(n){return Zd(n)}):Zd(e))?ef(e,{onProgress:t}):null};function ef(e,t){return new zx(e,t)}cn.registerSaveRouter(kv),cn.registerLoadRouter(kv);var Ac=function(){function e(t){this.modelArtifacts=t}return e.prototype.load=function(){return re(this,void 0,void 0,function(){return oe(this,function(t){return[2,this.modelArtifacts]})})},e}(),_3=function(){function e(t){this.saveHandler=t}return e.prototype.save=function(t){return re(this,void 0,void 0,function(){return oe(this,function(n){return[2,this.saveHandler(t)]})})},e}(),Ux=Object.freeze({browserFiles:function(e){return new C3(e)},browserHTTPRequest:function(e,t){return ef(e,t)},concatenateArrayBuffers:Ph,decodeWeights:Mx,encodeWeights:function(e,t){return re(this,void 0,void 0,function(){var n,r,o,a,i,s=this;return oe(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(l){return l.name}):Object.keys(e),a=function(l){var c=o[l],d=Array.isArray(e)?e[l].tensor:e[c];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+d.dtype);var f={name:c,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var h=new Promise(function(v){return re(s,void 0,void 0,function(){var y,x,m,g,b,w,C;return oe(this,function(_){switch(_.label){case 0:return[4,d.bytes()];case 1:for(y=_.sent(),x=y.reduce(function(E,k){return E+k.length},0)+Qu*y.length,m=new Uint8Array(x),g=0,b=0;b<y.length;b++)w=y[b],C=new Uint8Array(new Uint32Array([w.length]).buffer),m.set(C,g),g+=Qu,m.set(w,g),g+=w.length;return v(m),[2]}})})});r.push(h)}else r.push(d.data());t!=null&&(f.group=t),n.push(f)},i=0;i<o.length;++i)a(i);return[4,Promise.all(r)];case 1:return[2,{data:d3(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new Ac(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ac({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ac({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return cn.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:cs,getSaveHandlers:function(e){return cn.getSaveHandlers(e)},http:ef,isHTTPScheme:Zd,loadWeights:function(e,t,n,r){return t===void 0&&(t=""),re(this,void 0,void 0,function(){return oe(this,function(o){return[2,_v(function(a){return Wx(a,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return cn.registerLoadRouter(e)},registerSaveRouter:function(e){return cn.registerSaveRouter(e)},weightsLoaderFactory:_v,withSaveHandler:function(e){return new _3(e)},copyModel:function(e,t){return re(this,void 0,void 0,function(){return oe(this,function(n){return[2,yv(e,t,!1)]})})},listModels:function(){return re(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return oe(this,function(s){switch(s.label){case 0:e=eo.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,eo.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+ka+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return re(this,void 0,void 0,function(){return oe(this,function(n){return[2,yv(e,t,!0)]})})},removeModel:function(e){return re(this,void 0,void 0,function(){var t;return oe(this,function(n){return t=ru(e),[2,eo.getManager(t.scheme).removeModel(t.path)]})})}}),Yo;A({confusionMatrix_:function(e,t,n){var r=S(e,"labels","confusionMatrix"),o=S(t,"predictions","confusionMatrix");I(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),I(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),I(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),I(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),I(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var a=Hd(r.asType("int32"),n),i=Hd(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}});var k3=A({fromPixels_:function(e,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,a=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)a=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);i=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(fy("FromPixels",j.backendName)!=null)return j.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],d=l[1];if(i?s=e.getContext("2d").getImageData(0,0,c,d).data:r||n?s=e.data:(a||o)&&(Yo==null&&(Yo=document.createElement("canvas").getContext("2d")),Yo.canvas.width=c,Yo.canvas.height=d,Yo.drawImage(e,0,0,c,d),s=Yo.getImageData(0,0,c,d).data),t===4)u=new Int32Array(s);else{var f=c*d;u=new Int32Array(f*t);for(var h=0;h<f;h++)for(var v=0;v<t;++v)u[h*t+v]=s[4*h+v]}return uh(u,[d,c,t],"int32")}}),Fh=Object.freeze({toPixels:function(e,t){return re(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d,f,h,v,y,x,m,g,b,w,C,_,E,k;return oe(this,function(R){switch(R.label){case 0:if(n=S(e,"img","toPixels"),e instanceof qe||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=n.rank===2?1:n.shape[2])>4||i===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,n.data()];case 1:return s=R.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=R.sent(),d=c[0],f=c[1],h=d[0],v=f[0],u.dispose(),l.dispose(),n.dtype==="float32"){if(h<0||v>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+v+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||v>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+v+"].")}for(y=n.dtype==="float32"?255:1,x=new Uint8ClampedArray(a*o*4),m=0;m<o*a;++m)g=void 0,b=void 0,w=void 0,C=void 0,i===1?(g=s[m]*y,b=s[m]*y,w=s[m]*y,C=255):i===3?(g=s[3*m]*y,b=s[3*m+1]*y,w=s[3*m+2]*y,C=255):i===4&&(g=s[4*m]*y,b=s[4*m+1]*y,w=s[4*m+2]*y,C=s[4*m+3]*y),x[(_=4*m)+0]=Math.round(g),x[_+1]=Math.round(b),x[_+2]=Math.round(w),x[_+3]=Math.round(C);return t!=null&&(t.width=a,t.height=o,E=t.getContext("2d"),k=new ImageData(x,a,o),E.putImageData(k,0,0)),n!==e&&n.dispose(),[2,x]}})})},fromPixels:k3}),E3=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(t,n){return new t(n)},e}(),N3=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Vo(e){I(e.className!=null,function(){return"Class being registered does not have the static className property defined."}),I(typeof e.className=="string",function(){return"className is required to be a string, but got type "+typeof e.className}),I(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),N3.register(e)}var Ho=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return Wn(t,e),t.prototype.minimize=function(n,r,o){r===void 0&&(r=!1);var a=this.computeGradients(n,o),i=a.value,s=a.grads;if(o!=null){var u=o.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return en(s),r?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(n,r){return Mk(n,r)},t.prototype.dispose=function(){this.iterations_!=null&&en(this.iterations_)},t.prototype.saveIterations=function(){return re(this,void 0,void 0,function(){return oe(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:J(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return oe(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(n){return re(this,void 0,void 0,function(){return oe(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(n){return re(this,void 0,void 0,function(){var r;return oe(this,function(o){switch(o.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,n.slice(1)]}})})},t}(E3);Object.defineProperty(Ho,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var S3=function(e){function t(n,r,o){o===void 0&&(o=null);var a=e.call(this)||this;return a.learningRate=n,a.rho=r,a.epsilon=o,a.accumulatedGrads=[],a.accumulatedUpdates=[],o==null&&(a.epsilon=j.backend.epsilon()),a}return Wn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,a){var i=j.registeredVariables[o];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:o+"/accum_grad",variable:ee(function(){return Se(i).variable(!1)})}),r.accumulatedUpdates[a]==null&&(r.accumulatedUpdates[a]={originalName:o+"/accum_var",variable:ee(function(){return Se(i).variable(!1)})});var s=Array.isArray(n)?n[a].tensor:n[o];if(s!=null){var u=r.accumulatedGrads[a].variable,l=r.accumulatedUpdates[a].variable;ee(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),d=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=l.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(c),l.assign(f);var h=d.mul(-r.learningRate).add(i);i.assign(h)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(en(this.accumulatedGrads.map(function(n){return n.variable})),en(this.accumulatedUpdates.map(function(n){return n.variable})))},t.prototype.getWeights=function(){return re(this,void 0,void 0,function(){var n;return oe(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return re(this,void 0,void 0,function(){var r;return oe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(Ho);Vo(S3);var R3=function(e){function t(n,r){r===void 0&&(r=.1);var o=e.call(this)||this;return o.learningRate=n,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return Wn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,a){var i=j.registeredVariables[o];r.accumulatedGrads[a]==null&&(r.accumulatedGrads[a]={originalName:o+"/accumulator",variable:ee(function(){return rr(i.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(n)?n[a].tensor:n[o];if(s!=null){var u=r.accumulatedGrads[a].variable;ee(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(j.backend.epsilon()).sqrt()).mul(-r.learningRate).add(i);i.assign(c)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&en(this.accumulatedGrads.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return oe(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return re(this,void 0,void 0,function(){return oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(Ho);Vo(R3);var I3=function(e){function t(n,r,o,a){a===void 0&&(a=null);var i=e.call(this)||this;return i.learningRate=n,i.beta1=r,i.beta2=o,i.epsilon=a,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],ee(function(){i.accBeta1=J(r).variable(),i.accBeta2=J(o).variable()}),a==null&&(i.epsilon=j.backend.epsilon()),i}return Wn(t,e),t.prototype.applyGradients=function(n){var r=this,o=Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n);ee(function(){var a=gt(1,r.accBeta1),i=gt(1,r.accBeta2);o.forEach(function(s,u){var l=j.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ee(function(){return Se(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:ee(function(){return Se(l).variable(!1)})});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(c.mul(1-r.beta1)),v=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),y=h.div(a),x=v.div(i);d.assign(h),f.assign(v);var m=y.div(x.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(m)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&en(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&en(this.accumulatedSecondMoment.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return re(this,void 0,void 0,function(){var n;return oe(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return re(this,void 0,void 0,function(){var r,o=this;return oe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(n)];case 1:return n=a.sent(),ee(function(){o.accBeta1.assign(Xu(o.beta1,o.iterations_+1)),o.accBeta2.assign(Xu(o.beta2,o.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(Ho);Vo(I3);var D3=function(e){function t(n,r,o,a,i){a===void 0&&(a=null),i===void 0&&(i=0);var s=e.call(this)||this;return s.learningRate=n,s.beta1=r,s.beta2=o,s.epsilon=a,s.decay=i,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],ee(function(){s.iteration=J(0).variable(),s.accBeta1=J(r).variable()}),a==null&&(s.epsilon=j.backend.epsilon()),s}return Wn(t,e),t.prototype.applyGradients=function(n){var r=this,o=Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n);ee(function(){var a=gt(1,r.accBeta1),i=Pn(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var l=j.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Se(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Se(l).variable(!1)});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(c.mul(1-r.beta1)),v=f.mul(r.beta2),y=c.abs(),x=v.maximum(y);d.assign(h),f.assign(x);var m=i.div(a).mul(h.div(x.add(r.epsilon))).add(l);l.assign(m)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&en(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&en(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return oe(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(n){return re(this,void 0,void 0,function(){return oe(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(Ho);Vo(D3);var $x=function(e){function t(n){var r=e.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return Wn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,a){var i=Array.isArray(n)?n[a].tensor:n[o];if(i!=null){var s=j.registeredVariables[o];ee(function(){var u=r.c.mul(i).add(s);s.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=Y_(J(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return oe(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},t.prototype.setWeights=function(n){return re(this,void 0,void 0,function(){return oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,r){return new n(r.learningRate)},t.className="SGD",t}(Ho);Vo($x);var T3=function(e){function t(n,r,o){o===void 0&&(o=!1);var a=e.call(this,n)||this;return a.learningRate=n,a.momentum=r,a.useNesterov=o,a.accumulations=[],a.m=J(a.momentum),a}return Wn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,a){var i=j.registeredVariables[o];r.accumulations[a]==null&&(r.accumulations[a]={originalName:o+"/momentum",variable:ee(function(){return Se(i).variable(!1)})});var s=r.accumulations[a].variable,u=Array.isArray(n)?n[a].tensor:n[o];u!=null&&ee(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(i):r.c.mul(c).add(i),s.assign(c),i.assign(l)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&en(this.accumulations.map(function(n){return n.variable}))},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return oe(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return re(this,void 0,void 0,function(){return oe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}($x);Vo(T3);var A3=function(e){function t(n,r,o,a,i){r===void 0&&(r=.9),o===void 0&&(o=0),a===void 0&&(a=null),i===void 0&&(i=!1);var s=e.call(this)||this;if(s.learningRate=n,s.decay=r,s.momentum=o,s.epsilon=a,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=i,a==null&&(s.epsilon=j.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Wn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,a){var i=j.registeredVariables[o];r.accumulatedMeanSquares[a]==null&&(r.accumulatedMeanSquares[a]={originalName:o+"/rms",variable:ee(function(){return Se(i).variable(!1)})}),r.accumulatedMoments[a]==null&&(r.accumulatedMoments[a]={originalName:o+"/momentum",variable:ee(function(){return Se(i).variable(!1)})}),r.accumulatedMeanGrads[a]==null&&r.centered&&(r.accumulatedMeanGrads[a]={originalName:o+"/mg",variable:ee(function(){return Se(i).variable(!1)})});var s=Array.isArray(n)?n[a].tensor:n[o];if(s!=null){var u=r.accumulatedMeanSquares[a].variable,l=r.accumulatedMoments[a].variable;ee(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[a].variable,f=d.mul(r.decay).add(s.mul(1-r.decay)),h=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),d.assign(f),l.assign(h);var v=i.sub(h);i.assign(v)}else{var y=u.mul(r.decay).add(s.square().mul(1-r.decay));h=l.mul(r.momentum).add(s.mul(r.learningRate).div(y.add(r.epsilon).sqrt())),u.assign(y),l.assign(h),v=i.sub(h),i.assign(v)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&en(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&en(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&en(this.accumulatedMoments.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return re(this,void 0,void 0,function(){var n;return oe(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return re(this,void 0,void 0,function(){var r;return oe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(Ho);Vo(A3);qe.prototype.squaredDifference=function(e){return ox(this,e)},V=o3;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var tf=function(e,t){return tf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])},tf(e,t)};function me(e,t){tf(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Mt=function(){return Mt=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},Mt.apply(this,arguments)};function le(e,t,n,r){function o(a){return a instanceof n?a:new n(function(i){i(a)})}return new(n||(n=Promise))(function(a,i){function s(c){try{l(r.next(c))}catch(d){i(d)}}function u(c){try{l(r.throw(c))}catch(d){i(d)}}function l(c){c.done?a(c.value):o(c.value).then(s,u)}l((r=r.apply(e,t||[])).next())})}function ce(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,o,a,i;return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(a=l[0]&2?o.return:l[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,l[1])).done)return a;switch(o=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,o=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){n.label=l[1];break}if(l[0]===6&&n.label<a[1]){n.label=a[1],a=l;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(l);break}a[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(c){l=[6,c],o=0}finally{r=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function _i(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),o=0,t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}var Sa=function(){function e(t,n){if(!To(t)||!To(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:n}));this._width=t,this._height=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Il(e,t){return e instanceof qe&&e.shape.length===t}function P3(e){return Il(e,2)}function Dl(e){return Il(e,3)}function to(e){return Il(e,4)}function F3(e){return e%1!==0}function Ev(e){return e%2===0}function j3(e,t){t===void 0&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function Nv(e){return e&&e.width&&e.height}function M3(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new Sa(Math.round(n*o),Math.round(r*o))}function jh(e){return e.reduce(function(t,n){return t.add(n)},new Pe(0,0)).div(new Pe(e.length,e.length))}function Yi(e,t,n){return Array(e).fill(0).map(function(r,o){return t+o*n})}function To(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function Sv(e){return To(e)&&0<=e&&e<=1}var Pe=function(){function e(t,n){this._x=t,this._y=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),io=function(){function e(t,n){n===void 0&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(To),a=[r.x,r.y,r.width,r.height].every(To);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=i[0],u=i[1],l=i[2],c=i[3];e.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return e.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(To)},e.assertIsValidBox=function(t,n,r){if(r===void 0&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Pe(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Pe(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Pe(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Pe(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(i){return Math.round(i)}),n=t[0],r=t[1],o=t[2],a=t[3];return new e({x:n,y:r,width:o,height:a})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(i){return Math.floor(i)}),n=t[0],r=t[1],o=t[2],a=t[3];return new e({x:n,y:r,width:o,height:a})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,a=t.height,i=Math.abs(o-a);return o<a&&(n-=i/2,o+=i),a<o&&(r-=i/2,a+=i),new e({x:n,y:r,width:o,height:a})},e.prototype.rescale=function(t){var n=Nv(t)?t.width:t,r=Nv(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n],o=r[0],a=r[1],i=r[2],s=r[3];return new e({x:o,y:a,width:i,height:s})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,a=r.y,i=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(a,0),c=i-u,d=s-l,f=Math.min(c,t-u),h=Math.min(d,n-l);return new e({x:u,y:l,width:f,height:h}).floor()},e.prototype.shift=function(t,n){var r=this,o=r.width,a=r.height,i=this.x+t,s=this.y+n;return new e({x:i,y:s,width:o,height:a})},e.prototype.padAtBorders=function(t,n){var r=this.width+1,o=this.height+1,a=1,i=1,s=r,u=o,l=this.left,c=this.top,d=this.right,f=this.bottom;return d>n&&(s=-d+n+r,d=n),f>t&&(u=-f+t+o,f=t),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:i,edy:u,dx:a,edx:s,y:c,ey:f,x:l,ex:d,w:r,h:o}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),Tl=function(e){me(t,e);function t(n,r,o,a,i){return i===void 0&&(i=!1),e.call(this,{left:n,top:r,right:o,bottom:a},i)||this}return t}(io),Vx=function(){function e(t,n,r,o,a){this._imageDims=new Sa(a.width,a.height),this._score=t,this._classScore=n,this._className=r,this._box=new io(o).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new io(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),ur=function(e){me(t,e);function t(n,r,o){return e.call(this,n,n,"",r,o)||this}return t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r),a=o.score,i=o.relativeBox,s=o.imageDims;return new t(a,i,s)},t}(Vx);function O3(e,t,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),o=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),a=r*o;return n?a/(e.area+t.area-a):a/Math.min(e.area,t.area)}function L3(e){var t=e.map(function(s){return s.x}),n=e.map(function(s){return s.y}),r=t.reduce(function(s,u){return u<s?u:s},1/0),o=n.reduce(function(s,u){return u<s?u:s},1/0),a=t.reduce(function(s,u){return s<u?u:s},0),i=n.reduce(function(s,u){return s<u?u:s},0);return new Tl(r,o,a,i)}function Qi(e,t,n,r){r===void 0&&(r=!0);for(var o=t.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),a=[],i=function(){var s=o.pop();a.push(s);for(var u=o,l=[],c=0;c<u.length;c++){var d=u[c],f=e[s],h=e[d];l.push(O3(f,h,r))}o=o.filter(function(v,y){return l[y]<=n})};o.length>0;)i();return a}function ds(e,t){return ee(function(){var n=t[0],r=t[1],o=t[2],a=rr(_i(e.shape.slice(0,3),[1]),n),i=rr(_i(e.shape.slice(0,3),[1]),r),s=rr(_i(e.shape.slice(0,3),[1]),o),u=pt([a,i,s],3);return gt(e,u)})}function B3(e,t){return t===void 0&&(t=!1),ee(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var a=Math.abs(r-o),i=Math.round(a*(t?.5:1)),s=r>o?2:1,u=function(h){var v=e.shape.slice();return v[s]=h,rr(v,0)},l=u(i),c=a-l.shape[s],d=t&&c?u(c):null,f=[d,e,l].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return pt(f,s)})}function Pc(e){return 1/(1+Math.exp(-e))}var Mh=function(e){me(t,e);function t(n,r,o,a,i){return i===void 0&&(i=!1),e.call(this,{x:n,y:r,width:o,height:a},i)||this}return t}(io),W3=.5,z3=.43,U3=.45,Ju=function(){function e(t,n,r){r===void 0&&(r=new Pe(0,0));var o=n.width,a=n.height;this._imgDims=new Sa(o,a),this._shift=r,this._positions=t.map(function(i){return i.mul(new Pe(o,a)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Pe(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(n){return n.sub(t._shift).div(new Pe(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new this.constructor(this.relativePositions,{width:t,height:n})},e.prototype.shiftBy=function(t,n){return new this.constructor(this.relativePositions,this._imgDims,new Pe(t,n))},e.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},e.prototype.align=function(t,n){if(n===void 0&&(n={}),t){var r=t instanceof ur?t.box.floor():new io(t);return this.shiftBy(r.x,r.y).align(null,n)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),a=o.useDlibAlignment,i=o.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)},e.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),n=t[0],r=t[1],o=t[2],a=function(d){return o.sub(d).magnitude()},i=(a(n)+a(r))/2,s=Math.floor(i/U3),u=jh(t),l=Math.floor(Math.max(0,u.x-W3*s)),c=Math.floor(Math.max(0,u.y-z3*s));return new Mh(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},e.prototype.alignMinBbox=function(t){var n=L3(this.positions);return n.pad(n.width*t,n.height*t)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),$3=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],jh([n[3],n[4]])]},t}(Ju),V3=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(jh)},t}(Ju),Rv=function(){function e(t,n){this._label=t,this._distance=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+j3(this.distance)+")":"")},e}(),Iv=function(e){me(t,e);function t(n,r){var o=e.call(this,n)||this;return o._label=r,o}return t.assertIsValidLabeledBox=function(n,r){if(io.assertIsValidBox(n,r),!To(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(io),Ws=function(){function e(t,n){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(r){return new Float32Array(r)});return new e(t.label,n)},e}();(function(e){me(t,e);function t(n,r,o,a){var i=e.call(this,n,r)||this;return i._score=o,i._classScore=a,i}return t.assertIsValidPredictedBox=function(n,r){if(Iv.assertIsValidLabeledBox(n,r),!Sv(n.score)||!Sv(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(Iv);function H3(e){return e.detection instanceof ur}function Oh(e,t){var n={detection:t};return Object.assign({},e,n)}function Hx(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:t}}function Gx(e){var t="";if(!e)try{e=require("fs")}catch(r){t=r.toString()}var n=e?function(r){return new Promise(function(o,a){e.readFile(r,function(i,s){return i?a(i):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:n}}function qx(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=Gx();return Mt({Canvas:e||function(){function i(){}return i}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function i(){}return i}(),Image:t||function(){function i(){}return i}(),ImageData:global.ImageData||function(){function i(){}return i}(),Video:global.HTMLVideoElement||function(){function i(){}return i}(),createCanvasElement:n,createImageElement:r,fetch:o},a)}function Kx(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Xx(){return typeof global=="object"&&typeof require=="function"&&typeof N1<"u"&&typeof process<"u"&&!!process.version}var dt;function G3(){if(!dt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return dt}function nf(e){dt=e}function Lh(){Kx()&&nf(Hx()),Xx()&&nf(qx())}function q3(e){if(dt||Lh(),!dt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=t===void 0?dt.Canvas:t,r=e.Image,o=r===void 0?dt.Image:r;dt.Canvas=n,dt.Image=o,dt.createCanvasElement=e.createCanvasElement||function(){return new n},dt.createImageElement=e.createImageElement||function(){return new o},dt.ImageData=e.ImageData||dt.ImageData,dt.Video=e.Video||dt.Video,dt.fetch=e.fetch||dt.fetch,dt.readFile=e.readFile||dt.readFile}var zt={getEnv:G3,setEnv:nf,initialize:Lh,createBrowserEnv:Hx,createFileSystem:Gx,createNodejsEnv:qx,monkeyPatch:q3,isBrowser:Kx,isNodejs:Xx};Lh();function Yx(e){return!zt.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function Lo(e){var t=zt.getEnv(),n=t.Canvas,r=t.CanvasRenderingContext2D;if(e instanceof r)return e;var o=Yx(e);if(!(o instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=o.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var Dv;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Dv||(Dv={}));function Qx(e){var t=zt.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function K3(e){return new Promise(function(t,n){if(e instanceof zt.getEnv().Canvas||Qx(e))return t();function r(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",o),t(a))}function o(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",r),a.currentTarget.removeEventListener("error",o),n(a))}e.addEventListener("load",r),e.addEventListener("error",o)})}function Jx(e){var t=zt.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new Sa(e.naturalWidth,e.naturalHeight):e instanceof r?new Sa(e.videoWidth,e.videoHeight):new Sa(e.width,e.height)}function Al(e){var t=e.width,n=e.height,r=zt.getEnv().createCanvasElement,o=r();return o.width=t,o.height=n,o}function Bh(e,t){var n=zt.getEnv().ImageData;if(!(e instanceof n)&&!Qx(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||Jx(e),o=r.width,a=r.height,i=Al({width:o,height:a});return e instanceof n?Lo(i).putImageData(e,0,0):Lo(i).drawImage(e,0,0,o,a),i}function X3(e,t){return le(this,void 0,void 0,function(){var n,r,o,a,i,s;return ce(this,function(u){switch(u.label){case 0:return n=t||zt.getEnv().createCanvasElement(),r=e.shape.slice(to(e)?1:0),o=r[0],a=r[1],i=r[2],s=ee(function(){return e.as3D(o,a,i).toInt()}),[4,Fh.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function Tv(e){var t=zt.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}function Y3(e,t,n){n===void 0&&(n=!1);var r=zt.getEnv(),o=r.Image,a=r.Canvas;if(!(e instanceof o||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=Jx(e),s=t/Math.max(i.height,i.width),u=s*i.width,l=s*i.height,c=Al({width:t,height:t}),d=e instanceof a?e:Bh(e),f=Math.abs(u-l)/2,h=n&&u<l?f:0,v=n&&l<u?f:0;return Lo(c).drawImage(d,h,v,u,l),c}var Zu=function(){function e(t,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=n,this._batchSize=t.length,t.forEach(function(o,a){if(Dl(o)){r._imageTensors[a]=o,r._inputDimensions[a]=o.shape;return}if(to(o)){var i=o.shape[0];if(i!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+i+" passed, but not supported in input array");r._imageTensors[a]=o,r._inputDimensions[a]=o.shape.slice(1);return}var s=o instanceof zt.getEnv().Canvas?o:Bh(o);r._canvases[a]=s,r._inputDimensions[a]=[s.height,s.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var t=this;return Yi(this.batchSize,0,1).map(function(n,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},e.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},e.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},e.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},e.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(t),r=this.getInputHeight(t);return M3({width:n,height:r},this.inputSize)},e.prototype.toBatchTensor=function(t,n){var r=this;return n===void 0&&(n=!0),this._inputSize=t,ee(function(){var o=Yi(r.batchSize,0,1).map(function(i){var s=r.getInput(i);if(s instanceof qe){var u=to(s)?s:s.expandDims();return u=B3(u,n),(u.shape[1]!==t||u.shape[2]!==t)&&(u=Rh.resizeBilinear(u,[t,t])),u.as3D(t,t,3)}if(s instanceof zt.getEnv().Canvas)return Fh.fromPixels(Y3(s,t,n));throw new Error("toBatchTensor - at batchIdx "+i+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),a=hn(o.map(function(i){return i.toFloat()})).as4D(r.batchSize,t,t,3);return a})},e}();function _t(e){return le(this,void 0,void 0,function(){var t,n,r;return ce(this,function(o){switch(o.label){case 0:if(e instanceof Zu)return[2,e];if(t=Array.isArray(e)?e:[e],!t.length)throw new Error("toNetInput - empty array passed as input");return n=function(a){return Array.isArray(e)?" at input index "+a+":":""},r=t.map(Yx),r.forEach(function(a,i){if(!Tv(a)&&!Dl(a)&&!to(a))throw typeof t[i]=="string"?new Error("toNetInput -"+n(i)+" string passed, but could not resolve HTMLElement for element id "+t[i]):new Error("toNetInput -"+n(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(to(a)){var s=a.shape[0];if(s!==1)throw new Error("toNetInput -"+n(i)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(a){return Tv(a)&&K3(a)}))];case 1:return o.sent(),[2,new Zu(r,Array.isArray(e))]}})})}function Wh(e,t){return le(this,void 0,void 0,function(){var n,r,o,a,i,s,u;return ce(this,function(l){switch(l.label){case 0:return n=zt.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,_t(e)];case 1:if(o=l.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return a=o.getInput(0),a instanceof n?(i=a,[3,4]):[3,2];case 2:return[4,X3(a)];case 3:i=l.sent(),l.label=4;case 4:r=i,l.label=5;case 5:return s=Lo(r),u=t.map(function(c){return c instanceof ur?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var d=c.x,f=c.y,h=c.width,v=c.height,y=Al({width:h,height:v});return Lo(y).putImageData(s.getImageData(d,f,h,v),0,0),y})]}})})}function zh(e,t){return le(this,void 0,void 0,function(){return ce(this,function(n){if(!Dl(e)&&!to(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(to(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ee(function(){var r=e.shape.slice(to(e)?1:0),o=r[0],a=r[1],i=r[2],s=t.map(function(l){return l instanceof ur?l.forSize(a,o).box:l}).map(function(l){return l.clipAtImageBorders(a,o)}),u=s.map(function(l){var c=l.x,d=l.y,f=l.width,h=l.height;return Ex(e.as3D(o,a,i),[d,c,0],[h,f,i])});return u})]})})}function Q3(e,t){return le(this,void 0,void 0,function(){var n,r;return ce(this,function(o){switch(o.label){case 0:return n=zt.getEnv().fetch,[4,n(e,t)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function J3(e){return le(this,void 0,void 0,function(){return ce(this,function(t){switch(t.label){case 0:return[4,Q3(e)];case 1:return[2,t.sent().json()]}})})}function Zx(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var o=e.split("/").filter(function(s){return s}),a=e.endsWith(".json")?o[o.length-1]:n,i=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return i=e.startsWith("/")?"/"+i:i,{modelBaseUri:i,manifestUri:i==="/"?"/"+a:i+"/"+a}}function Z3(e,t){return le(this,void 0,void 0,function(){var n,r,o,a;return ce(this,function(i){switch(i.label){case 0:return n=Zx(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,J3(r)];case 1:return a=i.sent(),[2,Ux.loadWeights(a,o)]}})})}var Er=function(){function e(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(t){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;return r[o]},e.prototype.reassignParamFromPath=function(t,n){var r=this.traversePropertyPath(t),o=r.obj,a=r.objProp;o[a].dispose(),o[a]=n},e.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Oa})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Oa)})},e.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(n){var r=n.path,o=n.tensor;t.reassignParamFromPath(r,o.variable())})},e.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(n){var r=n.path,o=n.tensor,a=Rt(o.dataSync());o.dispose(),t.reassignParamFromPath(r,a)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(n){if(t&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var n=t.tensor;return Array.from(n.dataSync())}).reduce(function(t,n){return t.concat(n)}))},e.prototype.load=function(t){return le(this,void 0,void 0,function(){return ce(this,function(n){switch(n.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return n.sent(),[2]}})})},e.prototype.loadFromUri=function(t){return le(this,void 0,void 0,function(){var n;return ce(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Z3(t,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},e.prototype.loadFromDisk=function(t){return le(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d;return ce(this,function(f){switch(f.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=zt.getEnv().readFile,r=Zx(t,this.getDefaultModelName()),o=r.manifestUri,a=r.modelBaseUri,i=function(h){return Promise.all(h.map(function(v){return n(v).then(function(y){return y.buffer})}))},s=Ux.weightsLoaderFactory(i),c=(l=JSON).parse,[4,n(o)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,s(u,a)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},e.prototype.loadFromWeightMap=function(t){var n=this.extractParamsFromWeigthMap(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.extractWeights=function(t){var n=this.extractParams(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=t.split("/").reduce(function(a,i){if(!a.nextObj.hasOwnProperty(i))throw new Error("traversePropertyPath - object does not have property "+i+", for path "+t);return{obj:a.nextObj,objProp:i,nextObj:a.nextObj[i]}},{nextObj:this.params}),r=n.obj,o=n.objProp;if(!r||!o||!(r[o]instanceof qe))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:o}},e}();function dn(e,t,n){return ee(function(){var r=_h(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=we(r,t.bias),r})}function Fc(e,t,n){return n===void 0&&(n=!1),ee(function(){var r=Ke(n?we(Sn(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):dn(e,t.conv0,[2,2])),o=dn(r,t.conv1,[1,1]),a=Ke(we(r,o)),i=dn(a,t.conv2,[1,1]);return Ke(we(r,we(o,i)))})}function zs(e,t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),ee(function(){var o=Ke(n?we(Sn(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):dn(e,t.conv0,r?[2,2]:[1,1])),a=dn(o,t.conv1,[1,1]),i=Ke(we(o,a)),s=dn(i,t.conv2,[1,1]),u=Ke(we(o,we(a,s))),l=dn(u,t.conv3,[1,1]);return Ke(we(o,we(a,we(s,l))))})}function Ln(e,t,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),ee(function(){var o=we(Sn(e,t.filters,[1,1],n),t.bias);return r?Ke(o):o})}function Nr(e,t){Object.keys(e).forEach(function(n){t.some(function(r){return r.originalPath===n})||e[n].dispose()})}function Pl(e,t){return function(n,r,o,a){var i=Kt(e(n*r*o*o),[o,o,n,r]),s=ut(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}}function Uh(e,t){return function(n,r,o){var a=Zr(e(n*r),[n,r]),i=ut(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var e1=function(){function e(t,n,r){this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}return e}();function $h(e,t){return function(n,r,o){var a=Kt(e(9*n),[3,3,n,1]),i=Kt(e(n*r),[1,1,n,r]),s=ut(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new e1(a,i,s)}}function Vh(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new e1(n,r,o)}}function vo(e,t){return function(n,r,o){var a=e[n];if(!Il(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:o||n}),a}}function Sr(e){var t=e;function n(o){var a=t.slice(0,o);return t=t.slice(o),a}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function t1(e,t){var n=Pl(e,t),r=$h(e,t);function o(i,s,u,l){l===void 0&&(l=!1);var c=l?n(i,s,3,u+"/conv0"):r(i,s,u+"/conv0"),d=r(s,s,u+"/conv1"),f=r(s,s,u+"/conv2");return{conv0:c,conv1:d,conv2:f}}function a(i,s,u,l){l===void 0&&(l=!1);var c=o(i,s,u,l),d=c.conv0,f=c.conv1,h=c.conv2,v=r(s,s,u+"/conv3");return{conv0:d,conv1:f,conv2:h,conv3:v}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function eR(e){var t=[],n=Sr(e),r=n.extractWeights,o=n.getRemainingWeights,a=t1(r,t).extractDenseBlock4Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),l=a(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u,dense3:l}}}function n1(e){return function(t){var n=e(t+"/filters",4),r=e(t+"/bias",1);return{filters:n,bias:r}}}function r1(e,t){var n=vo(e,t),r=n1(n),o=Vh(n);function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),d=o(s+"/conv2");return{conv0:l,conv1:c,conv2:d}}function i(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),d=o(s+"/conv2"),f=o(s+"/conv3");return{conv0:l,conv1:c,conv2:d,conv3:f}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:i}}function tR(e){var t=[],n=r1(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Nr(e,t),{params:r,paramMappings:t}}var o1=function(e){me(t,e);function t(){return e.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ee(function(){var o=n.toBatchTensor(112,!0),a=[122.782,117.001,104.298],i=ds(o,a).div(J(255)),s=zs(i,r.dense0,!0);return s=zs(s,r.dense1),s=zs(s,r.dense2),s=zs(s,r.dense3),s=ls(s,[7,7],[2,2],"valid"),s})},t.prototype.forward=function(n){return le(this,void 0,void 0,function(){var r;return ce(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(n){return tR(n)},t.prototype.extractParams=function(n){return eR(n)},t}(Er);function Jn(e,t){return ee(function(){return we(Nl(e,t.weights),t.bias)})}function nR(e,t,n){var r=[],o=Sr(e),a=o.extractWeights,i=o.getRemainingWeights,s=Uh(a,r),u=s(t,n,"fc");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:u}}}function rR(e){var t=[],n=vo(e,t);function r(a){var i=n(a+"/weights",2),s=n(a+"/bias",1);return{weights:i,bias:s}}var o={fc:r("fc")};return Nr(e,t),{params:o,paramMappings:t}}function a1(e){var t={},n={};return Object.keys(e).forEach(function(r){var o=r.startsWith("fc")?n:t;o[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var i1=function(e){me(t,e);function t(n,r){var o=e.call(this,n)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ee(function(){var a=n instanceof Zu?r.faceFeatureExtractor.forwardInput(n):n;return Jn(a.as2D(a.shape[0],-1),o.fc)})},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,a=r.paramMappings;this._params=o,this._paramMappings=a},t.prototype.extractClassifierParams=function(n){return nR(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(n){var r=a1(n),o=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),rR(a)},t.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),a=o*r+o,i=n.slice(0,n.length-a),s=n.slice(n.length-a);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(s)},t}(Er),Av=["neutral","happy","sad","angry","fearful","disgusted","surprised"],oR=function(){function e(t){var n=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);Av.forEach(function(r,o){n[r]=t[o]})}return e.prototype.asSortedArray=function(){var t=this;return Av.map(function(n){return{expression:n,probability:t[n]}}).sort(function(n,r){return r.probability-n.probability})},e}(),aR=function(e){me(t,e);function t(n){return n===void 0&&(n=new o1),e.call(this,"FaceExpressionNet",n)||this}return t.prototype.forwardInput=function(n){var r=this;return ee(function(){return _r(r.runNet(n))})},t.prototype.forward=function(n){return le(this,void 0,void 0,function(){var r;return ce(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(n){return le(this,void 0,void 0,function(){var r,o,a,i,s=this;return ce(this,function(u){switch(u.label){case 0:return[4,_t(n)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(mt(o).map(function(l){return le(s,void 0,void 0,function(){var c;return ce(this,function(d){switch(d.label){case 0:return[4,l.data()];case 1:return c=d.sent(),l.dispose(),[2,c]}})})}))];case 3:return a=u.sent(),o.dispose(),i=a.map(function(l){return new oR(l)}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(i1);function s1(e,t){var n={expressions:t};return Object.assign({},e,n)}function iR(e){return H3(e)&&e.landmarks instanceof Ju&&e.unshiftedLandmarks instanceof Ju&&e.alignedRect instanceof ur}function Hh(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),a=e.detection.imageDims,i=new ur(e.detection.score,o.rescale(a.reverse()),a),s={landmarks:r,unshiftedLandmarks:t,alignedRect:i};return Object.assign({},e,s)}function sR(e,t){var n=Pl(e,t),r=$h(e,t);function o(i,s,u){var l=r(i,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),d=n(i,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:d}}function a(i,s){var u=r(i,i,s+"/separable_conv0"),l=r(i,i,s+"/separable_conv1"),c=r(i,i,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:a}}function uR(e,t){var n=[],r=Sr(e),o=r.extractWeights,a=r.getRemainingWeights,i=sR(o,n),s=i.extractConvParams,u=i.extractSeparableConvParams,l=i.extractReductionBlockParams,c=i.extractMainBlockParams,d=s(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),h=l(64,128,"entry_flow/reduction_block_1"),v={conv_in:d,reduction_block_0:f,reduction_block_1:h},y={};Yi(t,0,1).forEach(function(b){y["main_block_"+b]=c(128,"middle_flow/main_block_"+b)});var x=l(128,256,"exit_flow/reduction_block"),m=u(256,512,"exit_flow/separable_conv"),g={reduction_block:x,separable_conv:m};if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:v,middle_flow:y,exit_flow:g}}}function lR(e,t){var n=vo(e,t),r=n1(n),o=Vh(n);function a(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function i(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:a,extractMainBlockParams:i}}function cR(e,t){var n=[],r=lR(e,n),o=r.extractConvParams,a=r.extractSeparableConvParams,i=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=o("entry_flow/conv_in"),l=i("entry_flow/reduction_block_0"),c=i("entry_flow/reduction_block_1"),d={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};Yi(t,0,1).forEach(function(x){f["main_block_"+x]=s("middle_flow/main_block_"+x)});var h=i("exit_flow/reduction_block"),v=a("exit_flow/separable_conv"),y={reduction_block:h,separable_conv:v};return Nr(e,n),{params:{entry_flow:d,middle_flow:f,exit_flow:y},paramMappings:n}}function u1(e,t,n){return we(Sn(e,t.filters,n,"same"),t.bias)}function jc(e,t,n){n===void 0&&(n=!0);var r=n?Ke(e):e;return r=dn(r,t.separable_conv0,[1,1]),r=dn(Ke(r),t.separable_conv1,[1,1]),r=xt(r,[3,3],[2,2],"same"),r=we(r,u1(e,t.expansion_conv,[2,2])),r}function dR(e,t){var n=dn(Ke(e),t.separable_conv0,[1,1]);return n=dn(Ke(n),t.separable_conv1,[1,1]),n=dn(Ke(n),t.separable_conv2,[1,1]),n=we(n,e),n}var fR=function(e){me(t,e);function t(n){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return t.prototype.forwardInput=function(n){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return ee(function(){var a=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],s=ds(a,i).div(J(256)),u=Ke(u1(s,o.entry_flow.conv_in,[2,2]));return u=jc(u,o.entry_flow.reduction_block_0,!1),u=jc(u,o.entry_flow.reduction_block_1),Yi(r._numMainBlocks,0,1).forEach(function(l){u=dR(u,o.middle_flow["main_block_"+l])}),u=jc(u,o.exit_flow.reduction_block),u=Ke(dn(u,o.exit_flow.separable_conv,[1,1])),u})},t.prototype.forward=function(n){return le(this,void 0,void 0,function(){var r;return ce(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(n){return cR(n,this._numMainBlocks)},t.prototype.extractParams=function(n){return uR(n,this._numMainBlocks)},t}(Er);function hR(e){var t=[],n=Sr(e),r=n.extractWeights,o=n.getRemainingWeights,a=Uh(r,t),i=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:i,gender:s}}}}function pR(e){var t=[],n=vo(e,t);function r(a){var i=n(a+"/weights",2),s=n(a+"/bias",1);return{weights:i,bias:s}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Nr(e,t),{params:o,paramMappings:t}}var el;(function(e){e.FEMALE="female",e.MALE="male"})(el||(el={}));var mR=function(e){me(t,e);function t(n){n===void 0&&(n=new fR(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ee(function(){var a=n instanceof Zu?r.faceFeatureExtractor.forwardInput(n):n,i=ls(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1),s=Jn(i,o.fc.age).as1D(),u=Jn(i,o.fc.gender);return{age:s,gender:u}})},t.prototype.forwardInput=function(n){var r=this;return ee(function(){var o=r.runNet(n),a=o.age,i=o.gender;return{age:a,gender:_r(i)}})},t.prototype.forward=function(n){return le(this,void 0,void 0,function(){var r;return ce(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictAgeAndGender=function(n){return le(this,void 0,void 0,function(){var r,o,a,i,s,u,l=this;return ce(this,function(c){switch(c.label){case 0:return[4,_t(n)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return o=c.sent(),a=mt(o.age),i=mt(o.gender),s=a.map(function(d,f){return{ageTensor:d,genderTensor:i[f]}}),[4,Promise.all(s.map(function(d){var f=d.ageTensor,h=d.genderTensor;return le(l,void 0,void 0,function(){var v,y,x,m,g;return ce(this,function(b){switch(b.label){case 0:return[4,f.data()];case 1:return v=b.sent()[0],[4,h.data()];case 2:return y=b.sent()[0],x=y>.5,m=x?el.MALE:el.FEMALE,g=x?y:1-y,f.dispose(),h.dispose(),[2,{age:v,gender:m,genderProbability:g}]}})})}))];case 3:return u=c.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,a=r.paramMappings;this._params=o,this._paramMappings=a},t.prototype.extractClassifierParams=function(n){return hR(n)},t.prototype.extractParamsFromWeigthMap=function(n){var r=a1(n),o=r.featureExtractorMap,a=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),pR(a)},t.prototype.extractParams=function(n){var r=1539,o=n.slice(0,n.length-r),a=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},t}(Er),l1=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.postProcess=function(n,r,o){var a=o.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),i=a.length;return ee(function(){var s=function(f,h){return hn([rr([68],f),rr([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var v=a[f],y=v.width,x=v.height;return h(y,x)?Math.abs(y-x)/2:0},l=function(f){return u(f,function(h,v){return h<v})},c=function(f){return u(f,function(h,v){return v<h})},d=n.mul(rr([i,136],r)).sub(hn(Array.from(Array(i),function(f,h){return s(l(h),c(h))}))).div(hn(Array.from(Array(i),function(f,h){return s(a[h].width,a[h].height)})));return d})},t.prototype.forwardInput=function(n){var r=this;return ee(function(){var o=r.runNet(n);return r.postProcess(o,n.inputSize,n.inputDimensions.map(function(a){var i=a[0],s=a[1];return{height:i,width:s}}))})},t.prototype.forward=function(n){return le(this,void 0,void 0,function(){var r;return ce(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(n){return le(this,void 0,void 0,function(){var r,o,a,i=this;return ce(this,function(s){switch(s.label){case 0:return[4,_t(n)];case 1:return r=s.sent(),o=ee(function(){return mt(i.forwardInput(r))}),[4,Promise.all(o.map(function(u,l){return le(i,void 0,void 0,function(){var c,d,f,h,v;return ce(this,function(y){switch(y.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return c=f.apply(d,[y.sent()]),h=c.filter(function(x,m){return Ev(m)}),v=c.filter(function(x,m){return!Ev(m)}),[2,new V3(Array(68).fill(0).map(function(x,m){return new Pe(h[m],v[m])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return a=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(i1),c1=function(e){me(t,e);function t(n){return n===void 0&&(n=new o1),e.call(this,"FaceLandmark68Net",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(l1);function vR(e){var t=[],n=r1(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Nr(e,t),{params:r,paramMappings:t}}function gR(e){var t=[],n=Sr(e),r=n.extractWeights,o=n.getRemainingWeights,a=t1(r,t).extractDenseBlock3Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u}}}var yR=function(e){me(t,e);function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ee(function(){var o=n.toBatchTensor(112,!0),a=[122.782,117.001,104.298],i=ds(o,a).div(J(255)),s=Fc(i,r.dense0,!0);return s=Fc(s,r.dense1),s=Fc(s,r.dense2),s=ls(s,[14,14],[2,2],"valid"),s})},t.prototype.forward=function(n){return le(this,void 0,void 0,function(){var r;return ce(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(n){return vR(n)},t.prototype.extractParams=function(n){return gR(n)},t}(Er),xR=function(e){me(t,e);function t(n){return n===void 0&&(n=new yR),e.call(this,"FaceLandmark68TinyNet",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(l1);(function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(c1);function bR(e,t){return we(Bt(e,t.weights),t.biases)}function Gh(e,t,n,r,o){o===void 0&&(o="same");var a=t.conv,i=a.filters,s=a.bias,u=Sn(e,i,n,o);return u=we(u,s),u=bR(u,t.scale),r?Ke(u):u}function wR(e,t){return Gh(e,t,[1,1],!0)}function d1(e,t){return Gh(e,t,[1,1],!1)}function f1(e,t){return Gh(e,t,[2,2],!0,"valid")}function CR(e,t){function n(s,u,l){var c=e(s),d=c.length/(u*l*l);if(F3(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return ee(function(){return ao(Kt(c,[u,d,l,l]),[2,3,1,0])})}function r(s,u,l,c){var d=n(s,u,l),f=ut(e(u));return t.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:d,bias:f}}function o(s,u){var l=ut(e(s)),c=ut(e(s));return t.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function a(s,u,l,c){var d=r(s,u,l,c+"/conv"),f=o(u,c+"/scale");return{conv:d,scale:f}}function i(s,u,l,c,d){d===void 0&&(d=!1);var f=a((d?.5:1)*s,u,l,c+"/conv1"),h=a(s,u,l,c+"/conv2");return{conv1:f,conv2:h}}return{extractConvLayerParams:a,extractResidualLayerParams:i}}function _R(e){var t=Sr(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=CR(n,o),i=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=i(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),v=s(36864,64,3,"conv64_2"),y=s(36864,64,3,"conv64_3"),x=s(147456,128,3,"conv128_down",!0),m=s(147456,128,3,"conv128_1"),g=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),C=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),E=ee(function(){return ao(Zr(n(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var k={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:v,conv64_3:y,conv128_down:x,conv128_1:m,conv128_2:g,conv256_down:b,conv256_1:w,conv256_2:C,conv256_down_out:_,fc:E};return{params:k,paramMappings:o}}function kR(e,t){var n=vo(e,t);function r(i){var s=n(i+"/scale/weights",1),u=n(i+"/scale/biases",1);return{weights:s,biases:u}}function o(i){var s=n(i+"/conv/filters",4),u=n(i+"/conv/bias",1),l=r(i);return{conv:{filters:s,bias:u},scale:l}}function a(i){return{conv1:o(i+"/conv1"),conv2:o(i+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function ER(e){var t=[],n=kR(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,a=r("conv32_down"),i=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),d=o("conv64_2"),f=o("conv64_3"),h=o("conv128_down"),v=o("conv128_1"),y=o("conv128_2"),x=o("conv256_down"),m=o("conv256_1"),g=o("conv256_2"),b=o("conv256_down_out"),w=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!P3(w))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var C={conv32_down:a,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:v,conv128_2:y,conv256_down:x,conv256_1:m,conv256_2:g,conv256_down_out:b,fc:w};return Nr(e,t),{params:C,paramMappings:t}}function Hn(e,t){var n=wR(e,t.conv1);return n=d1(n,t.conv2),n=we(n,e),n=Ke(n),n}function Us(e,t){var n=f1(e,t.conv1);n=d1(n,t.conv2);var r=ls(e,2,2,"valid"),o=Ue(r.shape),a=r.shape[3]!==n.shape[3],i=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(i){var s=_i(n.shape);s[1]=1;var u=Ue(s);n=pt([n,u],1);var l=_i(n.shape);l[2]=1;var c=Ue(l);n=pt([n,c],2)}return r=a?pt([r,o],3):r,n=we(r,n),n=Ke(n),n}var NR=function(e){me(t,e);function t(){return e.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ee(function(){var o=n.toBatchTensor(150,!0).toFloat(),a=[122.782,117.001,104.298],i=ds(o,a).div(J(256)),s=f1(i,r.conv32_down);s=xt(s,3,2,"valid"),s=Hn(s,r.conv32_1),s=Hn(s,r.conv32_2),s=Hn(s,r.conv32_3),s=Us(s,r.conv64_down),s=Hn(s,r.conv64_1),s=Hn(s,r.conv64_2),s=Hn(s,r.conv64_3),s=Us(s,r.conv128_down),s=Hn(s,r.conv128_1),s=Hn(s,r.conv128_2),s=Us(s,r.conv256_down),s=Hn(s,r.conv256_1),s=Hn(s,r.conv256_2),s=Us(s,r.conv256_down_out);var u=s.mean([1,2]),l=Nl(u,r.fc);return l})},t.prototype.forward=function(n){return le(this,void 0,void 0,function(){var r;return ce(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(n){return le(this,void 0,void 0,function(){var r,o,a,i=this;return ce(this,function(s){switch(s.label){case 0:return[4,_t(n)];case 1:return r=s.sent(),o=ee(function(){return mt(i.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return a=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(n){return ER(n)},t.prototype.extractParams=function(n){return _R(n)},t}(Er);function h1(e,t){var n={descriptor:t};return Object.assign({},e,n)}function p1(e,t){var n={age:t};return Object.assign({},e,n)}function m1(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var v1=function(){function e(t){var n=t===void 0?{}:t,r=n.minFaceSize,o=n.scaleFactor,a=n.maxNumScales,i=n.scoreThresholds,s=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=a||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function SR(e,t){function n(u,l){var c=Kt(e(9*u),[3,3,u,1]),d=ut(e(u)),f=ut(e(u)),h=ut(e(u)),v=ut(e(u));return t.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:v}}function r(u,l,c,d,f){var h=Kt(e(u*l*c*c),[c,c,u,l]),v=ut(e(l));return t.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:v}}function o(u,l,c,d){var f=r(u,l,c,d,!0),h=f.filters,v=f.bias;return{filters:h,batch_norm_offset:v}}function a(u,l,c){var d=n(u,c+"/depthwise_conv"),f=o(u,l,1,c+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:f}}function i(){var u=o(3,32,3,"mobilenetv1/conv_0"),l=a(32,64,"mobilenetv1/conv_1"),c=a(64,128,"mobilenetv1/conv_2"),d=a(128,128,"mobilenetv1/conv_3"),f=a(128,256,"mobilenetv1/conv_4"),h=a(256,256,"mobilenetv1/conv_5"),v=a(256,512,"mobilenetv1/conv_6"),y=a(512,512,"mobilenetv1/conv_7"),x=a(512,512,"mobilenetv1/conv_8"),m=a(512,512,"mobilenetv1/conv_9"),g=a(512,512,"mobilenetv1/conv_10"),b=a(512,512,"mobilenetv1/conv_11"),w=a(512,1024,"mobilenetv1/conv_12"),C=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:f,conv_5:h,conv_6:v,conv_7:y,conv_8:x,conv_9:m,conv_10:g,conv_11:b,conv_12:w,conv_13:C}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),l=o(256,512,3,"prediction_layer/conv_1"),c=o(512,128,1,"prediction_layer/conv_2"),d=o(128,256,3,"prediction_layer/conv_3"),f=o(256,128,1,"prediction_layer/conv_4"),h=o(128,256,3,"prediction_layer/conv_5"),v=o(256,64,1,"prediction_layer/conv_6"),y=o(64,128,3,"prediction_layer/conv_7"),x=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),m=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),g=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),b=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),w=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),C=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),E=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),k=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),R=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),N=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),P=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),T={box_encoding_predictor:x,class_predictor:m},D={box_encoding_predictor:g,class_predictor:b},B={box_encoding_predictor:w,class_predictor:C},W={box_encoding_predictor:_,class_predictor:E},U={box_encoding_predictor:k,class_predictor:R},$={box_encoding_predictor:N,class_predictor:P};return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:f,conv_5:h,conv_6:v,conv_7:y,box_predictor_0:T,box_predictor_1:D,box_predictor_2:B,box_predictor_3:W,box_predictor_4:U,box_predictor_5:$}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:s}}function RR(e){var t=[],n=Sr(e),r=n.extractWeights,o=n.getRemainingWeights,a=SR(r,t),i=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=i(),l=s(),c=uh(r(5118*4),[1,5118,4]),d={extra_dim:c};if(t.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:d},paramMappings:t}}function IR(e,t){var n=vo(e,t);function r(l,c,d){var f=n(l+"/Conv2d_"+c+"_pointwise/weights",4,d+"/filters"),h=n(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:f,batch_norm_offset:h}}function o(l){var c="mobilenetv1/conv_"+l,d="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",h=c+"/pointwise_conv",v=n(d+"/depthwise_weights",4,f+"/filters"),y=n(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),x=n(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),m=n(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),g=n(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:v,batch_norm_scale:y,batch_norm_offset:x,batch_norm_mean:m,batch_norm_variance:g},pointwise_conv:r("MobilenetV1",l,h)}}function a(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function i(l,c){var d=n(l+"/weights",4,c+"/filters"),f=n(l+"/biases",1,c+"/bias");return{filters:d,bias:f}}function s(l){var c=i("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),d=i("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:d}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:u}}function DR(e){var t=[],n=IR(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Dl(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:a}};return Nr(e,t),{params:i,paramMappings:t}}function qn(e,t,n){return ee(function(){var r=Sn(e,t.filters,n,"same");return r=we(r,t.batch_norm_offset),xh(r,0,6)})}var TR=.0010000000474974513;function AR(e,t,n){return ee(function(){var r=El(e,t.filters,n,"same");return r=cx(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,TR),xh(r,0,6)})}function PR(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}function FR(e,t){return ee(function(){var n=null,r=qn(e,t.conv_0,[2,2]),o=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(o.forEach(function(a,i){var s=i+1,u=PR(s);r=AR(r,a.depthwise_conv,u),r=qn(r,a.pointwise_conv,[1,1]),s===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function jR(e,t,n,r,o){var a=e.shape[0],i=Math.min(n,a),s=t.map(function(c,d){return{score:c,boxIndex:d}}).filter(function(c){return c.score>o}).sort(function(c,d){return d.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=i)){for(var d=c.score,f=l.length-1;f>=0;--f){var h=MR(e,c.boxIndex,l[f]);if(h!==0&&(c.score*=u(h),c.score<=o))break}d===c.score&&l.push(c.boxIndex)}}),l}function MR(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),d=Math.max(r[n][1],r[n][3]),f=(i-o)*(s-a),h=(c-u)*(d-l);if(f<=0||h<=0)return 0;var v=Math.max(o,u),y=Math.max(a,l),x=Math.min(i,c),m=Math.min(s,d),g=Math.max(x-v,0)*Math.max(m-y,0);return g/(f+h-g)}function OR(e){var t=mt(ao(e,[1,0])),n=[gt(t[2],t[0]),gt(t[3],t[1])],r=[we(t[0],Pn(n[0],J(2))),we(t[1],Pn(n[1],J(2)))];return{sizes:n,centers:r}}function LR(e,t){var n=OR(e),r=n.sizes,o=n.centers,a=mt(ao(t,[1,0])),i=Pn(Bt(Xd(Pn(a[2],J(5))),r[0]),J(2)),s=we(Bt(Pn(a[0],J(10)),r[0]),o[0]),u=Pn(Bt(Xd(Pn(a[3],J(5))),r[1]),J(2)),l=we(Bt(Pn(a[1],J(10)),r[1]),o[1]);return ao(hn([gt(s,i),gt(l,u),we(s,i),we(l,u)]),[1,0])}function BR(e,t,n){return ee(function(){var r=e.shape[0],o=LR(jn(Ca(n.extra_dim,[r,1,1]),[-1,4]),jn(e,[-1,4]));o=jn(o,[r,o.shape[0]/r,4]);var a=ix(or(t,[0,0,1],[-1,-1,-1])),i=or(a,[0,0,0],[-1,-1,1]);i=jn(i,[r,i.shape[1]]);var s=mt(o),u=mt(i);return{boxes:s,scores:u}})}function Qo(e,t){return ee(function(){var n=e.shape[0],r=jn(Ln(e,t.box_encoding_predictor),[n,-1,1,4]),o=jn(Ln(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function WR(e,t,n){return ee(function(){var r=qn(e,n.conv_0,[1,1]),o=qn(r,n.conv_1,[2,2]),a=qn(o,n.conv_2,[1,1]),i=qn(a,n.conv_3,[2,2]),s=qn(i,n.conv_4,[1,1]),u=qn(s,n.conv_5,[2,2]),l=qn(u,n.conv_6,[1,1]),c=qn(l,n.conv_7,[2,2]),d=Qo(t,n.box_predictor_0),f=Qo(e,n.box_predictor_1),h=Qo(o,n.box_predictor_2),v=Qo(i,n.box_predictor_3),y=Qo(u,n.box_predictor_4),x=Qo(c,n.box_predictor_5),m=pt([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,v.boxPredictionEncoding,y.boxPredictionEncoding,x.boxPredictionEncoding],1),g=pt([d.classPrediction,f.classPrediction,h.classPrediction,v.classPrediction,y.classPrediction,x.classPrediction],1);return{boxPredictions:m,classPredictions:g}})}var Ka=function(){function e(t){var n=t===void 0?{}:t,r=n.minConfidence,o=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),g1=function(e){me(t,e);function t(){return e.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ee(function(){var o=n.toBatchTensor(512,!1).toFloat(),a=gt(Bt(o,J(.007843137718737125)),J(1)),i=FR(a,r.mobilenetv1),s=WR(i.out,i.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return BR(u,l,r.output_layer)})},t.prototype.forward=function(n){return le(this,void 0,void 0,function(){var r;return ce(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),le(this,void 0,void 0,function(){var o,a,i,s,u,l,c,d,f,h,v,y,x,m,g,b,w,C,_,E,k;return ce(this,function(R){switch(R.label){case 0:return o=new Ka(r),a=o.maxResults,i=o.minConfidence,[4,_t(n)];case 1:for(s=R.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,d=l[0],f=c[0],h=1;h<l.length;h++)l[h].dispose(),c[h].dispose();return x=(y=Array).from,[4,f.data()];case 2:return v=x.apply(y,[R.sent()]),m=.5,g=jR(d,v,a,m,i),b=s.getReshapedInputDimensions(0),w=s.inputSize,C=w/b.width,_=w/b.height,E=d.arraySync(),k=g.map(function(N){var P=[Math.max(0,E[N][0]),Math.min(1,E[N][2])].map(function($){return $*_}),T=P[0],D=P[1],B=[Math.max(0,E[N][1]),Math.min(1,E[N][3])].map(function($){return $*C}),W=B[0],U=B[1];return new ur(v[N],new Mh(W,T,U-W,D-T),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,k]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(n){return DR(n)},t.prototype.extractParams=function(n){return RR(n)},t}(Er);(function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(g1);var zR=.4,UR=[new Pe(.738768,.874946),new Pe(2.42204,2.65704),new Pe(4.30971,7.04493),new Pe(10.246,4.59428),new Pe(12.6868,11.8741)],$R=[new Pe(1.603231,2.094468),new Pe(6.041143,7.080126),new Pe(2.882459,3.518061),new Pe(4.266906,5.178857),new Pe(9.041765,10.66308)],VR=[117.001,114.697,97.404],HR="tiny_yolov2_model",GR="tiny_yolov2_separable_conv_model",$s=function(e){return typeof e=="number"};function qR(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!$s(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(t){return t||{}}).every(function(t){return $s(t.x)&&$s(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every($s)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function qh(e){return ee(function(){var t=Bt(e,J(.10000000149011612));return we(Ke(gt(e,t)),t)})}function Tr(e,t){return ee(function(){var n=Uo(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Sn(n,t.conv.filters,[1,1],"valid"),n=gt(n,t.bn.sub),n=Bt(n,t.bn.truediv),n=we(n,t.conv.bias),qh(n)})}function Ar(e,t){return ee(function(){var n=Uo(e,[[0,0],[1,1],[1,1],[0,0]]);return n=_h(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=we(n,t.bias),qh(n)})}function KR(e,t){var n=Pl(e,t);function r(i,s){var u=ut(e(i)),l=ut(e(i));return t.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function o(i,s,u){var l=n(i,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var a=$h(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function XR(e,t,n,r){var o=Sr(e),a=o.extractWeights,i=o.getRemainingWeights,s=[],u=KR(a,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams,f;if(t.withSeparableConvs){var h=r[0],v=r[1],y=r[2],x=r[3],m=r[4],g=r[5],b=r[6],w=r[7],C=r[8],_=t.isFirstLayerConv2d?l(h,v,3,"conv0"):d(h,v,"conv0"),E=d(v,y,"conv1"),k=d(y,x,"conv2"),R=d(x,m,"conv3"),N=d(m,g,"conv4"),P=d(g,b,"conv5"),T=w?d(b,w,"conv6"):void 0,D=C?d(w,C,"conv7"):void 0,B=l(C||w||b,5*n,1,"conv8");f={conv0:_,conv1:E,conv2:k,conv3:R,conv4:N,conv5:P,conv6:T,conv7:D,conv8:B}}else{var h=r[0],v=r[1],y=r[2],x=r[3],m=r[4],g=r[5],b=r[6],w=r[7],C=r[8],_=c(h,v,"conv0"),E=c(v,y,"conv1"),k=c(y,x,"conv2"),R=c(x,m,"conv3"),N=c(m,g,"conv4"),P=c(g,b,"conv5"),T=c(b,w,"conv6"),D=c(w,C,"conv7"),B=l(C,5*n,1,"conv8");f={conv0:_,conv1:E,conv2:k,conv3:R,conv4:N,conv5:P,conv6:T,conv7:D,conv8:B}}if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:f,paramMappings:s}}function YR(e,t){var n=vo(e,t);function r(s){var u=n(s+"/sub",1),l=n(s+"/truediv",1);return{sub:u,truediv:l}}function o(s){var u=n(s+"/filters",4),l=n(s+"/bias",1);return{filters:u,bias:l}}function a(s){var u=o(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var i=Vh(n);return{extractConvParams:o,extractConvWithBatchNormParams:a,extractSeparableConvParams:i}}function QR(e,t){var n=[],r=YR(e,n),o=r.extractConvParams,a=r.extractConvWithBatchNormParams,i=r.extractSeparableConvParams,s;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;s={conv0:t.isFirstLayerConv2d?o("conv0"):i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:u>7?i("conv6"):void 0,conv7:u>8?i("conv7"):void 0,conv8:o("conv8")}}else s={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:o("conv8")};return Nr(e,n),{params:s,paramMappings:n}}var Pv;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(Pv||(Pv={}));var Kh=function(){function e(t){var n=t===void 0?{}:t,r=n.inputSize,o=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),y1=function(e){me(t,e);function t(n){var r=e.call(this,"TinyYolov2")||this;return qR(n),r._config=n,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(n,r){var o=Tr(n,r.conv0);return o=xt(o,[2,2],[2,2],"same"),o=Tr(o,r.conv1),o=xt(o,[2,2],[2,2],"same"),o=Tr(o,r.conv2),o=xt(o,[2,2],[2,2],"same"),o=Tr(o,r.conv3),o=xt(o,[2,2],[2,2],"same"),o=Tr(o,r.conv4),o=xt(o,[2,2],[2,2],"same"),o=Tr(o,r.conv5),o=xt(o,[2,2],[1,1],"same"),o=Tr(o,r.conv6),o=Tr(o,r.conv7),Ln(o,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(n,r){var o=this.config.isFirstLayerConv2d?qh(Ln(n,r.conv0,"valid",!1)):Ar(n,r.conv0);return o=xt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv1),o=xt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv2),o=xt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv3),o=xt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv4),o=xt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv5),o=xt(o,[2,2],[1,1],"same"),o=r.conv6?Ar(o,r.conv6):o,o=r.conv7?Ar(o,r.conv7):o,Ln(o,r.conv8,"valid",!1)},t.prototype.forwardInput=function(n,r){var o=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return ee(function(){var i=n.toBatchTensor(r,!1).toFloat();return i=o.config.meanRgb?ds(i,o.config.meanRgb):i,i=i.div(J(256)),o.config.withSeparableConvs?o.runMobilenet(i,a):o.runTinyYolov2(i,a)})},t.prototype.forward=function(n,r){return le(this,void 0,void 0,function(){var o;return ce(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,_t(n)];case 1:return[4,o.apply(this,[a.sent(),r])];case 2:return[2,a.sent()]}})})},t.prototype.detect=function(n,r){return r===void 0&&(r={}),le(this,void 0,void 0,function(){var o,a,i,s,u,l,c,d,f,h,v,y,x,m,g=this;return ce(this,function(b){switch(b.label){case 0:return o=new Kh(r),a=o.inputSize,i=o.scoreThreshold,[4,_t(n)];case 1:return s=b.sent(),[4,this.forwardInput(s,a)];case 2:return u=b.sent(),l=ee(function(){return mt(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),i)];case 3:return d=b.sent(),u.dispose(),l.dispose(),f=d.map(function(w){return w.box}),h=d.map(function(w){return w.score}),v=d.map(function(w){return w.classScore}),y=d.map(function(w){return g.config.classes[w.label]}),x=Qi(f.map(function(w){return w.rescale(a)}),h,this.config.iouThreshold,!0),m=x.map(function(w){return new Vx(h[w],v[w],y[w],f[w],c)}),[2,m]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(n){return QR(n,this.config)},t.prototype.extractParams=function(n){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return XR(n,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(n,r,o){return le(this,void 0,void 0,function(){var a,i,s,u,l,c,d,f,h,v,y,x,m,g,b,w,C,_,E,k,R,N,P,T,D,B,W,U,$,F=this;return ce(this,function(O){switch(O.label){case 0:return a=r.width,i=r.height,s=Math.max(a,i),u=s/a,l=s/i,c=n.shape[1],d=this.config.anchors.length,f=ee(function(){var L=n.reshape([c,c,d,F.boxEncodingSize]),G=L.slice([0,0,0,0],[c,c,d,4]),Y=L.slice([0,0,0,4],[c,c,d,1]),Z=F.withClassScores?_r(L.slice([0,0,0,5],[c,c,d,F.config.classes.length]),3):J(0);return[G,Y,Z]}),h=f[0],v=f[1],y=f[2],x=[],[4,v.array()];case 1:return m=O.sent(),[4,h.array()];case 2:g=O.sent(),b=0,O.label=3;case 3:if(!(b<c))return[3,12];w=0,O.label=4;case 4:if(!(w<c))return[3,11];C=0,O.label=5;case 5:return C<d?(_=Pc(m[b][w][C][0]),!o||_>o?(E=(w+Pc(g[b][w][C][0]))/c*u,k=(b+Pc(g[b][w][C][1]))/c*l,R=Math.exp(g[b][w][C][2])*this.config.anchors[C].x/c*u,N=Math.exp(g[b][w][C][3])*this.config.anchors[C].y/c*l,P=E-R/2,T=k-N/2,D={row:b,col:w,anchor:C},this.withClassScores?[4,this.extractPredictedClass(y,D)]:[3,7]):[3,9]):[3,10];case 6:return $=O.sent(),[3,8];case 7:$={classScore:1,label:0},O.label=8;case 8:B=$,W=B.classScore,U=B.label,x.push(Mt({box:new Tl(P,T,P+R,T+N),score:_,classScore:_*W,label:U},D)),O.label=9;case 9:return C++,[3,5];case 10:return w++,[3,4];case 11:return b++,[3,3];case 12:return h.dispose(),v.dispose(),y.dispose(),[2,x]}})})},t.prototype.extractPredictedClass=function(n,r){return le(this,void 0,void 0,function(){var o,a,i,s;return ce(this,function(u){switch(u.label){case 0:return o=r.row,a=r.col,i=r.anchor,[4,n.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[o][a][i][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Er),JR=function(e){me(t,e);function t(n){n===void 0&&(n=!0);var r=this,o=Object.assign({},{withSeparableConvs:n,iouThreshold:zR,classes:["face"]},n?{anchors:$R,meanRgb:VR}:{anchors:UR,withClassScores:!0});return r=e.call(this,o)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return le(this,void 0,void 0,function(){var o;return ce(this,function(a){switch(a.label){case 0:return[4,this.detect(n,r)];case 1:return o=a.sent(),[2,o.map(function(i){return new ur(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?GR:HR},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(y1),Xh=function(e){me(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return t}(Kh),fs=function(){function e(){}return e.prototype.then=function(t){return le(this,void 0,void 0,function(){var n;return ce(this,function(r){switch(r.label){case 0:return n=t,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},e}();function Fl(e,t,n,r,o){return o===void 0&&(o=function(a){var i=a.alignedRect;return i}),le(this,void 0,void 0,function(){var a,i,s,u,l;return ce(this,function(c){switch(c.label){case 0:return a=e.map(function(d){return iR(d)?o(d):d.detection}),s=r,s?[3,5]:t instanceof qe?[4,zh(t,a)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,Wh(t,a)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return i=s,[4,n(i)];case 6:return l=c.sent(),i.forEach(function(d){return d instanceof qe&&d.dispose()}),[2,l]}})})}function Yh(e,t,n,r,o){return le(this,void 0,void 0,function(){var a=this;return ce(this,function(i){return[2,Fl([e],t,function(s){return le(a,void 0,void 0,function(){return ce(this,function(u){return[2,n(s[0])]})})},r,o)]})})}function ZR(e){return ee(function(){return hn(mt(e,3).reverse(),3)})}var Vs=2,tl=12;function eI(e,t){var n=Pl(e,t),r=Uh(e,t);function o(l,c){var d=ut(e(l));return t.push({paramPath:c}),d}function a(l,c,d){d===void 0&&(d=!1);var f=n(l[0],l[1],3,c+"/conv1"),h=o(l[1],c+"/prelu1_alpha"),v=n(l[1],l[2],3,c+"/conv2"),y=o(l[2],c+"/prelu2_alpha"),x=n(l[2],l[3],d?2:3,c+"/conv3"),m=o(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:h,conv2:v,prelu2_alpha:y,conv3:x,prelu3_alpha:m}}function i(){var l=a([3,10,16,32],"pnet"),c=n(32,2,1,"pnet/conv4_1"),d=n(32,4,1,"pnet/conv4_2");return Mt(Mt({},l),{conv4_1:c,conv4_2:d})}function s(){var l=a([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return Mt(Mt({},l),{fc1:c,prelu4_alpha:d,fc2_1:f,fc2_2:h})}function u(){var l=a([3,32,64,64],"onet"),c=n(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),v=r(256,2,"onet/fc2_1"),y=r(256,4,"onet/fc2_2"),x=r(256,10,"onet/fc2_3");return Mt(Mt({},l),{conv4:c,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:v,fc2_2:y,fc2_3:x})}return{extractPNetParams:i,extractRNetParams:s,extractONetParams:u}}function tI(e){var t=Sr(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=eI(n,o),i=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,l=i(),c=s(),d=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:d},paramMappings:o}}function nI(e,t){var n=vo(e,t);function r(c){var d=n(c+"/weights",4,c+"/filters"),f=n(c+"/bias",1);return{filters:d,bias:f}}function o(c){var d=n(c+"/weights",2),f=n(c+"/bias",1);return{weights:d,bias:f}}function a(c){return n(c,1)}function i(c){var d=r(c+"/conv1"),f=a(c+"/prelu1_alpha"),h=r(c+"/conv2"),v=a(c+"/prelu2_alpha"),y=r(c+"/conv3"),x=a(c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:h,prelu2_alpha:v,conv3:y,prelu3_alpha:x}}function s(){var c=i("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return Mt(Mt({},c),{conv4_1:d,conv4_2:f})}function u(){var c=i("rnet"),d=o("rnet/fc1"),f=a("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),v=o("rnet/fc2_2");return Mt(Mt({},c),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:v})}function l(){var c=i("onet"),d=r("onet/conv4"),f=a("onet/prelu4_alpha"),h=o("onet/fc1"),v=a("onet/prelu5_alpha"),y=o("onet/fc2_1"),x=o("onet/fc2_2"),m=o("onet/fc2_3");return Mt(Mt({},c),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:v,fc2_1:y,fc2_2:x,fc2_3:m})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function rI(e){var t=[],n=nI(e,t),r=n.extractPNetParams,o=n.extractRNetParams,a=n.extractONetParams,i=r(),s=o(),u=a();return Nr(e,t),{params:{pnet:i,rnet:s,onet:u},paramMappings:t}}function rf(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}function oI(e,t,n){for(var r=n[0],o=n[1],a=tl/e,i=[],s=Math.min(r,o)*a,u=0;s>=12;)i.push(a*Math.pow(t,u)),s=s*t,u+=1;return i}var Qh=function(e){me(t,e);function t(n,r,o,a){return e.call(this,{left:n,top:r,right:o,bottom:a},!0)||this}return t}(io);function x1(e){return ee(function(){return Bt(gt(e,J(127.5)),J(.0078125))})}function Ra(e,t){return ee(function(){return we(Ke(e),Bt(t,Ku(Ke(Ku(e)))))})}function Jh(e,t,n){return n===void 0&&(n=!1),ee(function(){var r=Ln(e,t.conv1,"valid");return r=Ra(r,t.prelu1_alpha),r=xt(r,n?[2,2]:[3,3],[2,2],"same"),r=Ln(r,t.conv2,"valid"),r=Ra(r,t.prelu2_alpha),r=n?r:xt(r,[3,3],[2,2],"valid"),r=Ln(r,t.conv3,"valid"),r=Ra(r,t.prelu3_alpha),r})}function aI(e,t){return ee(function(){var n=Jh(e,t,!0),r=Ln(n,t.conv4_1,"valid"),o=bn(Sl(r,3),3),a=_r(gt(r,o),3),i=Ln(n,t.conv4_2,"valid");return{prob:a,regions:i}})}function iI(e,t){return ee(function(){var n=rf(t,e.shape.slice(1)),r=n.height,o=n.width,a=Rh.resizeBilinear(e,[r,o]),i=x1(a);return ao(i,[0,2,1,3])})}function sI(e,t,n,r){for(var o=[],a=e.arraySync(),i=0;i<e.shape[0];i++)for(var s=0;s<e.shape[1];s++)a[i][s]>=r&&o.push(new Pe(s,i));var u=o.map(function(l){var c=new Tl(Math.round((l.y*Vs+1)/n),Math.round((l.x*Vs+1)/n),Math.round((l.y*Vs+tl)/n),Math.round((l.x*Vs+tl)/n)),d=a[l.y][l.x],f=t.arraySync(),h=new Qh(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:d,region:h}});return u}function uI(e,t,n,r,o){o.stage1=[];var a=t.map(function(f){return ee(function(){var h={scale:f},v=iI(e,f),y=Date.now(),x=aI(v,r),m=x.prob,g=x.regions;h.pnet=Date.now()-y;var b=mt(mt(m,3)[1])[0],w=mt(g)[0];return{scoresTensor:b,regionsTensor:w,scale:f,statsForScale:h}})}),i=a.map(function(f){var h=f.scoresTensor,v=f.regionsTensor,y=f.scale,x=f.statsForScale,m=sI(h,v,y,n);if(h.dispose(),v.dispose(),!m.length)return o.stage1.push(x),[];var g=Date.now(),b=Qi(m.map(function(w){return w.cell}),m.map(function(w){return w.score}),.5);return x.nms=Date.now()-g,x.numBoxes=b.length,o.stage1.push(x),b.map(function(w){return m[w]})}),s=i.reduce(function(f,h){return f.concat(h)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),d=Qi(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-c,l=d.map(function(f){return s[f].score}),u=d.map(function(f){return s[f]}).map(function(f){var h=f.cell,v=f.region;return new Tl(h.left+v.left*h.width,h.top+v.top*h.height,h.right+v.right*h.width,h.bottom+v.bottom*h.height).toSquare().round()})}return{boxes:u,scores:l}}function b1(e,t,n){var r=n.width,o=n.height;return le(this,void 0,void 0,function(){var a,i,s,u=this;return ce(this,function(l){switch(l.label){case 0:return a=Lo(e),[4,Promise.all(t.map(function(c){return le(u,void 0,void 0,function(){var d,f,h,v,y,x,m,g;return ce(this,function(b){return d=c.padAtBorders(e.height,e.width),f=d.y,h=d.ey,v=d.x,y=d.ex,x=v-1,m=f-1,g=a.getImageData(x,m,y-x,h-m),[2,zt.isNodejs()?Bh(g):createImageBitmap(g)]})})}))];case 1:return i=l.sent(),s=[],i.forEach(function(c){var d=Al({width:r,height:o}),f=Lo(d);f.drawImage(c,0,0,r,o);for(var h=f.getImageData(0,0,r,o).data,v=[],y=0;y<h.length;y+=4)v.push(h[y+2]),v.push(h[y+1]),v.push(h[y]);s.push(v)}),[2,s.map(function(c){var d=ee(function(){var f=ao(Kt(c,[1,r,o,3]),[0,2,1,3]).toFloat();return x1(f)});return d})]}})})}function lI(e,t){return ee(function(){var n=Jh(e,t),r=jn(n,[n.shape[0],t.fc1.weights.shape[0]]),o=Jn(r,t.fc1),a=Ra(o,t.prelu4_alpha),i=Jn(a,t.fc2_1),s=bn(Sl(i,1),1),u=_r(gt(i,s),1),l=Jn(a,t.fc2_2),c=mt(u,1)[1];return{scores:c,regions:l}})}function cI(e,t,n,r,o){return le(this,void 0,void 0,function(){var a,i,s,u,l,c,d,f,h,v,y,x,m,g;return ce(this,function(b){switch(b.label){case 0:return a=Date.now(),[4,b1(e,t,{width:24,height:24})];case 1:return i=b.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(w){var C=lI(w,r);return w.dispose(),C}),o.stage2_rnet=Date.now()-a,u=s.length>1?pt(s.map(function(w){return w.scores})):s[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[b.sent()]),u.dispose(),f=l.map(function(w,C){return{score:w,idx:C}}).filter(function(w){return w.score>n}).map(function(w){var C=w.idx;return C}),h=f.map(function(w){return t[w]}),v=f.map(function(w){return l[w]}),y=[],x=[],h.length>0&&(a=Date.now(),m=Qi(h,v,.7),o.stage2_nms=Date.now()-a,g=m.map(function(w){var C=s[f[w]].regions.arraySync();return new Qh(C[0][0],C[0][1],C[0][2],C[0][3])}),x=m.map(function(w){return v[w]}),y=m.map(function(w,C){return h[w].calibrate(g[C])})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose()}),[2,{boxes:y,scores:x}]}})})}function dI(e,t){return ee(function(){var n=Jh(e,t);n=xt(n,[2,2],[2,2],"same"),n=Ln(n,t.conv4,"valid"),n=Ra(n,t.prelu4_alpha);var r=jn(n,[n.shape[0],t.fc1.weights.shape[0]]),o=Jn(r,t.fc1),a=Ra(o,t.prelu5_alpha),i=Jn(a,t.fc2_1),s=bn(Sl(i,1),1),u=_r(gt(i,s),1),l=Jn(a,t.fc2_2),c=Jn(a,t.fc2_3),d=mt(u,1)[1];return{scores:d,regions:l,points:c}})}function fI(e,t,n,r,o){return le(this,void 0,void 0,function(){var a,i,s,u,l,c,d,f,h,v,y,x,m,g,b;return ce(this,function(w){switch(w.label){case 0:return a=Date.now(),[4,b1(e,t,{width:48,height:48})];case 1:return i=w.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(C){var _=dI(C,r);return C.dispose(),_}),o.stage3_onet=Date.now()-a,u=s.length>1?pt(s.map(function(C){return C.scores})):s[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[w.sent()]),u.dispose(),f=l.map(function(C,_){return{score:C,idx:_}}).filter(function(C){return C.score>n}).map(function(C){var _=C.idx;return _}),h=f.map(function(C){var _=s[C].regions.arraySync();return new Qh(_[0][0],_[0][1],_[0][2],_[0][3])}),v=f.map(function(C,_){return t[C].calibrate(h[_])}),y=f.map(function(C){return l[C]}),x=[],m=[],g=[],v.length>0&&(a=Date.now(),b=Qi(v,y,.7,!1),o.stage3_nms=Date.now()-a,x=b.map(function(C){return v[C]}),m=b.map(function(C){return y[C]}),g=b.map(function(C,_){return Array(5).fill(0).map(function(E,k){var R=s[C].points.arraySync();return new Pe(R[0][k]*(x[_].width+1)+x[_].left,R[0][k+5]*(x[_].height+1)+x[_].top)})})),s.forEach(function(C){C.regions.dispose(),C.scores.dispose(),C.points.dispose()}),[2,{boxes:x,scores:m,points:g}]}})})}var hI=function(e){me(t,e);function t(){return e.call(this,"Mtcnn")||this}return t.prototype.load=function(n){return le(this,void 0,void 0,function(){return ce(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,n)]})})},t.prototype.loadFromDisk=function(n){return le(this,void 0,void 0,function(){return ce(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,n)]})})},t.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),le(this,void 0,void 0,function(){var o,a,i,s,u,l,c,d,f,h,v,y,x,m,g,b,w,C,_,E,k;return ce(this,function(R){switch(R.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(a=n.canvases[0],!a)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},s=Date.now(),u=ee(function(){return ZR(bn(Fh.fromPixels(a)).toFloat())}),l=function(N){return u.dispose(),i.total=Date.now()-s,N},c=u.shape.slice(1),d=c[0],f=c[1],h=new v1(r),v=h.minFaceSize,y=h.scaleFactor,x=h.maxNumScales,m=h.scoreThresholds,g=h.scaleSteps,b=(g||oI(v,y,[d,f])).filter(function(N){var P=rf(N,[d,f]);return Math.min(P.width,P.height)>tl}).slice(0,x),i.scales=b,i.pyramid=b.map(function(N){return rf(N,[d,f])}),w=Date.now(),[4,uI(u,b,m[0],o.pnet,i)];case 1:return C=R.sent(),i.total_stage1=Date.now()-w,C.boxes.length?(i.stage2_numInputBoxes=C.boxes.length,w=Date.now(),[4,cI(a,C.boxes,m[1],o.rnet,i)]):[2,l({results:[],stats:i})];case 2:return _=R.sent(),i.total_stage2=Date.now()-w,_.boxes.length?(i.stage3_numInputBoxes=_.boxes.length,w=Date.now(),[4,fI(a,_.boxes,m[2],o.onet,i)]):[2,l({results:[],stats:i})];case 3:return E=R.sent(),i.total_stage3=Date.now()-w,k=E.boxes.map(function(N,P){return Hh(Oh({},new ur(E.scores[P],new Mh(N.left/f,N.top/d,N.width/f,N.height/d),{height:d,width:f})),new $3(E.points[P].map(function(T){return T.sub(new Pe(N.left,N.top)).div(new Pe(N.width,N.height))}),{width:N.width,height:N.height}))}),[2,l({results:k,stats:i})]}})})},t.prototype.forward=function(n,r){return r===void 0&&(r={}),le(this,void 0,void 0,function(){var o;return ce(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,_t(n)];case 1:return[4,o.apply(this,[a.sent(),r])];case 2:return[2,a.sent().results]}})})},t.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),le(this,void 0,void 0,function(){var o;return ce(this,function(a){switch(a.label){case 0:return o=this.forwardInput,[4,_t(n)];case 1:return[2,o.apply(this,[a.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(n){return rI(n)},t.prototype.extractParams=function(n){return tI(n)},t}(Er),pI=.4,mI=[new Pe(1.603231,2.094468),new Pe(6.041143,7.080126),new Pe(2.882459,3.518061),new Pe(4.266906,5.178857),new Pe(9.041765,10.66308)],vI=[117.001,114.697,97.404],gI=function(e){me(t,e);function t(){var n=this,r={withSeparableConvs:!0,iouThreshold:pI,classes:["face"],anchors:mI,meanRgb:vI,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=e.call(this,r)||this,n}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return le(this,void 0,void 0,function(){var o;return ce(this,function(a){switch(a.label){case 0:return[4,this.detect(n,r)];case 1:return o=a.sent(),[2,o.map(function(i){return new ur(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(y1),ot={ssdMobilenetv1:new g1,tinyFaceDetector:new gI,tinyYolov2:new JR,mtcnn:new hI,faceLandmark68Net:new c1,faceLandmark68TinyNet:new xR,faceRecognitionNet:new NR,faceExpressionNet:new aR,ageGenderNet:new mR},w1=function(e){me(t,e);function t(n,r,o){var a=e.call(this)||this;return a.parentTask=n,a.input=r,a.extractedFaces=o,a}return t}(fs),Zh=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r,o=this;return ce(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),[4,Fl(n,this.input,function(i){return le(o,void 0,void 0,function(){return ce(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(u){return ot.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,n.map(function(i,s){return s1(i,r[s])})]}})})},t.prototype.withAgeAndGender=function(){return new rp(this,this.input)},t}(w1),ep=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r;return ce(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),n?[4,Yh(n,this.input,function(a){return ot.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,s1(n,r)]}})})},t.prototype.withAgeAndGender=function(){return new op(this,this.input)},t}(w1),tp=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new ap(this,this.input)},t.prototype.withFaceDescriptors=function(){return new sp(this,this.input)},t}(Zh),np=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new ip(this,this.input)},t.prototype.withFaceDescriptor=function(){return new up(this,this.input)},t}(ep),C1=function(e){me(t,e);function t(n,r,o){var a=e.call(this)||this;return a.parentTask=n,a.input=r,a.extractedFaces=o,a}return t}(fs),rp=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r,o=this;return ce(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),[4,Fl(n,this.input,function(i){return le(o,void 0,void 0,function(){return ce(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(u){return ot.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=a.sent(),[2,n.map(function(i,s){var u=r[s],l=u.age,c=u.gender,d=u.genderProbability;return p1(m1(i,c,d),l)})]}})})},t.prototype.withFaceExpressions=function(){return new Zh(this,this.input)},t}(C1),op=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r,o,a,i;return ce(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?[4,Yh(n,this.input,function(u){return ot.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,a=r.gender,i=r.genderProbability,[2,p1(m1(n,a,i),o)]}})})},t.prototype.withFaceExpressions=function(){return new ep(this,this.input)},t}(C1),ap=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new tp(this,this.input)},t.prototype.withFaceDescriptors=function(){return new sp(this,this.input)},t}(rp),ip=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new np(this,this.input)},t.prototype.withFaceDescriptor=function(){return new up(this,this.input)},t}(op),_1=function(e){me(t,e);function t(n,r){var o=e.call(this)||this;return o.parentTask=n,o.input=r,o}return t}(fs),sp=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r;return ce(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,Fl(n,this.input,function(a){return Promise.all(a.map(function(i){return ot.faceRecognitionNet.computeFaceDescriptor(i)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(a,i){return h1(n[i],a)})]}})})},t.prototype.withFaceExpressions=function(){return new tp(this,this.input)},t.prototype.withAgeAndGender=function(){return new ap(this,this.input)},t}(_1),up=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r;return ce(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),n?[4,Yh(n,this.input,function(a){return ot.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,h1(n,r)]}})})},t.prototype.withFaceExpressions=function(){return new np(this,this.input)},t.prototype.withAgeAndGender=function(){return new ip(this,this.input)},t}(_1),k1=function(e){me(t,e);function t(n,r,o){var a=e.call(this)||this;return a.parentTask=n,a.input=r,a.useTinyLandmarkNet=o,a}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ot.faceLandmark68TinyNet:ot.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(fs),yI=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r,o,a,i,s=this;return ce(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return n=u.sent(),r=n.map(function(l){return l.detection}),this.input instanceof qe?[4,zh(this.input,r)]:[3,3];case 2:return a=u.sent(),[3,5];case 3:return[4,Wh(this.input,r)];case 4:a=u.sent(),u.label=5;case 5:return o=a,[4,Promise.all(o.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return i=u.sent(),o.forEach(function(l){return l instanceof qe&&l.dispose()}),[2,n.map(function(l,c){return Hh(l,i[c])})]}})})},t.prototype.withFaceExpressions=function(){return new tp(this,this.input)},t.prototype.withAgeAndGender=function(){return new ap(this,this.input)},t.prototype.withFaceDescriptors=function(){return new sp(this,this.input)},t}(k1),xI=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r,o,a,i;return ce(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?(r=n.detection,this.input instanceof qe?[4,zh(this.input,[r])]:[3,3]):[2];case 2:return a=s.sent(),[3,5];case 3:return[4,Wh(this.input,[r])];case 4:a=s.sent(),s.label=5;case 5:return o=a,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return i=s.sent(),o.forEach(function(u){return u instanceof qe&&u.dispose()}),[2,Hh(n,i)]}})})},t.prototype.withFaceExpressions=function(){return new np(this,this.input)},t.prototype.withAgeAndGender=function(){return new ip(this,this.input)},t.prototype.withFaceDescriptor=function(){return new up(this,this.input)},t}(k1),E1=function(e){me(t,e);function t(n,r){r===void 0&&(r=new Ka);var o=e.call(this)||this;return o.input=n,o.options=r,o}return t}(fs),bI=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r,o,a;return ce(this,function(i){switch(i.label){case 0:return n=this,r=n.input,o=n.options,o instanceof v1?[4,ot.mtcnn.forward(r,o)]:[3,2];case 1:return[2,i.sent().map(function(s){return s.detection})];case 2:if(a=o instanceof Xh?function(s){return ot.tinyFaceDetector.locateFaces(s,o)}:o instanceof Ka?function(s){return ot.ssdMobilenetv1.locateFaces(s,o)}:o instanceof Kh?function(s){return ot.tinyYolov2.locateFaces(s,o)}:null,!a)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return le(n,void 0,void 0,function(){var o;return ce(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return o=a.sent(),[2,r(o.map(function(i){return Oh({},i)}))]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new yI(this.runAndExtendWithFaceDetections(),this.input,n)},t.prototype.withFaceExpressions=function(){return new Zh(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new rp(this.runAndExtendWithFaceDetections(),this.input)},t}(E1),wI=function(e){me(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return le(this,void 0,void 0,function(){var n,r;return ce(this,function(o){switch(o.label){case 0:return[4,new bI(this.input,this.options)];case 1:return n=o.sent(),r=n[0],n.forEach(function(a){a.score>r.score&&(r=a)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return le(n,void 0,void 0,function(){var o;return ce(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return o=a.sent(),[2,r(o?Oh({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new xI(this.runAndExtendWithFaceDetection(),this.input,n)},t.prototype.withFaceExpressions=function(){return new ep(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new op(this.runAndExtendWithFaceDetection(),this.input)},t}(E1);function nl(e,t){return t===void 0&&(t=new Ka),new wI(e,t)}function CI(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(o,a){return o-r[a]}).reduce(function(o,a){return o+Math.pow(a,2)},0))}(function(){function e(t,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,a=function(){return"person "+o++};this._labeledDescriptors=r.map(function(i){if(i instanceof Ws)return i;if(i instanceof Float32Array)return new Ws(a(),[i]);if(i.descriptor&&i.descriptor instanceof Float32Array)return new Ws(a(),[i.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(t,n){return n.map(function(r){return CI(r,t)}).reduce(function(r,o){return r+o},0)/(n.length||1)},e.prototype.matchDescriptor=function(t){var n=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,a=r.label;return new Rv(a,n.computeMeanDistance(t,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},e.prototype.findBestMatch=function(t){var n=this.matchDescriptor(t);return n.distance<this.distanceThreshold?n:new Rv("unknown",n.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(r){return Ws.fromJSON(r)});return new e(n,t.distanceThreshold)},e})();const _I=()=>p.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[p.jsx("div",{className:"w-6 h-6 border-4 border-white border-t-transparent rounded-full animate-spin"}),p.jsx("span",{className:"text-white text-lg font-medium",children:"Loading..."})]}),ou=[],kt=e=>{const t=document.createElement("div");t.innerText=`[${new Date().toLocaleTimeString()}] ${e}`,ou.unshift(t),ou.length>10&&ou.pop(),kI()},kI=()=>{const e=document.getElementById("attendance-notifications");e&&(e.innerHTML="",ou.forEach(t=>e.appendChild(t)))},Fv=({registerCleanup:e})=>{Ha();const[t,n]=M.useState(!1),[r,o]=M.useState("ready"),[a,i]=M.useState(null),[s,u]=M.useState(null),[l,c]=M.useState(!1),[d,f]=M.useState(15),[h,v]=M.useState([]),[y,x]=M.useState(null),m=M.useRef(null),g=M.useRef(null),b=M.useRef(null);M.useEffect(()=>(localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("isAuthenticated"),(async()=>{try{await ot.tinyFaceDetector.loadFromUri("/models"),await ot.ssdMobilenetv1.loadFromUri("/models"),await ot.faceLandmark68Net.loadFromUri("/models"),await ot.faceRecognitionNet.loadFromUri("/models"),await ot.faceExpressionNet.loadFromUri("/models"),c(!0);try{const k=await navigator.mediaDevices.getUserMedia({video:!0});b.current=k}catch(k){console.error("Failed to pre-acquire camera stream:",k)}}catch(k){console.error("Failed to load face-api models:",k),kt("Failed to load face recognition models")}})(),e&&e(()=>{b.current&&(b.current.getTracks().forEach(k=>k.stop()),b.current=null)}),()=>{b.current&&(b.current.getTracks().forEach(k=>k.stop()),b.current=null)}),[]);const w=async()=>{if(b.current&&m.current)m.current.srcObject=b.current;else try{const E=await navigator.mediaDevices.getUserMedia({video:!0});m.current.srcObject=E,b.current=E}catch(E){console.error("Camera error:",E),o("Camera access denied")}},C=()=>{m.current&&(m.current.srcObject=null,m.current.pause(),m.current.load())},_=async()=>{if(!l){o("Models not loaded yet"),kt("Models not loaded yet");return}n(!0),o("analyzing"),i(null),f(15),kt("Starting face scan..."),await w();let E=!1,k=!1,R=!1,N=!1,P=null,T=null,D=null;D=setInterval(()=>{f(W=>{const U=Math.max(0,W-1);return U===0&&(clearInterval(D),k||(k=!0,clearInterval(T),n(!1),o("Face not recognized"),C(),setTimeout(()=>{o("ready")},2e3))),U})},1e3);const B=async()=>{if(!(E||k))try{kt("Detecting face...");let W=await nl(m.current,new Xh({inputSize:512,scoreThreshold:.1})).withFaceLandmarks().withFaceDescriptor().withFaceExpressions();if(W||(kt("TinyFace detection failed, trying SSD Mobilenet..."),W=await nl(m.current,new Ka({minConfidence:.3})).withFaceLandmarks().withFaceDescriptor().withFaceExpressions()),W){kt("Face detected, extracting features...");const U=Array.from(W.descriptor),$=W.expressions,F=Object.keys($).reduce((L,G)=>$[L]>$[G]?L:G);kt("Recognizing face...");const O=await Ae.recognizeFace(U,.6);if(O.match&&!R&&!N){E=!0,k=!0,R=!0,N=!0,clearInterval(D),clearInterval(T),clearTimeout(P),n(!1),f(0),C(),i({...O,mood:F}),o(O.approximate_match?"Face approximately recognized":"Face recognized"),kt(`${O.approximate_match?"Approximate match for":"Recognized"} ${O.employee_name} (ID: ${O.employee_id}) - Mood: ${F}`);try{const L=await Ae.markAttendance(O.employee_id);console.log("markAttendance response:",L);const G=new Date;u(G),kt("Attendance marked successfully!"),i(ne=>{var ae,pe;return{...ne,department:(pe=(ae=L==null?void 0:L.attendance)==null?void 0:ae.employee)==null?void 0:pe.department}}),o("Attendance marked successfully!");let Y="Check-In";L.message&&L.message.includes("Break start")?Y="Break Start":L.message&&L.message.includes("Break end")?Y="Break End":L.message&&L.message.includes("Check-out")?Y="Check-Out":L.message&&L.message.includes("Check-in")&&(Y="Check-In"),x(Y);const Z=G.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),de={name:O.employee_name,action:Y,time:Z,employee_id:O.employee_id,mood:F};v(ne=>[de,...ne.slice(0,9)]),setTimeout(()=>{o("ready"),i(null),u(null)},2e3)}catch(L){console.log("Attendance marking error response:",L.response);const G=L.response;if(G&&G.status===403&&G.data&&typeof G.data.message=="string"){const Y=G.data.message.toLowerCase();if(Y.includes("inactive employee")||Y.includes("inactive employees")||Y.includes("inactive")&&Y.includes("not allowed"))u(new Date),o("Inactive employees cannot mark attendance"),kt("Inactive employees cannot mark attendance"),setTimeout(()=>{o("ready"),i(null),u(null)},2e3);else if(L.message&&L.message.includes("already marked")){const Z=new Date;u(Z),o("Attendance marked successfully!"),kt("Attendance already marked for today");const de=Z.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ne={name:O.employee_name,action:"Already Checked-In",time:de,employee_id:O.employee_id,mood:F};v(ae=>[ne,...ae.slice(0,9)]),setTimeout(()=>{o("ready"),i(null),u(null)},2e3)}else console.error("Attendance marking error:",L),o("Face recognized but attendance marking failed"),kt("Face recognized but attendance marking failed"),setTimeout(()=>{o("ready"),i(null),u(null)},2e3)}else if(L.message&&L.message.includes("already marked")){const Y=new Date;u(Y),o("Attendance marked successfully!"),kt("Attendance already marked for today");const Z=Y.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),de={name:O.employee_name,action:"Already Checked-In",time:Z,employee_id:O.employee_id,mood:F};v(ne=>[de,...ne.slice(0,9)]),setTimeout(()=>{o("ready"),i(null),u(null)},2e3)}else console.error("Attendance marking error:",L),o("Face recognized but attendance marking failed"),kt("Face recognized but attendance marking failed"),setTimeout(()=>{o("ready"),i(null),u(null)},2e3)}finally{N=!1}}else O.match||kt("Face detected but not recognized, trying again...")}else kt("No face detected, trying again...")}catch(W){console.error("Recognition error:",W),kt("Recognition attempt failed: "+W.message)}};T=setInterval(B,2e3),await B(),P=setTimeout(()=>{k||(k=!0,clearInterval(D),clearInterval(T),n(!1),o("Face not recognized"),C(),setTimeout(()=>{o("ready")},2e3))},15e3)};return p.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex flex-col",children:[p.jsx("style",{children:`
          .custom-scrollbar::-webkit-scrollbar {
            width: 2px;
          }
          .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 1px;
          }
          .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
          }
          .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.25);
          }
        `}),p.jsx(uy,{}),p.jsxs("main",{className:"flex-1 flex flex-col lg:flex-row gap-4 md:gap-6 p-4 md:p-8 max-w-7xl mx-auto w-full",children:[p.jsxs("div",{className:"flex-1 flex flex-col",children:[p.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border-2 border-white/20 overflow-hidden flex-1 flex flex-col",children:[p.jsxs("div",{className:"aspect-[16/9] bg-slate-800 relative flex flex-col",children:[p.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-500/20"}),p.jsxs("div",{className:"flex justify-between p-4 z-20",children:[p.jsx("div",{className:`bg-black/50 px-4 py-2 rounded-full text-sm font-medium text-white ${r==="success"||r.includes("successfully")?"bg-green-600":r==="Face not recognized"||r==="No face detected"||r.includes("failed")?"bg-red-600":"bg-black/50"}`,children:r==="ready"?"Ready":r}),p.jsx("div",{className:"bg-red-500 w-3 h-3 rounded-full animate-pulse"})]}),p.jsx("div",{className:"flex-1 relative z-10 text-center px-4 flex items-center justify-center",children:l?r==="Attendance marked successfully!"&&a&&s?p.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:[p.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[p.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center",children:p.jsx(Lr,{className:"w-8 h-8 text-white"})}),p.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:p.jsx("span",{className:"text-2xl font-bold text-white",children:a.employee_name.split(" ").map(E=>E[0]).join("")})}),p.jsxs("div",{className:"text-center space-y-1",children:[p.jsx("h2",{className:"text-white text-xl font-semibold",children:a.employee_name}),p.jsxs("p",{className:"text-gray-300 text-sm",children:["ID: ",a.employee_id]}),(a==null?void 0:a.department)&&p.jsx("p",{className:"text-gray-400 text-xs",children:a.department})]})]}),p.jsxs("button",{className:"px-6 py-3 bg-green-500 hover:bg-green-600 transition-colors text-white font-semibold rounded-full text-sm",children:[y||"Check-In"," Successful"]})]}):r==="Face not recognized"?p.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:[p.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[p.jsx("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center",children:p.jsx(rh,{className:"w-8 h-8 text-white"})}),p.jsxs("div",{className:"text-center space-y-1",children:[p.jsx("h2",{className:"text-white text-xl font-semibold",children:"Face Not Recognized"}),p.jsx("p",{className:"text-gray-300 text-sm",children:"Please try again or contact support"})]})]}),p.jsx("button",{className:"px-6 py-3 bg-red-500 hover:bg-red-600 transition-colors text-white font-semibold rounded-full text-sm",children:"Try Again"})]}):r==="Inactive employees cannot mark attendance"?p.jsx("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:p.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[p.jsx("div",{className:"w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center",children:p.jsx(oo,{className:"w-8 h-8 text-white"})}),p.jsxs("div",{className:"text-center space-y-1",children:[p.jsx("h2",{className:"text-white text-xl font-semibold",children:"Attendance Denied"}),p.jsx("p",{className:"text-gray-300 text-sm",children:"Inactive employees are not allowed to mark attendance."})]})]})}):t?p.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:[p.jsxs("div",{className:"relative py-4 px-2 w-full flex justify-center",children:[p.jsx("video",{ref:m,autoPlay:!0,muted:!0,playsInline:!0,className:`\r
                          w-full\r
                          max-w-[280px]       /* Perfect for phones */\r
                          sm:max-w-[320px]    /* Tablet small */\r
                          md:max-w-[380px]    /* Desktop */\r
                          aspect-square        /* Always square, never stretched */\r
                          border-4 border-blue-400/40\r
                          rounded-xl\r
                          object-cover\r
                          bg-black\r
                        `}),p.jsx("canvas",{ref:g,className:`\r
                          absolute\r
                          top-16\r
                          inset-x-0\r
                          bottom-0\r
                          w-full\r
                          max-w-[280px]\r
                          sm:max-w-[320px]\r
                          md:max-w-[380px]\r
                          aspect-square\r
                        `,style:{display:"none"}})]}),p.jsx("div",{className:"flex flex-col items-center space-y-1",children:p.jsxs("div",{className:"text-center",children:[p.jsxs("p",{className:"text-lg text-white font-medium",children:["Analyzing face... (",d,"s)"]}),p.jsx("p",{className:"text-sm text-gray-400",children:"Please keep your face in the frame"})]})}),a&&p.jsxs("div",{className:"p-4 rounded-lg border border-green-500/30 max-w-sm",children:[p.jsxs("div",{className:"flex items-center gap-2 text-green-400 mb-2",children:[p.jsx(Lr,{className:"w-5 h-5"}),p.jsx("span",{className:"font-medium",children:"Recognized!"})]}),p.jsx("p",{className:"text-white font-medium",children:a.employee_name}),p.jsxs("p",{className:"text-gray-300 text-sm",children:["Employee ID: ",a.employee_id]}),p.jsxs("p",{className:"text-gray-300 text-sm",children:["Mood: ",a.mood]})]})]}):p.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 mb-4",children:[p.jsx(pa,{className:"w-16 h-16 text-white/70"}),p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-lg text-white font-medium mb-1",children:"Position your face in the frame"}),p.jsx("p",{className:"text-sm text-gray-400",children:"Camera is active and scanning"})]})]}):p.jsx(_I,{})})]}),p.jsx("div",{className:"p-4 md:p-6 text-center",children:p.jsx("button",{onClick:_,className:`bg-blue-600 hover:bg-blue-700 text-white px-6 md:px-8 py-2 md:py-3 rounded-lg font-semibold transition-colors text-sm md:text-base ${l?"":"opacity-50 cursor-not-allowed"}`,disabled:!l,children:"Simulate Face Recognition"})})]}),p.jsx("div",{className:"w-full lg:w-96 flex flex-col gap-4 md:gap-6"})]}),p.jsxs("div",{className:"w-full lg:w-96 flex flex-col gap-4 md:gap-6",children:[p.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border border-white/20 p-6",children:[p.jsxs("h2",{className:"text-white text-lg font-semibold mb-4 flex items-center gap-2",children:[p.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Recent Activity"]}),p.jsxs("div",{className:"space-y-3 h-60 overflow-y-auto scrollbar-w-1 scrollbar-thumb-white/20 scrollbar-track-transparent",children:[h.map((E,k)=>p.jsxs("div",{className:"bg-white/5 rounded-lg p-3 flex items-center gap-3 hover:bg-white/10 transition-colors",children:[p.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:E.name.split(" ").map(R=>R[0]).join("")}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"text-white text-sm font-medium truncate",children:E.name}),p.jsx("p",{className:"text-slate-400 text-xs",children:E.action})]}),p.jsx("div",{className:"text-slate-300 text-xs",children:E.time})]},k)),h.length===0&&p.jsx("div",{className:"text-center text-gray-400 text-sm py-8",children:"No recent activities yet"})]})]}),p.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border border-white/20 p-6",children:[p.jsx("h3",{className:"text-white text-lg font-semibold mb-4",children:"Instructions"}),p.jsxs("ul",{className:"space-y-3 text-slate-300 text-sm",children:[p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx("span",{className:"text-blue-400 font-bold",children:"1."})," Stand 2-3 feet away from the screen"]}),p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx("span",{className:"text-blue-400 font-bold",children:"2."})," Look directly at the camera"]}),p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx("span",{className:"text-blue-400 font-bold",children:"3."})," Wait for automatic recognition"]}),p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx("span",{className:"text-blue-400 font-bold",children:"4."})," Confirmation will appear on screen"]})]})]})]})]}),p.jsx(ly,{})]})},EI=({isOpen:e,onClose:t,statType:n,statValue:r})=>{const[o,a]=M.useState([]),[i,s]=M.useState(!1),[u,l]=M.useState(null);M.useEffect(()=>{e&&n&&c()},[e,n]);const c=async()=>{s(!0),l(null);try{let f;switch(n){case"total_employees":f=await Ae.getEmployees(),a(f);break;case"present_today":f=await Ae.getPresentToday(),a(f);break;case"absent_today":f=await Ae.getAbsentToday(),a(f);break;case"on_leave":f=await Ae.getOnLeaveToday(),a(f);break;case"late_arrivals":f=await Ae.getLateArrivalsToday(),a(f);break;case"early_departures":f=await Ae.getEarlyDeparturesToday(),a(f);break;default:a([])}}catch(f){l(f.message||"Failed to load data")}finally{s(!1)}};if(!e)return null;const d=()=>{switch(n){case"total_employees":return"All Employees";case"present_today":return"Employees Present Today";case"absent_today":return"Employees Absent Today";case"on_leave":return"Employees On Leave";case"late_arrivals":return"Late Arrivals Today";case"early_departures":return"Early Departures Today";default:return"Details"}};return p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[p.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 md:p-6 flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:d()}),p.jsxs("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:[r," records"]})]}),p.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:p.jsx(Vi,{className:"w-6 h-6"})})]}),p.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[i&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),p.jsx("p",{className:"text-gray-600",children:"Loading..."})]}),u&&p.jsx("div",{className:"text-center py-8",children:p.jsx("p",{className:"text-red-600",children:u})}),!i&&!u&&o.length===0&&p.jsx("div",{className:"text-center py-8",children:p.jsx("p",{className:"text-gray-500",children:"No data available"})}),!i&&!u&&o.length>0&&p.jsx("div",{className:"space-y-4",children:o.map((f,h)=>{var v,y,x,m,g,b,w,C;return p.jsx("div",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors",children:p.jsxs("div",{className:"flex items-start justify-between gap-4",children:[p.jsxs("div",{className:"flex-1",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[p.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f.name?f.name.split(" ").map(_=>_[0]).join("").toUpperCase():"N/A"}),p.jsxs("div",{children:[p.jsx("h3",{className:"font-semibold text-gray-900",children:f.name||((v=f.employee)==null?void 0:v.name)||`Employee ${f.employee_id||f.id}`}),p.jsx("p",{className:"text-sm text-gray-600",children:f.department||((y=f.employee)==null?void 0:y.department)||"N/A"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(oh,{className:"w-4 h-4"}),p.jsx("span",{className:"truncate",children:f.email||((x=f.employee)==null?void 0:x.email)||"N/A"})]}),n==="early_departures"?p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(Fd,{className:"w-4 h-4"}),p.jsx("span",{children:f.phone||((m=f.employee)==null?void 0:m.phone)||"N/A"})]}),p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(Fn,{className:"w-4 h-4"}),p.jsxs("span",{children:["Check-out: ",f.check_out_time||((g=f.employee)==null?void 0:g.check_out_time)||"N/A"]})]}),p.jsxs("div",{className:"flex items-center gap-2 text-xs text-purple-600",children:[p.jsx(oo,{className:"w-4 h-4"}),p.jsxs("span",{children:["Early by: ",f.early_minutes||((b=f.employee)==null?void 0:b.early_minutes)||"N/A"," mins"]})]})]}):n==="late_arrivals"?p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(Fn,{className:"w-4 h-4"}),p.jsxs("span",{children:["Check-in: ",f.check_in_time]})]}),p.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600",children:[p.jsx(oo,{className:"w-4 h-4"}),p.jsxs("span",{children:["Late by: ",f.late_minutes||((w=f.employee)==null?void 0:w.late_minutes)||"N/A"," mins"]})]})]}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(Fd,{className:"w-4 h-4"}),p.jsx("span",{children:f.phone||((C=f.employee)==null?void 0:C.phone)||"N/A"})]}),f.check_in_time&&p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(Fn,{className:"w-4 h-4"}),p.jsxs("span",{children:["Check-in: ",f.check_in_time]})]}),f.check_out_time&&p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(Fn,{className:"w-4 h-4"}),p.jsxs("span",{children:["Check-out: ",f.check_out_time]})]})]})]})]}),p.jsx("div",{className:"text-right",children:f.status&&p.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${f.status==="present"?"bg-green-100 text-green-700":f.status==="absent"?"bg-red-100 text-red-700":f.status==="on_leave"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:f.status})})]})},h)})})]}),p.jsx("div",{className:"flex justify-end p-4 border-t bg-gray-50",children:p.jsx("button",{onClick:()=>window.location.href="/employees",className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:"Manage Employees"})})]})})},NI=()=>{const e=Ha(),[t,n]=M.useState(!0),[r,o]=M.useState(null),[a,i]=M.useState({total_employees:0,present_today:0,absent_today:0,on_leave:0,late_arrivals:0,early_departures:0,changes:{present:0,absent:0,on_leave:0,late_arrivals:0,early_departures:0}}),[s,u]=M.useState([]),[l,c]=M.useState({average_check_in:"00:00",average_work_hours:0,punctuality_rate:0}),[d,f]=M.useState([]),[h,v]=M.useState(0),[y,x]=M.useState({isOpen:!1,statType:null,statValue:0});M.useEffect(()=>{const k=async()=>{n(!0),o(null);try{const N=await Ae.getDashboardData();i(N.stats),u(N.departments),c(N.trends),f(N.live_activity)}catch(N){console.error("Error fetching dashboard data:",N),o(N.message||"Failed to load dashboard data")}finally{n(!1)}};k();const R=setInterval(()=>{k()},6e4);return()=>clearInterval(R)},[h]);const[m,g]=M.useState(new Date);M.useEffect(()=>{const k=setInterval(()=>{g(new Date)},1e3);return()=>clearInterval(k)},[]);const b=()=>m.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),w=()=>m.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),C=k=>k==="Check-In"?"bg-green-100 text-green-700":k==="Re-Check-In"?"bg-blue-100 text-blue-700":k==="Check-Out"?"bg-gray-100 text-gray-700":k==="Early Departure"?"bg-orange-100 text-orange-700":k==="Break Start"?"bg-yellow-100 text-yellow-700":k==="Break End"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700",_=(k,R)=>{x({isOpen:!0,statType:k,statValue:R})},E=()=>{x({isOpen:!1,statType:null,statValue:0})};return p.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:p.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[p.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),p.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Real-time attendance monitoring"})]}),p.jsxs("div",{className:"text-left md:text-right",children:[p.jsx("div",{className:"text-xl md:text-2xl font-bold text-gray-900",children:b()}),p.jsx("div",{className:"text-xs md:text-sm text-gray-600",children:w()})]})]}),r&&p.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[p.jsx("p",{className:"text-red-600",children:r}),p.jsx("button",{onClick:()=>v(k=>k+1),className:"mt-2 text-sm text-red-600 hover:text-red-700",children:"Try again"})]}),t&&p.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),p.jsx("p",{className:"text-gray-600",children:"Loading dashboard data..."})]})}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:[p.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>_("total_employees",a.total_employees),children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Employees"}),p.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:a.total_employees}),p.jsx("div",{className:"flex items-center gap-2 mt-2",children:p.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current Count"})})]}),p.jsx("div",{className:"bg-blue-500 w-12 h-12 rounded-lg flex items-center justify-center",children:p.jsx(Au,{className:"w-6 h-6 text-white"})})]})}),p.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>_("present_today",a.present_today),children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Present Today"}),p.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:a.present_today}),p.jsx("div",{className:"flex items-center gap-2 mt-2",children:p.jsxs("span",{className:`text-xs font-medium ${a.changes.present>=0?"text-green-600":"text-red-600"}`,children:[a.changes.present>0?"+":"",a.changes.present," from yesterday"]})})]}),p.jsx("div",{className:"bg-green-500 w-12 h-12 rounded-lg flex items-center justify-center",children:p.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-user-check text-white",children:[p.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),p.jsx("circle",{cx:"9",cy:"7",r:"4"}),p.jsx("polyline",{points:"16 11 18 13 22 9"})]})})]})}),p.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>_("absent_today",a.absent_today),children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Absent"}),p.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:a.absent_today}),p.jsx("div",{className:"flex items-center gap-2 mt-2",children:p.jsxs("span",{className:`text-xs font-medium ${a.changes.absent<=0?"text-green-600":"text-red-600"}`,children:[a.changes.absent>0?"+":"",a.changes.absent," from yesterday"]})})]}),p.jsx("div",{className:"bg-red-500 w-12 h-12 rounded-lg flex items-center justify-center",children:p.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-user-x text-white",children:[p.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),p.jsx("circle",{cx:"9",cy:"7",r:"4"}),p.jsx("line",{x1:"17",x2:"22",y1:"8",y2:"13"}),p.jsx("line",{x1:"22",x2:"17",y1:"8",y2:"13"})]})})]})}),p.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>_("on_leave",a.on_leave),children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm font-medium text-gray-600",children:"On Leave"}),p.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:a.on_leave}),p.jsx("div",{className:"flex items-center gap-2 mt-2",children:p.jsxs("span",{className:`text-xs font-medium ${a.changes.on_leave>=0?"text-green-600":"text-red-600"}`,children:[a.changes.on_leave>0?"+":"",a.changes.on_leave," from yesterday"]})})]}),p.jsx("div",{className:"bg-yellow-500 w-12 h-12 rounded-lg flex items-center justify-center",children:p.jsx("div",{className:"bg-yellow-500 w-12 h-12 rounded-lg flex items-center justify-center",children:p.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-activity text-white",children:p.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})})})]})}),p.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>_("late_arrivals",a.late_arrivals),children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Late Arrivals"}),p.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:a.late_arrivals}),p.jsx("div",{className:"flex items-center gap-2 mt-2",children:p.jsxs("span",{className:`text-xs font-medium ${a.changes.late_arrivals>=0?"text-green-600":"text-red-600"}`,children:[a.changes.late_arrivals>0?"+":"",a.changes.late_arrivals," from yesterday"]})})]}),p.jsx("div",{className:"bg-orange-500 w-12 h-12 rounded-lg flex items-center justify-center",children:p.jsx(Fn,{className:"w-6 h-6 text-white"})})]})}),p.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>_("early_departures",a.early_departures),children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Early Departures"}),p.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:a.early_departures}),p.jsx("div",{className:"flex items-center gap-2 mt-2",children:p.jsxs("span",{className:`text-xs font-medium ${a.changes.early_departures<=0?"text-green-600":"text-red-600"}`,children:[a.changes.early_departures>0?"+":"",a.changes.early_departures," from yesterday"]})})]}),p.jsx("div",{className:"bg-purple-500 w-12 h-12 rounded-lg flex items-center justify-center",children:p.jsx(oo,{className:"w-6 h-6 text-white"})})]})})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:[p.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),"Live Activity Feed"]}),p.jsx("button",{onClick:()=>e("/reports"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),p.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:d.map((k,R)=>p.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[p.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:k.name.split(" ").map(N=>N[0]).join("").toUpperCase()}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsx("p",{className:"text-sm font-medium text-gray-900",children:k.name}),p.jsxs("p",{className:"text-xs text-gray-500",children:[k.time," ago"]})]}),p.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${C(k.action)}`,children:k.action})]},R))})]}),p.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[p.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Department Attendance"}),p.jsx("div",{className:"space-y-4",children:s.map((k,R)=>p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm font-medium text-gray-700",children:k.department}),p.jsxs("span",{className:"text-sm text-gray-600",children:[k.present,"/",k.total]})]}),p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all",style:{width:`${k.percentage}%`}})}),p.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[k.percentage,"% present"]})]},R))})]})]}),p.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[p.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[p.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Attendance Trends"}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Average Check-in Time"}),p.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.average_check_in&&l.average_check_in!=="00:00:00"?new Date(`2000-01-01T${l.average_check_in}`).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"No Data"})]}),p.jsx(Am,{className:"w-8 h-8 text-green-500"})]}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Average Work Hours"}),p.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[typeof l.average_work_hours=="number"&&!isNaN(l.average_work_hours)?l.average_work_hours.toFixed(1):"0.0"," hrs"]})]}),p.jsx(Fn,{className:"w-8 h-8 text-blue-500"})]}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Punctuality Rate"}),p.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[l.punctuality_rate,"%"]})]}),p.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-activity text-purple-500",children:p.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})]})]})]}),p.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[p.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Quick Actions"}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("button",{onClick:()=>e("/employees"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left",children:[p.jsx(Au,{className:"w-6 h-6 text-blue-600 mb-2"}),p.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Manage Employees"})]}),p.jsxs("button",{onClick:()=>e("/reports"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-left",children:[p.jsx(Am,{className:"w-6 h-6 text-green-600 mb-2"}),p.jsx("p",{className:"text-sm font-medium text-gray-900",children:"View Reports"})]}),p.jsxs("button",{onClick:()=>e("/policies"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-colors text-left",children:[p.jsx(Fn,{className:"w-6 h-6 text-purple-600 mb-2"}),p.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Manage Policies"})]}),p.jsxs("button",{onClick:()=>_("late_arrivals",a.late_arrivals),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-colors text-left",children:[p.jsx(oo,{className:"w-6 h-6 text-orange-600 mb-2"}),p.jsx("p",{className:"text-sm font-medium text-gray-900",children:"View Alerts"})]})]})]})]}),y.isOpen&&p.jsx(EI,{isOpen:y.isOpen,onClose:E,statType:y.statType,statValue:y.statValue})]})})};function SI(){const e=Ha(),t=new Date,[n,r]=M.useState(null),[o,a]=M.useState(t.getFullYear()),[i,s]=M.useState(t.getMonth()),[u,l]=M.useState([]),[c,d]=M.useState(1),f=5,[h,v]=M.useState(!1),[y,x]=M.useState(null),[m,g]=M.useState({}),[b,w]=M.useState("monthly"),[C,_]=M.useState(""),[E,k]=M.useState(""),[R,N]=M.useState(!1),[P,T]=M.useState(null),[D,B]=M.useState(!1),[W,U]=M.useState(!1),[$,F]=M.useState(""),[O,L]=M.useState([]),[G,Y]=M.useState([]),Z=()=>{i===0?(s(11),a(o-1)):s(i-1)},de=()=>{i===11?(s(0),a(o+1)):s(i+1)},ne=new Date(o,i,1),ae=ne.toLocaleDateString("en-US",{month:"long",year:"numeric"}),pe=new Date(o,i+1,0).getDate(),ge=new Date(o,i,1).getDay(),ye=q=>{const ie=q.getFullYear(),fe=String(q.getMonth()+1).padStart(2,"0"),Te=String(q.getDate()).padStart(2,"0");return`${ie}-${fe}-${Te}`},Ve=(q,ie,fe)=>`${q}-${String(ie+1).padStart(2,"0")}-${String(fe).padStart(2,"0")}`;function be(q){switch(q){case"Present":return"bg-green-500 text-white";case"Late Arrival":return"bg-purple-500 text-white";case"Absent":return"bg-red-500 text-white";case"Holiday":return"bg-blue-500 text-white";case"On Leave":return"bg-orange-500 text-white";case"Early Departure":return"bg-pink-500 text-white";case"Half Day":return"bg-yellow-500 text-white";default:return""}}const Ee=async()=>{var q;try{const ie=await Ae.getEmployees();l(ie||[]);const fe=[...new Set((ie||[]).map(Te=>Te.department).filter(Boolean))];L(fe),Y(ie||[]),ie&&ie.length>0&&!n&&r(ie[0].employee_id)}catch(ie){((q=ie==null?void 0:ie.response)==null?void 0:q.status)===401&&e("/login"),x("Failed to fetch employees")}},ke=async()=>{var q;if(n){v(!0),x(null);try{const ie=ne.getFullYear(),fe=ne.getMonth()+1,Te=await Ae.getEmployeeMonthlyAttendance(n,ie,fe),tt={};(Te||[]).forEach(Re=>{const ct=Re.date;tt[ct]={status:Re.status,checkIn:Re.check_in?new Date(Re.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",checkOut:Re.check_out?new Date(Re.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",totalHours:Re.total_hours||"-",breaks:Re.breaks||[],holiday:Re.holiday||null,leaveReason:Re.leave_reason||null}}),g(tt)}catch(ie){console.error(ie),((q=ie==null?void 0:ie.response)==null?void 0:q.status)===401&&e("/login"),x("Failed to fetch attendance records")}finally{v(!1)}}};M.useEffect(()=>{Ee()},[]),M.useEffect(()=>{ke()},[n,o,i]),M.useEffect(()=>{const q=setInterval(()=>{n&&ke()},3e4);return()=>clearInterval(q)},[n,o,i]),M.useEffect(()=>{const q=P?u.filter(ie=>ie.department===P):u;Y(q),n&&!q.some(ie=>ie.employee_id===n)&&r(q.length>0?q[0].employee_id:null)},[P,u]);const Oe=()=>{B(!1)},Ne=()=>{T(null),B(!1)},lt=(()=>{const q=[],ie=ne.getFullYear(),fe=ne.getMonth();ye(new Date);for(let Te=0;Te<ge;Te++)q.push(null);for(let Te=1;Te<=pe;Te++){const tt=Ve(ie,fe,Te),Re=new Date(ie,fe,Te),ct=ye(Re);let Rn=m[tt];if(!Rn){const go=new Date(t);go.setDate(go.getDate()-1);const Rr=ye(go),Ir=Re.getDay();ct<=Rr&&n&&Ir!==0&&Ir!==6&&(Rn={status:"Absent",checkIn:"-",checkOut:"-",totalHours:"-",holiday:null})}q.push({day:Te,key:tt,rec:Rn,date:Re})}return q})(),Tt=lt.filter(Boolean).filter(q=>q.rec).map(q=>({date:q.key,...q.rec})).sort((q,ie)=>q.date<ie.date?1:-1),it=h?Array(f).fill({skeleton:!0}):Tt.slice((c-1)*f,c*f),rn=Math.max(1,Math.ceil(Tt.length/f)),Gt=async()=>{var q;if(n){if(b==="custom"&&(!C||!E)){x("Please select both start and end dates for custom range");return}if(b==="custom"&&new Date(C)>new Date(E)){x("Start date cannot be after end date");return}try{let ie,fe;const Te=ne.getFullYear(),tt=ne.getMonth()+1;if(b==="daily"){const Rn=new Date().toISOString().split("T")[0];ie=await Ae.exportEmployeeDailyAttendance(n,Rn),fe=`attendance-daily-${n}-${Rn}.csv`}else b==="monthly"?(ie=await Ae.exportEmployeeMonthlyAttendance(n,Te,tt),fe=`attendance-monthly-${n}-${Te}-${tt}.csv`):b==="custom"&&(ie=await Ae.exportEmployeeCustomRangeAttendance(n,C,E),fe=`attendance-custom-${n}-${C}-to-${E}.csv`);const Re=window.URL.createObjectURL(ie),ct=document.createElement("a");ct.href=Re,ct.download=fe,document.body.appendChild(ct),ct.click(),window.URL.revokeObjectURL(Re),document.body.removeChild(ct),N(!1)}catch(ie){((q=ie==null?void 0:ie.response)==null?void 0:q.status)===401&&e("/login"),x("Failed to download attendance records")}}},gn=async()=>{var q;if(!n||!$){x("Please select an employee and enter an email address");return}if(b==="custom"&&(!C||!E)){x("Please select both start and end dates for custom range");return}if(b==="custom"&&new Date(C)>new Date(E)){x("Start date cannot be after end date");return}try{const ie=ne.getFullYear(),fe=ne.getMonth()+1;await Ae.emailEmployeeAttendanceReport(n,$,b,ie,fe,C,E),U(!1),F(""),x(null)}catch(ie){((q=ie==null?void 0:ie.response)==null?void 0:q.status)===401&&e("/login"),x("Failed to send email report")}};return p.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:p.jsxs("div",{className:"p-3 space-y-4",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Attendance Calendar"}),p.jsx("p",{className:"text-md text-gray-500",children:"View attendance records"})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsxs("button",{onClick:()=>B(!0),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors flex items-center gap-2",children:[p.jsx(ay,{className:"w-5 h-5"}),"Filter"]}),p.jsxs("button",{onClick:()=>U(!0),disabled:h||!n,className:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md shadow hover:bg-green-700 disabled:opacity-60 disabled:cursor-not-allowed",children:[p.jsx(oh,{className:"w-4 h-4"}),"Email Report"]}),p.jsxs("button",{onClick:()=>N(!0),disabled:h||!n,className:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md shadow hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",children:[p.jsx(oy,{className:"w-4 h-4"}),"Export"]})]})]}),p.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsxs("div",{className:"flex-1 max-w-xs",children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee"}),p.jsxs("div",{className:"relative",children:[p.jsx("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",value:n||"",onChange:q=>r(q.target.value),disabled:h,children:G.map(q=>p.jsx("option",{value:q.employee_id,children:q.name},q.employee_id))}),p.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:p.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("button",{onClick:Z,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:p.jsx(pC,{className:"w-5 h-5"})}),p.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:ae}),p.jsx("button",{onClick:de,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:p.jsx(vC,{className:"w-5 h-5"})})]}),p.jsx("div",{className:"flex-1"})]}),y&&p.jsx("div",{className:"text-rose-500 text-sm",children:y}),p.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2 mb-2",children:[p.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sun"}),p.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Mon"}),p.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Tue"}),p.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Wed"}),p.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Thu"}),p.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Fri"}),p.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sat"})]}),p.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2",children:[lt.slice(0,ge).map((q,ie)=>p.jsx("div",{className:"aspect-square"},`lead-${ie}`)),lt.slice(ge).map((q,ie)=>{var Re,ct;const fe=(Re=q.rec)==null?void 0:Re.status,Te=be(fe),tt=new Date(q.key).getDay()===0||new Date(q.key).getDay()===6;return p.jsx("div",{className:`aspect-square border-2 rounded-lg p-2 cursor-pointer transition-all hover:shadow-md ${fe?Te:tt?"bg-gray-100 border-gray-200":"bg-white border-gray-200"}`,children:p.jsxs("div",{className:"h-full flex flex-col",children:[p.jsx("span",{className:`text-sm font-semibold mb-1 ${fe?"text-white":"text-gray-700"}`,children:q.day}),p.jsx("div",{className:"flex-1 flex flex-col justify-center text-xs",children:q.rec?p.jsx(p.Fragment,{children:fe==="Holiday"?p.jsx("span",{className:`font-medium ${fe?"text-white":"text-gray-700"}`,children:((ct=q.rec.holiday)==null?void 0:ct.name)||"Holiday"}):fe==="On Leave"?p.jsx("span",{className:`font-medium ${fe?"text-white":"text-gray-700"}`,children:q.rec.leaveReason||"Sick Leave"}):fe==="Present"||fe==="Late Arrival"||fe==="Early Departure"||fe==="Half Day"?p.jsxs(p.Fragment,{children:[p.jsxs("span",{className:`${fe?"text-white":"text-gray-700"}`,children:["In: ",q.rec.checkIn]}),p.jsxs("span",{className:`${fe?"text-white":"text-gray-700"}`,children:["Out: ",q.rec.checkOut]})]}):p.jsx("span",{children:""})}):p.jsx("span",{children:""})})]})},`${q.key}-${ie}`)})]}),p.jsxs("div",{className:"mt-4 md:mt-6 pt-4 md:pt-6 border-t border-gray-200 grid grid-cols-2 sm:flex sm:flex-wrap gap-3 md:gap-4",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Present"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Half Day"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Absent"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Holiday"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),p.jsx("span",{className:"text-sm text-gray-700",children:"On Leave"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Late Arrival"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 bg-pink-500 rounded"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Early Departure"})]})]})]}),p.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[p.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2",children:[p.jsx($i,{className:"w-5 h-5"})," Detailed Attendance Logs"]}),p.jsx("div",{className:"space-y-4",children:it.map((q,ie)=>p.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors",children:[p.jsx("div",{className:"flex items-start justify-between mb-3",children:q.skeleton?p.jsxs(p.Fragment,{children:[p.jsxs("div",{children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded animate-pulse"}),p.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})]}),p.jsx("div",{className:"h-4 w-40 bg-gray-200 rounded animate-pulse mt-2"})]}),p.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(fe=>p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded animate-pulse mt-1"}),p.jsxs("div",{children:[p.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"}),p.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse mt-1"})]})]},fe))})]}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-lg font-semibold text-gray-900",children:new Date(q.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),p.jsx("p",{className:"text-sm text-gray-600",children:(()=>{const fe=u.find(tt=>tt.employee_id===n),Te=fe==null?void 0:fe.policy;return Te?`${Te.name} (${Te.status==="active"?"Active":"Inactive"})`:"No Policy"})()})]}),p.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${q.status==="Present"?"bg-green-100 text-green-700":q.status==="Absent"?"bg-red-100 text-red-800":q.status==="Late Arrival"?"bg-purple-100 text-purple-800":q.status==="Early Departure"?"bg-pink-100 text-pink-800":q.status==="Holiday"?"bg-blue-100 text-blue-800":q.status==="On Leave"?"bg-orange-100 text-orange-800":q.status==="Half Day"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:q.status})]})}),!q.skeleton&&p.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(Fn,{className:"w-5 h-5 text-green-600 mt-1"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-xs text-gray-600",children:"Check-In"}),p.jsx("p",{className:"text-base font-semibold text-gray-900",children:q.checkIn})]})]}),p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(Ad,{className:"w-5 h-5 text-red-600 mt-1"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-xs text-gray-600",children:"Check-Out"}),p.jsx("p",{className:"text-base font-semibold text-gray-900",children:q.checkOut})]})]}),p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx(Fn,{className:"w-5 h-5 text-blue-600 mt-1"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-xs text-gray-600",children:"Total Duration"}),p.jsx("p",{className:"text-base font-semibold text-gray-900",children:q.totalHours})]})]}),p.jsxs("div",{className:"flex items-start gap-3",children:[p.jsx($i,{className:"w-5 h-5 text-purple-600 mt-1"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-xs text-gray-600",children:"Re-entries"}),p.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[Array.isArray(q.breaks)?q.breaks.length:q.breaks||0," times"]})]})]})]}),q.breaks&&q.breaks.length>0&&p.jsx(p.Fragment,{children:p.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[p.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Break Details:"}),q.breaks.map((fe,Te)=>p.jsxs("div",{className:"flex gap-4 text-sm",children:[p.jsxs("span",{className:"text-gray-700",children:["Out: ",fe.break_out?new Date(fe.break_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]}),p.jsxs("span",{className:"text-gray-700",children:["In: ",fe.break_in?new Date(fe.break_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]})]},Te))]})})]},q.skeleton?ie:q.date))}),p.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 pt-4 border-t border-gray-200 gap-4",children:[p.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",it.length," of ",Tt.length," records"]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:()=>d(q=>Math.max(1,q-1)),disabled:c===1,className:`px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ${c===1?"opacity-50 cursor-not-allowed":""}`,children:"Previous"}),p.jsx("button",{className:"px-4 py-2 rounded-lg text-sm font-medium bg-blue-600 text-white",children:c}),p.jsx("button",{onClick:()=>d(q=>Math.min(rn,q+1)),disabled:c===rn,className:`px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ${c===rn?"opacity-50 cursor-not-allowed":""}`,children:"Next"})]})]})]}),R&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Export Attendance Report"}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),p.jsxs("div",{className:"relative",children:[p.jsxs("select",{value:b,onChange:q=>w(q.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",children:[p.jsx("option",{value:"daily",children:"Daily (CSV)"}),p.jsx("option",{value:"monthly",children:"Monthly (CSV)"}),p.jsx("option",{value:"custom",children:"Custom range (CSV)"})]}),p.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:p.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),b==="custom"&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),p.jsx("input",{type:"date",value:C,onChange:q=>_(q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),p.jsx("input",{type:"date",value:E,onChange:q=>k(q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),p.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[p.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),p.jsx("button",{onClick:Gt,disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",children:h?"Downloading...":"Download"})]})]})}),D&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filter Employees"}),p.jsx("div",{className:"space-y-4",children:p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),p.jsxs("div",{className:"relative",children:[p.jsxs("select",{value:P||"",onChange:q=>T(q.target.value||null),className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",children:[p.jsx("option",{value:"",children:"All Departments"}),O.map(q=>p.jsx("option",{value:q,children:q},q))]}),p.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:p.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),p.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[p.jsx("button",{onClick:Ne,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Reset"}),p.jsx("button",{onClick:Oe,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Apply"})]})]})}),W&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Attendance Report"}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),p.jsx("input",{type:"email",value:$,onChange:q=>F(q.target.value),placeholder:"Enter email address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),p.jsxs("select",{value:b,onChange:q=>w(q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[p.jsx("option",{value:"daily",children:"Daily"}),p.jsx("option",{value:"monthly",children:"Monthly"}),p.jsx("option",{value:"custom",children:"Custom range"})]})]}),b==="custom"&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),p.jsx("input",{type:"date",value:C,onChange:q=>_(q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),p.jsx("input",{type:"date",value:E,onChange:q=>k(q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]})]}),p.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[p.jsx("button",{onClick:()=>{U(!1),F("")},className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),p.jsx("button",{onClick:gn,disabled:h,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-60 disabled:cursor-not-allowed",children:h?"Sending...":"Send Email"})]})]})})]})})}const RI=()=>{const[e,t]=M.useState(""),[n,r]=M.useState(""),[o,a]=M.useState(!1),[i,s]=M.useState(""),[u,l]=M.useState(!1),c=Ha();M.useEffect(()=>{localStorage.getItem("authToken")&&c("/dashboard")},[c]);const d=async f=>{f.preventDefault(),s(""),l(!0);try{const h=await Ae.login({email:e,password:n});c("/dashboard")}catch(h){if(console.error("Login failed:",h),h.errors){const v=Object.values(h.errors).flat();s(v.join(" "))}else s(h.message||"Invalid username or password. Please try again.")}finally{l(!1)}};return p.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4 overflow-y-auto",children:[p.jsx("div",{className:"absolute top-4 left-4",children:p.jsx("button",{onClick:()=>c("/"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 font-medium transition-colors",children:" Back to Kiosk"})}),p.jsxs("div",{className:"max-w-md w-full",children:[p.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[p.jsxs("div",{className:"text-center mb-8",children:[p.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-4",children:p.jsx(Pd,{className:"w-8 h-8 text-white"})}),p.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Login"}),p.jsx("p",{className:"text-gray-600",children:"Access the administration panel"})]}),p.jsxs("form",{className:"space-y-6",onSubmit:d,children:[i&&p.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:p.jsxs("div",{className:"flex",children:[p.jsx(oo,{className:"h-5 w-5 text-red-400"}),p.jsx("div",{className:"ml-3",children:p.jsx("p",{className:"text-sm text-red-700",children:i})})]})}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Username"}),p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:p.jsx(sy,{className:"h-5 w-5 text-gray-400"})}),p.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,value:e,onChange:f=>t(f.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter username"})]})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:p.jsx(Pd,{className:"h-5 w-5 text-gray-400"})}),p.jsx("input",{id:"password",name:"password",type:o?"text":"password",autoComplete:"current-password",required:!0,value:n,onChange:f=>r(f.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter password"}),p.jsx("button",{type:"button",onClick:()=>a(!o),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:p.jsx(NC,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})]}),p.jsx("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-400 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-[1.02] disabled:scale-100 disabled:cursor-not-allowed",children:u?p.jsxs("div",{className:"flex items-center justify-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing In..."]}):"Sign In"})]}),p.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:p.jsxs("p",{className:"text-xs text-gray-600 text-center",children:[p.jsx("strong",{children:"Demo Credentials:"}),p.jsx("br",{}),"Username: admin@kiosk.com | Password: admin123"]})})]}),p.jsx("div",{className:"text-center mt-6",children:p.jsx("p",{className:"text-sm text-gray-500",children:"Attendance Kiosk System v1.0"})})]})]})},II=({registerCleanup:e})=>{const[t,n]=M.useState([]),[r,o]=M.useState([]),[a,i]=M.useState(""),[s,u]=M.useState(!1),[l,c]=M.useState(null),[d,f]=M.useState({firstName:"",lastName:"",employeeId:"",email:"",phone:"",department:"",designation:"",policyId:"",joinDate:"",status:"active"}),[h,v]=M.useState({}),[y,x]=M.useState(null),[m,g]=M.useState(!0),[b,w]=M.useState(!1),C=M.useRef(!1),[_,E]=M.useState(!1),[k,R]=M.useState(null),[N,P]=M.useState(!1),[T,D]=M.useState(null),[B,W]=M.useState(!1),[U,$]=M.useState(0),[F,O]=M.useState(null),[L,G]=M.useState(""),[Y,Z]=M.useState("ssdMobilenetv1"),[de,ne]=M.useState([]),ae=M.useRef([]),[pe,ge]=M.useState([]),ye=M.useRef([]),[Ve,be]=M.useState(!1),Ee=M.useRef(!1),[ke,Oe]=M.useState(!1);M.useRef(!1);const Ne=M.useRef(null),Le=M.useRef(null);M.useRef(null);const lt=M.useRef(null);M.useEffect(()=>((async()=>{try{const[Fe,nt]=await Promise.all([Ae.getEmployees(),Ae.getPolicies()]);n(Fe),o(nt)}catch(Fe){console.error("Failed to load data:",Fe)}finally{g(!1)}})(),e&&e(()=>{Rr()}),()=>{Rr()}),[]);const Tt=async()=>{try{await ot.tinyFaceDetector.loadFromUri("/models"),await ot.ssdMobilenetv1.loadFromUri("/models"),await ot.faceLandmark68Net.loadFromUri("/models"),await ot.faceRecognitionNet.loadFromUri("/models"),w(!0)}catch(K){throw console.error("Failed to load face-api models:",K),K}},it=t.filter(K=>K.name.toLowerCase().includes(a.toLowerCase())||K.email.toLowerCase().includes(a.toLowerCase())||K.employee_id.toLowerCase().includes(a.toLowerCase())||K.department.toLowerCase().includes(a.toLowerCase())),rn=K=>K.split(" ").map(Fe=>Fe[0]).join("").toUpperCase(),Gt=()=>{f({firstName:"",lastName:"",employeeId:"",email:"",phone:"",department:"",designation:"",policyId:"",joinDate:"",status:"active"}),v({}),c(null)},gn=()=>{Gt(),u(!0)},q=K=>{f({firstName:K.name.split(" ")[0],lastName:K.name.split(" ").slice(1).join(" ")||"",employeeId:K.employee_id,email:K.email,phone:K.phone||"",department:K.department,designation:K.designation,policyId:K.policy?K.policy.id.toString():"",joinDate:K.join_date,status:K.status||"active"}),c(K),u(!0)},ie=()=>{u(!1),Gt()},fe=()=>{const K={};return d.firstName.trim()||(K.firstName="First name is required"),d.lastName.trim()||(K.lastName="Last name is required"),d.employeeId.trim()||(K.employeeId="Employee ID is required"),d.email.trim()?/\S+@\S+\.\S+/.test(d.email)||(K.email="Email is invalid"):K.email="Email is required",d.department.trim()||(K.department="Department is required"),d.designation.trim()||(K.designation="Designation is required"),d.policyId||(K.policyId="Policy is required"),d.joinDate||(K.joinDate="Join date is required"),v(K),Object.keys(K).length===0},Te=async K=>{if(K.preventDefault(),!fe())return;const Fe={employee_id:d.employeeId.trim(),name:`${d.firstName.trim()} ${d.lastName.trim()}`,email:d.email.trim(),phone:d.phone.trim(),department:d.department.trim(),designation:d.designation.trim(),join_date:d.joinDate,status:d.status,face_enrolled:l?l.face_enrolled:!1,policy_id:parseInt(d.policyId)};try{if(l){const nt=await Ae.updateEmployee(l.id,Fe),Un=await Ae.getEmployees();n(Un),D(nt),P(!0),ie()}else{const nt=await Ae.createEmployee(Fe);n([...t,nt]),R(nt),u(!1),E(!0)}}catch(nt){console.error("Failed to save employee:",nt),alert("Failed to save employee. Please try again.")}},tt=async()=>{try{await Ae.deleteEmployee(y.id),n(t.filter(K=>K.id!==y.id)),x(null)}catch(K){console.error("Failed to delete employee:",K),alert("Failed to delete employee. Please try again.")}},Re=()=>{const K=[["Name","Employee ID","Email","Phone","Department","Designation","Face Enrolled","Join Date"],...it.map($n=>[$n.name,$n.employee_id,$n.email,$n.phone||"",$n.department,$n.designation,$n.face_enrolled?"Yes":"No",$n.join_date])].map($n=>$n.join(",")).join(`
`),Fe=new Blob([K],{type:"text/csv"}),nt=window.URL.createObjectURL(Fe),Un=document.createElement("a");Un.href=nt,Un.download=`employees_${new Date().toISOString().split("T")[0]}.csv`,Un.click(),window.URL.revokeObjectURL(nt)},ct=async K=>{if(O(K),$(0),W(!0),G(""),ne([]),ae.current=[],ge([]),ye.current=[],!b&&!C.current){C.current=!0;try{await Tt()}finally{C.current=!1}}},Rn=()=>{W(!1),$(0),O(null),Rr()},go=async()=>{try{const K=await navigator.mediaDevices.getUserMedia({video:!0});if(Ne.current){Ne.current.srcObject=K,lt.current=K;const Fe=Ne.current.play();Fe!=null&&Fe.catch&&Fe.catch(()=>{})}}catch(K){console.error("Camera error",K),G("Camera access denied or unavailable.")}},Rr=()=>{lt.current&&(lt.current.getTracks().forEach(K=>K.stop()),lt.current=null)},Ir=async()=>{$(1),Z("ssdMobilenetv1"),G("Initializing camera..."),await go();const K=(Fe,nt,Un=0)=>{if(!Ne.current)return nt(new Error("No video element"));if(Ne.current.readyState>=2)return Fe();if(Un>50)return nt(new Error("Video not ready"));setTimeout(()=>K(Fe,nt,Un+1),100)};new Promise(K).then(()=>{be(!0),Ee.current=!0,G("Capturing your face..."),Go()}).catch(()=>G("Video not ready. Please try again."))},Go=async()=>{if(!(!Ee.current||ae.current.length>=10)){try{let K;if(Y==="ssdMobilenetv1"&&(K=await nl(Ne.current,new Ka({minConfidence:.5})).withFaceLandmarks().withFaceDescriptor(),K||Z("tinyFaceDetector")),K||(K=await nl(Ne.current,new Xh({inputSize:256,scoreThreshold:.1})).withFaceLandmarks().withFaceDescriptor()),K){ae.current.push(K.descriptor),ne([...ae.current]);const Fe=document.createElement("canvas");Fe.width=160,Fe.height=120;const nt=Fe.getContext("2d");try{nt.drawImage(Ne.current,0,0,Fe.width,Fe.height)}catch{}const Un=Fe.toDataURL("image/jpeg");ye.current.push(Un),ge([...ye.current]),G(`Capturing your face...
Image ${ae.current.length} of 10`),ae.current.length>=10&&(be(!1),Ee.current=!1,G("All 10 images captured. Ready to enroll."),Xa())}}catch(K){console.error("Detection error",K),G("Error during detection.")}Ee.current&&setTimeout(Go,250)}},Xa=async()=>{if(ae.current.length<5){alert("Please capture at least 5 images.");return}try{Oe(!0),G("Registering face...");const K={method:"auto-10",intervalMs:250,totalSamples:ae.current.length,detectionMethod:Y};await Ae.enrollFace(F.employee_id,ae.current,K),n(Fe=>Fe.map(nt=>nt.id===F.id?{...nt,face_enrolled:!0}:nt)),Rr(),$(2)}catch(K){console.error("Enrollment error:",K),G("Enrollment failed. Please try again.")}finally{Oe(!1)}};return m?p.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),p.jsx("p",{className:"text-gray-600",children:"Loading employees..."})]})}):p.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-6",children:p.jsxs("div",{className:"max-w-7xl mx-auto",children:[p.jsx("div",{className:"mb-6",children:p.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Employee Management"}),p.jsx("p",{className:"text-md text-gray-600 mt-1",children:"Manage employees and face enrollment"})]}),p.jsxs("button",{onClick:gn,className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-3 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm",children:[p.jsx(iy,{className:"w-4 h-4"}),p.jsx("span",{children:"Add Employee"})]})]})}),p.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 mb-6",children:[p.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[p.jsxs("div",{className:"relative flex-1",children:[p.jsx(Tm,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),p.jsx("input",{type:"text",placeholder:"Search employees...",value:a,onChange:K=>i(K.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{className:"flex flex-col sm:flex-row md:flex-row lg:flex-row gap-2",children:[p.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[p.jsx(ay,{className:"w-4 h-4"}),p.jsx("span",{className:"inline",children:"Filter"})]}),p.jsxs("button",{onClick:Re,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[p.jsx(oy,{className:"w-4 h-4"}),p.jsx("span",{className:"inline",children:"Export"})]})]})]}),p.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-5",children:it.map(K=>p.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-blue-500 hover:shadow-md transition-all",children:[p.jsxs("div",{className:"flex items-start justify-between mb-3",children:[p.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-lg font-bold",children:rn(K.name)}),p.jsxs("div",{className:"flex gap-1",children:[p.jsx("button",{onClick:()=>q(K),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",children:p.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-pen text-gray-600",children:p.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})}),p.jsx("button",{onClick:()=>x(K),className:"p-1.5 hover:bg-red-50 rounded-lg transition-colors",children:p.jsx(Tu,{className:"w-4 h-4"})})]})]}),p.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:K.name}),p.jsx("p",{className:"text-xs text-gray-600 mb-3",children:K.employee_id}),p.jsxs("div",{className:"space-y-2 mb-3",children:[p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(oh,{className:"w-4 h-4"}),p.jsx("span",{className:"truncate",children:K.email})]}),p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(Fd,{className:"w-4 h-4"}),p.jsx("span",{children:K.phone||"+1 234 567 8902"})]}),p.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[p.jsx(sy,{className:"w-4 h-4"}),p.jsx("span",{children:K.department})]})]}),K.face_enrolled?p.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 border border-green-200 rounded-lg mb-3",children:[p.jsx(Lr,{className:"w-4 h-4 text-green-600"}),p.jsx("span",{className:"text-xs font-medium text-green-700",children:"Face Enrolled"})]}):p.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-50 border border-red-200 rounded-lg mb-3",children:[p.jsx(rh,{className:"w-4 h-4 text-red-600"}),p.jsx("span",{className:"text-xs font-medium text-red-700",children:"Face Not Enrolled"})]}),p.jsxs("button",{onClick:()=>ct(K),className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors",children:[p.jsx(pa,{className:"w-4 h-4"}),p.jsx("span",{children:K.face_enrolled?"Re-enroll Face":"Enroll Face"})]})]},K.id))}),it.length===0&&p.jsxs("div",{className:"text-center py-12 bg-white rounded-xl border border-gray-200",children:[p.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:p.jsx(Tm,{className:"w-8 h-8 text-gray-400"})}),p.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"No employees found"}),p.jsx("p",{className:"text-sm text-gray-600",children:"Try adjusting your search or add a new employee"})]}),s&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[p.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between z-10",children:[p.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:l?"Edit Employee":"Add New Employee"}),p.jsx("button",{onClick:ie,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:p.jsx(Vi,{className:"w-5 h-5"})})]}),p.jsxs("div",{className:"overflow-y-auto px-6 py-6 flex-1 space-y-4",children:[p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),p.jsx("input",{type:"text",placeholder:"John",value:d.firstName,onChange:K=>f({...d,firstName:K.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),p.jsx("input",{type:"text",placeholder:"Smith",value:d.lastName,onChange:K=>f({...d,lastName:K.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee ID"}),p.jsx("input",{type:"text",placeholder:"EMP-001",value:d.employeeId,onChange:K=>f({...d,employeeId:K.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),p.jsx("input",{type:"email",placeholder:"john.smith@techcorp.com",value:d.email,onChange:K=>f({...d,email:K.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),p.jsx("input",{type:"tel",placeholder:"+1 234 567 8901",value:d.phone,onChange:K=>f({...d,phone:K.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),p.jsx("input",{type:"text",placeholder:"Engineering",value:d.department,onChange:K=>f({...d,department:K.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designation"}),p.jsx("input",{type:"text",placeholder:"Senior Developer",value:d.designation,onChange:K=>f({...d,designation:K.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attendance Policy"}),p.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:d.policyId,onChange:K=>f({...d,policyId:K.target.value}),children:[p.jsx("option",{value:"",children:"Select a policy"}),r.filter(K=>K.status==="active").map(K=>p.jsx("option",{value:K.id,children:K.name},K.id))]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Join Date"}),p.jsx("input",{type:"date",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:d.joinDate,onChange:K=>f({...d,joinDate:K.target.value})})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),p.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:d.status,onChange:K=>f({...d,status:K.target.value}),children:[p.jsx("option",{value:"active",children:"Active"}),p.jsx("option",{value:"inactive",children:"Inactive"}),p.jsx("option",{value:"on_leave",children:"On Leave"})]})]})]}),p.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-6 flex gap-3",children:[p.jsx("button",{onClick:ie,type:"button",className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),p.jsx("button",{onClick:Te,type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",children:l?"Update Employee":"Add Employee"})]})]})}),_&&k&&p.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 text-center",children:[p.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-50 flex items-center justify-center mx-auto mb-4",children:p.jsx(pa,{className:"w-7 h-7 text-blue-600"})}),p.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Employee Added!"}),p.jsxs("p",{className:"text-gray-700 mb-6",children:[p.jsx("span",{className:"font-semibold",children:k.name})," has been added successfully. Would you like to enroll their face now?"]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>{E(!1),R(null)},className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg font-medium",children:"Enroll Later"}),p.jsxs("button",{onClick:()=>{E(!1),ct(k)},className:"flex-1 px-4 py-2.5 rounded-lg font-medium bg-blue-600 text-white inline-flex items-center justify-center gap-2",children:[p.jsx(pa,{className:"w-4 h-4"}),"Enroll Now"]})]})]})}),B&&F&&p.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-[#0f1a2b] text-white rounded-2xl w-full max-w-md overflow-hidden",children:[p.jsxs("div",{className:"p-4 sm:p-6 flex items-center justify-between",children:[p.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white",children:"Face Enrollment"}),p.jsx("button",{onClick:Rn,className:"text-white/60 hover:text-white",children:p.jsx(Vi,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),p.jsxs("div",{className:"flex items-center justify-between mb-6 sm:mb-8 px-4 sm:px-6",children:[p.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-green-500",children:p.jsx(Lr,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),p.jsx("div",{className:"flex-1 h-1 mx-1 sm:mx-2 bg-gray-700"}),p.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full ${U>=1?"bg-green-500":"bg-gray-700"}`,children:p.jsx(pa,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),p.jsx("div",{className:"flex-1 h-1 mx-1 sm:mx-2 bg-gray-700"}),p.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full ${U>=2?"bg-green-500":"bg-gray-700"}`,children:p.jsx(Lr,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})})]}),p.jsxs("div",{className:"p-4 sm:p-6",children:[U===0&&p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-2xl sm:text-3xl font-bold mx-auto mb-4",children:rn(F.name)}),p.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:F.name}),p.jsx("p",{className:"text-gray-400 mb-1 text-sm sm:text-base",children:F.employee_id}),p.jsx("p",{className:"text-gray-400 mb-4 sm:mb-6 text-sm sm:text-base",children:F.department}),p.jsxs("div",{className:"bg-slate-800 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6 text-left",children:[p.jsx("h4",{className:"text-sm font-semibold text-white mb-2 sm:mb-3",children:"Instructions:"}),p.jsxs("ul",{className:"space-y-1 sm:space-y-2 text-xs sm:text-sm text-gray-300",children:[p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx("span",{className:"text-green-400",children:""}),p.jsx("span",{children:"Position your face in the camera frame"})]}),p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx("span",{className:"text-green-400",children:""}),p.jsx("span",{children:"Look directly at the camera"})]}),p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx("span",{className:"text-green-400",children:""}),p.jsx("span",{children:"Ensure good lighting"})]}),p.jsxs("li",{className:"flex items-start gap-2",children:[p.jsx("span",{className:"text-green-400",children:""}),p.jsx("span",{children:"10 images will be captured automatically"})]})]})]}),p.jsx("button",{onClick:Ir,className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 sm:py-3 rounded-lg font-semibold transition-colors text-sm sm:text-base",children:"Start Capture"})]}),U===1&&p.jsxs("div",{className:"text-center",children:[p.jsxs("div",{className:"relative bg-slate-900 rounded-xl overflow-hidden mb-4",children:[p.jsx("video",{ref:Ne,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-48 sm:h-64 object-cover"}),p.jsx("canvas",{ref:Le,className:"absolute top-0 left-0 w-full h-48 sm:h-64 hidden"})]}),p.jsx("div",{className:"text-slate-200 mb-2 whitespace-pre-line text-sm sm:text-base",children:L||"Capturing your face..."}),p.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2 mb-2",children:p.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all",style:{width:`${de.length/10*100}%`}})}),p.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2 mb-4",children:pe.map((K,Fe)=>p.jsx("img",{src:K,alt:`sample-${Fe}`,className:"w-full h-12 sm:h-16 object-cover rounded border border-slate-700"},Fe))}),p.jsx("p",{className:"text-center text-slate-400 text-xs sm:text-sm",children:"Capturing 10 images automatically..."}),ke&&p.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400",children:[p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-400"}),p.jsx("span",{className:"text-sm",children:"Processing enrollment..."})]})]}),U===2&&p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-green-500 grid place-items-center mx-auto mb-4",children:p.jsx(Lr,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),p.jsx("h4",{className:"text-xl sm:text-2xl font-semibold mb-1",children:"Enrollment Successful!"}),p.jsx("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:"Face has been registered successfully"}),p.jsx("button",{onClick:Rn,className:"w-full bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl py-2 sm:py-3 text-sm sm:text-base",children:"Continue"})]})]})]})}),N&&T&&p.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 text-center",children:[p.jsx("div",{className:"w-14 h-14 rounded-full bg-green-50 flex items-center justify-center mx-auto mb-4",children:p.jsx(Lr,{className:"w-7 h-7 text-green-600"})}),p.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Employee Updated Successfully"}),p.jsxs("p",{className:"text-gray-700 mb-6",children:[p.jsx("span",{className:"font-semibold",children:T.name})," has been updated successfully."]}),p.jsx("div",{className:"flex gap-3",children:p.jsx("button",{onClick:()=>{P(!1),D(null)},className:"flex-1 px-4 py-2.5 rounded-lg font-medium bg-green-600 text-white",children:"Continue"})})]})}),y&&p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:p.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:p.jsx(Tu,{className:"w-6 h-6 text-red-600"})}),p.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Delete Employee"})]}),p.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete ",p.jsx("strong",{children:y.name}),"? This action cannot be undone and will remove all associated data."]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>x(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50",children:"Cancel"}),p.jsx("button",{onClick:tt,className:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700",children:"Delete"})]})]})})})]})]})})},DI=()=>{const[e,t]=M.useState([]),[n,r]=M.useState(!0),[o,a]=M.useState(!1),[i,s]=M.useState(null),[u,l]=M.useState(null),[c,d]=M.useState(null),[f,h]=M.useState(null),[v,y]=M.useState(null),[x,m]=M.useState({show:!1,type:"success",message:""}),[g,b]=M.useState({policyName:"",effectiveFrom:"",effectiveTo:"",includeBreak:!1,breakHours:1,breakMinutes:0,fullDayHours:8,fullDayMinutes:30,halfDayHours:4,halfDayMinutes:30,enableLateTracking:!0,workStartTime:"09:00",lateGracePeriod:15,enableEarlyTracking:!0,workEndTime:"18:00",earlyGracePeriod:15});M.useEffect(()=>{(async()=>{try{const B=await Ae.getPolicies();t(B)}catch(B){console.error("Failed to load policies:",B)}finally{r(!1)}})()},[]);const w=D=>{const B=W=>{if(!W)return"";try{let U;if(W.includes("T")?U=new Date(W):U=new Date(W+"T00:00:00"),isNaN(U.getTime()))return"";const $=U.getFullYear(),F=String(U.getMonth()+1).padStart(2,"0"),O=String(U.getDate()).padStart(2,"0");return`${$}-${F}-${O}`}catch(U){return console.error("Error parsing date:",W,U),""}};s(D),b({policyName:D.name||"",effectiveFrom:B(D.effective_from),effectiveTo:B(D.effective_to),includeBreak:D.include_break||!1,breakHours:D.break_hours||1,breakMinutes:D.break_minutes||0,fullDayHours:D.full_day_hours||8,fullDayMinutes:D.full_day_minutes||30,halfDayHours:D.half_day_hours||4,halfDayMinutes:D.half_day_minutes||30,enableLateTracking:D.enable_late_tracking!==void 0?D.enable_late_tracking:!0,workStartTime:D.work_start_time?D.work_start_time.substring(0,5):"09:00",lateGracePeriod:D.late_grace_period||15,enableEarlyTracking:D.enable_early_tracking!==void 0?D.enable_early_tracking:!0,workEndTime:D.work_end_time?D.work_end_time.substring(0,5):"18:00",earlyGracePeriod:D.early_grace_period||15}),a(!0)},C=()=>{s(null),b({policyName:"",effectiveFrom:"",effectiveTo:"",includeBreak:!1,breakHours:1,breakMinutes:0,fullDayHours:8,fullDayMinutes:30,halfDayHours:4,halfDayMinutes:30,enableLateTracking:!0,workStartTime:"09:00",lateGracePeriod:15,enableEarlyTracking:!0,workEndTime:"18:00",earlyGracePeriod:15}),a(!0)},_=async D=>{D.preventDefault();const B={name:g.policyName,effective_from:g.effectiveFrom?g.effectiveFrom:null,effective_to:g.effectiveTo?g.effectiveTo:null,include_break:g.includeBreak,break_hours:g.breakHours,break_minutes:g.breakMinutes,full_day_hours:g.fullDayHours,full_day_minutes:g.fullDayMinutes,half_day_hours:g.halfDayHours,half_day_minutes:g.halfDayMinutes,enable_late_tracking:g.enableLateTracking,work_start_time:g.workStartTime,late_grace_period:g.lateGracePeriod,enable_early_tracking:g.enableEarlyTracking,work_end_time:g.workEndTime,early_grace_period:g.earlyGracePeriod};try{if(i){const W=await Ae.updatePolicy(i.id,B);t(e.map(U=>U.id===i.id?W:U)),m({show:!0,type:"success",message:"Policy updated successfully!"})}else{const W=await Ae.createPolicy(B);t([...e,W]),m({show:!0,type:"success",message:"Policy created successfully!"})}setTimeout(()=>m({show:!1,type:"success",message:""}),3e3),a(!1)}catch(W){console.error("Failed to save policy:",W),m({show:!0,type:"error",message:"Failed to save policy. Please try again."}),setTimeout(()=>m({show:!1,type:"error",message:""}),3e3)}},E=D=>{d(D)},k=async()=>{try{const D=await Ae.togglePolicyStatus(c.id);t(e.map(B=>B.id===c.id?D.policy:B)),d(null),m({show:!0,type:"success",message:D.message||"Policy status updated successfully!"}),setTimeout(()=>m({show:!1,type:"success",message:""}),3e3)}catch(D){console.error("Failed to toggle policy status:",D);const B=D.error||"Failed to update policy status. Please try again.";m({show:!0,type:"error",message:B}),setTimeout(()=>m({show:!1,type:"error",message:""}),3e3),d(null)}},R=async()=>{var D,B,W,U;if(!u.id){m({show:!0,type:"error",message:"Invalid policy selected. Please try again."}),setTimeout(()=>m({show:!1,type:"error",message:""}),3e3),l(null);return}try{await Ae.deletePolicy(u.id),t(e.filter($=>$.id!==u.id)),l(null),m({show:!0,type:"success",message:"Policy deleted successfully!"}),setTimeout(()=>m({show:!1,type:"success",message:""}),3e3)}catch($){if(console.error("Failed to delete policy:",$),$.response&&$.response.status===422&&$.response.data.error)y($.response.data),l(null);else{const F=((B=(D=$.response)==null?void 0:D.data)==null?void 0:B.message)||((U=(W=$.response)==null?void 0:W.data)==null?void 0:U.error)||"Failed to delete policy. Please try again.";m({show:!0,type:"error",message:F}),setTimeout(()=>m({show:!1,type:"error",message:""}),3e3)}}},N=D=>{h(D)},P=async()=>{if(!f){m({show:!0,type:"error",message:"Invalid policy selected. Please try again."}),setTimeout(()=>m({show:!1,type:"error",message:""}),3e3),h(null);return}const D=f,B={name:`Copy of ${D.name}`,effective_from:D.effective_from,effective_to:D.effective_to,include_break:D.include_break,break_hours:D.break_hours,break_minutes:D.break_minutes,full_day_hours:D.full_day_hours,full_day_minutes:D.full_day_minutes,half_day_hours:D.half_day_hours,half_day_minutes:D.half_day_minutes,enable_late_tracking:D.enable_late_tracking,work_start_time:D.work_start_time?D.work_start_time.substring(0,5):"09:00",late_grace_period:D.late_grace_period,enable_early_tracking:D.enable_early_tracking,work_end_time:D.work_end_time?D.work_end_time.substring(0,5):"18:00",early_grace_period:D.early_grace_period,enable_absence_tracking:D.enable_absence_tracking};try{const W=await Ae.createPolicy(B);t([...e,W]),m({show:!0,type:"success",message:"Policy copied successfully!"}),setTimeout(()=>m({show:!1,type:"success",message:""}),3e3),h(null)}catch(W){console.error("Failed to copy policy:",W),m({show:!0,type:"error",message:"Failed to copy policy. Please try again."}),setTimeout(()=>m({show:!1,type:"error",message:""}),3e3),h(null)}},T=D=>D?D.substring(0,5):"-";return n?p.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):p.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8",children:p.jsxs("div",{className:"max-w-7xl mx-auto",children:[p.jsx("div",{className:"mb-8",children:p.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Policy Management"}),p.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure attendance policies"})]}),p.jsxs("button",{onClick:C,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 md:px-6 py-2 md:py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-colors text-sm md:text-base",children:[p.jsx(iy,{className:"w-5 h-5"}),p.jsx("span",{children:"Create Policy"})]})]})}),x.show&&p.jsxs("div",{className:`mb-6 p-4 border rounded-lg flex items-center shadow-sm ${x.type==="success"?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:[x.type==="success"?p.jsx(Lr,{className:"w-5 h-5 mr-3 flex-shrink-0"}):p.jsx(rh,{className:"w-5 h-5 mr-3 flex-shrink-0"}),p.jsx("span",{className:"font-medium",children:x.message})]}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:e.map((D,B)=>p.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow",children:[p.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-200",children:[p.jsxs("div",{className:"flex items-start justify-between mb-3",children:[p.jsx("h3",{className:"text-lg font-bold text-gray-900",children:D.name}),p.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${D.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:D.status==="active"?"Active":"Inactive"})]}),p.jsxs("p",{className:"text-sm text-gray-600",children:[D.employees_count||0," employees assigned"]})]}),p.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(Fn,{className:"w-5 h-5 text-blue-600"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-xs text-gray-600",children:"Work Hours"}),p.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[T(D.work_start_time)," - ",T(D.work_end_time)]})]})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx($i,{className:"w-5 h-5 text-green-600"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-xs text-gray-600",children:"Full Day / Half Day"}),p.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[D.full_day_hours,".",D.full_day_minutes," hrs / ",D.half_day_hours,".",D.half_day_minutes," hrs"]})]})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx(CC,{className:"w-5 h-5 text-orange-600"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-xs text-gray-600",children:"Break Duration"}),p.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[D.break_hours,".",D.break_minutes," hr ",D.include_break?"(Included)":"(Excluded)"]})]})]})]}),p.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-200 flex gap-2",children:[p.jsxs("button",{onClick:()=>w(D),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors flex items-center justify-center gap-2",children:[p.jsx($C,{className:"w-4 h-4"}),"Edit"]}),p.jsx("button",{onClick:()=>N(D),className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",title:"Copy",children:p.jsx(Dm,{className:"w-4 h-4"})}),p.jsx("button",{onClick:()=>E(D),className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",title:D.status==="active"?"Deactivate":"Activate",children:p.jsx(Rm,{className:"w-4 h-4"})})]})]},D.id||`policy-${B}`))}),e.length===0&&p.jsxs("div",{className:"text-center py-12 text-gray-500",children:[p.jsx("p",{className:"text-lg",children:"No policies found"}),p.jsx("p",{className:"text-sm mt-2",children:"Create your first policy to get started"})]}),o&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[p.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 md:p-6 flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:i?"Edit Policy":"Create Policy"}),p.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:i?i.name:"New Policy"})]}),p.jsx("button",{onClick:()=>a(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:p.jsx(Vi,{className:"w-5 h-5"})})]}),p.jsx("div",{className:"overflow-y-auto max-h-[60vh] p-6",children:p.jsxs("form",{onSubmit:_,className:"space-y-6",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"policyName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Policy Name"}),p.jsx("input",{id:"policyName",type:"text",placeholder:"e.g., Standard Office Policy",value:g.policyName,onChange:D=>b({...g,policyName:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Effective From"}),p.jsx("input",{type:"date",value:g.effectiveFrom,onChange:D=>b({...g,effectiveFrom:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Effective To"}),p.jsx("input",{type:"date",value:g.effectiveTo,onChange:D=>b({...g,effectiveTo:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),p.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[p.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[p.jsx(Fn,{className:"w-5 h-5 text-blue-600"}),"Work Duration Settings"]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("input",{type:"checkbox",id:"breakHandlingEdit",checked:g.includeBreak,onChange:D=>b({...g,includeBreak:D.target.checked}),className:"w-4 h-4 text-blue-600"}),p.jsx("label",{htmlFor:"breakHandlingEdit",className:"text-sm font-medium text-gray-700",children:"Include break time in work duration calculation"})]}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Duration (Hours)"}),p.jsx("input",{type:"number",step:"0.5",placeholder:"1.0",value:g.breakHours,onChange:D=>b({...g,breakHours:parseFloat(D.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Duration (Minutes)"}),p.jsx("input",{type:"number",step:"15",placeholder:"0",value:g.breakMinutes,onChange:D=>b({...g,breakMinutes:parseInt(D.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]}),p.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[p.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[p.jsx($i,{className:"w-5 h-5 text-green-600"}),"Attendance Classification"]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Day Minimum Hours"}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsx("input",{type:"number",placeholder:"8",value:g.fullDayHours,onChange:D=>b({...g,fullDayHours:parseInt(D.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),p.jsx("input",{type:"number",placeholder:"30",value:g.fullDayMinutes,onChange:D=>b({...g,fullDayMinutes:parseInt(D.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours and Minutes"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Half Day Minimum Hours"}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsx("input",{type:"number",placeholder:"4",value:g.halfDayHours,onChange:D=>b({...g,halfDayHours:parseInt(D.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),p.jsx("input",{type:"number",placeholder:"30",value:g.halfDayMinutes,onChange:D=>b({...g,halfDayMinutes:parseInt(D.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours and Minutes"})]})]})]}),p.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[p.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[p.jsx(oo,{className:"w-5 h-5 text-orange-600"}),"Late Arrival Tracking"]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("input",{type:"checkbox",id:"enableLateEdit",checked:g.enableLateTracking,onChange:D=>b({...g,enableLateTracking:D.target.checked}),className:"w-4 h-4 text-blue-600"}),p.jsx("label",{htmlFor:"enableLateEdit",className:"text-sm font-medium text-gray-700",children:"Enable late arrival tracking"})]}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Work Start Time"}),p.jsx("input",{type:"time",value:g.workStartTime,onChange:D=>b({...g,workStartTime:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grace Period (minutes)"}),p.jsx("input",{type:"number",placeholder:"15",value:g.lateGracePeriod,onChange:D=>b({...g,lateGracePeriod:parseInt(D.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]}),p.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[p.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[p.jsx(oo,{className:"w-5 h-5 text-red-600"}),"Early Departure Tracking"]}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("input",{type:"checkbox",id:"enableEarlyEdit",checked:g.enableEarlyTracking,onChange:D=>b({...g,enableEarlyTracking:D.target.checked}),className:"w-4 h-4 text-blue-600"}),p.jsx("label",{htmlFor:"enableEarlyEdit",className:"text-sm font-medium text-gray-700",children:"Enable early departure tracking"})]}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Work End Time"}),p.jsx("input",{type:"time",value:g.workEndTime,onChange:D=>b({...g,workEndTime:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grace Period (minutes)"}),p.jsx("input",{type:"number",placeholder:"15",value:g.earlyGracePeriod,onChange:D=>b({...g,earlyGracePeriod:parseInt(D.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]})]})}),p.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-4 md:p-6 flex gap-3",children:[p.jsx("button",{type:"button",onClick:()=>a(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),p.jsx("button",{type:"submit",onClick:_,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:i?"Update Policy":"Create Policy"})]})]})}),u&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:p.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:p.jsx(Tu,{className:"w-6 h-6 text-red-600"})}),p.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Delete Policy"})]}),p.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete ",p.jsx("strong",{children:u.name}),"? This action cannot be undone."]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>l(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),p.jsx("button",{onClick:R,className:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors",children:"Delete"})]})]})})}),v&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:p.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[80vh] overflow-y-auto",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:p.jsx(Tu,{className:"w-6 h-6 text-red-600"})}),p.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cannot Delete Policy"})]}),p.jsx("p",{className:"text-red-600 mb-4 font-medium",children:v.error}),p.jsx("p",{className:"text-gray-600 mb-6",children:"The following employees are currently assigned to this policy:"}),p.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 max-h-48 overflow-y-auto",children:p.jsx("ul",{className:"space-y-2",children:v.assigned_employees.map((D,B)=>p.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[p.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full flex-shrink-0"}),p.jsx("span",{className:"font-medium",children:D.employee_id}),p.jsxs("span",{className:"text-gray-600",children:["- ",D.name]})]},B))})}),p.jsx("div",{className:"flex gap-3",children:p.jsx("button",{onClick:()=>y(null),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"OK"})})]})})}),c&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:p.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center",children:p.jsx(Rm,{className:"w-6 h-6 text-orange-600"})}),p.jsx("h2",{className:"text-xl font-bold text-gray-900",children:c.status==="active"?"Deactivate Policy":"Activate Policy"})]}),p.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to ",c.status==="active"?"deactivate":"activate"," ",p.jsx("strong",{children:c.name}),"?"]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>d(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),p.jsx("button",{onClick:k,className:"flex-1 px-4 py-2.5 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition-colors",children:c.status==="active"?"Deactivate":"Activate"})]})]})})}),f&&p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:p.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:p.jsx(Dm,{className:"w-6 h-6 text-blue-600"})}),p.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Copy Policy"})]}),p.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to copy ",p.jsx("strong",{children:f.name}),"?"]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:()=>h(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),p.jsx("button",{onClick:P,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Copy"})]})]})})})]})})};function TI({cleanupRef:e}){const t=ho();return M.useEffect(()=>{e.current&&typeof e.current=="function"&&(e.current(),e.current=null)},[t,e]),null}function AI(){const e=M.useRef(null);return p.jsxs(eC,{children:[p.jsx(TI,{cleanupRef:e}),p.jsxs(q2,{children:[p.jsx(Pr,{path:"/login",element:p.jsx(RI,{})}),p.jsx(Pr,{path:"/",element:p.jsx(Fv,{registerCleanup:t=>e.current=t})}),p.jsx(Pr,{path:"/attendance",element:p.jsx(Fv,{registerCleanup:t=>e.current=t})}),p.jsx(Pr,{path:"/dashboard",element:p.jsx(Ds,{children:p.jsx(NI,{})})}),p.jsx(Pr,{path:"/policies",element:p.jsx(Ds,{children:p.jsx(DI,{})})}),p.jsx(Pr,{path:"/employees",element:p.jsx(Ds,{children:p.jsx(II,{registerCleanup:t=>e.current=t})})}),p.jsx(Pr,{path:"/reports",element:p.jsx(Ds,{children:p.jsx(SI,{})})})]})]})}const PI=Mc.createRoot(document.getElementById("root"));PI.render(p.jsx(Hv.StrictMode,{children:p.jsx(AI,{})}))});export default FI();
