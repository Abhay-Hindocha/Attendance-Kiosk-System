var s1=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var rI=s1((sI,n1)=>{function o1(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const s=Object.getOwnPropertyDescriptor(r,a);s&&Object.defineProperty(e,a,s.get?s:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();function i1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var dv={exports:{}},Nc={},hv={exports:{}},Fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vi=Symbol.for("react.element"),l1=Symbol.for("react.portal"),c1=Symbol.for("react.fragment"),u1=Symbol.for("react.strict_mode"),d1=Symbol.for("react.profiler"),h1=Symbol.for("react.provider"),f1=Symbol.for("react.context"),p1=Symbol.for("react.forward_ref"),m1=Symbol.for("react.suspense"),g1=Symbol.for("react.memo"),v1=Symbol.for("react.lazy"),Mp=Symbol.iterator;function x1(e){return e===null||typeof e!="object"?null:(e=Mp&&e[Mp]||e["@@iterator"],typeof e=="function"?e:null)}var fv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pv=Object.assign,mv={};function Zs(e,t,n){this.props=e,this.context=t,this.refs=mv,this.updater=n||fv}Zs.prototype.isReactComponent={};Zs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Zs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function gv(){}gv.prototype=Zs.prototype;function Eh(e,t,n){this.props=e,this.context=t,this.refs=mv,this.updater=n||fv}var Rh=Eh.prototype=new gv;Rh.constructor=Eh;pv(Rh,Zs.prototype);Rh.isPureReactComponent=!0;var Op=Array.isArray,vv=Object.prototype.hasOwnProperty,Dh={current:null},xv={key:!0,ref:!0,__self:!0,__source:!0};function yv(e,t,n){var r,a={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)vv.call(t,r)&&!xv.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:vi,type:e,key:s,ref:o,props:a,_owner:Dh.current}}function y1(e,t){return{$$typeof:vi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Ih(e){return typeof e=="object"&&e!==null&&e.$$typeof===vi}function b1(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Lp=/\/+/g;function tu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?b1(""+e.key):t.toString(36)}function hl(e,t,n,r,a){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case vi:case l1:o=!0}}if(o)return o=e,a=a(o),e=r===""?"."+tu(o,0):r,Op(a)?(n="",e!=null&&(n=e.replace(Lp,"$&/")+"/"),hl(a,t,n,"",function(u){return u})):a!=null&&(Ih(a)&&(a=y1(a,n+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(Lp,"$&/")+"/")+e)),t.push(a)),1;if(o=0,r=r===""?".":r+":",Op(e))for(var l=0;l<e.length;l++){s=e[l];var c=r+tu(s,l);o+=hl(s,t,n,c,a)}else if(c=x1(e),typeof c=="function")for(e=c.call(e),l=0;!(s=e.next()).done;)s=s.value,c=r+tu(s,l++),o+=hl(s,t,n,c,a);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Ai(e,t,n){if(e==null)return e;var r=[],a=0;return hl(e,r,"","",function(s){return t.call(n,s,a++)}),r}function w1(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Zt={current:null},fl={transition:null},N1={ReactCurrentDispatcher:Zt,ReactCurrentBatchConfig:fl,ReactCurrentOwner:Dh};function bv(){throw Error("act(...) is not supported in production builds of React.")}Fe.Children={map:Ai,forEach:function(e,t,n){Ai(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ai(e,function(){t++}),t},toArray:function(e){return Ai(e,function(t){return t})||[]},only:function(e){if(!Ih(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Fe.Component=Zs;Fe.Fragment=c1;Fe.Profiler=d1;Fe.PureComponent=Eh;Fe.StrictMode=u1;Fe.Suspense=m1;Fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N1;Fe.act=bv;Fe.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=pv({},e.props),a=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=Dh.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)vv.call(t,c)&&!xv.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:vi,type:e.type,key:a,ref:s,props:r,_owner:o}};Fe.createContext=function(e){return e={$$typeof:f1,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:h1,_context:e},e.Consumer=e};Fe.createElement=yv;Fe.createFactory=function(e){var t=yv.bind(null,e);return t.type=e,t};Fe.createRef=function(){return{current:null}};Fe.forwardRef=function(e){return{$$typeof:p1,render:e}};Fe.isValidElement=Ih;Fe.lazy=function(e){return{$$typeof:v1,_payload:{_status:-1,_result:e},_init:w1}};Fe.memo=function(e,t){return{$$typeof:g1,type:e,compare:t===void 0?null:t}};Fe.startTransition=function(e){var t=fl.transition;fl.transition={};try{e()}finally{fl.transition=t}};Fe.unstable_act=bv;Fe.useCallback=function(e,t){return Zt.current.useCallback(e,t)};Fe.useContext=function(e){return Zt.current.useContext(e)};Fe.useDebugValue=function(){};Fe.useDeferredValue=function(e){return Zt.current.useDeferredValue(e)};Fe.useEffect=function(e,t){return Zt.current.useEffect(e,t)};Fe.useId=function(){return Zt.current.useId()};Fe.useImperativeHandle=function(e,t,n){return Zt.current.useImperativeHandle(e,t,n)};Fe.useInsertionEffect=function(e,t){return Zt.current.useInsertionEffect(e,t)};Fe.useLayoutEffect=function(e,t){return Zt.current.useLayoutEffect(e,t)};Fe.useMemo=function(e,t){return Zt.current.useMemo(e,t)};Fe.useReducer=function(e,t,n){return Zt.current.useReducer(e,t,n)};Fe.useRef=function(e){return Zt.current.useRef(e)};Fe.useState=function(e){return Zt.current.useState(e)};Fe.useSyncExternalStore=function(e,t,n){return Zt.current.useSyncExternalStore(e,t,n)};Fe.useTransition=function(){return Zt.current.useTransition()};Fe.version="18.3.1";hv.exports=Fe;var E=hv.exports;const Cs=i1(E),_1=o1({__proto__:null,default:Cs},[E]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j1=E,k1=Symbol.for("react.element"),C1=Symbol.for("react.fragment"),S1=Object.prototype.hasOwnProperty,E1=j1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,R1={key:!0,ref:!0,__self:!0,__source:!0};function wv(e,t,n){var r,a={},s=null,o=null;n!==void 0&&(s=""+n),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)S1.call(t,r)&&!R1.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:k1,type:e,key:s,ref:o,props:a,_owner:E1.current}}Nc.Fragment=C1;Nc.jsx=wv;Nc.jsxs=wv;dv.exports=Nc;var i=dv.exports,sd={},Nv={exports:{}},jn={},_v={exports:{}},jv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(P,$){var I=P.length;P.push($);e:for(;0<I;){var q=I-1>>>1,X=P[q];if(0<a(X,$))P[q]=$,P[I]=X,I=q;else break e}}function n(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var $=P[0],I=P.pop();if(I!==$){P[0]=I;e:for(var q=0,X=P.length,ne=X>>>1;q<ne;){var ie=2*(q+1)-1,le=P[ie],pe=ie+1,_e=P[pe];if(0>a(le,I))pe<X&&0>a(_e,le)?(P[q]=_e,P[pe]=I,q=pe):(P[q]=le,P[ie]=I,q=ie);else if(pe<X&&0>a(_e,I))P[q]=_e,P[pe]=I,q=pe;else break e}}return $}function a(P,$){var I=P.sortIndex-$.sortIndex;return I!==0?I:P.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,m=!1,x=!1,y=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(P){for(var $=n(u);$!==null;){if($.callback===null)r(u);else if($.startTime<=P)r(u),$.sortIndex=$.expirationTime,t(c,$);else break;$=n(u)}}function b(P){if(x=!1,w(P),!m)if(n(c)!==null)m=!0,U(N);else{var $=n(u);$!==null&&V(b,$.startTime-P)}}function N(P,$){m=!1,x&&(x=!1,g(k),k=-1),p=!0;var I=f;try{for(w($),h=n(c);h!==null&&(!(h.expirationTime>$)||P&&!M());){var q=h.callback;if(typeof q=="function"){h.callback=null,f=h.priorityLevel;var X=q(h.expirationTime<=$);$=e.unstable_now(),typeof X=="function"?h.callback=X:h===n(c)&&r(c),w($)}else r(c);h=n(c)}if(h!==null)var ne=!0;else{var ie=n(u);ie!==null&&V(b,ie.startTime-$),ne=!1}return ne}finally{h=null,f=I,p=!1}}var _=!1,C=null,k=-1,j=5,S=-1;function M(){return!(e.unstable_now()-S<j)}function D(){if(C!==null){var P=e.unstable_now();S=P;var $=!0;try{$=C(!0,P)}finally{$?A():(_=!1,C=null)}}else _=!1}var A;if(typeof v=="function")A=function(){v(D)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,F=B.port2;B.port1.onmessage=D,A=function(){F.postMessage(null)}}else A=function(){y(D,0)};function U(P){C=P,_||(_=!0,A())}function V(P,$){k=y(function(){P(e.unstable_now())},$)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,U(N))},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(P){switch(f){case 1:case 2:case 3:var $=3;break;default:$=f}var I=f;f=$;try{return P()}finally{f=I}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(P,$){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var I=f;f=P;try{return $()}finally{f=I}},e.unstable_scheduleCallback=function(P,$,I){var q=e.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?q+I:q):I=q,P){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=I+X,P={id:d++,callback:$,priorityLevel:P,startTime:I,expirationTime:X,sortIndex:-1},I>q?(P.sortIndex=I,t(u,P),n(c)===null&&P===n(u)&&(x?(g(k),k=-1):x=!0,V(b,I-q))):(P.sortIndex=X,t(c,P),m||p||(m=!0,U(N))),P},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(P){var $=f;return function(){var I=f;f=$;try{return P.apply(this,arguments)}finally{f=I}}}})(jv);_v.exports=jv;var D1=_v.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I1=E,_n=D1;function se(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kv=new Set,$o={};function Ya(e,t){Ws(e,t),Ws(e+"Capture",t)}function Ws(e,t){for($o[e]=t,e=0;e<t.length;e++)kv.add(t[e])}var Er=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),od=Object.prototype.hasOwnProperty,A1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Bp={},$p={};function T1(e){return od.call($p,e)?!0:od.call(Bp,e)?!1:A1.test(e)?$p[e]=!0:(Bp[e]=!0,!1)}function P1(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function F1(e,t,n,r){if(t===null||typeof t>"u"||P1(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function en(e,t,n,r,a,s,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var $t={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){$t[e]=new en(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];$t[t]=new en(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){$t[e]=new en(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){$t[e]=new en(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){$t[e]=new en(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){$t[e]=new en(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){$t[e]=new en(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){$t[e]=new en(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){$t[e]=new en(e,5,!1,e.toLowerCase(),null,!1,!1)});var Ah=/[\-:]([a-z])/g;function Th(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Ah,Th);$t[t]=new en(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Ah,Th);$t[t]=new en(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Ah,Th);$t[t]=new en(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){$t[e]=new en(e,1,!1,e.toLowerCase(),null,!1,!1)});$t.xlinkHref=new en("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){$t[e]=new en(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ph(e,t,n,r){var a=$t.hasOwnProperty(t)?$t[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(F1(t,n,a,r)&&(n=null),r||a===null?T1(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Ar=I1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ti=Symbol.for("react.element"),fs=Symbol.for("react.portal"),ps=Symbol.for("react.fragment"),Fh=Symbol.for("react.strict_mode"),id=Symbol.for("react.profiler"),Cv=Symbol.for("react.provider"),Sv=Symbol.for("react.context"),Mh=Symbol.for("react.forward_ref"),ld=Symbol.for("react.suspense"),cd=Symbol.for("react.suspense_list"),Oh=Symbol.for("react.memo"),qr=Symbol.for("react.lazy"),Ev=Symbol.for("react.offscreen"),Wp=Symbol.iterator;function co(e){return e===null||typeof e!="object"?null:(e=Wp&&e[Wp]||e["@@iterator"],typeof e=="function"?e:null)}var ot=Object.assign,nu;function _o(e){if(nu===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);nu=t&&t[1]||""}return`
`+nu+e}var ru=!1;function au(e,t){if(!e||ru)return"";ru=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),s=r.stack.split(`
`),o=a.length-1,l=s.length-1;1<=o&&0<=l&&a[o]!==s[l];)l--;for(;1<=o&&0<=l;o--,l--)if(a[o]!==s[l]){if(o!==1||l!==1)do if(o--,l--,0>l||a[o]!==s[l]){var c=`
`+a[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=l);break}}}finally{ru=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?_o(e):""}function M1(e){switch(e.tag){case 5:return _o(e.type);case 16:return _o("Lazy");case 13:return _o("Suspense");case 19:return _o("SuspenseList");case 0:case 2:case 15:return e=au(e.type,!1),e;case 11:return e=au(e.type.render,!1),e;case 1:return e=au(e.type,!0),e;default:return""}}function ud(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ps:return"Fragment";case fs:return"Portal";case id:return"Profiler";case Fh:return"StrictMode";case ld:return"Suspense";case cd:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Sv:return(e.displayName||"Context")+".Consumer";case Cv:return(e._context.displayName||"Context")+".Provider";case Mh:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Oh:return t=e.displayName||null,t!==null?t:ud(e.type)||"Memo";case qr:t=e._payload,e=e._init;try{return ud(e(t))}catch{}}return null}function O1(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ud(t);case 8:return t===Fh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function fa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Rv(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function L1(e){var t=Rv(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Pi(e){e._valueTracker||(e._valueTracker=L1(e))}function Dv(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Rv(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Cl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function dd(e,t){var n=t.checked;return ot({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function zp(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=fa(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Iv(e,t){t=t.checked,t!=null&&Ph(e,"checked",t,!1)}function hd(e,t){Iv(e,t);var n=fa(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?fd(e,t.type,n):t.hasOwnProperty("defaultValue")&&fd(e,t.type,fa(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Up(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function fd(e,t,n){(t!=="number"||Cl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var jo=Array.isArray;function Ss(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+fa(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function pd(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(se(91));return ot({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Vp(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(se(92));if(jo(n)){if(1<n.length)throw Error(se(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:fa(n)}}function Av(e,t){var n=fa(t.value),r=fa(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function qp(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Tv(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function md(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Tv(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Fi,Pv=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Fi=Fi||document.createElement("div"),Fi.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Fi.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Wo(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var So={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},B1=["Webkit","ms","Moz","O"];Object.keys(So).forEach(function(e){B1.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),So[t]=So[e]})});function Fv(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||So.hasOwnProperty(e)&&So[e]?(""+t).trim():t+"px"}function Mv(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=Fv(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var $1=ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gd(e,t){if(t){if($1[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(se(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(se(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(se(61))}if(t.style!=null&&typeof t.style!="object")throw Error(se(62))}}function vd(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xd=null;function Lh(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yd=null,Es=null,Rs=null;function Hp(e){if(e=bi(e)){if(typeof yd!="function")throw Error(se(280));var t=e.stateNode;t&&(t=Sc(t),yd(e.stateNode,e.type,t))}}function Ov(e){Es?Rs?Rs.push(e):Rs=[e]:Es=e}function Lv(){if(Es){var e=Es,t=Rs;if(Rs=Es=null,Hp(e),t)for(e=0;e<t.length;e++)Hp(t[e])}}function Bv(e,t){return e(t)}function $v(){}var su=!1;function Wv(e,t,n){if(su)return e(t,n);su=!0;try{return Bv(e,t,n)}finally{su=!1,(Es!==null||Rs!==null)&&($v(),Lv())}}function zo(e,t){var n=e.stateNode;if(n===null)return null;var r=Sc(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(se(231,t,typeof n));return n}var bd=!1;if(Er)try{var uo={};Object.defineProperty(uo,"passive",{get:function(){bd=!0}}),window.addEventListener("test",uo,uo),window.removeEventListener("test",uo,uo)}catch{bd=!1}function W1(e,t,n,r,a,s,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(d){this.onError(d)}}var Eo=!1,Sl=null,El=!1,wd=null,z1={onError:function(e){Eo=!0,Sl=e}};function U1(e,t,n,r,a,s,o,l,c){Eo=!1,Sl=null,W1.apply(z1,arguments)}function V1(e,t,n,r,a,s,o,l,c){if(U1.apply(this,arguments),Eo){if(Eo){var u=Sl;Eo=!1,Sl=null}else throw Error(se(198));El||(El=!0,wd=u)}}function Qa(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function zv(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Gp(e){if(Qa(e)!==e)throw Error(se(188))}function q1(e){var t=e.alternate;if(!t){if(t=Qa(e),t===null)throw Error(se(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var s=a.alternate;if(s===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===n)return Gp(a),e;if(s===r)return Gp(a),t;s=s.sibling}throw Error(se(188))}if(n.return!==r.return)n=a,r=s;else{for(var o=!1,l=a.child;l;){if(l===n){o=!0,n=a,r=s;break}if(l===r){o=!0,r=a,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=a;break}if(l===r){o=!0,r=s,n=a;break}l=l.sibling}if(!o)throw Error(se(189))}}if(n.alternate!==r)throw Error(se(190))}if(n.tag!==3)throw Error(se(188));return n.stateNode.current===n?e:t}function Uv(e){return e=q1(e),e!==null?Vv(e):null}function Vv(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Vv(e);if(t!==null)return t;e=e.sibling}return null}var qv=_n.unstable_scheduleCallback,Kp=_n.unstable_cancelCallback,H1=_n.unstable_shouldYield,G1=_n.unstable_requestPaint,ht=_n.unstable_now,K1=_n.unstable_getCurrentPriorityLevel,Bh=_n.unstable_ImmediatePriority,Hv=_n.unstable_UserBlockingPriority,Rl=_n.unstable_NormalPriority,X1=_n.unstable_LowPriority,Gv=_n.unstable_IdlePriority,_c=null,cr=null;function Y1(e){if(cr&&typeof cr.onCommitFiberRoot=="function")try{cr.onCommitFiberRoot(_c,e,void 0,(e.current.flags&128)===128)}catch{}}var Hn=Math.clz32?Math.clz32:Z1,Q1=Math.log,J1=Math.LN2;function Z1(e){return e>>>=0,e===0?32:31-(Q1(e)/J1|0)|0}var Mi=64,Oi=4194304;function ko(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Dl(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,s=e.pingedLanes,o=n&268435455;if(o!==0){var l=o&~a;l!==0?r=ko(l):(s&=o,s!==0&&(r=ko(s)))}else o=n&~a,o!==0?r=ko(o):s!==0&&(r=ko(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,s=t&-t,a>=s||a===16&&(s&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Hn(t),a=1<<n,r|=e[n],t&=~a;return r}function ew(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tw(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-Hn(s),l=1<<o,c=a[o];c===-1?(!(l&n)||l&r)&&(a[o]=ew(l,t)):c<=t&&(e.expiredLanes|=l),s&=~l}}function Nd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Kv(){var e=Mi;return Mi<<=1,!(Mi&4194240)&&(Mi=64),e}function ou(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function xi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Hn(t),e[t]=n}function nw(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-Hn(n),s=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~s}}function $h(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Hn(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var Ve=0;function Xv(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Yv,Wh,Qv,Jv,Zv,_d=!1,Li=[],ea=null,ta=null,na=null,Uo=new Map,Vo=new Map,Gr=[],rw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xp(e,t){switch(e){case"focusin":case"focusout":ea=null;break;case"dragenter":case"dragleave":ta=null;break;case"mouseover":case"mouseout":na=null;break;case"pointerover":case"pointerout":Uo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vo.delete(t.pointerId)}}function ho(e,t,n,r,a,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[a]},t!==null&&(t=bi(t),t!==null&&Wh(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function aw(e,t,n,r,a){switch(t){case"focusin":return ea=ho(ea,e,t,n,r,a),!0;case"dragenter":return ta=ho(ta,e,t,n,r,a),!0;case"mouseover":return na=ho(na,e,t,n,r,a),!0;case"pointerover":var s=a.pointerId;return Uo.set(s,ho(Uo.get(s)||null,e,t,n,r,a)),!0;case"gotpointercapture":return s=a.pointerId,Vo.set(s,ho(Vo.get(s)||null,e,t,n,r,a)),!0}return!1}function ex(e){var t=Aa(e.target);if(t!==null){var n=Qa(t);if(n!==null){if(t=n.tag,t===13){if(t=zv(n),t!==null){e.blockedOn=t,Zv(e.priority,function(){Qv(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=jd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);xd=r,n.target.dispatchEvent(r),xd=null}else return t=bi(n),t!==null&&Wh(t),e.blockedOn=n,!1;t.shift()}return!0}function Yp(e,t,n){pl(e)&&n.delete(t)}function sw(){_d=!1,ea!==null&&pl(ea)&&(ea=null),ta!==null&&pl(ta)&&(ta=null),na!==null&&pl(na)&&(na=null),Uo.forEach(Yp),Vo.forEach(Yp)}function fo(e,t){e.blockedOn===t&&(e.blockedOn=null,_d||(_d=!0,_n.unstable_scheduleCallback(_n.unstable_NormalPriority,sw)))}function qo(e){function t(a){return fo(a,e)}if(0<Li.length){fo(Li[0],e);for(var n=1;n<Li.length;n++){var r=Li[n];r.blockedOn===e&&(r.blockedOn=null)}}for(ea!==null&&fo(ea,e),ta!==null&&fo(ta,e),na!==null&&fo(na,e),Uo.forEach(t),Vo.forEach(t),n=0;n<Gr.length;n++)r=Gr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Gr.length&&(n=Gr[0],n.blockedOn===null);)ex(n),n.blockedOn===null&&Gr.shift()}var Ds=Ar.ReactCurrentBatchConfig,Il=!0;function ow(e,t,n,r){var a=Ve,s=Ds.transition;Ds.transition=null;try{Ve=1,zh(e,t,n,r)}finally{Ve=a,Ds.transition=s}}function iw(e,t,n,r){var a=Ve,s=Ds.transition;Ds.transition=null;try{Ve=4,zh(e,t,n,r)}finally{Ve=a,Ds.transition=s}}function zh(e,t,n,r){if(Il){var a=jd(e,t,n,r);if(a===null)gu(e,t,r,Al,n),Xp(e,r);else if(aw(a,e,t,n,r))r.stopPropagation();else if(Xp(e,r),t&4&&-1<rw.indexOf(e)){for(;a!==null;){var s=bi(a);if(s!==null&&Yv(s),s=jd(e,t,n,r),s===null&&gu(e,t,r,Al,n),s===a)break;a=s}a!==null&&r.stopPropagation()}else gu(e,t,r,null,n)}}var Al=null;function jd(e,t,n,r){if(Al=null,e=Lh(r),e=Aa(e),e!==null)if(t=Qa(e),t===null)e=null;else if(n=t.tag,n===13){if(e=zv(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Al=e,null}function tx(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(K1()){case Bh:return 1;case Hv:return 4;case Rl:case X1:return 16;case Gv:return 536870912;default:return 16}default:return 16}}var Xr=null,Uh=null,ml=null;function nx(){if(ml)return ml;var e,t=Uh,n=t.length,r,a="value"in Xr?Xr.value:Xr.textContent,s=a.length;for(e=0;e<n&&t[e]===a[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===a[s-r];r++);return ml=a.slice(e,1<r?1-r:void 0)}function gl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Bi(){return!0}function Qp(){return!1}function kn(e){function t(n,r,a,s,o){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(s):s[l]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Bi:Qp,this.isPropagationStopped=Qp,this}return ot(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Bi)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Bi)},persist:function(){},isPersistent:Bi}),t}var eo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vh=kn(eo),yi=ot({},eo,{view:0,detail:0}),lw=kn(yi),iu,lu,po,jc=ot({},yi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qh,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==po&&(po&&e.type==="mousemove"?(iu=e.screenX-po.screenX,lu=e.screenY-po.screenY):lu=iu=0,po=e),iu)},movementY:function(e){return"movementY"in e?e.movementY:lu}}),Jp=kn(jc),cw=ot({},jc,{dataTransfer:0}),uw=kn(cw),dw=ot({},yi,{relatedTarget:0}),cu=kn(dw),hw=ot({},eo,{animationName:0,elapsedTime:0,pseudoElement:0}),fw=kn(hw),pw=ot({},eo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),mw=kn(pw),gw=ot({},eo,{data:0}),Zp=kn(gw),vw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bw(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=yw[e])?!!t[e]:!1}function qh(){return bw}var ww=ot({},yi,{key:function(e){if(e.key){var t=vw[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=gl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xw[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qh,charCode:function(e){return e.type==="keypress"?gl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?gl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Nw=kn(ww),_w=ot({},jc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),em=kn(_w),jw=ot({},yi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qh}),kw=kn(jw),Cw=ot({},eo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sw=kn(Cw),Ew=ot({},jc,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rw=kn(Ew),Dw=[9,13,27,32],Hh=Er&&"CompositionEvent"in window,Ro=null;Er&&"documentMode"in document&&(Ro=document.documentMode);var Iw=Er&&"TextEvent"in window&&!Ro,rx=Er&&(!Hh||Ro&&8<Ro&&11>=Ro),tm=String.fromCharCode(32),nm=!1;function ax(e,t){switch(e){case"keyup":return Dw.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sx(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ms=!1;function Aw(e,t){switch(e){case"compositionend":return sx(t);case"keypress":return t.which!==32?null:(nm=!0,tm);case"textInput":return e=t.data,e===tm&&nm?null:e;default:return null}}function Tw(e,t){if(ms)return e==="compositionend"||!Hh&&ax(e,t)?(e=nx(),ml=Uh=Xr=null,ms=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return rx&&t.locale!=="ko"?null:t.data;default:return null}}var Pw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Pw[e.type]:t==="textarea"}function ox(e,t,n,r){Ov(r),t=Tl(t,"onChange"),0<t.length&&(n=new Vh("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Do=null,Ho=null;function Fw(e){vx(e,0)}function kc(e){var t=xs(e);if(Dv(t))return e}function Mw(e,t){if(e==="change")return t}var ix=!1;if(Er){var uu;if(Er){var du="oninput"in document;if(!du){var am=document.createElement("div");am.setAttribute("oninput","return;"),du=typeof am.oninput=="function"}uu=du}else uu=!1;ix=uu&&(!document.documentMode||9<document.documentMode)}function sm(){Do&&(Do.detachEvent("onpropertychange",lx),Ho=Do=null)}function lx(e){if(e.propertyName==="value"&&kc(Ho)){var t=[];ox(t,Ho,e,Lh(e)),Wv(Fw,t)}}function Ow(e,t,n){e==="focusin"?(sm(),Do=t,Ho=n,Do.attachEvent("onpropertychange",lx)):e==="focusout"&&sm()}function Lw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return kc(Ho)}function Bw(e,t){if(e==="click")return kc(t)}function $w(e,t){if(e==="input"||e==="change")return kc(t)}function Ww(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Xn=typeof Object.is=="function"?Object.is:Ww;function Go(e,t){if(Xn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!od.call(t,a)||!Xn(e[a],t[a]))return!1}return!0}function om(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function im(e,t){var n=om(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=om(n)}}function cx(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?cx(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function ux(){for(var e=window,t=Cl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Cl(e.document)}return t}function Gh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function zw(e){var t=ux(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&cx(n.ownerDocument.documentElement,n)){if(r!==null&&Gh(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,s=Math.min(r.start,a);r=r.end===void 0?s:Math.min(r.end,a),!e.extend&&s>r&&(a=r,r=s,s=a),a=im(n,s);var o=im(n,r);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Uw=Er&&"documentMode"in document&&11>=document.documentMode,gs=null,kd=null,Io=null,Cd=!1;function lm(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Cd||gs==null||gs!==Cl(r)||(r=gs,"selectionStart"in r&&Gh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Io&&Go(Io,r)||(Io=r,r=Tl(kd,"onSelect"),0<r.length&&(t=new Vh("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gs)))}function $i(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var vs={animationend:$i("Animation","AnimationEnd"),animationiteration:$i("Animation","AnimationIteration"),animationstart:$i("Animation","AnimationStart"),transitionend:$i("Transition","TransitionEnd")},hu={},dx={};Er&&(dx=document.createElement("div").style,"AnimationEvent"in window||(delete vs.animationend.animation,delete vs.animationiteration.animation,delete vs.animationstart.animation),"TransitionEvent"in window||delete vs.transitionend.transition);function Cc(e){if(hu[e])return hu[e];if(!vs[e])return e;var t=vs[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in dx)return hu[e]=t[n];return e}var hx=Cc("animationend"),fx=Cc("animationiteration"),px=Cc("animationstart"),mx=Cc("transitionend"),gx=new Map,cm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function va(e,t){gx.set(e,t),Ya(t,[e])}for(var fu=0;fu<cm.length;fu++){var pu=cm[fu],Vw=pu.toLowerCase(),qw=pu[0].toUpperCase()+pu.slice(1);va(Vw,"on"+qw)}va(hx,"onAnimationEnd");va(fx,"onAnimationIteration");va(px,"onAnimationStart");va("dblclick","onDoubleClick");va("focusin","onFocus");va("focusout","onBlur");va(mx,"onTransitionEnd");Ws("onMouseEnter",["mouseout","mouseover"]);Ws("onMouseLeave",["mouseout","mouseover"]);Ws("onPointerEnter",["pointerout","pointerover"]);Ws("onPointerLeave",["pointerout","pointerover"]);Ya("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ya("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ya("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ya("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ya("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ya("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Co="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hw=new Set("cancel close invalid load scroll toggle".split(" ").concat(Co));function um(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,V1(r,t,void 0,e),e.currentTarget=null}function vx(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==s&&a.isPropagationStopped())break e;um(a,l,u),s=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==s&&a.isPropagationStopped())break e;um(a,l,u),s=c}}}if(El)throw e=wd,El=!1,wd=null,e}function Qe(e,t){var n=t[Id];n===void 0&&(n=t[Id]=new Set);var r=e+"__bubble";n.has(r)||(xx(t,e,2,!1),n.add(r))}function mu(e,t,n){var r=0;t&&(r|=4),xx(n,e,r,t)}var Wi="_reactListening"+Math.random().toString(36).slice(2);function Ko(e){if(!e[Wi]){e[Wi]=!0,kv.forEach(function(n){n!=="selectionchange"&&(Hw.has(n)||mu(n,!1,e),mu(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Wi]||(t[Wi]=!0,mu("selectionchange",!1,t))}}function xx(e,t,n,r){switch(tx(t)){case 1:var a=ow;break;case 4:a=iw;break;default:a=zh}n=a.bind(null,t,n,e),a=void 0,!bd||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function gu(e,t,n,r,a){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;o=o.return}for(;l!==null;){if(o=Aa(l),o===null)return;if(c=o.tag,c===5||c===6){r=s=o;continue e}l=l.parentNode}}r=r.return}Wv(function(){var u=s,d=Lh(n),h=[];e:{var f=gx.get(e);if(f!==void 0){var p=Vh,m=e;switch(e){case"keypress":if(gl(n)===0)break e;case"keydown":case"keyup":p=Nw;break;case"focusin":m="focus",p=cu;break;case"focusout":m="blur",p=cu;break;case"beforeblur":case"afterblur":p=cu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Jp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=uw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=kw;break;case hx:case fx:case px:p=fw;break;case mx:p=Sw;break;case"scroll":p=lw;break;case"wheel":p=Rw;break;case"copy":case"cut":case"paste":p=mw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=em}var x=(t&4)!==0,y=!x&&e==="scroll",g=x?f!==null?f+"Capture":null:f;x=[];for(var v=u,w;v!==null;){w=v;var b=w.stateNode;if(w.tag===5&&b!==null&&(w=b,g!==null&&(b=zo(v,g),b!=null&&x.push(Xo(v,b,w)))),y)break;v=v.return}0<x.length&&(f=new p(f,m,null,n,d),h.push({event:f,listeners:x}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",f&&n!==xd&&(m=n.relatedTarget||n.fromElement)&&(Aa(m)||m[Rr]))break e;if((p||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?Aa(m):null,m!==null&&(y=Qa(m),m!==y||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(x=Jp,b="onMouseLeave",g="onMouseEnter",v="mouse",(e==="pointerout"||e==="pointerover")&&(x=em,b="onPointerLeave",g="onPointerEnter",v="pointer"),y=p==null?f:xs(p),w=m==null?f:xs(m),f=new x(b,v+"leave",p,n,d),f.target=y,f.relatedTarget=w,b=null,Aa(d)===u&&(x=new x(g,v+"enter",m,n,d),x.target=w,x.relatedTarget=y,b=x),y=b,p&&m)t:{for(x=p,g=m,v=0,w=x;w;w=as(w))v++;for(w=0,b=g;b;b=as(b))w++;for(;0<v-w;)x=as(x),v--;for(;0<w-v;)g=as(g),w--;for(;v--;){if(x===g||g!==null&&x===g.alternate)break t;x=as(x),g=as(g)}x=null}else x=null;p!==null&&dm(h,f,p,x,!1),m!==null&&y!==null&&dm(h,y,m,x,!0)}}e:{if(f=u?xs(u):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var N=Mw;else if(rm(f))if(ix)N=$w;else{N=Lw;var _=Ow}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(N=Bw);if(N&&(N=N(e,u))){ox(h,N,n,d);break e}_&&_(e,f,u),e==="focusout"&&(_=f._wrapperState)&&_.controlled&&f.type==="number"&&fd(f,"number",f.value)}switch(_=u?xs(u):window,e){case"focusin":(rm(_)||_.contentEditable==="true")&&(gs=_,kd=u,Io=null);break;case"focusout":Io=kd=gs=null;break;case"mousedown":Cd=!0;break;case"contextmenu":case"mouseup":case"dragend":Cd=!1,lm(h,n,d);break;case"selectionchange":if(Uw)break;case"keydown":case"keyup":lm(h,n,d)}var C;if(Hh)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else ms?ax(e,n)&&(k="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(rx&&n.locale!=="ko"&&(ms||k!=="onCompositionStart"?k==="onCompositionEnd"&&ms&&(C=nx()):(Xr=d,Uh="value"in Xr?Xr.value:Xr.textContent,ms=!0)),_=Tl(u,k),0<_.length&&(k=new Zp(k,e,null,n,d),h.push({event:k,listeners:_}),C?k.data=C:(C=sx(n),C!==null&&(k.data=C)))),(C=Iw?Aw(e,n):Tw(e,n))&&(u=Tl(u,"onBeforeInput"),0<u.length&&(d=new Zp("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:u}),d.data=C))}vx(h,t)})}function Xo(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Tl(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,s=a.stateNode;a.tag===5&&s!==null&&(a=s,s=zo(e,n),s!=null&&r.unshift(Xo(e,s,a)),s=zo(e,t),s!=null&&r.push(Xo(e,s,a))),e=e.return}return r}function as(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function dm(e,t,n,r,a){for(var s=t._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,u=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&u!==null&&(l=u,a?(c=zo(n,s),c!=null&&o.unshift(Xo(n,c,l))):a||(c=zo(n,s),c!=null&&o.push(Xo(n,c,l)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var Gw=/\r\n?/g,Kw=/\u0000|\uFFFD/g;function hm(e){return(typeof e=="string"?e:""+e).replace(Gw,`
`).replace(Kw,"")}function zi(e,t,n){if(t=hm(t),hm(e)!==t&&n)throw Error(se(425))}function Pl(){}var Sd=null,Ed=null;function Rd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Dd=typeof setTimeout=="function"?setTimeout:void 0,Xw=typeof clearTimeout=="function"?clearTimeout:void 0,fm=typeof Promise=="function"?Promise:void 0,Yw=typeof queueMicrotask=="function"?queueMicrotask:typeof fm<"u"?function(e){return fm.resolve(null).then(e).catch(Qw)}:Dd;function Qw(e){setTimeout(function(){throw e})}function vu(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),qo(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);qo(t)}function ra(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function pm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var to=Math.random().toString(36).slice(2),sr="__reactFiber$"+to,Yo="__reactProps$"+to,Rr="__reactContainer$"+to,Id="__reactEvents$"+to,Jw="__reactListeners$"+to,Zw="__reactHandles$"+to;function Aa(e){var t=e[sr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Rr]||n[sr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=pm(e);e!==null;){if(n=e[sr])return n;e=pm(e)}return t}e=n,n=e.parentNode}return null}function bi(e){return e=e[sr]||e[Rr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function xs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(se(33))}function Sc(e){return e[Yo]||null}var Ad=[],ys=-1;function xa(e){return{current:e}}function Ze(e){0>ys||(e.current=Ad[ys],Ad[ys]=null,ys--)}function Ge(e,t){ys++,Ad[ys]=e.current,e.current=t}var pa={},Xt=xa(pa),on=xa(!1),za=pa;function zs(e,t){var n=e.type.contextTypes;if(!n)return pa;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},s;for(s in n)a[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function ln(e){return e=e.childContextTypes,e!=null}function Fl(){Ze(on),Ze(Xt)}function mm(e,t,n){if(Xt.current!==pa)throw Error(se(168));Ge(Xt,t),Ge(on,n)}function yx(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(se(108,O1(e)||"Unknown",a));return ot({},n,r)}function Ml(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||pa,za=Xt.current,Ge(Xt,e),Ge(on,on.current),!0}function gm(e,t,n){var r=e.stateNode;if(!r)throw Error(se(169));n?(e=yx(e,t,za),r.__reactInternalMemoizedMergedChildContext=e,Ze(on),Ze(Xt),Ge(Xt,e)):Ze(on),Ge(on,n)}var _r=null,Ec=!1,xu=!1;function bx(e){_r===null?_r=[e]:_r.push(e)}function e2(e){Ec=!0,bx(e)}function ya(){if(!xu&&_r!==null){xu=!0;var e=0,t=Ve;try{var n=_r;for(Ve=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}_r=null,Ec=!1}catch(a){throw _r!==null&&(_r=_r.slice(e+1)),qv(Bh,ya),a}finally{Ve=t,xu=!1}}return null}var bs=[],ws=0,Ol=null,Ll=0,Sn=[],En=0,Ua=null,kr=1,Cr="";function Sa(e,t){bs[ws++]=Ll,bs[ws++]=Ol,Ol=e,Ll=t}function wx(e,t,n){Sn[En++]=kr,Sn[En++]=Cr,Sn[En++]=Ua,Ua=e;var r=kr;e=Cr;var a=32-Hn(r)-1;r&=~(1<<a),n+=1;var s=32-Hn(t)+a;if(30<s){var o=a-a%5;s=(r&(1<<o)-1).toString(32),r>>=o,a-=o,kr=1<<32-Hn(t)+a|n<<a|r,Cr=s+e}else kr=1<<s|n<<a|r,Cr=e}function Kh(e){e.return!==null&&(Sa(e,1),wx(e,1,0))}function Xh(e){for(;e===Ol;)Ol=bs[--ws],bs[ws]=null,Ll=bs[--ws],bs[ws]=null;for(;e===Ua;)Ua=Sn[--En],Sn[En]=null,Cr=Sn[--En],Sn[En]=null,kr=Sn[--En],Sn[En]=null}var wn=null,vn=null,tt=!1,zn=null;function Nx(e,t){var n=In(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function vm(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,wn=e,vn=ra(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,wn=e,vn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Ua!==null?{id:kr,overflow:Cr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=In(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,wn=e,vn=null,!0):!1;default:return!1}}function Td(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Pd(e){if(tt){var t=vn;if(t){var n=t;if(!vm(e,t)){if(Td(e))throw Error(se(418));t=ra(n.nextSibling);var r=wn;t&&vm(e,t)?Nx(r,n):(e.flags=e.flags&-4097|2,tt=!1,wn=e)}}else{if(Td(e))throw Error(se(418));e.flags=e.flags&-4097|2,tt=!1,wn=e}}}function xm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;wn=e}function Ui(e){if(e!==wn)return!1;if(!tt)return xm(e),tt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Rd(e.type,e.memoizedProps)),t&&(t=vn)){if(Td(e))throw _x(),Error(se(418));for(;t;)Nx(e,t),t=ra(t.nextSibling)}if(xm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(se(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){vn=ra(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}vn=null}}else vn=wn?ra(e.stateNode.nextSibling):null;return!0}function _x(){for(var e=vn;e;)e=ra(e.nextSibling)}function Us(){vn=wn=null,tt=!1}function Yh(e){zn===null?zn=[e]:zn.push(e)}var t2=Ar.ReactCurrentBatchConfig;function mo(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(se(309));var r=n.stateNode}if(!r)throw Error(se(147,e));var a=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(o){var l=a.refs;o===null?delete l[s]:l[s]=o},t._stringRef=s,t)}if(typeof e!="string")throw Error(se(284));if(!n._owner)throw Error(se(290,e))}return e}function Vi(e,t){throw e=Object.prototype.toString.call(t),Error(se(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ym(e){var t=e._init;return t(e._payload)}function jx(e){function t(g,v){if(e){var w=g.deletions;w===null?(g.deletions=[v],g.flags|=16):w.push(v)}}function n(g,v){if(!e)return null;for(;v!==null;)t(g,v),v=v.sibling;return null}function r(g,v){for(g=new Map;v!==null;)v.key!==null?g.set(v.key,v):g.set(v.index,v),v=v.sibling;return g}function a(g,v){return g=ia(g,v),g.index=0,g.sibling=null,g}function s(g,v,w){return g.index=w,e?(w=g.alternate,w!==null?(w=w.index,w<v?(g.flags|=2,v):w):(g.flags|=2,v)):(g.flags|=1048576,v)}function o(g){return e&&g.alternate===null&&(g.flags|=2),g}function l(g,v,w,b){return v===null||v.tag!==6?(v=ku(w,g.mode,b),v.return=g,v):(v=a(v,w),v.return=g,v)}function c(g,v,w,b){var N=w.type;return N===ps?d(g,v,w.props.children,b,w.key):v!==null&&(v.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===qr&&ym(N)===v.type)?(b=a(v,w.props),b.ref=mo(g,v,w),b.return=g,b):(b=_l(w.type,w.key,w.props,null,g.mode,b),b.ref=mo(g,v,w),b.return=g,b)}function u(g,v,w,b){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=Cu(w,g.mode,b),v.return=g,v):(v=a(v,w.children||[]),v.return=g,v)}function d(g,v,w,b,N){return v===null||v.tag!==7?(v=$a(w,g.mode,b,N),v.return=g,v):(v=a(v,w),v.return=g,v)}function h(g,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=ku(""+v,g.mode,w),v.return=g,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ti:return w=_l(v.type,v.key,v.props,null,g.mode,w),w.ref=mo(g,null,v),w.return=g,w;case fs:return v=Cu(v,g.mode,w),v.return=g,v;case qr:var b=v._init;return h(g,b(v._payload),w)}if(jo(v)||co(v))return v=$a(v,g.mode,w,null),v.return=g,v;Vi(g,v)}return null}function f(g,v,w,b){var N=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return N!==null?null:l(g,v,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Ti:return w.key===N?c(g,v,w,b):null;case fs:return w.key===N?u(g,v,w,b):null;case qr:return N=w._init,f(g,v,N(w._payload),b)}if(jo(w)||co(w))return N!==null?null:d(g,v,w,b,null);Vi(g,w)}return null}function p(g,v,w,b,N){if(typeof b=="string"&&b!==""||typeof b=="number")return g=g.get(w)||null,l(v,g,""+b,N);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ti:return g=g.get(b.key===null?w:b.key)||null,c(v,g,b,N);case fs:return g=g.get(b.key===null?w:b.key)||null,u(v,g,b,N);case qr:var _=b._init;return p(g,v,w,_(b._payload),N)}if(jo(b)||co(b))return g=g.get(w)||null,d(v,g,b,N,null);Vi(v,b)}return null}function m(g,v,w,b){for(var N=null,_=null,C=v,k=v=0,j=null;C!==null&&k<w.length;k++){C.index>k?(j=C,C=null):j=C.sibling;var S=f(g,C,w[k],b);if(S===null){C===null&&(C=j);break}e&&C&&S.alternate===null&&t(g,C),v=s(S,v,k),_===null?N=S:_.sibling=S,_=S,C=j}if(k===w.length)return n(g,C),tt&&Sa(g,k),N;if(C===null){for(;k<w.length;k++)C=h(g,w[k],b),C!==null&&(v=s(C,v,k),_===null?N=C:_.sibling=C,_=C);return tt&&Sa(g,k),N}for(C=r(g,C);k<w.length;k++)j=p(C,g,k,w[k],b),j!==null&&(e&&j.alternate!==null&&C.delete(j.key===null?k:j.key),v=s(j,v,k),_===null?N=j:_.sibling=j,_=j);return e&&C.forEach(function(M){return t(g,M)}),tt&&Sa(g,k),N}function x(g,v,w,b){var N=co(w);if(typeof N!="function")throw Error(se(150));if(w=N.call(w),w==null)throw Error(se(151));for(var _=N=null,C=v,k=v=0,j=null,S=w.next();C!==null&&!S.done;k++,S=w.next()){C.index>k?(j=C,C=null):j=C.sibling;var M=f(g,C,S.value,b);if(M===null){C===null&&(C=j);break}e&&C&&M.alternate===null&&t(g,C),v=s(M,v,k),_===null?N=M:_.sibling=M,_=M,C=j}if(S.done)return n(g,C),tt&&Sa(g,k),N;if(C===null){for(;!S.done;k++,S=w.next())S=h(g,S.value,b),S!==null&&(v=s(S,v,k),_===null?N=S:_.sibling=S,_=S);return tt&&Sa(g,k),N}for(C=r(g,C);!S.done;k++,S=w.next())S=p(C,g,k,S.value,b),S!==null&&(e&&S.alternate!==null&&C.delete(S.key===null?k:S.key),v=s(S,v,k),_===null?N=S:_.sibling=S,_=S);return e&&C.forEach(function(D){return t(g,D)}),tt&&Sa(g,k),N}function y(g,v,w,b){if(typeof w=="object"&&w!==null&&w.type===ps&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Ti:e:{for(var N=w.key,_=v;_!==null;){if(_.key===N){if(N=w.type,N===ps){if(_.tag===7){n(g,_.sibling),v=a(_,w.props.children),v.return=g,g=v;break e}}else if(_.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===qr&&ym(N)===_.type){n(g,_.sibling),v=a(_,w.props),v.ref=mo(g,_,w),v.return=g,g=v;break e}n(g,_);break}else t(g,_);_=_.sibling}w.type===ps?(v=$a(w.props.children,g.mode,b,w.key),v.return=g,g=v):(b=_l(w.type,w.key,w.props,null,g.mode,b),b.ref=mo(g,v,w),b.return=g,g=b)}return o(g);case fs:e:{for(_=w.key;v!==null;){if(v.key===_)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(g,v.sibling),v=a(v,w.children||[]),v.return=g,g=v;break e}else{n(g,v);break}else t(g,v);v=v.sibling}v=Cu(w,g.mode,b),v.return=g,g=v}return o(g);case qr:return _=w._init,y(g,v,_(w._payload),b)}if(jo(w))return m(g,v,w,b);if(co(w))return x(g,v,w,b);Vi(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(g,v.sibling),v=a(v,w),v.return=g,g=v):(n(g,v),v=ku(w,g.mode,b),v.return=g,g=v),o(g)):n(g,v)}return y}var Vs=jx(!0),kx=jx(!1),Bl=xa(null),$l=null,Ns=null,Qh=null;function Jh(){Qh=Ns=$l=null}function Zh(e){var t=Bl.current;Ze(Bl),e._currentValue=t}function Fd(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Is(e,t){$l=e,Qh=Ns=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(sn=!0),e.firstContext=null)}function Pn(e){var t=e._currentValue;if(Qh!==e)if(e={context:e,memoizedValue:t,next:null},Ns===null){if($l===null)throw Error(se(308));Ns=e,$l.dependencies={lanes:0,firstContext:e}}else Ns=Ns.next=e;return t}var Ta=null;function ef(e){Ta===null?Ta=[e]:Ta.push(e)}function Cx(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,ef(t)):(n.next=a.next,a.next=n),t.interleaved=n,Dr(e,r)}function Dr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Hr=!1;function tf(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Sr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function aa(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,We&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Dr(e,n)}return a=r.interleaved,a===null?(t.next=t,ef(r)):(t.next=a.next,a.next=t),r.interleaved=t,Dr(e,n)}function vl(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,$h(e,n)}}function bm(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?a=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?a=s=t:s=s.next=t}else a=s=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wl(e,t,n,r){var a=e.updateQueue;Hr=!1;var s=a.firstBaseUpdate,o=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?s=u:o.next=u,o=c;var d=e.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==o&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(s!==null){var h=a.baseState;o=0,d=u=c=null,l=s;do{var f=l.lane,p=l.eventTime;if((r&f)===f){d!==null&&(d=d.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,x=l;switch(f=t,p=n,x.tag){case 1:if(m=x.payload,typeof m=="function"){h=m.call(p,h,f);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=x.payload,f=typeof m=="function"?m.call(p,h,f):m,f==null)break e;h=ot({},h,f);break e;case 2:Hr=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,f=a.effects,f===null?a.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=p,c=h):d=d.next=p,o|=f;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;f=l,l=f.next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}while(1);if(d===null&&(c=h),a.baseState=c,a.firstBaseUpdate=u,a.lastBaseUpdate=d,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else s===null&&(a.shared.lanes=0);qa|=o,e.lanes=o,e.memoizedState=h}}function wm(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(se(191,a));a.call(r)}}}var wi={},ur=xa(wi),Qo=xa(wi),Jo=xa(wi);function Pa(e){if(e===wi)throw Error(se(174));return e}function nf(e,t){switch(Ge(Jo,t),Ge(Qo,e),Ge(ur,wi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:md(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=md(t,e)}Ze(ur),Ge(ur,t)}function qs(){Ze(ur),Ze(Qo),Ze(Jo)}function Ex(e){Pa(Jo.current);var t=Pa(ur.current),n=md(t,e.type);t!==n&&(Ge(Qo,e),Ge(ur,n))}function rf(e){Qo.current===e&&(Ze(ur),Ze(Qo))}var nt=xa(0);function zl(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yu=[];function af(){for(var e=0;e<yu.length;e++)yu[e]._workInProgressVersionPrimary=null;yu.length=0}var xl=Ar.ReactCurrentDispatcher,bu=Ar.ReactCurrentBatchConfig,Va=0,st=null,bt=null,Rt=null,Ul=!1,Ao=!1,Zo=0,n2=0;function Wt(){throw Error(se(321))}function sf(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Xn(e[n],t[n]))return!1;return!0}function of(e,t,n,r,a,s){if(Va=s,st=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xl.current=e===null||e.memoizedState===null?o2:i2,e=n(r,a),Ao){s=0;do{if(Ao=!1,Zo=0,25<=s)throw Error(se(301));s+=1,Rt=bt=null,t.updateQueue=null,xl.current=l2,e=n(r,a)}while(Ao)}if(xl.current=Vl,t=bt!==null&&bt.next!==null,Va=0,Rt=bt=st=null,Ul=!1,t)throw Error(se(300));return e}function lf(){var e=Zo!==0;return Zo=0,e}function nr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rt===null?st.memoizedState=Rt=e:Rt=Rt.next=e,Rt}function Fn(){if(bt===null){var e=st.alternate;e=e!==null?e.memoizedState:null}else e=bt.next;var t=Rt===null?st.memoizedState:Rt.next;if(t!==null)Rt=t,bt=e;else{if(e===null)throw Error(se(310));bt=e,e={memoizedState:bt.memoizedState,baseState:bt.baseState,baseQueue:bt.baseQueue,queue:bt.queue,next:null},Rt===null?st.memoizedState=Rt=e:Rt=Rt.next=e}return Rt}function ei(e,t){return typeof t=="function"?t(e):t}function wu(e){var t=Fn(),n=t.queue;if(n===null)throw Error(se(311));n.lastRenderedReducer=e;var r=bt,a=r.baseQueue,s=n.pending;if(s!==null){if(a!==null){var o=a.next;a.next=s.next,s.next=o}r.baseQueue=a=s,n.pending=null}if(a!==null){s=a.next,r=r.baseState;var l=o=null,c=null,u=s;do{var d=u.lane;if((Va&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,st.lanes|=d,qa|=d}u=u.next}while(u!==null&&u!==s);c===null?o=r:c.next=l,Xn(r,t.memoizedState)||(sn=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do s=a.lane,st.lanes|=s,qa|=s,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Nu(e){var t=Fn(),n=t.queue;if(n===null)throw Error(se(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,s=t.memoizedState;if(a!==null){n.pending=null;var o=a=a.next;do s=e(s,o.action),o=o.next;while(o!==a);Xn(s,t.memoizedState)||(sn=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Rx(){}function Dx(e,t){var n=st,r=Fn(),a=t(),s=!Xn(r.memoizedState,a);if(s&&(r.memoizedState=a,sn=!0),r=r.queue,cf(Tx.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||Rt!==null&&Rt.memoizedState.tag&1){if(n.flags|=2048,ti(9,Ax.bind(null,n,r,a,t),void 0,null),Dt===null)throw Error(se(349));Va&30||Ix(n,t,a)}return a}function Ix(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=st.updateQueue,t===null?(t={lastEffect:null,stores:null},st.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Ax(e,t,n,r){t.value=n,t.getSnapshot=r,Px(t)&&Fx(e)}function Tx(e,t,n){return n(function(){Px(t)&&Fx(e)})}function Px(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Xn(e,n)}catch{return!0}}function Fx(e){var t=Dr(e,1);t!==null&&Gn(t,e,1,-1)}function Nm(e){var t=nr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:e},t.queue=e,e=e.dispatch=s2.bind(null,st,e),[t.memoizedState,e]}function ti(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=st.updateQueue,t===null?(t={lastEffect:null,stores:null},st.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Mx(){return Fn().memoizedState}function yl(e,t,n,r){var a=nr();st.flags|=e,a.memoizedState=ti(1|t,n,void 0,r===void 0?null:r)}function Rc(e,t,n,r){var a=Fn();r=r===void 0?null:r;var s=void 0;if(bt!==null){var o=bt.memoizedState;if(s=o.destroy,r!==null&&sf(r,o.deps)){a.memoizedState=ti(t,n,s,r);return}}st.flags|=e,a.memoizedState=ti(1|t,n,s,r)}function _m(e,t){return yl(8390656,8,e,t)}function cf(e,t){return Rc(2048,8,e,t)}function Ox(e,t){return Rc(4,2,e,t)}function Lx(e,t){return Rc(4,4,e,t)}function Bx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function $x(e,t,n){return n=n!=null?n.concat([e]):null,Rc(4,4,Bx.bind(null,t,e),n)}function uf(){}function Wx(e,t){var n=Fn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&sf(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function zx(e,t){var n=Fn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&sf(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ux(e,t,n){return Va&21?(Xn(n,t)||(n=Kv(),st.lanes|=n,qa|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,sn=!0),e.memoizedState=n)}function r2(e,t){var n=Ve;Ve=n!==0&&4>n?n:4,e(!0);var r=bu.transition;bu.transition={};try{e(!1),t()}finally{Ve=n,bu.transition=r}}function Vx(){return Fn().memoizedState}function a2(e,t,n){var r=oa(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},qx(e))Hx(t,n);else if(n=Cx(e,t,n,r),n!==null){var a=Jt();Gn(n,e,r,a),Gx(n,t,r)}}function s2(e,t,n){var r=oa(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(qx(e))Hx(t,a);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var o=t.lastRenderedState,l=s(o,n);if(a.hasEagerState=!0,a.eagerState=l,Xn(l,o)){var c=t.interleaved;c===null?(a.next=a,ef(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}n=Cx(e,t,a,r),n!==null&&(a=Jt(),Gn(n,e,r,a),Gx(n,t,r))}}function qx(e){var t=e.alternate;return e===st||t!==null&&t===st}function Hx(e,t){Ao=Ul=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Gx(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,$h(e,n)}}var Vl={readContext:Pn,useCallback:Wt,useContext:Wt,useEffect:Wt,useImperativeHandle:Wt,useInsertionEffect:Wt,useLayoutEffect:Wt,useMemo:Wt,useReducer:Wt,useRef:Wt,useState:Wt,useDebugValue:Wt,useDeferredValue:Wt,useTransition:Wt,useMutableSource:Wt,useSyncExternalStore:Wt,useId:Wt,unstable_isNewReconciler:!1},o2={readContext:Pn,useCallback:function(e,t){return nr().memoizedState=[e,t===void 0?null:t],e},useContext:Pn,useEffect:_m,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,yl(4194308,4,Bx.bind(null,t,e),n)},useLayoutEffect:function(e,t){return yl(4194308,4,e,t)},useInsertionEffect:function(e,t){return yl(4,2,e,t)},useMemo:function(e,t){var n=nr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=nr();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=a2.bind(null,st,e),[r.memoizedState,e]},useRef:function(e){var t=nr();return e={current:e},t.memoizedState=e},useState:Nm,useDebugValue:uf,useDeferredValue:function(e){return nr().memoizedState=e},useTransition:function(){var e=Nm(!1),t=e[0];return e=r2.bind(null,e[1]),nr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=st,a=nr();if(tt){if(n===void 0)throw Error(se(407));n=n()}else{if(n=t(),Dt===null)throw Error(se(349));Va&30||Ix(r,t,n)}a.memoizedState=n;var s={value:n,getSnapshot:t};return a.queue=s,_m(Tx.bind(null,r,s,e),[e]),r.flags|=2048,ti(9,Ax.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=nr(),t=Dt.identifierPrefix;if(tt){var n=Cr,r=kr;n=(r&~(1<<32-Hn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=Zo++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=n2++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},i2={readContext:Pn,useCallback:Wx,useContext:Pn,useEffect:cf,useImperativeHandle:$x,useInsertionEffect:Ox,useLayoutEffect:Lx,useMemo:zx,useReducer:wu,useRef:Mx,useState:function(){return wu(ei)},useDebugValue:uf,useDeferredValue:function(e){var t=Fn();return Ux(t,bt.memoizedState,e)},useTransition:function(){var e=wu(ei)[0],t=Fn().memoizedState;return[e,t]},useMutableSource:Rx,useSyncExternalStore:Dx,useId:Vx,unstable_isNewReconciler:!1},l2={readContext:Pn,useCallback:Wx,useContext:Pn,useEffect:cf,useImperativeHandle:$x,useInsertionEffect:Ox,useLayoutEffect:Lx,useMemo:zx,useReducer:Nu,useRef:Mx,useState:function(){return Nu(ei)},useDebugValue:uf,useDeferredValue:function(e){var t=Fn();return bt===null?t.memoizedState=e:Ux(t,bt.memoizedState,e)},useTransition:function(){var e=Nu(ei)[0],t=Fn().memoizedState;return[e,t]},useMutableSource:Rx,useSyncExternalStore:Dx,useId:Vx,unstable_isNewReconciler:!1};function Bn(e,t){if(e&&e.defaultProps){t=ot({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Md(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:ot({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Dc={isMounted:function(e){return(e=e._reactInternals)?Qa(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Jt(),a=oa(e),s=Sr(r,a);s.payload=t,n!=null&&(s.callback=n),t=aa(e,s,a),t!==null&&(Gn(t,e,a,r),vl(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Jt(),a=oa(e),s=Sr(r,a);s.tag=1,s.payload=t,n!=null&&(s.callback=n),t=aa(e,s,a),t!==null&&(Gn(t,e,a,r),vl(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Jt(),r=oa(e),a=Sr(n,r);a.tag=2,t!=null&&(a.callback=t),t=aa(e,a,r),t!==null&&(Gn(t,e,r,n),vl(t,e,r))}};function jm(e,t,n,r,a,s,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,o):t.prototype&&t.prototype.isPureReactComponent?!Go(n,r)||!Go(a,s):!0}function Kx(e,t,n){var r=!1,a=pa,s=t.contextType;return typeof s=="object"&&s!==null?s=Pn(s):(a=ln(t)?za:Xt.current,r=t.contextTypes,s=(r=r!=null)?zs(e,a):pa),t=new t(n,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Dc,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=s),t}function km(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Dc.enqueueReplaceState(t,t.state,null)}function Od(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},tf(e);var s=t.contextType;typeof s=="object"&&s!==null?a.context=Pn(s):(s=ln(t)?za:Xt.current,a.context=zs(e,s)),a.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(Md(e,t,s,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Dc.enqueueReplaceState(a,a.state,null),Wl(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Hs(e,t){try{var n="",r=t;do n+=M1(r),r=r.return;while(r);var a=n}catch(s){a=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:a,digest:null}}function _u(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ld(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var c2=typeof WeakMap=="function"?WeakMap:Map;function Xx(e,t,n){n=Sr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hl||(Hl=!0,Kd=r),Ld(e,t)},n}function Yx(e,t,n){n=Sr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){Ld(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Ld(e,t),typeof r!="function"&&(sa===null?sa=new Set([this]):sa.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function Cm(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new c2;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=_2.bind(null,e,t,n),t.then(e,e))}function Sm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Em(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Sr(-1,1),t.tag=2,aa(n,t,1))),n.lanes|=1),e)}var u2=Ar.ReactCurrentOwner,sn=!1;function Qt(e,t,n,r){t.child=e===null?kx(t,null,n,r):Vs(t,e.child,n,r)}function Rm(e,t,n,r,a){n=n.render;var s=t.ref;return Is(t,a),r=of(e,t,n,r,s,a),n=lf(),e!==null&&!sn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Ir(e,t,a)):(tt&&n&&Kh(t),t.flags|=1,Qt(e,t,r,a),t.child)}function Dm(e,t,n,r,a){if(e===null){var s=n.type;return typeof s=="function"&&!xf(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=s,Qx(e,t,s,r,a)):(e=_l(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&a)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Go,n(o,r)&&e.ref===t.ref)return Ir(e,t,a)}return t.flags|=1,e=ia(s,r),e.ref=t.ref,e.return=t,t.child=e}function Qx(e,t,n,r,a){if(e!==null){var s=e.memoizedProps;if(Go(s,r)&&e.ref===t.ref)if(sn=!1,t.pendingProps=r=s,(e.lanes&a)!==0)e.flags&131072&&(sn=!0);else return t.lanes=e.lanes,Ir(e,t,a)}return Bd(e,t,n,r,a)}function Jx(e,t,n){var r=t.pendingProps,a=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ge(js,fn),fn|=n;else{if(!(n&1073741824))return e=s!==null?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ge(js,fn),fn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,Ge(js,fn),fn|=r}else s!==null?(r=s.baseLanes|n,t.memoizedState=null):r=n,Ge(js,fn),fn|=r;return Qt(e,t,a,n),t.child}function Zx(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Bd(e,t,n,r,a){var s=ln(n)?za:Xt.current;return s=zs(t,s),Is(t,a),n=of(e,t,n,r,s,a),r=lf(),e!==null&&!sn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Ir(e,t,a)):(tt&&r&&Kh(t),t.flags|=1,Qt(e,t,n,a),t.child)}function Im(e,t,n,r,a){if(ln(n)){var s=!0;Ml(t)}else s=!1;if(Is(t,a),t.stateNode===null)bl(e,t),Kx(t,n,r),Od(t,n,r,a),r=!0;else if(e===null){var o=t.stateNode,l=t.memoizedProps;o.props=l;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Pn(u):(u=ln(n)?za:Xt.current,u=zs(t,u));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==u)&&km(t,o,r,u),Hr=!1;var f=t.memoizedState;o.state=f,Wl(t,r,o,a),c=t.memoizedState,l!==r||f!==c||on.current||Hr?(typeof d=="function"&&(Md(t,n,d,r),c=t.memoizedState),(l=Hr||jm(t,n,l,r,f,c,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=u,r=l):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Sx(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:Bn(t.type,l),o.props=u,h=t.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Pn(c):(c=ln(n)?za:Xt.current,c=zs(t,c));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==c)&&km(t,o,r,c),Hr=!1,f=t.memoizedState,o.state=f,Wl(t,r,o,a);var m=t.memoizedState;l!==h||f!==m||on.current||Hr?(typeof p=="function"&&(Md(t,n,p,r),m=t.memoizedState),(u=Hr||jm(t,n,u,r,f,m,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=m),o.props=r,o.state=m,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return $d(e,t,n,r,s,a)}function $d(e,t,n,r,a,s){Zx(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return a&&gm(t,n,!1),Ir(e,t,s);r=t.stateNode,u2.current=t;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=Vs(t,e.child,null,s),t.child=Vs(t,null,l,s)):Qt(e,t,l,s),t.memoizedState=r.state,a&&gm(t,n,!0),t.child}function e0(e){var t=e.stateNode;t.pendingContext?mm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&mm(e,t.context,!1),nf(e,t.containerInfo)}function Am(e,t,n,r,a){return Us(),Yh(a),t.flags|=256,Qt(e,t,n,r),t.child}var Wd={dehydrated:null,treeContext:null,retryLane:0};function zd(e){return{baseLanes:e,cachePool:null,transitions:null}}function t0(e,t,n){var r=t.pendingProps,a=nt.current,s=!1,o=(t.flags&128)!==0,l;if((l=o)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Ge(nt,a&1),e===null)return Pd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,s?(r=t.mode,s=t.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Tc(o,r,0,null),e=$a(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=zd(n),t.memoizedState=Wd,e):df(t,o));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return d2(e,t,o,r,l,a,n);if(s){s=r.fallback,o=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=ia(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?s=ia(l,s):(s=$a(s,o,n,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,o=e.child.memoizedState,o=o===null?zd(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=e.childLanes&~n,t.memoizedState=Wd,r}return s=e.child,e=s.sibling,r=ia(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function df(e,t){return t=Tc({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function qi(e,t,n,r){return r!==null&&Yh(r),Vs(t,e.child,null,n),e=df(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function d2(e,t,n,r,a,s,o){if(n)return t.flags&256?(t.flags&=-257,r=_u(Error(se(422))),qi(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,a=t.mode,r=Tc({mode:"visible",children:r.children},a,0,null),s=$a(s,a,o,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&Vs(t,e.child,null,o),t.child.memoizedState=zd(o),t.memoizedState=Wd,s);if(!(t.mode&1))return qi(e,t,o,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,s=Error(se(419)),r=_u(s,r,void 0),qi(e,t,o,r)}if(l=(o&e.childLanes)!==0,sn||l){if(r=Dt,r!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|o)?0:a,a!==0&&a!==s.retryLane&&(s.retryLane=a,Dr(e,a),Gn(r,e,a,-1))}return vf(),r=_u(Error(se(421))),qi(e,t,o,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=j2.bind(null,e),a._reactRetry=t,null):(e=s.treeContext,vn=ra(a.nextSibling),wn=t,tt=!0,zn=null,e!==null&&(Sn[En++]=kr,Sn[En++]=Cr,Sn[En++]=Ua,kr=e.id,Cr=e.overflow,Ua=t),t=df(t,r.children),t.flags|=4096,t)}function Tm(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Fd(e.return,t,n)}function ju(e,t,n,r,a){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=a)}function n0(e,t,n){var r=t.pendingProps,a=r.revealOrder,s=r.tail;if(Qt(e,t,r.children,n),r=nt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Tm(e,n,t);else if(e.tag===19)Tm(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ge(nt,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&zl(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),ju(t,!1,a,n,s);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&zl(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}ju(t,!0,n,null,s);break;case"together":ju(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function bl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ir(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),qa|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(se(153));if(t.child!==null){for(e=t.child,n=ia(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ia(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function h2(e,t,n){switch(t.tag){case 3:e0(t),Us();break;case 5:Ex(t);break;case 1:ln(t.type)&&Ml(t);break;case 4:nf(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ge(Bl,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Ge(nt,nt.current&1),t.flags|=128,null):n&t.child.childLanes?t0(e,t,n):(Ge(nt,nt.current&1),e=Ir(e,t,n),e!==null?e.sibling:null);Ge(nt,nt.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return n0(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ge(nt,nt.current),r)break;return null;case 22:case 23:return t.lanes=0,Jx(e,t,n)}return Ir(e,t,n)}var r0,Ud,a0,s0;r0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ud=function(){};a0=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Pa(ur.current);var s=null;switch(n){case"input":a=dd(e,a),r=dd(e,r),s=[];break;case"select":a=ot({},a,{value:void 0}),r=ot({},r,{value:void 0}),s=[];break;case"textarea":a=pd(e,a),r=pd(e,r),s=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Pl)}gd(n,r);var o;n=null;for(u in a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var l=a[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&($o.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=a!=null?a[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(s=s||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&($o.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Qe("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}};s0=function(e,t,n,r){n!==r&&(t.flags|=4)};function go(e,t){if(!tt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function zt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function f2(e,t,n){var r=t.pendingProps;switch(Xh(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zt(t),null;case 1:return ln(t.type)&&Fl(),zt(t),null;case 3:return r=t.stateNode,qs(),Ze(on),Ze(Xt),af(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Ui(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,zn!==null&&(Qd(zn),zn=null))),Ud(e,t),zt(t),null;case 5:rf(t);var a=Pa(Jo.current);if(n=t.type,e!==null&&t.stateNode!=null)a0(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(se(166));return zt(t),null}if(e=Pa(ur.current),Ui(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[sr]=t,r[Yo]=s,e=(t.mode&1)!==0,n){case"dialog":Qe("cancel",r),Qe("close",r);break;case"iframe":case"object":case"embed":Qe("load",r);break;case"video":case"audio":for(a=0;a<Co.length;a++)Qe(Co[a],r);break;case"source":Qe("error",r);break;case"img":case"image":case"link":Qe("error",r),Qe("load",r);break;case"details":Qe("toggle",r);break;case"input":zp(r,s),Qe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Qe("invalid",r);break;case"textarea":Vp(r,s),Qe("invalid",r)}gd(n,s),a=null;for(var o in s)if(s.hasOwnProperty(o)){var l=s[o];o==="children"?typeof l=="string"?r.textContent!==l&&(s.suppressHydrationWarning!==!0&&zi(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(s.suppressHydrationWarning!==!0&&zi(r.textContent,l,e),a=["children",""+l]):$o.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Qe("scroll",r)}switch(n){case"input":Pi(r),Up(r,s,!0);break;case"textarea":Pi(r),qp(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Pl)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Tv(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[sr]=t,e[Yo]=r,r0(e,t,!1,!1),t.stateNode=e;e:{switch(o=vd(n,r),n){case"dialog":Qe("cancel",e),Qe("close",e),a=r;break;case"iframe":case"object":case"embed":Qe("load",e),a=r;break;case"video":case"audio":for(a=0;a<Co.length;a++)Qe(Co[a],e);a=r;break;case"source":Qe("error",e),a=r;break;case"img":case"image":case"link":Qe("error",e),Qe("load",e),a=r;break;case"details":Qe("toggle",e),a=r;break;case"input":zp(e,r),a=dd(e,r),Qe("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=ot({},r,{value:void 0}),Qe("invalid",e);break;case"textarea":Vp(e,r),a=pd(e,r),Qe("invalid",e);break;default:a=r}gd(n,a),l=a;for(s in l)if(l.hasOwnProperty(s)){var c=l[s];s==="style"?Mv(e,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Pv(e,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Wo(e,c):typeof c=="number"&&Wo(e,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&($o.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Qe("scroll",e):c!=null&&Ph(e,s,c,o))}switch(n){case"input":Pi(e),Up(e,r,!1);break;case"textarea":Pi(e),qp(e);break;case"option":r.value!=null&&e.setAttribute("value",""+fa(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?Ss(e,!!r.multiple,s,!1):r.defaultValue!=null&&Ss(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Pl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return zt(t),null;case 6:if(e&&t.stateNode!=null)s0(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(se(166));if(n=Pa(Jo.current),Pa(ur.current),Ui(t)){if(r=t.stateNode,n=t.memoizedProps,r[sr]=t,(s=r.nodeValue!==n)&&(e=wn,e!==null))switch(e.tag){case 3:zi(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&zi(r.nodeValue,n,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[sr]=t,t.stateNode=r}return zt(t),null;case 13:if(Ze(nt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(tt&&vn!==null&&t.mode&1&&!(t.flags&128))_x(),Us(),t.flags|=98560,s=!1;else if(s=Ui(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(se(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(se(317));s[sr]=t}else Us(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;zt(t),s=!1}else zn!==null&&(Qd(zn),zn=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||nt.current&1?wt===0&&(wt=3):vf())),t.updateQueue!==null&&(t.flags|=4),zt(t),null);case 4:return qs(),Ud(e,t),e===null&&Ko(t.stateNode.containerInfo),zt(t),null;case 10:return Zh(t.type._context),zt(t),null;case 17:return ln(t.type)&&Fl(),zt(t),null;case 19:if(Ze(nt),s=t.memoizedState,s===null)return zt(t),null;if(r=(t.flags&128)!==0,o=s.rendering,o===null)if(r)go(s,!1);else{if(wt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=zl(e),o!==null){for(t.flags|=128,go(s,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)s=n,e=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,e=o.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ge(nt,nt.current&1|2),t.child}e=e.sibling}s.tail!==null&&ht()>Gs&&(t.flags|=128,r=!0,go(s,!1),t.lanes=4194304)}else{if(!r)if(e=zl(o),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),go(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!tt)return zt(t),null}else 2*ht()-s.renderingStartTime>Gs&&n!==1073741824&&(t.flags|=128,r=!0,go(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(n=s.last,n!==null?n.sibling=o:t.child=o,s.last=o)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=ht(),t.sibling=null,n=nt.current,Ge(nt,r?n&1|2:n&1),t):(zt(t),null);case 22:case 23:return gf(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?fn&1073741824&&(zt(t),t.subtreeFlags&6&&(t.flags|=8192)):zt(t),null;case 24:return null;case 25:return null}throw Error(se(156,t.tag))}function p2(e,t){switch(Xh(t),t.tag){case 1:return ln(t.type)&&Fl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return qs(),Ze(on),Ze(Xt),af(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return rf(t),null;case 13:if(Ze(nt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(se(340));Us()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ze(nt),null;case 4:return qs(),null;case 10:return Zh(t.type._context),null;case 22:case 23:return gf(),null;case 24:return null;default:return null}}var Hi=!1,Vt=!1,m2=typeof WeakSet=="function"?WeakSet:Set,fe=null;function _s(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ct(e,t,r)}else n.current=null}function Vd(e,t,n){try{n()}catch(r){ct(e,t,r)}}var Pm=!1;function g2(e,t){if(Sd=Il,e=ux(),Gh(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||a!==0&&h.nodeType!==3||(l=o+a),h!==s||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===a&&(l=o),f===s&&++d===r&&(c=o),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ed={focusedElem:e,selectionRange:n},Il=!1,fe=t;fe!==null;)if(t=fe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,fe=e;else for(;fe!==null;){t=fe;try{var m=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var x=m.memoizedProps,y=m.memoizedState,g=t.stateNode,v=g.getSnapshotBeforeUpdate(t.elementType===t.type?x:Bn(t.type,x),y);g.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=t.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(se(163))}}catch(b){ct(t,t.return,b)}if(e=t.sibling,e!==null){e.return=t.return,fe=e;break}fe=t.return}return m=Pm,Pm=!1,m}function To(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var s=a.destroy;a.destroy=void 0,s!==void 0&&Vd(t,n,s)}a=a.next}while(a!==r)}}function Ic(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function qd(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function o0(e){var t=e.alternate;t!==null&&(e.alternate=null,o0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[sr],delete t[Yo],delete t[Id],delete t[Jw],delete t[Zw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function i0(e){return e.tag===5||e.tag===3||e.tag===4}function Fm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||i0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Hd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Pl));else if(r!==4&&(e=e.child,e!==null))for(Hd(e,t,n),e=e.sibling;e!==null;)Hd(e,t,n),e=e.sibling}function Gd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Gd(e,t,n),e=e.sibling;e!==null;)Gd(e,t,n),e=e.sibling}var Pt=null,$n=!1;function zr(e,t,n){for(n=n.child;n!==null;)l0(e,t,n),n=n.sibling}function l0(e,t,n){if(cr&&typeof cr.onCommitFiberUnmount=="function")try{cr.onCommitFiberUnmount(_c,n)}catch{}switch(n.tag){case 5:Vt||_s(n,t);case 6:var r=Pt,a=$n;Pt=null,zr(e,t,n),Pt=r,$n=a,Pt!==null&&($n?(e=Pt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Pt.removeChild(n.stateNode));break;case 18:Pt!==null&&($n?(e=Pt,n=n.stateNode,e.nodeType===8?vu(e.parentNode,n):e.nodeType===1&&vu(e,n),qo(e)):vu(Pt,n.stateNode));break;case 4:r=Pt,a=$n,Pt=n.stateNode.containerInfo,$n=!0,zr(e,t,n),Pt=r,$n=a;break;case 0:case 11:case 14:case 15:if(!Vt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var s=a,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Vd(n,t,o),a=a.next}while(a!==r)}zr(e,t,n);break;case 1:if(!Vt&&(_s(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){ct(n,t,l)}zr(e,t,n);break;case 21:zr(e,t,n);break;case 22:n.mode&1?(Vt=(r=Vt)||n.memoizedState!==null,zr(e,t,n),Vt=r):zr(e,t,n);break;default:zr(e,t,n)}}function Mm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new m2),t.forEach(function(r){var a=k2.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function Ln(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var s=e,o=t,l=o;e:for(;l!==null;){switch(l.tag){case 5:Pt=l.stateNode,$n=!1;break e;case 3:Pt=l.stateNode.containerInfo,$n=!0;break e;case 4:Pt=l.stateNode.containerInfo,$n=!0;break e}l=l.return}if(Pt===null)throw Error(se(160));l0(s,o,a),Pt=null,$n=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(u){ct(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)c0(t,e),t=t.sibling}function c0(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ln(t,e),er(e),r&4){try{To(3,e,e.return),Ic(3,e)}catch(x){ct(e,e.return,x)}try{To(5,e,e.return)}catch(x){ct(e,e.return,x)}}break;case 1:Ln(t,e),er(e),r&512&&n!==null&&_s(n,n.return);break;case 5:if(Ln(t,e),er(e),r&512&&n!==null&&_s(n,n.return),e.flags&32){var a=e.stateNode;try{Wo(a,"")}catch(x){ct(e,e.return,x)}}if(r&4&&(a=e.stateNode,a!=null)){var s=e.memoizedProps,o=n!==null?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&s.type==="radio"&&s.name!=null&&Iv(a,s),vd(l,o);var u=vd(l,s);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?Mv(a,h):d==="dangerouslySetInnerHTML"?Pv(a,h):d==="children"?Wo(a,h):Ph(a,d,h,u)}switch(l){case"input":hd(a,s);break;case"textarea":Av(a,s);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Ss(a,!!s.multiple,p,!1):f!==!!s.multiple&&(s.defaultValue!=null?Ss(a,!!s.multiple,s.defaultValue,!0):Ss(a,!!s.multiple,s.multiple?[]:"",!1))}a[Yo]=s}catch(x){ct(e,e.return,x)}}break;case 6:if(Ln(t,e),er(e),r&4){if(e.stateNode===null)throw Error(se(162));a=e.stateNode,s=e.memoizedProps;try{a.nodeValue=s}catch(x){ct(e,e.return,x)}}break;case 3:if(Ln(t,e),er(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{qo(t.containerInfo)}catch(x){ct(e,e.return,x)}break;case 4:Ln(t,e),er(e);break;case 13:Ln(t,e),er(e),a=e.child,a.flags&8192&&(s=a.memoizedState!==null,a.stateNode.isHidden=s,!s||a.alternate!==null&&a.alternate.memoizedState!==null||(pf=ht())),r&4&&Mm(e);break;case 22:if(d=n!==null&&n.memoizedState!==null,e.mode&1?(Vt=(u=Vt)||d,Ln(t,e),Vt=u):Ln(t,e),er(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(fe=e,d=e.child;d!==null;){for(h=fe=d;fe!==null;){switch(f=fe,p=f.child,f.tag){case 0:case 11:case 14:case 15:To(4,f,f.return);break;case 1:_s(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(x){ct(r,n,x)}}break;case 5:_s(f,f.return);break;case 22:if(f.memoizedState!==null){Lm(h);continue}}p!==null?(p.return=f,fe=p):Lm(h)}d=d.sibling}e:for(d=null,h=e;;){if(h.tag===5){if(d===null){d=h;try{a=h.stateNode,u?(s=a.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Fv("display",o))}catch(x){ct(e,e.return,x)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(x){ct(e,e.return,x)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ln(t,e),er(e),r&4&&Mm(e);break;case 21:break;default:Ln(t,e),er(e)}}function er(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(i0(n)){var r=n;break e}n=n.return}throw Error(se(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Wo(a,""),r.flags&=-33);var s=Fm(e);Gd(e,s,a);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Fm(e);Hd(e,l,o);break;default:throw Error(se(161))}}catch(c){ct(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function v2(e,t,n){fe=e,u0(e)}function u0(e,t,n){for(var r=(e.mode&1)!==0;fe!==null;){var a=fe,s=a.child;if(a.tag===22&&r){var o=a.memoizedState!==null||Hi;if(!o){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Vt;l=Hi;var u=Vt;if(Hi=o,(Vt=c)&&!u)for(fe=a;fe!==null;)o=fe,c=o.child,o.tag===22&&o.memoizedState!==null?Bm(a):c!==null?(c.return=o,fe=c):Bm(a);for(;s!==null;)fe=s,u0(s),s=s.sibling;fe=a,Hi=l,Vt=u}Om(e)}else a.subtreeFlags&8772&&s!==null?(s.return=a,fe=s):Om(e)}}function Om(e){for(;fe!==null;){var t=fe;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Vt||Ic(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Vt)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:Bn(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&wm(t,s,r);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}wm(t,o,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&qo(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(se(163))}Vt||t.flags&512&&qd(t)}catch(f){ct(t,t.return,f)}}if(t===e){fe=null;break}if(n=t.sibling,n!==null){n.return=t.return,fe=n;break}fe=t.return}}function Lm(e){for(;fe!==null;){var t=fe;if(t===e){fe=null;break}var n=t.sibling;if(n!==null){n.return=t.return,fe=n;break}fe=t.return}}function Bm(e){for(;fe!==null;){var t=fe;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Ic(4,t)}catch(c){ct(t,n,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){ct(t,a,c)}}var s=t.return;try{qd(t)}catch(c){ct(t,s,c)}break;case 5:var o=t.return;try{qd(t)}catch(c){ct(t,o,c)}}}catch(c){ct(t,t.return,c)}if(t===e){fe=null;break}var l=t.sibling;if(l!==null){l.return=t.return,fe=l;break}fe=t.return}}var x2=Math.ceil,ql=Ar.ReactCurrentDispatcher,hf=Ar.ReactCurrentOwner,Tn=Ar.ReactCurrentBatchConfig,We=0,Dt=null,mt=null,Bt=0,fn=0,js=xa(0),wt=0,ni=null,qa=0,Ac=0,ff=0,Po=null,nn=null,pf=0,Gs=1/0,Nr=null,Hl=!1,Kd=null,sa=null,Gi=!1,Yr=null,Gl=0,Fo=0,Xd=null,wl=-1,Nl=0;function Jt(){return We&6?ht():wl!==-1?wl:wl=ht()}function oa(e){return e.mode&1?We&2&&Bt!==0?Bt&-Bt:t2.transition!==null?(Nl===0&&(Nl=Kv()),Nl):(e=Ve,e!==0||(e=window.event,e=e===void 0?16:tx(e.type)),e):1}function Gn(e,t,n,r){if(50<Fo)throw Fo=0,Xd=null,Error(se(185));xi(e,n,r),(!(We&2)||e!==Dt)&&(e===Dt&&(!(We&2)&&(Ac|=n),wt===4&&Kr(e,Bt)),cn(e,r),n===1&&We===0&&!(t.mode&1)&&(Gs=ht()+500,Ec&&ya()))}function cn(e,t){var n=e.callbackNode;tw(e,t);var r=Dl(e,e===Dt?Bt:0);if(r===0)n!==null&&Kp(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Kp(n),t===1)e.tag===0?e2($m.bind(null,e)):bx($m.bind(null,e)),Yw(function(){!(We&6)&&ya()}),n=null;else{switch(Xv(r)){case 1:n=Bh;break;case 4:n=Hv;break;case 16:n=Rl;break;case 536870912:n=Gv;break;default:n=Rl}n=x0(n,d0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function d0(e,t){if(wl=-1,Nl=0,We&6)throw Error(se(327));var n=e.callbackNode;if(As()&&e.callbackNode!==n)return null;var r=Dl(e,e===Dt?Bt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Kl(e,r);else{t=r;var a=We;We|=2;var s=f0();(Dt!==e||Bt!==t)&&(Nr=null,Gs=ht()+500,Ba(e,t));do try{w2();break}catch(l){h0(e,l)}while(1);Jh(),ql.current=s,We=a,mt!==null?t=0:(Dt=null,Bt=0,t=wt)}if(t!==0){if(t===2&&(a=Nd(e),a!==0&&(r=a,t=Yd(e,a))),t===1)throw n=ni,Ba(e,0),Kr(e,r),cn(e,ht()),n;if(t===6)Kr(e,r);else{if(a=e.current.alternate,!(r&30)&&!y2(a)&&(t=Kl(e,r),t===2&&(s=Nd(e),s!==0&&(r=s,t=Yd(e,s))),t===1))throw n=ni,Ba(e,0),Kr(e,r),cn(e,ht()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(se(345));case 2:Ea(e,nn,Nr);break;case 3:if(Kr(e,r),(r&130023424)===r&&(t=pf+500-ht(),10<t)){if(Dl(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Jt(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Dd(Ea.bind(null,e,nn,Nr),t);break}Ea(e,nn,Nr);break;case 4:if(Kr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var o=31-Hn(r);s=1<<o,o=t[o],o>a&&(a=o),r&=~s}if(r=a,r=ht()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*x2(r/1960))-r,10<r){e.timeoutHandle=Dd(Ea.bind(null,e,nn,Nr),r);break}Ea(e,nn,Nr);break;case 5:Ea(e,nn,Nr);break;default:throw Error(se(329))}}}return cn(e,ht()),e.callbackNode===n?d0.bind(null,e):null}function Yd(e,t){var n=Po;return e.current.memoizedState.isDehydrated&&(Ba(e,t).flags|=256),e=Kl(e,t),e!==2&&(t=nn,nn=n,t!==null&&Qd(t)),e}function Qd(e){nn===null?nn=e:nn.push.apply(nn,e)}function y2(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],s=a.getSnapshot;a=a.value;try{if(!Xn(s(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kr(e,t){for(t&=~ff,t&=~Ac,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Hn(t),r=1<<n;e[n]=-1,t&=~r}}function $m(e){if(We&6)throw Error(se(327));As();var t=Dl(e,0);if(!(t&1))return cn(e,ht()),null;var n=Kl(e,t);if(e.tag!==0&&n===2){var r=Nd(e);r!==0&&(t=r,n=Yd(e,r))}if(n===1)throw n=ni,Ba(e,0),Kr(e,t),cn(e,ht()),n;if(n===6)throw Error(se(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ea(e,nn,Nr),cn(e,ht()),null}function mf(e,t){var n=We;We|=1;try{return e(t)}finally{We=n,We===0&&(Gs=ht()+500,Ec&&ya())}}function Ha(e){Yr!==null&&Yr.tag===0&&!(We&6)&&As();var t=We;We|=1;var n=Tn.transition,r=Ve;try{if(Tn.transition=null,Ve=1,e)return e()}finally{Ve=r,Tn.transition=n,We=t,!(We&6)&&ya()}}function gf(){fn=js.current,Ze(js)}function Ba(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Xw(n)),mt!==null)for(n=mt.return;n!==null;){var r=n;switch(Xh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Fl();break;case 3:qs(),Ze(on),Ze(Xt),af();break;case 5:rf(r);break;case 4:qs();break;case 13:Ze(nt);break;case 19:Ze(nt);break;case 10:Zh(r.type._context);break;case 22:case 23:gf()}n=n.return}if(Dt=e,mt=e=ia(e.current,null),Bt=fn=t,wt=0,ni=null,ff=Ac=qa=0,nn=Po=null,Ta!==null){for(t=0;t<Ta.length;t++)if(n=Ta[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=a,r.next=o}n.pending=r}Ta=null}return e}function h0(e,t){do{var n=mt;try{if(Jh(),xl.current=Vl,Ul){for(var r=st.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Ul=!1}if(Va=0,Rt=bt=st=null,Ao=!1,Zo=0,hf.current=null,n===null||n.return===null){wt=1,ni=t,mt=null;break}e:{var s=e,o=n.return,l=n,c=t;if(t=Bt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=l,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=Sm(o);if(p!==null){p.flags&=-257,Em(p,o,l,s,t),p.mode&1&&Cm(s,u,t),t=p,c=u;var m=t.updateQueue;if(m===null){var x=new Set;x.add(c),t.updateQueue=x}else m.add(c);break e}else{if(!(t&1)){Cm(s,u,t),vf();break e}c=Error(se(426))}}else if(tt&&l.mode&1){var y=Sm(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Em(y,o,l,s,t),Yh(Hs(c,l));break e}}s=c=Hs(c,l),wt!==4&&(wt=2),Po===null?Po=[s]:Po.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var g=Xx(s,c,t);bm(s,g);break e;case 1:l=c;var v=s.type,w=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(sa===null||!sa.has(w)))){s.flags|=65536,t&=-t,s.lanes|=t;var b=Yx(s,l,t);bm(s,b);break e}}s=s.return}while(s!==null)}m0(n)}catch(N){t=N,mt===n&&n!==null&&(mt=n=n.return);continue}break}while(1)}function f0(){var e=ql.current;return ql.current=Vl,e===null?Vl:e}function vf(){(wt===0||wt===3||wt===2)&&(wt=4),Dt===null||!(qa&268435455)&&!(Ac&268435455)||Kr(Dt,Bt)}function Kl(e,t){var n=We;We|=2;var r=f0();(Dt!==e||Bt!==t)&&(Nr=null,Ba(e,t));do try{b2();break}catch(a){h0(e,a)}while(1);if(Jh(),We=n,ql.current=r,mt!==null)throw Error(se(261));return Dt=null,Bt=0,wt}function b2(){for(;mt!==null;)p0(mt)}function w2(){for(;mt!==null&&!H1();)p0(mt)}function p0(e){var t=v0(e.alternate,e,fn);e.memoizedProps=e.pendingProps,t===null?m0(e):mt=t,hf.current=null}function m0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=p2(n,t),n!==null){n.flags&=32767,mt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{wt=6,mt=null;return}}else if(n=f2(n,t,fn),n!==null){mt=n;return}if(t=t.sibling,t!==null){mt=t;return}mt=t=e}while(t!==null);wt===0&&(wt=5)}function Ea(e,t,n){var r=Ve,a=Tn.transition;try{Tn.transition=null,Ve=1,N2(e,t,n,r)}finally{Tn.transition=a,Ve=r}return null}function N2(e,t,n,r){do As();while(Yr!==null);if(We&6)throw Error(se(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(se(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(nw(e,s),e===Dt&&(mt=Dt=null,Bt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Gi||(Gi=!0,x0(Rl,function(){return As(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Tn.transition,Tn.transition=null;var o=Ve;Ve=1;var l=We;We|=4,hf.current=null,g2(e,n),c0(n,e),zw(Ed),Il=!!Sd,Ed=Sd=null,e.current=n,v2(n),G1(),We=l,Ve=o,Tn.transition=s}else e.current=n;if(Gi&&(Gi=!1,Yr=e,Gl=a),s=e.pendingLanes,s===0&&(sa=null),Y1(n.stateNode),cn(e,ht()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Hl)throw Hl=!1,e=Kd,Kd=null,e;return Gl&1&&e.tag!==0&&As(),s=e.pendingLanes,s&1?e===Xd?Fo++:(Fo=0,Xd=e):Fo=0,ya(),null}function As(){if(Yr!==null){var e=Xv(Gl),t=Tn.transition,n=Ve;try{if(Tn.transition=null,Ve=16>e?16:e,Yr===null)var r=!1;else{if(e=Yr,Yr=null,Gl=0,We&6)throw Error(se(331));var a=We;for(We|=4,fe=e.current;fe!==null;){var s=fe,o=s.child;if(fe.flags&16){var l=s.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(fe=u;fe!==null;){var d=fe;switch(d.tag){case 0:case 11:case 15:To(8,d,s)}var h=d.child;if(h!==null)h.return=d,fe=h;else for(;fe!==null;){d=fe;var f=d.sibling,p=d.return;if(o0(d),d===u){fe=null;break}if(f!==null){f.return=p,fe=f;break}fe=p}}}var m=s.alternate;if(m!==null){var x=m.child;if(x!==null){m.child=null;do{var y=x.sibling;x.sibling=null,x=y}while(x!==null)}}fe=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,fe=o;else e:for(;fe!==null;){if(s=fe,s.flags&2048)switch(s.tag){case 0:case 11:case 15:To(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,fe=g;break e}fe=s.return}}var v=e.current;for(fe=v;fe!==null;){o=fe;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,fe=w;else e:for(o=v;fe!==null;){if(l=fe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Ic(9,l)}}catch(N){ct(l,l.return,N)}if(l===o){fe=null;break e}var b=l.sibling;if(b!==null){b.return=l.return,fe=b;break e}fe=l.return}}if(We=a,ya(),cr&&typeof cr.onPostCommitFiberRoot=="function")try{cr.onPostCommitFiberRoot(_c,e)}catch{}r=!0}return r}finally{Ve=n,Tn.transition=t}}return!1}function Wm(e,t,n){t=Hs(n,t),t=Xx(e,t,1),e=aa(e,t,1),t=Jt(),e!==null&&(xi(e,1,t),cn(e,t))}function ct(e,t,n){if(e.tag===3)Wm(e,e,n);else for(;t!==null;){if(t.tag===3){Wm(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(sa===null||!sa.has(r))){e=Hs(n,e),e=Yx(t,e,1),t=aa(t,e,1),e=Jt(),t!==null&&(xi(t,1,e),cn(t,e));break}}t=t.return}}function _2(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Jt(),e.pingedLanes|=e.suspendedLanes&n,Dt===e&&(Bt&n)===n&&(wt===4||wt===3&&(Bt&130023424)===Bt&&500>ht()-pf?Ba(e,0):ff|=n),cn(e,t)}function g0(e,t){t===0&&(e.mode&1?(t=Oi,Oi<<=1,!(Oi&130023424)&&(Oi=4194304)):t=1);var n=Jt();e=Dr(e,t),e!==null&&(xi(e,t,n),cn(e,n))}function j2(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),g0(e,n)}function k2(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(se(314))}r!==null&&r.delete(t),g0(e,n)}var v0;v0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||on.current)sn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return sn=!1,h2(e,t,n);sn=!!(e.flags&131072)}else sn=!1,tt&&t.flags&1048576&&wx(t,Ll,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;bl(e,t),e=t.pendingProps;var a=zs(t,Xt.current);Is(t,n),a=of(null,t,r,e,a,n);var s=lf();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ln(r)?(s=!0,Ml(t)):s=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,tf(t),a.updater=Dc,t.stateNode=a,a._reactInternals=t,Od(t,r,e,n),t=$d(null,t,r,!0,s,n)):(t.tag=0,tt&&s&&Kh(t),Qt(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(bl(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=S2(r),e=Bn(r,e),a){case 0:t=Bd(null,t,r,e,n);break e;case 1:t=Im(null,t,r,e,n);break e;case 11:t=Rm(null,t,r,e,n);break e;case 14:t=Dm(null,t,r,Bn(r.type,e),n);break e}throw Error(se(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Bn(r,a),Bd(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Bn(r,a),Im(e,t,r,a,n);case 3:e:{if(e0(t),e===null)throw Error(se(387));r=t.pendingProps,s=t.memoizedState,a=s.element,Sx(e,t),Wl(t,r,null,n);var o=t.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){a=Hs(Error(se(423)),t),t=Am(e,t,r,n,a);break e}else if(r!==a){a=Hs(Error(se(424)),t),t=Am(e,t,r,n,a);break e}else for(vn=ra(t.stateNode.containerInfo.firstChild),wn=t,tt=!0,zn=null,n=kx(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Us(),r===a){t=Ir(e,t,n);break e}Qt(e,t,r,n)}t=t.child}return t;case 5:return Ex(t),e===null&&Pd(t),r=t.type,a=t.pendingProps,s=e!==null?e.memoizedProps:null,o=a.children,Rd(r,a)?o=null:s!==null&&Rd(r,s)&&(t.flags|=32),Zx(e,t),Qt(e,t,o,n),t.child;case 6:return e===null&&Pd(t),null;case 13:return t0(e,t,n);case 4:return nf(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Vs(t,null,r,n):Qt(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Bn(r,a),Rm(e,t,r,a,n);case 7:return Qt(e,t,t.pendingProps,n),t.child;case 8:return Qt(e,t,t.pendingProps.children,n),t.child;case 12:return Qt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,s=t.memoizedProps,o=a.value,Ge(Bl,r._currentValue),r._currentValue=o,s!==null)if(Xn(s.value,o)){if(s.children===a.children&&!on.current){t=Ir(e,t,n);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var l=s.dependencies;if(l!==null){o=s.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(s.tag===1){c=Sr(-1,n&-n),c.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),Fd(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===t.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(se(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Fd(o,n,t),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Qt(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Is(t,n),a=Pn(a),r=r(a),t.flags|=1,Qt(e,t,r,n),t.child;case 14:return r=t.type,a=Bn(r,t.pendingProps),a=Bn(r.type,a),Dm(e,t,r,a,n);case 15:return Qx(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Bn(r,a),bl(e,t),t.tag=1,ln(r)?(e=!0,Ml(t)):e=!1,Is(t,n),Kx(t,r,a),Od(t,r,a,n),$d(null,t,r,!0,e,n);case 19:return n0(e,t,n);case 22:return Jx(e,t,n)}throw Error(se(156,t.tag))};function x0(e,t){return qv(e,t)}function C2(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function In(e,t,n,r){return new C2(e,t,n,r)}function xf(e){return e=e.prototype,!(!e||!e.isReactComponent)}function S2(e){if(typeof e=="function")return xf(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Mh)return 11;if(e===Oh)return 14}return 2}function ia(e,t){var n=e.alternate;return n===null?(n=In(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function _l(e,t,n,r,a,s){var o=2;if(r=e,typeof e=="function")xf(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case ps:return $a(n.children,a,s,t);case Fh:o=8,a|=8;break;case id:return e=In(12,n,t,a|2),e.elementType=id,e.lanes=s,e;case ld:return e=In(13,n,t,a),e.elementType=ld,e.lanes=s,e;case cd:return e=In(19,n,t,a),e.elementType=cd,e.lanes=s,e;case Ev:return Tc(n,a,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Cv:o=10;break e;case Sv:o=9;break e;case Mh:o=11;break e;case Oh:o=14;break e;case qr:o=16,r=null;break e}throw Error(se(130,e==null?e:typeof e,""))}return t=In(o,n,t,a),t.elementType=e,t.type=r,t.lanes=s,t}function $a(e,t,n,r){return e=In(7,e,r,t),e.lanes=n,e}function Tc(e,t,n,r){return e=In(22,e,r,t),e.elementType=Ev,e.lanes=n,e.stateNode={isHidden:!1},e}function ku(e,t,n){return e=In(6,e,null,t),e.lanes=n,e}function Cu(e,t,n){return t=In(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function E2(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ou(0),this.expirationTimes=ou(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ou(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function yf(e,t,n,r,a,s,o,l,c){return e=new E2(e,t,n,l,c),t===1?(t=1,s===!0&&(t|=8)):t=0,s=In(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},tf(s),e}function R2(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fs,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function y0(e){if(!e)return pa;e=e._reactInternals;e:{if(Qa(e)!==e||e.tag!==1)throw Error(se(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ln(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(se(171))}if(e.tag===1){var n=e.type;if(ln(n))return yx(e,n,t)}return t}function b0(e,t,n,r,a,s,o,l,c){return e=yf(n,r,!0,e,a,s,o,l,c),e.context=y0(null),n=e.current,r=Jt(),a=oa(n),s=Sr(r,a),s.callback=t??null,aa(n,s,a),e.current.lanes=a,xi(e,a,r),cn(e,r),e}function Pc(e,t,n,r){var a=t.current,s=Jt(),o=oa(a);return n=y0(n),t.context===null?t.context=n:t.pendingContext=n,t=Sr(s,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=aa(a,t,o),e!==null&&(Gn(e,a,o,s),vl(e,a,o)),o}function Xl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function zm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function bf(e,t){zm(e,t),(e=e.alternate)&&zm(e,t)}function D2(){return null}var w0=typeof reportError=="function"?reportError:function(e){console.error(e)};function wf(e){this._internalRoot=e}Fc.prototype.render=wf.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(se(409));Pc(e,t,null,null)};Fc.prototype.unmount=wf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ha(function(){Pc(null,e,null,null)}),t[Rr]=null}};function Fc(e){this._internalRoot=e}Fc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Jv();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Gr.length&&t!==0&&t<Gr[n].priority;n++);Gr.splice(n,0,e),n===0&&ex(e)}};function Nf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Mc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Um(){}function I2(e,t,n,r,a){if(a){if(typeof r=="function"){var s=r;r=function(){var u=Xl(o);s.call(u)}}var o=b0(t,r,e,0,null,!1,!1,"",Um);return e._reactRootContainer=o,e[Rr]=o.current,Ko(e.nodeType===8?e.parentNode:e),Ha(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var u=Xl(c);l.call(u)}}var c=yf(e,0,!1,null,null,!1,!1,"",Um);return e._reactRootContainer=c,e[Rr]=c.current,Ko(e.nodeType===8?e.parentNode:e),Ha(function(){Pc(t,c,n,r)}),c}function Oc(e,t,n,r,a){var s=n._reactRootContainer;if(s){var o=s;if(typeof a=="function"){var l=a;a=function(){var c=Xl(o);l.call(c)}}Pc(t,o,e,a)}else o=I2(n,t,e,a,r);return Xl(o)}Yv=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ko(t.pendingLanes);n!==0&&($h(t,n|1),cn(t,ht()),!(We&6)&&(Gs=ht()+500,ya()))}break;case 13:Ha(function(){var r=Dr(e,1);if(r!==null){var a=Jt();Gn(r,e,1,a)}}),bf(e,1)}};Wh=function(e){if(e.tag===13){var t=Dr(e,134217728);if(t!==null){var n=Jt();Gn(t,e,134217728,n)}bf(e,134217728)}};Qv=function(e){if(e.tag===13){var t=oa(e),n=Dr(e,t);if(n!==null){var r=Jt();Gn(n,e,t,r)}bf(e,t)}};Jv=function(){return Ve};Zv=function(e,t){var n=Ve;try{return Ve=e,t()}finally{Ve=n}};yd=function(e,t,n){switch(t){case"input":if(hd(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=Sc(r);if(!a)throw Error(se(90));Dv(r),hd(r,a)}}}break;case"textarea":Av(e,n);break;case"select":t=n.value,t!=null&&Ss(e,!!n.multiple,t,!1)}};Bv=mf;$v=Ha;var A2={usingClientEntryPoint:!1,Events:[bi,xs,Sc,Ov,Lv,mf]},vo={findFiberByHostInstance:Aa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},T2={bundleType:vo.bundleType,version:vo.version,rendererPackageName:vo.rendererPackageName,rendererConfig:vo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ar.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Uv(e),e===null?null:e.stateNode},findFiberByHostInstance:vo.findFiberByHostInstance||D2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ki=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ki.isDisabled&&Ki.supportsFiber)try{_c=Ki.inject(T2),cr=Ki}catch{}}jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=A2;jn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nf(t))throw Error(se(200));return R2(e,t,null,n)};jn.createRoot=function(e,t){if(!Nf(e))throw Error(se(299));var n=!1,r="",a=w0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=yf(e,1,!1,null,null,n,!1,r,a),e[Rr]=t.current,Ko(e.nodeType===8?e.parentNode:e),new wf(t)};jn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(se(188)):(e=Object.keys(e).join(","),Error(se(268,e)));return e=Uv(t),e=e===null?null:e.stateNode,e};jn.flushSync=function(e){return Ha(e)};jn.hydrate=function(e,t,n){if(!Mc(t))throw Error(se(200));return Oc(null,e,t,!0,n)};jn.hydrateRoot=function(e,t,n){if(!Nf(e))throw Error(se(405));var r=n!=null&&n.hydratedSources||null,a=!1,s="",o=w0;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=b0(t,null,e,1,n??null,a,!1,s,o),e[Rr]=t.current,Ko(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Fc(t)};jn.render=function(e,t,n){if(!Mc(t))throw Error(se(200));return Oc(null,e,t,!1,n)};jn.unmountComponentAtNode=function(e){if(!Mc(e))throw Error(se(40));return e._reactRootContainer?(Ha(function(){Oc(null,null,e,!1,function(){e._reactRootContainer=null,e[Rr]=null})}),!0):!1};jn.unstable_batchedUpdates=mf;jn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Mc(n))throw Error(se(200));if(e==null||e._reactInternals===void 0)throw Error(se(38));return Oc(e,t,n,!1,r)};jn.version="18.3.1-next-f1338f8080-20240426";function N0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(N0)}catch(e){console.error(e)}}N0(),Nv.exports=jn;var P2=Nv.exports,Vm=P2;sd.createRoot=Vm.createRoot,sd.hydrateRoot=Vm.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ri(){return ri=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ri.apply(this,arguments)}var Qr;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Qr||(Qr={}));const qm="popstate";function F2(e){e===void 0&&(e={});function t(r,a){let{pathname:s,search:o,hash:l}=r.location;return Jd("",{pathname:s,search:o,hash:l},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:Yl(a)}return O2(t,n,null,e)}function pt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function _0(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function M2(){return Math.random().toString(36).substr(2,8)}function Hm(e,t){return{usr:e.state,key:e.key,idx:t}}function Jd(e,t,n,r){return n===void 0&&(n=null),ri({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?no(t):t,{state:n,key:t&&t.key||r||M2()})}function Yl(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function no(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function O2(e,t,n,r){r===void 0&&(r={});let{window:a=document.defaultView,v5Compat:s=!1}=r,o=a.history,l=Qr.Pop,c=null,u=d();u==null&&(u=0,o.replaceState(ri({},o.state,{idx:u}),""));function d(){return(o.state||{idx:null}).idx}function h(){l=Qr.Pop;let y=d(),g=y==null?null:y-u;u=y,c&&c({action:l,location:x.location,delta:g})}function f(y,g){l=Qr.Push;let v=Jd(x.location,y,g);n&&n(v,y),u=d()+1;let w=Hm(v,u),b=x.createHref(v);try{o.pushState(w,"",b)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;a.location.assign(b)}s&&c&&c({action:l,location:x.location,delta:1})}function p(y,g){l=Qr.Replace;let v=Jd(x.location,y,g);n&&n(v,y),u=d();let w=Hm(v,u),b=x.createHref(v);o.replaceState(w,"",b),s&&c&&c({action:l,location:x.location,delta:0})}function m(y){let g=a.location.origin!=="null"?a.location.origin:a.location.href,v=typeof y=="string"?y:Yl(y);return v=v.replace(/ $/,"%20"),pt(g,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,g)}let x={get action(){return l},get location(){return e(a,o)},listen(y){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(qm,h),c=y,()=>{a.removeEventListener(qm,h),c=null}},createHref(y){return t(a,y)},createURL:m,encodeLocation(y){let g=m(y);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:p,go(y){return o.go(y)}};return x}var Gm;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Gm||(Gm={}));function L2(e,t,n){return n===void 0&&(n="/"),B2(e,t,n,!1)}function B2(e,t,n,r){let a=typeof t=="string"?no(t):t,s=_f(a.pathname||"/",n);if(s==null)return null;let o=j0(e);$2(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let u=Q2(s);l=X2(o[c],u,r)}return l}function j0(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let a=(s,o,l)=>{let c={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};c.relativePath.startsWith("/")&&(pt(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let u=la([r,c.relativePath]),d=n.concat(c);s.children&&s.children.length>0&&(pt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),j0(s.children,t,d,u)),!(s.path==null&&!s.index)&&t.push({path:u,score:G2(u,s.index),routesMeta:d})};return e.forEach((s,o)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))a(s,o);else for(let c of k0(s.path))a(s,o,c)}),t}function k0(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,a=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return a?[s,""]:[s];let o=k0(r.join("/")),l=[];return l.push(...o.map(c=>c===""?s:[s,c].join("/"))),a&&l.push(...o),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function $2(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:K2(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const W2=/^:[\w-]+$/,z2=3,U2=2,V2=1,q2=10,H2=-2,Km=e=>e==="*";function G2(e,t){let n=e.split("/"),r=n.length;return n.some(Km)&&(r+=H2),t&&(r+=U2),n.filter(a=>!Km(a)).reduce((a,s)=>a+(W2.test(s)?z2:s===""?V2:q2),r)}function K2(e,t){return e.length===t.length&&e.slice(0,-1).every((r,a)=>r===t[a])?e[e.length-1]-t[t.length-1]:0}function X2(e,t,n){n===void 0&&(n=!1);let{routesMeta:r}=e,a={},s="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],u=l===r.length-1,d=s==="/"?t:t.slice(s.length)||"/",h=Xm({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),f=c.route;if(!h&&u&&n&&!r[r.length-1].route.index&&(h=Xm({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!h)return null;Object.assign(a,h.params),o.push({params:a,pathname:la([s,h.pathname]),pathnameBase:tN(la([s,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(s=la([s,h.pathnameBase]))}return o}function Xm(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=Y2(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let s=a[0],o=s.replace(/(.)\/+$/,"$1"),l=a.slice(1);return{params:r.reduce((u,d,h)=>{let{paramName:f,isOptional:p}=d;if(f==="*"){let x=l[h]||"";o=s.slice(0,s.length-x.length).replace(/(.)\/+$/,"$1")}const m=l[h];return p&&!m?u[f]=void 0:u[f]=(m||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:o,pattern:e}}function Y2(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),_0(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),r]}function Q2(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return _0(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function _f(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function J2(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:a=""}=typeof e=="string"?no(e):e;return{pathname:n?n.startsWith("/")?n:Z2(n,t):t,search:nN(r),hash:rN(a)}}function Z2(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function Su(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function eN(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function jf(e,t){let n=eN(e);return t?n.map((r,a)=>a===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function kf(e,t,n,r){r===void 0&&(r=!1);let a;typeof e=="string"?a=no(e):(a=ri({},e),pt(!a.pathname||!a.pathname.includes("?"),Su("?","pathname","search",a)),pt(!a.pathname||!a.pathname.includes("#"),Su("#","pathname","hash",a)),pt(!a.search||!a.search.includes("#"),Su("#","search","hash",a)));let s=e===""||a.pathname==="",o=s?"/":a.pathname,l;if(o==null)l=n;else{let h=t.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;a.pathname=f.join("/")}l=h>=0?t[h]:"/"}let c=J2(a,l),u=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const la=e=>e.join("/").replace(/\/\/+/g,"/"),tN=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),nN=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,rN=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function aN(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const C0=["post","put","patch","delete"];new Set(C0);const sN=["get",...C0];new Set(sN);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ai(){return ai=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ai.apply(this,arguments)}const Cf=E.createContext(null),oN=E.createContext(null),ba=E.createContext(null),Lc=E.createContext(null),Tr=E.createContext({outlet:null,matches:[],isDataRoute:!1}),S0=E.createContext(null);function iN(e,t){let{relative:n}=t===void 0?{}:t;ro()||pt(!1);let{basename:r,navigator:a}=E.useContext(ba),{hash:s,pathname:o,search:l}=R0(e,{relative:n}),c=o;return r!=="/"&&(c=o==="/"?r:la([r,o])),a.createHref({pathname:c,search:l,hash:s})}function ro(){return E.useContext(Lc)!=null}function Pr(){return ro()||pt(!1),E.useContext(Lc).location}function E0(e){E.useContext(ba).static||E.useLayoutEffect(e)}function Yn(){let{isDataRoute:e}=E.useContext(Tr);return e?NN():lN()}function lN(){ro()||pt(!1);let e=E.useContext(Cf),{basename:t,future:n,navigator:r}=E.useContext(ba),{matches:a}=E.useContext(Tr),{pathname:s}=Pr(),o=JSON.stringify(jf(a,n.v7_relativeSplatPath)),l=E.useRef(!1);return E0(()=>{l.current=!0}),E.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){r.go(u);return}let h=kf(u,JSON.parse(o),s,d.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:la([t,h.pathname])),(d.replace?r.replace:r.push)(h,d.state,d)},[t,r,o,s,e])}const cN=E.createContext(null);function uN(e){let t=E.useContext(Tr).outlet;return t&&E.createElement(cN.Provider,{value:e},t)}function R0(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=E.useContext(ba),{matches:a}=E.useContext(Tr),{pathname:s}=Pr(),o=JSON.stringify(jf(a,r.v7_relativeSplatPath));return E.useMemo(()=>kf(e,JSON.parse(o),s,n==="path"),[e,o,s,n])}function dN(e,t){return hN(e,t)}function hN(e,t,n,r){ro()||pt(!1);let{navigator:a}=E.useContext(ba),{matches:s}=E.useContext(Tr),o=s[s.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let u=Pr(),d;if(t){var h;let y=typeof t=="string"?no(t):t;c==="/"||(h=y.pathname)!=null&&h.startsWith(c)||pt(!1),d=y}else d=u;let f=d.pathname||"/",p=f;if(c!=="/"){let y=c.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(y.length).join("/")}let m=L2(e,{pathname:p}),x=vN(m&&m.map(y=>Object.assign({},y,{params:Object.assign({},l,y.params),pathname:la([c,a.encodeLocation?a.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?c:la([c,a.encodeLocation?a.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),s,n,r);return t&&x?E.createElement(Lc.Provider,{value:{location:ai({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Qr.Pop}},x):x}function fN(){let e=wN(),t=aN(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},s=null;return E.createElement(E.Fragment,null,E.createElement("h2",null,"Unexpected Application Error!"),E.createElement("h3",{style:{fontStyle:"italic"}},t),n?E.createElement("pre",{style:a},n):null,s)}const pN=E.createElement(fN,null);class mN extends E.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?E.createElement(Tr.Provider,{value:this.props.routeContext},E.createElement(S0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function gN(e){let{routeContext:t,match:n,children:r}=e,a=E.useContext(Cf);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),E.createElement(Tr.Provider,{value:t},r)}function vN(e,t,n,r){var a;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var s;if(!n)return null;if(n.errors)e=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let o=e,l=(a=n)==null?void 0:a.errors;if(l!=null){let d=o.findIndex(h=>h.route.id&&(l==null?void 0:l[h.route.id])!==void 0);d>=0||pt(!1),o=o.slice(0,Math.min(o.length,d+1))}let c=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let d=0;d<o.length;d++){let h=o[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=d),h.route.id){let{loaderData:f,errors:p}=n,m=h.route.loader&&f[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||m){c=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((d,h,f)=>{let p,m=!1,x=null,y=null;n&&(p=l&&h.route.id?l[h.route.id]:void 0,x=h.route.errorElement||pN,c&&(u<0&&f===0?(_N("route-fallback",!1),m=!0,y=null):u===f&&(m=!0,y=h.route.hydrateFallbackElement||null)));let g=t.concat(o.slice(0,f+1)),v=()=>{let w;return p?w=x:m?w=y:h.route.Component?w=E.createElement(h.route.Component,null):h.route.element?w=h.route.element:w=d,E.createElement(gN,{match:h,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:w})};return n&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?E.createElement(mN,{location:n.location,revalidation:n.revalidation,component:x,error:p,children:v(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):v()},null)}var D0=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(D0||{}),Ql=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ql||{});function xN(e){let t=E.useContext(Cf);return t||pt(!1),t}function yN(e){let t=E.useContext(oN);return t||pt(!1),t}function bN(e){let t=E.useContext(Tr);return t||pt(!1),t}function I0(e){let t=bN(),n=t.matches[t.matches.length-1];return n.route.id||pt(!1),n.route.id}function wN(){var e;let t=E.useContext(S0),n=yN(Ql.UseRouteError),r=I0(Ql.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function NN(){let{router:e}=xN(D0.UseNavigateStable),t=I0(Ql.UseNavigateStable),n=E.useRef(!1);return E0(()=>{n.current=!0}),E.useCallback(function(a,s){s===void 0&&(s={}),n.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,ai({fromRouteId:t},s)))},[e,t])}const Ym={};function _N(e,t,n){!t&&!Ym[e]&&(Ym[e]=!0)}function jN(e,t){e==null||e.v7_startTransition,(e==null?void 0:e.v7_relativeSplatPath)===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function Sf(e){let{to:t,replace:n,state:r,relative:a}=e;ro()||pt(!1);let{future:s,static:o}=E.useContext(ba),{matches:l}=E.useContext(Tr),{pathname:c}=Pr(),u=Yn(),d=kf(t,jf(l,s.v7_relativeSplatPath),c,a==="path"),h=JSON.stringify(d);return E.useEffect(()=>u(JSON.parse(h),{replace:n,state:r,relative:a}),[u,h,a,n,r]),null}function kN(e){return uN(e.context)}function xt(e){pt(!1)}function CN(e){let{basename:t="/",children:n=null,location:r,navigationType:a=Qr.Pop,navigator:s,static:o=!1,future:l}=e;ro()&&pt(!1);let c=t.replace(/^\/*/,"/"),u=E.useMemo(()=>({basename:c,navigator:s,static:o,future:ai({v7_relativeSplatPath:!1},l)}),[c,l,s,o]);typeof r=="string"&&(r=no(r));let{pathname:d="/",search:h="",hash:f="",state:p=null,key:m="default"}=r,x=E.useMemo(()=>{let y=_f(d,c);return y==null?null:{location:{pathname:y,search:h,hash:f,state:p,key:m},navigationType:a}},[c,d,h,f,p,m,a]);return x==null?null:E.createElement(ba.Provider,{value:u},E.createElement(Lc.Provider,{children:n,value:x}))}function SN(e){let{children:t,location:n}=e;return dN(Zd(t),n)}new Promise(()=>{});function Zd(e,t){t===void 0&&(t=[]);let n=[];return E.Children.forEach(e,(r,a)=>{if(!E.isValidElement(r))return;let s=[...t,a];if(r.type===E.Fragment){n.push.apply(n,Zd(r.props.children,s));return}r.type!==xt&&pt(!1),!r.props.index||!r.props.children||pt(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Zd(r.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function eh(){return eh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},eh.apply(this,arguments)}function EN(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,s;for(s=0;s<r.length;s++)a=r[s],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function RN(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function DN(e,t){return e.button===0&&(!t||t==="_self")&&!RN(e)}const IN=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],AN="6";try{window.__reactRouterVersion=AN}catch{}const TN="startTransition",Qm=_1[TN];function PN(e){let{basename:t,children:n,future:r,window:a}=e,s=E.useRef();s.current==null&&(s.current=F2({window:a,v5Compat:!0}));let o=s.current,[l,c]=E.useState({action:o.action,location:o.location}),{v7_startTransition:u}=r||{},d=E.useCallback(h=>{u&&Qm?Qm(()=>c(h)):c(h)},[c,u]);return E.useLayoutEffect(()=>o.listen(d),[o,d]),E.useEffect(()=>jN(r),[r]),E.createElement(CN,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}const FN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",MN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Fa=E.forwardRef(function(t,n){let{onClick:r,relative:a,reloadDocument:s,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:h}=t,f=EN(t,IN),{basename:p}=E.useContext(ba),m,x=!1;if(typeof u=="string"&&MN.test(u)&&(m=u,FN))try{let w=new URL(window.location.href),b=u.startsWith("//")?new URL(w.protocol+u):new URL(u),N=_f(b.pathname,p);b.origin===w.origin&&N!=null?u=N+b.search+b.hash:x=!0}catch{}let y=iN(u,{relative:a}),g=ON(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:a,viewTransition:h});function v(w){r&&r(w),w.defaultPrevented||g(w)}return E.createElement("a",eh({},f,{href:m||y,onClick:x||s?r:v,ref:n,target:c}))});var Jm;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Jm||(Jm={}));var Zm;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Zm||(Zm={}));function ON(e,t){let{target:n,replace:r,state:a,preventScrollReset:s,relative:o,viewTransition:l}=t===void 0?{}:t,c=Yn(),u=Pr(),d=R0(e,{relative:o});return E.useCallback(h=>{if(DN(h,n)){h.preventDefault();let f=r!==void 0?r:Yl(u)===Yl(d);c(e,{replace:f,state:a,preventScrollReset:s,relative:o,viewTransition:l})}},[u,c,d,r,a,n,e,s,o,l])}/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LN=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),BN=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),eg=e=>{const t=BN(e);return t.charAt(0).toUpperCase()+t.slice(1)},A0=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),$N=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var WN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zN=E.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:s,iconNode:o,...l},c)=>E.createElement("svg",{ref:c,...WN,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:A0("lucide",a),...!s&&!$N(l)&&{"aria-hidden":"true"},...l},[...o.map(([u,d])=>E.createElement(u,d)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=(e,t)=>{const n=E.forwardRef(({className:r,...a},s)=>E.createElement(zN,{ref:s,iconNode:t,className:A0(`lucide-${LN(eg(e))}`,`lucide-${e}`,r),...a}));return n.displayName=eg(e),n};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],VN=Se("activity",UN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qN=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],th=Se("archive",qN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],GN=Se("building",HN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]],XN=Se("calendar-check",KN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ke=Se("calendar",YN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QN=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ks=Se("camera",QN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JN=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Eu=Se("chart-column",JN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZN=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],e_=Se("chevron-down",ZN);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t_=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],T0=Se("chevron-left",t_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n_=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ef=Se("chevron-right",n_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],vt=Se("circle-alert",r_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],s_=Se("circle-check",a_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o_=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Lt=Se("circle-check-big",o_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],l_=Se("circle-plus",i_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],u_=Se("circle-user",c_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d_=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ao=Se("circle-x",d_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h_=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],Ru=Se("clipboard-check",h_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f_=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],He=Se("clock",f_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],m_=Se("coffee",p_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],nh=Se("copy",g_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],si=Se("download",v_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],P0=Se("eye",x_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],mn=Se("file-text",y_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Rf=Se("funnel",b_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],N_=Se("house",w_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],j_=Se("info",__);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k_=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],xo=Se("key",k_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C_=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],S_=Se("layout-dashboard",C_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E_=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],oi=Se("loader-circle",E_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R_=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ks=Se("log-out",R_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D_=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ii=Se("lock",D_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I_=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Wn=Se("mail",I_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A_=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],T_=Se("map-pin",A_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P_=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],F0=Se("menu",P_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F_=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],M_=Se("message-square",F_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O_=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],L_=Se("paperclip",O_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B_=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],tg=Se("pen-line",B_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $_=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Ma=Se("phone",$_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W_=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ga=Se("plus",W_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z_=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],rh=Se("refresh-cw",z_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U_=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],ng=Se("scale",U_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V_=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],rg=Se("search",V_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q_=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Df=Se("settings",q_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H_=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],G_=Se("shield-check",H_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K_=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],ag=Se("shield",K_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X_=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ca=Se("square-pen",X_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y_=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],li=Se("trash-2",Y_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q_=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ah=Se("trending-up",Q_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J_=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ci=Se("users",J_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z_=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Vn=Se("user",Z_);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ej=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],tj=Se("wifi-off",ej);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nj=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],rj=Se("wifi",nj);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aj=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Mn=Se("x",aj),sj="https://kiosk.quriousclick.es/api";class oj{constructor(){this.baseURL=sj}async request(t,n={}){const r=`${this.baseURL}${t}`,a=localStorage.getItem("authToken"),{headers:s={},...o}=n,l=o.body instanceof FormData,c={headers:{Accept:"application/json",...a&&{Authorization:`Bearer ${a}`},...l?{}:{"Content-Type":"application/json"},...s},...o};try{const u=await fetch(r,c);if(!u.ok){let h;const f=u.headers.get("content-type");if(f&&f.includes("application/json")){if(h=await u.json(),u.status===422&&h.errors)throw{message:Object.values(h.errors).flat().join(" ")}}else h={message:await u.text()};throw h}const d=u.headers.get("content-type");if(d&&d.includes("application/json"))return n.responseType==="blob"?u.blob():u.json();throw{message:`Server returned HTML instead of JSON: ${(await u.text()).substring(0,100)}...`}}catch(u){throw console.error("API request failed:",u),u}}async get(t,n={}){return this.request(t,{method:"GET",...n})}async post(t,n,r={}){const a=n instanceof FormData?n:JSON.stringify(n);return this.request(t,{method:"POST",body:a,...r})}async put(t,n,r={}){const a=n instanceof FormData?n:JSON.stringify(n);return this.request(t,{method:"PUT",body:a,...r})}async delete(t,n={}){return this.request(t,{method:"DELETE",...n})}async login(t){const n=await this.post("/login",t);return localStorage.setItem("authToken",n.token),n}async logout(){try{await this.request("/logout",{method:"POST"})}finally{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("isAuthenticated")}}async getCurrentUser(){return this.request("/user")}async getEmployees(){return this.request("/employees")}async createEmployee(t){const n=t instanceof FormData;return this.request("/employees",{method:"POST",body:n?t:JSON.stringify(t)})}async updateEmployee(t,n){const r=n instanceof FormData;return this.request(`/employees/${t}`,{method:"PUT",body:r?n:JSON.stringify(n)})}async deleteEmployee(t){return this.request(`/employees/${t}`,{method:"DELETE"})}async getPolicies(){return this.request("/policies")}async createPolicy(t){return this.request("/policies",{method:"POST",body:JSON.stringify(t)})}async updatePolicy(t,n){return this.request(`/policies/${t}`,{method:"PUT",body:JSON.stringify(n)})}async deletePolicy(t){return this.request(`/policies/${t}`,{method:"DELETE"})}async togglePolicyStatus(t){return this.request(`/policies/${t}/toggle-status`,{method:"PATCH"})}async getLeavePolicies(t={}){const n=new URLSearchParams(t).toString(),r=n?`/leave-policies?${n}`:"/leave-policies";return this.request(r)}async createLeavePolicy(t){return this.request("/leave-policies",{method:"POST",body:JSON.stringify(t)})}async updateLeavePolicy(t,n){return this.request(`/leave-policies/${t}`,{method:"PUT",body:JSON.stringify(n)})}async copyLeavePolicy(t){return this.request(`/leave-policies/${t}/copy`,{method:"POST"})}async toggleLeavePolicyStatus(t){return this.request(`/leave-policies/${t}/toggle-status`,{method:"PATCH"})}async deleteLeavePolicy(t){return this.request(`/leave-policies/${t}`,{method:"DELETE"})}async getEmployeeLeavePolicies(t){return this.request(`/employees/${t}/leave-policies`)}async assignLeavePolicies(t,n){return this.request(`/employees/${t}/leave-policies`,{method:"POST",body:JSON.stringify({policy_ids:n})})}async detachLeavePolicy(t,n){return this.request(`/employees/${t}/leave-policies/${n}`,{method:"DELETE"})}async getLeaveRequests(t={}){const n=new URLSearchParams(t).toString(),r=n?`/leave/requests?${n}`:"/leave/requests";return this.request(r)}async getLeaveRequest(t){return this.request(`/leave/requests/${t}`)}async getLeaveApprovals(t={}){const n=new URLSearchParams(t).toString(),r=n?`/leave/approvals?${n}`:"/leave/approvals";return this.request(r)}async createLeaveRequest(t){return this.request("/leave/requests",{method:"POST",body:t})}async cancelLeaveRequest(t){return this.request(`/leave/requests/${t}/cancel`,{method:"POST"})}async approveLeaveRequest(t,n={}){return this.request(`/leave/requests/${t}/approve`,{method:"POST",body:JSON.stringify(n)})}async rejectLeaveRequest(t,n={}){return this.request(`/leave/requests/${t}/reject`,{method:"POST",body:JSON.stringify(n)})}async requestLeaveClarification(t,n){return this.request(`/leave/requests/${t}/clarify`,{method:"POST",body:JSON.stringify(n)})}async overwriteLeaveRequestDates(t,n){return this.request(`/leave/requests/${t}/overwrite-dates`,{method:"POST",body:JSON.stringify(n)})}async getEmployeeLeaveRequests(t){return this.request(`/leave/requests?employee_id=${t}`)}async getCorrectionData(){return this.request("/leave/correction-data")}async applyLeaveCorrection(t){return this.request("/leave/manual-correction",{method:"POST",body:JSON.stringify(t)})}async getAttendances(t={}){const n=new URLSearchParams(t).toString(),r=n?`/attendances?${n}`:"/attendances";return this.request(r)}async createAttendance(t){return this.request("/attendances",{method:"POST",body:JSON.stringify(t)})}async updateAttendance(t,n){return this.request(`/attendances/${t}`,{method:"PUT",body:JSON.stringify(n)})}async deleteAttendance(t){return this.request(`/attendances/${t}`,{method:"DELETE"})}async markAttendance(t){return this.request("/attendances/mark",{method:"POST",body:JSON.stringify({employee_id:t})})}async enrollFace(t,n,r={}){return this.request("/faces/enroll",{method:"POST",body:JSON.stringify({employee_id:t,descriptors:n,metadata:r})})}async recognizeFace(t,n=.6){return this.request("/faces/recognize",{method:"POST",body:JSON.stringify({descriptor:t,threshold:n})})}async unenrollFace(t){return this.request("/faces/unenroll",{method:"POST",body:JSON.stringify({employee_id:t})})}async getDashboardData(){return this.request("/attendance/dashboard")}async getAttendanceStats(){return this.request("/attendance/stats")}async getDepartmentStats(){return this.request("/attendance/departments")}async getAttendanceTrends(){return this.request("/attendance/trends")}async getLiveActivity(){return this.request("/attendance/live")}async getPresentToday(){return this.request("/attendance/present-today")}async getAbsentToday(){return this.request("/attendance/absent-today")}async getOnLeaveToday(){return this.request("/attendance/on-leave-today")}async getLateArrivalsToday(){return this.request("/attendance/late-arrivals-today")}async getEarlyDeparturesToday(){return this.request("/attendance/early-departures-today")}async getEmployeeMonthlyAttendance(t,n,r){return this.request(`/attendance/employee/${t}/${n}/${r}`)}async exportEmployeeMonthlyAttendance(t,n,r){return this.request(`/attendance/export/employee/${t}/${n}/${r}`,{responseType:"blob"})}async exportEmployeeDailyAttendance(t,n){return this.request(`/attendance/export/daily/employee/${t}/${n}`,{responseType:"blob"})}async exportEmployeeCustomRangeAttendance(t,n,r){return this.request(`/attendance/export/custom/employee/${t}/${n}/${r}`,{responseType:"blob"})}async emailEmployeeAttendanceReport(t,n,r,a,s,o,l){return this.request("/attendance/email",{method:"POST",body:JSON.stringify({employee_id:t,email:n,report_type:r,year:a,month:s,start_date:o,end_date:l})})}async getDepartments(){return this.request("/admin/departments")}async getEmployeesByDepartment(t){const n=t&&t!=="all"?`?department=${encodeURIComponent(t)}`:"";return this.request(`/admin/employees-by-department${n}`)}async getAttendanceLogs(t,n,r){return this.request(`/admin/attendance-logs?employee_id=${t}&start_date=${n}&end_date=${r}`)}async addNewAttendance(t){return this.request("/admin/attendance/add-new",{method:"POST",body:JSON.stringify(t)})}async updateAttendanceRecord(t,n){return this.request(`/admin/attendance/${t}/update`,{method:"PUT",body:JSON.stringify(n)})}}const Ne=new oj,M0=()=>{const[e,t]=E.useState(!1),[n,r]=E.useState(!1),[a,s]=E.useState(!1),[o,l]=E.useState(new Date),[c,u]=E.useState(navigator.onLine),d=Pr(),h=E.useRef(null);E.useEffect(()=>{const v=setInterval(()=>l(new Date),1e3);return()=>clearInterval(v)},[]),E.useEffect(()=>{const v=()=>u(!0),w=()=>u(!1);return window.addEventListener("online",v),window.addEventListener("offline",w),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",w)}},[]),E.useEffect(()=>{const v=w=>{h.current&&!h.current.contains(w.target)&&(r(!1),s(!1))};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const f=[{name:"Dashboard",href:"/dashboard",icon:S_},{name:"Policies",icon:mn,dropdown:!0,items:[{name:"Attendance Policies",href:"/policies",icon:mn},{name:"Leave Policies",href:"/leave/policies",icon:Ke}]},{name:"Requests",icon:Ru,dropdown:!0,items:[{name:"Leave Approvals",href:"/leave/approvals",icon:Ru},{name:"Attendance Corrections",href:"/admin/correction-requests",icon:He}]},{name:"Employees",href:"/employees",icon:ci},{name:"Reports",href:"/reports",icon:Eu}],p=[{name:"Dashboard",href:"/dashboard",icon:Eu},{name:"Attendance Policies",href:"/policies",icon:Df},{name:"Leave Policies",href:"/leave/policies",icon:Ke},{name:"Leave Approvals",href:"/leave/approvals",icon:Ru},{name:"Attendance Corrections",href:"/admin/correction-requests",icon:He},{name:"Employees",href:"/employees",icon:ci},{name:"Reports",href:"/reports",icon:Eu}],m=v=>d.pathname===v||d.pathname.startsWith(`${v}/`),x=v=>v.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),y=v=>v.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),g=d.pathname==="/";return i.jsxs("header",{className:`${g?"bg-white/10 backdrop-blur-sm border-b border-white/20 px-4 md:px-8 py-4 md:py-6":"bg-white border-b border-gray-200 px-4 py-3 shadow-sm sticky top-0 z-50"}`,children:[i.jsx("div",{className:"max-w-7xl mx-auto",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:"flex items-center gap-4",children:g?i.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[i.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-white rounded-xl flex items-center justify-center",children:i.jsx(ks,{className:" md:w-6 md:h-6 lg:w-6 lg:h-6 text-slate-900"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg md:text-2xl font-bold text-white",children:"Attendance system"}),i.jsx("p",{className:"text-xs md:text-sm text-slate-300",children:"Attendance system"})]})]}):i.jsxs(i.Fragment,{children:[i.jsx("h1",{className:"text-base md:text-lg font-semibold text-gray-900",children:"Admin Panel"}),i.jsx("span",{className:"hidden md:inline-block text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:"Logged in as Admin"})]})}),g?i.jsxs("div",{className:"flex items-center gap-3 md:gap-6",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-xl md:text-3xl font-bold text-white",children:x(o)}),i.jsx("div",{className:"text-xs md:text-sm text-slate-300",children:y(o)})]}),i.jsxs(Fa,{to:"/login",className:"bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2",children:[i.jsx(ii,{className:"w-4 h-4"}),i.jsx("span",{className:"hidden md:inline",children:"Admin"})]}),i.jsx("div",{className:"flex items-center gap-2",children:c?i.jsx(rj,{className:"w-5 h-5 text-green-400"}):i.jsx(tj,{className:"w-5 h-5 text-red-400"})})]}):i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{ref:h,className:"hidden lg:flex items-center gap-2",children:[f.map(v=>{const w=v.icon;if(v.dropdown){const b=v.items.some(C=>m(C.href)),N=v.name==="Policies"?n:a,_=v.name==="Policies"?r:s;return i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:()=>_(!N),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${b?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[i.jsx(w,{className:"w-4 h-4"}),i.jsx("span",{children:v.name}),i.jsx(e_,{className:`w-4 h-4 transition-transform ${N?"rotate-180":""}`})]}),N&&i.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:v.items.map(C=>{const k=C.icon,j=m(C.href);return i.jsxs(Fa,{to:C.href,onClick:()=>_(!1),className:`flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors ${j?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:[i.jsx(k,{className:"w-4 h-4"}),i.jsx("span",{children:C.name})]},C.name)})})]},v.name)}else{const b=m(v.href);return i.jsxs(Fa,{to:v.href,onClick:()=>{r(!1),s(!1)},className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${b?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[i.jsx(w,{className:"w-4 h-4"}),i.jsx("span",{children:v.name})]},v.name)}}),i.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),i.jsxs("button",{onClick:async()=>{try{await Ne.logout()}catch(v){console.error("Logout failed:",v)}finally{window.location.href="/login"}},className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[i.jsx(Ks,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]}),i.jsx("button",{className:"lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors ml-auto",onClick:()=>t(!e),children:e?i.jsx(Mn,{className:"w-6 h-6 "}):i.jsx(F0,{className:"w-6 h-6"})})]})]})}),e&&!g&&i.jsxs("div",{className:"lg:hidden mt-4 space-y-2",children:[i.jsx("hr",{className:"border-gray-200"}),i.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:p.map(v=>{const w=v.icon,b=m(v.href);return i.jsxs(Fa,{to:v.href,onClick:()=>t(!1),className:`flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium transition-colors
                    ${b?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[i.jsx(w,{className:"w-4 h-4"}),i.jsx("span",{children:v.name})]},v.name)})}),i.jsxs("button",{onClick:async()=>{try{await Ne.logout()}catch(v){console.error("Logout failed:",v)}finally{window.location.href="/login"}},className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[i.jsx(Ks,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]})]})},O0=()=>i.jsx("footer",{className:"bg-white/5 backdrop-blur-sm border-t border-white/20 px-4 md:px-8 py-3 md:py-4",children:i.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2 text-xs md:text-sm text-slate-400",children:[i.jsx("p",{children:"Powered by FaceRecognition AI v2.0"}),i.jsx("p",{className:"text-center md:text-right",children:"For support, contact IT Help Desk"})]})}),ka=({children:e})=>{const t=localStorage.getItem("authToken"),n=Pr();if(!t)return i.jsx(Sf,{to:"/login",replace:!0});const r=n.pathname==="/";return i.jsxs("div",{className:"min-h-screen flex flex-col",children:[i.jsx(M0,{}),i.jsx("main",{children:e}),r&&i.jsx(O0,{})]})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var L0=function(e,t){return(L0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)r.hasOwnProperty(a)&&(n[a]=r[a])})(e,t)};function Qn(e,t){function n(){this.constructor=e}L0(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function ge(e,t,n,r){return new(n||(n=Promise))(function(a,s){function o(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?a(u.value):new n(function(d){d(u.value)}).then(o,l)}c((r=r.apply(e,t||[])).next())})}function ve(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(c){return function(u){return function(d){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&d[0]?r.return:d[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,d[1])).done)return a;switch(r=0,a&&(d=[2&d[0],a.value]),d[0]){case 0:case 1:a=d;break;case 4:return o.label++,{value:d[1],done:!1};case 5:o.label++,r=d[1],d=[0];continue;case 7:d=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){o=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){o.label=d[1];break}if(d[0]===6&&o.label<a[1]){o.label=a[1],a=d;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(d);break}a[2]&&o.ops.pop(),o.trys.pop();continue}d=t.call(e,o)}catch(h){d=[6,h],r=0}finally{n=a=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([c,u])}}}var ij=function(){function e(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(t,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=t,this.platform=n},e.prototype.registerFlag=function(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){var a=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+a+"."),this.set(t,a)}},e.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},e.prototype.getNumber=function(t){return this.get(t)},e.prototype.getBool=function(t){return this.get(t)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(t,n){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)},e.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},e.prototype.setFlags=function(t){this.flags=Object.assign({},t)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,a=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(s){for(var o=[],l=1;l<arguments.length;l++)o[l-1]=arguments[l];return lj(r,o[0],o[1]),o.join("=")}),r);"tfjsflags"in a&&a.tfjsflags.split(",").forEach(function(s){var o=s.split(":"),l=o[0],c=o[1];t.urlFlags[l]=function(u,d){if((d=d.toLowerCase())==="true"||d==="false")return d==="true";if(""+ +d===d)return+d;throw new Error("Could not parse value flag value "+d+" for flag "+u+".")}(l,c)})}},e}();function lj(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function J(){return B0}var B0=null,Jl=new Map,sh=new Map;function $0(e,t){var n=z0(e,t);return Jl.get(n)}function cj(e){return sh.get(e)}function sg(e){for(var t=Jl.entries(),n=[];;){var r=t.next(),a=r.done,s=r.value;if(a)break;var o=s[0],l=s[1];o.split("_")[0]===e&&n.push(l)}return n}function W0(e){var t=e.kernelName,n=e.backendName,r=z0(t,n);if(Jl.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");Jl.set(r,e)}function uj(e){var t=e.kernelName;sh.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),sh.set(t,e)}function z0(e,t){return t+"_"+e}function oh(e,t,n){return Math.max(e,Math.min(t,n))}function U0(e){return e%2==0?e:e+1}function dj(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function T(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Ue(e,t,n){n===void 0&&(n=""),T(It(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function so(e){T(e!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Xs(e,t,n){if(t===void 0&&(t=[]),n===void 0&&(n=!1),t==null&&(t=[]),Array.isArray(e)||dr(e)&&!n)for(var r=0;r<e.length;++r)Xs(e[r],t,n);else t.push(e);return t}function xe(e){if(e.length===0)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function It(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function dt(e){return e%1==0}function hj(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function ih(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Ts(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function og(e,t,n){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,a){var s=0,o=function(){if(e())r();else{s++;var l=t(s);n!=null&&s>=n?a():setTimeout(o,l)}};o()})}function fj(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(e[a]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+a);r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found "+e[a]+" at dim "+a);if(r===-1){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(n===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var s=e.slice();return s[r]=t/n,s}function Ct(e,t){var n=t.length;return T((e=e==null?t.map(function(r,a){return a}):[].concat(e)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),T(e.every(function(r){return dt(r)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(r){return r<0?n+r:r})}function Ia(e,t){for(var n=[],r=[],a=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||a?null:Ct(t,e).sort(),o=0,l=0;l<e.length;++l){if(s!=null){if(s[o]===l&&e[l]!==1)throw new Error("Can't squeeze axis "+l+" since its dim '"+e[l]+"' is not 1");(s[o]==null||s[o]>l)&&e[l]===1&&(n.push(e[l]),r.push(l)),s[o]<=l&&o++}e[l]!==1&&(n.push(e[l]),r.push(l))}return{newShape:n,keptDims:r}}function ui(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Zl(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else{if(e!=="string")throw new Error("Unknown data type "+e);n=new Array(t)}return n}function pj(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function mj(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function gj(e,t){return t!=="complex64"&&(t!=="float32"||e==="complex64")&&(t!=="int32"||e==="float32"||e==="complex64")&&(t!=="bool"||e!=="bool")}function dr(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function V0(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function vj(e){if(e==null)return 0;var t=0;return e.forEach(function(n){return t+=n.length}),t}function If(e){return typeof e=="string"||e instanceof String}function xj(e){return typeof e=="boolean"}function yj(e){return typeof e=="number"}function Ni(e){return Array.isArray(e)?Ni(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":yj(e)?"float32":If(e)?"string":xj(e)?"bool":"float32"}function lh(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ch(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function hr(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function q0(e,t,n){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Xs(e)),n&&pj(e,t),function(s,o){return s instanceof Float32Array&&o==="float32"||s instanceof Int32Array&&o==="int32"||s instanceof Uint8Array&&o==="bool"}(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){for(var r=new Uint8Array(e.length),a=0;a<r.length;++a)Math.round(e[a])!==0&&(r[a]=1);return r}throw new Error("Unknown data type "+t)}function ig(e,t){if(e.length===0)return t[0];var n=e.reduce(function(r,a){return r*a});if(n===0)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function r(a,s,o){var l=new Array;if(s.length===1)for(var c=s[0],u=0;u<c;u++)l[u]=o[a+u];else{c=s[0];var d=s.slice(1),h=d.reduce(function(f,p){return f*p});for(u=0;u<c;u++)l[u]=r(a+u*h,d,o)}return l}(0,e,t)}function H0(e,t){for(var n=_i(e,t),r=0;r<n.length;r++)n[r]=1;return n}function _i(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+t)}function ar(){return J().platform.now()}function G0(e){e.forEach(function(t){T(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function bj(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",J().platform.encode(e,t)}function ec(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",J().platform.decode(e,t)}function lg(e,t,n){if(t===0)return 0;if(t===1)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function wj(e,t,n){if(t===0)return[];if(t===1)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}var Nj=function(){function e(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new _j)}return e.prototype.profileKernel=function(t,n,r){var a,s=this,o=this.backendTimer.time(function(){a=r()});return a.forEach(function(l){l.data().then(function(c){(function(u,d,h){if(d!=="float32")return!1;for(var f=0;f<u.length;f++){var p=u[f];if(isNaN(p)||!isFinite(p))return console.warn("Found "+p+" in the result of '"+h+"'"),!0}})(c,l.dtype,t),o.then(function(u){var d="";u.getExtraProfileInfo!=null&&(d=u.getExtraProfileInfo()),s.logger.logKernelProfile(t,l,c,u.kernelMs,n,d)})})}),a},e}(),_j=function(){function e(){}return e.prototype.logKernelProfile=function(t,n,r,a,s,o){var l=typeof a=="number"?Ts(a+"ms",9):a.error,c=Ts(t,25),u=n.rank,d=n.size,h=Ts(n.shape.toString(),14),f="";for(var p in s){var m=s[p].shape||n.shape,x=m.length;f+=p+": "+x+"D "+(x>0?m:"")+" "}console.log("%c"+c+"	%c"+l+"	%c"+u+"D "+h+"	%c"+d+"	%c"+f+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),cg=20,yo=3,Du=7;function jj(e,t,n,r){var a=hr(t),s=function(u,d,h,f){var p=xe(d),m=f[f.length-1],x=new Array(m).fill(0),y=d.length,g=h==="complex64"?wo(u):u;if(y>1)for(var v=0;v<p/m;v++)for(var w=v*m,b=0;b<m;b++)x[b]=Math.max(x[b],bo(g[w+b],0,h).length);return x}(e,t,n,a),o=t.length,l=function u(d,h,f,p,m,x){x===void 0&&(x=!0);var y=f==="complex64"?2:1,g=h[0],v=h.length;if(v===0)return f==="complex64"?[bo(wo(d)[0],0,f)]:f==="bool"?[K0(d[0])]:[d[0].toString()];if(v===1){if(g>cg){var w=yo*y,b=Array.from(d.slice(0,w)),N=Array.from(d.slice((g-yo)*y,g*y));return f==="complex64"&&(b=wo(b),N=wo(N)),["["+b.map(function(F,U){return bo(F,m[U],f)}).join(", ")+", ..., "+N.map(function(F,U){return bo(F,m[g-yo+U],f)}).join(", ")+"]"]}return["["+(f==="complex64"?wo(d):Array.from(d)).map(function(F,U){return bo(F,m[U],f)}).join(", ")+"]"]}var _=h.slice(1),C=p.slice(1),k=p[0]*y,j=[];if(g>cg){for(var S=0;S<yo;S++){var M=(D=S*k)+k;j.push.apply(j,u(d.slice(D,M),_,f,C,m,!1))}for(j.push("..."),S=g-yo;S<g;S++)M=(D=S*k)+k,j.push.apply(j,u(d.slice(D,M),_,f,C,m,S===g-1))}else for(S=0;S<g;S++){var D;M=(D=S*k)+k,j.push.apply(j,u(d.slice(D,M),_,f,C,m,S===g-1))}var A=v===2?",":"";for(j[0]="["+j[0]+A,S=1;S<j.length-1;S++)j[S]=" "+j[S]+A;var B=`,
`;for(S=2;S<v;S++)B+=`
`;return j[j.length-1]=" "+j[j.length-1]+"]"+(x?"":B),j}(e,t,n,a,s),c=["Tensor"];return r&&(c.push("  dtype: "+n),c.push("  rank: "+o),c.push("  shape: ["+t+"]"),c.push("  values:")),c.push(l.map(function(u){return"    "+u}).join(`
`)),c.join(`
`)}function bo(e,t,n){return Ts(Array.isArray(e)?parseFloat(e[0].toFixed(Du))+" + "+parseFloat(e[1].toFixed(Du))+"j":If(e)?"'"+e+"'":n==="bool"?K0(e):parseFloat(e.toFixed(Du)).toString(),t)}function K0(e){return e===0?"false":"true"}function wo(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var di=function(){function e(t,n,r){var a=this;if(this.dtype=n,this.shape=t.slice(),this.size=xe(t),r!=null){var s=r.length;T(s===this.size,function(){return"Length of values '"+s+"' does not match the size inferred by the shape '"+a.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Zl(n,this.size),this.strides=hr(t)}return e.prototype.set=function(t){for(var n=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),T(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var s=this.locToIndex(r);this.values[s]=t},e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length===0&&(t=[0]);for(var r=0,a=0,s=t;a<s.length;a++){var o=s[a];if(o<0||o>=this.shape[r]){var l="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(l)}r++}for(var c=t[t.length-1],u=0;u<t.length-1;++u)c+=this.strides[u]*t[u];return this.values[c]},e.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n},e.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return or().makeTensor(this.values,this.shape,this.dtype)},e}(),or=null,Y=null,X0=null,rt=function(){function e(t,n,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=xe(t),this.strides=hr(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),T(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(t,n){return this.throwIfDisposed(),this.reshape([t,n])},e.prototype.as3D=function(t,n,r){return this.throwIfDisposed(),this.reshape([t,n,r])},e.prototype.as4D=function(t,n,r,a){return this.throwIfDisposed(),this.reshape([t,n,r,a])},e.prototype.as5D=function(t,n,r,a,s){return this.throwIfDisposed(),this.reshape([t,n,r,a,s])},e.prototype.asType=function(t){return this.throwIfDisposed(),Y.cast(this,t)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return ge(this,void 0,void 0,function(){var t;return ve(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,Y.buffer(this.shape,this.dtype,t)]}})})},e.prototype.bufferSync=function(){return Y.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return ge(this,void 0,void 0,function(){var t;return ve(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,ig(this.shape,t)]}})})},e.prototype.arraySync=function(){return ig(this.shape,this.dataSync())},e.prototype.data=function(){return ge(this,void 0,void 0,function(){var t,n;return ve(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=or().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:n=r.sent();try{return[2,n.map(function(a){return ec(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var t=or().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(n){return ec(n)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},e.prototype.bytes=function(){return ge(this,void 0,void 0,function(){var t;return ve(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,or().read(this.dataId)];case 1:return t=n.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(or().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(t){return t===void 0&&(t=!1),Y.print(this,t)},e.prototype.reshape=function(t){return this.throwIfDisposed(),Y.reshape(this,t)},e.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},e.prototype.expandDims=function(t){return t===void 0&&(t=0),Y.expandDims(this,t)},e.prototype.cumsum=function(t,n,r){return t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1),Y.cumsum(this,t,n,r)},e.prototype.squeeze=function(t){return this.throwIfDisposed(),Y.squeeze(this,t)},e.prototype.clone=function(){return this.throwIfDisposed(),Y.clone(this)},e.prototype.oneHot=function(t,n,r){return this.throwIfDisposed(),Y.oneHot(this,t,n,r)},e.prototype.toString=function(t){return t===void 0&&(t=!1),jj(this.dataSync(),this.shape,this.dtype,t)},e.prototype.tile=function(t){return this.throwIfDisposed(),Y.tile(this,t)},e.prototype.gather=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),Y.gather(this,t,n)},e.prototype.matMul=function(t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Y.matMul(this,t,n,r)},e.prototype.dot=function(t){return this.throwIfDisposed(),Y.dot(this,t)},e.prototype.norm=function(t,n,r){return t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),Y.norm(this,t,n,r)},e.prototype.slice=function(t,n){return this.throwIfDisposed(),Y.slice(this,t,n)},e.prototype.reverse=function(t){return this.throwIfDisposed(),Y.reverse(this,t)},e.prototype.concat=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),Y.concat([this].concat(t),n)},e.prototype.split=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),Y.split(this,t,n)},e.prototype.stack=function(t,n){return n===void 0&&(n=0),Y.stack([this,t],n)},e.prototype.unstack=function(t){return t===void 0&&(t=0),Y.unstack(this,t)},e.prototype.pad=function(t,n){return n===void 0&&(n=0),Y.pad(this,t,n)},e.prototype.batchNormalization=function(t,n,r,a,s){return r===void 0&&(r=.001),X0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,n,s,a,r)},e.prototype.batchNorm=function(t,n,r,a,s){return s===void 0&&(s=.001),this.throwIfDisposed(),Y.batchNorm(this,t,n,r,a,s)},e.prototype.all=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Y.all(this,t,n)},e.prototype.any=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Y.any(this,t,n)},e.prototype.logSumExp=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Y.logSumExp(this,t,n)},e.prototype.sum=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Y.sum(this,t,n)},e.prototype.prod=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Y.prod(this,t,n)},e.prototype.mean=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Y.mean(this,t,n)},e.prototype.min=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Y.min(this,t,n)},e.prototype.max=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Y.max(this,t,n)},e.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),Y.argMin(this,t)},e.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),Y.argMax(this,t)},e.prototype.cast=function(t){return this.throwIfDisposed(),Y.cast(this,t)},e.prototype.add=function(t){return this.throwIfDisposed(),Y.add(this,t)},e.prototype.addStrict=function(t){return this.throwIfDisposed(),Y.addStrict(this,t)},e.prototype.atan2=function(t){return this.throwIfDisposed(),Y.atan2(this,t)},e.prototype.sub=function(t){return this.throwIfDisposed(),Y.sub(this,t)},e.prototype.subStrict=function(t){return this.throwIfDisposed(),Y.subStrict(this,t)},e.prototype.pow=function(t){return this.throwIfDisposed(),Y.pow(this,t)},e.prototype.powStrict=function(t){return this.throwIfDisposed(),Y.powStrict(this,t)},e.prototype.mul=function(t){return this.throwIfDisposed(),Y.mul(this,t)},e.prototype.mulStrict=function(t){return this.throwIfDisposed(),Y.mulStrict(this,t)},e.prototype.div=function(t){return this.throwIfDisposed(),Y.div(this,t)},e.prototype.divNoNan=function(t){return this.throwIfDisposed(),Y.divNoNan(this,t)},e.prototype.floorDiv=function(t){return this.throwIfDisposed(),Y.floorDiv(this,t)},e.prototype.divStrict=function(t){return this.throwIfDisposed(),Y.divStrict(this,t)},e.prototype.minimum=function(t){return this.throwIfDisposed(),Y.minimum(this,t)},e.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Y.minimumStrict(this,t)},e.prototype.maximum=function(t){return this.throwIfDisposed(),Y.maximum(this,t)},e.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Y.maximumStrict(this,t)},e.prototype.mod=function(t){return this.throwIfDisposed(),Y.mod(this,t)},e.prototype.modStrict=function(t){return this.throwIfDisposed(),Y.modStrict(this,t)},e.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Y.squaredDifferenceStrict(this,t)},e.prototype.transpose=function(t){return this.throwIfDisposed(),Y.transpose(this,t)},e.prototype.notEqual=function(t){return this.throwIfDisposed(),Y.notEqual(this,t)},e.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Y.notEqualStrict(this,t)},e.prototype.less=function(t){return this.throwIfDisposed(),Y.less(this,t)},e.prototype.lessStrict=function(t){return this.throwIfDisposed(),Y.lessStrict(this,t)},e.prototype.equal=function(t){return this.throwIfDisposed(),Y.equal(this,t)},e.prototype.equalStrict=function(t){return this.throwIfDisposed(),Y.equalStrict(this,t)},e.prototype.lessEqual=function(t){return this.throwIfDisposed(),Y.lessEqual(this,t)},e.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Y.lessEqualStrict(this,t)},e.prototype.greater=function(t){return this.throwIfDisposed(),Y.greater(this,t)},e.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Y.greaterStrict(this,t)},e.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Y.greaterEqual(this,t)},e.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Y.greaterEqualStrict(this,t)},e.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Y.logicalAnd(this,t)},e.prototype.logicalOr=function(t){return this.throwIfDisposed(),Y.logicalOr(this,t)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),Y.logicalNot(this)},e.prototype.logicalXor=function(t){return this.throwIfDisposed(),Y.logicalXor(this,t)},e.prototype.where=function(t,n){return this.throwIfDisposed(),Y.where(t,this,n)},e.prototype.neg=function(){return this.throwIfDisposed(),Y.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),Y.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),Y.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),Y.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),Y.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),Y.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),Y.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),Y.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),Y.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),Y.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),Y.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),Y.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),Y.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),Y.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),Y.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),Y.abs(this)},e.prototype.clipByValue=function(t,n){return this.throwIfDisposed(),Y.clipByValue(this,t,n)},e.prototype.relu=function(){return this.throwIfDisposed(),Y.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),Y.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),Y.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),Y.selu(this)},e.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),Y.leakyRelu(this,t)},e.prototype.prelu=function(t){return this.throwIfDisposed(),Y.prelu(this,t)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),Y.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),Y.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),Y.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),Y.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),Y.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),Y.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),Y.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),Y.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),Y.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),Y.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),Y.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),Y.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),Y.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),Y.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),Y.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),Y.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),Y.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),Y.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),Y.round(this)},e.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),Y.step(this,t)},e.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),Y.softmax(this,t)},e.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),Y.logSoftmax(this,t)},e.prototype.resizeBilinear=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),Y.image.resizeBilinear(this,t,n)},e.prototype.resizeNearestNeighbor=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),Y.image.resizeNearestNeighbor(this,t,n)},e.prototype.conv1d=function(t,n,r,a,s,o){return a===void 0&&(a="NWC"),s===void 0&&(s=1),this.throwIfDisposed(),Y.conv1d(this,t,n,r,a,s,o)},e.prototype.conv2d=function(t,n,r,a,s,o){return a===void 0&&(a="NHWC"),s===void 0&&(s=[1,1]),this.throwIfDisposed(),Y.conv2d(this,t,n,r,a,s,o)},e.prototype.conv2dTranspose=function(t,n,r,a,s){return this.throwIfDisposed(),Y.conv2dTranspose(this,t,n,r,a,s)},e.prototype.depthwiseConv2D=function(t,n,r,a,s,o){return a===void 0&&(a="NHWC"),s===void 0&&(s=[1,1]),this.throwIfDisposed(),Y.depthwiseConv2d(this,t,n,r,a,s,o)},e.prototype.separableConv2d=function(t,n,r,a,s,o){return s===void 0&&(s=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),Y.separableConv2d(this,t,n,r,a,s,o)},e.prototype.avgPool=function(t,n,r,a){return this.throwIfDisposed(),Y.avgPool(this,t,n,r,a)},e.prototype.maxPool=function(t,n,r,a){return this.throwIfDisposed(),Y.maxPool(this,t,n,r,a)},e.prototype.localResponseNormalization=function(t,n,r,a){return t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),a===void 0&&(a=.5),Y.localResponseNormalization(this,t,n,r,a)},e.prototype.pool=function(t,n,r,a,s){return this.throwIfDisposed(),Y.pool(this,t,n,r,a,s)},e.prototype.variable=function(t,n,r){return t===void 0&&(t=!0),this.throwIfDisposed(),or().makeVariable(this,t,n,r)},e.prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),Y.unsortedSegmentSum(this,t,n)},e.prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),Y.batchToSpaceND(this,t,n)},e.prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),Y.spaceToBatchND(this,t,n)},e.prototype.topk=function(t,n){return t===void 0&&(t=1),n===void 0&&(n=!0),this.throwIfDisposed(),Y.topk(this,t,n)},e.prototype.stridedSlice=function(t,n,r,a,s,o,l,c){return a===void 0&&(a=0),s===void 0&&(s=0),o===void 0&&(o=0),l===void 0&&(l=0),c===void 0&&(c=0),this.throwIfDisposed(),Y.stridedSlice(this,t,n,r,a,s,o,l,c)},e.prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),Y.depthToSpace(this,t,n)},e.prototype.fft=function(){return this.throwIfDisposed(),Y.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),Y.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),Y.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),Y.spectral.irfft(this)},e}();Object.defineProperty(rt,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var ug,uh,dh,hh,fh,Ys=function(e){function t(n,r,a,s){var o=e.call(this,n.shape,n.dtype,n.dataId,s)||this;return o.trainable=r,o.name=a,o}return Qn(t,e),t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!It(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");or().disposeTensor(this),this.dataId=n.dataId,or().incRef(this,null)},t.prototype.dispose=function(){or().disposeVariable(this),this.isDisposedInternal=!0},t}(rt);Object.defineProperty(Ys,Symbol.hasInstance,{value:function(e){return e instanceof rt&&e.assign!=null&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(ug||(ug={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(uh||(uh={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(dh||(dh={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(hh||(hh={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(fh||(fh={}));var kj={float32:hh,int32:uh,bool:dh,complex64:fh};function Mt(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error("Can not upcast "+e+" with "+t)}return kj[e][t]}function Iu(e){return Mt(e,"int32")}function it(e,t){if(e.dtype===t.dtype)return[e,t];var n=Mt(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Cj(e,t){T(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function Y0(e){var t=[];return function n(r,a,s){if(r!=null){if(r instanceof rt)return void a.push(r);if(o=r,!(!Array.isArray(o)&&typeof o!="object")){var o,l=r;for(var c in l){var u=l[c];s.has(u)||(s.add(u),n(u,a,s))}}}}(e,t,new Set),t}var Au,dg=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},e}(),Sj=function(){function e(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new dg}return e.prototype.ready=function(){return ge(this,void 0,void 0,function(){var t,n,r;return ve(this,function(a){switch(a.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),n=0,a.label=1;case 1:return n<t.length?(r=t[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return a.sent()?[4,this.setBackend(r)]:[3,4];case 3:return a.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),n=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},e.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},e.prototype.registerBackend=function(t,n,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:n,priority:r},!0)},e.prototype.setBackend=function(t){return ge(this,void 0,void 0,function(){var n,r,a;return ve(this,function(s){switch(s.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return a=s.sent(),[3,3];case 2:a=r,s.label=3;case 3:if(!a)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Nj(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var t=this;sg(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(t.backendInstance)})},e.prototype.disposeRegisteredKernels=function(t){var n=this;sg(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[t])})},e.prototype.initializeBackend=function(t){var n=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var a=r.factory();if(Promise.resolve(a)===a){var s=++this.pendingBackendInitId,o=a.then(function(l){return!(s<n.pendingBackendInitId)&&(n.registry[t]=l,n.pendingBackendInit=null,!0)}).catch(function(l){return!(s<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(l.stack||l.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[t]=a,{success:!0,asyncInit:!1}}catch(l){return console.warn("Initialization of backend "+t+" failed"),console.warn(l.stack||l.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return t.registryFactory[r].priority-t.registryFactory[n].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),n=0;n<t.length;n++){var r=t[n],a=this.initializeBackend(r),s=a.success,o=a.asyncInit;if(o||s)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(t,n){var r=this.state.tensorInfo.get(n),a=r.backend,s=this.readSync(n);a.disposeData(n),r.backend=t,t.move(n,s,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(t,n){var r,a=this,s=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}return this.scopedRun(function(){return a.startScope(s)},function(){return a.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},e.prototype.scopedRun=function(t,n,r){t();try{var a=r();return n(),a}catch(s){throw n(),s}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(t){var n=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[n],function(a){return{x:function(){return a.toFloat()}}},[]),n},e.prototype.runKernel=function(t,n,r,a,s){return this.runKernelFunc(null,n,null,t,r,a,s)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(t,n,r){var a=this.backend.numDataIds(),s=0;r.forEach(function(c){s+=c.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=a-n-s-o;if(l>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+l+" data ids) after running '"+t+"'")},e.prototype.runKernelFunc=function(t,n,r,a,s,o,l){var c,u=this;o===void 0&&(o=[]),l===void 0&&(l=[]);var d=[],h=this.isTapeOn();a==null&&(a=this.state.activeScope!=null?this.state.activeScope.name:"");var f,p=function(v){h&&(d=v.map(function(w){return u.keep(u.clone(w))}))},m=this.state.numBytes,x=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var y,g=$0(a,this.backendName);return f=g!=null?function(){var v=u.backend.numDataIds();y=g.kernelFunc({inputs:n,attrs:s,backend:u.backend});var w=Array.isArray(y)?y:[y];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(a,v,w);var b=w.map(function(_){var C=_.dataId,k=_.shape,j=_.dtype;return u.makeTensorFromDataId(C,k,j)}),N=b.filter(function(_,C){return l[C]});return p((o||[]).slice().concat(N)),b}:function(){var v=u.backend.numDataIds();y=u.tidy(function(){return t(u.backend,p)});var w=Array.isArray(y)?y:[y];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(a,v,w),w},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){c=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(a,n,function(){return f()}):f()}),h&&this.addTapeNode(a,n,c,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:a,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-x,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(v){return n[v].shape}),outputShapes:c.map(function(v){return v.shape})}),Array.isArray(y)?c:c[0]},e.prototype.makeTensor=function(t,n,r,a){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var s=t;r==="string"&&If(t[0])&&(s=t.map(function(d){return bj(d)}));var o=a.write(s,n,r),l=new rt(n,r,o,this.nextTensorId());if(this.incRef(l,a),r==="string"){var c=this.state.tensorInfo.get(o),u=vj(s);this.state.numBytes+=u-c.bytes,c.bytes=u}return l},e.prototype.makeTensorFromDataId=function(t,n,r,a){var s=new rt(n,r=r||"float32",t,this.nextTensorId());return this.incRef(s,a),s},e.prototype.makeVariable=function(t,n,r,a){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==t.dtype&&(t=t.asType(a));var s=new Ys(t,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error("Variable with name "+s.name+" was already registered");return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s},e.prototype.incRef=function(t,n){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var a=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(a=t.size*V0(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:a,refCount:0}),this.state.numBytes+=a}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Ys||this.track(t)},e.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(t.dataId);n.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var n=this.state.registeredVariables[t];this.disposeVariable(n)}},e.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},e.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},e.prototype.profile=function(t){return ge(this,void 0,void 0,function(){var n,r;return ve(this,function(a){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(s){return s.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(t,n,r,a,s){var o=this,l={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:s},c=cj(t);c!=null&&(a=c.gradFunc),a!=null&&(l.gradient=function(u){return u=u.map(function(d,h){if(d==null){var f=r[h],p=_i(f.size,f.dtype);return o.makeTensor(p,f.shape,f.dtype)}return d}),a(u.length>1?u:u[0],s)}),this.state.activeTape.push(l)},e.prototype.keep=function(t){return t.kept=!0,t},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(t){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n},e.prototype.endScope=function(t){for(var n=this,r=Y0(t),a=new Set(r.map(function(c){return c.id})),s=0;s<this.state.activeScope.track.length;s++){var o=this.state.activeScope.track[s];o.kept||a.has(o.id)||o.dispose()}var l=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(c){c.kept||c.scopeId!==l.id||n.track(c)})},e.prototype.gradients=function(t,n,r,a){var s=this;if(a===void 0&&(a=!1),T(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun(function(){return s.startTape()},function(){return s.endTape()},function(){return s.tidy("forward",t)});T(o instanceof rt,function(){return"The result y returned by f() must be a tensor."});var l=function(c,u,d){for(var h={},f={},p=0;p<u.length;p++)h[u[p].id]=!0;for(p=0;p<c.length;p++){var m=(_=c[p]).inputs;for(var x in m){for(var y=m[x],g=!1,v=0;v<u.length;v++)if(h[y.id]){_.outputs.forEach(function(S){return h[S.id]=!0}),g=!0,f[_.id]=!0;break}if(g)break}}var w={};w[d.id]=!0;var b={};for(p=c.length-1;p>=0;p--)for(m=(_=c[p]).inputs,v=0;v<_.outputs.length;v++)if(w[_.outputs[v].id]){for(var x in m)w[m[x].id]=!0,b[_.id]=!0;break}var N=[];for(p=0;p<c.length;p++){var _;if(f[(_=c[p]).id]&&b[_.id]){var C={};for(var x in _.inputs){var k=_.inputs[x];h[k.id]&&(C[x]=k)}var j=Object.assign({},_);j.inputs=C,j.outputs=_.outputs,N.push(j)}}return N}(this.state.activeTape,n,o);if(!a&&l.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var c,u,d={};d[o.id]=r??(c=o.shape,u=H0(xe(c),"float32"),z.makeTensor(u,c,"float32")),function(f,p,m){for(var x=function(g){var v=p[g],w=[];if(v.outputs.forEach(function(C){var k=f[C.id];k!=null?w.push(k):w.push(null)}),v.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+v.kernelName+".");var b=v.gradient(w),N=function(C){if(!(C in b))throw new Error("Cannot backprop through input "+C+". Available gradients found: "+Object.keys(b)+".");var k=m(function(){return b[C]()});if(k.dtype!=="float32")throw new Error("Error in gradient for op "+v.kernelName+". The gradient of input "+C+" must have 'float32' dtype, but has '"+k.dtype+"'");var j=v.inputs[C];if(!It(k.shape,j.shape))throw new Error("Error in gradient for op "+v.kernelName+". The gradient of input '"+C+"' has shape '"+k.shape+"', which does not match the shape of the input '"+j.shape+"'");if(f[j.id]==null)f[j.id]=k;else{var S=f[j.id];f[j.id]=S.add(k),S.dispose()}};for(var _ in v.inputs)N(_)},y=p.length-1;y>=0;y--)x(y)}(d,l,function(f){return s.tidy(f)});var h=n.map(function(f){return d[f.id]});return s.state.gradientDepth===0&&(s.state.activeTape.forEach(function(f){for(var p=0,m=f.saved;p<m.length;p++)m[p].dispose()}),s.state.activeTape=null),{value:o,grads:h}})},e.prototype.customGrad=function(t){var n=this;return T(lh(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];T(a.every(function(l){return l instanceof rt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return a.forEach(function(l,c){o[c]=l}),n.runKernelFunc(function(l,c){return T((r=t.apply(void 0,a.concat([c]))).value instanceof rt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),T(lh(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},o,function(l,c){var u=r.gradFunc(l,c),d=Array.isArray(u)?u:[u];T(d.length===a.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),T(d.every(function(f){return f instanceof rt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return d.forEach(function(f,p){h[p]=function(){return f}}),h})}},e.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},e.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},e.prototype.time=function(t){return ge(this,void 0,void 0,function(){var n,r;return ve(this,function(a){switch(a.label){case 0:return n=ar(),[4,this.backend.time(t)];case 1:return(r=a.sent()).wallMs=ar()-n,[2,r]}})})},e.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new dg,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),z=function(){var e=function(){if(Au==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}Au=n}return Au}();if(e._tfengine==null){var t=new ij(e);e._tfengine=new Sj(t)}return function(n){B0=n}(e._tfengine.ENV),or=function(){return e._tfengine},e._tfengine}();function Q0(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var br=J();br.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),br.registerFlag("IS_BROWSER",function(){return Q0()}),br.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),br.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),br.registerFlag("PROD",function(){return!1}),br.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return br.getBool("DEBUG")}),br.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),br.registerFlag("IS_TEST",function(){return!1});var hi,xn,gn,Ra={},Tu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ej(e,t){Ra[e]=t}function mr(e){e in Ra||(Ra[e]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(a){if(typeof OffscreenCanvas<"u"&&a===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(a){a.preventDefault(),delete Ra[n]},!1),n===1?r.getContext("webgl",Tu)||r.getContext("experimental-webgl",Tu):r.getContext("webgl2",Tu)}(e));var t=Ra[e];return t.isContextLost()?(delete Ra[e],mr(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ra[e])}function Bc(e,t){return[t,e]}function Mo(e){var t=xe(e);return ih(Math.ceil(t/4))}function ji(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Af(e,t){var n,r,a,s,o,l,c,u,d,h=e;return J().getNumber("WEBGL_VERSION")===2?(n=h.R32F,r=h.R16F,a=h.RGBA16F,s=h.RGBA32F,o=h.RED,l=4,c=1,u=h.HALF_FLOAT,d=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,s=h.RGBA,o=e.RGBA,l=4,c=4,u=t!=null?t.HALF_FLOAT_OES:null,d=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:s,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:u,textureTypeFloat:d}}function ye(e,t,n){var r=n();return t&&function(a){var s=a.getError();if(s!==a.NO_ERROR)throw new Error("WebGL Error: "+Aj(a,s))}(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(hi||(hi={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(xn||(xn={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(gn||(gn={}));var Rj=596e-10,Dj=65504;function Ij(e){return!!(J().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||Rj<Math.abs(e)&&Math.abs(e)<Dj)}function Aj(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Xi(e,t,n){return Fr(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function Tj(e,t,n){var r=Fr(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ye(e,t,function(){return e.shaderSource(r,n)}),ye(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Pj(e,t,n){var r=Fr(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ye(e,t,function(){return e.shaderSource(r,n)}),ye(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw function(a,s){var o=Fj.exec(s);if(o==null)return console.log("Couldn't parse line number in error: "+s),void console.log(a);for(var l=+o[1],c=a.split(`
`),u=c.length.toString().length+2,d=c.map(function(y,g){return Ts((g+1).toString(),u)+y}),h=0,f=0;f<d.length;f++)h=Math.max(d[f].length,h);var p=d.slice(0,l-1),m=d.slice(l-1,l),x=d.slice(l);console.log(p.join(`
`)),console.log(s.split(`
`)[0]),console.log("%c "+Ts(m[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(x.join(`
`))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Pu,Fu,Fj=/ERROR: [0-9]+:([0-9]+):/g;function Mj(e,t){return Fr(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function Oj(e,t,n){if(ye(e,t,function(){return e.linkProgram(n)}),e.getProgramParameter(n,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Mu(e,t,n){if(ye(e,t,function(){return e.validateProgram(n)}),e.getProgramParameter(n,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function Lj(e,t,n){var r=Fr(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return ye(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),ye(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Bj(e,t,n){var r=Fr(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return ye(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),ye(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function $j(e,t){return Fr(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function Wj(e,t){var n=J().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function zj(e,t){return Fr(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function hg(e,t,n,r,a,s,o,l){var c=e.getAttribLocation(n,r);return c!==-1&&(ye(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,a)}),ye(e,t,function(){return e.vertexAttribPointer(c,s,e.FLOAT,!1,o,l)}),ye(e,t,function(){return e.enableVertexAttribArray(c)}),!0)}function Uj(e,t,n,r){Kj(e,r),ye(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),ye(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function Vj(e,t,n,r){return Fr(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function qj(e,t,n){return e.getUniformLocation(t,n)}function Hj(e,t,n,r,a,s){ye(e,t,function(){return Uj(e,t,r,s)}),ye(e,t,function(){return e.uniform1i(a,s)})}function Ou(e,t,n,r){ye(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),ye(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function fg(e,t,n){ye(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),ye(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Yi(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Gj(e,t))}function Gj(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Fr(e,t,n,r){var a=ye(e,t,function(){return n()});if(a==null)throw new Error(r);return a}function Kj(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function tc(e,t){return t===void 0&&(t=2),xe(e.slice(0,e.length-t))}function nc(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Lu(e){var t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[tc(e)].concat(nc(e))),t}function Xj(e,t){var n;t===void 0&&(t=!1);var r=J().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(e=e.map(function(u,d){return d>=e.length-2?U0(e[d]):e[d]})).length===1&&(e=[2,e[0]])),e.length!==2){var a=Ia(e);e=a.newShape}var s=xe(e);if(e.length<=1&&s<=r)return[1,s];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=tc(e),l=2,c=2;return e.length&&(l=(n=nc(e))[0],c=n[1]),ih(s=o*(l/2)*(c/2)).map(function(u){return 2*u})}return ih(s)}function Qi(e){return e%2==0}function Ji(e,t){if(It(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||Qi(n)&&Qi(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&Qi(e[0])&&Qi(t[0])}function Yj(e){if(Pu==null){var t=mr(e);Pu=t.getParameter(t.MAX_TEXTURE_SIZE)}return Pu}function Qj(e){if(Fu==null){var t=mr(e);Fu=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Fu)}function Jj(e){if(e===0)return 0;var t=mr(e);return An(t,"EXT_disjoint_timer_query_webgl2")&&e===2?2:An(t,"EXT_disjoint_timer_query")?1:0}function An(e,t){return e.getExtension(t)!=null}function pg(e){try{if(mr(e)!=null)return!0}catch{return!1}return!1}function Zj(e){if(e===0)return!1;var t=mr(e);if(e===1){if(!An(t,"OES_texture_float"))return!1}else if(!An(t,"EXT_color_buffer_float"))return!1;return ph(t)}function ek(e){if(e===0)return!1;var t=mr(e);if(e!==1){if(An(t,"EXT_color_buffer_float"))return ph(t);if(An(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(r,a){var s=Af(r,a),o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,s.internalFormatHalfFloat,1,1,0,s.textureFormatFloat,s.textureTypeHalfFloat,null);var l=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,l),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0);var c=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(o),r.deleteFramebuffer(l),c}(t,n)}return!1}return!!An(t,"OES_texture_float")&&!!An(t,"WEBGL_color_buffer_float")&&ph(t)}function ph(e){var t=Af(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function tk(e){return e===2&&mr(e).fenceSync!=null}var Ee=J();function J0(e){J().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function he(e,t){return z.tidy(e,t)}function un(e){Y0(e).forEach(function(t){return t.dispose()})}function nk(e){return z.keep(e)}function rc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];J().getBool("IS_TEST")||console.warn.apply(console,e)}function wa(e,t){var n=e;if(dr(e))return t==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||dr(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&J().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function a(s,o,l){if(l=l||[],!Array.isArray(s)&&!dr(s))return void T(o.length===0,function(){return"Element arr["+l.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});T(o.length>0,function(){return"Element arr["+l.join("][")+"] should be a primitive, but is an array of "+s.length+" elements"}),T(s.length===o[0],function(){return"Element arr["+l.join("][")+"] should have "+o[0]+" elements, but has "+s.length+" elements"});for(var c=o.slice(1),u=0;u<s.length;++u)a(s[u],c,l.concat(u))}(e,r,[]),r}function mg(e,t,n,r){if(e!=null&&(e!=="numeric"&&e!==t||e==="numeric"&&t==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function R(e,t,n,r){if(r===void 0&&(r="numeric"),e instanceof rt)return mg(r,e.dtype,t,n),e;var a=Ni(e);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),mg(r,a,t,n),e==null||!dr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var s=e==null?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+s+"'")}var o=wa(e,a);dr(e)||Array.isArray(e)||(e=[e]);var l=a!=="string"?q0(e,a,J().getBool("DEBUG")):Xs(e,[],!0);return z.makeTensor(l,o,a)}function ac(e,t,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(a,s){return R(a,t+"["+s+"]",n)},r)}function Z0(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function rk(e,t,n){for(var r=e.length+t.length,a=[],s=0,o=0,l=0;l<r;l++)n.indexOf(l)===-1?a.push(e[s++]):a.push(t[o++]);return a}function Ut(e,t){for(var n=[],r=e.length,a=0;a<r;a++)t.indexOf(a)===-1&&n.push(e[a]);return[n,t.map(function(s){return e[s]})]}function dn(e,t){return rk(e,t.map(function(n){return 1}),t)}function pn(e,t,n){T(Z0(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function gr(e,t){if(Z0(e,t))return null;for(var n=[],r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(function(a){return n.push(a)}),n}function Tf(e){return e.map(function(t,n){return[n,t]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})}function vr(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function ak(e,t){var n=e[0].length;e.forEach(function(a,s){T(a.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+s+"] must be the same as the rank of the rest ("+n+")"})}),T(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(a,s){for(var o=0;o<n;o++)T(o===t||a[o]===r[o],function(){return"Error in concat"+n+"D: Shape of tensors["+s+"] ("+a+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+s+"."})})}function Qs(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function L(e){var t=Object.keys(e);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];z.startScope(n);try{var l=r.apply(void 0,s);return l instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),z.endScope(l),l}catch(c){throw z.endScope(null),c}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}Ee.registerFlag("HAS_WEBGL",function(){return Ee.getNumber("WEBGL_VERSION")>0}),Ee.registerFlag("WEBGL_VERSION",function(){return pg(2)?2:pg(1)?1:0}),Ee.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ee.get("WEBGL_VERSION")===2}),Ee.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Ee.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Ee.registerFlag("WEBGL_PACK",function(){return Ee.getBool("HAS_WEBGL")}),Ee.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_CLIP",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Ee.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_REDUCE",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_CONV_IM2COL",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Yj(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Qj(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=Ee.getNumber("WEBGL_VERSION");return e===0?0:Jj(e)}),Ee.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ee.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),Ee.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Zj(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Ee.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ee.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Ee.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return ek(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return tk(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Ee.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),X0=J0;var Ft=L({complex_:function(e,t){var n=R(e,"real","complex"),r=R(t,"imag","complex");return Ue(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),z.runKernelFunc(function(a){return a.complex(n,r)},{$real:n,$imag:r})}}),Dn=L({real_:function(e){var t=R(e,"input","real");return z.runKernelFunc(function(n){return n.real(t)},{$input:t})}}),ir=L({imag_:function(e){var t=R(e,"input","imag");return z.runKernelFunc(function(n){return n.imag(t)},{$input:t})}});function Ot(e,t,n){return Na(e,t,wa(e,n),n)}function Na(e,t,n,r){if(r==null&&(r=Ni(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!dr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){G0(t);var a=xe(t),s=xe(n);T(a===s,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+s});for(var o=0;o<n.length;++o){var l=n[o],c=o!==n.length-1||l!==xe(t.slice(o));T(n[o]===t[o]||!c,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return dr(e)||Array.isArray(e)||(e=[e]),t=t||n,e=r!=="string"?q0(e,r,J().getBool("DEBUG")):Xs(e,[],!0),z.makeTensor(e,t,r)}function ce(e,t){if((dr(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&dr(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Na(e,[],[],t)}function gt(e,t){so(e);var n=wa(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Na(e,null,n,t)}function ua(e,t,n){if(so(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=wa(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Na(e,t,r,n)}function Pf(e,t,n){if(so(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=wa(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Na(e,t,r,n)}function rn(e,t,n){if(so(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=wa(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Na(e,t,r,n)}function sk(e,t,n){if(so(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=wa(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Na(e,t,r,n)}function ok(e,t,n){if(so(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=wa(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Na(e,t=t||r,r,n)}function ik(e,t,n,r){return t===void 0&&(t=!0),z.makeVariable(e,t,n,r)}function oo(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=oo(e,"float32"),r=Je(e,"float32");return Ft(n,r)}var a=H0(xe(e),t);return z.makeTensor(a,e,t)}function Je(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Je(e,"float32"),r=Je(e,"float32");return Ft(n,r)}var a=_i(xe(e),t);return z.makeTensor(a,e,t)}function fr(e,t,n){return z.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function lk(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return z.runKernelFunc(function(r){return r.linspace(e,t,n)},{})}function sc(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Je([0],r);var a=_i(Math.abs(Math.ceil((t-e)/n)),r);t<e&&n===1&&(n=-1),a[0]=e;for(var s=1;s<a.length;s++)a[s]=a[s-1]+n;return gt(a,r)}var ey=L({onesLike_:function(e){var t=R(e,"x","onesLike");if(t.dtype==="complex64"){var n=ey(Dn(t)),r=Be(ir(t));return Ft(n,r)}return z.runKernelFunc(function(a){return a.onesLike(t)},{$x:t},function(a,s){return{$x:function(){return Be(a)}}})}}),Be=L({zerosLike_:function(e){var t=R(e,"x","zerosLike");return z.runKernelFunc(function(n){return n.zerosLike(t)},{$x:t},function(n,r){return{$x:function(){return Be(n)}}})}}),Nt=L({concat_:function(e,t){t===void 0&&(t=0),T(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=ac(e,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(l){if(l.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+l.dtype+". ")}),t=Ct(t,n[0].shape)[0];var r=Qs(n.map(function(l){return l.shape}),t);if(xe(r)===0)return Ot([],r);if((n=n.filter(function(l){return l.size>0})).length===1)return n[0];var a=n.map(function(l){return l.shape});ak(a,t);var s=n,o={axis:t};return z.runKernelFunc(function(l){return l.concat(n,t)},s,function(l){var c=a.map(function(u){return u[t]});return Ff(l,c,t).map(function(u){return function(){return u}})},"Concat",o)}}),ck=L({concat1d_:function(e){return Nt(e,0)}}),uk=L({concat2d_:function(e,t){return Nt(e,t)}}),dk=L({concat3d_:function(e,t){return Nt(e,t)}}),hk=L({concat4d_:function(e,t){return Nt(e,t)}}),Ff=L({split_:function(e,t,n){n===void 0&&(n=0);var r,a=R(e,"x","split");return n=Ct(n,a.shape)[0],typeof t=="number"?(T(a.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(a.shape[n]/t)):(T(a.shape[n]===t.reduce(function(s,o){return s+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),z.runKernelFunc(function(s){return s.split(a,r,n)},{$x:a},function(s){return{$x:function(){return Nt(s,n)}}})}});function Ja(e,t){return e(t={exports:{}},t.exports),t.exports}var fk=Ja(function(e){(function(t,n,r){function a(l){var c,u=this,d=(c=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var p=.02519603282416938*(c+=h.charCodeAt(f));p-=c=p>>>0,c=(p*=c)>>>0,c+=4294967296*(p-=c)}return 23283064365386963e-26*(c>>>0)});u.next=function(){var h=2091639*u.s0+23283064365386963e-26*u.c;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=0|h)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function s(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var u=new a(l),d=c&&c.state,h=u.next;return h.int32=function(){return 4294967296*u.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(0,e,!1)}),pk=Ja(function(e){(function(t,n,r){function a(l){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},l===(0|l)?c.x=l:u+=l;for(var d=0;d<u.length+64;d++)c.x^=0|u.charCodeAt(d),c.next()}function s(l,c){return c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,c}function o(l,c){var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(0,e,!1)}),mk=Ja(function(e){(function(t,n,r){function a(l){var c=this,u="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^h^h<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,l===(0|l)?c.x=l:u+=l;for(var d=0;d<u.length+64;d++)c.x^=0|u.charCodeAt(d),d==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function s(l,c){return c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,c.v=l.v,c.d=l.d,c}function o(l,c){var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(0,e,!1)}),gk=Ja(function(e){(function(t,n,r){function a(l){var c=this;c.next=function(){var u,d,h=c.x,f=c.i;return u=h[f],d=(u^=u>>>7)^u<<24,d^=(u=h[f+1&7])^u>>>10,d^=(u=h[f+3&7])^u>>>3,d^=(u=h[f+4&7])^u<<7,u=h[f+7&7],d^=(u^=u<<13)^u<<9,h[f]=d,c.i=f+1&7,d},function(u,d){var h,f=[];if(d===(0|d))f[0]=d;else for(d=""+d,h=0;h<d.length;++h)f[7&h]=f[7&h]<<15^d.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],u.x=f,u.i=0,h=256;h>0;--h)u.next()}(c,l)}function s(l,c){return c.x=l.x.slice(),c.i=l.i,c}function o(l,c){l==null&&(l=+new Date);var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(d.x&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(0,e,!1)}),vk=Ja(function(e){(function(t,n,r){function a(l){var c=this;c.next=function(){var u,d,h=c.w,f=c.X,p=c.i;return c.w=h=h+1640531527|0,d=f[p+34&127],u=f[p=p+1&127],d^=d<<13,u^=u<<17,d^=d>>>15,u^=u>>>12,d=f[p]=d^u,c.i=p,d+(h^h>>>16)|0},function(u,d){var h,f,p,m,x,y=[],g=128;for(d===(0|d)?(f=d,d=null):(d+="\0",f=0,g=Math.max(g,d.length)),p=0,m=-32;m<g;++m)d&&(f^=d.charCodeAt((m+32)%d.length)),m===0&&(x=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(x=x+1640531527|0,p=(h=y[127&m]^=f+x)==0?p+1:0);for(p>=128&&(y[127&(d&&d.length||0)]=-1),p=127,m=512;m>0;--m)f=y[p+34&127],h=y[p=p+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,y[p]=f^h;u.w=x,u.X=y,u.i=p}(c,l)}function s(l,c){return c.i=l.i,c.w=l.w,c.X=l.X.slice(),c}function o(l,c){l==null&&(l=+new Date);var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(d.X&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(0,e,!1)}),xk=Ja(function(e){(function(t,n,r){function a(l){var c=this,u="";c.next=function(){var h=c.b,f=c.c,p=c.d,m=c.a;return h=h<<25^h>>>7^f,f=f-p|0,p=p<<24^p>>>8^m,m=m-h|0,c.b=h=h<<20^h>>>12^f,c.c=f=f-p|0,c.d=p<<16^f>>>16^m,c.a=m-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,l===Math.floor(l)?(c.a=l/4294967296|0,c.b=0|l):u+=l;for(var d=0;d<u.length+20;d++)c.b^=0|u.charCodeAt(d),c.next()}function s(l,c){return c.a=l.a,c.b=l.b,c.c=l.c,c.d=l.d,c}function o(l,c){var u=new a(l),d=c&&c.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&s(d,u),h.state=function(){return s(u,{})}),h}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(0,e,!1)}),Da=Ja(function(e){(function(t,n){var r,a=this,s=256,o=6,l="random",c=n.pow(s,o),u=n.pow(2,52),d=2*u,h=s-1;function f(g,v,w){var b=[],N=x(function k(j,S){var M,D=[],A=typeof j;if(S&&A=="object")for(M in j)try{D.push(k(j[M],S-1))}catch{}return D.length?D:A=="string"?j:j+"\0"}((v=v==1?{entropy:!0}:v||{}).entropy?[g,y(t)]:g??function(){try{var k;return r&&(k=r.randomBytes)?k=k(s):(k=new Uint8Array(s),(a.crypto||a.msCrypto).getRandomValues(k)),y(k)}catch{var j=a.navigator,S=j&&j.plugins;return[+new Date,a,S,a.screen,y(t)]}}(),3),b),_=new p(b),C=function(){for(var k=_.g(o),j=c,S=0;k<u;)k=(k+S)*s,j*=s,S=_.g(1);for(;k>=d;)k/=2,j/=2,S>>>=1;return(k+S)/j};return C.int32=function(){return 0|_.g(4)},C.quick=function(){return _.g(4)/4294967296},C.double=C,x(y(_.S),t),(v.pass||w||function(k,j,S,M){return M&&(M.S&&m(M,_),k.state=function(){return m(_,{})}),S?(n[l]=k,j):k})(C,N,"global"in v?v.global:this==n,v.state)}function p(g){var v,w=g.length,b=this,N=0,_=b.i=b.j=0,C=b.S=[];for(w||(g=[w++]);N<s;)C[N]=N++;for(N=0;N<s;N++)C[N]=C[_=h&_+g[N%w]+(v=C[N])],C[_]=v;(b.g=function(k){for(var j,S=0,M=b.i,D=b.j,A=b.S;k--;)j=A[M=h&M+1],S=S*s+A[h&(A[M]=A[D=h&D+j])+(A[D]=j)];return b.i=M,b.j=D,S})(s)}function m(g,v){return v.i=g.i,v.j=g.j,v.S=g.S.slice(),v}function x(g,v){for(var w,b=g+"",N=0;N<b.length;)v[h&N]=h&(w^=19*v[h&N])+b.charCodeAt(N++);return y(v)}function y(g){return String.fromCharCode.apply(0,g)}if(n["seed"+l]=f,x(n.random(),t),e.exports){e.exports=f;try{r=require("crypto")}catch{}}})([],Math)});Da.alea=fk,Da.xor128=pk,Da.xorwow=mk,Da.xorshift7=gk,Da.xor4096=vk,Da.tychei=xk;var $c=Da.alea,Mf=function(){function e(t,n,r,a,s){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=s||Math.random();this.random=$c(o.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var n,r,a=!1;!a;){var s=void 0,o=void 0,l=void 0;do l=(s=2*this.random()-1)*s+(o=2*this.random()-1)*o;while(l>=1||l===0);var c=Math.sqrt(-2*Math.log(l)/l);n=this.mean+this.stdDev*s*c,r=this.mean+this.stdDev*o*c,this.truncated&&!this.isValidTruncated(n)||(a=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},e.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}(),yk=function(){function e(t,n,r,a){this.alpha=t,this.beta=1/n,this.dtype=r;var s=a||Math.random();this.randu=$c(s.toString()),this.randn=new Mf(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var t,n,r,a,s,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,n=1-.331*(t=a*a)*t,r=.5*t+this.d*(1-o+Math.log(o)),(s=this.randu())<n||Math.log(s)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},e.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},e}(),bk=function(){function e(t,n,r,a){var s=this;if(t===void 0&&(t=0),n===void 0&&(n=1),this.canReturnFloat=function(){return s.dtype==null||s.dtype==="float32"},this.min=t,this.range=n-t,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+n+" <= 1 and dtype is not float");this.random=$c(a)}return e.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function De(e,t,n){return t===void 0&&(t="float32"),t=t||"float32",G0(e),new di(e,t,n)}function wk(e,t){t===void 0&&(t=!1),console.log(e.toString(t))}var ty=L({batchToSpaceND_:function(e,t,n){var r=R(e,"x","batchToSpaceND"),a=t.reduce(function(s,o){return s*o});return T(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),T(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),T(r.shape[0]%a==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a}),z.runKernelFunc(function(s){return s.batchToSpaceND(r,t,n)},{$x:r},function(s){return{$x:function(){return s.spaceToBatchND(t,n)}}})}}),Nk=L({broadcastTo_:function(e,t){var n=R(e,"broadcastTo","x"),r=n.shape;if(t.some(function(c){return!(c>0)||c%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=n.reshape(a)}for(var s=Array.from(t),o=t.length-1;o>=0;o--)if(n.shape[o]===t[o])s[o]=1;else if(n.shape[o]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var l=s.map(function(c,u){return c>1?u:-1}).filter(function(c){return c>=0});return l.length===0?n.clone():z.runKernelFunc(function(c){return c.tile(n,s)},{input:n},function(c){return{input:function(){return c.sum(l,!0)}}})}}),_k=L({cast_:function(e,t){var n=R(e,"x","cast");if(!mj(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return z.runKernelFunc(function(a){return a.cast(n,t)},{x:n},function(a){return{x:function(){return a.clone()}}},"Cast",r)}}),jk=L({clone_:function(e){var t=R(e,"x","clone",null);return z.runKernelFunc(function(){return z.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(n){return{$x:function(){return n.toFloat()}}})}}),kk=L({cumsum_:function(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var a=R(e,"x","cumsum"),s=gr([t|=0],a.rank),o=a;s!=null&&(o=a.transpose(s));var l=vr(1,a.rank)[0],c=z.runKernelFunc(function(u){return u.cumsum(o,l,n,r)},{permutedX:o},function(u){return{permutedX:function(){return u.cumsum(t,n,!r)}}});return s!=null&&(c=c.transpose(s)),c}}),Ck=L({depthToSpace_:function(e,t,n){n===void 0&&(n="NHWC");var r=R(e,"x","depthToSpace"),a=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],o=n==="NHWC"?r.shape[3]:r.shape[1];return T(a*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),T(s*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+s+" and "+t+` for depthToSpace with input shape
          `+r.shape}),T(o%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape}),z.runKernelFunc(function(l){return l.depthToSpace(r,t,n)},{$x:r})}}),Rn=L({expandDims_:function(e,t){t===void 0&&(t=0);var n=R(e,"x","expandDims",null);T(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(T(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),qn(n,r)}}),ny=L({eye_:function(e,t,n,r){r===void 0&&(r="float32"),t==null&&(t=e);for(var a=De([e,t],r),s=e<=t?e:t,o=0;o<s;++o)a.set(1,o,o);var l=a.toTensor().as2D(e,t);if(n==null)return l;if(n.length===1)return Ps(Rn(l,0),[n[0],1,1]);if(n.length===2)return Ps(Rn(Rn(l,0),0),[n[0],n[1],1,1]);if(n.length===3)return Ps(Rn(Rn(Rn(l,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Sk=L({multinomial_:function(e,t,n,r){r===void 0&&(r=!1);var a=R(e,"logits","multinomial"),s=a.size,o=a.rank;if(s<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+s+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var l=o===1?a.as2D(1,-1):a,c=z.runKernelFunc(function(u){return u.multinomial(l,r,t,n)},{logits2D:l});return o===1?c.as1D():c}}),mh=L({oneHot_:function(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=R(e,"indices","oneHot","int32"),s=a.shape.concat([t]);return a=a.flatten(),z.runKernelFunc(function(o){return o.oneHot(a,t,n,r)},{$indices:a},function(o){return{$indices:function(){return Je(a.shape,"float32")}}}).reshape(s)}}),Za=L({pad_:function(e,t,n){n===void 0&&(n=0);var r=R(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n};return z.runKernelFunc(function(s){return s.pad(r,t,n)},{x:r},function(s){var o=t.map(function(l){return l[0]});return{x:function(){return s.slice(o,r.shape)}}},"PadV2",a)}}),Ek=L({pad1d_:function(e,t,n){return n===void 0&&(n=0),T(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Za(e,[t],n)}}),Rk=L({pad2d_:function(e,t,n){return n===void 0&&(n=0),T(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Za(e,t,n)}}),Dk=L({pad3d_:function(e,t,n){return n===void 0&&(n=0),T(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Za(e,t,n)}}),Ik=L({pad4d_:function(e,t,n){return n===void 0&&(n=0),T(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Za(e,t,n)}}),Ak=L({rand_:function(e,t,n){var r=xe(e),a=null;if(n==null||n==="float32")a=new Float32Array(r);else if(n==="int32")a=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);a=new Uint8Array(r)}for(var s=0;s<r;s++)a[s]=t();return z.makeTensor(a,e,n)}}),Tk=L({randomNormal_:function(e,t,n,r,a){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var s=new Mf(t,n,r,!1,a),o=De(e,r),l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}}),Pk=L({randomGamma_:function(e,t,n,r,a){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var s=new yk(t,n,r,a),o=De(e,r),l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}}),ry=L({randomUniform_:function(e,t,n,r,a){t===void 0&&(t=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var s=De(e,r),o=new bk(t,n,null,a),l=0;l<s.values.length;l++)s.values[l]=o.nextValue();return s.toTensor()}}),qn=L({reshape_:function(e,t){var n=R(e,"x","reshape",null);t=fj(t,n.size),T(n.size===xe(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return z.runKernelFunc(function(a){return a.reshape(n,t)},{x:n},function(a){return{x:function(){return a.reshape(n.shape)}}},"Reshape",r)}}),ay=L({spaceToBatchND_:function(e,t,n){var r=R(e,"x","spaceToBatchND");return T(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),T(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),T(r.shape.reduce(function(a,s,o){return o>0&&o<=t.length?a&&(s+n[o-1][0]+n[o-1][1])%t[o-1]==0:a},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),z.runKernelFunc(function(a){return a.spaceToBatchND(r,t,n)},{$x:r},function(a){return{$x:function(){return a.batchToSpaceND(t,n)}}})}}),sy=L({squeeze_:function(e,t){var n=R(e,"x","squeeze");return qn(n,Ia(n.shape,t).newShape)}}),Nn=L({stack_:function(e,t){t===void 0&&(t=0);var n=ac(e,"tensors","stack");if(T(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(t);var r=n[0].rank,a=n[0].shape,s=n[0].dtype;T(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(l){Ue(a,l.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(l){T(s===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=n.map(function(l){return l.expandDims(t)});return Nt(o,t)}}),Ps=L({tile_:function(e,t){var n=R(e,"x","tile",null);T(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],a={reps:t};return z.runKernelFunc(function(s,o){var l=s.tile(n,t);return o([n]),l},{x:n},function(s,o){var l=o[0];return{x:function(){var c=Be(l);if(l.rank===1)for(var u=0;u<t[0];++u)c=c.add(s.slice([u*l.shape[0]],[l.shape[0]]));else if(l.rank===2)for(u=0;u<t[0];++u)for(var d=0;d<t[1];++d)c=c.add(s.slice([u*l.shape[0],d*l.shape[1]],[l.shape[0],l.shape[1]]));else if(l.rank===3)for(u=0;u<t[0];++u)for(d=0;d<t[1];++d)for(var h=0;h<t[2];++h)c=c.add(s.slice([u*l.shape[0],d*l.shape[1],h*l.shape[2]],[l.shape[0],l.shape[1],l.shape[2]]));else{if(l.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+l.rank+" tensors yet.");for(u=0;u<t[0];++u)for(d=0;d<t[1];++d)for(h=0;h<t[2];++h)for(var f=0;f<t[3];++f)c=c.add(s.slice([u*l.shape[0],d*l.shape[1],h*l.shape[2],f*l.shape[3]],[l.shape[0],l.shape[1],l.shape[2],l.shape[3]]))}return c}}},"Tile",a,r)}}),Fk=L({truncatedNormal_:function(e,t,n,r,a){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var s=new Mf(t,n,r,!0,a),o=De(e,r),l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}}),_t=L({unstack_:function(e,t){t===void 0&&(t=0),t=t||0;var n=R(e,"x","unstack");T(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return z.runKernelFunc(function(a){return a.unstack(n,t)},{x:n},function(a){return{x:function(){return Nn(a,t)}}},"Unpack",r)}}),Mk=function(e,t){return ge(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d,h;return ve(this,function(f){switch(f.label){case 0:return n=R(e,"x","setdiff1d"),r=R(t,"y","setdiff1d"),T(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),T(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),T(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return a=f.sent(),[4,r.data()];case 2:for(s=f.sent(),o=new Set(s),l=0,d=0;d<a.length;d++)o.has(a[d])||l++;for(c=new di([l],n.dtype),u=new di([l],"int32"),d=0,h=0;d<a.length;d++)o.has(a[d])||(c.values[h]=a[d],u.values[h]=d,h++);return[2,[c.toTensor(),u.toTensor()]]}})})};function oc(e,t,n,r){r===void 0&&(r=!0);var a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var s=t.length,o=0;o<s;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(s+1))}return a}function ic(e,t,n){n===void 0&&(n=!0);var r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{var s=[],o=[];for(a=1;a<e;++a)a>=2*t+1||a%2==1?o.push(a):s.push(a);r.push.apply(r,s),r.push(0),r.push.apply(r,o)}return r}function lc(e,t,n,r){r===void 0&&(r=!0);var a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var s=1;s<e.length;++s)s<=t.length?r?a.push(t[s-1]*e[s]):a.push(e[s]/t[s-1]):a.push(e[s]);return a}function oy(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function iy(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function ly(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],a=1,s=0;s<n.length-1;++s)a*=n[s];var o=e.shape,l=n.slice();l.pop();var c=1;for(s=r;s<e.rank;++s)c*=o[s],l.push(o[s]);var u=hr(e.shape).map(function(d){return d/c}).concat([1]).slice(0,r);return[l,a,c,u]}var cy=30;function Bu(e){return e<=cy?e:ch(e,Math.floor(Math.sqrt(e)))}function Ok(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,s="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+a+".";if(n.rank<a)throw new Error(s+" update.rank < "+a+". ");if(e.length<r+(n.rank-a))throw new Error(s+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(s+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(s+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-a;++o)if(n.shape[o+a]!==e[o+r])throw new Error(s+" updates.shape["+(o+a)+"] ("+n.shape[o+a]+") != shape["+(o+a)+"] ("+e[o+a]+")")}function Lk(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Ok(n,t,e)}function cc(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,s=n.length,o=1,l=a;l<s;++l)o*=n[l];var c=a<1?1:a;return{sliceRank:a,numUpdates:xe(t.shape)/c,sliceSize:o,strides:hr(n.slice(0,a)).concat([1]),outputSize:xe(n)}}function Bk(e,t,n){T(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),T(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(s){T(t[s]+n[s]<=e.shape[s],function(){return"Error in slice"+e.rank+"D: begin["+s+"] + size["+s+"] ("+(t[s]+n[s])+") would overflow input.shape["+s+"] ("+e.shape[s]+")"})},a=0;a<e.rank;++a)r(a)}function gg(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Of(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function $k(e,t,n,r,a){var s=t[a],o=n[a]||1;(e&1<<a||s==null)&&(s=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var l=r[a];return s<0&&(s+=l),s=oh(0,s,l-1)}function Wk(e,t,n,r,a){var s=t[a],o=n[a]||1;(e&1<<a||s==null)&&(s=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var l=r[a];return s<0&&(s+=l),s=o>0?oh(0,s,l):oh(-1,s,l-1)}function uy(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function dy(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function zk(e,t){T(lh(e),function(){return"The f passed in variableGrads(f) must be a function"}),T(t==null||Array.isArray(t)&&t.every(function(d){return d instanceof Ys}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=t!=null;if(!n)for(var r in t=[],z.registeredVariables)t.push(z.registeredVariables[r]);var a=n?t.filter(function(d){return!d.trainable}):null,s=t.length;T((t=t.filter(function(d){return d.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+s+" variables is trainable."});var o=z.gradients(e,t,null,!0),l=o.value,c=o.grads;T(c.some(function(d){return d!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),T(l.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+l.rank+" tensor"});var u={};return t.forEach(function(d,h){c[h]!=null&&(u[d.name]=c[h])}),a!=null&&a.forEach(function(d){return u[d.name]=null}),{value:l,grads:u}}function Wc(e){return z.customGrad(e)}var Mr=L({softmax_:function(e,t){t===void 0&&(t=-1);var n=R(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return z.runKernelFunc(function(r,a){var s=r.softmax(n,t);return a([s]),s},{logits:n},function(r,a){var s=a[0],o=r.mul(s);return{logits:function(){return o.sub(o.sum([t],!0).mul(s))}}},"Softmax",{dim:t},[],[!0])}}),Uk=L({logSoftmax_:function(e,t){t===void 0&&(t=-1);var n=R(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Wc(function(r,a){var s=r.max(t,!0),o=r.sub(s),l=o.toFloat().sub(o.exp().sum(t,!0).log());return a([l]),{value:l,gradFunc:function(c,u){var d=u[0].exp();return c.sub(c.sum(t,!0).mul(d))}}})(n)}}),hy=function(){function e(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},e.prototype.set=function(t,n){this.dataIdsCount++,this.data.set(t,n)},e.prototype.has=function(t){return this.data.has(t)},e.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),fy=function(){function e(){}return e.prototype.time=function(t){return K("time")},e.prototype.read=function(t){return K("read")},e.prototype.readSync=function(t){return K("readSync")},e.prototype.numDataIds=function(){return K("numDataIds")},e.prototype.disposeData=function(t){return K("disposeData")},e.prototype.write=function(t,n,r){return K("write")},e.prototype.move=function(t,n,r,a){return K("move")},e.prototype.memory=function(){return K("memory")},e.prototype.floatPrecision=function(){return K("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(t,n,r,a){return K("batchMatMul")},e.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,K("fusedBatchMatMul")},e.prototype.slice=function(t,n,r){return K("slice")},e.prototype.stridedSlice=function(t,n,r,a){return K("stridedSlice")},e.prototype.unstack=function(t,n){return K("unstack")},e.prototype.reverse=function(t,n){return K("reverse")},e.prototype.concat=function(t,n){return K("concat")},e.prototype.neg=function(t){return K("neg")},e.prototype.add=function(t,n){return K("add")},e.prototype.addN=function(t){return K("addN")},e.prototype.subtract=function(t,n){return K("subtract")},e.prototype.multiply=function(t,n){return K("multiply")},e.prototype.realDivide=function(t,n){return K("realDivide")},e.prototype.floorDiv=function(t,n){return K("floorDiv")},e.prototype.sum=function(t,n){return K("sum")},e.prototype.prod=function(t,n){return K("prod")},e.prototype.unsortedSegmentSum=function(t,n,r){return K("unsortedSegmentSum")},e.prototype.argMin=function(t,n){return K("argMin")},e.prototype.argMax=function(t,n){return K("argMax")},e.prototype.equal=function(t,n){return K("equal")},e.prototype.notEqual=function(t,n){return K("notEqual")},e.prototype.less=function(t,n){return K("less")},e.prototype.lessEqual=function(t,n){return K("lessEqual")},e.prototype.greater=function(t,n){return K("greater")},e.prototype.greaterEqual=function(t,n){return K("greaterEqual")},e.prototype.logicalNot=function(t){return K("logicalNot")},e.prototype.logicalAnd=function(t,n){return K("logicalAnd")},e.prototype.logicalOr=function(t,n){return K("logicalOr")},e.prototype.where=function(t){return K("where")},e.prototype.select=function(t,n,r){return K("select")},e.prototype.topk=function(t,n,r){return K("topk")},e.prototype.min=function(t,n){return K("min")},e.prototype.minimum=function(t,n){return K("minimum")},e.prototype.mod=function(t,n){return K("mod")},e.prototype.max=function(t,n){return K("max")},e.prototype.maximum=function(t,n){return K("maximum")},e.prototype.all=function(t,n){return K("all")},e.prototype.any=function(t,n){return K("any")},e.prototype.squaredDifference=function(t,n){return K("squaredDifference")},e.prototype.ceil=function(t){return K("ceil")},e.prototype.floor=function(t){return K("floor")},e.prototype.round=function(t){return K("round")},e.prototype.sign=function(t){return K("sign")},e.prototype.isNaN=function(t){return K("isNaN")},e.prototype.isInf=function(t){return K("isInf")},e.prototype.isFinite=function(t){return K("isFinite")},e.prototype.pow=function(t,n){return K("pow")},e.prototype.exp=function(t){return K("exp")},e.prototype.expm1=function(t){return K("expm1")},e.prototype.softmax=function(t,n){return K("softmax")},e.prototype.log=function(t){return K("log")},e.prototype.log1p=function(t){return K("log1p")},e.prototype.sqrt=function(t){return K("sqrt")},e.prototype.rsqrt=function(t){return K("rsqrt")},e.prototype.square=function(t){return K("square")},e.prototype.reciprocal=function(t){return K("reciprocal")},e.prototype.relu=function(t){return K("relu")},e.prototype.relu6=function(t){return K("relu6")},e.prototype.prelu=function(t,n){return K("prelu")},e.prototype.elu=function(t){return K("elu")},e.prototype.eluDer=function(t,n){return K("eluDer")},e.prototype.selu=function(t){return K("selu")},e.prototype.int=function(t){return K("int")},e.prototype.clip=function(t,n,r){return K("clip")},e.prototype.abs=function(t){return K("abs")},e.prototype.complexAbs=function(t){return K("complexAbs")},e.prototype.sigmoid=function(t){return K("sigmoid")},e.prototype.softplus=function(t){return K("softplus")},e.prototype.sin=function(t){return K("sin")},e.prototype.cos=function(t){return K("cos")},e.prototype.tan=function(t){return K("tan")},e.prototype.asin=function(t){return K("asin")},e.prototype.acos=function(t){return K("acos")},e.prototype.atan=function(t){return K("atan")},e.prototype.atan2=function(t,n){return K("atan2")},e.prototype.sinh=function(t){return K("sinh")},e.prototype.cosh=function(t){return K("cosh")},e.prototype.tanh=function(t){return K("tanh")},e.prototype.asinh=function(t){return K("asinh")},e.prototype.acosh=function(t){return K("acosh")},e.prototype.atanh=function(t){return K("atanh")},e.prototype.erf=function(t){return K("erf")},e.prototype.step=function(t,n){return K("step")},e.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,K("fusedConv2d")},e.prototype.conv2d=function(t,n,r){return K("conv2d")},e.prototype.conv2dDerInput=function(t,n,r){return K("conv2dDerInput")},e.prototype.conv2dDerFilter=function(t,n,r){return K("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,K("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(t,n,r){return K("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(t,n,r){return K("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){return K("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(t,n,r){return K("conv3d")},e.prototype.conv3dDerInput=function(t,n,r){return K("conv3dDerInput")},e.prototype.conv3dDerFilter=function(t,n,r){return K("conv3dDerFilter")},e.prototype.maxPool=function(t,n){return K("maxPool")},e.prototype.maxPoolBackprop=function(t,n,r,a){return K("maxPoolBackprop")},e.prototype.avgPool=function(t,n){return K("avgPool")},e.prototype.avgPoolBackprop=function(t,n,r){return K("avgPoolBackprop")},e.prototype.avgPool3d=function(t,n){return K("avgPool3d")},e.prototype.avgPool3dBackprop=function(t,n,r){return K("avgPool3dBackprop")},e.prototype.maxPool3d=function(t,n){return K("maxPool3d")},e.prototype.maxPool3dBackprop=function(t,n,r,a){return K("maxPool3dBackprop")},e.prototype.reshape=function(t,n){return K("reshape")},e.prototype.cast=function(t,n){return K("cast")},e.prototype.tile=function(t,n){return K("tile")},e.prototype.pad=function(t,n,r){return K("pad")},e.prototype.transpose=function(t,n){return K("transpose")},e.prototype.gather=function(t,n,r){return K("gather")},e.prototype.gatherND=function(t,n){return K("gatherND")},e.prototype.scatterND=function(t,n,r){return K("scatterND")},e.prototype.batchToSpaceND=function(t,n,r){return K("batchToSpaceND")},e.prototype.spaceToBatchND=function(t,n,r){return K("spaceToBatchND")},e.prototype.resizeBilinear=function(t,n,r,a){return K("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(t,n,r){return K("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(t,n,r,a){return K("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){return K("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(t,n,r,a,s,o){return K("batchNormalization")},e.prototype.localResponseNormalization4D=function(t,n,r,a,s){return K("localResponseNormalization4D")},e.prototype.LRNGrad=function(t,n,r,a,s,o,l){return K("LRNGrad")},e.prototype.multinomial=function(t,n,r,a){return K("multinomial")},e.prototype.oneHot=function(t,n,r,a){return K("oneHot")},e.prototype.cumsum=function(t,n,r,a){return K("cumsum")},e.prototype.nonMaxSuppression=function(t,n,r,a,s){return K("nonMaxSuppression")},e.prototype.fft=function(t){return K("fft")},e.prototype.ifft=function(t){return K("ifft")},e.prototype.complex=function(t,n){return K("complex")},e.prototype.real=function(t){return K("real")},e.prototype.imag=function(t){return K("imag")},e.prototype.cropAndResize=function(t,n,r,a,s,o){return K("cropAndResize")},e.prototype.depthToSpace=function(t,n,r){return K("depthToSpace")},e.prototype.split=function(t,n,r){return K("split")},e.prototype.sparseToDense=function(t,n,r,a){return K("sparseToDense")},e.prototype.diag=function(t){return K("diag")},e.prototype.fill=function(t,n,r){return K("fill")},e.prototype.onesLike=function(t){return K("onesLike")},e.prototype.zerosLike=function(t){return K("zerosLike")},e.prototype.linspace=function(t,n,r){return K("linspace")},e.prototype.dispose=function(){return K("dispose")},e}();function K(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Jr(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var s=n-1-a,o=e[s]||1;(t[t.length-1-a]||1)>1&&o===1&&r.unshift(s)}return r}function jt(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],s=t.length-r-1,o=t[s];(a==null||a===1&&o>1)&&n.unshift(s)}return n}function Pe(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var s=e[e.length-a-1];s==null&&(s=1);var o=t[t.length-a-1];if(o==null&&(o=1),s===1)n.unshift(o);else if(o===1)n.unshift(s);else{if(s!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(s)}}return n}function fi(e,t,n,r,a,s,o){o===void 0&&(o="channelsLast");var l,c=hc(t),u=c[0],d=c[1];if(o==="channelsLast")l=[u,d,e[3],e[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);l=[u,d,e[1],e[1]]}return es(e,l,n,r,a,s,!1,o)}function uc(e,t,n,r,a,s,o){o===void 0&&(o="NDHWC");var l,c,u=gh(t),d=u[0],h=u[1],f=u[2];if(o==="NDHWC")c="channelsLast",l=[d,h,f,e[4],e[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);c="channelsFirst",l=[d,h,f,e[1],e[1]]}return dc(e,l,n,r,a,!1,c,s)}function es(e,t,n,r,a,s,o,l){o===void 0&&(o=!1),l===void 0&&(l="channelsLast");var c=[-1,-1,-1,-1],u=c[0],d=c[1],h=c[2],f=c[3];if(l==="channelsLast")u=e[0],d=e[1],h=e[2],f=e[3];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);u=e[0],f=e[1],d=e[2],h=e[3]}var p,m=t[0],x=t[1],y=t[3],g=hc(n),v=g[0],w=g[1],b=hc(r),N=b[0],_=b[1],C=Fs(m,N),k=Fs(x,_),j=function(B,F,U,V,P,$,I,q){var X,ne,ie;if(typeof B=="number"){X={top:B,bottom:B,left:B,right:B,type:B===0?"VALID":"NUMBER"};var le=function(H,O,Q,oe,ue){oe==null&&(oe=py(H,O,Q));var W=H[0],ae=H[1],je=Oo((W-O+2*oe)/Q+1,ue);T(dt(je),function(){return"The output # of rows ("+je+") must be an integer. Change the stride and/or zero pad parameters"});var de=Oo((ae-O+2*oe)/Q+1,ue);return T(dt(de),function(){return"The output # of columns ("+de+") must be an integer. Change the stride and/or zero pad parameters"}),[je,de]}([F,U],$,V,B,q);ne=le[0],ie=le[1]}else if(B==="same"){ne=Math.ceil(F/V),ie=Math.ceil(U/P);var pe=Math.max(0,(ne-1)*V+$-F),_e=Math.max(0,(ie-1)*P+I-U),G=Math.floor(pe/2),re=pe-G,Ce=Math.floor(_e/2);X={top:G,bottom:re,left:Ce,right:_e-Ce,type:"SAME"}}else{if(B!=="valid")throw Error("Unknown padding parameter: "+B);X={top:0,bottom:0,left:0,right:0,type:"VALID"},ne=Math.ceil((F-$+1)/V),ie=Math.ceil((U-I+1)/P)}return{padInfo:X,outHeight:ne,outWidth:ie}}(a,d,h,v,w,C,k,s),S=j.padInfo,M=j.outHeight,D=j.outWidth,A=o?y*f:y;return l==="channelsFirst"?p=[u,A,M,D]:l==="channelsLast"&&(p=[u,M,D,A]),{batchSize:u,dataFormat:l,inHeight:d,inWidth:h,inChannels:f,outHeight:M,outWidth:D,outChannels:A,padInfo:S,strideHeight:v,strideWidth:w,filterHeight:m,filterWidth:x,effectiveFilterHeight:C,effectiveFilterWidth:k,dilationHeight:N,dilationWidth:_,inShape:e,outShape:p,filterShape:t}}function dc(e,t,n,r,a,s,o,l){s===void 0&&(s=!1),o===void 0&&(o="channelsLast");var c=[-1,-1,-1,-1,-1],u=c[0],d=c[1],h=c[2],f=c[3],p=c[4];if(o==="channelsLast")u=e[0],d=e[1],h=e[2],f=e[3],p=e[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);u=e[0],p=e[1],d=e[2],h=e[3],f=e[4]}var m,x=t[0],y=t[1],g=t[2],v=t[4],w=gh(n),b=w[0],N=w[1],_=w[2],C=gh(r),k=C[0],j=C[1],S=C[2],M=Fs(x,k),D=Fs(y,j),A=Fs(g,S),B=function(I,q,X,ne,ie,le,pe,_e,G,re,Ce){var H,O,Q,oe;if(typeof I=="number"){H={top:I,bottom:I,left:I,right:I,front:I,back:I,type:I===0?"VALID":"NUMBER"};var ue=function(me,ke,Me,Ye,$e,St){$e==null&&($e=py(me,ke,Ye));var Zn=me[0],ja=me[1],rs=me[2],yr=Oo((Zn-ke+2*$e)/Ye+1,St);T(dt(yr),function(){return"The output # of depths ("+yr+") must be an integer. Change the stride and/or zero pad parameters"});var lo=Oo((ja-ke+2*$e)/Ye+1,St);T(dt(lo),function(){return"The output # of rows ("+lo+") must be an integer. Change the stride and/or zero pad parameters"});var Wr=Oo((rs-ke+2*$e)/Ye+1,St);return T(dt(Wr),function(){return"The output # of columns ("+Wr+") must be an integer. Change the stride and/or zero pad parameters"}),[yr,lo,Wr,Me]}([q,X,ne,1],_e,1,ie,I,Ce);O=ue[0],Q=ue[1],oe=ue[2]}else if(I==="same"){O=Math.ceil(q/ie),Q=Math.ceil(X/le),oe=Math.ceil(ne/pe);var W=(O-1)*ie+_e-q,ae=(Q-1)*le+G-X,je=(oe-1)*pe+re-ne,de=Math.floor(W/2),Le=W-de,qe=Math.floor(ae/2),Oe=ae-qe,ee=Math.floor(je/2);H={top:qe,bottom:Oe,left:ee,right:je-ee,front:de,back:Le,type:"SAME"}}else{if(I!=="valid")throw Error("Unknown padding parameter: "+I);H={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},O=Math.ceil((q-_e+1)/ie),Q=Math.ceil((X-G+1)/le),oe=Math.ceil((ne-re+1)/pe)}return{padInfo:H,outDepth:O,outHeight:Q,outWidth:oe}}(a,d,h,f,b,N,_,M,D,A,l),F=B.padInfo,U=B.outDepth,V=B.outHeight,P=B.outWidth,$=s?v*p:v;return o==="channelsFirst"?m=[u,$,U,V,P]:o==="channelsLast"&&(m=[u,U,V,P,$]),{batchSize:u,dataFormat:o,inDepth:d,inHeight:h,inWidth:f,inChannels:p,outDepth:U,outHeight:V,outWidth:P,outChannels:$,padInfo:F,strideDepth:b,strideHeight:N,strideWidth:_,filterDepth:x,filterHeight:y,filterWidth:g,effectiveFilterDepth:M,effectiveFilterHeight:D,effectiveFilterWidth:A,dilationDepth:k,dilationHeight:j,dilationWidth:S,inShape:e,outShape:m,filterShape:t}}function py(e,t,n,r){r===void 0&&(r=1);var a=Fs(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function hc(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function gh(e){return typeof e=="number"?[e,e,e]:e}function Fs(e,t){return t<=1?e:e+(e-1)*(t-1)}function Oo(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Js(e){var t=hc(e),n=t[0],r=t[1],a=t[2];return n===1&&r===1&&a===1}function hn(e,t){return Js(e)||Js(t)}function Lf(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function my(e,t,n){if(t==="complex64"){if(e.dtype==="complex64")return e.clone();var r=Je(e.shape),a=e.toFloat(),s=n.complex(a,r);return r.dispose(),a.dispose(),s}if(!gj(e.dtype,t))return z.makeTensorFromDataId(e.dataId,e.shape,t);if(e.dtype==="complex64"){var o=n.real(e);return s=o.cast(t),o.dispose(),s}if(t==="int32")return n.int(e);if(t==="bool"){var l=ce(0,e.dtype);return s=n.notEqual(e,l),l.dispose(),s}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function vh(e,t){return z.makeTensorFromDataId(e.dataId,t,e.dtype)}function gy(e,t,n){var r=(t-e)/(n-1),a=_i(n,"float32");a[0]=e;for(var s=1;s<a.length;s++)a[s]=a[s-1]+r;return gt(a,"float32")}function xh(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function vg(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Vk(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function qk(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Hk(e,t,n){var r=function(s,o,l){return function(c,u,d){for(var h=0,f=c.length,p=0,m=!1;h<f;){var x=d(u,c[p=h+(f-h>>>1)]);x>0?h=p+1:(f=p,m=!x)}return m?h:-h-1}(s,o,l||Gk)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Gk(e,t){return e>t?1:e<t?-1:0}function Bf(e,t,n,r,a){return vy(e,t,n,r,a,0).selectedIndices}function $f(e,t,n,r,a,s){var o=vy(e,t,n,r,a,s);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function vy(e,t,n,r,a,s,o,l){l===void 0&&(l=!1);for(var c=Array.from(t).map(function(b,N){return{score:b,boxIndex:N,suppressBeginIndex:0}}).filter(function(b){return b.score>a}).sort(xg),u=s>0?-.5/s:0,d=[],h=[];d.length<n&&c.length>0;){var f=c.pop(),p=f.score,m=f.boxIndex,x=f.suppressBeginIndex;if(p<a)break;for(var y=!1,g=d.length-1;g>=x;--g){var v=Kk(e,m,d[g]);if(v>=r){y=!0;break}if(f.score=f.score*Xk(r,u,v),f.score<=a)break}f.suppressBeginIndex=d.length,y||(f.score===p?(d.push(m),h.push(f.score)):f.score>a&&Hk(c,f,xg))}var w=d.length;return l&&(d.fill(0,w),h.fill(0,w)),{selectedIndices:gt(d,"int32"),selectedScores:gt(h,"float32"),numValidOutputs:ce(w,"int32")}}function Kk(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),l=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),u=Math.min(a[0],a[2]),d=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),p=(l-s)*(c-o),m=(h-u)*(f-d);if(p<=0||m<=0)return 0;var x=Math.max(s,u),y=Math.max(o,d),g=Math.min(l,h),v=Math.min(c,f),w=Math.max(g-x,0)*Math.max(v-y,0);return w/(p+m-w)}function Xk(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function xg(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function xy(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map(function(s){a[n]=s;var o=e.slice(r,a);return r[n]+=s,o})}function yy(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var a=De(n,e.dtype);for(r=0;r<a.values.length;++r){for(var s=a.indexToLoc(r),o=new Array(e.rank),l=0;l<o.length;l++)o[l]=s[l]%e.shape[l];var c=e.locToIndex(o);a.values[r]=e.values[c]}return a.toTensor()}function by(e,t,n,r,a){for(var s=t[t.length-1],o=[e.length/s,s],l=o[0],c=o[1],u=ui(n,l*r),d=ui("int32",l*r),h=0;h<l;h++){for(var f=h*c,p=e.subarray(f,f+c),m=[],x=0;x<p.length;x++)m.push({value:p[x],index:x});m.sort(function(b,N){return N.value-b.value});var y=h*r,g=u.subarray(y,y+r),v=d.subarray(y,y+r);for(x=0;x<r;x++)g[x]=m[x].value,v[x]=m[x].index}var w=t.slice();return w[w.length-1]=r,[Ot(u,w,n),Ot(d,w,"int32")]}function Wf(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var a=De(e,"int32"),s=De([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=a.indexToLoc(n[r]),l=r*e.length;s.values.set(o,l)}return s.toTensor()}var Yk=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(a,s){return"T"+s});var n=[];this.variableNames.forEach(function(a){n.push("float v"+a+" = get"+a+"AtOutCoords();")});var r=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},Qk=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(a,s){return"T"+s});var n=[];this.variableNames.forEach(function(a){n.push("vec4 v"+a+" = get"+a+"AtOutCoords();")});var r=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},Jk=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,a=e.batchSize,s=e.inSize,o=Math.ceil(s/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var l=t==="max"?">":"<",c=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+c+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+l+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function wy(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(n){return e+"."+n})}function an(e,t){return t===1?[e]:wy(e,t)}function Ht(){var e,t,n,r,a,s,o,l,c,u;return J().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",a="texture",s="outputColor",o="out vec4 outputColor;",l=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,c="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",a="texture2D",s="gl_FragColor",o="",l=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:s,defineOutput:o,defineSpecialNaN:l,defineSpecialInf:c,defineRound:u}}function Oa(e,t,n){n===void 0&&(n="index");var r=hr(t);return r.map(function(a,s){return"int "+e[s]+" = "+n+" / "+a+"; "+(s===r.length-1?"int "+e[s+1]+" = "+n+" - "+e[s]+" * "+a:"index -= "+e[s]+" * "+a)+";"}).join("")}function zf(e){var t=hr(e).map(function(n){return n.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var Ny=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Zk(e,t,n,r){var a=[];e.forEach(function(p){var m=xe(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?a.push("uniform float "+p.name+(m>1?"["+m+"]":"")+";"):(a.push("uniform sampler2D "+p.name+";"),a.push("uniform int offset"+p.name+";"))});var s,o,l=a.join(`
`),c=e.map(function(p){return function(m,x,y){y===void 0&&(y=!1);var g="";g+=y?_y(m):cs(m);var v=m.shapeInfo.logicalShape,w=x.logicalShape;return v.length<=w.length&&(g+=y?function(b,N){var _,C=b.name,k=C.charAt(0).toUpperCase()+C.slice(1),j="get"+k+"AtOutCoords",S=b.shapeInfo.logicalShape.length,M=N.logicalShape.length,D=Jr(b.shapeInfo.logicalShape,N.logicalShape),A=Xe(M),B=M-S,F=["x","y","z","w","u","v"];_=S===0?"":M<2&&D.length>=1?"coords = 0;":D.map(function(X){return"coords."+F[X+B]+" = 0;"}).join(`
`);var U="";U=M<2&&S>0?"coords":b.shapeInfo.logicalShape.map(function(X,ne){return"coords."+F[ne+B]}).join(", ");var V="return outputValue;",P=xe(b.shapeInfo.logicalShape)===1,$=xe(N.logicalShape)===1;if(S!==1||P||$){if(P&&!$)V=M===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(D.length){var I=S-2,q=S-1;D.indexOf(I)>-1&&D.indexOf(q)>-1?V="return vec4(outputValue.x);":D.indexOf(I)>-1?V="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":D.indexOf(q)>-1&&(V="return vec4(outputValue.xx, outputValue.zz);")}}else V=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+j+`() {
      `+A+` coords = getOutputCoords();
      `+_+`
      vec4 outputValue = get`+k+"("+U+`);
      `+V+`
    }
  `}(m,x):function(b,N){var _=b.name,C=_.charAt(0).toUpperCase()+_.slice(1),k="get"+C+"AtOutCoords",j=N.texShape,S=b.shapeInfo.texShape,M=b.shapeInfo.logicalShape.length,D=N.logicalShape.length;if(!b.shapeInfo.isUniform&&M===D&&b.shapeInfo.flatOffset==null&&It(S,j))return`
      float `+k+`() {
        return sampleTexture(`+_+`, resultUV);
      }
    `;var A,B=Xe(D),F=Jr(b.shapeInfo.logicalShape,N.logicalShape),U=D-M,V=["x","y","z","w","u","v"];A=M===0?"":D<2&&F.length>=1?"coords = 0;":F.map(function($){return"coords."+V[$+U]+" = 0;"}).join(`
`);var P="";return P=D<2&&M>0?"coords":b.shapeInfo.logicalShape.map(function($,I){return"coords."+V[I+U]}).join(", "),`
    float `+k+`() {
      `+B+` coords = getOutputCoords();
      `+A+`
      return get`+C+"("+P+`);
    }
  `}(m,x)),g}(p,t,r)}).join(`
`),u=t.texShape,d=Ht(),h=function(p){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+p.texture2D+`(textureSampler, uv).r;
    }
  `}(d),f=function(p){return p.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+p.varyingFs+` vec2 resultUV;
    `+p.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+p.defineSpecialNaN+`
    `+p.defineSpecialInf+`
    `+p.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+eC+`
    `+tC+`
    `+nC+`
  `}(d);return t.isPacked?(s=function(p,m){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,N){var _=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)];return _[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return 2 * (resTexRC.x * `+_[1]+` + resTexRC.y);
    }
  `}(0,m);case 2:return function(b,N){var _=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)];if(It(b,N))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `;var C=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec2(r, c);
    }
  `}(p,m);case 3:return x=p,y=m,g=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],v=Math.ceil(x[2]/2),w=v*Math.ceil(x[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+w+`;
      index -= b * `+w+`;

      int r = 2 * (index / `+v+`);
      int c = imod(index, `+v+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,N){for(var _=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)],C=Math.ceil(b[b.length-1]/2),k=C*Math.ceil(b[b.length-2]/2),j=k,S="",M="b, r, c",D=2;D<b.length-1;D++)j*=b[b.length-D-1],S=`
      int b`+D+" = index / "+j+`;
      index -= b`+D+" * "+j+`;
    `+S,M="b"+D+", "+M;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+S+`

      int b = index / `+k+`;
      index -= b * `+k+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec`+b.length+"("+M+`);
    }
  `}(p,m)}var x,y,g,v,w}(t.logicalShape,u),o=function(p){return`
    void setOutput(vec4 val) {
      `+p.output+` = val;
    }
  `}(d)):(s=function(p,m){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(g,v){return v[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+v[1]+`.0);
      }
    `:v[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+v[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      return resTexRC.x * `+v[1]+` + resTexRC.y;
    }
  `}(0,m);case 2:return function(g,v){return It(g,v)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+v[0]+", "+v[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+v[0]+", "+v[1]+`));
        int index = resTexRC.x * `+v[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+v[0]+", "+v[1]+`));
        int index = resTexRC.x * `+v[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `}(p,m);case 3:return x=m,y=Oa(["r","c","d"],p),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+y+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(g,v){var w=Oa(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+w+`
      return ivec4(r, c, d, d2);
    }
  `}(p,m);case 5:return function(g,v){var w=Oa(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+v[0]+`,
                             `+v[1]+`));

      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      `+w+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(p,m);case 6:return function(g,v){var w=Oa(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      `+w+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(p,m);default:throw new Error(p.length+"-D output sampling is not yet supported")}var x,y}(t.logicalShape,u),o=function(p){return`
    void setOutput(float val) {
      `+p.output+` = vec4(val, 0, 0, 0);
    }
  `}(d)),r&&(f+=rC),[f,h,o,l,s,c,n].join(`
`)}function cs(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(n){var r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+a+"() {return "+r+";}";var s=n.shapeInfo.texShape,o=s[0],l=s[1];if(o===1&&l===1)return`
      float `+a+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=n.shapeInfo.texShape,u=c[0],d=c[1],h=Ca(r);return`
    float `+a+`() {
      vec2 uv = uvFromFlat(`+u+", "+d+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 1:return function(n){var r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return`
      float `+a+`(int index) {
        `+ss(n)+`
      }
    `;var s=n.shapeInfo.texShape,o=s[0],l=s[1];if(l===1&&o===1)return`
      float `+a+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=Ca(r);return l===1?`
      float `+a+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+c+") + 0.5) / "+o+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:o===1?`
      float `+a+`(int index) {
        vec2 uv = vec2((float(index + `+c+") + 0.5) / "+l+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+a+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+l+", index + "+c+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 2:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n.shapeInfo.texShape;if(o!=null&&It(r,o)){var l=o[0],c=o[1];return`
    float `+s+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `}var u=Ia(r),d=u.newShape,h=u.keptDims,f=d;if(f.length<r.length){var p=us(n,f);return`
      `+cs(p)+`
      float `+s+`(int row, int col) {
        return `+s+"("+ds(["row","col"],h)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+s+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+ss(n)+`
      }
    `;var m=o[0],x=o[1],y=Ca(a);return x===1?`
    float `+s+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+m+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `:m===1?`
    float `+s+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+x+`.0, 0.5);
      return sampleTexture(`+a+`, uv);
    }
  `:`
  float `+s+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+y+`;
    vec2 uv = uvFromFlat(`+m+", "+x+`, index);
    return sampleTexture(`+a+`, uv);
  }
`}(e);case 3:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r[1]*r[2],l=r[2],c=Ia(r),u=c.newShape,d=c.keptDims,h=u;if(h.length<r.length){var f=us(n,h);return`
        `+cs(f)+`
        float `+s+`(int row, int col, int depth) {
          return `+s+"("+ds(["row","col","depth"],d)+`);
        }
      `}if(n.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+l+`, 1)));
        `+ss(n)+`
      }
    `;var p=n.shapeInfo.texShape,m=p[0],x=p[1],y=n.shapeInfo.flatOffset;if(x===o&&y==null)return`
        float `+s+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+l+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+x+".0, "+m+`.0);
          return sampleTexture(`+a+`, uv);
        }
      `;if(x===l&&y==null)return`
    float `+s+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+x+".0, "+m+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `;var g=Ca(a);return`
      float `+s+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+l+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+m+", "+x+`, index);
        return sampleTexture(`+a+`, uv);
      }
  `}(e);case 4:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r[3],l=r[2]*o,c=r[1]*l,u=Ia(r),d=u.newShape,h=u.keptDims;if(d.length<r.length){var f=us(n,d);return`
      `+cs(f)+`
      float `+s+`(int row, int col, int depth, int depth2) {
        return `+s+"("+ds(["row","col","depth","depth2"],h)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+c+", "+l+", "+o+`, 1)));
        `+ss(n)+`
      }
    `;var p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,x=m[0],y=m[1];if(y===c&&p==null)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+l+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+x+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(y===o&&p==null)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+x+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var g=Ca(a);return`
    float `+s+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+l+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+x+", "+y+", index + "+g+`);
      return sampleTexture(`+a+`, uv);
    }
  `}(e);case 5:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r[4],l=r[3]*o,c=r[2]*l,u=r[1]*c,d=Ia(r),h=d.newShape,f=d.keptDims;if(h.length<r.length){var p=us(n,h);return`
      `+cs(p)+`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        return `+s+"("+ds(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+u+", "+c+", "+l+", "+o+`)) +
          depth3;
        `+ss(n)+`
      }
    `;var m=n.shapeInfo.flatOffset,x=n.shapeInfo.texShape,y=x[0],g=x[1];if(g===u&&m==null)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+c+", "+l+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+y+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(g===o&&m==null)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+y+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var v=Ca(a);return`
    float `+s+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+c+" + depth * "+l+` +
          depth2 * `+o+" + depth3 + "+v+`;
      vec2 uv = uvFromFlat(`+y+", "+g+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}(e);case 6:return function(n){var r=n.shapeInfo.logicalShape,a=n.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),o=Ia(r),l=o.newShape,c=o.keptDims;if(l.length<r.length){var u=us(n,l);return`
      `+cs(u)+`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+s+"("+ds(["row","col","depth","depth2","depth3","depth4"],c)+`);
      }
    `}var d=r[5],h=r[4]*d,f=r[3]*h,p=r[2]*f,m=r[1]*p;if(n.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+m+", "+p+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+d+`, 1)));
        `+ss(n)+`
      }
    `;var x=n.shapeInfo.flatOffset,y=n.shapeInfo.texShape,g=y[0],v=y[1];if(v===m&&x==null)return`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+p+", "+f+", "+h+", "+d+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(v===d&&x==null)return`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var w=Ca(a);return`
    float `+s+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+m+" + col * "+p+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+d+" + depth4 + "+w+`;
      vec2 uv = uvFromFlat(`+g+", "+v+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function _y(e){var t,n,r;switch(e.shapeInfo.logicalShape.length){case 0:return t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Ht(),`
    vec4 `+n+`() {
      return `+r.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(a){var s=a.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),l=a.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],u=Ht();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+c[0]+", "+c[1]+`, index);
      return `+u.texture2D+"("+s+`, uv);
    }
  `}(e);case 2:return function(a){var s=a.shapeInfo.logicalShape,o=a.name,l="get"+o.charAt(0).toUpperCase()+o.slice(1),c=a.shapeInfo.texShape,u=c[0],d=c[1],h=Ht();if(c!=null&&It(s,c))return`
      vec4 `+l+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+d+".0, "+u+`.0);

        return `+h.texture2D+"("+o+`, uv);
      }
    `;var f=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],p=Math.ceil(s[1]/2);return`
    vec4 `+l+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+p+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+o+`, uv);
    }
  `}(e);case 3:return function(a){var s=a.shapeInfo.logicalShape,o=a.name,l="get"+o.charAt(0).toUpperCase()+o.slice(1),c=a.shapeInfo.texShape,u=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(s[0]===1){var d=s.slice(1),h=us(a,d);return`
        `+_y(h)+`
        vec4 `+l+`(int b, int row, int col) {
          return `+l+"("+ds(["b","row","col"],[1,2])+`);
        }
      `}var f=u[0],p=u[1],m=Math.ceil(s[2]/2),x=m*Math.ceil(s[1]/2),y=Ht();return`
    vec4 `+l+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+p+", "+x+", "+m+`, b, row, col);
      return `+y.texture2D+"("+o+`, uv);
    }
  `}(e);default:return function(a){for(var s=a.shapeInfo.logicalShape,o=s.length,l=a.name,c="get"+l.charAt(0).toUpperCase()+l.slice(1),u=a.shapeInfo.texShape,d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=d[0],f=d[1],p=Math.ceil(s[o-1]/2),m=p*Math.ceil(s[o-2]/2),x="int b, int row, int col",y="b * "+m+" + (row / 2) * "+p+" + (col / 2)",g=2;g<o-1;g++)x="int b"+g+", "+x,m*=s[o-g-1],y="b"+g+" * "+m+" + "+y;var v=Ht();return`
    vec4 `+c+"("+x+`) {
      int index = `+y+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+v.texture2D+"("+l+`, uv);
    }
  `}(e)}}var eC=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,tC=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,nC=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,rC=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Ca(e){return"offset"+e}function ss(e){var t=e.name,n=xe(e.shapeInfo.logicalShape);return n<2?"return "+t+";":`
    for (int i = 0; i < `+n+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function Xe(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function us(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function ds(e,t){return t.map(function(n){return e[n]}).join(", ")}var aC=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var a=e[e.length-1],s=Math.ceil(a/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");var o,l,c=this.outputShape,u=c.length,d=Xe(u),h=an("coords",u);if(s===1){var f=Xe(l=u+1);o=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[u-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[u-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[u-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[u-2]+";"}else l=u,o=`
        `+d+` sourceLocR = coords;
        ++`+h[u-1]+`;
        `+d+` sourceLocG = coords;
        ++`+h[u-2]+`;
        `+d+` sourceLocA = coords;
        --`+h[u-1]+`;
        `+d+` sourceLocB = coords;
        --`+h[u-2]+";";var p=["x","y","z","w","u","v"].slice(0,l),m="."+p[l-1],x=p.map(function(k){return"int "+k}),y=an("sourceLocR",l-1).concat("inIdx.r"),g=an("sourceLocG",l-1).concat("inIdx.g"),v=an("sourceLocB",l-1).concat("inIdx.b"),w=an("sourceLocA",l-1).concat("inIdx.a"),b=n==="max"?"greaterThan":"lessThan",N=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+w.join()+")));",_=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+w.join()+") : 0.)",C=r?"":`
      float getBestIndicesAChannel(`+x.join()+`) {
        return getChannel(getBestIndicesA(`+p.join()+`),
                                          vec2(`+p.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+x.join()+`) {
        return getChannel(getA(`+p.join()+`),
                               vec2(`+p.slice(-2).join()+`));
      }
      `+C+`
      void main() {
        `+d+` coords = getOutputCoords();
        bool hasNextCol = `+h[u-1]+" < "+(c[u-1]-1)+`;
        bool hasNextRow = `+h[u-2]+" < "+(c[u-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+m+", sourceLocG"+m+`,
          sourceLocB`+m+", sourceLocA"+m+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+_+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+N+`
          vec4 candidate = `+_+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},sC=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+u+", "+d+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`;
            wR += `+s+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+c+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},oC=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=h-1-e.padInfo.top,x=f-1-e.padInfo.left,y=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(`+p+", "+m+", "+x+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+l+`) {
          float dyD = float(dyDCorner + wD) / `+a+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+c+`) {
            float dyR = float(dyRCorner + wR) / `+s+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+u+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},iC=function(e,t,n,r,a,s){this.outputShape=[],this.variableNames=["x","mean","variance"],Pe(e,t),Pe(e,n);var o="0.0";r!=null&&(Pe(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var l="1.0";a!=null&&(Pe(e,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+l+`;
        float inv = scale * inversesqrt(variance + float(`+s+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},lC=function(e,t,n,r,a,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Pe(e,t),Pe(e,n);var o="vec4(0.0)";r!=null&&(Pe(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var l="vec4(1.0)";a!=null&&(Pe(e,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+l+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+s+`));

        setOutput((x - mean) * inv + offset);
      }
    `},cC="return areal * breal - aimag * bimag;",uC="return areal * bimag + aimag * breal;",yg=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Pe(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},$u="return a + b;",Wu="return a - b;",bg="return a * b;",jy="return (a < 0.) ? b * a : a;",lt=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Pe(t,n),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},ky=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,wr=function(e,t,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Pe(t,n);var a=this.outputShape.length,s="";if(r)if(a===0||xe(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          `+Xe(a)+` coords = getOutputCoords();
        `,a===1)s+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=an("coords",a);s+=`
            bool nextRowOutOfBounds =
              (`+o[a-2]+" + 1) >= "+this.outputShape[a-2]+`;
            bool nextColOutOfBounds =
              (`+o[a-1]+" + 1) >= "+this.outputShape[a-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+s+`

        setOutput(result);
      }
    `},dC=function(){function e(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(a,s){r.minLoc==null&&(r.minLoc=a.getUniformLocationNoThrow(s,"minVal"),r.maxLoc=a.getUniformLocationNoThrow(s,"maxVal")),a.gl.uniform1f(r.minLoc,t),a.gl.uniform1f(r.maxLoc,n)}},e}(),hC=function(){function e(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(a,s){r.minLoc==null&&(r.minLoc=a.getUniformLocationNoThrow(s,"minVal"),r.maxLoc=a.getUniformLocationNoThrow(s,"maxVal")),a.gl.uniform1f(r.minLoc,t),a.gl.uniform1f(r.maxLoc,n)}},e}(),fC=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},pC=function(e){this.outputShape=[],this.outputShape=Qs(e,1),this.variableNames=e.map(function(l,c){return"T"+c});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var a=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+a+"));")}var s=t.length,o=t[t.length-1];r.push("else setOutput(getT"+s+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},mC=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Qs(e,t);var n=this.outputShape,r=n.length,a=Xe(r),s=an("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(y,g){return"T"+g});var l=new Array(e.length-1);l[0]=e[0][t];for(var c=1;c<l.length;c++)l[c]=l[c-1]+e[c][t];var u=o[t],d=o.slice(-2),h=o.join(),f="if ("+u+" < "+l[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+d.join()+`));
        }`;for(c=1;c<l.length;c++){var p=l[c-1];f+=`
        if (`+u+" < "+l[c]+"  && "+u+" >= "+l[c-1]+`) {
          return getChannel(
            getT`+c+"("+Zi(o,u,p)+`),
            vec2(`+Zi(d,u,p)+`));
        }`}var m=l.length,x=l[l.length-1];f+=`
        return getChannel(
          getT`+m+"("+Zi(o,u,x)+`),
          vec2(`+Zi(d,u,x)+"));",this.userCode=`
      float getValue(`+o.map(function(y){return"int "+y})+`) {
        `+f+`
      }

      void main() {
        `+a+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+s+`), 0., 0., 0.);

        `+s[r-1]+" = "+s[r-1]+` + 1;
        if (`+s[r-1]+" < "+n[r-1]+`) {
          result.g = getValue(`+s+`);
        }

        `+s[r-2]+" = "+s[r-2]+` + 1;
        if (`+s[r-2]+" < "+n[r-2]+`) {
          result.a = getValue(`+s+`);
        }

        `+s[r-1]+" = "+s[r-1]+` - 1;
        if (`+s[r-2]+" < "+n[r-2]+` &&
            `+s[r-1]+" < "+n[r-1]+`) {
          result.b = getValue(`+s+`);
        }
        setOutput(result);
      }
    `};function Zi(e,t,n){var r=e.indexOf(t);return e.map(function(a,s){return s===r?a+" - "+n:a}).join()}var gC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+a+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+s+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},vC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dataFormat==="channelsLast",o=t-1-e.padInfo.top,l=n-1-e.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+d+`];

        ivec2 dyCorner = ivec2(coords[`+c+"], coords["+u+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+s+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},xC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,s=e.padInfo.top,o=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+a+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+s+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+o+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},yC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=t-1-e.padInfo.front,c=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+c+", "+u+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+a+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+s+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},bC=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+s+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+a+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},wC=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+l+`; dm++) {
              int d2 = d1 * `+l+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},wg=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.padInfo.top,s=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4,m=e.dataFormat==="channelsLast",x=m?1:2,y=m?2:3,g=m?3:1,v="",w="";n&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,w="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+o+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+x+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+m+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(p===1)+`) {

              if (`+m+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(p===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+m+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(p===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+m+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+b+`
        `+w+`
        setOutput(result);
      }
    `},NC=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,f=e.filterWidth,p=4*Math.floor(e.inChannels/4),m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+a+", "+s+", "+o+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+d+`; wF++) {
          int xF = xFCorner + wF * `+l+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+c+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+u+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+p+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(m===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+p+`) *
                  getW(wF, wR, wC, `+p+`, d2);
              } else if (`+(m===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(m===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1),
                  getX(batch, xF, xR, xC, `+p+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2),
                  getW(wF, wR, wC, `+p+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ng=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.inHeight,s=e.inWidth,o=e.padInfo.top,l=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=e.outChannels/e.inChannels,x="",y="";n&&(x=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,y="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+c+", "+u+`);
      const ivec2 pads = ivec2(`+o+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+m+`;
        int q = d2 - d1 * `+m+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+d+`;

          if (xR < 0 || xR >= `+a+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+s+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+y+`
        setOutput(result);
      }
    `},_g=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var a=e.inHeight,s=e.inWidth,o=e.padInfo.top,l=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=p,x="int xR; int xC; int xCOffset;",y=0;y<f;y++)for(var g=0;g<p;g++)x+=`
          vec4 xTexelR`+y+"C"+2*g+` = vec4(0.);
          vec4 wR`+y+"C"+g+` = vec4(0.);
          vec4 xR`+y+"C"+g+" = vec4(0.);";for(y=0;y<f;y++)for(var v=0;v<m;v++){if(x+=`
          xR = xRCorner + `+y*d+`;
          xC = xCCorner + `+(g=2*v)*h+`;
        `,u===1){if(g<p&&(x+=l%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+s+`) {
                  xTexelR`+y+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+s+`) {
                    xTexelR`+y+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+y+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+s+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+s+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+y+"C"+g+" = vec4(previous.zw, xTexelR"+y+"C"+g+`.xy);
                } else {
                  xR`+y+"C"+g+" = vec4(0, 0, xTexelR"+y+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+a+" && xC >= 0 && xC < "+s+`) {
                  xTexelR`+y+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+g+` = vec4(0.);
                }

                xR`+y+"C"+g+" = xTexelR"+y+"C"+g+`;
              `,g+1<p)){var w=l%2==0?U0(h):h;h%2==0&&l%2==1||h%2!=0&&l%2!=1?(x+=`
                  xCOffset = xC + `+l%2+" + "+w+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+s+`) {
                    xTexelR`+y+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(x+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+a+` &&
                      xCOffset >= 0 && xCOffset < `+s+`) {
                      xTexelR`+y+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+y+"C"+g+` = vec4(0.);
                    }
                  `),x+=`
                  xR`+y+"C"+(g+1)+` = vec4(
                    xTexelR`+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+`.xy);
                `):x+=`
                  xCOffset = xC + `+w+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+s+`) {
                    xTexelR`+y+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+y+"C"+(g+1)+" = xTexelR"+y+"C"+(g+2)+`;
                `}}else g<p&&(x+=`
              if(xR >= 0 && xR < `+a+`) {
            `,l%2==1?(x+=`
                xCOffset = xC + 1 - `+u+`;
                if(xCOffset >= 0 && xCOffset < `+s+`) {
                  xTexelR`+y+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+s+`) {
                  xTexelR`+y+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+y+"C"+(g+2)+` = vec4(0.);
                }

                xR`+y+"C"+g+` = vec4(
                  xTexelR`+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+`.zw);
              `,g+1<p&&(x+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+u+`;
                  if(xCOffset >= 0 && xCOffset < `+s+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+y+"C"+(g+1)+" = vec4(xTexelR"+y+"C"+(g+2)+`.xy, final.xy);
                `)):(x+=`
                if(xC >= 0 && xC < `+s+`) {
                  xTexelR`+y+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+u+`;
                if(xCOffset >= 0 && xCOffset < `+s+`) {
                  xTexelR`+y+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+(g+2)+` = vec4(0.);
                }

                xR`+y+"C"+g+` = vec4(
                  xTexelR`+y+"C"+g+".xy, xTexelR"+y+"C"+(g+2)+`.xy);
              `,g+1<p&&(x+=`
                  xR`+y+"C"+(g+1)+` = vec4(
                    xTexelR`+y+"C"+g+".zw, xTexelR"+y+"C"+(g+2)+`.zw);
                `)),x+="}");g<p&&(x+=`
            vec4 wTexelR`+y+"C"+g+" = getW("+y+", "+g+`, d1, q);
            wR`+y+"C"+g+" = vec4(wTexelR"+y+"C"+g+".xz, wTexelR"+y+"C"+g+`.xz);
          `,g+1<p&&(x+=`
              vec4 wTexelR`+y+"C"+(g+1)+" = getW("+y+", "+(g+1)+`, d1, q);
              wR`+y+"C"+(g+1)+` =
                vec4(wTexelR`+y+"C"+(g+1)+".xz, wTexelR"+y+"C"+(g+1)+".xz);"))}for(y=0;y<f;y++)for(g=0;g<p;g++)x+="dotProd += xR"+y+"C"+g+" * wR"+y+"C"+g+";";var b="",N="";n&&(b=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`vec4 activation(vec4 x) {
          `+n+`
        }`,N="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+c+", "+u+`);
      const ivec2 pads = ivec2(`+o+", "+l+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+x+`

        vec4 result = dotProd;
        `+_+`
        `+N+`
        setOutput(result);
      }
    `},_C=function(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var s=e[0],o=e[1],l=e[2],c=e[3],u=t[0],d=n[0],h=n[1];this.outputShape=[u,d,h,c];var f=r==="bilinear"?1:0,p=[o-1+".0",l-1+".0"],m=p[0],x=p[1],y=d>1?[""+(o-1)/(d-1),"(y2-y1) * height_ratio","y1*"+m+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+m],g=y[0],v=y[1],w=y[2],b=h>1?[""+(l-1)/(h-1),"(x2-x1) * width_ratio","x1*"+x+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+x],N=b[0],_=b[1],C=b[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+N+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+s+`) {
          return;
        }

        float height_scale = `+v+`;
        float width_scale = `+_+`;

        float in_y = `+w+`;
        if( in_y < 0.0 || in_y > `+m+` ) {
          setOutput(float(`+a+`));
          return;
        }
        float in_x = `+C+`;
        if( in_x < 0.0 || in_x > `+x+` ) {
          setOutput(float(`+a+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},jC=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,a=e[e.length-1],s=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+a+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Xe(r)+` coords = getOutputCoords();
        int end = `+jg(r,"coords")+`;
        float val = 0.0;
        for (int i = `+a+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+s+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+jg(r,"coords")+` = idx;
          val += getX(`+function(o,l){if(o===1)return""+l;if(o===2)return l+".x, "+l+".y";if(o===3)return l+".x, "+l+".y, "+l+".z";if(o===4)return l+".x, "+l+".y, "+l+".z, "+l+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function jg(e,t){if(e===1)return""+t;if(e===2)return t+".y";if(e===3)return t+".z";if(e===4)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var kC=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=hi.DENSE;var t=Mo(e),n=Ht();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Oa(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+n.output+` = result;
      }
    `},CC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=hi.DENSE;var t=Mo(e),n=Ht();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Oa(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+n.output+` = result;
      }
    `},SC=function(){function e(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),EC=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},RC=function(e){this.variableNames=["A"],this.outTexUsage=xn.DOWNLOAD;var t=Ht();this.outputShape=e,this.userCode=`
      `+Ny+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},DC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=xn.DOWNLOAD;var t=Ht();this.outputShape=e,this.userCode=`
      `+Ny+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},IC=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=Ht(),a=t[0],s=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+zf(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+s+`;
        int c = imod(flatIndex, `+s+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+s+".0, "+a+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `},AC=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ht(),a=t[0],s=t[1];this.outputShape=e;var o="",l="result";n&&(l="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var u=0;u<=1;u++){var d=2*c+u;o+=`
          localCoords = coords;
          if(localCoords[2] + `+u+" < "+e[2]+`) {
            localCoords[2] += `+u+`;
            if(localCoords[1] + `+c+" < "+e[1]+`) {
              localCoords[1] += `+c+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+s+`;
              c = imod(flatIndex, `+s+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+s+".0, "+a+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+d+`] = values[0];
              } else if(offset == 1) {
                result[`+d+`] = values[1];
              } else if(offset == 2) {
                result[`+d+`] = values[2];
              } else {
                result[`+d+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+zf(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+r.output+" = "+l+`;
      }
    `},TC="return real * expR - imag * expI;",PC="return real * expI + imag * expR;",kg=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var a=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,s=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+a+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+s+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},FC=function(){function e(t,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,a){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(a,"value")),r.gl.uniform1f(n.valueLoc,t)}},e}(),MC=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var a=Xe(this.rank),s=function(o,l){var c=o.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(c===1)return"int(getIndices(resRC))";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w"],d=[],h=0;h<o.length;h++)h===l?d.push("int(getIndices("+u[h]+"))"):d.push(""+u[h]);return d.join()}(e,n);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+s+`));
      }
    `},OC=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Xe(t.length),a=Xe(n.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+a+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+s+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function LC(e,t){var n=Ht();return Tj(e,t,n.version+`
    precision highp float;
    `+n.attribute+` vec3 clipSpacePos;
    `+n.attribute+` vec2 uv;
    `+n.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function BC(e,t){return Lj(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function $C(e,t){return Bj(e,t,new Uint16Array([0,1,2,2,1,3]))}function ki(e,t,n,r,a,s,o){Wj(n,r);var l=$j(e,t),c=e.TEXTURE_2D;return ye(e,t,function(){return e.bindTexture(c,l)}),ye(e,t,function(){return e.texParameteri(c,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),ye(e,t,function(){return e.texParameteri(c,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),ye(e,t,function(){return e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.NEAREST)}),ye(e,t,function(){return e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST)}),ye(e,t,function(){return e.texImage2D(c,0,a,n,r,0,s,o,null)}),ye(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),l}function WC(e,t,n,r,a){var s=Bc(n,r);return ki(e,t,s[0],s[1],a.internalFormatFloat,a.textureFormatFloat,e.FLOAT)}function zC(e,t,n,r,a){var s=Bc(n,r);return ki(e,t,s[0],s[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function UC(e,t,n,r,a){var s=Bc(n,r);return ki(e,t,s[0],s[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function VC(e,t,n,r,a){var s=ji(n,r);return ki(e,t,s[0],s[1],a.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function qC(e,t,n,r,a){var s=ji(n,r);return ki(e,t,s[0],s[1],a.internalFormatPackedHalfFloat,e.RGBA,a.textureTypeHalfFloat)}function HC(e,t,n,r){return ye(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),hg(e,t,n,"clipSpacePos",r,3,20,0)&&hg(e,t,n,"uv",r,2,20,12)}function GC(e,t,n,r,a,s,o){var l,c,u;ye(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),s instanceof Uint8Array?(l=new Uint8Array(r*a*4),c=e.UNSIGNED_BYTE,u=e.RGBA):(l=new Float32Array(r*a*4),c=e.FLOAT,u=o.internalFormatPackedFloat),l.set(s),ye(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,u,r,a,0,e.RGBA,c,l)}),ye(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function KC(e,t,n,r){ye(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?ye(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):ye(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),ye(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function XC(e,t,n,r,a){var s=e.createBuffer();ye(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,s)});var o=16*n*r;return ye(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)}),ye(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),ye(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),s}function YC(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function QC(e,t,n,r,a){var s=Bc(n,r),o=s[0],l=s[1],c=new Uint8Array(n*r*4);return ye(e,t,function(){return e.readPixels(0,0,o,l,a.downloadTextureFormat,e.UNSIGNED_BYTE,c)}),new Float32Array(c.buffer)}function JC(e,t,n,r,a,s,o,l){var c=e,u=new Float32Array(function(d,h){var f=ji(d,h);return f[0]*f[1]*4}(s,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}function ZC(e,t,n,r){var a=new Float32Array(n*r*4);return ye(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,a)}),a}var eS=function(){function e(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=J().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,Ej(n,t)):this.gl=mr(n);var r="WEBGL_color_buffer_float";if(J().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Xi(this.gl,this.debug,"OES_texture_float"),An(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Xi(this.gl,this.debug,"OES_texture_half_float");else if(J().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),An(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Xi(this.gl,this.debug,"EXT_color_buffer_half_float");else if(J().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",An(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!An(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=BC(this.gl,this.debug),this.indexBuffer=$C(this.gl,this.debug),this.framebuffer=zj(this.gl,this.debug),this.textureConfig=Af(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return J().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;ye(n,this.debug,function(){return n.finish()}),ye(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),ye(n,this.debug,function(){return n.deleteFramebuffer(t.framebuffer)}),ye(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),ye(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),ye(n,this.debug,function(){return n.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(t,n){return this.throwIfDisposed(),WC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(t,n){return this.throwIfDisposed(),zC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(t,n){return this.throwIfDisposed(),UC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(t,n){this.throwIfDisposed(),KC(this.gl,this.debug,t,n)},e.prototype.uploadDenseMatrixToTexture=function(t,n,r,a){this.throwIfDisposed(),GC(this.gl,this.debug,t,n,r,a,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(t,n){return this.throwIfDisposed(),qC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(t,n){return this.throwIfDisposed(),VC(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(t){var n=this;this.throwIfDisposed(),this.outputTexture===t&&(fg(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ye(this.gl,this.debug,function(){return n.gl.deleteTexture(t)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,n,r){var a=this;return this.downloadMatrixDriver(t,function(){return QC(a.gl,a.debug,n,r,a.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(t,n,r,a,s,o){return JC(this.gl,t,0,0,0,s,o,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(t,n){return YC(this.gl,t,n)},e.prototype.createBufferFromTexture=function(t,n,r){this.bindTextureToFrameBuffer(t);var a=XC(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},e.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},e.prototype.createFence=function(t){var n,r,a=this;if(J().getBool("WEBGL_FENCE_API_ENABLED")){var s=t,o=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var l=s.clientWaitSync(o,0,0);return l===s.ALREADY_SIGNALED||l===s.CONDITION_SATISFIED},n=o}else J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return a.isQueryAvailable(n,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(t,n,r){var a=this;return this.downloadMatrixDriver(t,function(){return ZC(a.gl,a.debug,n,r)})},e.prototype.createProgram=function(t){this.throwIfDisposed();var n=this.gl,r=Pj(n,this.debug,t),a=LC(n,this.debug),s=Mj(n,this.debug);return ye(n,this.debug,function(){return n.attachShader(s,a)}),ye(n,this.debug,function(){return n.attachShader(s,r)}),Oj(n,this.debug,s),this.debug&&Mu(n,this.debug,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=HC(n,this.debug,this.program,this.vertexBuffer)),s},e.prototype.deleteProgram=function(t){var n=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&ye(this.gl,this.debug,function(){return n.gl.deleteProgram(t)})},e.prototype.setProgram=function(t){var n=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Mu(this.gl,this.debug,this.program),ye(this.gl,this.debug,function(){return n.gl.useProgram(t)})},e.prototype.getUniformLocation=function(t,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?Vj(this.gl,this.debug,t,n):qj(this.gl,t,n)},e.prototype.getAttributeLocation=function(t,n){var r=this;return this.throwIfDisposed(),ye(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,n)})},e.prototype.getUniformLocationNoThrow=function(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)},e.prototype.setInputMatrixTexture=function(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),Hj(this.gl,this.debug,this.program,t,n,r)},e.prototype.setOutputMatrixTexture=function(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)},e.prototype.setOutputPackedMatrixTexture=function(t,n,r){this.throwIfDisposed();var a=ji(n,r),s=a[0],o=a[1];this.setOutputMatrixTextureDriver(t,s,o)},e.prototype.setOutputMatrixWriteRegion=function(t,n,r,a){this.setOutputMatrixWriteRegionDriver(r,t,a,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(t,n,r,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&Mu(this.gl,this.debug,this.program),Yi(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),ye(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),ye(this.gl,this.debug,function(){return t.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Xi(this.gl,this.debug,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(n.TIME_ELAPSED_EXT,r),r}var a=this.getQueryTimerExtensionWebGL1(),s=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,s),s},e.prototype.endQuery=function(){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(t){return ge(this,void 0,void 0,function(){var n=this;return ve(this,function(r){switch(r.label){case 0:return[4,og(function(){return n.disposed||n.isQueryAvailable(t,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(t,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(t,n){if(n===0)return!0;if(n===2){var r=this.gl,a=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),s&&!this.disjoint}return s=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,a.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),s&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var t=function(r){for(var a=0;a<r.length&&r[a]();++a);return a-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=t;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},e.prototype.addItemToPoll=function(t,n){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||og(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Ou(this.gl,this.debug,t,this.framebuffer),this.debug&&Yi(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Ou(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Yi(this.gl)):fg(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(t,n){this.bindTextureToFrameBuffer(t);var r=n();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(t,n,r){this.throwIfDisposed();var a=this.gl;Ou(a,this.debug,t,this.framebuffer),this.debug&&Yi(a),this.outputTexture=t,ye(a,this.debug,function(){return a.viewport(0,0,n,r)}),ye(a,this.debug,function(){return a.scissor(0,0,n,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(t,n,r,a){var s=this;this.throwIfDisposed(),ye(this.gl,this.debug,function(){return s.gl.scissor(t,n,r,a)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function Cg(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(n,r){var a=n.logicalShape,s=t[r],o=s.shape;if(!It(a,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+a+" and "+o+" must match");if(!n.isUniform||!s.isUniform){var l=n.texShape,c=s.isUniform?null:s.texData.texShape;if(!It(l,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+l+" and "+c+" must match")}})}var tS=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,a=n.inChannels,s=n.strideWidth,o=n.strideHeight,l=n.padInfo,c=n.outWidth,u=n.dilationWidth,d=n.dilationHeight,h=n.dataFormat,f=l.left,p=l.top,m=a*r,x=Ht(),y=h==="channelsLast",g=y?0:1,v=y?1:2,w="",b=0;b<=1;b++)for(var N=0;N<=1;N++)w+=`
          blockIndex = rc.y + `+N+`;
          pos = rc.x + `+b+`;

          if(blockIndex < `+e[1]+" && pos < "+e[0]+`) {
            offsetY = int(blockIndex / (`+c+")) * "+o+" - "+p+`;
            d0 = offsetY + `+d+" * (pos / "+m+`);

            if(d0 < `+t[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+c+".) * "+s+". - "+f+`.);
              d1 = offsetX + `+u+" * (int(mod(float(pos), "+m+".) / "+a+`.));

              if(d1 < `+t[v]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+a+`.));

                if (`+y+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*b+N)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*b+N)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+w+`

        `+x.output+` = result;
      }
    `},nS=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];var s,o=t,l=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";s=a===.5?"inversesqrt("+c+")":a===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+l+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+s+`;
        setOutput(val);
      }
    `},rS=function(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+a+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+a+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},aS=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var s,o=t,l=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";s=a===.5?"inversesqrt("+c+")":a===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+l+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+s+`;
        setOutput(result);
      }
    `},sS=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,s=e.effectiveFilterWidth,o=a-1-e.padInfo.top,l=s-1-e.padInfo.left,c=a*s-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+s+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+c+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+s+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},oS=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=c-1-e.padInfo.top,f=u-1-e.padInfo.left,p=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+h+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
           wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+c+`;
              wR += `+s+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+u+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+p+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+c+" * "+u+` +
                  wR * `+u+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},zu=function(e,t,n,r,a,s,o){n===void 0&&(n=!1),r===void 0&&(r=!1),a===void 0&&(a=!1),s===void 0&&(s=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var l=n?e[1]:e[2],c=Math.ceil(l/2),u=n?"i * 2, rc.y":"rc.y, i * 2",d=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",m="";s&&(p=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+s+`
        }`:`vec4 activation(vec4 x) {
          `+s+`
        }`,m="result = activation(result);");var x=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+p+`

      const float sharedDimension = `+c+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+c+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+d+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+f[0]+`);
          result += (`+h[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+x+`

        `+m+`

        setOutput(result);
      }
    `},iS=function(){function e(t,n,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,a){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(a,"seed")),r.gl.uniform1f(n.seedLoc,t)}},e}(),lS=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `},cS=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=an("rc",t),r=Xe(t),a=function(l,c,u){if(l===1)return"rc > "+c[0];for(var d="",h=l-2;h<l;h++)d+=u[h]+" >= "+c[h],h<l-1&&(d+="||");return d}(t,e,n),s=function(l,c,u,d){if(l===1)return"";var h=d.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+c+`;
    bool rEdge = rp1 >= `+u+`;
  `}(t,e[e.length-1],e[e.length-2],n),o=function(l,c){var u=l.length,d=function(h,f){for(var p=[],m=0;m<=1;m++)for(var x=0;x<=1;x++){for(var y=(m===0?"r":"rp1")+", "+(x===0?"c":"cp1"),g=2;g<h;g++)y=f[f.length-1-g]+","+y;p.push(y)}return p}(u,c);return u===1?`getA(rc),
            rc + 1 >= `+l[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+d[0]+`),
          cEdge ? 0. : getA(`+d[1]+`),
          rEdge ? 0. : getA(`+d[2]+`),
          rEdge || cEdge ? 0. : getA(`+d[3]+")"}(e,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+s+`

            setOutput(vec4(`+o+`));
          }
        }
      `}},uS=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(c,u){return c[0]+e[u]+c[1]});var r=e.length,a=Xe(r),s=t.map(function(c){return c[0]}).join(","),o=t.map(function(c,u){return c[0]+e[u]}).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+a+" start = "+a+"("+s+`);
      `+a+" end = "+a+"("+o+`);

      void main() {
        `+a+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+a+` coords = outC - start;
          setOutput(getX(`+l+`));
        }
      }
    `:`
        int start = `+s+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},dS=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(y,g){return y[0]+e[g]+y[1]});for(var r=e.length,a=Xe(r),s=t.map(function(y){return y[0]}).join(","),o=t.map(function(y,g){return y[0]+e[g]}).join(","),l=an("rc",r),c=an("source",r),u=l[r-1]+" < "+this.outputShape[r-1],d=r===1?"source":"vec2("+c.slice(-2).join()+")",h=[a+" rc = outputLoc;",l[r-1]+` += 1;
       if(`+u+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+l[r-2]+` += 1;
       if(`+l[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+l[r-1]+` += 1;
         if(`+u+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",m=0,x=r===1?2:4;m<x;m++)p+=`
        `+h[m]+`
        if (`+f+`) {
          result[`+m+"] = float("+n+`);
        } else {
          `+a+` source = rc - start;
          result[`+m+"] = getChannel(getX("+c.join()+"), "+d+`);
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const `+a+" start = "+a+"("+s+`);
      const `+a+" end = "+a+"("+o+`);

      void main() {
        `+a+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+p+`
        setOutput(result);
      }
    `},Uu=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideHeight,s=e.strideWidth,o=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var f=t==="avg",p="0.0";if(f||(p="-1.0 / 1e-20"),n)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+s+`);
        const ivec2 pads = ivec2(`+d+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+u+`;
                wC += `+l+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+u+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var m=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(m="avgValue / count");var x=4*Math.floor(r/4),y=r%4,g=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+d+", "+h+`);
      const float initializationValue = `+p+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+p+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+x+`; wC += 4) {
            int xC = xCCorner + wC * `+l+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              getValue(batch, xR, xC + 3 * `+l+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+x+`;
          if (`+(y===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(y===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(y===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+m+`);
      }
    `}},Vu=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,m=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;var y=t==="avg",g="0.0";if(y||(g="-1.0 / 1e-20"),n)this.userCode=`
        const ivec3 strides =
            ivec3(`+a+", "+s+", "+o+`);
        const ivec3 pads = ivec3(`+p+", "+m+", "+x+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+d+`;
              wD += `+l+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+h+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+u+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+h+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var v=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(v="avgValue / count");var w=4*Math.floor(r/4),b=r%4,N=`
      if (`+y+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+a+", "+s+", "+o+`);
      const ivec3 pads = ivec3(`+p+", "+m+", "+x+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+d+`;
            wD += `+l+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+w+`; wC += 4) {
              int xC = xCCorner + wC * `+u+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+u+`, ch)
              );

              `+N+`
            }

            int xC = xCCorner + `+w+`;
            if (`+(b===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+N+`
            } else if (`+(b===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                initializationValue,
                initializationValue
              );

              `+N+`
            } else if (`+(b===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                initializationValue
              );

              `+N+`
            }
          }
          setOutput(`+v+`);
        }
      }
    `}},hS=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,s=Math.ceil(a/n);this.outputShape=[r,s];var o="0.0",l="";t==="prod"?o="1.0":t==="min"?(o="1.0 / 1e-20",l="min"):t==="max"&&(o="-1.0 / 1e-20",l="max");var c=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var u=4*Math.floor(n/4),d=n%4,h=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+l+`(values, minMaxValue);
      }
    `,f="vec4";t==="all"?(o="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(o="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var p="";a%n>0&&(p=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(d===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(d===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(d===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+c+`);
      }
    `},fS=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var a="thisRC = rc;";r%2==1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+=`
        `+a+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Oa(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+zf(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+n+`

        setOutput(result);
      }
    `},pS=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],s=r[2],o=e.shape,l=o[1],c=o[2],u=[n&&l>1?a-1:a,n&&c>1?s-1:s],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],h=u[0]/d[0],f=u[1]/d[1],p=1/h,m=1/f,x=2*Math.ceil(p)+2,y=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+l+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(a-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(s-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},mS=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],s=e[1],o=e[2],l=e[3];this.outputShape=[a,t,n,l];var c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+s+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},gS=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=e[0],s=e[1],o=e[2],l=e[3];this.outputShape=[a,t,n,l];var c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`,
          `+c[1]/u[1]+`);
      const vec3 inputShapeRC = vec3(`+s+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(l-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},vS=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],s=r[2],o=e.shape,l=o[1],c=o[2],u=[n&&l>1?a-1:a,n&&c>1?s-1:s],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],h=u[0]/d[0],f=u[1]/d[1],p=1/h,m=1/f,x=2*Math.ceil(p)+2,y=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+x+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+l+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float sourceFracRow =
              float(`+u[0]+`) *
                (float(dyR) / float(`+d[0]+`));

            float sourceFracCol =
                float(`+u[1]+`) *
                  (float(dyC) / float(`+d[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+a+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+s+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},xS=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],s=e[1],o=e[2],l=e[3];this.outputShape=[a,t,n,l];var c=[r&&t>1?s-1:s,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+s+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+d+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},yS=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n!==1){var r=e.map(function(s,o){return function(l){return t.indexOf(l)!==-1&&e[l]!==1?e[l]+" - coords["+l+"] - 1":"coords["+l+"]"}(o)}).join(","),a=Xe(n);this.userCode=`
      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `},bS=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=an("rc",n),a=r[n-1]+" + 1 < "+this.outputShape[n-1],s=r[n-2]+" + 1 < "+this.outputShape[n-2],o=Xe(n);function l(c){var u=e.map(function(d,h){return function(f,p){return t.indexOf(f)!==-1&&e[f]!==1?e[f]+" - "+p[f]+" - 1":""+p[f]}(h,c)});return"getChannel(getX("+u.join(",")+"), vec2("+u.slice(-2).join(",")+"))"}this.userCode=n===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+a+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(c){return l(c)}(r.slice())+`;
          if(`+a+`){
            result.g = `+function(c){return c[n-1]="("+c[n-1]+" + 1)",l(c)}(r.slice())+`;
          }
          if(`+s+`) {
            result.b = `+function(c){return c[n-2]="("+c[n-2]+" + 1)",l(c)}(r.slice())+`;
            if(`+a+`) {
              result.a = `+function(c){return c[n-1]="("+c[n-1]+" + 1)",c[n-2]="("+c[n-2]+" + 1)",l(c)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},Sg=function(e,t,n,r,a,s,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;var l=Xe(a.length),c=Xe(s.length),u="";n===1?u="i":n===2&&(u="i, j");var d="getIndices("+u+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var f="getUpdates("+h+")",p=t>1?"strides[j]":"strides";this.userCode=`
        `+l+" strides = "+l+"("+a+`);

        void main() {
          `+c+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+d+`);
              flattenedIndex += index * `+p+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},wS=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,a=e.inSize,s=e.numSegments,o=s*Math.ceil(a/n);this.outputShape=[r,o];var l=4*Math.floor(n/4),c=n%4,u=`
        sumValue += dot(values, segFilter);
    `,d="";a%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `);var h="";a%n>0&&(h=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+s+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+s+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+u+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+u+`
        } else if (`+(c===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+u+`
        } else if (`+(c===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+u+`
        }
        setOutput(sumValue);
      }
    `},NS=function(e,t,n){var r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)a="resRC",r="resRC";else{for(var s=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],l=[],c=0;c<t.length;c++)l.push(""+s[c]),c<e&&o.push(""+s[c]);r=o.join(),a=l.join()}var u=Xe(n);this.userCode=`
      void main() {
        `+u+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+a+`));
        } else {
          setOutput(getB(`+a+`));
        }
      }
    `},_S=function(){function e(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=Xe(this.rank),a="uniform int start["+this.rank+"];",s=function(o){if(o===1)return"sourceLoc";if(o<=6)return qu.slice(0,o).map(function(l){return"sourceLoc."+l}).join(",");throw Error("Slicing for rank "+o+" is not yet supported")}(this.rank);n=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(o,l){return"sourceLoc."+qu[l]+" = start["+l+"] + coords."+qu[l]+";"}).join(`
`)+`
      `,this.userCode=`
      `+a+`
      void main() {
        `+n+`
        setOutput(getSource(`+s+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,a){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(a,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),qu=["x","y","z","w","u","v"],jS=function(){function e(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=Xe(this.rank),r=an("coords",this.rank),a=an("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",o="getChannel(getSource("+a.join()+"), "+s+")",l=`
      result.x = `+o+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+o+`;
        --`+a[this.rank-1]+`;
      }
    `,c=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            `+n+"("+t.map(function(d,h){return"start["+h+"]"}).join()+");":t.map(function(d,h){return a[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+n+` coords = getOutputCoords();
        `+n+` sourceLoc;
        `+u+`
        vec4 result = vec4(0.);
        `+l+`
        `+c+`
        setOutput(result);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,a){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(a,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),kS=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,a=Xe(n.length),s=Xe(n.length),o="";if(r===1)o="coords * strides + begin";else{var l=0;o=n.map(function(c,u){return l++,n.length===1?"coords * strides["+u+"] + begin["+u+"]":"coords["+(l-1)+"] * strides["+u+"] + begin["+u+"]"}).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+e+`);
      `+a+" strides = "+a+"("+t+`);

      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `},CS=function(){function e(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(t,n,r){var a,s=Eg(n,r),o=Rg(t,s,r);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var l=this.freeTextures[o].shift();return this.usedTextures[o].push(l),l}return this.numUsedTextures++,this.log(),s===gn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):s===gn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):s===gn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):s===gn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):s===gn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[o].push(a),a},e.prototype.releaseTexture=function(t,n,r,a){if(this.freeTextures!=null){var s=Rg(n,Eg(r,a),a);s in this.freeTextures||(this.freeTextures[s]=[]),this.freeTextures[s].push(t),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[s],l=o.indexOf(t);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(l,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(a){t.gpgpu.deleteMatrixTexture(a)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Eg(e,t){if(e===xn.UPLOAD)return gn.PACKED_2X2_FLOAT32;if(e===xn.RENDER||e==null)return function(n){return J().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?gn.PACKED_2X2_FLOAT32:gn.UNPACKED_FLOAT32:n?gn.PACKED_2X2_FLOAT16:gn.UNPACKED_FLOAT16}(t);if(e===xn.DOWNLOAD||e===xn.PIXELS)return gn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Rg(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var SS=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var a=Xe(this.rank),s=function(o){var l=o.length;if(l>5)throw Error("Tile for rank "+l+" is not yet supported");if(l===1)return"imod(resRC, "+o[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],u=[],d=0;d<o.length;d++)u.push("imod("+c[d]+", "+o[d]+")");return u.join()}(e);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+s+`));
      }
    `},ES=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var a=Xe(this.rank),s=function(o){var l=o.length;if(l>6)throw Error("Transpose for rank "+l+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],u=new Array(l),d=0;d<o.length;d++)u[o[d]]=c[d];return u.join()}(t);this.userCode=`
    void main() {
      `+a+` resRC = getOutputCoords();
      setOutput(getA(`+s+`));
    }
    `},RS=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=Xe(this.rank),s=wy("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=s[r];var l="vec2("+o.slice(-2).join()+")",c="++"+s[this.rank-1]+" < "+n[this.rank-1],u="getChannel(getA("+o.join()+"), "+l+")";this.userCode=`
    void main() {
      `+a+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+u+`;
      if(`+c+`) {
        result[1] = `+u+`;
      }
      --`+s[this.rank-1]+`;
      if(++`+s[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+u+`;
        if(`+c+`) {
          result[3] = `+u+`;
        }
      }
      setOutput(result);
    }
    `},Uf=1.7580993408473768,Vf=1.0507009873554805,Ae=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Jn="if (isnan(x)) return x;",DS="return x;",Dg="return abs(x);",Cy=Jn+`
  return (x < 0.0) ? 0.0 : x;
`,Sy=Jn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ey="return (x >= 0.0) ? x : (exp(x) - 1.0);",IS=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Uf+`;
  float scale = `+Vf+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Ig="return -x;",Ag="return ceil(x);",Tg="return floor(x);",Pg="return exp(x);",Fg="return exp(x) - 1.0;",AS=Jn+`
  return sin(x);
`,TS=Jn+`
  return cos(x);
`,PS=Jn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,FS=Jn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,MS=Jn+`
  return atan(x);
`,OS=Jn+"return log(x + sqrt(x * x + 1.0));",LS=Jn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,BS=Jn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,el="return x;",$S="return x;",Ry=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Dy=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Iy=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,No=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},WS=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=an("rc",t),r=Xe(t),a=function(l,c){if(l===1)return"rc";for(var u="",d=0;d<l;d++)u+=c[d],d<l-1&&(u+=",");return u}(t,n),s=n.slice(-2),o=t<=1?"rc":"vec2("+s.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+a+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `},tl={};function nl(e,t){if(t===void 0&&(t=!1),e==="linear")return t?$S:DS;if(e==="relu")return t?Ry:Cy;if(e==="elu")return t?Iy:Ey;if(e==="relu6")return t?Dy:Sy;if(e==="prelu")return t?ky:jy;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var zS=600,US=function(e){function t(n){var r,a=e.call(this)||this;if(a.pendingRead=new WeakMap,a.pendingDisposal=new WeakSet,a.dataRefCount=new WeakMap,a.numBytesInGPU=0,a.uploadWaitMs=0,a.downloadWaitMs=0,a.warnedAboutMemory=!1,a.pendingDeletes=0,a.disposed=!1,!J().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var s=mr(J().getNumber("WEBGL_VERSION"));a.binaryCache=((r=J().getNumber("WEBGL_VERSION"))in tl||(tl[r]={}),tl[r]),a.gpgpu=new eS(s),a.canvas=s.canvas,a.gpgpuCreatedLocally=!0}else a.gpgpu=n,a.binaryCache={},a.gpgpuCreatedLocally=!1,a.canvas=n.gl.canvas;return a.textureManager=new CS(a.gpgpu),a.numMBBeforeWarning=J().global.screen==null?1024:J().global.screen.height*J().global.screen.width*window.devicePixelRatio*zS/1024/1024,a.texData=new hy(a,z),a}return Qn(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(n,r,a){if(J().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var s={};return this.texData.set(s,{shape:r,dtype:a,values:n,usage:xn.UPLOAD}),s},t.prototype.move=function(n,r,a,s){if(J().getBool("DEBUG")&&this.checkNumericalProblems(r),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:a,dtype:s,values:r,usage:xn.UPLOAD})},t.prototype.readSync=function(n){var r=this.texData.get(n),a=r.values,s=r.dtype,o=r.complexTensors,l=r.slice,c=r.shape,u=r.isPacked;if(l!=null){var d=void 0;d=u?new No(c,el):new Ae(c,el);var h=this.runWebGLProgram(d,[{dataId:n,shape:c,dtype:s}],s),f=this.readSync(h.dataId);return this.disposeData(h.dataId),f}if(a!=null)return this.convertAndCacheOnCPU(n);if(s==="string")return a;var p,m,x=this.activeTimers!=null;return x&&(p=ar()),s==="complex64"?m=xh(o.real.dataSync(),o.imag.dataSync()):m=this.getValuesFromTexture(n),x&&(this.downloadWaitMs+=ar()-p),this.convertAndCacheOnCPU(n,m)},t.prototype.read=function(n){return ge(this,void 0,void 0,function(){var r,a,s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,C,k;return ve(this,function(j){switch(j.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(S){return r.push(S)})];if(a=this.texData.get(n),s=a.values,o=a.shape,l=a.slice,c=a.dtype,u=a.complexTensors,d=a.isPacked,l!=null)return h=void 0,h=d?new No(o,el):new Ae(o,el),f=this.runWebGLProgram(h,[{dataId:n,shape:o,dtype:c}],c),p=this.read(f.dataId),this.disposeData(f.dataId),[2,p];if(s!=null)return[2,this.convertAndCacheOnCPU(n)];if(!J().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&J().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,c!=="complex64"&&J().get("WEBGL_BUFFER_SUPPORTED")&&(x=this.decode(n),y=this.texData.get(x.dataId),m=(k=this.gpgpu).createBufferFromTexture.apply(k,[y.texture].concat(Mo(o)))),this.pendingRead.set(n,[]),c==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:j.sent(),j.label=2;case 2:return c!=="complex64"?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return v=j.sent(),w=v[0],b=v[1],g=xh(w,b),[3,5];case 4:m==null?g=this.getValuesFromTexture(n):(N=xe(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(m,N)),j.label=5;case 5:return x!=null&&this.disposeData(x.dataId),_=this.convertAndCacheOnCPU(n,g),C=this.pendingRead.get(n),this.pendingRead.delete(n),C.forEach(function(S){return S(_)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,_]}})})},t.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var a=n[r];if(!Ij(a))throw J().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(n){var r,a=this.texData.get(n),s=a.shape,o=a.dtype,l=a.isPacked,c=xe(s);if(J().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(n),d=this.texData.get(u.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[d.texture].concat(Mo(s))).subarray(0,c);return this.disposeData(u.dataId),h}var f=J().getBool("WEBGL_PACK")&&l===!0,p=f?Lu(s):s,m=f?new DC(p):new RC(p),x=this.runWebGLProgram(m,[{shape:p,dtype:o,dataId:n}],"float32"),y=this.texData.get(x.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,c);return this.disposeData(x.dataId),g},t.prototype.time=function(n){return ge(this,void 0,void 0,function(){var r,a,s,o,l,c,u;return ve(this,function(d){switch(d.label){case 0:return r=this.activeTimers,a=[],s=!1,this.programTimersStack==null?(this.programTimersStack=a,s=!0):this.activeTimers.push(a),this.activeTimers=a,n(),o=Xs(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),l=Xs(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,s&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return u=d.sent(),c.kernelMs=dj(u),c.getExtraProfileInfo=function(){return u.map(function(h,f){return{name:l[f],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},d.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ar(),endMs:null}},t.prototype.endTimer=function(n){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=ar(),n)},t.prototype.getQueryTime=function(n){return ge(this,void 0,void 0,function(){var r;return ve(this,function(a){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},t.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},t.prototype.releaseGPUData=function(n){var r=this.texData.get(n),a=r.texture,s=r.dtype,o=r.texShape,l=r.usage,c=r.isPacked,u=r.slice,d=u&&u.origDataId||n,h=this.dataRefCount.get(d);h>1?this.dataRefCount.set(d,h-1):(this.dataRefCount.delete(d),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,s),this.textureManager.releaseTexture(a,o,l,c)));var f=this.texData.get(n);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},t.prototype.getDataInfo=function(n){return this.texData.get(n)},t.prototype.getCPUBackend=function(){return J().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=z.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(n,r){var a=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(s){return a.texData.get(s.dataId).texture==null&&s.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(n,r){var a=this.makeOutput(n.shape,"complex64");return this.texData.get(a.dataId).complexTensors={real:z.keep(n.clone()),imag:z.keep(r.clone())},a},t.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,a){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,a);if(xe(a)===0)return Ot([],a,n.dtype);var s=this.texData.get(n.dataId).isPacked,o=uy(n.shape,r,a);if(s||!o){var l=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jS(a):new _S(a),c=l.getCustomSetupFunc(r);return this.compileAndRun(l,[n],null,c)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,a)},t.prototype.shallowSlice=function(n,r,a){var s=this.texData.get(n.dataId),o=this.makeOutput(a,n.dtype),l=this.texData.get(o.dataId);Object.assign(l,s),l.shape=a,l.dtype=n.dtype;var c=dy(r,n.strides);s.slice&&(c+=s.slice.flatOffset),l.slice={flatOffset:c,origDataId:s.slice&&s.slice.origDataId||n.dataId};var u=this.dataRefCount.get(l.slice.origDataId)||1;return this.dataRefCount.set(l.slice.origDataId,u+1),o},t.prototype.stridedSlice=function(n,r,a,s){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,a,s);var o=Of(r,a,s);if(o.some(function(c){return c===0}))return Ot([],o);var l=new kS(r,s,o);return this.compileAndRun(l,[n])},t.prototype.reverse=function(n,r){var a=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bS(n.shape,r):new yS(n.shape,r);return this.compileAndRun(a,[n])},t.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var a=n.map(function(p){return Dn(p)}),s=n.map(function(p){return ir(p)});return Ft(this.concat(a,r),this.concat(s,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>J().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(n.length/2),l=this.concat(n.slice(0,o),r),c=this.concat(n.slice(o),r);return this.concat([l,c],r)}if(J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var u=new mC(n.map(function(p){return p.shape}),r);return this.compileAndRun(u,n)}var d=Qs(n.map(function(p){return p.shape}),r),h=n.map(function(p){return p.as2D(-1,xe(p.shape.slice(r)))}),f=new pC(h.map(function(p){return p.shape}));return this.compileAndRun(f,h).reshape(d)},t.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Ig,n.dtype);var r=new Ae(n.shape,Ig);return this.compileAndRun(r,[n])},t.prototype.batchMatMul=function(n,r,a,s){var o=a?n.shape[2]:n.shape[1],l=s?r.shape[1]:r.shape[2],c=a?n.shape[1]:n.shape[2],u=n.shape[0];if((o===1||l===1)&&c>1e3){a&&(n=n.transpose([0,2,1])),s&&(r=r.transpose([0,2,1]));var d=l===1?n:n.as3D(u,c,1),h=l===1?2:1,f=l===1?r.as3D(u,1,c):r;return this.multiply(d,f).sum(h,!0)}var p=Mt(n.dtype,r.dtype),m=new zu(n.shape,[u,o,l],a,s);return this.compileAndRun(m,[n,r],p)},t.prototype.fusedBatchMatMul=function(n){var r=n.a,a=n.b,s=n.transposeA,o=n.transposeB,l=n.bias,c=n.activation,u=n.preluActivationWeights,d=s?r.shape[2]:r.shape[1],h=o?a.shape[1]:a.shape[2],f=r.shape[0],p=Mt(r.dtype,a.dtype),m=l!=null,x=u!=null,y=c?nl(c,!0):null,g=new zu(r.shape,[f,d,h],s,o,m,y,x),v=[r,a];return l&&v.push(l),u&&v.push(u),this.compileAndRun(g,v,p)},t.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var a=this.texData.get(n.dataId),s=this.texData.get(r.dataId),o=new yg(cC,n.shape,r.shape),l=new yg(uC,n.shape,r.shape),c=[this.makeComplexComponentTensorInfo(n,a.complexTensors.real),this.makeComplexComponentTensorInfo(n,a.complexTensors.imag),this.makeComplexComponentTensorInfo(r,s.complexTensors.real),this.makeComplexComponentTensorInfo(r,s.complexTensors.imag)],u=this.compileAndRun(o,c),d=this.compileAndRun(l,c),h=this.complex(u,d);return u.dispose(),d.dispose(),h}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,bg,n.dtype);var f=new lt(bg,n.shape,r.shape);return this.compileAndRun(f,[n,r],n.dtype)},t.prototype.batchNormalization=function(n,r,a,s,o,l){var c=[n,r,a],u=null;l!=null&&(u=l.shape,c.push(l));var d=null;if(o!=null&&(d=o.shape,c.push(o)),J().getBool("WEBGL_PACK_NORMALIZATION")){var h=new lC(n.shape,r.shape,a.shape,u,d,s);return this.compileAndRun(h,c)}var f=new iC(n.shape,r.shape,a.shape,u,d,s);return this.compileAndRun(f,c)},t.prototype.localResponseNormalization4D=function(n,r,a,s,o){var l=J().getBool("WEBGL_PACK_NORMALIZATION")?new aS(n.shape,r,a,s,o):new nS(n.shape,r,a,s,o);return this.compileAndRun(l,[n])},t.prototype.LRNGrad=function(n,r,a,s,o,l,c){var u=new rS(r.shape,s,o,l,c);return this.compileAndRun(u,[r,a,n])},t.prototype.tile=function(n,r){if(n.dtype==="string"){var a=this.readSync(n.dataId).map(function(o){return ec(o)});return yy(De(n.shape,n.dtype,a),r)}var s=new SS(n.shape,r);return this.compileAndRun(s,[n])},t.prototype.pad=function(n,r,a){var s=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dS(n.shape,r,a):new uS(n.shape,r,a);return this.compileAndRun(s,[n])},t.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var a=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RS(n.shape,r):new ES(n.shape,r);return this.compileAndRun(a,[n])},t.prototype.gather=function(n,r,a){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,a);var s=new MC(n.shape,r.size,a);return this.compileAndRun(s,[n,r])},t.prototype.batchToSpaceND=function(n,r,a){T(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=r.reduce(function(h,f){return h*f}),o=oc(n.shape,r,s),l=ic(o.length,r.length),c=lc(n.shape,r,s),u=oy(a,r.length),d=iy(c,a,r.length);return n.reshape(o).transpose(l).reshape(c).slice(u,d)},t.prototype.spaceToBatchND=function(n,r,a){T(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=r.reduce(function(f,p){return f*p}),o=[[0,0]];o.push.apply(o,a);for(var l=1+r.length;l<n.shape.length;++l)o.push([0,0]);var c=n.pad(o),u=oc(c.shape,r,s,!1),d=ic(u.length,r.length,!1),h=lc(c.shape,r,s,!1);return c.reshape(u).transpose(d).reshape(h)},t.prototype.reduce=function(n,r,a){var s=n.shape[0],o=n.shape[1],l=Bu(o),c=new hS({windowSize:l,inSize:o,batchSize:s},r),u=this.compileAndRun(c,[n],a);return u.shape[1]===1?u:this.reduce(u,r,a)},t.prototype.argReduce=function(n,r,a){a===void 0&&(a=null);var s=n.shape[0],o=n.shape[1];a!=null&&(s=a.shape[0],o=a.shape[1]);var l=Bu(o),c=new Jk({windowSize:l,inSize:o,batchSize:s},r,a==null),u=[n];a!=null&&u.push(a);var d=this.compileAndRun(c,u,"int32");return d.shape[1]===1?d:this.argReduce(n,r,d)},t.prototype.argReducePacked=function(n,r,a){a===void 0&&(a=null);var s=a!=null?a.shape:n.shape,o=Bu(s[s.length-1]),l=new aC(s,o,r,a==null),c=a==null?[n]:[n,a],u=this.compileAndRun(l,c,"int32");return u.rank===n.rank?this.argReducePacked(n,r,u):u},t.prototype.sum=function(n,r){pn("sum",r,n.rank);var a=Ut(n.shape,r),s=a[0],o=xe(a[1]),l=n.as2D(-1,o),c=Iu(n.dtype);return this.reduce(l,"sum",c).reshape(s)},t.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var a=Ut(n.shape,r),s=a[0],o=xe(a[1]),l=n.as2D(-1,o),c=Iu(n.dtype);return this.reduce(l,"prod",c).reshape(s)},t.prototype.unsortedSegmentSum=function(n,r,a){var s=0,o=gr([s],n.rank),l=n;o!=null&&(l=n.transpose(o),s=vr(1,n.rank)[0]);var c=function(p,m,x){for(var y=[],g=p.length,v=0;v<g;v++)v!==m?y.push(p[v]):y.push(x);return y}(l.shape,s,a),u=xe([l.shape[s]]),d=l.as2D(-1,u),h=Iu(n.dtype),f=this.segOpCompute(d,"unsortedSegmentSum",r,h,a).reshape(c);return o!=null&&(f=f.transpose(Tf(o))),f},t.prototype.segOpCompute=function(n,r,a,s,o){var l=n.shape[0],c=n.shape[1],u=function(f,p){var m,x=!1;for(f<=cy?(m=f,x=!0):m=ch(f,Math.floor(Math.sqrt(f)));!x;)m>p||m===f?x=!0:m=ch(f,m+1);return m}(c,o),d=new wS({windowSize:u,inSize:c,batchSize:l,numSegments:o}),h=this.compileAndRun(d,[n,a],s);return h.shape[1]===o?h:(a=sc(0,o).tile([c/u]),this.segOpCompute(h,r,a,s,o))},t.prototype.argMinMaxReduce=function(n,r,a){var s=[r];if(pn("arg"+a.charAt(0).toUpperCase()+a.slice(1),s,n.rank),!J().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var o=Ut(n.shape,s),l=o[0],c=xe(o[1]),u=n.as2D(-1,c);return this.argReduce(u,a).reshape(l)}return this.argReducePacked(n,a)},t.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},t.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},t.prototype.cumsum=function(n,r,a,s){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var o=new jC(n.shape,a,s);return this.compileAndRun(o,[n])},t.prototype.equal=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(equal(a, b));
`,"bool");var a=new lt("return float(a == b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.notEqual=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(notEqual(a, b));
`,"bool");var a=new lt("return float(a != b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThan(a, b));
`,"bool");var a=new lt("return float(a < b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.lessEqual=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var a=new lt("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThan(a, b));
`,"bool");var a=new lt("return float(a > b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.greaterEqual=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var a=new lt("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.logicalNot=function(n){var r=new Ae(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},t.prototype.logicalAnd=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var a=new lt("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.logicalOr=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var a=new lt("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(a,[n,r],"bool")},t.prototype.select=function(n,r,a){var s=new NS(n.rank,r.shape,r.rank);return this.compileAndRun(s,[n,r,a],Mt(r.dtype,a.dtype))},t.prototype.where=function(n){rc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return Wf(n.shape,r)},t.prototype.topk=function(n,r,a){return by(n.dataSync(),n.shape,n.dtype,r)},t.prototype.min=function(n,r){pn("min",r,n.rank);var a=Ut(n.shape,r),s=a[0],o=xe(a[1]),l=n.as2D(-1,o);return this.reduce(l,"min",l.dtype).reshape(s)},t.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.mod=function(n,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`if (b == 0.0) return NAN;
  return mod(a, b);`,n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);pn("max",r,n.rank);var a=Ut(n.shape,r),s=a[0],o=xe(a[1]),l=n.as2D(-1,o);return this.reduce(l,"max",l.dtype).reshape(s)},t.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.all=function(n,r){pn("all",r,n.rank);var a=Ut(n.shape,r),s=a[0],o=xe(a[1]),l=n.as2D(-1,o);return this.reduce(l,"all",l.dtype).reshape(s)},t.prototype.any=function(n,r){pn("any",r,n.rank);var a=Ut(n.shape,r),s=a[0],o=xe(a[1]),l=n.as2D(-1,o);return this.reduce(l,"any",l.dtype).reshape(s)},t.prototype.realDivide=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var a=new lt(`
if (a == b) {
  return 1.0;
};
return a / b;`,n.shape,r.shape);return this.compileAndRun(a,[n,r],"float32")},t.prototype.floorDiv=function(n,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var a=new lt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,n.shape,r.shape);return this.compileAndRun(a,[n,r],"int32")},t.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,$u);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var a=Mt(n.dtype,r.dtype);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,$u,a);var s=new lt($u,n.shape,r.shape);return this.compileAndRun(s,[n,r],a)},t.prototype.packedUnaryOp=function(n,r,a){var s=new No(n.shape,r);return this.compileAndRun(s,[n],a)},t.prototype.packedBinaryOp=function(n,r,a,s,o){o===void 0&&(o=!1);var l=new wr(a,n.shape,r.shape,o);return this.compileAndRun(l,[n,r],s)},t.prototype.complexSeparableBinaryOp=function(n,r,a){var s=this,o=this.texData.get(n.dataId),l=this.texData.get(r.dataId),c=[[o.complexTensors.real,l.complexTensors.real],[o.complexTensors.imag,l.complexTensors.imag]].map(function(f){var p=f[0],m=f[1],x=s.makeComplexComponentTensorInfo(n,p),y=s.makeComplexComponentTensorInfo(r,m),g=new lt(a,n.shape,r.shape);return s.compileAndRun(g,[x,y],Mt(p.dtype,m.dtype))}),u=c[0],d=c[1],h=this.complex(u,d);return u.dispose(),d.dispose(),h},t.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},t.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>J().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),a=this.addN(n.slice(0,r)),s=this.addN(n.slice(r));return this.addN([a,s])}var o=n.map(function(u){return u.dtype}).reduce(function(u,d){return Mt(u,d)}),l=n.map(function(u){return u.shape}),c=J().getBool("WEBGL_PACK")?new Qk(n[0].shape,l):new Yk(n[0].shape,l);return this.compileAndRun(c,n,o)},t.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,Wu);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var a=Mt(n.dtype,r.dtype);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Wu,n.dtype);var s=new lt(Wu,n.shape,r.shape);return this.compileAndRun(s,[n,r],a)},t.prototype.pow=function(n,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n.shape,r.shape),s=Mt(n.dtype,r.dtype);return this.compileAndRun(a,[n,r],s)},t.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Ag,n.dtype);var r=new Ae(n.shape,Ag);return this.compileAndRun(r,[n])},t.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Tg,n.dtype);var r=new Ae(n.shape,Tg);return this.compileAndRun(r,[n])},t.prototype.sign=function(n){var r=new Ae(n.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[n])},t.prototype.isNaN=function(n){var r=new Ae(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isInf=function(n){var r=new Ae(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isFinite=function(n){var r=new Ae(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.round=function(n){var r=new Ae(n.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[n])},t.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Pg,n.dtype);var r=new Ae(n.shape,Pg);return this.compileAndRun(r,[n])},t.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Fg,n.dtype);var r=new Ae(n.shape,Fg);return this.compileAndRun(r,[n])},t.prototype.softmax=function(n,r){var a=Ct([r],n.shape),s=this.max(n,a),o=dn(s.shape,a),l=this.subtract(n,s.reshape(o)),c=this.exp(l),u=this.sum(c,a).reshape(o);return this.realDivide(c,u)},t.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,n.dtype);var r=new Ae(n.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[n])},t.prototype.log1p=function(n){var r=new Ae(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},t.prototype.sqrt=function(n){var r=new Ae(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},t.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new Ae(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},t.prototype.reciprocal=function(n){var r=new Ae(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},t.prototype.relu=function(n){var r;return r=J().getBool("WEBGL_PACK")?new No(n.shape,Ry):new Ae(n.shape,Cy),this.compileAndRun(r,[n])},t.prototype.relu6=function(n){var r;return r=J().getBool("WEBGL_PACK")?new No(n.shape,Dy):new Ae(n.shape,Sy),this.compileAndRun(r,[n])},t.prototype.prelu=function(n,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wr(ky,n.shape,r.shape):new lt(jy,n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.elu=function(n){if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Iy,n.dtype);var r=new Ae(n.shape,Ey);return this.compileAndRun(r,[n])},t.prototype.eluDer=function(n,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,n.shape,r.shape):new lt("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.selu=function(n){var r=new Ae(n.shape,IS);return this.compileAndRun(r,[n])},t.prototype.int=function(n){var r=new Ae(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},t.prototype.clip=function(n,r,a){var s,o=(s=J().getBool("WEBGL_PACK_CLIP")?new hC(n.shape):new dC(n.shape)).getCustomSetupFunc(r,a);return this.compileAndRun(s,[n],null,o)},t.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,Dg,n.dtype);var r=new Ae(n.shape,Dg);return this.compileAndRun(r,[n])},t.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),a=new fC(n.shape),s=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(a,s)},t.prototype.sigmoid=function(n){var r=new Ae(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},t.prototype.softplus=function(n){var r=new Ae(n.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[n])},t.prototype.sin=function(n){var r=new Ae(n.shape,AS);return this.compileAndRun(r,[n])},t.prototype.cos=function(n){var r=new Ae(n.shape,TS);return this.compileAndRun(r,[n])},t.prototype.tan=function(n){var r=new Ae(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},t.prototype.asin=function(n){var r=new Ae(n.shape,PS);return this.compileAndRun(r,[n])},t.prototype.acos=function(n){var r=new Ae(n.shape,FS);return this.compileAndRun(r,[n])},t.prototype.atan=function(n){var r=new Ae(n.shape,MS);return this.compileAndRun(r,[n])},t.prototype.atan2=function(n,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,n.shape,r.shape);return this.compileAndRun(a,[n,r])},t.prototype.sinh=function(n){var r=new Ae(n.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.cosh=function(n){var r=new Ae(n.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.tanh=function(n){var r=new Ae(n.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[n])},t.prototype.asinh=function(n){var r=new Ae(n.shape,OS);return this.compileAndRun(r,[n])},t.prototype.acosh=function(n){var r=new Ae(n.shape,LS);return this.compileAndRun(r,[n])},t.prototype.atanh=function(n){var r=new Ae(n.shape,BS);return this.compileAndRun(r,[n])},t.prototype.erf=function(n){var r=new Ae(n.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[n])},t.prototype.step=function(n,r){var a=new Ae(n.shape,function(s){return s===void 0&&(s=0),Jn+`
    return x > 0.0 ? 1.0 : float(`+s+`);
  `}(r));return this.compileAndRun(a,[n])},t.prototype.conv2dByMatMul=function(n,r,a,s,o,l){var c=n.shape,u=this.texData.get(n.dataId),d=a.inChannels,h=c[0]*c[1]*c[2],f=a.outChannels,p=a.dataFormat==="channelsLast",m=(h===1||f===1)&&d>1e3,x=c[2]%2!=0&&!!u.isPacked;if(m||!J().getBool("WEBGL_LAZILY_UNPACK")||!J().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!x){var y=p?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],g=this.reshape(n,[1,y,a.inChannels]),v=this.reshape(r,[1,a.inChannels,a.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:v,transposeA:!1,transposeB:!1,bias:s,activation:o,preluActivationWeights:l}),a.outShape)}var w=p?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),b={dataId:n.dataId,shape:[1,w,a.inChannels],dtype:n.dtype},N=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,T(Ji(u.shape,b.shape),function(){return"packed reshape "+u.shape+" to "+b.shape+" isn't free"});var _=this.reshape(r,[1,a.inChannels,a.outChannels]),C=this.fusedBatchMatMul({a:b,b:_,transposeA:!1,transposeB:!1,bias:s,activation:o,preluActivationWeights:l}),k=this.texData.get(C.dataId);return T(k.isPacked,function(){return"batchMatMul result is expected to be packed"}),u.shape=N,k.shape=a.outShape,z.makeTensorFromDataId(C.dataId,a.outShape,C.dtype)},t.prototype.conv2dWithIm2Row=function(n,r,a,s,o,l){var c=a.filterWidth,u=a.filterHeight,d=a.inChannels,h=a.outWidth,f=a.outHeight,p=a.dataFormat==="channelsLast",m=c*u*d,x=f*h,y=[m,x],g=n.squeeze([0]),v=r.reshape([1,m,-1]),w=new tS(y,g.shape,a),b=this.compileAndRun(w,[g]).reshape([1,y[0],y[1]]),N=s!=null,_=l!=null,C=o?nl(o,!0):null,k=new zu(b.shape,[1,x,a.outChannels],!0,!1,N,C,_),j=[b,v];s&&j.push(s),_&&j.push(l);var S=this.compileAndRun(k,j);return p?S.reshape([1,f,h,a.outChannels]):S.reshape([1,a.outChannels,f,h])},t.prototype.fusedConv2d=function(n){var r=n.input,a=n.filter,s=n.convInfo,o=n.bias,l=n.activation,c=n.preluActivationWeights;if(s.filterHeight===1&&s.filterWidth===1&&s.dilationHeight===1&&s.dilationWidth===1&&s.strideHeight===1&&s.strideWidth===1&&(s.padInfo.type==="SAME"||s.padInfo.type==="VALID"))return this.conv2dByMatMul(r,a,s,o,l,c);if(J().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,a,s,o,l,c);var u=o!=null,d=c!=null,h=l?nl(l,!1):null,f=new wg(s,u,h,d),p=[r,a];return o&&p.push(o),c&&p.push(c),this.compileAndRun(f,p)},t.prototype.conv2d=function(n,r,a){if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,a);if(J().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,a);var s=new wg(a);return this.compileAndRun(s,[n,r])},t.prototype.conv2dDerInput=function(n,r,a){var s=new vC(a);return this.compileAndRun(s,[n,r])},t.prototype.conv2dDerFilter=function(n,r,a){var s=new gC(a);return this.compileAndRun(s,[n,r])},t.prototype.fusedDepthwiseConv2D=function(n){var r,a=n.input,s=n.filter,o=n.convInfo,l=n.bias,c=n.activation,u=n.preluActivationWeights,d=J().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,h=c?nl(c,d):null,f=[a,s],p=l!=null,m=u!=null;return p&&f.push(l),m&&f.push(u),d?(r=new _g(o,p,h,m),this.compileAndRun(r,f)):(r=new Ng(o,p,h,m),this.compileAndRun(r,f))},t.prototype.depthwiseConv2D=function(n,r,a){var s;return J().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1?(s=new _g(a),this.compileAndRun(s,[n,r])):(s=new Ng(a),this.compileAndRun(s,[n,r]))},t.prototype.depthwiseConv2DDerInput=function(n,r,a){var s=new wC(a);return this.compileAndRun(s,[n,r])},t.prototype.depthwiseConv2DDerFilter=function(n,r,a){var s=new bC(a);return this.compileAndRun(s,[n,r])},t.prototype.conv3d=function(n,r,a){var s=new NC(a);return this.compileAndRun(s,[n,r])},t.prototype.conv3dDerInput=function(n,r,a){var s=new yC(a);return this.compileAndRun(s,[n,r])},t.prototype.conv3dDerFilter=function(n,r,a){var s=new xC(a);return this.compileAndRun(s,[n,r])},t.prototype.maxPool=function(n,r){var a=new Uu(r,"max",!1);return this.compileAndRun(a,[n])},t.prototype.avgPool=function(n,r){var a=new Uu(r,"avg",!1);return this.compileAndRun(a,[n],"float32")},t.prototype.maxPoolBackprop=function(n,r,a,s){var o=new Uu(s,"max",!0),l=this.compileAndRun(o,[r]),c=new sS(s),u=this.compileAndRun(c,[n,l],r.dtype);return l.dispose(),u},t.prototype.avgPoolBackprop=function(n,r,a){var s=new sC(a);return this.compileAndRun(s,[n],r.dtype)},t.prototype.cast=function(n,r){return my(n,r,this)},t.prototype.unstack=function(n,r){for(var a=n.shape[r],s=new Array(n.rank-1),o=0,l=0;l<n.rank;l++)l!==r&&(s[o++]=n.shape[l]);var c=new Array(n.rank).fill(0),u=n.shape.slice();u[r]=1;var d=new Array(a);for(l=0;l<d.length;l++)c[r]=l,d[l]=this.slice(n,c,u).reshape(s);return d},t.prototype.avgPool3d=function(n,r){var a=new Vu(r,"avg",!1);return this.compileAndRun(a,[n],"float32")},t.prototype.avgPool3dBackprop=function(n,r,a){var s=new oC(a);return this.compileAndRun(s,[n],r.dtype)},t.prototype.maxPool3d=function(n,r){var a=new Vu(r,"max",!1);return this.compileAndRun(a,[n],"float32")},t.prototype.maxPool3dBackprop=function(n,r,a,s){var o=new Vu(s,"max",!0),l=this.compileAndRun(o,[r]),c=new oS(s),u=this.compileAndRun(c,[n,l],r.dtype);return l.dispose(),u},t.prototype.reshape=function(n,r){var a=this.texData.get(n.dataId);if(a.isPacked&&!Ji(n.shape,r)&&(a.texture===null||!Ji(a.shape,r))){var s=this.packedReshape(n,r);return z.makeTensorFromDataId(s.dataId,s.shape,s.dtype)}return vh(n,r)},t.prototype.resizeBilinear=function(n,r,a,s){var o=J().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new gS(n.shape,r,a,s):new mS(n.shape,r,a,s);return this.compileAndRun(o,[n],"float32")},t.prototype.resizeBilinearBackprop=function(n,r,a){var s=new pS(n,r,a);return this.compileAndRun(s,[n])},t.prototype.resizeNearestNeighbor=function(n,r,a,s){var o=new xS(n.shape,r,a,s);return this.compileAndRun(o,[n])},t.prototype.resizeNearestNeighborBackprop=function(n,r,a){var s=new vS(n,r,a);return this.compileAndRun(s,[n])},t.prototype.multinomial=function(n,r,a,s){var o=r?n:Mr(n),l=o.shape[0],c=o.shape[1],u=new iS(l,c,a),d=u.getCustomSetupFunc(s);return this.compileAndRun(u,[o],"int32",d)},t.prototype.oneHot=function(n,r,a,s){var o=new lS(n.size,r,a,s);return this.compileAndRun(o,[n])},t.prototype.diag=function(n){var r=new EC(n.size);return this.compileAndRun(r,[n])},t.prototype.nonMaxSuppression=function(n,r,a,s,o){return rc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Bf(n.dataSync(),r.dataSync(),a,s,o)},t.prototype.cropAndResize=function(n,r,a,s,o,l){var c=new _C(n.shape,r.shape,s,o,l);return this.compileAndRun(c,[n,r,a],"float32")},t.prototype.depthToSpace=function(n,r,a){T(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var s=n.shape[0],o=a==="NHWC"?n.shape[1]:n.shape[2],l=a==="NHWC"?n.shape[2]:n.shape[3],c=a==="NHWC"?n.shape[3]:n.shape[1],u=o*r,d=l*r,h=c/(r*r),f=new SC(a==="NHWC"?[s,u,d,h]:[s,h,u,d],r,a);return this.compileAndRun(f,[n])},t.prototype.split=function(n,r,a){return xy(n,r,a)},t.prototype.scatterND=function(n,r,a){var s=cc(0,n,a),o=s.sliceRank,l=s.numUpdates,c=s.sliceSize,u=s.strides,d=s.outputSize,h=[d/c,c],f=n.reshape([l,o]),p=r.reshape([l,c]);if(d===0)return vh(Ot([]),a);var m=ce(0),x=new Sg(l,o,f.rank,p.rank,u,h);return this.compileAndRun(x,[p,f,m]).reshape(a)},t.prototype.sparseToDense=function(n,r,a,s){var o=cc(0,n,a),l=o.sliceRank,c=o.numUpdates,u=o.strides,d=o.outputSize,h=new Sg(c,l,n.rank,r.rank,u,[d,1]);return this.compileAndRun(h,[r,n,s]).reshape(a)},t.prototype.fft=function(n){return this.fftImpl(n,!1)},t.prototype.ifft=function(n){return this.fftImpl(n,!0)},t.prototype.fftImpl=function(n,r){var a=this.texData.get(n.dataId),s=new kg(TC,n.shape,r),o=new kg(PC,n.shape,r),l=[this.makeComplexComponentTensorInfo(n,a.complexTensors.real),this.makeComplexComponentTensorInfo(n,a.complexTensors.imag)],c=this.compileAndRun(s,l),u=this.compileAndRun(o,l),d=this.complex(c,u).as2D(n.shape[0],n.shape[1]);return c.dispose(),u.dispose(),d},t.prototype.gatherND=function(n,r){var a=r.shape,s=a[a.length-1],o=ly(n,r),l=o[0],c=o[1],u=o[2],d=o[3],h=r.reshape([c,s]),f=n.reshape([n.size/u,u]),p=new OC(s,d,[c,u]);return this.compileAndRun(p,[f,h]).reshape(l)},t.prototype.fill=function(n,r,a){if((a=a||Ni(r))==="string"){var s=Zl(a,xe(n));return s.fill(r),z.makeTensor(s,n,a,this)}var o=new FC(n,r),l=o.getCustomSetupFunc(r);return this.compileAndRun(o,[],a,l)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},t.prototype.linspace=function(n,r,a){return gy(n,r,a)},t.prototype.makeTensorInfo=function(n,r){var a=this.write(null,n,r);return this.texData.get(a).usage=null,{dataId:a,shape:n,dtype:r}},t.prototype.makeOutput=function(n,r){var a=this.makeTensorInfo(n,r).dataId;return z.makeTensorFromDataId(a,n,r,this)},t.prototype.unpackTensor=function(n){var r=new WS(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},t.prototype.packTensor=function(n){var r=new cS(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},t.prototype.packedReshape=function(n,r){var a=[tc(n.shape)].concat(nc(n.shape)),s={dtype:n.dtype,shape:a,dataId:n.dataId},o=[tc(r)].concat(nc(r)),l=new fS(o,a),c=this.runWebGLProgram(l,[s],n.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}},t.prototype.decode=function(n){var r,a=this.texData.get(n),s=a.isPacked,o=a.shape,l=a.dtype,c=Lu(o);return r=s?new CC(c):new kC(c),{dtype:l,shape:o,dataId:this.runWebGLProgram(r,[{shape:c,dtype:l,dataId:n}],l,null,!0).dataId}},t.prototype.runWebGLProgram=function(n,r,a,s,o){var l=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(n.outputShape,a),u=this.texData.get(c.dataId);if(n.packedOutput&&(u.isPacked=!0),n.outPackingScheme===hi.DENSE){var d=Mo(n.outputShape);u.texShape=d.map(function(w){return 2*w})}if(n.outTexUsage!=null&&(u.usage=n.outTexUsage),xe(c.shape)===0)return u.values=ui(c.dtype,0),c;var h=[],f=r.map(function(w){if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=l.texData.get(w.dataId);if(b.texture==null){if(!n.packedInputs&&xe(w.shape)<=J().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:b.values};n.packedInputs&&(b.isPacked=!0,b.shape=w.shape)}else if(!!b.isPacked!=!!n.packedInputs)w=b.isPacked?l.unpackTensor(w):l.packTensor(w),h.push(w),b=l.texData.get(w.dataId);else if(b.isPacked&&!Ji(b.shape,w.shape)){var N=w,_=w.shape;w.shape=b.shape,w=l.packedReshape(w,_),h.push(w),b=l.texData.get(w.dataId),N.shape=_}return l.uploadToGPU(w.dataId),{shape:w.shape,texData:b,isUniform:!1}});this.uploadToGPU(c.dataId);var p,m={shape:c.shape,texData:u,isUniform:!1},x=function(w,b,N){var _="";b.concat(N).forEach(function(j){var S=j.texData!=null&&j.texData.slice!=null&&j.texData.slice.flatOffset>0,M=j.isUniform?"uniform":j.texData.texShape;_+=j.shape+"_"+M+"_"+S});var C=w.userCode,k=w.constructor.name;return k+="_"+_+"_"+C}(n,f,m),y=this.getAndSaveBinary(x,function(){return function(w,b,N,_){var C=b.userCode,k=N.map(function(P,$){var I={logicalShape:P.shape,texShape:P.isUniform?null:P.texData.texShape,isUniform:P.isUniform,isPacked:!P.isUniform&&P.texData.isPacked,flatOffset:null};return P.texData!=null&&P.texData.slice!=null&&P.texData.slice.flatOffset>0&&(I.flatOffset=P.texData.slice.flatOffset),{name:b.variableNames[$],shapeInfo:I}}),j=k.map(function(P){return P.shapeInfo}),S={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},M=Zk(k,S,C,b.packedInputs),D=w.createProgram(M),A=null,B=w.getUniformLocation(D,"NAN",!1);J().getNumber("WEBGL_VERSION")===1&&(A=w.getUniformLocation(D,"INFINITY",!1));for(var F={},U=0;U<b.variableNames.length;U++){var V=b.variableNames[U];F[V]=w.getUniformLocation(D,V,!1),F["offset"+V]=w.getUniformLocation(D,"offset"+V,!1)}return{program:b,source:M,webGLProgram:D,uniformLocations:F,inShapeInfos:j,outShapeInfo:S,infLoc:A,nanLoc:B}}(l.gpgpu,n,f,m)}),g=this.activeTimers!=null;if(g&&(p=this.startTimer()),function(w,b,N,_,C){Cg(b.inShapeInfos,N),Cg([b.outShapeInfo],[_]);var k=_.texData.texture,j=_.texData.texShape;_.texData.isPacked?w.setOutputPackedMatrixTexture(k,j[0],j[1]):w.setOutputMatrixTexture(k,j[0],j[1]),w.setProgram(b.webGLProgram),J().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&w.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&w.gl.uniform1f(b.nanLoc,NaN),N.forEach(function(S,M){var D=b.program.variableNames[M],A=b.uniformLocations[D],B=b.uniformLocations["offset"+D];if(A!=null)if(S.isUniform)if(xe(S.shape)<2)w.gl.uniform1f(A,S.uniformValues[0]);else{var F=S.uniformValues;F instanceof Float32Array||(F=new Float32Array(F)),w.gl.uniform1fv(A,F)}else S.texData.slice!=null&&B!=null&&w.gl.uniform1i(B,S.texData.slice.flatOffset),w.setInputMatrixTexture(S.texData.texture,A,M)}),C!=null&&C(w,b.webGLProgram),w.executeProgram()}(this.gpgpu,y,f,m,s),h.forEach(function(w){return l.disposeData(w.dataId)}),g&&(p=this.endTimer(p),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(p)})),!J().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&o===!1){var v=this.unpackTensor(c);return this.disposeData(c.dataId),v}return c},t.prototype.compileAndRun=function(n,r,a,s,o){o===void 0&&(o=!1),a=a||r[0].dtype;var l=this.runWebGLProgram(n,r,a,s,o);return z.makeTensorFromDataId(l.dataId,l.shape,l.dtype)},t.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var n=this;this.disposed||(J().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=he(function(){if(!J().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=J().getBool("DEBUG");J().set("DEBUG",!1);var a=n.abs(ce(1e-8)).dataSync()[0];if(J().set("DEBUG",r),a>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(n){var r,a=this.texData.get(n),s=a.shape,o=a.dtype,l=a.values,c=a.texture,u=a.usage,d=a.isPacked;if(c==null){var h,f=this.activeTimers!=null;f&&(h=ar());var p=a.texShape;if(p==null&&(p=Xj(s,d),a.texShape=p),l!=null){var m=Lu(s),x=void 0,y=p[1],g=p[0],v=l instanceof Uint8Array;d?(y=(r=ji(p[0],p[1]))[0],g=r[1],x=new AC(m,[g,y],v)):x=new IC(m,[g,y],v);var w=this.makeTensorInfo([g,y],o);this.texData.get(w.dataId).usage=v?xn.PIXELS:xn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),y,g,l);var b=this.runWebGLProgram(x,[w],o,null,!0),N=this.texData.get(b.dataId);a.texture=N.texture,a.texShape=N.texShape,a.isPacked=N.isPacked,a.usage=N.usage,this.disposeData(w.dataId),this.texData.delete(b.dataId),a.values=null,f&&(this.uploadWaitMs+=ar()-h)}else{var _=this.acquireTexture(p,u,o,d);a.texture=_}}},t.prototype.convertAndCacheOnCPU=function(n,r){var a=this.texData.get(n),s=a.dtype;return this.releaseGPUData(n),r!=null&&(a.values=function(o,l){if(l==="float32"||l==="complex64")return o;if(l==="int32"||l==="bool"){for(var c=l==="int32"?new Int32Array(o.length):new Uint8Array(o.length),u=0;u<c.length;++u)c[u]=Math.round(o[u]);return c}throw new Error("Unknown dtype "+l)}(r,s)),a.values},t.prototype.acquireTexture=function(n,r,a,s){if(this.numBytesInGPU+=this.computeBytes(n,a),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,s)},t.prototype.computeBytes=function(n,r){return n[0]*n[1]*V0(r)},t}(fy);Q0()&&z.registerBackend("webgl",function(){return new US},2);var VS=L({square_:function(e){var t=R(e,"x","square"),n=[t];return z.runKernelFunc(function(r,a){return a([t]),r.square(t)},{x:t},null,"Square",{},n,[])}}),pi="SquaredDifference",Ay=L({squaredDifference_:function(e,t){var n,r=R(e,"a","squaredDifference"),a=R(t,"b","squaredDifference");n=it(r,a),r=n[0],a=n[1],Pe(r.shape,a.shape);var s={a:r,b:a},o=[r,a];return z.runKernelFunc(function(l,c){var u=l.squaredDifference(r,a);return c([r,a]),u},s,function(l,c){var u=c[0],d=c[1],h=ce(2);return{a:function(){return l.mul(u.sub(d).mul(h))},b:function(){return l.mul(d.sub(u).mul(h))}}},pi,{},o,[])}}),qS=L({abs_:function(e){var t=R(e,"x","abs");return t.dtype==="complex64"?z.runKernelFunc(function(n){return n.complexAbs(t)},{$x:t}):z.runKernelFunc(function(n,r){var a=n.abs(t);return r([t]),a},{x:t},function(n,r){var a=r[0];return{x:function(){return n.mul(a.toFloat().step(-1))}}},"Abs")}}),HS=L({acos_:function(e){var t=R(e,"x","acos");return z.runKernelFunc(function(n,r){var a=n.acos(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.divStrict(ce(1).sub(a.toFloat().square()).sqrt()).neg()}}})}}),GS=L({acosh_:function(e){var t=R(e,"x","acosh");return z.runKernelFunc(function(n,r){var a=n.acosh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.divStrict(a.toFloat().square().sub(1).sqrt())}}})}}),KS=L({asin_:function(e){var t=R(e,"x","asin");return z.runKernelFunc(function(n,r){var a=n.asin(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.divStrict(ce(1).sub(a.toFloat().square()).sqrt())}}})}}),XS=L({asinh_:function(e){var t=R(e,"x","asinh");return z.runKernelFunc(function(n,r){var a=n.asinh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.divStrict(ce(1).add(a.toFloat().square()).sqrt())}}})}}),YS=L({atan_:function(e){var t=R(e,"x","atan");return z.runKernelFunc(function(n,r){var a=n.atan(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.toFloat().square().add(1))}}})}}),QS=L({atanh_:function(e){var t=R(e,"x","atanh");return z.runKernelFunc(function(n,r){var a=n.atanh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(ce(1).sub(a.toFloat().square()))}}})}}),JS=L({ceil_:function(e){var t=R(e,"x","ceil");return z.runKernelFunc(function(n){return n.ceil(t)},{$x:t},function(n){return{$x:function(){return Be(n)}}})}}),qf=L({clipByValue_:function(e,t,n){var r=R(e,"x","clipByValue");T(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var a=[r],s={min:t,max:n};return z.runKernelFunc(function(o,l){var c=o.clip(r,t,n);return l([r]),c},{x:r},function(o,l){var c=l[0];return{x:function(){return o.where(c.greaterEqual(t).logicalAnd(c.lessEqual(n)),Be(o))}}},"ClipByValue",s,a)}}),ZS=L({cos_:function(e){var t=R(e,"x","cos"),n=[t];return z.runKernelFunc(function(r,a){var s=r.cos(t);return a([t]),s},{x:t},function(r,a){var s=a[0];return{x:function(){return s.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),e4=L({cosh_:function(e){var t=R(e,"x","cosh");return z.runKernelFunc(function(n,r){var a=n.cosh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return a.toFloat().sinh().mulStrict(n)}}})}}),t4=L({erf_:function(e){var t=R(e,"x","erf");return T(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),z.runKernelFunc(function(n,r){var a=n.erf(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),yh=L({exp_:function(e){var t=R(e,"x","exp");return z.runKernelFunc(function(n,r){var a=n.exp(t);return r([a]),a},{x:t},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),n4=L({expm1_:function(e){var t=R(e,"x","expm1");return z.runKernelFunc(function(n,r){var a=n.expm1(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.mul(a.exp())}}})}}),r4=L({floor_:function(e){var t=R(e,"x","floor");return z.runKernelFunc(function(n){return n.floor(t)},{$x:t},function(n){return{$x:function(){return Be(n)}}})}}),a4=L({log_:function(e){var t=R(e,"x","log"),n=[t];return z.runKernelFunc(function(r,a){var s=r.log(t);return a([t]),s},{x:t},function(r,a){var s=a[0];return{x:function(){return r.div(s.toFloat())}}},"Log",{},n)}}),s4=L({log1p_:function(e){var t=R(e,"x","log1p");return z.runKernelFunc(function(n,r){var a=n.log1p(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.add(1))}}})}}),o4=L({logSigmoid_:function(e){var t=R(e,"x","logSigmoid");return z.runKernelFunc(function(n,r){var a=n.softplus(t.neg()).neg();return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.mul(a.neg().sigmoid())}}})}}),fc=L({neg_:function(e){var t=R(e,"x","neg"),n=[t];return z.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),i4=L({reciprocal_:function(e){var t=R(e,"x","reciprocal");return z.runKernelFunc(function(n,r){var a=n.reciprocal(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.square().neg())}}})}}),l4=L({round_:function(e){var t=R(e,"x","round");return z.runKernelFunc(function(n){return n.round(t)},{$x:t},function(n){return{$x:function(){return Be(n)}}})}}),Ty=L({rsqrt_:function(e){var t=R(e,"x","rsqrt"),n=[t];return z.runKernelFunc(function(r,a){var s=r.rsqrt(t);return a([t]),s},{x:t},function(r,a){var s=a[0];return{x:function(){return r.div(s.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),Py=L({sigmoid_:function(e){var t=R(e,"x","sigmoid");return z.runKernelFunc(function(n,r){var a=n.sigmoid(t);return r([a]),a},{x:t},function(n,r){var a=r[0];return{x:function(){return n.mul(a.mul(ce(1).sub(a)))}}},"Sigmoid")}}),c4=L({sign_:function(e){var t=R(e,"x","sign");return z.runKernelFunc(function(n){return n.sign(t)},{$x:t},function(n){return{$x:function(){return Be(n)}}})}}),u4=L({isNaN_:function(e){var t=R(e,"x","isNaN");return z.runKernelFunc(function(n){return n.isNaN(t)},{$x:t},function(n){return{$x:function(){return Be(n)}}})}}),d4=L({isInf_:function(e){var t=R(e,"x","isInf");return z.runKernelFunc(function(n){return n.isInf(t)},{$x:t},function(n){return{$x:function(){return Be(n)}}})}}),h4=L({isFinite_:function(e){var t=R(e,"x","isFinite");return z.runKernelFunc(function(n){return n.isFinite(t)},{$x:t},function(n){return{$x:function(){return Be(n)}}})}}),f4=L({sin_:function(e){var t=R(e,"x","sin"),n=[t];return z.runKernelFunc(function(r,a){var s=r.sin(t);return a([t]),s},{x:t},function(r,a){var s=a[0];return{x:function(){return s.toFloat().cos().mul(r)}}},"Sin",{},n)}}),p4=L({sinh_:function(e){var t=R(e,"x","sinh");return z.runKernelFunc(function(n,r){var a=n.sinh(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return a.toFloat().cosh().mulStrict(n)}}})}}),m4=L({softplus_:function(e){var t=R(e,"x","softplus");return z.runKernelFunc(function(n,r){var a=n.softplus(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.mul(a.sigmoid())}}})}}),g4=L({sqrt_:function(e){var t=R(e,"x","sqrt");return z.runKernelFunc(function(n,r){var a=n.sqrt(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.toFloat().sqrt().mul(2))}}})}}),v4=L({step_:function(e,t){t===void 0&&(t=0);var n=R(e,"x","step");return z.runKernelFunc(function(r){return r.step(n,t)},{$x:n},function(r){return{$x:function(){return Be(r)}}})}}),x4=L({tan_:function(e){var t=R(e,"x","tan");return z.runKernelFunc(function(n,r){var a=n.tan(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return n.div(a.cos().square())}}})}}),y4=L({tanh_:function(e){var t=R(e,"x","tanh");return z.runKernelFunc(function(n,r){var a=n.tanh(t);return r([a]),a},{x:t},function(n,r){var a=r[0];return{x:function(){return ce(1).sub(a.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function Fy(e,t,n,r,a,s){var o,l,c=R(e,"x","batchNorm"),u=R(t,"mean","batchNorm"),d=R(n,"variance","batchNorm");return a!=null&&(o=R(a,"scale","batchNorm")),r!=null&&(l=R(r,"offset","batchNorm")),T(c.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),T(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."}),T(d.rank===2||d.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+d.rank+"."}),o!=null&&T(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),l!=null&&T(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+l.rank+"."}),Ci(c,u,d,l,o,s)}function My(e,t,n,r,a,s){var o,l,c=R(e,"x","batchNorm"),u=R(t,"mean","batchNorm"),d=R(n,"variance","batchNorm");return a!=null&&(o=R(a,"scale","batchNorm")),r!=null&&(l=R(r,"offset","batchNorm")),T(c.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),T(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."}),T(d.rank===3||d.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+d.rank+"."}),o!=null&&T(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),l!=null&&T(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+l.rank+"."}),Ci(c,u,d,l,o,s)}function Oy(e,t,n,r,a,s){var o,l,c=R(e,"x","batchNorm"),u=R(t,"mean","batchNorm"),d=R(n,"variance","batchNorm");return a!=null&&(o=R(a,"scale","batchNorm")),r!=null&&(l=R(r,"offset","batchNorm")),T(c.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."}),T(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."}),T(d.rank===4||d.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+d.rank+"."}),o!=null&&T(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),l!=null&&T(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+l.rank+"."}),Ci(c,u,d,l,o,s)}function Ci(e,t,n,r,a,s){s==null&&(s=.001);var o,l,c,u=R(e,"x","batchNorm"),d=R(t,"mean","batchNorm"),h=R(n,"variance","batchNorm");a!=null&&(o=R(a,"scale","batchNorm")),r!=null&&(l=R(r,"offset","batchNorm")),T(d.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),T(l==null||d.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),T(o==null||d.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),c=u.rank===0||u.rank===1?u.as4D(1,1,1,u.size):u.rank===2?u.as4D(1,1,u.shape[0],u.shape[1]):u.rank===3?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u;var f=[u,d,h,o];return z.runKernelFunc(function(p,m){var x=p.batchNormalization(c,rl(d),rl(h),s,rl(o),rl(l));return m([u,d,h,o]),x},{x:u,mean:d,variance:h,scale:o,offset:l},function(p,m){var x=m,y=x[0],g=x[1],v=x[2],w=x[3],b=w??ce(1),N=jt(g.shape,c.shape),_=[];if(g.rank===1){for(var C=0;C<c.shape.length-1;++C)_.push(c.shape[C]);_.push(1)}var k=y.sub(g),j=p.mul(b),S=Ty(v.add(ce(s))),M=S.mul(S).mul(S).mul(ce(-.5));return{x:function(){return g.rank===1?p.mul(Ps(S.as4D(1,1,1,g.shape[0]),_)).mul(b).reshape(y.shape):p.mul(S).mul(b).reshape(y.shape)},mean:function(){var D=S.mul(ce(-1)).mul(j);return g.rank===1&&(D=D.sum(N)),D.reshape(g.shape)},variance:function(){var D=M.mul(k).mul(j);return g.rank===1&&(D=D.sum(N)),D.reshape(g.shape)},scale:function(){var D=k.mul(S),A=p.mul(D);return g.rank===1&&(A=A.sum(N)),A.reshape(g.shape)},offset:function(){var D=p;return g.rank===1&&(D=D.sum(N)),D.reshape(g.shape)}}},"BatchNormalization",{varianceEpsilon:s},f).reshape(u.shape)}function rl(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function zc(){J0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var b4=L({batchNormalization2d_:function(e,t,n,r,a,s){return r===void 0&&(r=.001),zc(),Fy(e,t,n,s,a,r)}}),w4=L({batchNormalization3d_:function(e,t,n,r,a,s){return r===void 0&&(r=.001),zc(),My(e,t,n,s,a,r)}}),N4=L({batchNormalization4d_:function(e,t,n,r,a,s){return r===void 0&&(r=.001),zc(),Oy(e,t,n,s,a,r)}}),_4=L({batchNormalization_:function(e,t,n,r,a,s){return r===void 0&&(r=.001),zc(),Ci(e,t,n,s,a,r)}}),Ly=L({batchNorm_:Ci}),j4=L({batchNorm2d_:Fy}),k4=L({batchNorm3d_:My}),C4=L({batchNorm4d_:Oy}),Uc=L({logicalAnd_:function(e,t){var n=R(e,"a","logicalAnd","bool"),r=R(t,"b","logicalAnd","bool");return Pe(n.shape,r.shape),z.runKernelFunc(function(a){return a.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),S4=L({logicalNot_:function(e){var t=R(e,"x","logicalNot","bool");return z.runKernelFunc(function(n){return n.logicalNot(t)},{$x:t})}}),By=L({logicalOr_:function(e,t){var n=R(e,"a","logicalOr","bool"),r=R(t,"b","logicalOr","bool");return Pe(n.shape,r.shape),z.runKernelFunc(function(a){return a.logicalOr(n,r)},{$a:n,$b:r})}}),E4=L({logicalXor_:function(e,t){var n=R(e,"a","logicalXor","bool"),r=R(t,"b","logicalXor","bool");return Pe(n.shape,r.shape),By(e,t).logicalAnd(Uc(e,t).logicalNot())}}),Ka=L({where_:function(e,t,n){var r=R(t,"a","where"),a=R(n,"b","where"),s=R(e,"condition","where","bool");return Ue(r.shape,a.shape,"Error in where: "),s.rank===1?T(s.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ue(s.shape,a.shape,"Error in where: "),z.runKernelFunc(function(o,l){var c=o.select(s,r,a);return l([s]),c},{$condition:s,$a:r,$b:a},function(o,l){var c=l[0];return{$condition:function(){return Be(c).toFloat()},$a:function(){return o.mul(c.cast(o.dtype))},$b:function(){return o.mul(c.logicalNot().cast(o.dtype))}}})}}),$y=function(e){return ge(this,void 0,void 0,function(){var t,n,r;return ve(this,function(a){switch(a.label){case 0:return[4,(t=R(e,"condition","whereAsync","bool")).data()];case 1:return n=a.sent(),r=Wf(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},Te=L({add_:function(e,t){var n,r=R(e,"a","add"),a=R(t,"b","add");n=it(r,a),r=n[0],a=n[1];var s=Pe(r.shape,a.shape);return z.runKernelFunc(function(o){return o.add(r,a)},{a:r,b:a},function(o){return{a:function(){var l=o,c=jt(r.shape,s);return c.length>0&&(l=l.sum(c)),l.reshape(r.shape)},b:function(){var l=o,c=jt(a.shape,s);return c.length>0&&(l=l.sum(c)),l.reshape(a.shape)}}},"Add")}}),R4=L({addN_:function(e){T(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),T(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(a,s){return R(a,"tensors"+s,"addN")}),n=t[0];t.forEach(function(a){if(a.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(a){if(!It(a.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return z.runKernelFunc(function(a){return a.addN(t)},r,function(a){var s={};return t.forEach(function(o,l){s[l]=function(){return a.clone()}}),s},"AddN")}}),D4=L({addStrict_:function(e,t){var n=R(e,"a","addStrict"),r=R(t,"b","addStrict");return Ue(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),I4=L({atan2_:function(e,t){var n,r=R(e,"a","atan2"),a=R(t,"b","atan2");n=it(r,a),r=n[0],a=n[1];var s=Pe(r.shape,a.shape);return z.runKernelFunc(function(o,l){var c=o.atan2(r,a);return l([r,a]),c},{$a:r,$b:a},function(o,l){var c=l[0],u=l[1];return{$a:function(){var d=Te(c.square(),u.square()),h=o.mul(u.div(d)),f=jt(c.shape,s);return f.length>0&&(h=h.sum(f)),h.reshape(c.shape)},$b:function(){var d=Te(c.square(),u.square()),h=fc(o.mul(c.div(d))),f=jt(u.shape,s);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)}}})}}),Un=L({div_:function(e,t){var n,r=R(e,"a","div"),a=R(t,"b","div");if(n=it(r,a),r=n[0],a=n[1],r.dtype==="int32"&&a.dtype==="int32")return Wy(r,a);var s=Pe(r.shape,a.shape);return z.runKernelFunc(function(o,l){var c=o.realDivide(r,a);return l([r,a]),c},{a:r,b:a},function(o,l){var c=l[0],u=l[1];return{a:function(){var d=o.div(u.toFloat()),h=jt(c.shape,s);return h.length>0?d.sum(h).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),h=jt(u.shape,s);h.length>0&&(d=d.sum(h).reshape(u.shape));var f=u.square();return d.div(f.toFloat()).neg()}}},"Div")}}),A4=L({divNoNan_:function(e,t){var n,r=R(e,"a","div"),a=R(t,"b","div");r=(n=it(r,a))[0],a=n[1];var s=Un(r,a),o=Be(s),l=a.equal(o);return Ka(l,o,s)}}),T4=L({divStrict_:function(e,t){var n=R(e,"a","div"),r=R(t,"b","div");return Ue(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Wy=L({floorDiv_:function(e,t){var n,r=R(e,"a","floorDiv"),a=R(t,"b","floorDiv");n=it(r,a),r=n[0],a=n[1];var s=Pe(r.shape,a.shape);return z.runKernelFunc(function(o,l){var c=o.floorDiv(r,a);return l([r,a]),c},{a:r,b:a},function(o,l){var c=l[0],u=l[1];return{a:function(){var d=o.div(u.toFloat()),h=jt(c.shape,s);return h.length>0?d.sum(h).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),h=jt(u.shape,s);h.length>0&&(d=d.sum(h).reshape(u.shape));var f=u.square();return d.div(f.toFloat()).neg()}}},"FloorDiv")}}),Hf=L({maximum_:function(e,t){var n,r=R(e,"a","maximum"),a=R(t,"b","maximum");return n=it(r,a),r=n[0],a=n[1],r.dtype==="bool"&&(r=r.toInt(),a=a.toInt()),Pe(r.shape,a.shape),z.runKernelFunc(function(s,o){var l=s.maximum(r,a);return o([r,a]),l},{a:r,b:a},function(s,o){var l=o[0],c=o[1];return{a:function(){return s.mul(l.greaterEqual(c).toFloat())},b:function(){return s.mul(l.less(c).toFloat())}}},"Maximum")}}),P4=L({maximumStrict_:function(e,t){var n=R(e,"a","maximumStrict"),r=R(t,"b","maximumStrict");return Ue(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),zy=L({minimum_:function(e,t){var n,r=R(e,"a","minimum"),a=R(t,"b","minimum");return n=it(r,a),r=n[0],a=n[1],r.dtype==="bool"&&(r=r.toInt(),a=a.toInt()),Pe(r.shape,a.shape),z.runKernelFunc(function(s,o){var l=s.minimum(r,a);return o([r,a]),l},{a:r,b:a},function(s,o){var l=o[0],c=o[1];return{a:function(){return s.mul(l.lessEqual(c).toFloat())},b:function(){return s.mul(l.greater(c).toFloat())}}},"Minimum")}}),F4=L({minimumStrict_:function(e,t){var n=R(e,"a","minimumStrict"),r=R(t,"b","minimumStrict");return Ue(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),M4=L({mod_:function(e,t){var n,r=R(e,"a","mod"),a=R(t,"b","mod");n=it(r,a),r=n[0],a=n[1];var s=Pe(r.shape,a.shape);return z.runKernelFunc(function(o,l){var c=o.mod(r,a);return l([r,a]),c},{$a:r,$b:a},function(o,l){var c=l[0],u=l[1];return{$a:function(){var d=jt(c.shape,s);return d.length>0?o.sum(d).reshape(c.shape):o},$b:function(){var d=o.mul(c.div(u).floor().neg()),h=jt(u.shape,s);return h.length>0?d.sum(h).reshape(u.shape):d}}})}}),O4=L({modStrict_:function(e,t){var n=R(e,"a","modStrict"),r=R(t,"b","modStrict");return Ue(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Kt=L({mul_:function(e,t){var n,r=R(e,"a","mul"),a=R(t,"b","mul");n=it(r,a),r=n[0],a=n[1];var s=Pe(r.shape,a.shape);return z.runKernelFunc(function(o,l){var c=o.multiply(r,a);return l([r,a]),c},{a:r,b:a},function(o,l){var c=l[0],u=l[1];return{a:function(){var d=o.mul(u.toFloat()),h=jt(c.shape,s);return h.length>0?d.sum(h).reshape(c.shape):d},b:function(){var d=o.mul(c.toFloat()),h=jt(u.shape,s);return h.length>0?d.sum(h).reshape(u.shape):d}}},"Mul")}}),L4=L({mulStrict_:function(e,t){var n=R(e,"a","mul"),r=R(t,"b","mul");return Ue(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),pc=L({pow_:function(e,t){var n,r=R(e,"base","pow"),a=R(t,"exp","pow");n=it(r,a),r=n[0],a=n[1];var s=Pe(r.shape,a.shape),o=[r,a];return z.runKernelFunc(function(l,c){var u=l.pow(r,a);return c([r,a,u]),u},{a:r,b:a},function(l,c){var u=c[0],d=c[1],h=c[2];return{a:function(){var f=d.toFloat(),p=l.mul(f.mul(u.pow(f.sub(ce(1))))),m=jt(u.shape,s);return m.length>0&&(p=p.sum(m)),p.reshape(u.shape)},b:function(){var f=u.greater(0),p=u.log().where(f,Be(u)),m=l.mul(h.mul(p)),x=jt(d.shape,s);return x.length>0&&(m=m.sum(x)),m.reshape(d.shape)}}},"Pow",{},o,[!0])}}),B4=L({powStrict_:function(e,t){return Ue(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),$4=L({squaredDifferenceStrict_:function(e,t){var n=R(e,"a","squaredDifferenceStrict"),r=R(t,"b","squaredDifferenceStrict");return Ue(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),kt=L({sub_:function(e,t){var n,r=R(e,"a","sub"),a=R(t,"b","sub");n=it(r,a),r=n[0],a=n[1];var s=Pe(r.shape,a.shape);return z.runKernelFunc(function(o){return o.subtract(r,a)},{a:r,b:a},function(o){return{a:function(){var l=o,c=jt(r.shape,s);return c.length>0&&(l=l.sum(c)),l.reshape(r.shape)},b:function(){var l=o,c=jt(a.shape,s);return c.length>0&&(l=l.sum(c)),l.neg().reshape(a.shape)}}},"Sub")}}),W4=L({subStrict_:function(e,t){var n=R(e,"a","subStrict"),r=R(t,"b","subStrict");return Ue(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Uy=L({equal_:function(e,t){var n,r=R(e,"a","equal"),a=R(t,"b","equal");return n=it(r,a),r=n[0],a=n[1],Pe(r.shape,a.shape),z.runKernelFunc(function(s){return s.equal(r,a)},{$a:r,$b:a})}}),z4=L({equalStrict_:function(e,t){var n=R(e,"a","equalStrict"),r=R(t,"b","equalStrict");return Ue(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),U4=L({greater_:function(e,t){var n,r=R(e,"a","greater"),a=R(t,"b","greater");return n=it(r,a),r=n[0],a=n[1],Pe(r.shape,a.shape),z.runKernelFunc(function(s){return s.greater(r,a)},{a:r,b:a},null,"Greater")}}),Vy=L({greaterEqual_:function(e,t){var n,r=R(e,"a","greaterEqual"),a=R(t,"b","greaterEqual");return n=it(r,a),r=n[0],a=n[1],Pe(r.shape,a.shape),z.runKernelFunc(function(s,o){var l=s.greaterEqual(r,a);return o([r,a]),l},{a:r,b:a},function(s,o){var l=o[0],c=o[1];return{a:function(){return Be(l)},b:function(){return Be(c)}}},"GreaterEqual")}}),V4=L({greaterEqualStrict_:function(e,t){var n=R(e,"a","greaterEqualStrict"),r=R(t,"b","greaterEqualStrict");return Ue(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),q4=L({greaterStrict_:function(e,t){var n=R(e,"a","greaterStrict"),r=R(t,"b","greaterStrict");return Ue(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),H4=L({less_:function(e,t){var n,r=R(e,"a","less"),a=R(t,"b","less");return n=it(r,a),r=n[0],a=n[1],Pe(r.shape,a.shape),z.runKernelFunc(function(s){return s.less(r,a)},{a:r,b:a},null,"Less")}}),G4=L({lessEqual_:function(e,t){var n,r=R(e,"a","lessEqual"),a=R(t,"b","lessEqual");return n=it(r,a),r=n[0],a=n[1],Pe(r.shape,a.shape),z.runKernelFunc(function(s,o){var l=s.lessEqual(r,a);return o([r,a]),l},{a:r,b:a},null,"LessEqual")}}),K4=L({lessEqualStrict_:function(e,t){var n=R(e,"a","lessEqualStrict"),r=R(t,"b","lessEqualStrict");return Ue(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),X4=L({lessStrict_:function(e,t){var n=R(e,"a","lessStrict"),r=R(t,"b","lessStrict");return Ue(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Y4=L({notEqual_:function(e,t){var n,r=R(e,"a","notEqual"),a=R(t,"b","notEqual");return n=it(r,a),r=n[0],a=n[1],Pe(r.shape,a.shape),z.runKernelFunc(function(s){return s.notEqual(r,a)},{a:r,b:a},null,"NotEqual")}}),Q4=L({notEqualStrict_:function(e,t){var n=R(e,"a","notEqualStrict"),r=R(t,"b","notEqualStrict");return Ue(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Mg(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Og(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Gf=L({gather_:function(e,t,n){n===void 0&&(n=0);var r=R(e,"x","gather"),a=R(t,"indices","gather","int32");n=Ct(n,r.shape)[0];var s=function(o,l,c){for(var u=o.shape[c],d=[],h=1,f=1,p=0;p<c;p++)d.push(o.shape[p]),h*=o.shape[p];for(p=0;p<l.rank;p++)d.push(l.shape[p]);for(p=c+1;p<o.rank;p++)d.push(o.shape[p]),f*=o.shape[p];return{batchSize:h,sliceSize:f,dimSize:u,outputShape:d}}(r,a,n);return z.runKernelFunc(function(o,l){var c=o.gather(r,a.flatten(),n);return l([a]),c},{x:r,indices:a},function(o,l){var c=l[0];return{x:function(){var u=r.shape,d=c.size,h=u.slice(0,n),f=h.length,p=u.slice(n,u.length).slice(1),m=p.length,x=Mg(0,f),y=Mg(f+1,f+1+m),g=Og([h,[d],p]),v=o.reshape(g),w=c.reshape([d]),b=Og([[f],x,y]),N=v.transpose(b),_=qy(N,w,r.shape[n]),C=Tf(b);return _=_.transpose(C)},indices:function(){return c}}},"Gather",{axis:n}).reshape(s.outputShape)}}),qy=L({unsortedSegmentSum_:function(e,t,n){var r=R(e,"x","unsortedSegmentSum"),a=R(t,"segmentIds","unsortedSegmentSum","int32");return T(dt(n),function(){return"numSegments must be of dtype int"}),z.runKernelFunc(function(s,o){var l=s.unsortedSegmentSum(r,a,n);return o([a]),l},{$x:r},function(s,o){var l=o[0];return{$x:function(){return function(c,u){for(var d=Hf(u,Be(u)),h=Gf(c,d),f=Vy(u,ce(0,"int32")),p=h.rank-f.rank,m=0;m<p;++m)f=Rn(f,m+1);f=Uc(f,oo(h.shape,"bool"));var x=Be(h);return Ka(f,h,x)}(s,l)}}})}}),J4=function(e,t,n){return ge(this,void 0,void 0,function(){var r,a,s,o,l,c,u,d,h,f,p,m,x;return ve(this,function(y){switch(y.label){case 0:for(r=R(e,"tensor","boolMask"),a=R(t,"mask","boolMask","bool"),s=n??0,o=a.rank,l=r.shape,T(o>0,function(){return"mask cannot be scalar"}),Ue(l.slice(s,s+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,u=s;u<s+o;u++)c*=l[u];return d=l.slice(0,s).concat([c],l.slice(s+o)),h=r.reshape(d),f=a.reshape([-1]),[4,$y(f)];case 1:return p=y.sent(),m=p.squeeze([1]),x=Gf(h,m,s),e!==r&&r.dispose(),t!==a&&a.dispose(),m.dispose(),h.dispose(),f.dispose(),p.dispose(),[2,x]}})})};function Hy(e,t,n,r,a,s,o){s===void 0&&(s="NHWC"),T(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var l=e,c=t,u=!1;t.rank===3&&(u=!0,c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),l=[1,e[0],e[1],e[2]]),T(l.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+l.length+"."}),T(c.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank}),T(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var d=s==="NHWC"?l[3]:l[1],h=s==="NHWC"?c.shape[3]:c.shape[1];T(d===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+d+") must match input depth for filter "+n.shape[2]+"."}),T(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."}),o!=null&&T(dt(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var f=Lf(s),p=es(l,n.shape,r,1,a,o,!1,f),m=z.runKernelFunc(function(x,y){var g=x.conv2dDerInput(c,n,p);return y([n,c]),g},{dy4D:c,filter:n},function(x,y){var g=y[0],v=y[1];return{dy4D:function(){return On(x,g,r,a,s,1,o)},filter:function(){return Kf(x,v,g.shape,r,a,s,o)}}});return u?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function Hu(e){var t=function(s){return typeof s=="number"?[s,s,s]:s.length===2?[s[0],s[1],1]:s}(e),n=t[0],r=t[1],a=t[2];return n===1&&r===1&&a===1}function Gy(e,t,n,r,a){T(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,o=t,l=!1;t.rank===4&&(l=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),s=[1,e[0],e[1],e[2],e[3]]);var c=s[4],u=o.shape[4];T(s.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+s.length+"."}),T(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),T(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),T(c===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[3]+"."}),T(u===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+n.shape[4]+"."});var d=dc(s,n.shape,r,1,a),h=z.runKernelFunc(function(f){return f.conv3dDerInput(o,n,d)},{dy5D:o});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var Z4=L({conv1d_:function(e,t,n,r,a,s,o){a===void 0&&(a="NWC"),s===void 0&&(s=1);var l=R(e,"x","conv1d"),c=R(t,"filter","conv1d"),u=l,d=!1;l.rank===2&&(d=!0,u=l.as3D(1,l.shape[0],l.shape[1])),T(u.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."}),T(c.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."}),o!=null&&T(dt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}),T(u.shape[2]===c.shape[1],function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+c.shape[1]+"."}),T(hn(n,s),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+s+"'"}),T(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var h=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),f=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),p=On(f,h,[1,n],r,"NHWC",[1,s],o);return d?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),On=L({conv2d_:function(e,t,n,r,a,s,o){a===void 0&&(a="NHWC"),s===void 0&&(s=[1,1]);var l=R(e,"x","conv2d"),c=R(t,"filter","conv2d"),u=l,d=!1;l.rank===3&&(d=!0,u=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),T(u.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."}),T(c.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."}),o!=null&&T(dt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var h=a==="NHWC"?u.shape[3]:u.shape[1];T(h===c.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+c.shape[2]+"."}),T(hn(n,s),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"});var f=Lf(a),p=es(u.shape,c.shape,n,s,r,o,!1,f),m=[c,u],x=z.runKernelFunc(function(y,g){var v=y.conv2d(u,c,p);return g([c,u]),v},{x:u,filter:c},function(y,g){var v=g,w=v[0],b=v[1];return T(Js(s),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"}),{x:function(){return Ky(b.shape,y,w,n,r,a)},filter:function(){return Kf(b,y,w.shape,n,r,a)}}},"Conv2D",p,m);return d?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),eE=L({conv3d_:function(e,t,n,r,a,s){a===void 0&&(a="NDHWC"),s===void 0&&(s=[1,1,1]);var o=R(e,"x","conv3d"),l=R(t,"filter","conv3d"),c=o,u=!1;o.rank===4&&(u=!0,c=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),T(c.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),T(l.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+l.rank+"."}),T(c.shape[4]===l.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+l.shape[3]+"."}),T(function(f,p){return Hu(f)||Hu(p)}(n,s),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),T(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var d=dc(c.shape,l.shape,n,s,r),h=z.runKernelFunc(function(f,p){var m=f.conv3d(c,l,d);return p([c,l]),m},{x:c,$filter:l},function(f,p){T(Hu(s),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"});var m=p[0],x=p[1];return{x:function(){return Gy(m.shape,f,x,n,r)},$filter:function(){return function(y,g,v,w,b){var N=y;y.rank===4&&(N=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var _=g;_.rank===4&&(_=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),T(N.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+N.shape+"."}),T(_.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),T(v.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+v+"."}),T(N.shape[4]===v[3],function(){return"Error in conv3dDerFilter: depth of input "+N.shape[4]+") must match input depth in filter ("+v[3]+"."}),T(_.shape[4]===v[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+v[4]+")."});var C=dc(N.shape,v,w,1,b);return z.runKernelFunc(function(k){return k.conv3dDerFilter(N,_,C)},{x5D:N,dy5D:_})}(m,f,x.shape,n,r)}}});return u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Kf=L({conv2dDerFilter_:function(e,t,n,r,a,s,o){s===void 0&&(s="NHWC");var l=e;e.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var c=t;c.rank===3&&(c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),T(l.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+l.shape+"."}),T(c.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."}),T(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var u=s==="NHWC"?l.shape[3]:l.shape[1],d=s==="NHWC"?c.shape[3]:c.shape[1];T(u===n[2],function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+n[2]+"."}),T(d===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d+") must match output depth for filter ("+n[3]+")."}),o!=null&&T(dt(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var h=Lf(s),f=es(l.shape,n,r,1,a,o,!1,h);return z.runKernelFunc(function(p){return p.conv2dDerFilter(l,c,f)},{x4D:l,dy4D:c})}}),Ky=L({conv2dDerInput_:Hy}),Vc=L({depthwiseConv2d_:function(e,t,n,r,a,s,o){s===void 0&&(s=[1,1]);var l=R(e,"x","depthwiseConv2d"),c=R(t,"filter","depthwiseConv2d"),u=l,d=!1;l.rank===3&&(d=!0,u=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),T(u.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."}),T(c.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."}),T(u.shape[3]===c.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."}),s==null&&(s=[1,1]),T(hn(n,s),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),o!=null&&T(dt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var h=es(u.shape,c.shape,n,s,r,o,!0),f=[u,c],p=z.runKernelFunc(function(m,x){var y=m.depthwiseConv2D(u,c,h);return x([u,c]),y},{x:u,filter:c},function(m,x){T(Js(s),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"});var y=x[0],g=x[1];return{x:function(){return Xy(y.shape,m,g,h)},filter:function(){return Yy(y,m,g.shape,h)}}},"DepthwiseConv2dNative",h,f);return d?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),Xy=L({depthwiseConv2dDerInput_:function(e,t,n,r){var a=t,s=!1;t.rank===3&&(s=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=z.runKernelFunc(function(l){return l.depthwiseConv2DDerInput(a,n,r)},{dy4D:a});return s?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),Yy=L({depthwiseConv2dDerFilter_:function(e,t,n,r){var a=e;e.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=t;return s.rank===3&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),z.runKernelFunc(function(o){return o.depthwiseConv2DDerFilter(a,s,r)},{x4D:a,dy4D:s})}}),Xf=L({separableConv2d_:function(e,t,n,r,a,s,o){s===void 0&&(s=[1,1]),o===void 0&&(o="NHWC");var l=R(e,"x","separableConv2d"),c=R(t,"depthwiseFilter","separableConv2d"),u=R(n,"pointwiseFilter","separableConv2d"),d=l,h=!1;if(l.rank===3&&(h=!0,d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(d.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+d.rank+"."}),T(c.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."}),T(u.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."}),T(u.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."}),T(u.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."});var f=c.shape[2],p=c.shape[3];T(u.shape[2]===f*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*p+", but got "+u.shape[2]+"."});var m=Vc(d,c,r,a,o,s),x=On(m,u,1,"valid",o);return h?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),tE=L({conv2dTranspose_:function(e,t,n,r,a,s){return Hy(n,R(e,"x","conv2dTranspose"),R(t,"filter","conv2dTranspose"),r,a,"NHWC",s)}}),nE=L({conv3dTranspose_:function(e,t,n,r,a){return Gy(n,R(e,"x","conv3dTranspose"),R(t,"filter","conv3dTranspose"),r,a)}}),qc=L({matMul_:function(e,t,n,r){var a;n===void 0&&(n=!1),r===void 0&&(r=!1);var s=R(e,"a","matMul"),o=R(t,"b","matMul");a=it(s,o),s=a[0],o=a[1];var l=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],u=n?s.shape[s.rank-1]:s.shape[s.rank-2],d=r?o.shape[o.rank-2]:o.shape[o.rank-1],h=s.shape.slice(0,-2),f=o.shape.slice(0,-2),p=xe(h),m=xe(f);T(s.rank>=2&&o.rank>=2&&s.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+o.rank+"."}),T(It(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+s.shape+" and "+o.shape+" must match."}),T(l===c,function(){return"Error in matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var x=s.shape.slice(0,-2).concat([u,d]),y=n?s.as3D(p,l,u):s.as3D(p,u,l),g=r?o.as3D(m,d,c):o.as3D(m,c,d),v={transposeA:n,transposeB:r};return z.runKernelFunc(function(w,b){var N=w.batchMatMul(y,g,n,r);return b([y,g]),N},{a:y,b:g},function(w,b){var N=b,_=N[0],C=N[1];return n||r?!n&&r?{a:function(){return w.matMul(C,!1,!1)},b:function(){return w.matMul(_,!0,!1)}}:n&&!r?{a:function(){return C.matMul(w,!1,!0)},b:function(){return _.matMul(w,!1,!1)}}:{a:function(){return C.matMul(w,!0,!0)},b:function(){return w.matMul(_,!0,!0)}}:{a:function(){return w.matMul(C,!1,!0)},b:function(){return _.matMul(w,!0,!1)}}},"BatchMatMul",v).reshape(x)}}),rE=L({dot_:function(e,t){var n=R(e,"t1","dot"),r=R(t,"t2","dot");T(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var a=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];return T(a===s,function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+s+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),aE=L({outerProduct_:function(e,t){var n=R(e,"v1","outerProduct"),r=R(t,"v2","outerProduct");return T(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Si=L({reverse_:function(e,t){var n=R(e,"x","reverse");if(n.rank===0)return n.clone();var r=Ct(t,n.shape);return z.runKernelFunc(function(a){return a.reverse(n,r)},{$x:n},function(a){return{$x:function(){return a.reverse(r)}}}).reshapeAs(n)}}),sE=L({reverse1d_:function(e){var t=R(e,"x","reverse");return T(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Si(t,0)}}),oE=L({reverse2d_:function(e,t){var n=R(e,"x","reverse");return T(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Si(n,t)}}),iE=L({reverse3d_:function(e,t){var n=R(e,"x","reverse");return T(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Si(n,t)}}),lE=L({reverse4d_:function(e,t){var n=R(e,"x","reverse");return T(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Si(n,t)}});function Qy(e,t,n,r,a,s){var o=R(e,"x","maxPool"),l=o,c=!1;o.rank===3&&(c=!0,l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),r==null&&(r=[1,1]),T(l.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+l.rank+"."}),T(hn(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),s!=null&&T(dt(a),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var u=fi(l.shape,t,n,r,a,s);if(u.filterWidth===1&&u.filterHeight===1&&It(u.inShape,u.outShape))return o.clone();var d=[l],h=z.runKernelFunc(function(f,p){var m=f.maxPool(l,u);return p([l,m]),m},{x:l},function(f,p){var m=p[0],x=p[1];return{x:function(){return function(y,g,v,w,b,N,_,C){var k=R(y,"dy","maxPoolBackprop"),j=R(g,"input","maxPoolBackprop"),S=R(v,"output","maxPoolBackprop");T(j.rank===k.rank,function(){return"Rank of input ("+j.rank+") does not match rank of dy ("+k.rank+")"}),N==null&&(N=[1,1]),T(hn(b,N),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+N+"'"}),T(k.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),T(j.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+j.rank+"."}),C!=null&&T(dt(_),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+C+" but got pad "+_+"."});var M=fi(j.shape,w,b,N,_,C);return z.runKernelFunc(function(D){return D.maxPoolBackprop(k,j,S,M)},{$dy:k,$input:j})}(f,m,x,t,n,r,a)}}},"MaxPool",u,d);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Jy(e,t,n,r,a,s){var o=R(e,"x","avgPool","float32");r==null&&(r=[1,1]),T(hn(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var l=o,c=!1;o.rank===3&&(c=!0,l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),T(l.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+l.rank+"."}),s!=null&&T(dt(a),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var u=fi(l.shape,t,n,r,a,s);if(u.filterWidth===1&&u.filterHeight===1&&It(u.inShape,u.outShape))return o.clone();var d=z.runKernelFunc(function(h){return h.avgPool(l,u)},{x:l},function(h){return{x:function(){return function(f,p,m,x,y,g){var v=R(f,"dy","avgPoolBackprop"),w=R(p,"input","avgPoolBackprop");T(w.rank===v.rank,function(){return"Rank of input ("+w.rank+") does not match rank of dy ("+v.rank+")"}),y==null&&(y=[1,1]),T(hn(x,y),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+x+" and dilations '"+y+"'"});var b=w,N=v,_=!1;w.rank===3&&(_=!0,b=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),N=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),T(N.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+N.rank+"."}),T(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var C=fi(b.shape,m,x,y,g),k=z.runKernelFunc(function(j){return j.avgPoolBackprop(N,b,C)},{dy4D:N,input4D:b});return _?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}(h,l,t,n,r,a)}}},"AvgPool",u);return d=d.cast(o.dtype),c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}var Et=L({maxPool_:function(e,t,n,r,a){return Qy(e,t,n,1,r,a)}}),Ei=L({avgPool_:function(e,t,n,r,a){return Jy(e,t,n,1,r,a)}}),cE=L({pool_:function(e,t,n,r,a,s){a==null&&(a=[1,1]),s==null&&(s=1),r===0&&(r="valid");var o=R(e,"x","maxPool"),l=o,c=!1;o.rank===3&&(c=!0,l=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),T(hn(s,a),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+a+"'"});var u,d=fi(l.shape,t,s,a,r),h=[d.dilationHeight,d.dilationWidth];u=r==="same"?function(b,N){var _=b.map(function(j,S){return j+(j-1)*(N[S]-1)}).map(function(j){return j-1}),C=_.map(function(j){return Math.floor(j/2)}),k=_.map(function(j,S){return j-C[S]});return _.map(function(j,S){return[C[S],k[S]]})}([d.filterHeight,d.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,p=function(b,N,_){var C=_.map(function(B){return B[0]}),k=_.map(function(B){return B[1]}),j=b.concat(C,k),S=N.map(function(B,F){return(B-j[F]%B)%B}),M=k.map(function(B,F){return B+S[F]}),D=N.map(function(B,F){return[C[F],M[F]]}),A=N.map(function(B,F){return[0,S[F]]});return[D,A]}([d.inHeight,d.inWidth],h,u),m=p[0],x=p[1],y=f?r:"valid",g=f?l:ay(l,h,m),v=(n==="avg"?function(){return Jy(g,t,s,1,y)}:function(){return Qy(g,t,s,1,y)})(),w=f?v:ty(v,h,x);return c?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),uE=L({maxPool3d_:function(e,t,n,r,a,s,o){s===void 0&&(s="NDHWC");var l=R(e,"x","maxPool3d"),c=l,u=!1;l.rank===4&&(u=!0,c=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),o==null&&(o=[1,1,1]),T(c.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."}),T(s==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+s}),T(hn(n,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),a!=null&&T(dt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=uc(c.shape,t,n,o,r,a,s),h=z.runKernelFunc(function(f,p){var m=f.maxPool3d(c,d);return p([c,m]),m},{x:c},function(f,p){var m=p[0],x=p[1];return{x:function(){return function(y,g,v,w,b,N,_,C){var k=R(y,"dy","maxPool3dBackprop"),j=R(g,"input","maxPool3dBackprop"),S=R(v,"output","maxPool3dBackprop"),M=k,D=j,A=S,B=!1;j.rank===4&&(B=!0,M=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),D=j.as5D(1,j.shape[0],j.shape[1],j.shape[2],j.shape[3]),A=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),T(M.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+M.rank+"."}),T(D.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+D.rank+"."}),T(A.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+A.rank+"."}),N==null&&(N=[1,1,1]),T(hn(b,N),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+N+"'"}),C!=null&&T(dt(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+C+" but got pad "+_+"."});var F=uc(D.shape,w,b,N,_,C),U=z.runKernelFunc(function(V){return V.maxPool3dBackprop(M,D,A,F)},{dy5D:M,input5D:D});return B?U.as4D(U.shape[1],U.shape[2],U.shape[3],U.shape[4]):U}(f,m,x,t,n,o,r,a)}}});return u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),dE=L({avgPool3d_:function(e,t,n,r,a,s,o){s===void 0&&(s="NDHWC");var l=R(e,"x","avgPool3d","float32"),c=l,u=!1;l.rank===4&&(u=!0,c=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),o==null&&(o=[1,1,1]),T(c.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."}),T(s==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+s}),T(hn(n,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),a!=null&&T(dt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=uc(c.shape,t,n,o,r,a,s),h=z.runKernelFunc(function(f){return f.avgPool3d(c,d)},{x:c},function(f){return{x:function(){return function(p,m,x,y,g,v,w){var b=R(p,"dy","avgPool3dBackprop"),N=R(m,"input","avgPool3dBackprop"),_=b,C=N,k=!1;N.rank===4&&(k=!0,_=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),C=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),T(_.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),T(C.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+C.rank+"."}),g==null&&(g=[1,1,1]),T(hn(y,g),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+g+"'"}),w!=null&&T(dt(v),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+v+"."});var j=uc(C.shape,x,y,g,v,w),S=z.runKernelFunc(function(M){return M.avgPool3dBackprop(_,C,j)},{dy5D:_,input5D:C});return k?S.as4D(S.shape[1],S.shape[2],S.shape[3],S.shape[4]):S}(f,c,t,n,o,r,a)}}});return h=h.cast(c.dtype),u?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),pr=L({slice_:function(e,t,n){var r,a,s=R(e,"x","slice");if(s.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(s.rank-1).fill(0)):t.length<s.rank?t.concat(new Array(s.rank-t.length).fill(0)):t.slice()).forEach(function(c){T(c!==-1,function(){return"slice() does not support negative begin indexing."})}),a=(a=n==null?new Array(s.rank).fill(-1):typeof n=="number"?[n].concat(new Array(s.rank-1).fill(-1)):n.length<s.rank?n.concat(new Array(s.rank-n.length).fill(-1)):n).map(function(c,u){return c>=0?c:(T(c===-1,function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+u+"."}),s.shape[u]-r[u])}),Bk(s,r,a);var o=s.shape,l={begin:r,size:a};return z.runKernelFunc(function(c){return c.slice(s,r,a)},{x:s},function(c){for(var u=[],d=0;d<c.rank;d++)u.push([r[d],o[d]-r[d]-a[d]]);return{x:function(){return c.pad(u)}}},"Slice",l)}}),hE=L({slice1d_:function(e,t,n){var r=R(e,"x","slice1d");return T(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),pr(r,[t],[n])}}),fE=L({slice2d_:function(e,t,n){var r=R(e,"x","slice2d");return T(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),pr(r,t,n)}}),Zy=L({slice3d_:function(e,t,n){var r=R(e,"x","slice3d");return T(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),pr(r,t,n)}}),pE=L({slice4d_:function(e,t,n){var r=R(e,"x","slice4d");return T(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),pr(r,t,n)}});function eb(e,t,n,r,a){return t.rank<n.rank&&(t=t.reshape(dn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(dn(e.shape,r))),{x:function(){var s=e.mul(n.equal(t).cast(e.dtype));return a==null?s:s.transpose(a)}}}var mE=L({all_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","all","bool"),a=Ct(t,r.shape),s=a,o=gr(s,r.rank);o!=null&&(r=r.transpose(o),s=vr(s.length,r.rank));var l=z.runKernelFunc(function(u){return u.all(r,s)},{$x:r});if(n){var c=dn(l.shape,a);return l.reshape(c)}return l}}),gE=L({any_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","any","bool"),a=Ct(t,r.shape),s=a,o=gr(s,r.rank);o!=null&&(r=r.transpose(o),s=vr(s.length,r.rank));var l=z.runKernelFunc(function(u){return u.any(r,s)},{$x:r});if(n){var c=dn(l.shape,a);return l.reshape(c)}return l}}),vE=L({argMax_:function(e,t){t===void 0&&(t=0);var n=R(e,"x","argMax");t==null&&(t=0);var r=Ct(t,n.shape),a=gr(r,n.rank);a!=null&&(n=n.transpose(a),r=vr(r.length,n.rank));var s={axis:r[0]},o=[n];return z.runKernelFunc(function(l,c){var u=l.argMax(n,r[0]);return c([n]),u},{x:n},function(l,c){var u=c[0];return{x:function(){return Be(u)}}},"ArgMax",s,o)}}),xE=L({argMin_:function(e,t){t===void 0&&(t=0);var n=R(e,"x","argMin");t==null&&(t=0);var r=Ct(t,n.shape),a=gr(r,n.rank);return a!=null&&(n=n.transpose(a),r=vr(r.length,n.rank)),z.runKernelFunc(function(s,o){var l=s.argMin(n,r[0]);return o([n]),l},{$x:n},function(s,o){var l=o[0];return{$x:function(){return Be(l)}}})}}),yE=L({logSumExp_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","logSumExp"),a=Ct(t,r.shape),s=r.max(a,!0),o=r.sub(s).exp().sum(a).log(),l=s.reshape(o.shape).add(o);if(n){var c=dn(l.shape,a);return l.reshape(c)}return l}}),Hc=L({max_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","max"),a=r,s=Ct(t,r.shape),o=s,l=gr(o,r.rank);l!=null&&(r=r.transpose(l),o=vr(o.length,r.rank));var c=[r],u=z.runKernelFunc(function(h,f){var p=h.max(r,o);return f([a,p]),p},{x:r},function(h,f){return eb(h,f[1],f[0],s,l)},"Max",{axes:o},c,[!0]);if(n){var d=dn(u.shape,s);u=u.reshape(d)}return u}}),bE=L({mean_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","mean"),a=Ct(t,r.shape),s=xe(Ut(r.shape,a)[1]);return Wc(function(o){var l=ce(s);return{value:(l.dtype===o.dtype?o:o.cast(l.dtype)).div(l).sum(t,n),gradFunc:function(c){var u=o.shape.slice();return a.forEach(function(d){u[d]=1}),c.reshape(u).mul(oo(o.shape,"float32")).div(s)}}})(r)}}),wE=L({min_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","min"),a=r,s=Ct(t,r.shape),o=s,l=gr(o,r.rank);l!=null&&(r=r.transpose(l),o=vr(o.length,r.rank));var c=[r],u=z.runKernelFunc(function(h,f){var p=h.min(r,o);return f([a,p]),p},{x:r},function(h,f){return eb(h,f[1],f[0],s,l)},"Min",{axes:o},c,[!0]);if(n){var d=dn(u.shape,s);u=u.reshape(d)}return u}}),NE=L({moments_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=Ct(t,(e=R(e,"x","moments")).shape),a=e.mean(r,n),s=a.shape;n||(s=dn(a.shape,r));var o=e.toFloat().sub(a.reshape(s)).square();return{mean:a,variance:o.mean(r,n)}}}),tb=L({sum_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var a=Ct(t,r.shape);return Wc(function(s){var o=gr(a,s.rank),l=a,c=s;o!=null&&(c=s.transpose(o),l=vr(l.length,s.rank));var u=function(p){var m=s.shape.slice();return a.forEach(function(x){m[x]=1}),p.reshape(m).mul(oo(s.shape,"float32"))},d={axes:l},h=z.runKernelFunc(function(p){return p.sum(c,l)},{x:c},function(p){return{x:function(){return u(p)}}},"Sum",d);if(n){var f=dn(h.shape,a);h=h.reshape(f)}return{value:h,gradFunc:u}})(r)}}),_E=L({prod_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=R(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var a=Ct(t,r.shape),s=gr(a,r.rank),o=a,l=r;s!=null&&(l=r.transpose(s),o=vr(o.length,r.rank));var c=z.runKernelFunc(function(d){return d.prod(l,o)},{permutedX:l});if(n){var u=dn(c.shape,a);c=c.reshape(u)}return c}}),nb=L({elu_:function(e){var t=R(e,"x","elu");return z.runKernelFunc(function(n,r){var a=n.elu(t);return r([a]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){return z.runKernelFunc(function(s){return s.eluDer(n,a)},{dy:n,y:a})}}})}}),jE=L({leakyRelu_:function(e,t){t===void 0&&(t=.2);var n=R(e,"x","leakyRelu");return Hf(ce(t).mul(n),n)}}),rb=L({prelu_:function(e,t){var n=R(e,"x","prelu"),r=R(t,"alpha","prelu");return z.runKernelFunc(function(a,s){var o=a.prelu(n,r);return s([n,r]),o},{x:n,alpha:r},function(a,s){var o=s[0],l=s[1],c=o.greater(0);return{x:function(){return Ka(c,a,a.mul(l))},alpha:function(){var u=Ka(c,Be(a),a.mul(o)),d=jt(l.shape,a.shape);return d.length>0&&(u=u.sum(d)),u.reshape(l.shape)}}},"Prelu")}}),at=L({relu_:function(e){var t=R(e,"x","relu");return t.dtype==="bool"?t.toInt():z.runKernelFunc(function(n,r){var a=n.relu(t);return r([t]),a},{x:t},function(n,r){var a=r[0];return{x:function(){return n.mulStrict(a.step().toFloat())}}},"Relu")}}),ab=L({relu6_:function(e){var t=R(e,"x","relu6");return t.dtype==="bool"?t.toInt():z.runKernelFunc(function(n,r){var a=n.relu6(t);return r([t]),a},{x:t},function(n,r){var a=r[0],s=a.lessEqual(6).mul(a.step());return{x:function(){return n.mulStrict(s.toFloat())}}},"Relu6")}}),kE=L({selu_:function(e){var t=R(e,"x","selu");return z.runKernelFunc(function(n,r){var a=n.selu(t);return r([t]),a},{$x:t},function(n,r){var a=r[0];return{$x:function(){var s=a.greater(ce(0)),o=ce(Uf),l=ce(Vf),c=n.mul(l),u=n.mul(o).mul(a.toFloat().exp());return Ka(s,c,u)}}})}}),ma=L({transpose_:function(e,t){var n=R(e,"x","transpose");if(t==null&&(t=n.shape.map(function(a,s){return s}).reverse()),T(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(a){T(a>=0&&a<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return z.runKernelFunc(function(a){return a.transpose(n,t)},{x:n},function(a){var s=Tf(t);return{x:function(){return a.transpose(s)}}},"Transpose",r)}}),CE=L({localResponseNormalization_:function(e,t,n,r,a){t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),a===void 0&&(a=.5);var s=R(e,"x","localResponseNormalization");T(s.rank===4||s.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+s.rank+"."}),T(dt(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var o=s,l=!1;s.rank===3&&(l=!0,o=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]));var c=z.runKernelFunc(function(u,d){var h=u.localResponseNormalization4D(o,t,n,r,a);return d([o,h]),h},{x4D:o},function(u,d){var h=d[0],f=d[1];return{x4D:function(){return z.runKernelFunc(function(p){return p.LRNGrad(u,h,f,t,n,r,a)},{})}}});return l?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),sb=L({norm_:function(e,t,n,r){t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var a=function l(c,u,d){if(d===void 0&&(d=null),c.rank===0)return c.abs();if(c.rank!==1&&d===null)return l(c.reshape([-1]),u,d);if(c.rank===1||typeof d=="number"||Array.isArray(d)&&d.length===1){if(u===1)return c.abs().sum(d);if(u===1/0)return c.abs().max(d);if(u===-1/0)return c.abs().min(d);if(u==="euclidean"||u===2)return c.abs().pow(ce(2,"int32")).sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}if(Array.isArray(d)&&d.length===2){if(u===1)return c.abs().sum(d[0]).max(d[1]-1);if(u===1/0)return c.abs().sum(d[1]).max(d[0]);if(u===-1/0)return c.abs().sum(d[1]).min(d[0]);if(u==="fro"||u==="euclidean")return c.square().sum(d).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}throw new Error("Error in norm: invalid axis: "+d)}(e=R(e,"x","norm"),t,n),s=a.shape;if(r){var o=Ct(n,e.shape);s=dn(a.shape,o)}return a.reshape(s)}}),SE=L({basicLSTMCell_:function(e,t,n,r,a,s){var o=R(e,"forgetBias","basicLSTMCell"),l=R(t,"lstmKernel","basicLSTMCell"),c=R(n,"lstmBias","basicLSTMCell"),u=R(r,"data","basicLSTMCell"),d=R(a,"c","basicLSTMCell"),h=R(s,"h","basicLSTMCell"),f=u.concat(h,1).matMul(l).add(c),p=f.shape[0],m=f.shape[1]/4,x=[p,m],y=f.slice([0,0],x),g=f.slice([0,m],x),v=f.slice([0,2*m],x),w=f.slice([0,3*m],x),b=y.sigmoid().mulStrict(g.tanh()).addStrict(d.mulStrict(o.add(v).sigmoid())),N=b.tanh().mulStrict(w.sigmoid());return[b,N]}}),EE=L({multiRNNCell_:function(e,t,n,r){for(var a=R(t,"data","multiRNNCell"),s=ac(n,"c","multiRNNCell"),o=ac(r,"h","multiRNNCell"),l=a,c=[],u=0;u<e.length;u++){var d=e[u](l,s[u],o[u]);c.push(d[0]),c.push(d[1]),l=d[1]}var h=[],f=[];for(u=0;u<c.length;u+=2)h.push(c[u]),f.push(c[u+1]);return[h,f]}}),RE=L({movingAverage_:function(e,t,n,r,a){a===void 0&&(a=!0);var s=R(e,"v","movingAverage"),o=R(t,"x","movingAverage"),l=R(n,"decay","movingAverage");Cj(s,o),T(It(s.shape,o.shape),function(){return"Shape mismatch in v and x"});var c=ce(1),u=c.sub(l),d=o.sub(s).mul(u);if(a){T(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=R(r,"step","movingAverage");d=d.div(c.sub(pc(l,h)))}return s.add(d)}}),DE=L({stridedSlice_:function(e,t,n,r,a,s,o,l,c){if(a===void 0&&(a=0),s===void 0&&(s=0),o===void 0&&(o=0),l===void 0&&(l=0),c===void 0&&(c=0),r==null&&(r=new Array(t.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var u=R(e,"x","stridedSlice"),d=gg(l),h=u.shape.slice();d.forEach(function(y){t[y]=0,n[y]=1,h.splice(y,0,1)}),u=u.reshape(h);for(var f=0;f<u.rank;f++)t[f]=$k(a,t,r,u.shape,f),n[f]=Wk(s,n,r,u.shape,f),r[f]=r[f]||1;var p=gg(c);p.forEach(function(y){n[y]=t[y]+1,r[y]=1});var m=Of(t,n,r),x=m.filter(function(y,g){return p.indexOf(g)===-1});return r.every(function(y){return y===1})?pr(u,t,m).reshape(x):z.runKernelFunc(function(y){return y.stridedSlice(u,t,n,r)},{$x:u}).reshape(x)}}),IE=L({topk_:function(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!0);var r=R(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var s=z.runKernelFunc(function(o){return o.topk(r,t,n)},{$x:r});return{values:s[0],indices:s[1]}}}),AE=L({scatterND_:function(e,t,n){var r=R(e,"indices","scatterND","int32"),a=R(t,"updates","scatterND");return Lk(a,r,n),z.runKernelFunc(function(s){return s.scatterND(r,a,n)},{indices:r,updates:a},null,"ScatterNd",{shape:n})}}),Yf=L({fft_:function(e){T(e.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return z.runKernelFunc(function(a){return a.fft(r)},{input:e}).reshape(e.shape)}}),mc=L({ifft_:function(e){T(e.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return z.runKernelFunc(function(a){return a.ifft(r)},{input:e}).reshape(e.shape)}}),Qf=L({rfft_:function(e,t){T(e.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],a=e.size/r;if(t!=null&&t<r){var s=e.shape.map(function(g){return 0}),o=e.shape.map(function(g){return g});o[e.shape.length-1]=t,n=e.slice(s,o),r=t}else if(t!=null&&t>r){var l=e.shape.map(function(g){return g});l[e.shape.length-1]=t-r,n=e.concat(Je(l),e.shape.length-1),r=t}else n=e;var c=n.zerosLike(),u=Ft(n,c).as2D(a,r),d=Yf(u),h=Math.floor(r/2)+1,f=Dn(d),p=ir(d),m=f.split([h,r-h],f.shape.length-1),x=p.split([h,r-h],p.shape.length-1),y=n.shape.slice();return y[n.shape.length-1]=h,Ft(m[0],x[0]).reshape(y)}}),ob=L({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),a=mc(r);return Dn(a)}var s=[n,2*(t-1)],o=Dn(e).as2D(n,t),l=ir(e).as2D(n,t),c=o.slice([0,1],[n,t-2]).reverse(1),u=l.slice([0,1],[n,t-2]).reverse(1).mul(ce(-1)),d=o.concat(c,1),h=l.concat(u,1);return r=Ft(d,h).as2D(s[0],s[1]),a=mc(r),Dn(a)}}),TE=Object.freeze({fft:Yf,ifft:mc,rfft:Qf,irfft:ob}),PE=L({sparseToDense_:function(e,t,n,r){r===void 0&&(r=0);var a=R(e,"sparseIndices","sparseToDense","int32"),s=R(t,"sparseValues","sparseToDense"),o=R(r,"defaultValue","sparseToDense",s.dtype);return function(l,c,u,d){if(l.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+l.dtype+".");if(l.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+l.shape+".");var h=l.rank>0?l.shape[0]:1,f=l.rank>1?l.shape[1]:1;if(u.length!==f)throw new Error("outputShape has incorrect number of elements:, "+u.length+", should be: "+f+".");var p=c.size;if(c.rank!==0&&(c.rank!==1||p!==h))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+h+"]");if(c.dtype!==d.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,s,n,o),z.runKernelFunc(function(l){return l.sparseToDense(a,s,n,o)},{$sparseIndices:a,$sparseValues:s,$defaultValue:o})}}),FE=L({gatherND_:function(e,t){var n=R(t,"indices","gatherND","int32"),r=R(e,"x","gatherND");return z.runKernelFunc(function(a){return a.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),ME=L({diag_:function(e){var t=R(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return z.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(n)}}),OE=L({dropout_:function(e,t,n,r){var a=R(e,"x","dropout");if(T(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."}),T(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return e instanceof rt?a.clone():a;var s=function(c,u){if(u==null)return c.shape.slice();if(It(c.shape,u))return u;if(c.shape.length===u.length){for(var d=[],h=0;h<c.shape.length;h++)u[h]==null&&c.shape[h]!=null?d.push(c.shape[h]):d.push(u[h]);return d}return u}(a,n),o=1-t,l=ry(s,0,1,"float32",r).add(o).floor().div(o);return a.mul(l)}});function ib(e,t,n){for(var r=1-e%2,a=new Float32Array(e),s=0;s<e;++s){var o=2*Math.PI*s/(e+r-1);a[s]=t-n*Math.cos(o)}return gt(a,"float32")}var Jf=L({hannWindow_:function(e){return ib(e,.5,.5)}}),lb=L({hammingWindow_:function(e){return ib(e,.54,.46)}}),Zf=L({frame_:function(e,t,n,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var s=0,o=[];s+t<=e.size;)o.push(pr(e,s,t)),s+=n;if(r)for(;s<e.size;){var l=s+t-e.size,c=Nt([pr(e,s,t-l),fr([l],a)]);o.push(c),s+=n}return o.length===0?ua([],[0,t]):Nt(o).as2D(o.length,t)}}),cb=L({stft_:function(e,t,n,r,a){var s;a===void 0&&(a=Jf),r==null&&(s=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(s)/Math.log(2)))));for(var o=Zf(e,t,n),l=Kt(o,a(t)),c=[],u=0;u<o.shape[0];u++)c.push(Qf(l.slice([u,0],[1,t]),r));return Nt(c)}}),LE=Object.freeze({hannWindow:Jf,hammingWindow:lb,frame:Zf,stft:cb}),Gt,BE=function(e,t,n){return n===void 0&&(n=1),ge(this,void 0,void 0,function(){var r,a,s,o,l,c,u,d,h,f,p,m,x,y;return ve(this,function(g){switch(g.label){case 0:return r=R(e,"predictions","inTopK"),a=R(t,"targets","inTopK"),T(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),T(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+a.rank}),Ue(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),s=r.shape[r.shape.length-1],T(n>0&&n<=s,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+s+"), but got "+n}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(l=g.sent(),c=[o.length/s,s],d=c[1],h=ui("bool",u=c[0]),f=0;f<u;f++){for(p=f*d,m=o.subarray(p,p+d),x=[],y=0;y<m.length;y++)x.push({value:m[y],index:y});for(x.sort(function(v,w){return w.value-v.value}),h[f]=0,y=0;y<n;y++)if(x[y].index===l[f]){h[f]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),[2,Ot(h,a.shape,"bool")]}})})};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Gt||(Gt={}));var $E=L({absoluteDifference_:function(e,t,n,r){r===void 0&&(r=Gt.SUM_BY_NONZERO_WEIGHTS);var a=R(e,"labels","absoluteDifference"),s=R(t,"predictions","absoluteDifference"),o=null;n!=null&&(o=R(n,"weights","absoluteDifference")),Ue(a.shape,s.shape,"Error in absoluteDifference: ");var l=a.sub(s).abs();return Or(l,o,r)}}),Or=L({computeWeightedLoss_:function(e,t,n){n===void 0&&(n=Gt.SUM_BY_NONZERO_WEIGHTS);var r=R(e,"losses","computeWeightedLoss"),a=null;t!=null&&(a=R(t,"weights","computeWeightedLoss"));var s=a==null?r:r.mul(a);if(n===Gt.NONE)return s;if(n===Gt.SUM)return s.sum();if(n===Gt.MEAN){if(a==null)return s.mean();var o=r.size/a.size,l=s.sum().div(a.sum());return o>1?l.div(ce(o)):l}if(n===Gt.SUM_BY_NONZERO_WEIGHTS){if(a==null)return s.sum().div(ce(r.size));var c=a.mul(oo(r.shape)).notEqual(ce(0)).sum().toFloat();return s.sum().div(c)}throw Error("Unknown reduction: "+n)}}),WE=L({cosineDistance_:function(e,t,n,r,a){a===void 0&&(a=Gt.SUM_BY_NONZERO_WEIGHTS);var s=R(e,"labels","cosineDistance"),o=R(t,"predictions","cosineDistance"),l=null;r!=null&&(l=R(r,"weights","cosineDistance")),Ue(s.shape,o.shape,"Error in cosineDistance: ");var c=ce(1).sub(s.mul(o).sum(n,!0));return Or(c,l,a)}}),zE=L({hingeLoss_:function(e,t,n,r){r===void 0&&(r=Gt.SUM_BY_NONZERO_WEIGHTS);var a=R(e,"labels","hingeLoss"),s=R(t,"predictions","hingeLoss"),o=null;n!=null&&(o=R(n,"weights","hingeLoss")),Ue(a.shape,s.shape,"Error in hingeLoss: ");var l=ce(1);a=ce(2).mul(a).sub(l);var c=l.sub(a.mul(s)).relu();return Or(c,o,r)}}),UE=L({huberLoss_:function(e,t,n,r,a){r===void 0&&(r=1),a===void 0&&(a=Gt.SUM_BY_NONZERO_WEIGHTS);var s=R(e,"labels","huberLoss"),o=R(t,"predictions","huberLoss"),l=null;n!=null&&(l=R(n,"weights","huberLoss")),Ue(s.shape,o.shape,"Error in huberLoss: ");var c=ce(r),u=o.sub(s).abs(),d=zy(u,c),h=u.sub(d),f=ce(.5).mul(d.square()).add(c.mul(h));return Or(f,l,a)}}),VE=L({logLoss_:function(e,t,n,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=Gt.SUM_BY_NONZERO_WEIGHTS);var s=R(e,"labels","logLoss"),o=R(t,"predictions","logLoss"),l=null;n!=null&&(l=R(n,"weights","logLoss")),Ue(s.shape,o.shape,"Error in logLoss: ");var c=ce(1),u=ce(r),d=s.mul(o.add(u).log()).neg().sub(c.sub(s).mul(c.sub(o).add(u).log()));return Or(d,l,a)}}),qE=L({meanSquaredError_:function(e,t,n,r){r===void 0&&(r=Gt.SUM_BY_NONZERO_WEIGHTS);var a=R(e,"labels","meanSquaredError"),s=R(t,"predictions","meanSquaredError"),o=null;n!=null&&(o=R(n,"weights","meanSquaredError")),Ue(a.shape,s.shape,"Error in meanSquaredError: ");var l=a.squaredDifference(s);return Or(l,o,r)}}),HE=L({sigmoidCrossEntropy_:function(e,t,n,r,a){r===void 0&&(r=0),a===void 0&&(a=Gt.SUM_BY_NONZERO_WEIGHTS);var s=R(e,"multiClassLabels","sigmoidCrossEntropy"),o=R(t,"logits","sigmoidCrossEntropy"),l=null;if(n!=null&&(l=R(n,"weights","sigmoidCrossEntropy")),Ue(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=ce(r),u=ce(1),d=ce(.5);s=s.mul(u.sub(c)).add(d.mul(c))}var h=function(f,p){var m=R(f,"labels","sigmoidCrossEntropyWithLogits"),x=R(p,"logits","sigmoidCrossEntropyWithLogits");Ue(m.shape,x.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=x.relu(),g=x.mul(m),v=x.abs().neg().exp().log1p();return y.sub(g).add(v)}(s,o);return Or(h,l,a)}}),GE=L({softmaxCrossEntropy_:function(e,t,n,r,a){r===void 0&&(r=0),a===void 0&&(a=Gt.SUM_BY_NONZERO_WEIGHTS);var s=R(e,"onehotLabels","softmaxCrossEntropy"),o=R(t,"logits","softmaxCrossEntropy"),l=null;if(n!=null&&(l=R(n,"weights","softmaxCrossEntropy")),Ue(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=ce(r),u=ce(1),d=ce(s.shape[1]);s=s.mul(u.sub(c)).add(c.div(d))}var h=function(f,p,m){if(m===void 0&&(m=-1),m===-1&&(m=p.rank-1),m!==p.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+p.rank+" and dim was "+m);return Wc(function(x,y,g){var v=y.logSumExp([m],!0),w=y.toFloat().sub(v);return g([x,w]),{value:w.mul(x).neg().sum([m]),gradFunc:function(b,N){var _=N[0],C=N[1],k=dn(b.shape,[m]);return[b.reshape(k).mul(_.toFloat().sub(C.exp())),b.reshape(k).mul(C.exp().sub(_.toFloat()))]}}})(f,p)}(s,o);return Or(h,l,a)}}),KE=Object.freeze({get Reduction(){return Gt},absoluteDifference:$E,computeWeightedLoss:Or,cosineDistance:WE,hingeLoss:zE,huberLoss:UE,logLoss:VE,meanSquaredError:qE,sigmoidCrossEntropy:HE,softmaxCrossEntropy:GE});function Lg(e,t){return t===void 0&&(t=!1),z.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],a=ny(n),s=e.clone(),o=ua([[1]],[1,1]),l=o.clone(),c=n>=r?r:n,u=function(h){var f,p=s,m=l,x=a;f=z.tidy(function(){var y=s.slice([h,h],[n-h,1]),g=y.norm(),v=s.slice([h,h],[1,1]),w=ua([[-1]]).where(v.greater(0),ua([[1]])),b=v.sub(w.mul(g)),N=y.div(b);l=N.shape[0]===1?o.clone():o.concat(N.slice([1,0],[N.shape[0]-1,N.shape[1]]),0);var _=w.matMul(b).div(g).neg(),C=s.slice([h,0],[n-h,r]),k=_.mul(l);if(h===0)s=C.sub(k.matMul(l.transpose().matMul(C)));else{var j=C.sub(k.matMul(l.transpose().matMul(C)));s=s.slice([0,0],[h,r]).concat(j,0)}var S=a.slice([0,h],[n,a.shape[1]-h]);if(h===0)a=S.sub(S.matMul(l).matMul(k.transpose()));else{var M=S.sub(S.matMul(l).matMul(k.transpose()));a=a.slice([0,0],[n,h]).concat(M,1)}return[l,s,a]}),l=f[0],s=f[1],a=f[2],un([p,m,x])},d=0;d<c;++d)u(d);return!t&&n>r&&(a=a.slice([0,0],[n,r]),s=s.slice([0,0],[r,r])),[a,s]})}var XE=L({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=R(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var a=r.shape,s=r.shape.slice(-2),o=s[0],l=s[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=l))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+l+").");t<0&&(t=o),n<0&&(n=l);var c=sc(0,o,1,"int32").reshape([-1,1]),u=sc(0,l,1,"int32"),d=kt(c,u),h=Uc(d.lessEqual(ce(+t,"int32")),d.greaterEqual(ce(-n,"int32"))),f=Je([o,l],r.dtype);return Nn(_t(r.reshape([-1,o,l])).map(function(p){return Ka(h,p,f)})).reshape(a)}}),YE=L({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,T(e!=null&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(c){T(e[c].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[c].shape[0]+" vs. "+n+")"})},a=1;a<e.length;++a)r(a)}else t=!0,e=Ff(e,e.shape[0],0).map(function(c){return sy(c,[0])});T(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var s=[],o=e,l=function(c){s.push(z.tidy(function(){var u=o[c];if(c>0)for(var d=0;d<c;++d){var h=tb(s[d].mulStrict(u)).mul(s[d]);u=u.sub(h)}return u.div(sb(u,"euclidean"))}))};for(a=0;a<e.length;++a)l(a);return t?Nn(s,0):s}}),QE=L({qr_:function(e,t){if(t===void 0&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return Lg(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(o,l){return o*l}),r=_t(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],s=[];return r.forEach(function(o){var l=Lg(o,t),c=l[0],u=l[1];a.push(c),s.push(u)}),[Nn(a,0).reshape(e.shape),Nn(s,0).reshape(e.shape)]}}),JE=Object.freeze({bandPart:XE,gramSchmidt:YE,qr:QE});function Gc(e,t,n,r,a,s){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),s==null&&(s=0);var o=e.shape[0];return n=Math.min(n,o),T(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),T(e.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),T(e.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),T(t.rank===1,function(){return"scores must be a 1D tensor"}),T(t.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]}),T(0<=s&&s<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+s+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s}}var ZE=L({resizeBilinear_:function(e,t,n){n===void 0&&(n=!1);var r=R(e,"images","resizeBilinear");T(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),T(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var a=r,s=!1;r.rank===3&&(s=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],l=t[1],c=z.runKernelFunc(function(u,d){return d([a]),u.resizeBilinear(a,o,l,n)},{x:a},function(u,d){return{x:function(){return z.runKernelFunc(function(h){return h.resizeBilinearBackprop(u,d[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:l});return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),e3=L({resizeNearestNeighbor_:function(e,t,n){n===void 0&&(n=!1);var r=R(e,"images","resizeNearestNeighbor");T(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),T(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),T(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var a=r,s=!1;r.rank===3&&(s=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],l=t[1],c=z.runKernelFunc(function(u,d){return d([a]),u.resizeNearestNeighbor(a,o,l,n)},{batchImages:a},function(u,d){return{batchImages:function(){return z.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(u,d[0],n)},{})}}});return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),t3=L({nonMaxSuppression_:function(e,t,n,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var s=R(e,"boxes","nonMaxSuppression"),o=R(t,"scores","nonMaxSuppression"),l=Gc(s,o,n,r,a);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold;var c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return z.runKernelFunc(function(u){return u.nonMaxSuppression(s,o,n,r,a)},{boxes:s,scores:o},null,"NonMaxSuppressionV3",c)}}),n3=function(e,t,n,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),ge(this,void 0,void 0,function(){var s,o,l,c,u,d,h;return ve(this,function(f){switch(f.label){case 0:return s=R(e,"boxes","nonMaxSuppressionAsync"),o=R(t,"scores","nonMaxSuppressionAsync"),l=Gc(s,o,n,r,a),n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold,[4,Promise.all([s.data(),o.data()])];case 1:return c=f.sent(),u=c[0],d=c[1],h=Bf(u,d,n,r,a),s!==e&&s.dispose(),o!==t&&o.dispose(),[2,h]}})})},r3=L({nonMaxSuppressionWithScore_:function(e,t,n,r,a,s){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),s===void 0&&(s=0);var o=R(e,"boxes","nonMaxSuppression"),l=R(t,"scores","nonMaxSuppression"),c=Gc(o,l,n,r,a,s),u={maxOutputSize:n=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:a=c.scoreThreshold,softNmsSigma:s=c.softNmsSigma},d=z.runKernel("NonMaxSuppressionV5",{boxes:o,scores:l},u);return{selectedIndices:d[0],selectedScores:d[1]}}}),a3=function(e,t,n,r,a,s){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),s===void 0&&(s=0),ge(this,void 0,void 0,function(){var o,l,c,u,d,h,f;return ve(this,function(p){switch(p.label){case 0:return o=R(e,"boxes","nonMaxSuppressionAsync"),l=R(t,"scores","nonMaxSuppressionAsync"),c=Gc(o,l,n,r,a,s),n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,s=c.softNmsSigma,[4,Promise.all([o.data(),l.data()])];case 1:return u=p.sent(),d=u[0],h=u[1],f=$f(d,h,n,r,a,s),o!==e&&o.dispose(),l!==t&&l.dispose(),[2,f]}})})},s3=L({cropAndResize_:function(e,t,n,r,a,s){var o=R(e,"image","cropAndResize"),l=R(t,"boxes","cropAndResize","float32"),c=R(n,"boxInd","cropAndResize","int32");a=a||"bilinear",s=s||0;var u=l.shape[0];return T(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),T(l.rank===2&&l.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+l.shape+"."}),T(c.rank===1&&c.shape[0]===u,function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+l.shape+"."}),T(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),T(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),T(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a}),z.runKernelFunc(function(d,h){return d.cropAndResize(o,l,c,r,a,s)},{images:o,boxes:l,boxInd:c},null,"CropAndResize",{method:a,extrapolationValue:s,cropSize:r})}}),ep=Object.freeze({resizeBilinear:ZE,resizeNearestNeighbor:e3,nonMaxSuppression:t3,nonMaxSuppressionAsync:n3,nonMaxSuppressionWithScore:r3,nonMaxSuppressionWithScoreAsync:a3,cropAndResize:s3}),tp=function(e,t){return!(e>0)||t==="linear"},np=function(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},rp=function(e,t){var n=t,r=jt(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},ap=function(e,t,n){if(t==="linear")return e;if(t==="relu")return at(e);if(t==="elu")return nb(e);if(t==="relu6")return ab(e);if(t==="prelu")return rb(e,n);throw new Error("Unknown fused activation "+t+".")},o3=L({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,s=a!==void 0&&a,o=e.transposeB,l=o!==void 0&&o,c=e.bias,u=e.activation,d=u===void 0?"linear":u,h=e.preluActivationWeights;if(tp(z.state.gradientDepth,d)===!1){var f=qc(n,r,s,l);return c!=null&&(f=Te(f,c)),ap(f,d,h)}var p=R(n,"a","fused matMul"),m=R(r,"b","fused matMul");t=it(p,m),p=t[0],m=t[1];var x=s?p.shape[p.rank-2]:p.shape[p.rank-1],y=l?m.shape[m.rank-1]:m.shape[m.rank-2],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=l?m.shape[m.rank-2]:m.shape[m.rank-1],w=p.shape.slice(0,-2),b=m.shape.slice(0,-2),N=xe(w),_=xe(b);T(p.rank>=2&&m.rank>=2&&p.rank===m.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+m.rank+"."}),T(It(w,b),function(){return"Error in fused matMul: outer dimensions ("+w+") and ("+b+") of Tensors with shapes "+p.shape+" and "+m.shape+" must match."}),T(x===y,function(){return"Error in fused matMul: inner shapes ("+x+") and ("+y+") of Tensors with shapes "+p.shape+" and "+m.shape+" and transposeA="+s+" and transposeB="+l+" must match."});var C,k,j=p.shape.slice(0,-2).concat([g,v]),S=s?p.as3D(N,x,g):p.as3D(N,g,x),M=l?m.as3D(_,v,y):m.as3D(_,y,v);c!=null&&Pe(j,(C=it(C=R(c,"bias","fused matMul"),p)[0]).shape),h!=null&&(k=R(h,"prelu weights","fused matMul"));var D={a:S,b:M};c!=null&&(D.bias=C),h!=null&&(D.preluActivationWeights=k);var A=[S,M];return z.runKernelFunc(function(B,F){var U=B.fusedBatchMatMul({a:S,b:M,transposeA:s,transposeB:l,bias:C,activation:d,preluActivationWeights:k});return F([S,M,U]),U},D,function(B,F){var U=F[0],V=F[1],P=F[2],$=np(B,P,d),I={};return c!=null&&(I={bias:function(){return rp(C,$)}}),Object.assign(s||l?!s&&l?{a:function(){return $.matMul(V,!1,!1)},b:function(){return $.matMul(U,!0,!1)}}:s&&!l?{a:function(){return V.matMul($,!1,!0)},b:function(){return U.matMul($,!1,!1)}}:{a:function(){return V.matMul($,!0,!0)},b:function(){return $.matMul(U,!0,!0)}}:{a:function(){return $.matMul(V,!1,!0)},b:function(){return U.matMul($,!0,!1)}},I)},"_FusedMatMul",{transposeA:s,transposeB:l,activation:d},A,[!0]).reshape(j)}}),i3=L({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,s=e.dataFormat,o=s===void 0?"NHWC":s,l=e.dilations,c=l===void 0?[1,1]:l,u=e.dimRoundingMode,d=e.bias,h=e.activation,f=h===void 0?"linear":h,p=e.preluActivationWeights;if(f=f||"linear",tp(z.state.gradientDepth,f)===!1){var m=On(t,n,r,a,o,c,u);return d!=null&&(m=Te(m,d)),ap(m,f,p)}var x=R(t,"x","conv2d"),y=R(n,"filter","conv2d"),g=x,v=!1;x.rank===3&&(v=!0,g=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),T(g.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),T(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."}),u!=null&&T(dt(a),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+a+"."}),T(g.shape[3]===y.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+y.shape[2]+"."}),T(hn(r,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),T(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var w,b,N=es(g.shape,y.shape,r,c,a,u);d!=null&&(w=it(w=R(d,"bias","fused conv2d"),x)[0],Pe(N.outShape,w.shape)),p!=null&&(b=R(p,"prelu weights","fused conv2d"));var _={x:g,filter:y};d!=null&&(_.bias=w),p!=null&&(_.preluActivationWeights=b);var C=[y,g],k=z.runKernelFunc(function(j,S){var M=j.fusedConv2d({input:g,filter:y,convInfo:N,bias:w,activation:f,preluActivationWeights:b});return S([y,g,M]),M},_,function(j,S){var M=S,D=M[0],A=M[1],B=M[2],F=np(j,B,f);T(Js(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"});var U={};return d!=null&&(U={bias:function(){return rp(w,F)}}),Object.assign({x:function(){return Ky(A.shape,F,D,r,a)},filter:function(){return Kf(A,F,D.shape,r,a)}},U)},"FusedConv2D",{convInfo:N,activation:f},C,[!0]);return v?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),l3=L({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,s=e.dataFormat,o=s===void 0?"NHWC":s,l=e.dilations,c=l===void 0?[1,1]:l,u=e.dimRoundingMode,d=e.bias,h=e.activation,f=h===void 0?"linear":h,p=e.preluActivationWeights;if(tp(z.state.gradientDepth,f)===!1){var m=Vc(t,n,r,a,o,c,u);return d!=null&&(m=Te(m,d)),ap(m,f,p)}var x=R(t,"x","depthwiseConv2d"),y=R(n,"filter","depthwiseConv2d"),g=x,v=!1;x.rank===3&&(v=!0,g=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),T(g.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),T(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."}),T(g.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."}),c==null&&(c=[1,1]),T(hn(r,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),u!=null&&T(dt(a),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+a+"."});var w,b,N=es(g.shape,y.shape,r,c,a,u,!0);d!=null&&(w=it(w=R(d,"bias","fused conv2d"),x)[0],Pe(N.outShape,w.shape)),p!=null&&(b=R(p,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:y};d!=null&&(_.bias=w),p!=null&&(_.preluActivationWeights=b);var C=[y,g],k=z.runKernelFunc(function(j,S){var M=j.fusedDepthwiseConv2D({input:g,filter:y,convInfo:N,bias:w,activation:f,preluActivationWeights:b});return S([y,g,M]),M},_,function(j,S){T(Js(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"});var M=S[0],D=S[1],A=S[2],B=np(j,A,f),F={};return d!=null&&(F={bias:function(){return rp(w,B)}}),Object.assign({x:function(){return Xy(D.shape,B,M,N)},filter:function(){return Yy(D,B,M.shape,N)}},F)},"FusedDepthwiseConv2D",{convInfo:N,activation:f},C,[!0]);return v?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),c3=Object.freeze({matMul:o3,conv2d:i3,depthwiseConv2d:l3}),u3=Object.freeze({image:ep,linalg:JE,losses:KE,spectral:TE,fused:c3,signal:LE,square:VS,squaredDifference:Ay,conv1d:Z4,conv2d:On,conv3d:eE,depthwiseConv2d:Vc,separableConv2d:Xf,conv2dTranspose:tE,conv3dTranspose:nE,op:L,batchNormalization2d:b4,batchNormalization3d:w4,batchNormalization4d:N4,batchNormalization:_4,batchNorm:Ly,batchNorm2d:j4,batchNorm3d:k4,batchNorm4d:C4,booleanMaskAsync:J4,complex:Ft,real:Dn,imag:ir,concat:Nt,concat1d:ck,concat2d:uk,concat3d:dk,concat4d:hk,split:Ff,matMul:qc,dot:rE,outerProduct:aE,reverse:Si,reverse1d:sE,reverse2d:oE,reverse3d:iE,reverse4d:lE,maxPool:Et,avgPool:Ei,pool:cE,maxPool3d:uE,avgPool3d:dE,slice:pr,slice1d:hE,slice2d:fE,slice3d:Zy,slice4d:pE,abs:qS,acos:HS,acosh:GS,asin:KS,asinh:XS,atan:YS,atanh:QS,ceil:JS,clipByValue:qf,cos:ZS,cosh:e4,erf:t4,exp:yh,expm1:n4,floor:r4,log:a4,log1p:s4,logSigmoid:o4,neg:fc,reciprocal:i4,round:l4,rsqrt:Ty,sigmoid:Py,sign:c4,isNaN:u4,isInf:d4,isFinite:h4,sin:f4,sinh:p4,softplus:m4,sqrt:g4,step:v4,tan:x4,tanh:y4,all:mE,any:gE,argMax:vE,argMin:xE,logSumExp:yE,max:Hc,mean:bE,min:wE,moments:NE,sum:tb,prod:_E,equal:Uy,equalStrict:z4,greater:U4,greaterEqual:Vy,greaterEqualStrict:V4,greaterStrict:q4,less:H4,lessEqual:G4,lessEqualStrict:K4,lessStrict:X4,notEqual:Y4,notEqualStrict:Q4,add:Te,addN:R4,addStrict:D4,atan2:I4,div:Un,divNoNan:A4,divStrict:T4,floorDiv:Wy,maximum:Hf,maximumStrict:P4,minimum:zy,minimumStrict:F4,mod:M4,modStrict:O4,mul:Kt,mulStrict:L4,pow:pc,powStrict:B4,squaredDifferenceStrict:$4,sub:kt,subStrict:W4,elu:nb,leakyRelu:jE,prelu:rb,relu:at,relu6:ab,selu:kE,logicalAnd:Uc,logicalNot:S4,logicalOr:By,logicalXor:E4,where:Ka,whereAsync:$y,buffer:De,print:wk,batchToSpaceND:ty,broadcastTo:Nk,cast:_k,clone:jk,cumsum:kk,depthToSpace:Ck,expandDims:Rn,eye:ny,multinomial:Sk,oneHot:mh,pad:Za,pad1d:Ek,pad2d:Rk,pad3d:Dk,pad4d:Ik,rand:Ak,randomNormal:Tk,randomGamma:Pk,randomUniform:ry,reshape:qn,spaceToBatchND:ay,squeeze:sy,stack:Nn,tile:Ps,truncatedNormal:Fk,unstack:_t,setdiff1dAsync:Mk,fill:fr,linspace:lk,ones:oo,range:sc,scalar:ce,tensor:Ot,tensor1d:gt,tensor2d:ua,tensor3d:Pf,tensor4d:rn,tensor5d:sk,tensor6d:ok,variable:ik,zeros:Je,onesLike:ey,zerosLike:Be,transpose:ma,softmax:Mr,logSoftmax:Uk,localResponseNormalization:CE,norm:sb,gather:Gf,unsortedSegmentSum:qy,basicLSTMCell:SE,multiRNNCell:EE,movingAverage:RE,stridedSlice:DE,topk:IE,scatterND:AE,fft:Yf,ifft:mc,rfft:Qf,irfft:ob,sparseToDense:PE,gatherND:FE,diag:ME,dropout:OE,hannWindow:Jf,hammingWindow:lb,frame:Zf,stft:cb,inTopKAsync:BE});function te(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(n){n!=null&&T(n.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function Gu(e,t,n,r){if(n==="linear")return e.linear(t);if(n==="relu")return e.relu(t);if(n==="elu")return e.elu(t);if(n==="relu6")return e.relu6(t);if(n==="prelu")return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var d3=function(e){function t(){var n=e.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new hy(n,z),n}return Qn(t,e),t.prototype.write=function(n,r,a){this.firstUse&&(this.firstUse=!1,J().get("IS_NODE")&&rc(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var s={};return this.data.set(s,{values:n,dtype:a}),s},t.prototype.move=function(n,r,a,s){this.data.set(n,{values:r,dtype:s})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(n){return ge(this,void 0,void 0,function(){return ve(this,function(r){return[2,this.readSync(n)]})})},t.prototype.readSync=function(n){var r=this.data.get(n),a=r.dtype,s=r.complexTensors;return a==="complex64"?xh(this.readSync(s.real.dataId),this.readSync(s.imag.dataId)):this.data.get(n).values},t.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),a=r;if(n.dtype==="string")try{a=r.map(function(s){return ec(s)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return De(n.shape,n.dtype,a)},t.prototype.makeOutput=function(n,r,a){var s=this.write(n,r,a);return z.makeTensorFromDataId(s,r,a,this)},t.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},t.prototype.time=function(n){return ge(this,void 0,void 0,function(){var r;return ve(this,function(a){return r=ar(),n(),[2,{kernelMs:ar()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(n,r){var a=this.makeOutput(null,n.shape,"complex64");return this.data.get(a.dataId).complexTensors={real:z.keep(n.clone()),imag:z.keep(r.clone())},a},t.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,a){if(te(n,"slice"),uy(n.shape,r,a)){var s=dy(r,n.strides),o=xe(a);return Ot(this.readSync(n.dataId).subarray(s,s+o),a,n.dtype)}for(var l=De(a,n.dtype),c=this.bufferSync(n),u=0;u<l.size;++u){var d=l.indexToLoc(u).map(function(h,f){return h+r[f]});l.values[u]=c.get.apply(c,d)}return l.toTensor()},t.prototype.stridedSlice=function(n,r,a,s){te(n,"stridedSlice");var o=Of(r,a,s);if(o.some(function(p){return p===0}))return Ot([],o);for(var l=De(o,n.dtype),c=this.bufferSync(n),u=0;u<l.size;u++){for(var d=l.indexToLoc(u),h=new Array(d.length),f=0;f<h.length;f++)h[f]=d[f]*s[f]+r[f];l.set.apply(l,[c.get.apply(c,h)].concat(d))}return l.toTensor()},t.prototype.diag=function(n){for(var r=this.readSync(n.dataId),a=De([n.size,n.size],n.dtype),s=a.values,o=0;o<r.length;o++)s[o*n.size+o]=r[o];return a.toTensor()},t.prototype.unstack=function(n,r){for(var a=n.shape[r],s=new Array(n.rank-1),o=0,l=0;l<n.rank;l++)l!==r&&(s[o++]=n.shape[l]);var c=new Array(n.rank).fill(0),u=n.shape.slice();u[r]=1;var d=new Array(a);for(l=0;l<d.length;l++)c[r]=l,d[l]=this.slice(n,c,u).reshape(s);return d},t.prototype.reverse=function(n,r){te(n,"reverse");for(var a=De(n.shape,n.dtype),s=this.bufferSync(n),o=function(c){var u=a.indexToLoc(c),d=u.slice();r.forEach(function(h){return d[h]=n.shape[h]-1-d[h]}),a.set.apply(a,[s.get.apply(s,d)].concat(u))},l=0;l<a.size;l++)o(l);return a.toTensor()},t.prototype.concat=function(n,r){var a=this;if(n[0].dtype==="complex64"){var s=n.map(function(p){return Dn(p)}),o=n.map(function(p){return ir(p)});return Ft(this.concat(s,r),this.concat(o,r))}var l=n.map(function(p){var m=xe(p.shape.slice(r));return p.as2D(-1,m)}),c=Qs(l.map(function(p){return p.shape}),1),u=De(c,n[0].dtype).values;if(l[0].shape[0]===1){var d=0;l.forEach(function(p){u.set(a.readSync(p.dataId),d),d+=p.size})}else{var h=0;l.forEach(function(p){for(var m=a.readSync(p.dataId),x=0,y=0;y<p.shape[0];++y)for(var g=y*c[1]+h,v=0;v<p.shape[1];++v)u[g+v]=m[x++];h+=p.shape[1]})}var f=Qs(n.map(function(p){return p.shape}),r);return Ot(u,f,n[0].dtype)},t.prototype.neg=function(n){return te(n,"neg"),this.multiply(ce(-1),n)},t.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(a,s,o,l){return{real:a+o,imag:s+l}}):this.broadcastedBinaryOp(n,r,Mt(n.dtype,r.dtype),function(a,s){return a+s})},t.prototype.addN=function(n){var r=this;te(n,"addN");for(var a=n.map(function(d){return r.readSync(d.dataId)}),s=De(n[0].shape,n[0].dtype),o=s.values,l=0;l<n.length;l++)for(var c=a[l],u=0;u<o.length;u++)o[u]+=c[u];return s.toTensor()},t.prototype.softmax=function(n,r){var a=Ct([r],n.shape),s=this.max(n,a),o=dn(s.shape,a),l=this.subtract(n,s.reshape(o)),c=this.exp(l),u=this.sum(c,a).reshape(o);return this.realDivide(c,u)},t.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(a,s,o,l){return{real:a-o,imag:s-l}}):this.broadcastedBinaryOp(n,r,Mt(n.dtype,r.dtype),function(a,s){return a-s})},t.prototype.pow=function(n,r){return te([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return Math.pow(a,s)})},t.prototype.batchMatMul=function(n,r,a,s){te([n,r],"matMul");for(var o=a?n.shape[1]:n.shape[2],l=a?n.shape[2]:n.shape[1],c=s?r.shape[1]:r.shape[2],u=n.shape[0],d=this.readSync(n.dataId),h=this.readSync(r.dataId),f=a?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],p=f[0],m=f[1],x=f[2],y=s?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],g=y[0],v=y[1],w=y[2],b=l*c,N=De([u,l,c],n.dtype),_=N.values,C=this.blockSize,k=0;k<u;k++)for(var j=0;j<l;j+=C)for(var S=0;S<c;S+=C)for(var M=0;M<o;M+=C)for(var D=Math.min(j+C,l),A=Math.min(S+C,c),B=Math.min(M+C,o),F=j;F<D;F++)for(var U=S;U<A;U++){for(var V=0,P=M;P<B;P++)V+=d[k*p+F*m+P*x]*h[P*g+U*v+k*w];_[k*b+(F*c+U)]+=V}return N.toTensor()},t.prototype.fusedBatchMatMul=function(n){var r=n.a,a=n.b,s=n.transposeA,o=n.transposeB,l=n.bias,c=n.activation,u=n.preluActivationWeights,d=this.batchMatMul(r,a,s,o);return l&&(d=this.add(d,l)),c&&(d=Gu(this,d,c,u)),d},t.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(a,s,o,l){return{real:a*o-s*l,imag:a*l+s*o}}):this.broadcastedBinaryOp(n,r,Mt(n.dtype,r.dtype),function(a,s){return a*s})},t.prototype.realDivide=function(n,r){return te([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(a,s){return a/s})},t.prototype.floorDiv=function(n,r){return te([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(a,s){return Math.floor(a/s)})},t.prototype.sum=function(n,r){te(n,"sum"),pn("sum",r,n.rank);for(var a=Ut(n.shape,r),s=a[0],o=a[1],l=Je(s,Mt(n.dtype,"int32")),c=xe(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=0,m=0;m<c;++m)p+=d[f+m];u[h]=p}return l},t.prototype.prod=function(n,r){te(n,"sum");for(var a=Ut(n.shape,r),s=a[0],o=a[1],l=Je(s,Mt(n.dtype,"int32")),c=xe(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=1,m=0;m<c;++m)p*=d[f+m];u[h]=p}return l},t.prototype.unsortedSegmentSum=function(n,r,a){te(n,"unsortedSegmentSum");for(var s=[],o=n.rank-r.rank,l=0;l<o;++l)r=r.expandDims(l+1);for(l=0;l<a;++l){var c=ce(l,"int32"),u=Uy(c,r).asType("float32").mul(n).sum(0);s.push(u)}return Nn(s)},t.prototype.argMin=function(n,r){te(n,"argMin");var a=[r];pn("argMin",a,n.rank);for(var s=Ut(n.shape,a),o=s[0],l=s[1],c=Je(o,"int32"),u=xe(l),d=this.readSync(c.dataId),h=this.readSync(n.dataId),f=0;f<d.length;++f){for(var p=f*u,m=h[p],x=0,y=0;y<u;++y){var g=h[p+y];g<m&&(m=g,x=y)}d[f]=x}return c},t.prototype.argMax=function(n,r){te(n,"argMax");var a=[r];pn("argMax",a,n.rank);for(var s=Ut(n.shape,a),o=s[0],l=s[1],c=Je(o,"int32"),u=xe(l),d=this.readSync(c.dataId),h=this.readSync(n.dataId),f=0;f<d.length;++f){for(var p=f*u,m=h[p],x=0,y=0;y<u;++y){var g=h[p+y];g>m&&(m=g,x=y)}d[f]=x}return c},t.prototype.cumsum=function(n,r,a,s){if(te(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var o=Mt(n.dtype,"int32"),l=Je(n.shape,o),c=this.readSync(l.dataId),u=this.readSync(n.dataId),d=n.shape[n.rank-1],h=s?function(y,g){return y+d-g-1}:function(y,g){return y+g},f=0;f<u.length;f+=d)for(var p=0;p<d;p++){var m=h(f,p);if(p===0)c[m]=a?0:u[m];else{var x=h(f,p-1);c[m]=a?u[x]+c[x]:u[m]+c[x]}}return l},t.prototype.equal=function(n,r){return te([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a===s?1:0})},t.prototype.notEqual=function(n,r){return te([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a!==s?1:0})},t.prototype.less=function(n,r){return te([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a<s?1:0})},t.prototype.lessEqual=function(n,r){return te([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a<=s?1:0})},t.prototype.greater=function(n,r){return te([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a>s?1:0})},t.prototype.greaterEqual=function(n,r){return te([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a>=s?1:0})},t.prototype.logicalNot=function(n){te(n,"logicalNot");for(var r=this.readSync(n.dataId),a=new Uint8Array(r.length),s=0;s<r.length;++s)a[s]=r[s]?0:1;return this.makeOutput(a,n.shape,"bool")},t.prototype.logicalAnd=function(n,r){return te([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a&&s})},t.prototype.logicalOr=function(n,r){return te([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(a,s){return a||s})},t.prototype.select=function(n,r,a){te([n,r,a],"select");for(var s=this.readSync(n.dataId),o=this.readSync(r.dataId),l=this.readSync(a.dataId),c=Je(r.shape,Mt(r.dtype,a.dtype)),u=this.readSync(c.dataId),d=0,h=n.rank===0||n.rank>1||r.rank===1?1:xe(r.shape.slice(1)),f=0;f<s.length;f++)for(var p=0;p<h;p++)s[f]===1?u[d++]=o[f]:u[d++]=l[f];return c},t.prototype.where=function(n){te([n],"where");var r=this.readSync(n.dataId);return Wf(n.shape,r)},t.prototype.topk=function(n,r,a){return te(n,"topk"),by(this.readSync(n.dataId),n.shape,n.dtype,r)},t.prototype.min=function(n,r){te(n,"min"),pn("min",r,n.rank);for(var a=Ut(n.shape,r),s=a[0],o=a[1],l=Je(s,n.dtype),c=xe(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=d[f],m=0;m<c;++m){var x=d[f+m];x<p&&(p=x)}u[h]=p}return l},t.prototype.minimum=function(n,r){return te([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return Math.min(a,s)})},t.prototype.mod=function(n,r){return te([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){var o=a%s;return a<0&&s<0||a>=0&&s>=0?o:(o+s)%s})},t.prototype.max=function(n,r){te(n,"max"),pn("max",r,n.rank);for(var a=Ut(n.shape,r),s=a[0],o=a[1],l=Je(s,n.dtype),c=xe(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=d[f],m=0;m<c;++m){var x=d[f+m];x>p&&(p=x)}u[h]=p}return l},t.prototype.maximum=function(n,r){return te([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return Math.max(a,s)})},t.prototype.all=function(n,r){te(n,"all"),pn("all",r,n.rank);for(var a=Ut(n.shape,r),s=a[0],o=a[1],l=Je(s,n.dtype),c=xe(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=d[f],m=0;m<c;++m){var x=d[f+m];p=p&&x}u[h]=p}return l},t.prototype.any=function(n,r){te(n,"any"),pn("any",r,n.rank);for(var a=Ut(n.shape,r),s=a[0],o=a[1],l=Je(s,n.dtype),c=xe(o),u=this.readSync(l.dataId),d=this.readSync(n.dataId),h=0;h<u.length;++h){for(var f=h*c,p=d[f],m=0;m<c;++m){var x=d[f+m];p=p||x}u[h]=p}return l},t.prototype.squaredDifference=function(n,r){return te([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){var o=a-s;return o*o})},t.prototype.ceil=function(n){te(n,"ceil");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=Math.ceil(r[s]);return this.makeOutput(a,n.shape,"float32")},t.prototype.floor=function(n){te(n,"floor");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=Math.floor(r[s]);return this.makeOutput(a,n.shape,"float32")},t.prototype.sign=function(n){te(n,"x");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)r[s]<0?a[s]=-1:r[s]>0?a[s]=1:a[s]=0;return this.makeOutput(a,n.shape,"float32")},t.prototype.isNaN=function(n){te(n,"x");for(var r=this.readSync(n.dataId),a=new Uint8Array(r.length),s=0;s<r.length;++s)Number.isNaN(r[s])&&(a[s]=1);return this.makeOutput(a,n.shape,"bool")},t.prototype.isInf=function(n){te(n,"x");for(var r=this.readSync(n.dataId),a=new Uint8Array(r.length),s=0;s<r.length;++s)Math.abs(r[s])===1/0&&(a[s]=1);return this.makeOutput(a,n.shape,"bool")},t.prototype.isFinite=function(n){te(n,"x");for(var r=this.readSync(n.dataId),a=new Uint8Array(r.length),s=0;s<r.length;++s)Number.isFinite(r[s])&&(a[s]=1);return this.makeOutput(a,n.shape,"bool")},t.prototype.round=function(n){te(n,"round");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=Math.floor(r[s]);r[s]-o<.5?a[s]=Math.floor(r[s]):r[s]-o>.5?a[s]=Math.ceil(r[s]):a[s]=o%2==0?o:o+1}return this.makeOutput(a,n.shape,"float32")},t.prototype.exp=function(n){te(n,"exp");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=Math.exp(r[s]);return this.makeOutput(a,n.shape,"float32")},t.prototype.expm1=function(n){te(n,"expm1");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=Math.expm1(r[s]);return this.makeOutput(a,n.shape,"float32")},t.prototype.log=function(n){te(n,"log");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];a[s]=Math.log(o)}return this.makeOutput(a,n.shape,"float32")},t.prototype.log1p=function(n){te(n,"log1p");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];a[s]=Math.log1p(o)}return this.makeOutput(a,n.shape,"float32")},t.prototype.sqrt=function(n){te(n,"sqrt");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];a[s]=Math.sqrt(o)}return this.makeOutput(a,n.shape,"float32")},t.prototype.rsqrt=function(n){te(n,"rsqrt");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];a[s]=1/Math.sqrt(o)}return this.makeOutput(a,n.shape,"float32")},t.prototype.reciprocal=function(n){te(n,"reciprocal");for(var r=this.readSync(n.dataId),a=new Float32Array(r.length),s=0;s<r.length;++s)a[s]=1/r[s];return this.makeOutput(a,n.shape,"float32")},t.prototype.linear=function(n){return n},t.prototype.relu=function(n){te(n,"relu");for(var r=Je(n.shape,n.dtype),a=this.readSync(r.dataId),s=this.readSync(n.dataId),o=0;o<s.length;++o)a[o]=Math.max(0,s[o]);return r},t.prototype.relu6=function(n){te(n,"relu");for(var r=Je(n.shape,n.dtype),a=this.readSync(r.dataId),s=this.readSync(n.dataId),o=0;o<s.length;++o)a[o]=Math.min(Math.max(0,s[o]),6);return r},t.prototype.prelu=function(n,r){return te([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return a<0?s*a:a})},t.prototype.elu=function(n){te(n,"elu");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var o=a[s];r[s]=o>=0?o:Math.exp(o)-1}return this.makeOutput(r,n.shape,"float32")},t.prototype.eluDer=function(n,r){te([n,r],"eluDer");for(var a=new Float32Array(r.size),s=this.readSync(r.dataId),o=this.readSync(n.dataId),l=0;l<s.length;++l){var c=s[l];a[l]=c>=1?o[l]:o[l]*(c+1)}return this.makeOutput(a,r.shape,"float32")},t.prototype.selu=function(n){te(n,"selu");for(var r=Uf,a=Vf,s=new Float32Array(n.size),o=this.readSync(n.dataId),l=0;l<o.length;++l){var c=o[l];s[l]=c>=0?a*c:r*(Math.exp(c)-1)}return this.makeOutput(s,n.shape,"float32")},t.prototype.clip=function(n,r,a){te(n,"clip");for(var s=new Float32Array(n.size),o=this.readSync(n.dataId),l=0;l<o.length;++l){var c=o[l];s[l]=c>a?a:c<r?r:c}return this.makeOutput(s,n.shape,"float32")},t.prototype.abs=function(n){for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.abs(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<n.size;++s){var o=a[2*s],l=a[2*s+1];r[s]=Math.hypot(o,l)}return this.makeOutput(r,n.shape,"float32")},t.prototype.int=function(n){te(n,"int");for(var r=new Int32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=a[s];return this.makeOutput(r,n.shape,"int32")},t.prototype.sigmoid=function(n){te(n,"sigmoid");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=1/(1+Math.exp(-a[s]));return this.makeOutput(r,n.shape,"float32")},t.prototype.softplus=function(n){te(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,a=new Float32Array(n.size),s=this.readSync(n.dataId),o=0;o<s.length;++o){var l=s[o]>-r,c=s[o]<r,u=Math.exp(s[o]),d=void 0;d=c?u:l?s[o]:Math.log(1+u),a[o]=d}return this.makeOutput(a,n.shape,"float32")},t.prototype.sin=function(n){te(n,"sin");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.sin(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cos=function(n){te(n,"cos");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.cos(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tan=function(n){te(n,"tan");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.tan(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asin=function(n){te(n,"asin");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.asin(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acos=function(n){te(n,"acos");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.acos(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan=function(n){te(n,"atan");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.atan(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan2=function(n,r){return te([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(a,s){return Math.atan2(a,s)})},t.prototype.sinh=function(n){te(n,"sinh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.sinh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cosh=function(n){te(n,"cosh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.cosh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tanh=function(n){te(n,"tanh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=hj(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asinh=function(n){te(n,"asinh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.asinh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acosh=function(n){te(n,"acosh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.acosh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atanh=function(n){te(n,"atanh");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s)r[s]=Math.atanh(a[s]);return this.makeOutput(r,n.shape,"float32")},t.prototype.erf=function(n){te(n,"erf");for(var r=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var o=Math.sign(a[s]),l=Math.abs(a[s]),c=1/(1+.3275911*l);r[s]=o*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-l*l))}return this.makeOutput(r,n.shape,"float32")},t.prototype.step=function(n,r){r===void 0&&(r=0),te(n,"step");for(var a=new Float32Array(n.size),s=this.readSync(n.dataId),o=0;o<s.length;++o){var l=s[o];isNaN(l)?a[o]=NaN:a[o]=l>0?1:r}return this.makeOutput(a,n.shape,"float32")},t.prototype.fusedConv2d=function(n){var r=n.input,a=n.filter,s=n.convInfo,o=n.bias,l=n.activation,c=n.preluActivationWeights,u=this.conv2d(r,a,s);return o&&(u=this.add(u,o)),l&&(u=Gu(this,u,l,c)),u},t.prototype.conv2d=function(n,r,a){te([n,r],"conv2d");for(var s=a.filterHeight,o=a.filterWidth,l=a.dilationHeight,c=a.dilationWidth,u=a.padInfo.left,d=a.padInfo.top,h=a.dataFormat==="channelsLast",f=De(a.outShape,n.dtype),p=n.strides[0],m=h?n.strides[1]:n.strides[2],x=h?n.strides[2]:1,y=h?1:n.strides[1],g=f.strides[0],v=h?f.strides[1]:f.strides[2],w=h?f.strides[2]:1,b=h?1:f.strides[1],N=this.readSync(n.dataId),_=this.readSync(r.dataId),C=f.values,k=0;k<a.batchSize;++k)for(var j=k*p,S=k*g,M=0;M<a.outHeight;++M)for(var D=S+M*v,A=M*a.strideHeight-d,B=0;B<s;B++){var F=A+B*l;if(!(F<0||F>=a.inHeight))for(var U=B*r.strides[0],V=j+F*m,P=0;P<a.outWidth;++P)for(var $=D+P*w,I=P*a.strideWidth-u,q=0;q<o;q++){var X=I+q*c;if(!(X<0||X>=a.inWidth))for(var ne=V+X*x,ie=U+q*r.strides[1],le=0;le<a.inChannels;++le){for(var pe=N[ne+le*y],_e=0;_e<a.outChannels;++_e)C[$+_e*b]+=pe*_[ie+_e];ie+=a.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(n,r,a){for(var s=a.filterDepth,o=a.filterHeight,l=a.filterWidth,c=a.dilationDepth,u=a.dilationHeight,d=a.dilationWidth,h=a.padInfo.front,f=a.padInfo.left,p=a.padInfo.top,m=De(a.outShape,n.dtype),x=this.readSync(n.dataId),y=this.readSync(r.dataId),g=m.values,v=0;v<a.batchSize;++v)for(var w=v*n.strides[0],b=v*m.strides[0],N=0;N<a.outDepth;++N)for(var _=b+N*m.strides[1],C=N*a.strideDepth-h,k=0;k<s;k++){var j=C+k*c;if(!(j<0||j>=a.inDepth))for(var S=k*r.strides[0],M=w+j*n.strides[1],D=0;D<a.outHeight;++D)for(var A=_+D*m.strides[2],B=D*a.strideHeight-p,F=0;F<o;F++){var U=B+F*u;if(!(U<0||U>=a.inHeight))for(var V=S+F*r.strides[1],P=M+U*n.strides[2],$=0;$<a.outWidth;++$)for(var I=A+$*a.outChannels,q=$*a.strideWidth-f,X=0;X<l;X++){var ne=q+X*d;if(!(ne<0||ne>=a.inWidth))for(var ie=V+X*r.strides[2],le=P+ne*a.inChannels,pe=ie,_e=0;_e<a.inChannels;++_e){for(var G=x[le+_e],re=0;re<a.outChannels;++re)g[I+re]+=G*y[pe+re];pe+=a.outChannels}}}}return m.toTensor()},t.prototype.conv2dDerInput=function(n,r,a){te([n,r],"conv2dDerInput");for(var s=De(a.inShape,"float32"),o=s.values,l=this.readSync(n.dataId),c=this.readSync(r.dataId),u=r.strides,d=u[0],h=u[1],f=u[2],p=a.batchSize,m=a.filterHeight,x=a.filterWidth,y=a.inChannels,g=a.inHeight,v=a.inWidth,w=a.outChannels,b=a.outHeight,N=a.outWidth,_=a.strideHeight,C=a.strideWidth,k=a.dataFormat,j=m-1-a.padInfo.top,S=x-1-a.padInfo.left,M=k==="channelsLast",D=s.strides[0],A=M?s.strides[1]:s.strides[2],B=M?s.strides[2]:1,F=M?1:s.strides[1],U=n.strides[0],V=M?n.strides[1]:n.strides[2],P=M?n.strides[2]:1,$=M?1:n.strides[1],I=0;I<p;++I)for(var q=0;q<y;++q)for(var X=0;X<g;++X)for(var ne=X-j,ie=Math.max(0,Math.ceil(ne/_)),le=Math.min(b,(m+ne)/_),pe=0;pe<v;++pe){for(var _e=pe-S,G=Math.max(0,Math.ceil(_e/C)),re=Math.min(N,(x+_e)/C),Ce=0,H=ie;H<le;++H)for(var O=H*_-ne,Q=G;Q<re;++Q)for(var oe=U*I+V*H+P*Q,ue=d*(m-1-O)+h*(x-1-(Q*C-_e))+f*q,W=0;W<w;++W)Ce+=l[oe+$*W]*c[ue+W];o[D*I+A*X+B*pe+F*q]=Ce}return s.toTensor()},t.prototype.conv3dDerInput=function(n,r,a){for(var s=De(a.inShape,"float32"),o=s.values,l=s.strides,c=l[0],u=l[1],d=l[2],h=l[3],f=this.readSync(n.dataId),p=n.strides,m=p[0],x=p[1],y=p[2],g=p[3],v=this.readSync(r.dataId),w=r.strides,b=w[0],N=w[1],_=w[2],C=w[3],k=a.batchSize,j=a.filterDepth,S=a.filterHeight,M=a.filterWidth,D=a.inChannels,A=a.inDepth,B=a.inHeight,F=a.inWidth,U=a.outChannels,V=a.outDepth,P=a.outHeight,$=a.outWidth,I=a.strideDepth,q=a.strideHeight,X=a.strideWidth,ne=j-1-a.padInfo.front,ie=S-1-a.padInfo.top,le=M-1-a.padInfo.left,pe=0;pe<k;++pe)for(var _e=0;_e<D;++_e)for(var G=0;G<A;++G)for(var re=G-ne,Ce=Math.max(0,Math.ceil(re/I)),H=Math.min(V,(j+re)/I),O=0;O<B;++O)for(var Q=O-ie,oe=Math.max(0,Math.ceil(Q/q)),ue=Math.min(P,(S+Q)/q),W=0;W<F;++W){for(var ae=W-le,je=Math.max(0,Math.ceil(ae/X)),de=Math.min($,(M+ae)/X),Le=0,qe=Ce;qe<H;++qe)for(var Oe=qe*I-re,ee=oe;ee<ue;++ee)for(var me=ee*q-Q,ke=je;ke<de;++ke)for(var Me=m*pe+x*qe+y*ee+g*ke,Ye=b*(j-1-Oe)+N*(S-1-me)+_*(M-1-(ke*X-ae))+C*_e,$e=0;$e<U;++$e)Le+=f[Me+$e]*v[Ye+$e];o[c*pe+u*G+d*O+h*W+_e]=Le}return s.toTensor()},t.prototype.conv2dDerFilter=function(n,r,a){te([n,r],"conv2dDerFilter");for(var s=a.strideHeight,o=a.strideWidth,l=a.filterHeight,c=a.filterWidth,u=a.dataFormat==="channelsLast",d=De(a.filterShape,"float32"),h=a.padInfo.left,f=a.padInfo.top,p=this.bufferSync(n),m=this.bufferSync(r),x=0;x<l;++x)for(var y=Math.max(0,Math.ceil((f-x)/s)),g=Math.min(a.outHeight,(a.inHeight+f-x)/s),v=0;v<c;++v)for(var w=Math.max(0,Math.ceil((h-v)/o)),b=Math.min(a.outWidth,(a.inWidth+h-v)/o),N=0;N<a.inChannels;++N)for(var _=0;_<a.outChannels;++_){for(var C=0,k=0;k<a.batchSize;++k)for(var j=y;j<g;++j)for(var S=x+j*s-f,M=w;M<b;++M){var D=v+M*o-h;C+=u?p.get(k,S,D,N)*m.get(k,j,M,_):p.get(k,N,S,D)*m.get(k,_,j,M)}d.set(C,x,v,N,_)}return d.toTensor()},t.prototype.conv3dDerFilter=function(n,r,a){for(var s=a.strideDepth,o=a.strideHeight,l=a.strideWidth,c=a.filterDepth,u=a.filterHeight,d=a.filterWidth,h=De(a.filterShape,"float32"),f=h.values,p=h.strides,m=p[0],x=p[1],y=p[2],g=p[3],v=this.readSync(r.dataId),w=r.strides,b=w[0],N=w[1],_=w[2],C=w[3],k=this.readSync(n.dataId),j=n.strides,S=j[0],M=j[1],D=j[2],A=j[3],B=a.padInfo.front,F=a.padInfo.left,U=a.padInfo.top,V=0;V<c;++V)for(var P=Math.max(0,Math.ceil((B-V)/s)),$=Math.min(a.outDepth,(a.inDepth+B-V)/s),I=V*m,q=0;q<u;++q)for(var X=Math.max(0,Math.ceil((U-q)/o)),ne=Math.min(a.outHeight,(a.inHeight+U-q)/o),ie=q*x+I,le=0;le<d;++le)for(var pe=Math.max(0,Math.ceil((F-le)/l)),_e=Math.min(a.outWidth,(a.inWidth+F-le)/l),G=le*y+ie,re=0;re<a.inChannels;++re)for(var Ce=re*g+G,H=0;H<a.outChannels;++H){for(var O=0,Q=0;Q<a.batchSize;++Q)for(var oe=Q*S,ue=Q*b,W=P;W<$;++W)for(var ae=(V+W*s-B)*M+oe,je=W*N+ue,de=X;de<ne;++de)for(var Le=(q+de*o-U)*D+ae,qe=de*_+je,Oe=pe;Oe<_e;++Oe){var ee=Oe*C+qe;O+=k[(le+Oe*l-F)*A+Le+re]*v[ee+H]}f[Ce+H]=O}return h.toTensor()},t.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,a=n.filter,s=n.convInfo,o=n.bias,l=n.activation,c=n.preluActivationWeights,u=this.depthwiseConv2D(r,a,s);return o&&(u=this.add(u,o)),l&&(u=Gu(this,u,l,c)),u},t.prototype.depthwiseConv2D=function(n,r,a){te([n,r],"depthwiseConv2D");for(var s=a.filterHeight,o=a.filterWidth,l=a.dilationHeight,c=a.dilationWidth,u=a.padInfo.left,d=a.padInfo.top,h=a.outChannels/a.inChannels,f=De(a.outShape,n.dtype),p=this.readSync(n.dataId),m=this.readSync(r.dataId),x=f.values,y=0;y<a.batchSize;++y)for(var g=y*n.strides[0],v=y*f.strides[0],w=0;w<a.outHeight;++w)for(var b=v+w*f.strides[1],N=w*a.strideHeight-u,_=0;_<s;++_){var C=N+_*l;if(!(C<0||C>=a.inHeight))for(var k=_*r.strides[0],j=g+C*n.strides[1],S=0;S<a.outWidth;++S)for(var M=b+S*f.strides[2],D=S*a.strideWidth-d,A=0;A<o;++A){var B=D+A*c;if(!(B<0||B>=a.inWidth))for(var F=k+A*r.strides[1],U=j+B*a.inChannels,V=M,P=F,$=0;$<a.inChannels;++$){for(var I=p[U+$],q=0;q<h;++q)x[V+q]+=I*m[P+q];V+=h,P+=h}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(n,r,a){te([n,r],"depthwiseConv2DDerInput");for(var s=De(a.inShape,"float32"),o=s.values,l=s.strides,c=l[0],u=l[1],d=l[2],h=this.readSync(n.dataId),f=n.strides,p=f[0],m=f[1],x=f[2],y=this.readSync(r.dataId),g=r.strides,v=g[0],w=g[1],b=g[2],N=a.batchSize,_=a.filterHeight,C=a.filterWidth,k=a.inChannels,j=a.inHeight,S=a.inWidth,M=a.outChannels,D=a.outHeight,A=a.outWidth,B=a.strideHeight,F=a.strideWidth,U=_-1-a.padInfo.top,V=C-1-a.padInfo.left,P=M/k,$=0;$<N;++$)for(var I=0;I<k;++I)for(var q=0;q<j;++q)for(var X=q-U,ne=Math.max(0,Math.ceil(X/B)),ie=Math.min(D,(_+X)/B),le=0;le<S;++le){for(var pe=le-V,_e=Math.max(0,Math.ceil(pe/F)),G=Math.min(A,(C+pe)/F),re=0,Ce=ne;Ce<ie;++Ce)for(var H=Ce*B-X,O=_e;O<G;++O)for(var Q=p*$+m*Ce+x*O,oe=v*(_-1-H)+w*(C-1-(O*F-pe))+b*I,ue=0;ue<P;++ue)re+=h[Q+(I*P+ue)]*y[oe+ue];o[c*$+u*q+d*le+I]=re}return s.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(n,r,a){te([n,r],"depthwiseConv2DDerFilter");for(var s=a.strideHeight,o=a.strideWidth,l=a.filterHeight,c=a.filterWidth,u=De(a.filterShape,"float32"),d=a.padInfo.left,h=a.padInfo.top,f=a.outChannels/a.inChannels,p=this.bufferSync(n),m=this.bufferSync(r),x=0;x<l;++x)for(var y=Math.max(0,Math.ceil((h-x)/s)),g=Math.min(a.outHeight,(a.inHeight+h-x)/s),v=0;v<c;++v)for(var w=Math.max(0,Math.ceil((d-v)/o)),b=Math.min(a.outWidth,(a.inWidth+d-v)/o),N=0;N<a.outChannels;++N){for(var _=Math.trunc(N/f),C=N%f,k=0,j=0;j<a.batchSize;++j)for(var S=y;S<g;++S)for(var M=x+S*s-h,D=w;D<b;++D){var A=v+D*o-d;k+=p.get(j,M,A,_)*m.get(j,S,D,N)}u.set(k,x,v,_,C)}return u.toTensor()},t.prototype.tile=function(n,r){return te(n,"tile"),yy(this.bufferSync(n),r)},t.prototype.pad=function(n,r,a){te(n,"pad");var s=r.map(function(f,p){return f[0]+n.shape[p]+f[1]}),o=r.map(function(f){return f[0]}),l=this.bufferSync(n),c=De(s,n.dtype);a!==0&&c.values.fill(a);for(var u=0;u<n.size;u++){var d=l.indexToLoc(u),h=d.map(function(f,p){return f+o[p]});c.set.apply(c,[l.get.apply(l,d)].concat(h))}return c.toTensor()},t.prototype.transpose=function(n,r){te(n,"transpose");for(var a=new Array(n.rank),s=0;s<a.length;s++)a[s]=n.shape[r[s]];var o=this.readSync(n.dataId),l=De(a,n.dtype),c=this.bufferSync(n);for(s=0;s<n.size;++s){for(var u=c.indexToLoc(s),d=new Array(u.length),h=0;h<d.length;h++)d[h]=u[r[h]];var f=l.locToIndex(d);l.values[f]=o[s]}return l.toTensor()},t.prototype.gather=function(n,r,a){te([n,r],"gather");var s=n.shape.slice(),o=this.readSync(r.dataId);s[a]=o.length;for(var l=De(s,n.dtype),c=this.bufferSync(n),u=0;u<l.size;++u){var d=l.indexToLoc(u),h=d.slice();h[a]=o[d[a]];var f=c.locToIndex(h);l.values[u]=c.values[f]}return l.toTensor()},t.prototype.batchToSpaceND=function(n,r,a){te([n],"batchToSpaceND");var s=r.reduce(function(h,f){return h*f}),o=oc(n.shape,r,s),l=ic(o.length,r.length),c=lc(n.shape,r,s),u=oy(a,r.length),d=iy(c,a,r.length);return n.reshape(o).transpose(l).reshape(c).slice(u,d)},t.prototype.spaceToBatchND=function(n,r,a){te([n],"spaceToBatchND");var s=r.reduce(function(f,p){return f*p}),o=[[0,0]];o.push.apply(o,a);for(var l=1+r.length;l<n.shape.length;++l)o.push([0,0]);var c=n.pad(o),u=oc(c.shape,r,s,!1),d=ic(u.length,r.length,!1),h=lc(c.shape,r,s,!1);return c.reshape(u).transpose(d).reshape(h)},t.prototype.pool=function(n,r,a){te(n,"pool");for(var s=r.strideHeight,o=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,p=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(n.dataId),x=De(r.outShape,n.dtype),y=x.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],v=r.outShape[2]*r.outShape[3],w=r.outShape[3],b=0;b<r.batchSize;++b)for(var N=b*g,_=b*n.strides[0],C=0;C<r.inChannels;++C)for(var k=0;k<r.outHeight;++k)for(var j=k*s-h,S=Math.max(0,j),M=Math.min(r.inHeight,u+j),D=N+k*v,A=0;A<r.outWidth;++A){for(var B=A*o-f,F=Math.max(0,B),U=Math.min(r.inWidth,d+B),V=p,P=0,$=0,I=S;I<M;I+=l){for(var q=_+I*n.strides[1],X=F;X<U;X+=c){var ne=m[q+X*n.strides[2]+C];a==="max"&&ne>V?V=ne:a==="avg"&&(P+=ne,$++)}if(isNaN(V))break}y[D+A*w+C]=a==="avg"?P/$:V}return x.toTensor()},t.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},t.prototype.maxPoolPositions=function(n,r){for(var a=De(r.outShape,"int32"),s=r.strideHeight,o=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,p=this.bufferSync(n),m=0;m<r.batchSize;++m)for(var x=0;x<r.inChannels;++x)for(var y=0;y<r.outHeight;++y){for(var g=y*s-h,v=g;v<0;)v+=l;for(var w=Math.min(r.inHeight,u+g),b=0;b<r.outWidth;++b){for(var N=b*o-f,_=N;_<0;)_+=c;for(var C=Math.min(r.inWidth,d+N),k=Number.NEGATIVE_INFINITY,j=-1,S=v;S<w;S+=l)for(var M=S-g,D=_;D<C;D+=c){var A=D-N,B=p.get(m,S,D,x);B>k&&(k=B,j=M*d+A)}a.set(j,m,y,b,x)}}return a.toTensor()},t.prototype.maxPoolBackprop=function(n,r,a,s){te([r,a],"maxPoolBackprop");for(var o=this.maxPoolPositions(r,s),l=s.strideHeight,c=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,h=s.effectiveFilterHeight,f=s.effectiveFilterWidth,p=f-1-s.padInfo.left,m=h-1-s.padInfo.top,x=De(r.shape,"float32"),y=this.bufferSync(o),g=this.bufferSync(n),v=0;v<s.batchSize;++v)for(var w=0;w<s.inChannels;++w)for(var b=0;b<s.inHeight;++b)for(var N=0;N<s.inWidth;++N){for(var _=b-m,C=N-p,k=0,j=0;j<h;j+=u){var S=(_+j)/l;if(!(S<0||S>=s.outHeight||Math.floor(S)!==S))for(var M=0;M<f;M+=d){var D=(C+M)/c;if(!(D<0||D>=s.outWidth||Math.floor(D)!==D)){var A=h*f-1-y.get(v,S,D,w)===j*f+M?1:0;A!==0&&(k+=g.get(v,S,D,w)*A)}}}x.set(k,v,b,N,w)}return x.toTensor()},t.prototype.avgPoolBackprop=function(n,r,a){te([n,r],"avgPoolBackprop");for(var s=a.strideHeight,o=a.strideWidth,l=a.filterHeight,c=a.filterWidth,u=a.dilationHeight,d=a.dilationWidth,h=a.effectiveFilterHeight,f=a.effectiveFilterWidth,p=f-1-a.padInfo.left,m=h-1-a.padInfo.top,x=De(r.shape,"float32"),y=1/(l*c),g=this.bufferSync(n),v=0;v<a.batchSize;++v)for(var w=0;w<a.inChannels;++w)for(var b=0;b<a.inHeight;++b)for(var N=0;N<a.inWidth;++N){for(var _=b-m,C=N-p,k=0,j=0;j<h;j+=u){var S=(_+j)/s;if(!(S<0||S>=a.outHeight||Math.floor(S)!==S))for(var M=0;M<f;M+=d){var D=(C+M)/o;D<0||D>=a.outWidth||Math.floor(D)!==D||(k+=g.get(v,S,D,w))}}x.set(k*y,v,b,N,w)}return x.toTensor()},t.prototype.pool3d=function(n,r,a){te(n,"pool3d");for(var s=r.strideDepth,o=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,g=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(n.dataId),w=De(r.outShape,n.dtype),b=w.values,N=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],k=r.outShape[4],j=0;j<r.batchSize;++j)for(var S=j*N,M=j*n.strides[0],D=0;D<r.inChannels;++D)for(var A=0;A<r.outDepth;++A){for(var B=A*s-m,F=B;F<0;)F+=c;for(var U=Math.min(r.inDepth,h+B),V=S+A*_,P=0;P<r.outHeight;++P){for(var $=P*o-x,I=$;I<0;)I+=u;for(var q=Math.min(r.inHeight,f+$),X=V+P*C,ne=0;ne<r.outWidth;++ne){for(var ie=ne*l-y,le=ie;le<0;)le+=d;for(var pe=Math.min(r.inWidth,p+ie),_e=X+ne*k,G=g,re=0,Ce=0,H=F;H<U;H+=c){for(var O=M+H*n.strides[1],Q=I;Q<q;Q+=u){for(var oe=O+Q*n.strides[2],ue=le;ue<pe;ue+=d){var W=v[oe+ue*n.strides[3]+D];if(a==="max"&&W>G?G=W:a==="avg"&&(re+=W,Ce++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}b[_e+D]=a==="avg"?re/Ce:G}}}return w.toTensor()},t.prototype.avgPool3d=function(n,r){return te(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(n,r,a){te([n,r],"avgPool3dBackprop");for(var s=a.strideDepth,o=a.strideHeight,l=a.strideWidth,c=a.filterDepth,u=a.filterHeight,d=a.filterWidth,h=a.dilationDepth,f=a.dilationHeight,p=a.dilationWidth,m=a.effectiveFilterDepth,x=a.effectiveFilterHeight,y=a.effectiveFilterWidth,g=m-1-a.padInfo.front,v=y-1-a.padInfo.left,w=x-1-a.padInfo.top,b=De(r.shape,"float32"),N=1/(c*u*d),_=this.bufferSync(n),C=0;C<a.batchSize;++C)for(var k=0;k<a.inChannels;++k)for(var j=0;j<a.inDepth;++j)for(var S=0;S<a.inHeight;++S)for(var M=0;M<a.inWidth;++M){for(var D=j-g,A=S-w,B=M-v,F=0,U=0;U<m;U+=h){var V=(D+U)/s;if(!(V<0||V>=a.outDepth||Math.floor(V)!==V))for(var P=0;P<x;P+=f){var $=(A+P)/o;if(!($<0||$>=a.outHeight||Math.floor($)!==$))for(var I=0;I<y;I+=p){var q=(B+I)/l;q<0||q>=a.outWidth||Math.floor(q)!==q||(F+=_.get(C,V,$,q,k))}}}b.set(F*N,C,j,S,M,k)}return b.toTensor()},t.prototype.maxPool3d=function(n,r){return te(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(n,r){for(var a=De(r.outShape,"int32"),s=r.strideDepth,o=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,g=this.bufferSync(n),v=0;v<r.batchSize;++v)for(var w=0;w<r.inChannels;++w)for(var b=0;b<r.outDepth;++b){for(var N=b*s-m,_=N;_<0;)_+=c;for(var C=Math.min(r.inDepth,h+N),k=0;k<r.outHeight;++k){for(var j=k*o-x,S=j;S<0;)S+=u;for(var M=Math.min(r.inHeight,f+j),D=0;D<r.outWidth;++D){for(var A=D*l-y,B=A;B<0;)B+=d;for(var F=Math.min(r.inWidth,p+A),U=Number.NEGATIVE_INFINITY,V=-1,P=_;P<C;P+=c)for(var $=P-N,I=S;I<M;I+=u)for(var q=I-j,X=B;X<F;X+=d){var ne=X-A,ie=g.get(v,P,I,X,w);ie>=U&&(U=ie,V=$*f*p+q*f+ne)}a.set(V,v,b,k,D,w)}}}return a.toTensor()},t.prototype.maxPool3dBackprop=function(n,r,a,s){te([r,a],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(r,s),l=s.strideDepth,c=s.strideHeight,u=s.strideWidth,d=s.dilationDepth,h=s.dilationHeight,f=s.dilationWidth,p=s.effectiveFilterDepth,m=s.effectiveFilterHeight,x=s.effectiveFilterWidth,y=p-1-s.padInfo.front,g=x-1-s.padInfo.left,v=m-1-s.padInfo.top,w=De(r.shape,"float32"),b=this.bufferSync(o),N=this.bufferSync(n),_=0;_<s.batchSize;++_)for(var C=0;C<s.inChannels;++C)for(var k=0;k<s.inDepth;++k)for(var j=0;j<s.inHeight;++j)for(var S=0;S<s.inWidth;++S){for(var M=k-y,D=j-v,A=S-g,B=0,F=0;F<p;F+=d){var U=(M+F)/l;if(!(U<0||U>=s.outDepth||Math.floor(U)!==U))for(var V=0;V<m;V+=h){var P=(D+V)/c;if(!(P<0||P>=s.outHeight||Math.floor(P)!==P))for(var $=0;$<x;$+=f){var I=(A+$)/u;if(!(I<0||I>=s.outWidth||Math.floor(I)!==I)){var q=p*m*x-1-b.get(_,U,P,I,C)===F*m*x+V*x+$?1:0;q!==0&&(B+=N.get(_,U,P,I,C)*q)}}}}w.set(B,_,k,j,S,C)}return w.toTensor()},t.prototype.cast=function(n,r){return my(n,r,this)},t.prototype.reshape=function(n,r){return vh(n,r)},t.prototype.avgPool=function(n,r){return te(n,"avgPool"),this.pool(n,r,"avg").toFloat()},t.prototype.resizeBilinear=function(n,r,a,s){te(n,"resizeBilinear");for(var o=n.shape,l=o[0],c=o[1],u=o[2],d=o[3],h=this.readSync(n.dataId),f=new Float32Array(xe([l,r,a,d])),p=[s&&r>1?c-1:c,s&&a>1?u-1:u],m=[s&&r>1?r-1:r,s&&a>1?a-1:a],x=0,y=p[0]/m[0],g=p[1]/m[1],v=0;v<l;v++)for(var w=0;w<r;w++)for(var b=y*w,N=Math.floor(b),_=b-N,C=Math.min(c-1,Math.ceil(b)),k=v*n.strides[0]+N*n.strides[1],j=v*n.strides[0]+C*n.strides[1],S=0;S<a;S++)for(var M=g*S,D=Math.floor(M),A=M-D,B=Math.min(u-1,Math.ceil(M)),F=k+D*n.strides[2],U=j+D*n.strides[2],V=k+B*n.strides[2],P=j+B*n.strides[2],$=0;$<d;$++){var I=h[F+$],q=h[U+$],X=I+(h[V+$]-I)*A,ne=X+(q+(h[P+$]-q)*A-X)*_;f[x++]=ne}return Ot(f,[l,r,a,d])},t.prototype.resizeBilinearBackprop=function(n,r,a){te([n,r],"resizeBilinearBackprop");for(var s=r.shape,o=s[0],l=s[1],c=s[2],u=s[3],d=n.shape,h=d[1],f=d[2],p=new Float32Array(o*l*c*u),m=[a&&h>1?l-1:l,a&&f>1?c-1:c],x=[a&&h>1?h-1:h,a&&f>1?f-1:f],y=m[0]/x[0],g=m[1]/x[1],v=this.readSync(n.dataId),w=0,b=0;b<o;b++)for(var N=b*r.strides[0],_=0;_<h;_++)for(var C=_*y,k=Math.floor(C),j=Math.min(Math.ceil(C),l-1),S=N+k*r.strides[1],M=N+j*r.strides[1],D=C-k,A=1-D,B=0;B<f;B++)for(var F=B*g,U=Math.floor(F),V=Math.min(Math.ceil(F),c-1),P=F-U,$=1-P,I=S+U*r.strides[2],q=S+V*r.strides[2],X=M+U*r.strides[2],ne=M+V*r.strides[2],ie=A*$,le=A*P,pe=D*$,_e=D*P,G=0;G<u;G++){var re=v[w++];p[I+G]+=re*ie,p[q+G]+=re*le,p[X+G]+=re*pe,p[ne+G]+=re*_e}return rn(p,[o,c,l,u],r.dtype)},t.prototype.resizeNearestNeighbor=function(n,r,a,s){te(n,"resizeNearestNeighbor");for(var o=n.shape,l=o[0],c=o[1],u=o[2],d=o[3],h=this.readSync(n.dataId),f=new Float32Array(l*r*a*d),p=[s&&r>1?c-1:c,s&&a>1?u-1:u],m=[s&&r>1?r-1:r,s&&a>1?a-1:a],x=p[0]/m[0],y=p[1]/m[1],g=0,v=0;v<l;v++)for(var w=v*n.strides[0],b=0;b<r;b++)for(var N=x*b,_=w+Math.min(c-1,s?Math.round(N):Math.floor(N))*n.strides[1],C=0;C<a;C++)for(var k=y*C,j=_+Math.min(u-1,s?Math.round(k):Math.floor(k))*n.strides[2],S=0;S<d;S++){var M=h[j+S];f[g++]=M}return Ot(f,[l,r,a,d],n.dtype)},t.prototype.resizeNearestNeighborBackprop=function(n,r,a){te([n,r],"resizeNearestNeighborBackprop");for(var s=r.shape,o=s[0],l=s[1],c=s[2],u=s[3],d=n.shape,h=d[1],f=d[2],p=new Float32Array(o*l*c*u),m=this.readSync(n.dataId),x=[a&&h>1?l-1:l,a&&f>1?c-1:c],y=[a&&h>1?h-1:h,a&&f>1?f-1:f],g=x[0]/y[0],v=x[1]/y[1],w=1/g,b=1/v,N=2*Math.ceil(w)+2,_=2*Math.ceil(b)+2,C=0;C<o;C++)for(var k=C*r.strides[0],j=0;j<l;j++)for(var S=k+j*r.strides[1],M=Math.floor(j*w),D=Math.floor(M-N/2),A=0;A<c;A++)for(var B=S+A*r.strides[2],F=Math.floor(A*b),U=Math.floor(F-_/2),V=0;V<u;V++){for(var P=0,$=0;$<N;$++){var I=$+D;if(!(I<0||I>=h)){var q=k+I*n.strides[1],X=I*g;if(j===Math.min(l-1,a?Math.round(X):Math.floor(X)))for(var ne=0;ne<_;ne++){var ie=ne+U;if(!(ie<0||ie>=f)){var le=q+ie*n.strides[2],pe=ie*v;A===Math.min(c-1,a?Math.round(pe):Math.floor(pe))&&(P+=m[le+V])}}}}p[B+V]=P}return rn(p,r.shape,r.dtype)},t.prototype.batchNormalization=function(n,r,a,s,o,l){te([n,r,a,o,l],"batchNorm");for(var c=this.readSync(n.dataId),u=this.readSync(r.dataId),d=this.readSync(a.dataId),h=o?this.readSync(o.dataId):new Float32Array([1]),f=l?this.readSync(l.dataId):new Float32Array([0]),p=new Float32Array(c.length),m=f.length,x=h.length,y=d.length,g=u.length,v=0,w=0,b=0,N=0,_=0;_<c.length;++_)p[_]=f[v++]+(c[_]-u[w++])*h[b++]/Math.sqrt(d[N++]+s),v>=m&&(v=0),w>=g&&(w=0),b>=x&&(b=0),N>=y&&(N=0);return rn(p,n.shape)},t.prototype.localResponseNormalization4D=function(n,r,a,s,o){te(n,"localResponseNormalization4D");var l=n.shape[3],c=l-1,u=this.readSync(n.dataId),d=n.size,h=new Float32Array(d);function f(y){for(var g=y%l,v=y-g+Math.max(0,g-r),w=y-g+Math.min(g+r,c),b=0;v<=w;v++){var N=u[v];b+=N*N}return b}for(var p=0;p<d;p++){var m=f(p),x=u[p]*Math.pow(a+s*m,-o);h[p]=x}return rn(h,n.shape)},t.prototype.LRNGrad=function(n,r,a,s,o,l,c){te(n,"LRNGrad");for(var u=n.shape[3],d=this.readSync(n.dataId),h=this.readSync(r.dataId),f=this.readSync(a.dataId),p=new Float32Array(n.size),m=n.size,x=0;x<m;x++){for(var y=x%u,g=x-y+Math.max(0,y-s),v=x-y+Math.min(u,y+s+1),w=0,b=g;b<v;b++)w+=Math.pow(h[b],2);for(w=l*w+o,b=g;b<v;b++){var N=-2*l*c*h[b]*f[x]/w;x===b&&(N+=Math.pow(w,-c)),N*=d[x],p[b]+=N}}return rn(p,n.shape)},t.prototype.multinomial=function(n,r,a,s){te(n,"multinomial");for(var o=r?n:Mr(n),l=o.shape[0],c=o.shape[1],u=Je([l,a],"int32"),d=this.readSync(u.dataId),h=this.readSync(o.dataId),f=0;f<l;++f){var p=f*c,m=new Float32Array(c-1);m[0]=h[p];for(var x=1;x<m.length;++x)m[x]=m[x-1]+h[p+x];for(var y=$c(s.toString()),g=f*a,v=0;v<a;++v){var w=y();d[g+v]=m.length;for(var b=0;b<m.length;b++)if(w<m[b]){d[g+v]=b;break}}}return u},t.prototype.oneHot=function(n,r,a,s){te(n,"oneHot");var o=new Float32Array(n.size*r);o.fill(s);for(var l=this.readSync(n.dataId),c=0;c<n.size;++c)l[c]>=0&&l[c]<r&&(o[c*r+l[c]]=a);return ua(o,[n.size,r],"int32")},t.prototype.nonMaxSuppression=function(n,r,a,s,o){return te(n,"nonMaxSuppression"),Bf(this.readSync(n.dataId),this.readSync(r.dataId),a,s,o)},t.prototype.fft=function(n){return this.fftBatch(n,!1)},t.prototype.ifft=function(n){return this.fftBatch(n,!0)},t.prototype.fftBatch=function(n,r){for(var a=n.shape[0],s=n.shape[1],o=De(n.shape,"float32"),l=De(n.shape,"float32"),c=Dn(n).as2D(a,s),u=ir(n).as2D(a,s),d=0;d<a;d++)for(var h=c.slice([d,0],[1,s]),f=u.slice([d,0],[1,s]),p=Ft(h,f),m=this.readSync(this.fftImpl(p,r).dataId),x=0;x<s;x++){var y=vg(m,x);o.values[d*s+x]=y.real,l.values[d*s+x]=y.imag}return Ft(o.toTensor(),l.toTensor()).as2D(a,s)},t.prototype.fftImpl=function(n,r){var a=n.as1D(),s=a.size;if(this.isExponentOf2(s)){var o=this.fftRadix2(a,s,r).as2D(n.shape[0],n.shape[1]);return r&&(o=Ft(Dn(o).div(ce(s)),ir(o).div(ce(s)))),o}var l=this.readSync(n.dataId),c=function(u){for(var d=new Float32Array(u.length/2),h=new Float32Array(u.length/2),f=0;f<u.length;f+=2)d[f/2]=u[f],h[f/2]=u[f+1];return{real:d,imag:h}}(this.fourierTransformByMatmul(l,s,r));return Ft(c.real,c.imag).as2D(n.shape[0],n.shape[1])},t.prototype.isExponentOf2=function(n){return(n&n-1)==0},t.prototype.fftRadix2=function(n,r,a){if(r===1)return n;var s=this.readSync(n.dataId),o=r/2,l=function(g){for(var v=Math.ceil(g.length/4),w=new Float32Array(v),b=new Float32Array(v),N=0;N<g.length;N+=4)w[Math.floor(N/4)]=g[N],b[Math.floor(N/4)]=g[N+1];return{real:w,imag:b}}(s),c=Ft(l.real,l.imag).as1D(),u=function(g){for(var v=Math.floor(g.length/4),w=new Float32Array(v),b=new Float32Array(v),N=2;N<g.length;N+=4)w[Math.floor(N/4)]=g[N],b[Math.floor(N/4)]=g[N+1];return{real:w,imag:b}}(s),d=Ft(u.real,u.imag).as1D();c=this.fftRadix2(c,o,a),d=this.fftRadix2(d,o,a);var h=function(g,v){for(var w=new Float32Array(g/2),b=new Float32Array(g/2),N=0;N<Math.ceil(g/2);N++){var _=(v?2:-2)*Math.PI*(N/g);w[N]=Math.cos(_),b[N]=Math.sin(_)}return{real:w,imag:b}}(r,a),f=Ft(h.real,h.imag).mul(d),p=c.add(f),m=c.sub(f),x=Dn(p).concat(Dn(m)),y=ir(p).concat(ir(m));return Ft(x,y).as1D()},t.prototype.fourierTransformByMatmul=function(n,r,a){for(var s=new Float32Array(2*r),o=0;o<r;o++){for(var l=0,c=0,u=0;u<r;u++){var d=qk(o*u,r,a),h=vg(n,u);l+=h.real*d.real-h.imag*d.imag,c+=h.real*d.imag+h.imag*d.real}a&&(l/=r,c/=r),Vk(s,l,c,o)}return s},t.prototype.depthToSpace=function(n,r,a){T(a==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+a}),T(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var s=n.shape[0],o=n.shape[1],l=n.shape[2],c=n.shape[3],u=o*r,d=l*r,h=c/(r*r),f=this.readSync(n.dataId),p=new Float32Array(s*u*d*h),m=0,x=0;x<s;++x)for(var y=0;y<u;++y)for(var g=Math.floor(y/r),v=y%r,w=0;w<d;++w)for(var b=Math.floor(w/r),N=(v*r+w%r)*h,_=0;_<h;++_){var C=_+N+c*(b+l*(g+o*x));p[m++]=f[C]}return rn(p,[s,u,d,h])},t.prototype.broadcastedBinaryOp=function(n,r,a,s){var o=Pe(n.shape,r.shape),l=De(o,a),c=this.readSync(n.dataId),u=this.readSync(r.dataId),d=Jr(n.shape,o),h=Jr(r.shape,o),f=l.values;if(d.length+h.length===0)for(var p=0;p<f.length;++p)f[p]=s(c[p%c.length],u[p%u.length]);else{var m=this.bufferSync(n),x=this.bufferSync(r),y=function(g){var v=l.indexToLoc(g),w=v.slice(-n.rank);d.forEach(function(C){return w[C]=0});var b=m.locToIndex(w),N=v.slice(-r.rank);h.forEach(function(C){return N[C]=0});var _=x.locToIndex(N);f[g]=s(c[b],u[_])};for(p=0;p<f.length;++p)y(p)}return l.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(n,r,a){var s=Pe(n.shape,r.shape),o=De(s,"float32"),l=De(s,"float32"),c=this.readSync(n.dataId),u=this.readSync(r.dataId),d=Jr(n.shape,s),h=Jr(r.shape,s),f=o.values,p=l.values;if(d.length+h.length===0)for(var m=0;m<f.length;m++){var x=m%c.length,y=m%u.length,g=a(c[2*x],c[2*x+1],u[2*y],u[2*y+1]);f[m]=g.real,p[m]=g.imag}else{var v=this.bufferSync(this.data.get(n.dataId).complexTensors.real),w=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(N){var _=o.indexToLoc(N),C=_.slice(-n.rank);d.forEach(function(D){return C[D]=0});var k=v.locToIndex(C),j=_.slice(-r.rank);h.forEach(function(D){return j[D]=0});var S=w.locToIndex(j),M=a(c[2*k],c[2*k+1],u[2*S],u[2*S+1]);f[N]=M.real,p[N]=M.imag};for(m=0;m<f.length;m++)b(m)}return this.complex(o.toTensor(),l.toTensor())},t.prototype.split=function(n,r,a){return xy(n,r,a)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(n,r,a,s,o,l){for(var c=n.shape,u=c[0],d=c[1],h=c[2],f=c[3],p=r.shape[0],m=s[0],x=s[1],y=De([p,m,x,f],"float32"),g=this.readSync(r.dataId),v=this.readSync(a.dataId),w=this.readSync(n.dataId),b=n.strides,N=y.strides,_=0;_<p;_++){var C=4*_,k=g[C],j=g[C+1],S=g[C+2],M=g[C+3],D=v[_];if(!(D>=u))for(var A=m>1?(S-k)*(d-1)/(m-1):0,B=x>1?(M-j)*(h-1)/(x-1):0,F=0;F<m;F++){var U=m>1?k*(d-1)+F*A:.5*(k+S)*(d-1);if(U<0||U>d-1)for(var V=0;V<x;V++)for(var P=0;P<f;P++){var $=P+V*N[2]+F*N[1]+_*N[0];y.values[$]=l}else if(o==="bilinear"){var I=Math.floor(U),q=Math.ceil(U),X=U-I;for(V=0;V<x;V++)if((H=x>1?j*(h-1)+V*B:.5*(j+M)*(h-1))<0||H>h-1)for(P=0;P<f;P++)$=P+V*N[2]+F*N[1]+_*N[0],y.values[$]=l;else{var ne=Math.floor(H),ie=Math.ceil(H),le=H-ne;for(P=0;P<f;P++){var pe=w[$=P+ne*b[2]+I*b[1]+D*b[0]],_e=w[$=P+ie*b[2]+I*b[1]+D*b[0]],G=w[$=P+ne*b[2]+q*b[1]+D*b[0]],re=pe+(_e-pe)*le,Ce=G+(w[$=P+ie*b[2]+q*b[1]+D*b[0]]-G)*le;$=P+V*N[2]+F*N[1]+_*N[0],y.values[$]=re+(Ce-re)*X}}}else for(V=0;V<x;++V){var H;if((H=x>1?j*(h-1)+V*B:.5*(j+M)*(h-1))<0||H>h-1)for(P=0;P<f;P++)$=P+V*N[2]+F*N[1]+_*N[0],y.values[$]=l;else{var O=Math.round(H),Q=Math.round(U);for(P=0;P<f;P++){var oe=P+O*b[2]+Q*b[1]+D*b[0],ue=P+V*N[2]+F*N[1]+_*N[0];y.values[ue]=w[oe]}}}}}return y.toTensor()},t.prototype.sparseToDense=function(n,r,a,s){var o=cc(0,n,a),l=o.sliceRank,c=o.numUpdates,u=o.sliceSize,d=o.strides,h=o.outputSize;return this.scatter(n,r,a,h,u,c,l,d,s,!1)},t.prototype.gatherND=function(n,r){var a=r.shape,s=a[a.length-1],o=ly(n,r),l=o[0],c=o[1],u=o[2],d=o[3];if(c===0)return Ot([],l,n.dtype);for(var h=new di([c,u],n.dtype),f=this.readSync(r.dataId),p=this.readSync(n.dataId),m=0;m<c;m++){for(var x=[],y=0,g=0;g<s;g++){var v=f[m*s+g];y+=v*d[g],x.push(v)}if(y<0||y>=n.size/u)throw new Error("Invalid indices: "+x+" does not index into "+n.shape);for(var w=0;w<u;w++)h.values[m*u+w]=p[y*u+w]}return h.toTensor().reshape(l)},t.prototype.scatterND=function(n,r,a){var s=cc(0,n,a),o=s.sliceRank,l=s.numUpdates,c=s.sliceSize,u=s.strides,d=s.outputSize,h=ce(0);return this.scatter(n,r,a,d,c,l,o,u,h,!0)},t.prototype.fill=function(n,r,a){var s=Zl(a=a||Ni(r),xe(n));return s.fill(r),z.makeTensor(s,n,a,this)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){var r=Zl(n.dtype,xe(n.shape));return this.makeOutput(r,n.shape,n.dtype)},t.prototype.linspace=function(n,r,a){return gy(n,r,a)},t.prototype.scatter=function(n,r,a,s,o,l,c,u,d,h){var f=[s/o,o],p=this.readSync(n.dataId),m=this.readSync(r.dataId);if(s===0)return Ot([],a,r.dtype);var x=new di(f,r.dtype);x.values.fill(this.readSync(d.dataId)[0]);for(var y=0;y<l;y++){for(var g=[],v=0,w=0;w<c;w++){var b=p[y*c+w];g.push(b),v+=b*u[w]}if(v<0||v>=s/o)throw new Error("Invalid indices: "+g+" does not index into "+a);for(var N=0;N<o;N++)h?x.values[v*o+N]+=m[y*o+N]:x.values[v*o+N]=r.rank===0?m[0]:m[y*o+N]}return x.toTensor().reshape(a)},t}(fy);z.registerBackend("cpu",function(){return new d3},1);for(var Ku=0,Bg=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t,s=a.boxes,o=a.scores,l=r,c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h=l.softNmsSigma,f=n;te(s,"NonMaxSuppressionWithScore");var p=$f(f.data.get(s.dataId).values,f.data.get(o.dataId).values,c,u,d,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;te(r,"square");for(var s=a.data.get(r.dataId).values,o=new Float32Array(s.length),l=0;l<s.length;++l){var c=s[l];o[l]=c*c}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:pi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,s=r.b,o=n;te([a,s],pi);var l=o.data.get(a.dataId).values,c=o.data.get(s.dataId).values,u=function(f,p,m,x,y,g){var v=Pe(f,p),w=v.length,b=hr(v),N=ui(y,xe(v)),_=f.length,C=p.length,k=hr(f),j=hr(p),S=Jr(f,v),M=Jr(p,v);if(S.length+M.length===0)for(var D=0;D<N.length;++D)N[D]=g(m[D%m.length],x[D%x.length]);else{var A=function(B){var F=wj(B,w,b),U=F.slice(-_);S.forEach(function(I){return U[I]=0});var V=lg(U,_,k),P=F.slice(-C);M.forEach(function(I){return P[I]=0});var $=lg(P,C,j);N[B]=g(m[V],x[$])};for(D=0;D<N.length;++D)A(D)}return[N,v]}(a.shape,s.shape,l,c,a.dtype,function(f,p){var m=f-p;return m*m}),d=u[0],h=u[1];return{dataId:o.write(d,h,a.dtype),shape:h,dtype:a.dtype}}}];Ku<Bg.length;Ku++)W0(Bg[Ku]);var os,h3=function(e){this.variableNames=["A"];var t=Ht(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+n+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},f3=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Ht(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+n+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `};for(var Xu=0,$g=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,s=r.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,c=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],u=c[0],d=c[1],h=[d,u],f=[d,u,s];(l||o)&&(os==null&&(os=document.createElement("canvas").getContext("2d")),os.canvas.width=u,os.canvas.height=d,os.drawImage(a,0,0,u,d),a=os.canvas);var p=n.makeTensorInfo(h,"int32");n.texData.get(p.dataId).usage=xn.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);var m=J().getBool("WEBGL_PACK")?new f3(f):new h3(f),x=n.runWebGLProgram(m,[p],"int32");return n.disposeData(p.dataId),x}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;rc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t,s=a.boxes,o=a.scores,l=r,c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h=l.softNmsSigma,f=n,p=$f(f.readSync(s.dataId),f.readSync(o.dataId),c,u,d,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n,s=new Ae(r.shape,"return x * x;");return a.runWebGLProgram(s,[r],r.dtype)}},{kernelName:pi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,s=r.b,o=n,l=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wr("return (a - b) * (a - b);",a.shape,s.shape):new lt("return (a - b) * (a - b);",a.shape,s.shape);return o.compileAndRun(l,[a,s])}}];Xu<$g.length;Xu++)W0($g[Xu]);for(var Yu=0,Wg=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:pi,gradFunc:function(e,t){var n=t[0],r=t[1],a=ce(2);return{a:function(){return Kt(e,Kt(a,kt(n,r)))},b:function(){return Kt(e,Kt(a,kt(r,n)))}}}}];Yu<Wg.length;Yu++)uj(Wg[Yu]);var p3=function(){function e(){}return e.prototype.fetch=function(t,n){return fetch(t,n)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return new TextDecoder(n).decode(t)},e}();J().get("IS_BROWSER")&&J().setPlatform("browser",new p3);var Qu,m3=function(){return require("node-fetch")},g3=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(t,n){return J().global.fetch!=null?J().global.fetch(t,n):(Qu==null&&(Qu=m3()),Qu(t,n))},e.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)},e}();J().get("IS_NODE")&&J().setPlatform("node",new g3);var bh={float32:4,int32:4,uint16:2,uint8:1,bool:1},gc=4;function ub(e,t){for(var n={},r=0,a=function(l){var c=l.name,u=l.dtype,d=l.shape,h=xe(d),f=void 0;if("quantization"in l){var p=l.quantization;if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error("Weight "+l.name+" has unknown quantization dtype "+p.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var m=bh[p.dtype],x=e.slice(r,r+h*m),y=p.dtype==="uint8"?new Uint8Array(x):new Uint16Array(x);if(u==="float32")f=Float32Array.from(y,function(_){return _*p.scale+p.min});else{if(u!=="int32")throw new Error("Unsupported dtype in weight '"+c+"': "+u);f=Int32Array.from(y,function(_){return Math.round(_*p.scale+p.min)})}r+=h*m}else if(u==="string"){var g=xe(l.shape);f=[];for(var v=0;v<g;v++){var w=new Uint32Array(e.slice(r,r+gc))[0];r+=gc;var b=new Uint8Array(e.slice(r,r+w));f.push(b),r+=w}}else{var N=bh[u];if(x=e.slice(r,r+h*N),u==="float32")f=new Float32Array(x);else if(u==="int32")f=new Int32Array(x);else{if(u!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+u);f=new Uint8Array(x)}r+=h*N}n[c]=Ot(f,d,u)},s=0,o=t;s<o.length;s++)a(o[s]);return n}function v3(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(s){if(t+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+s.constructor.name)});var r=new Uint8Array(t),a=0;return n.forEach(function(s){r.set(new Uint8Array(s.buffer),a),a+=s.byteLength}),r.buffer}var wh=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function zg(e){return wh?Buffer.byteLength(e):new Blob([e]).size}function sp(e){var t=0;e.forEach(function(a){t+=a.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(a){n.set(new Uint8Array(a),r),r+=a.byteLength}),n.buffer}function Ug(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Ri(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:zg(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:zg(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var yn=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var a=[];return(n==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(s){var o=s(t,r);o!==null&&a.push(o)}),a},e}(),Ms="://",da=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(t,n){T(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(Ms)&&(t=t.slice(0,t.indexOf(Ms))),T(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();T(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(t){var n=this.getInstance().managers[t];if(n==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return n},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function jl(e){if(e.indexOf(Ms)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+da.getSchemes().join(","));return{scheme:e.split(Ms)[0],path:e.split(Ms)[1]}}function Vg(e,t,n){return n===void 0&&(n=!1),ge(this,void 0,void 0,function(){var r,a,s,o,l,c,u,d,h;return ve(this,function(f){switch(f.label){case 0:return T(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),T((r=yn.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),T(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),a=r[0],T((s=yn.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),T(s.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),o=s[0],l=jl(e).scheme,c=jl(e).path,u=l===jl(e).scheme,[4,a.load()];case 1:return d=f.sent(),n&&u?[4,da.getManager(l).removeModel(c)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,o.save(d)];case 4:return h=f.sent(),!n||u?[3,6]:[4,da.getManager(l).removeModel(c)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var La="models_store",Zr="model_info_store";function db(){if(!J().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Nh(e){var t=e.result;t.createObjectStore(La,{keyPath:"modelPath"}),t.createObjectStore(Zr,{keyPath:"modelPath"})}var Os=function(){function e(t){if(this.indexedDB=db(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return e.prototype.save=function(t){return ge(this,void 0,void 0,function(){return ve(this,function(n){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return ge(this,void 0,void 0,function(){return ve(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(t,n){var r=this;return new Promise(function(a,s){var o=r.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Nh(o)},o.onsuccess=function(){var l=o.result;if(n==null){var c=l.transaction(La,"readonly"),u=c.objectStore(La).get(r.modelPath);u.onsuccess=function(){if(u.result==null)return l.close(),s(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));a(u.result.modelArtifacts)},u.onerror=function(x){return l.close(),s(u.error)},c.oncomplete=function(){return l.close()}}else{var d,h=Ri(n),f=l.transaction(Zr,"readwrite"),p=f.objectStore(Zr),m=p.put({modelPath:r.modelPath,modelArtifactsInfo:h});m.onsuccess=function(){var x=(d=l.transaction(La,"readwrite")).objectStore(La).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:h});x.onsuccess=function(){return a({modelArtifactsInfo:h})},x.onerror=function(y){var g=(p=f.objectStore(Zr)).delete(r.modelPath);g.onsuccess=function(){return l.close(),s(x.error)},g.onerror=function(v){return l.close(),s(x.error)}}},m.onerror=function(x){return l.close(),s(m.error)},f.oncomplete=function(){d==null?l.close():d.oncomplete=function(){return l.close()}}}},o.onerror=function(l){return s(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),qg=function(e){return J().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Os.URL_SCHEME)?(t=e.slice(Os.URL_SCHEME.length),new Os(t)):null;var t};yn.registerSaveRouter(qg),yn.registerLoadRouter(qg);var x3=function(){function e(){this.indexedDB=db()}return e.prototype.listModels=function(){return ge(this,void 0,void 0,function(){var t=this;return ve(this,function(n){return[2,new Promise(function(r,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Nh(s)},s.onsuccess=function(){var o=s.result,l=o.transaction(Zr,"readonly"),c=l.objectStore(Zr).getAll();c.onsuccess=function(){for(var u={},d=0,h=c.result;d<h.length;d++){var f=h[d];u[f.modelPath]=f.modelArtifactsInfo}r(u)},c.onerror=function(u){return o.close(),a(c.error)},l.oncomplete=function(){return o.close()}},s.onerror=function(o){return a(s.error)}})]})})},e.prototype.removeModel=function(t){return ge(this,void 0,void 0,function(){var n=this;return ve(this,function(r){var a;return t=(a=t).startsWith(Os.URL_SCHEME)?a.slice(Os.URL_SCHEME.length):a,[2,new Promise(function(s,o){var l=n.indexedDB.open("tensorflowjs",1);l.onupgradeneeded=function(){return Nh(l)},l.onsuccess=function(){var c,u=l.result,d=u.transaction(Zr,"readwrite"),h=d.objectStore(Zr),f=h.get(t);f.onsuccess=function(){if(f.result==null)return u.close(),o(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var p=h.delete(t),m=function(){var x=(c=u.transaction(La,"readwrite")).objectStore(La).delete(t);x.onsuccess=function(){return s(f.result.modelArtifactsInfo)},x.onerror=function(y){return o(f.error)}};p.onsuccess=m,p.onerror=function(x){return m(),u.close(),o(f.error)}},f.onerror=function(p){return u.close(),o(f.error)},d.oncomplete=function(){c==null?u.close():c.oncomplete=function(){return u.close()}}},l.onerror=function(c){return o(l.error)}})]})})},e}();if(J().getBool("IS_BROWSER"))try{da.registerManager(Os.URL_SCHEME,new x3)}catch{}var jr="/",hs="tensorflowjs_models",hb="info",y3="model_topology",b3="weight_specs",w3="weight_data",N3="model_metadata";function fb(e){return{info:[hs,e,hb].join(jr),topology:[hs,e,y3].join(jr),weightSpecs:[hs,e,b3].join(jr),weightData:[hs,e,w3].join(jr),modelMetadata:[hs,e,N3].join(jr)}}function _3(e){var t=e.split(jr);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(jr)}var Ls=function(){function e(t){if(!J().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=fb(this.modelPath)}return e.prototype.save=function(t){return ge(this,void 0,void 0,function(){var n,r,a;return ve(this,function(s){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Ri(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(o){if(wh)return Buffer.from(o).toString("base64");for(var l=new Uint8Array(o),c="",u=0,d=l.length;u<d;u++)c+=String.fromCharCode(l[u]);return btoa(c)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:a}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return ge(this,void 0,void 0,function(){var t,n,r,a,s,o,l;return ve(this,function(c){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=a,(s=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(s),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,n.userDefinedMetadata=o.userDefinedMetadata),(l=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(u){if(wh){var d=Buffer.from(u,"base64");return d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength)}for(var h=atob(u),f=new Uint8Array(h.length),p=0;p<h.length;++p)f.set([h.charCodeAt(p)],p);return f.buffer}(l),[2,n]})})},e.URL_SCHEME="localstorage://",e}(),Hg=function(e){return J().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ls.URL_SCHEME)?(t=e.slice(Ls.URL_SCHEME.length),new Ls(t)):null;var t};yn.registerSaveRouter(Hg),yn.registerLoadRouter(Hg);var j3=function(){function e(){T(J().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),T(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return ge(this,void 0,void 0,function(){var t,n,r,a,s,o;return ve(this,function(l){for(t={},n=hs+jr,r=jr+hb,a=0;a<this.LS.length;++a)(s=this.LS.key(a)).startsWith(n)&&s.endsWith(r)&&(o=_3(s),t[o]=JSON.parse(this.LS.getItem(s)));return[2,t]})})},e.prototype.removeModel=function(t){return ge(this,void 0,void 0,function(){var n,r;return ve(this,function(a){var s;if(t=(s=t).startsWith(Ls.URL_SCHEME)?s.slice(Ls.URL_SCHEME.length):s,n=fb(t),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(J().getBool("IS_BROWSER"))try{da.registerManager(Ls.URL_SCHEME,new j3)}catch{}var k3="model",C3=".json",S3=".weights.bin";function Gg(e){return new Promise(function(t){return setTimeout(t)}).then(e)}var Ju=function(){function e(t){if(!J().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),t!=null&&t.length!==0||(t=k3),this.modelTopologyFileName=t+C3,this.weightDataFileName=t+S3}return e.prototype.save=function(t){return ge(this,void 0,void 0,function(){var n,r,a,s,o,l;return ve(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},s=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=s,[4,Gg(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),t.weightData==null?[3,4]:((l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,l.href=n,[4,Gg(function(){return l.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Ri(t)}]}})})},e.URL_SCHEME="downloads://",e}(),E3=function(){function e(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return e.prototype.load=function(){return ge(this,void 0,void 0,function(){var t,n,r=this;return ve(this,function(a){return t=this.files[0],n=this.files.slice(1),[2,new Promise(function(s,o){var l=new FileReader;l.onload=function(c){var u=JSON.parse(c.target.result),d=u.modelTopology;if(d!=null){n.length===0&&s({modelTopology:d});var h=u.weightsManifest;if(h!=null){var f;try{f=r.checkManifestAndWeightFiles(h,n)}catch(y){return void o(y)}var p=[],m=[],x=[];h.forEach(function(y){y.paths.forEach(function(g){m.push(g),x.push(null)}),p.push.apply(p,y.weights)}),h.forEach(function(y){y.paths.forEach(function(g){var v=new FileReader;v.onload=function(w){var b=w.target.result,N=m.indexOf(g);x[N]=b,x.indexOf(null)===-1&&s({modelTopology:d,weightSpecs:p,weightData:sp(x),format:u.format,generatedBy:u.generatedBy,convertedBy:u.convertedBy,userDefinedMetadata:u.userDefinedMetadata})},v.onerror=function(w){return o("Failed to weights data from file of path '"+g+"'.")},v.readAsArrayBuffer(f[g])})})}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},l.onerror=function(c){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},l.readAsText(t)})]})})},e.prototype.checkManifestAndWeightFiles=function(t,n){for(var r=[],a=n.map(function(c){return Ug(c.name)}),s={},o=0,l=t;o<l.length;o++)l[o].paths.forEach(function(c){var u=Ug(c);if(r.indexOf(u)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+u+"'");if(r.push(u),a.indexOf(u)===-1)throw new Error("Weight file with basename '"+u+"' is not provided.");s[c]=n[a.indexOf(u)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return s},e}();function Kg(e,t,n,r){(function(s){T(s!=null&&Array.isArray(s)&&s.length>0,function(){return"promises must be a none empty array"})})(e),function(s,o){T(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+s}),T(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),T(o>=s,function(){return"startFraction must be no more than endFraction, but got startFraction "+s+" and endFraction "+o})}(n=n??0,r=r??1);var a=0;return Promise.all(e.map(function(s){return s.then(function(o){var l=n+ ++a/e.length*(r-n);return t(l),o}),s}))}function pb(e,t){return ge(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d;return ve(this,function(h){switch(h.label){case 0:return t==null&&(t={}),n=t.fetchFunc==null?J().platform.fetch:t.fetchFunc,r=e.map(function(f){return n(f,t.requestInit,{isBinary:!0})}),a=0,s=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return o=h.sent(),[3,4];case 2:return[4,Kg(r,t.onProgress,a,s)];case 3:o=h.sent(),h.label=4;case 4:return l=o.map(function(f){return f.arrayBuffer()}),c=.5,u=1,t.onProgress!=null?[3,6]:[4,Promise.all(l)];case 5:return d=h.sent(),[3,8];case 6:return[4,Kg(l,t.onProgress,c,u)];case 7:d=h.sent(),h.label=8;case 8:return[2,d]}})})}function Xg(e){var t=this;return function(n,r,a){return r===void 0&&(r=""),ge(t,void 0,void 0,function(){var s,o,l,c,u,d,h,f,p,m;return ve(this,function(x){switch(x.label){case 0:if(s=n.map(function(){return!1}),o={},l=a!=null?a.map(function(){return!1}):[],c=[],n.forEach(function(y,g){var v=0;y.weights.forEach(function(w){var b="quantization"in w?w.quantization.dtype:w.dtype,N=bh[b]*xe(w.shape),_=function(){s[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:w,groupOffset:v,sizeBytes:N})};a!=null?a.forEach(function(C,k){C===w.name&&(_(),l[k]=!0)}):_(),c.push(w.name),v+=N})}),!l.every(function(y){return y}))throw u=a.filter(function(y,g){return!l[g]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+`. 
Manifest JSON has weights with names: `+c.join(", ")+".");return d=s.reduce(function(y,g,v){return g&&y.push(v),y},[]),h=[],d.forEach(function(y){n[y].paths.forEach(function(g){var v=r+(r.endsWith("/")?"":"/")+g;h.push(v)})}),[4,e(h)];case 1:return f=x.sent(),p={},m=0,d.forEach(function(y){for(var g=n[y].paths.length,v=0,w=0;w<g;w++)v+=f[m+w].byteLength;for(var b=new ArrayBuffer(v),N=new Uint8Array(b),_=0,C=0;C<g;C++){var k=new Uint8Array(f[m+C]);N.set(k,_),_+=k.byteLength}o[y].forEach(function(j){var S=ub(b.slice(j.groupOffset,j.groupOffset+j.sizeBytes),[j.manifestEntry]);for(var M in S)p[M]=S[M]}),m+=g}),[2,p]}})})}}yn.registerSaveRouter(function(e){return J().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ju.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new Ju(t)}(e.slice(Ju.URL_SCHEME.length)):null});var mb=function(){function e(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(T(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=J().platform.fetch,T(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&T(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return e.prototype.save=function(t){return ge(this,void 0,void 0,function(){var n,r,a,s;return ve(this,function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((s=o.sent()).ok)return[2,{modelArtifactsInfo:Ri(t),responses:[s]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+s.status+".")}})})},e.prototype.load=function(){return ge(this,void 0,void 0,function(){var t,n,r,a,s,o,l,c,u,d,h,f;return ve(this,function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,t.json()];case 3:return n=p.sent(),[3,5];case 4:throw p.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=n.modelTopology,s=n.weightsManifest,o=n.generatedBy,l=n.convertedBy,c=n.format,u=n.userDefinedMetadata,a==null&&s==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return s==null?[3,7]:[4,this.loadWeights(s)];case 6:f=p.sent(),d=f[0],h=f[1],p.label=7;case 7:return[2,{modelTopology:a,weightSpecs:d,weightData:h,userDefinedMetadata:u,generatedBy:o,convertedBy:l,format:c}]}})})},e.prototype.loadWeights=function(t){return ge(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d,h,f;return ve(this,function(p){switch(p.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(m){var x=m.lastIndexOf("/"),y=m.lastIndexOf("?"),g=m.substring(0,x),v=y>x?m.substring(y):"";return[g+"/",v]}(n),a=r[0],s=r[1],o=this.weightPathPrefix||a,l=[],c=0,u=t;c<u.length;c++)d=u[c],l.push.apply(l,d.weights);return h=[],t.forEach(function(m){m.paths.forEach(function(x){h.push(o+x+s)})}),[4,pb(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=p.sent(),[2,[l,sp(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function _h(e){return e.match(mb.URL_SCHEME_REGEX)!=null}var Yg=function(e,t){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(n){return _h(n)}):_h(e))?jh(e,{onProgress:t}):null};function jh(e,t){return new mb(e,t)}yn.registerSaveRouter(Yg),yn.registerLoadRouter(Yg);var Zu=function(){function e(t){this.modelArtifacts=t}return e.prototype.load=function(){return ge(this,void 0,void 0,function(){return ve(this,function(t){return[2,this.modelArtifacts]})})},e}(),R3=function(){function e(t){this.saveHandler=t}return e.prototype.save=function(t){return ge(this,void 0,void 0,function(){return ve(this,function(n){return[2,this.saveHandler(t)]})})},e}(),gb=Object.freeze({browserFiles:function(e){return new E3(e)},browserHTTPRequest:function(e,t){return jh(e,t)},concatenateArrayBuffers:sp,decodeWeights:ub,encodeWeights:function(e,t){return ge(this,void 0,void 0,function(){var n,r,a,s,o,l=this;return ve(this,function(c){switch(c.label){case 0:for(n=[],r=[],a=Array.isArray(e)?e.map(function(u){return u.name}):Object.keys(e),s=function(u){var d=a[u],h=Array.isArray(e)?e[u].tensor:e[d];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+d+"': "+h.dtype);var f={name:d,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var p=new Promise(function(m){return ge(l,void 0,void 0,function(){var x,y,g,v,w,b,N;return ve(this,function(_){switch(_.label){case 0:return[4,h.bytes()];case 1:for(x=_.sent(),y=x.reduce(function(C,k){return C+k.length},0)+gc*x.length,g=new Uint8Array(y),v=0,w=0;w<x.length;w++)b=x[w],N=new Uint8Array(new Uint32Array([b.length]).buffer),g.set(N,v),v+=gc,g.set(b,v),v+=b.length;return m(g),[2]}})})});r.push(p)}else r.push(h.data());t!=null&&(f.group=t),n.push(f)},o=0;o<a.length;++o)s(o);return[4,Promise.all(r)];case 1:return[2,{data:v3(c.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new Zu(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zu({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Zu({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return yn.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:Ri,getSaveHandlers:function(e){return yn.getSaveHandlers(e)},http:jh,isHTTPScheme:_h,loadWeights:function(e,t,n,r){return t===void 0&&(t=""),ge(this,void 0,void 0,function(){return ve(this,function(a){return[2,Xg(function(s){return pb(s,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return yn.registerLoadRouter(e)},registerSaveRouter:function(e){return yn.registerSaveRouter(e)},weightsLoaderFactory:Xg,withSaveHandler:function(e){return new R3(e)},copyModel:function(e,t){return ge(this,void 0,void 0,function(){return ve(this,function(n){return[2,Vg(e,t,!1)]})})},listModels:function(){return ge(this,void 0,void 0,function(){var e,t,n,r,a,s,o;return ve(this,function(l){switch(l.label){case 0:e=da.getSchemes(),t={},n=0,r=e,l.label=1;case 1:return n<r.length?(a=r[n],[4,da.getManager(a).listModels()]):[3,4];case 2:for(o in s=l.sent())t[a+Ms+o]=s[o];l.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return ge(this,void 0,void 0,function(){return ve(this,function(n){return[2,Vg(e,t,!0)]})})},removeModel:function(e){return ge(this,void 0,void 0,function(){var t;return ve(this,function(n){return t=jl(e),[2,da.getManager(t.scheme).removeModel(t.path)]})})}}),is;L({confusionMatrix_:function(e,t,n){var r=R(e,"labels","confusionMatrix"),a=R(t,"predictions","confusionMatrix");T(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),T(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),T(a.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+a.rank}),T(r.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."}),T(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var s=mh(r.asType("int32"),n),o=mh(a.asType("int32"),n);return s.transpose().matMul(o).asType("int32")}});var D3=L({fromPixels_:function(e,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,s=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(a&&a&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if($0("FromPixels",z.backendName)!=null)return z.runKernel("FromPixels",{pixels:e},{numChannels:t});var l,c,u=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],d=u[0],h=u[1];if(o?l=e.getContext("2d").getImageData(0,0,d,h).data:r||n?l=e.data:(s||a)&&(is==null&&(is=document.createElement("canvas").getContext("2d")),is.canvas.width=d,is.canvas.height=h,is.drawImage(e,0,0,d,h),l=is.getImageData(0,0,d,h).data),t===4)c=new Int32Array(l);else{var f=d*h;c=new Int32Array(f*t);for(var p=0;p<f;p++)for(var m=0;m<t;++m)c[p*t+m]=l[4*p+m]}return Pf(c,[h,d,t],"int32")}}),op=Object.freeze({toPixels:function(e,t){return ge(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,C,k;return ve(this,function(j){switch(j.label){case 0:if(n=R(e,"img","toPixels"),e instanceof rt||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),a=r[0],s=r[1],(o=n.rank===2?1:n.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return l=j.sent(),c=n.min(),u=n.max(),[4,Promise.all([c.data(),u.data()])];case 2:if(d=j.sent(),h=d[0],f=d[1],p=h[0],m=f[0],c.dispose(),u.dispose(),n.dtype==="float32"){if(p<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+m+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+m+"].")}for(x=n.dtype==="float32"?255:1,y=new Uint8ClampedArray(s*a*4),g=0;g<a*s;++g)v=void 0,w=void 0,b=void 0,N=void 0,o===1?(v=l[g]*x,w=l[g]*x,b=l[g]*x,N=255):o===3?(v=l[3*g]*x,w=l[3*g+1]*x,b=l[3*g+2]*x,N=255):o===4&&(v=l[4*g]*x,w=l[4*g+1]*x,b=l[4*g+2]*x,N=l[4*g+3]*x),y[(_=4*g)+0]=Math.round(v),y[_+1]=Math.round(w),y[_+2]=Math.round(b),y[_+3]=Math.round(N);return t!=null&&(t.width=s,t.height=a,C=t.getContext("2d"),k=new ImageData(y,s,a),C.putImageData(k,0,0)),n!==e&&n.dispose(),[2,y]}})})},fromPixels:D3}),I3=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(t,n){return new t(n)},e}(),A3=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function ts(e){T(e.className!=null,function(){return"Class being registered does not have the static className property defined."}),T(typeof e.className=="string",function(){return"className is required to be a string, but got type "+typeof e.className}),T(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),A3.register(e)}var ns=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return Qn(t,e),t.prototype.minimize=function(n,r,a){r===void 0&&(r=!1);var s=this.computeGradients(n,a),o=s.value,l=s.grads;if(a!=null){var c=a.map(function(u){return{name:u.name,tensor:l[u.name]}});this.applyGradients(c)}else this.applyGradients(l);return un(l),r?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(n,r){return zk(n,r)},t.prototype.dispose=function(){this.iterations_!=null&&un(this.iterations_)},t.prototype.saveIterations=function(){return ge(this,void 0,void 0,function(){return ve(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:ce(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return ge(this,void 0,void 0,function(){return ve(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(n){return ge(this,void 0,void 0,function(){return ve(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(n){return ge(this,void 0,void 0,function(){var r;return ve(this,function(a){switch(a.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,n.slice(1)]}})})},t}(I3);Object.defineProperty(ns,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var T3=function(e){function t(n,r,a){a===void 0&&(a=null);var s=e.call(this)||this;return s.learningRate=n,s.rho=r,s.epsilon=a,s.accumulatedGrads=[],s.accumulatedUpdates=[],a==null&&(s.epsilon=z.backend.epsilon()),s}return Qn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=z.registeredVariables[a];r.accumulatedGrads[s]==null&&(r.accumulatedGrads[s]={originalName:a+"/accum_grad",variable:he(function(){return Be(o).variable(!1)})}),r.accumulatedUpdates[s]==null&&(r.accumulatedUpdates[s]={originalName:a+"/accum_var",variable:he(function(){return Be(o).variable(!1)})});var l=Array.isArray(n)?n[s].tensor:n[a];if(l!=null){var c=r.accumulatedGrads[s].variable,u=r.accumulatedUpdates[s].variable;he(function(){var d=c.mul(r.rho).add(l.square().mul(1-r.rho)),h=u.add(r.epsilon).sqrt().div(c.add(r.epsilon).sqrt()).mul(l),f=u.mul(r.rho).add(h.square().mul(1-r.rho));c.assign(d),u.assign(f);var p=h.mul(-r.learningRate).add(o);o.assign(p)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(un(this.accumulatedGrads.map(function(n){return n.variable})),un(this.accumulatedUpdates.map(function(n){return n.variable})))},t.prototype.getWeights=function(){return ge(this,void 0,void 0,function(){var n;return ve(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(n){return ge(this,void 0,void 0,function(){var r;return ve(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(n)];case 1:return n=a.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(ns);ts(T3);var P3=function(e){function t(n,r){r===void 0&&(r=.1);var a=e.call(this)||this;return a.learningRate=n,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return Qn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=z.registeredVariables[a];r.accumulatedGrads[s]==null&&(r.accumulatedGrads[s]={originalName:a+"/accumulator",variable:he(function(){return fr(o.shape,r.initialAccumulatorValue).variable(!1)})});var l=Array.isArray(n)?n[s].tensor:n[a];if(l!=null){var c=r.accumulatedGrads[s].variable;he(function(){var u=c.add(l.square());c.assign(u);var d=l.div(u.add(z.backend.epsilon()).sqrt()).mul(-r.learningRate).add(o);o.assign(d)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&un(this.accumulatedGrads.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return ge(this,void 0,void 0,function(){return ve(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return ge(this,void 0,void 0,function(){return ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(ns);ts(P3);var F3=function(e){function t(n,r,a,s){s===void 0&&(s=null);var o=e.call(this)||this;return o.learningRate=n,o.beta1=r,o.beta2=a,o.epsilon=s,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],he(function(){o.accBeta1=ce(r).variable(),o.accBeta2=ce(a).variable()}),s==null&&(o.epsilon=z.backend.epsilon()),o}return Qn(t,e),t.prototype.applyGradients=function(n){var r=this,a=Array.isArray(n)?n.map(function(s){return s.name}):Object.keys(n);he(function(){var s=kt(1,r.accBeta1),o=kt(1,r.accBeta2);a.forEach(function(l,c){var u=z.registeredVariables[l];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:l+"/m",variable:he(function(){return Be(u).variable(!1)})}),r.accumulatedSecondMoment[c]==null&&(r.accumulatedSecondMoment[c]={originalName:l+"/v",variable:he(function(){return Be(u).variable(!1)})});var d=Array.isArray(n)?n[c].tensor:n[l];if(d!=null){var h=r.accumulatedFirstMoment[c].variable,f=r.accumulatedSecondMoment[c].variable,p=h.mul(r.beta1).add(d.mul(1-r.beta1)),m=f.mul(r.beta2).add(d.square().mul(1-r.beta2)),x=p.div(s),y=m.div(o);h.assign(p),f.assign(m);var g=x.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(u);u.assign(g)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&un(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&un(this.accumulatedSecondMoment.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return ge(this,void 0,void 0,function(){var n;return ve(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(n){return ge(this,void 0,void 0,function(){var r,a=this;return ve(this,function(s){switch(s.label){case 0:return[4,this.extractIterations(n)];case 1:return n=s.sent(),he(function(){a.accBeta1.assign(pc(a.beta1,a.iterations_+1)),a.accBeta2.assign(pc(a.beta2,a.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(ns);ts(F3);var M3=function(e){function t(n,r,a,s,o){s===void 0&&(s=null),o===void 0&&(o=0);var l=e.call(this)||this;return l.learningRate=n,l.beta1=r,l.beta2=a,l.epsilon=s,l.decay=o,l.accumulatedFirstMoment=[],l.accumulatedWeightedInfNorm=[],he(function(){l.iteration=ce(0).variable(),l.accBeta1=ce(r).variable()}),s==null&&(l.epsilon=z.backend.epsilon()),l}return Qn(t,e),t.prototype.applyGradients=function(n){var r=this,a=Array.isArray(n)?n.map(function(s){return s.name}):Object.keys(n);he(function(){var s=kt(1,r.accBeta1),o=Un(-r.learningRate,r.iteration.mul(r.decay).add(1));a.forEach(function(l,c){var u=z.registeredVariables[l];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:l+"/m",variable:Be(u).variable(!1)}),r.accumulatedWeightedInfNorm[c]==null&&(r.accumulatedWeightedInfNorm[c]={originalName:l+"/v",variable:Be(u).variable(!1)});var d=Array.isArray(n)?n[c].tensor:n[l];if(d!=null){var h=r.accumulatedFirstMoment[c].variable,f=r.accumulatedWeightedInfNorm[c].variable,p=h.mul(r.beta1).add(d.mul(1-r.beta1)),m=f.mul(r.beta2),x=d.abs(),y=m.maximum(x);h.assign(p),f.assign(y);var g=o.div(s).mul(p.div(y.add(r.epsilon))).add(u);u.assign(g)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&un(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&un(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return ge(this,void 0,void 0,function(){return ve(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(n){return ge(this,void 0,void 0,function(){return ve(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(ns);ts(M3);var vb=function(e){function t(n){var r=e.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return Qn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=Array.isArray(n)?n[s].tensor:n[a];if(o!=null){var l=z.registeredVariables[a];he(function(){var c=r.c.mul(o).add(l);l.assign(c)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=nk(ce(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return ge(this,void 0,void 0,function(){return ve(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},t.prototype.setWeights=function(n){return ge(this,void 0,void 0,function(){return ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,r){return new n(r.learningRate)},t.className="SGD",t}(ns);ts(vb);var O3=function(e){function t(n,r,a){a===void 0&&(a=!1);var s=e.call(this,n)||this;return s.learningRate=n,s.momentum=r,s.useNesterov=a,s.accumulations=[],s.m=ce(s.momentum),s}return Qn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=z.registeredVariables[a];r.accumulations[s]==null&&(r.accumulations[s]={originalName:a+"/momentum",variable:he(function(){return Be(o).variable(!1)})});var l=r.accumulations[s].variable,c=Array.isArray(n)?n[s].tensor:n[a];c!=null&&he(function(){var u,d=r.m.mul(l).add(c);u=r.useNesterov?r.c.mul(c.add(d.mul(r.m))).add(o):r.c.mul(d).add(o),l.assign(d),o.assign(u)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&un(this.accumulations.map(function(n){return n.variable}))},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getWeights=function(){return ge(this,void 0,void 0,function(){return ve(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return ge(this,void 0,void 0,function(){return ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(vb);ts(O3);var L3=function(e){function t(n,r,a,s,o){r===void 0&&(r=.9),a===void 0&&(a=0),s===void 0&&(s=null),o===void 0&&(o=!1);var l=e.call(this)||this;if(l.learningRate=n,l.decay=r,l.momentum=a,l.epsilon=s,l.accumulatedMeanSquares=[],l.accumulatedMoments=[],l.accumulatedMeanGrads=[],l.centered=o,s==null&&(l.epsilon=z.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return l}return Qn(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(a){return a.name}):Object.keys(n)).forEach(function(a,s){var o=z.registeredVariables[a];r.accumulatedMeanSquares[s]==null&&(r.accumulatedMeanSquares[s]={originalName:a+"/rms",variable:he(function(){return Be(o).variable(!1)})}),r.accumulatedMoments[s]==null&&(r.accumulatedMoments[s]={originalName:a+"/momentum",variable:he(function(){return Be(o).variable(!1)})}),r.accumulatedMeanGrads[s]==null&&r.centered&&(r.accumulatedMeanGrads[s]={originalName:a+"/mg",variable:he(function(){return Be(o).variable(!1)})});var l=Array.isArray(n)?n[s].tensor:n[a];if(l!=null){var c=r.accumulatedMeanSquares[s].variable,u=r.accumulatedMoments[s].variable;he(function(){var d=c.mul(r.decay).add(l.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[s].variable,f=h.mul(r.decay).add(l.mul(1-r.decay)),p=u.mul(r.momentum).add(l.mul(r.learningRate).div(d.sub(f.square().add(r.epsilon)).sqrt()));c.assign(d),h.assign(f),u.assign(p);var m=o.sub(p);o.assign(m)}else{var x=c.mul(r.decay).add(l.square().mul(1-r.decay));p=u.mul(r.momentum).add(l.mul(r.learningRate).div(x.add(r.epsilon).sqrt())),c.assign(x),u.assign(p),m=o.sub(p),o.assign(m)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&un(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&un(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&un(this.accumulatedMoments.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return ge(this,void 0,void 0,function(){var n;return ve(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(n){return ge(this,void 0,void 0,function(){var r;return ve(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(n)];case 1:return n=a.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(ns);ts(L3);rt.prototype.squaredDifference=function(e){return Ay(this,e)},Y=u3;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var kh=function(e,t){return kh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)r.hasOwnProperty(a)&&(n[a]=r[a])},kh(e,t)};function Re(e,t){kh(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var qt=function(){return qt=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},qt.apply(this,arguments)};function be(e,t,n,r){function a(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?s(d.value):a(d.value).then(l,c)}u((r=r.apply(e,t||[])).next())})}function we(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,a,s,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(d){return c([u,d])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,a&&(s=u[0]&2?a.return:u[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,u[1])).done)return s;switch(a=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,a=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=t.call(e,n)}catch(d){u=[6,d],a=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Lo(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),a=0,t=0;t<n;t++)for(var s=arguments[t],o=0,l=s.length;o<l;o++,a++)r[a]=s[o];return r}var Bs=function(){function e(t,n){if(!Wa(t)||!Wa(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:n}));this._width=t,this._height=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Kc(e,t){return e instanceof rt&&e.shape.length===t}function B3(e){return Kc(e,2)}function Xc(e){return Kc(e,3)}function ha(e){return Kc(e,4)}function $3(e){return e%1!==0}function Qg(e){return e%2===0}function W3(e,t){t===void 0&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function Jg(e){return e&&e.width&&e.height}function z3(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new Bs(Math.round(n*a),Math.round(r*a))}function ip(e){return e.reduce(function(t,n){return t.add(n)},new ze(0,0)).div(new ze(e.length,e.length))}function mi(e,t,n){return Array(e).fill(0).map(function(r,a){return t+a*n})}function Wa(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function Zg(e){return Wa(e)&&0<=e&&e<=1}var ze=function(){function e(t,n){this._x=t,this._y=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),ga=function(){function e(t,n){n===void 0&&(n=!0);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(Wa),s=[r.x,r.y,r.width,r.height].every(Wa);if(!s&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=s?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],l=o[0],c=o[1],u=o[2],d=o[3];e.assertIsValidBox({x:l,y:c,width:u,height:d},"Box.constructor",n),this._x=l,this._y=c,this._width=u,this._height=d}return e.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(Wa)},e.assertIsValidBox=function(t,n,r){if(r===void 0&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new ze(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new ze(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new ze(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new ze(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),n=t[0],r=t[1],a=t[2],s=t[3];return new e({x:n,y:r,width:a,height:s})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),n=t[0],r=t[1],a=t[2],s=t[3];return new e({x:n,y:r,width:a,height:s})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,a=t.width,s=t.height,o=Math.abs(a-s);return a<s&&(n-=o/2,a+=o),s<a&&(r-=o/2,s+=o),new e({x:n,y:r,width:a,height:s})},e.prototype.rescale=function(t){var n=Jg(t)?t.width:t,r=Jg(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n],a=r[0],s=r[1],o=r[2],l=r[3];return new e({x:a,y:s,width:o,height:l})},e.prototype.clipAtImageBorders=function(t,n){var r=this,a=r.x,s=r.y,o=r.right,l=r.bottom,c=Math.max(a,0),u=Math.max(s,0),d=o-c,h=l-u,f=Math.min(d,t-c),p=Math.min(h,n-u);return new e({x:c,y:u,width:f,height:p}).floor()},e.prototype.shift=function(t,n){var r=this,a=r.width,s=r.height,o=this.x+t,l=this.y+n;return new e({x:o,y:l,width:a,height:s})},e.prototype.padAtBorders=function(t,n){var r=this.width+1,a=this.height+1,s=1,o=1,l=r,c=a,u=this.left,d=this.top,h=this.right,f=this.bottom;return h>n&&(l=-h+n+r,h=n),f>t&&(c=-f+t+a,f=t),u<1&&(c=2-u,u=1),d<1&&(c=2-d,d=1),{dy:o,edy:c,dx:s,edx:l,y:d,ey:f,x:u,ex:h,w:r,h:a}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),Yc=function(e){Re(t,e);function t(n,r,a,s,o){return o===void 0&&(o=!1),e.call(this,{left:n,top:r,right:a,bottom:s},o)||this}return t}(ga),xb=function(){function e(t,n,r,a,s){this._imageDims=new Bs(s.width,s.height),this._score=t,this._classScore=n,this._className=r,this._box=new ga(a).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new ga(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),xr=function(e){Re(t,e);function t(n,r,a){return e.call(this,n,n,"",r,a)||this}return t.prototype.forSize=function(n,r){var a=e.prototype.forSize.call(this,n,r),s=a.score,o=a.relativeBox,l=a.imageDims;return new t(s,o,l)},t}(xb);function U3(e,t,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),s=r*a;return n?s/(e.area+t.area-s):s/Math.min(e.area,t.area)}function V3(e){var t=e.map(function(l){return l.x}),n=e.map(function(l){return l.y}),r=t.reduce(function(l,c){return c<l?c:l},1/0),a=n.reduce(function(l,c){return c<l?c:l},1/0),s=t.reduce(function(l,c){return l<c?c:l},0),o=n.reduce(function(l,c){return l<c?c:l},0);return new Yc(r,a,s,o)}function gi(e,t,n,r){r===void 0&&(r=!0);for(var a=t.map(function(l,c){return{score:l,boxIndex:c}}).sort(function(l,c){return l.score-c.score}).map(function(l){return l.boxIndex}),s=[],o=function(){var l=a.pop();s.push(l);for(var c=a,u=[],d=0;d<c.length;d++){var h=c[d],f=e[l],p=e[h];u.push(U3(f,p,r))}a=a.filter(function(m,x){return u[x]<=n})};a.length>0;)o();return s}function Di(e,t){return he(function(){var n=t[0],r=t[1],a=t[2],s=fr(Lo(e.shape.slice(0,3),[1]),n),o=fr(Lo(e.shape.slice(0,3),[1]),r),l=fr(Lo(e.shape.slice(0,3),[1]),a),c=Nt([s,o,l],3);return kt(e,c)})}function q3(e,t){return t===void 0&&(t=!1),he(function(){var n=e.shape.slice(1),r=n[0],a=n[1];if(r===a)return e;var s=Math.abs(r-a),o=Math.round(s*(t?.5:1)),l=r>a?2:1,c=function(p){var m=e.shape.slice();return m[l]=p,fr(m,0)},u=c(o),d=s-u.shape[l],h=t&&d?c(d):null,f=[h,e,u].filter(function(p){return!!p}).map(function(p){return p.toFloat()});return Nt(f,l)})}function ed(e){return 1/(1+Math.exp(-e))}var lp=function(e){Re(t,e);function t(n,r,a,s,o){return o===void 0&&(o=!1),e.call(this,{x:n,y:r,width:a,height:s},o)||this}return t}(ga),H3=.5,G3=.43,K3=.45,vc=function(){function e(t,n,r){r===void 0&&(r=new ze(0,0));var a=n.width,s=n.height;this._imgDims=new Bs(a,s),this._shift=r,this._positions=t.map(function(o){return o.mul(new ze(a,s)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new ze(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(n){return n.sub(t._shift).div(new ze(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new this.constructor(this.relativePositions,{width:t,height:n})},e.prototype.shiftBy=function(t,n){return new this.constructor(this.relativePositions,this._imgDims,new ze(t,n))},e.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},e.prototype.align=function(t,n){if(n===void 0&&(n={}),t){var r=t instanceof xr?t.box.floor():new ga(t);return this.shiftBy(r.x,r.y).align(null,n)}var a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),s=a.useDlibAlignment,o=a.minBoxPadding;return s?this.alignDlib():this.alignMinBbox(o)},e.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),n=t[0],r=t[1],a=t[2],s=function(h){return a.sub(h).magnitude()},o=(s(n)+s(r))/2,l=Math.floor(o/K3),c=ip(t),u=Math.floor(Math.max(0,c.x-H3*l)),d=Math.floor(Math.max(0,c.y-G3*l));return new lp(u,d,Math.min(l,this.imageWidth+u),Math.min(l,this.imageHeight+d))},e.prototype.alignMinBbox=function(t){var n=V3(this.positions);return n.pad(n.width*t,n.height*t)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),X3=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],ip([n[3],n[4]])]},t}(vc),Y3=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(ip)},t}(vc),ev=function(){function e(t,n){this._label=t,this._distance=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+W3(this.distance)+")":"")},e}(),tv=function(e){Re(t,e);function t(n,r){var a=e.call(this,n)||this;return a._label=r,a}return t.assertIsValidLabeledBox=function(n,r){if(ga.assertIsValidBox(n,r),!Wa(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(ga),al=function(){function e(t,n){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(r){return new Float32Array(r)});return new e(t.label,n)},e}();(function(e){Re(t,e);function t(n,r,a,s){var o=e.call(this,n,r)||this;return o._score=a,o._classScore=s,o}return t.assertIsValidPredictedBox=function(n,r){if(tv.assertIsValidLabeledBox(n,r),!Zg(n.score)||!Zg(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(tv);function Q3(e){return e.detection instanceof xr}function cp(e,t){var n={detection:t};return Object.assign({},e,n)}function yb(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:t}}function bb(e){var t="";if(!e)try{e=require("fs")}catch(r){t=r.toString()}var n=e?function(r){return new Promise(function(a,s){e.readFile(r,function(o,l){return o?s(o):a(l)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:n}}function wb(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},s=bb();return qt({Canvas:e||function(){function o(){}return o}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function o(){}return o}(),Image:t||function(){function o(){}return o}(),ImageData:global.ImageData||function(){function o(){}return o}(),Video:global.HTMLVideoElement||function(){function o(){}return o}(),createCanvasElement:n,createImageElement:r,fetch:a},s)}function Nb(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function _b(){return typeof global=="object"&&typeof require=="function"&&typeof n1<"u"&&typeof process<"u"&&!!process.version}var yt;function J3(){if(!yt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return yt}function Ch(e){yt=e}function up(){Nb()&&Ch(yb()),_b()&&Ch(wb())}function Z3(e){if(yt||up(),!yt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=t===void 0?yt.Canvas:t,r=e.Image,a=r===void 0?yt.Image:r;yt.Canvas=n,yt.Image=a,yt.createCanvasElement=e.createCanvasElement||function(){return new n},yt.createImageElement=e.createImageElement||function(){return new a},yt.ImageData=e.ImageData||yt.ImageData,yt.Video=e.Video||yt.Video,yt.fetch=e.fetch||yt.fetch,yt.readFile=e.readFile||yt.readFile}var Yt={getEnv:J3,setEnv:Ch,initialize:up,createBrowserEnv:yb,createFileSystem:bb,createNodejsEnv:wb,monkeyPatch:Z3,isBrowser:Nb,isNodejs:_b};up();function jb(e){return!Yt.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function Xa(e){var t=Yt.getEnv(),n=t.Canvas,r=t.CanvasRenderingContext2D;if(e instanceof r)return e;var a=jb(e);if(!(a instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var s=a.getContext("2d");if(!s)throw new Error("resolveContext2d - canvas 2d context is null");return s}var nv;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(nv||(nv={}));function kb(e){var t=Yt.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function eR(e){return new Promise(function(t,n){if(e instanceof Yt.getEnv().Canvas||kb(e))return t();function r(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",r),s.currentTarget.removeEventListener("error",a),t(s))}function a(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",r),s.currentTarget.removeEventListener("error",a),n(s))}e.addEventListener("load",r),e.addEventListener("error",a)})}function Cb(e){var t=Yt.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new Bs(e.naturalWidth,e.naturalHeight):e instanceof r?new Bs(e.videoWidth,e.videoHeight):new Bs(e.width,e.height)}function Qc(e){var t=e.width,n=e.height,r=Yt.getEnv().createCanvasElement,a=r();return a.width=t,a.height=n,a}function dp(e,t){var n=Yt.getEnv().ImageData;if(!(e instanceof n)&&!kb(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||Cb(e),a=r.width,s=r.height,o=Qc({width:a,height:s});return e instanceof n?Xa(o).putImageData(e,0,0):Xa(o).drawImage(e,0,0,a,s),o}function tR(e,t){return be(this,void 0,void 0,function(){var n,r,a,s,o,l;return we(this,function(c){switch(c.label){case 0:return n=t||Yt.getEnv().createCanvasElement(),r=e.shape.slice(ha(e)?1:0),a=r[0],s=r[1],o=r[2],l=he(function(){return e.as3D(a,s,o).toInt()}),[4,op.toPixels(l,n)];case 1:return c.sent(),l.dispose(),[2,n]}})})}function rv(e){var t=Yt.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}function nR(e,t,n){n===void 0&&(n=!1);var r=Yt.getEnv(),a=r.Image,s=r.Canvas;if(!(e instanceof a||e instanceof s))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=Cb(e),l=t/Math.max(o.height,o.width),c=l*o.width,u=l*o.height,d=Qc({width:t,height:t}),h=e instanceof s?e:dp(e),f=Math.abs(c-u)/2,p=n&&c<u?f:0,m=n&&u<c?f:0;return Xa(d).drawImage(h,p,m,c,u),d}var xc=function(){function e(t,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=n,this._batchSize=t.length,t.forEach(function(a,s){if(Xc(a)){r._imageTensors[s]=a,r._inputDimensions[s]=a.shape;return}if(ha(a)){var o=a.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");r._imageTensors[s]=a,r._inputDimensions[s]=a.shape.slice(1);return}var l=a instanceof Yt.getEnv().Canvas?a:dp(a);r._canvases[s]=l,r._inputDimensions[s]=[l.height,l.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var t=this;return mi(this.batchSize,0,1).map(function(n,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},e.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},e.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},e.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},e.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(t),r=this.getInputHeight(t);return z3({width:n,height:r},this.inputSize)},e.prototype.toBatchTensor=function(t,n){var r=this;return n===void 0&&(n=!0),this._inputSize=t,he(function(){var a=mi(r.batchSize,0,1).map(function(o){var l=r.getInput(o);if(l instanceof rt){var c=ha(l)?l:l.expandDims();return c=q3(c,n),(c.shape[1]!==t||c.shape[2]!==t)&&(c=ep.resizeBilinear(c,[t,t])),c.as3D(t,t,3)}if(l instanceof Yt.getEnv().Canvas)return op.fromPixels(nR(l,t,n));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+l)}),s=Nn(a.map(function(o){return o.toFloat()})).as4D(r.batchSize,t,t,3);return s})},e}();function At(e){return be(this,void 0,void 0,function(){var t,n,r;return we(this,function(a){switch(a.label){case 0:if(e instanceof xc)return[2,e];if(t=Array.isArray(e)?e:[e],!t.length)throw new Error("toNetInput - empty array passed as input");return n=function(s){return Array.isArray(e)?" at input index "+s+":":""},r=t.map(jb),r.forEach(function(s,o){if(!rv(s)&&!Xc(s)&&!ha(s))throw typeof t[o]=="string"?new Error("toNetInput -"+n(o)+" string passed, but could not resolve HTMLElement for element id "+t[o]):new Error("toNetInput -"+n(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ha(s)){var l=s.shape[0];if(l!==1)throw new Error("toNetInput -"+n(o)+" tf.Tensor4D with batchSize "+l+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(s){return rv(s)&&eR(s)}))];case 1:return a.sent(),[2,new xc(r,Array.isArray(e))]}})})}function hp(e,t){return be(this,void 0,void 0,function(){var n,r,a,s,o,l,c;return we(this,function(u){switch(u.label){case 0:return n=Yt.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,At(e)];case 1:if(a=u.sent(),a.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return s=a.getInput(0),s instanceof n?(o=s,[3,4]):[3,2];case 2:return[4,tR(s)];case 3:o=u.sent(),u.label=4;case 4:r=o,u.label=5;case 5:return l=Xa(r),c=t.map(function(d){return d instanceof xr?d.forSize(r.width,r.height).box.floor():d}).map(function(d){return d.clipAtImageBorders(r.width,r.height)}),[2,c.map(function(d){var h=d.x,f=d.y,p=d.width,m=d.height,x=Qc({width:p,height:m});return Xa(x).putImageData(l.getImageData(h,f,p,m),0,0),x})]}})})}function fp(e,t){return be(this,void 0,void 0,function(){return we(this,function(n){if(!Xc(e)&&!ha(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ha(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,he(function(){var r=e.shape.slice(ha(e)?1:0),a=r[0],s=r[1],o=r[2],l=t.map(function(u){return u instanceof xr?u.forSize(s,a).box:u}).map(function(u){return u.clipAtImageBorders(s,a)}),c=l.map(function(u){var d=u.x,h=u.y,f=u.width,p=u.height;return Zy(e.as3D(a,s,o),[h,d,0],[p,f,o])});return c})]})})}function rR(e,t){return be(this,void 0,void 0,function(){var n,r;return we(this,function(a){switch(a.label){case 0:return n=Yt.getEnv().fetch,[4,n(e,t)];case 1:if(r=a.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function aR(e){return be(this,void 0,void 0,function(){return we(this,function(t){switch(t.label){case 0:return[4,rR(e)];case 1:return[2,t.sent().json()]}})})}function Sb(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var a=e.split("/").filter(function(l){return l}),s=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return o=e.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+s:o+"/"+s}}function sR(e,t){return be(this,void 0,void 0,function(){var n,r,a,s;return we(this,function(o){switch(o.label){case 0:return n=Sb(e,t),r=n.manifestUri,a=n.modelBaseUri,[4,aR(r)];case 1:return s=o.sent(),[2,gb.loadWeights(s,a)]}})})}var Lr=function(){function e(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(t){var n=this.traversePropertyPath(t),r=n.obj,a=n.objProp;return r[a]},e.prototype.reassignParamFromPath=function(t,n){var r=this.traversePropertyPath(t),a=r.obj,s=r.objProp;a[s].dispose(),a[s]=n},e.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Ys})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Ys)})},e.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(n){var r=n.path,a=n.tensor;t.reassignParamFromPath(r,a.variable())})},e.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(n){var r=n.path,a=n.tensor,s=Ot(a.dataSync());a.dispose(),t.reassignParamFromPath(r,s)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(n){if(t&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var n=t.tensor;return Array.from(n.dataSync())}).reduce(function(t,n){return t.concat(n)}))},e.prototype.load=function(t){return be(this,void 0,void 0,function(){return we(this,function(n){switch(n.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return n.sent(),[2]}})})},e.prototype.loadFromUri=function(t){return be(this,void 0,void 0,function(){var n;return we(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,sR(t,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},e.prototype.loadFromDisk=function(t){return be(this,void 0,void 0,function(){var n,r,a,s,o,l,c,u,d,h;return we(this,function(f){switch(f.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=Yt.getEnv().readFile,r=Sb(t,this.getDefaultModelName()),a=r.manifestUri,s=r.modelBaseUri,o=function(p){return Promise.all(p.map(function(m){return n(m).then(function(x){return x.buffer})}))},l=gb.weightsLoaderFactory(o),d=(u=JSON).parse,[4,n(a)];case 1:return c=d.apply(u,[f.sent().toString()]),[4,l(c,s)];case 2:return h=f.sent(),this.loadFromWeightMap(h),[2]}})})},e.prototype.loadFromWeightMap=function(t){var n=this.extractParamsFromWeigthMap(t),r=n.paramMappings,a=n.params;this._paramMappings=r,this._params=a},e.prototype.extractWeights=function(t){var n=this.extractParams(t),r=n.paramMappings,a=n.params;this._paramMappings=r,this._params=a},e.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=t.split("/").reduce(function(s,o){if(!s.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+t);return{obj:s.nextObj,objProp:o,nextObj:s.nextObj[o]}},{nextObj:this.params}),r=n.obj,a=n.objProp;if(!r||!a||!(r[a]instanceof rt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:a}},e}();function bn(e,t,n){return he(function(){var r=Xf(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Te(r,t.bias),r})}function td(e,t,n){return n===void 0&&(n=!1),he(function(){var r=at(n?Te(On(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):bn(e,t.conv0,[2,2])),a=bn(r,t.conv1,[1,1]),s=at(Te(r,a)),o=bn(s,t.conv2,[1,1]);return at(Te(r,Te(a,o)))})}function sl(e,t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),he(function(){var a=at(n?Te(On(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):bn(e,t.conv0,r?[2,2]:[1,1])),s=bn(a,t.conv1,[1,1]),o=at(Te(a,s)),l=bn(o,t.conv2,[1,1]),c=at(Te(a,Te(s,l))),u=bn(c,t.conv3,[1,1]);return at(Te(a,Te(s,Te(l,u))))})}function Kn(e,t,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),he(function(){var a=Te(On(e,t.filters,[1,1],n),t.bias);return r?at(a):a})}function Br(e,t){Object.keys(e).forEach(function(n){t.some(function(r){return r.originalPath===n})||e[n].dispose()})}function Jc(e,t){return function(n,r,a,s){var o=rn(e(n*r*a*a),[a,a,n,r]),l=gt(e(r));return t.push({paramPath:s+"/filters"},{paramPath:s+"/bias"}),{filters:o,bias:l}}}function pp(e,t){return function(n,r,a){var s=ua(e(n*r),[n,r]),o=gt(e(r));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:s,bias:o}}}var Eb=function(){function e(t,n,r){this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}return e}();function mp(e,t){return function(n,r,a){var s=rn(e(9*n),[3,3,n,1]),o=rn(e(n*r),[1,1,n,r]),l=gt(e(r));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new Eb(s,o,l)}}function gp(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),a=e(t+"/bias",1);return new Eb(n,r,a)}}function _a(e,t){return function(n,r,a){var s=e[n];if(!Kc(s,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+s);return t.push({originalPath:n,paramPath:a||n}),s}}function $r(e){var t=e;function n(a){var s=t.slice(0,a);return t=t.slice(a),s}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function Rb(e,t){var n=Jc(e,t),r=mp(e,t);function a(o,l,c,u){u===void 0&&(u=!1);var d=u?n(o,l,3,c+"/conv0"):r(o,l,c+"/conv0"),h=r(l,l,c+"/conv1"),f=r(l,l,c+"/conv2");return{conv0:d,conv1:h,conv2:f}}function s(o,l,c,u){u===void 0&&(u=!1);var d=a(o,l,c,u),h=d.conv0,f=d.conv1,p=d.conv2,m=r(l,l,c+"/conv3");return{conv0:h,conv1:f,conv2:p,conv3:m}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:s}}function oR(e){var t=[],n=$r(e),r=n.extractWeights,a=n.getRemainingWeights,s=Rb(r,t).extractDenseBlock4Params,o=s(3,32,"dense0",!0),l=s(32,64,"dense1"),c=s(64,128,"dense2"),u=s(128,256,"dense3");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:l,dense2:c,dense3:u}}}function Db(e){return function(t){var n=e(t+"/filters",4),r=e(t+"/bias",1);return{filters:n,bias:r}}}function Ib(e,t){var n=_a(e,t),r=Db(n),a=gp(n);function s(l,c){c===void 0&&(c=!1);var u=c?r(l+"/conv0"):a(l+"/conv0"),d=a(l+"/conv1"),h=a(l+"/conv2");return{conv0:u,conv1:d,conv2:h}}function o(l,c){c===void 0&&(c=!1);var u=c?r(l+"/conv0"):a(l+"/conv0"),d=a(l+"/conv1"),h=a(l+"/conv2"),f=a(l+"/conv3");return{conv0:u,conv1:d,conv2:h,conv3:f}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:o}}function iR(e){var t=[],n=Ib(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Br(e,t),{params:r,paramMappings:t}}var Ab=function(e){Re(t,e);function t(){return e.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return he(function(){var a=n.toBatchTensor(112,!0),s=[122.782,117.001,104.298],o=Di(a,s).div(ce(255)),l=sl(o,r.dense0,!0);return l=sl(l,r.dense1),l=sl(l,r.dense2),l=sl(l,r.dense3),l=Ei(l,[7,7],[2,2],"valid"),l})},t.prototype.forward=function(n){return be(this,void 0,void 0,function(){var r;return we(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(n){return iR(n)},t.prototype.extractParams=function(n){return oR(n)},t}(Lr);function lr(e,t){return he(function(){return Te(qc(e,t.weights),t.bias)})}function lR(e,t,n){var r=[],a=$r(e),s=a.extractWeights,o=a.getRemainingWeights,l=pp(s,r),c=l(t,n,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:c}}}function cR(e){var t=[],n=_a(e,t);function r(s){var o=n(s+"/weights",2),l=n(s+"/bias",1);return{weights:o,bias:l}}var a={fc:r("fc")};return Br(e,t),{params:a,paramMappings:t}}function Tb(e){var t={},n={};return Object.keys(e).forEach(function(r){var a=r.startsWith("fc")?n:t;a[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var Pb=function(e){Re(t,e);function t(n,r){var a=e.call(this,n)||this;return a._faceFeatureExtractor=r,a}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return he(function(){var s=n instanceof xc?r.faceFeatureExtractor.forwardInput(n):n;return lr(s.as2D(s.shape[0],-1),a.fc)})},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),a=r.params,s=r.paramMappings;this._params=a,this._paramMappings=s},t.prototype.extractClassifierParams=function(n){return lR(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(n){var r=Tb(n),a=r.featureExtractorMap,s=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),cR(s)},t.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),s=a*r+a,o=n.slice(0,n.length-s),l=n.slice(n.length-s);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(l)},t}(Lr),av=["neutral","happy","sad","angry","fearful","disgusted","surprised"],uR=function(){function e(t){var n=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);av.forEach(function(r,a){n[r]=t[a]})}return e.prototype.asSortedArray=function(){var t=this;return av.map(function(n){return{expression:n,probability:t[n]}}).sort(function(n,r){return r.probability-n.probability})},e}(),dR=function(e){Re(t,e);function t(n){return n===void 0&&(n=new Ab),e.call(this,"FaceExpressionNet",n)||this}return t.prototype.forwardInput=function(n){var r=this;return he(function(){return Mr(r.runNet(n))})},t.prototype.forward=function(n){return be(this,void 0,void 0,function(){var r;return we(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.predictExpressions=function(n){return be(this,void 0,void 0,function(){var r,a,s,o,l=this;return we(this,function(c){switch(c.label){case 0:return[4,At(n)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return a=c.sent(),[4,Promise.all(_t(a).map(function(u){return be(l,void 0,void 0,function(){var d;return we(this,function(h){switch(h.label){case 0:return[4,u.data()];case 1:return d=h.sent(),u.dispose(),[2,d]}})})}))];case 3:return s=c.sent(),a.dispose(),o=s.map(function(u){return new uR(u)}),[2,r.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(Pb);function Fb(e,t){var n={expressions:t};return Object.assign({},e,n)}function hR(e){return Q3(e)&&e.landmarks instanceof vc&&e.unshiftedLandmarks instanceof vc&&e.alignedRect instanceof xr}function vp(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),s=e.detection.imageDims,o=new xr(e.detection.score,a.rescale(s.reverse()),s),l={landmarks:r,unshiftedLandmarks:t,alignedRect:o};return Object.assign({},e,l)}function fR(e,t){var n=Jc(e,t),r=mp(e,t);function a(o,l,c){var u=r(o,l,c+"/separable_conv0"),d=r(l,l,c+"/separable_conv1"),h=n(o,l,1,c+"/expansion_conv");return{separable_conv0:u,separable_conv1:d,expansion_conv:h}}function s(o,l){var c=r(o,o,l+"/separable_conv0"),u=r(o,o,l+"/separable_conv1"),d=r(o,o,l+"/separable_conv2");return{separable_conv0:c,separable_conv1:u,separable_conv2:d}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:a,extractMainBlockParams:s}}function pR(e,t){var n=[],r=$r(e),a=r.extractWeights,s=r.getRemainingWeights,o=fR(a,n),l=o.extractConvParams,c=o.extractSeparableConvParams,u=o.extractReductionBlockParams,d=o.extractMainBlockParams,h=l(3,32,3,"entry_flow/conv_in"),f=u(32,64,"entry_flow/reduction_block_0"),p=u(64,128,"entry_flow/reduction_block_1"),m={conv_in:h,reduction_block_0:f,reduction_block_1:p},x={};mi(t,0,1).forEach(function(w){x["main_block_"+w]=d(128,"middle_flow/main_block_"+w)});var y=u(128,256,"exit_flow/reduction_block"),g=c(256,512,"exit_flow/separable_conv"),v={reduction_block:y,separable_conv:g};if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:n,params:{entry_flow:m,middle_flow:x,exit_flow:v}}}function mR(e,t){var n=_a(e,t),r=Db(n),a=gp(n);function s(l){var c=a(l+"/separable_conv0"),u=a(l+"/separable_conv1"),d=r(l+"/expansion_conv");return{separable_conv0:c,separable_conv1:u,expansion_conv:d}}function o(l){var c=a(l+"/separable_conv0"),u=a(l+"/separable_conv1"),d=a(l+"/separable_conv2");return{separable_conv0:c,separable_conv1:u,separable_conv2:d}}return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:s,extractMainBlockParams:o}}function gR(e,t){var n=[],r=mR(e,n),a=r.extractConvParams,s=r.extractSeparableConvParams,o=r.extractReductionBlockParams,l=r.extractMainBlockParams,c=a("entry_flow/conv_in"),u=o("entry_flow/reduction_block_0"),d=o("entry_flow/reduction_block_1"),h={conv_in:c,reduction_block_0:u,reduction_block_1:d},f={};mi(t,0,1).forEach(function(y){f["main_block_"+y]=l("middle_flow/main_block_"+y)});var p=o("exit_flow/reduction_block"),m=s("exit_flow/separable_conv"),x={reduction_block:p,separable_conv:m};return Br(e,n),{params:{entry_flow:h,middle_flow:f,exit_flow:x},paramMappings:n}}function Mb(e,t,n){return Te(On(e,t.filters,n,"same"),t.bias)}function nd(e,t,n){n===void 0&&(n=!0);var r=n?at(e):e;return r=bn(r,t.separable_conv0,[1,1]),r=bn(at(r),t.separable_conv1,[1,1]),r=Et(r,[3,3],[2,2],"same"),r=Te(r,Mb(e,t.expansion_conv,[2,2])),r}function vR(e,t){var n=bn(at(e),t.separable_conv0,[1,1]);return n=bn(at(n),t.separable_conv1,[1,1]),n=bn(at(n),t.separable_conv2,[1,1]),n=Te(n,e),n}var xR=function(e){Re(t,e);function t(n){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return t.prototype.forwardInput=function(n){var r=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return he(function(){var s=n.toBatchTensor(112,!0),o=[122.782,117.001,104.298],l=Di(s,o).div(ce(256)),c=at(Mb(l,a.entry_flow.conv_in,[2,2]));return c=nd(c,a.entry_flow.reduction_block_0,!1),c=nd(c,a.entry_flow.reduction_block_1),mi(r._numMainBlocks,0,1).forEach(function(u){c=vR(c,a.middle_flow["main_block_"+u])}),c=nd(c,a.exit_flow.reduction_block),c=at(bn(c,a.exit_flow.separable_conv,[1,1])),c})},t.prototype.forward=function(n){return be(this,void 0,void 0,function(){var r;return we(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(n){return gR(n,this._numMainBlocks)},t.prototype.extractParams=function(n){return pR(n,this._numMainBlocks)},t}(Lr);function yR(e){var t=[],n=$r(e),r=n.extractWeights,a=n.getRemainingWeights,s=pp(r,t),o=s(512,1,"fc/age"),l=s(512,2,"fc/gender");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:o,gender:l}}}}function bR(e){var t=[],n=_a(e,t);function r(s){var o=n(s+"/weights",2),l=n(s+"/bias",1);return{weights:o,bias:l}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Br(e,t),{params:a,paramMappings:t}}var yc;(function(e){e.FEMALE="female",e.MALE="male"})(yc||(yc={}));var wR=function(e){Re(t,e);function t(n){n===void 0&&(n=new xR(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return he(function(){var s=n instanceof xc?r.faceFeatureExtractor.forwardInput(n):n,o=Ei(s,[7,7],[2,2],"valid").as2D(s.shape[0],-1),l=lr(o,a.fc.age).as1D(),c=lr(o,a.fc.gender);return{age:l,gender:c}})},t.prototype.forwardInput=function(n){var r=this;return he(function(){var a=r.runNet(n),s=a.age,o=a.gender;return{age:s,gender:Mr(o)}})},t.prototype.forward=function(n){return be(this,void 0,void 0,function(){var r;return we(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.predictAgeAndGender=function(n){return be(this,void 0,void 0,function(){var r,a,s,o,l,c,u=this;return we(this,function(d){switch(d.label){case 0:return[4,At(n)];case 1:return r=d.sent(),[4,this.forwardInput(r)];case 2:return a=d.sent(),s=_t(a.age),o=_t(a.gender),l=s.map(function(h,f){return{ageTensor:h,genderTensor:o[f]}}),[4,Promise.all(l.map(function(h){var f=h.ageTensor,p=h.genderTensor;return be(u,void 0,void 0,function(){var m,x,y,g,v;return we(this,function(w){switch(w.label){case 0:return[4,f.data()];case 1:return m=w.sent()[0],[4,p.data()];case 2:return x=w.sent()[0],y=x>.5,g=y?yc.MALE:yc.FEMALE,v=y?x:1-x,f.dispose(),p.dispose(),[2,{age:m,gender:g,genderProbability:v}]}})})}))];case 3:return c=d.sent(),a.age.dispose(),a.gender.dispose(),[2,r.isBatchInput?c:c[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),a=r.params,s=r.paramMappings;this._params=a,this._paramMappings=s},t.prototype.extractClassifierParams=function(n){return yR(n)},t.prototype.extractParamsFromWeigthMap=function(n){var r=Tb(n),a=r.featureExtractorMap,s=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),bR(s)},t.prototype.extractParams=function(n){var r=1539,a=n.slice(0,n.length-r),s=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},t}(Lr),Ob=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.postProcess=function(n,r,a){var s=a.map(function(l){var c=l.width,u=l.height,d=r/Math.max(u,c);return{width:c*d,height:u*d}}),o=s.length;return he(function(){var l=function(f,p){return Nn([fr([68],f),fr([68],p)],1).as2D(1,136).as1D()},c=function(f,p){var m=s[f],x=m.width,y=m.height;return p(x,y)?Math.abs(x-y)/2:0},u=function(f){return c(f,function(p,m){return p<m})},d=function(f){return c(f,function(p,m){return m<p})},h=n.mul(fr([o,136],r)).sub(Nn(Array.from(Array(o),function(f,p){return l(u(p),d(p))}))).div(Nn(Array.from(Array(o),function(f,p){return l(s[p].width,s[p].height)})));return h})},t.prototype.forwardInput=function(n){var r=this;return he(function(){var a=r.runNet(n);return r.postProcess(a,n.inputSize,n.inputDimensions.map(function(s){var o=s[0],l=s[1];return{height:o,width:l}}))})},t.prototype.forward=function(n){return be(this,void 0,void 0,function(){var r;return we(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.detectLandmarks=function(n){return be(this,void 0,void 0,function(){var r,a,s,o=this;return we(this,function(l){switch(l.label){case 0:return[4,At(n)];case 1:return r=l.sent(),a=he(function(){return _t(o.forwardInput(r))}),[4,Promise.all(a.map(function(c,u){return be(o,void 0,void 0,function(){var d,h,f,p,m;return we(this,function(x){switch(x.label){case 0:return f=(h=Array).from,[4,c.data()];case 1:return d=f.apply(h,[x.sent()]),p=d.filter(function(y,g){return Qg(g)}),m=d.filter(function(y,g){return!Qg(g)}),[2,new Y3(Array(68).fill(0).map(function(y,g){return new ze(p[g],m[g])}),{height:r.getInputHeight(u),width:r.getInputWidth(u)})]}})})}))];case 2:return s=l.sent(),a.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?s:s[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(Pb),Lb=function(e){Re(t,e);function t(n){return n===void 0&&(n=new Ab),e.call(this,"FaceLandmark68Net",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Ob);function NR(e){var t=[],n=Ib(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Br(e,t),{params:r,paramMappings:t}}function _R(e){var t=[],n=$r(e),r=n.extractWeights,a=n.getRemainingWeights,s=Rb(r,t).extractDenseBlock3Params,o=s(3,32,"dense0",!0),l=s(32,64,"dense1"),c=s(64,128,"dense2");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:l,dense2:c}}}var jR=function(e){Re(t,e);function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return he(function(){var a=n.toBatchTensor(112,!0),s=[122.782,117.001,104.298],o=Di(a,s).div(ce(255)),l=td(o,r.dense0,!0);return l=td(l,r.dense1),l=td(l,r.dense2),l=Ei(l,[14,14],[2,2],"valid"),l})},t.prototype.forward=function(n){return be(this,void 0,void 0,function(){var r;return we(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(n){return NR(n)},t.prototype.extractParams=function(n){return _R(n)},t}(Lr),kR=function(e){Re(t,e);function t(n){return n===void 0&&(n=new jR),e.call(this,"FaceLandmark68TinyNet",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Ob);(function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(Lb);function CR(e,t){return Te(Kt(e,t.weights),t.biases)}function xp(e,t,n,r,a){a===void 0&&(a="same");var s=t.conv,o=s.filters,l=s.bias,c=On(e,o,n,a);return c=Te(c,l),c=CR(c,t.scale),r?at(c):c}function SR(e,t){return xp(e,t,[1,1],!0)}function Bb(e,t){return xp(e,t,[1,1],!1)}function $b(e,t){return xp(e,t,[2,2],!0,"valid")}function ER(e,t){function n(l,c,u){var d=e(l),h=d.length/(c*u*u);if($3(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+d.length+", numFilters: "+c+", filterSize: "+u);return he(function(){return ma(rn(d,[c,h,u,u]),[2,3,1,0])})}function r(l,c,u,d){var h=n(l,c,u),f=gt(e(c));return t.push({paramPath:d+"/filters"},{paramPath:d+"/bias"}),{filters:h,bias:f}}function a(l,c){var u=gt(e(l)),d=gt(e(l));return t.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:u,biases:d}}function s(l,c,u,d){var h=r(l,c,u,d+"/conv"),f=a(c,d+"/scale");return{conv:h,scale:f}}function o(l,c,u,d,h){h===void 0&&(h=!1);var f=s((h?.5:1)*l,c,u,d+"/conv1"),p=s(l,c,u,d+"/conv2");return{conv1:f,conv2:p}}return{extractConvLayerParams:s,extractResidualLayerParams:o}}function RR(e){var t=$r(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],s=ER(n,a),o=s.extractConvLayerParams,l=s.extractResidualLayerParams,c=o(4704,32,7,"conv32_down"),u=l(9216,32,3,"conv32_1"),d=l(9216,32,3,"conv32_2"),h=l(9216,32,3,"conv32_3"),f=l(36864,64,3,"conv64_down",!0),p=l(36864,64,3,"conv64_1"),m=l(36864,64,3,"conv64_2"),x=l(36864,64,3,"conv64_3"),y=l(147456,128,3,"conv128_down",!0),g=l(147456,128,3,"conv128_1"),v=l(147456,128,3,"conv128_2"),w=l(589824,256,3,"conv256_down",!0),b=l(589824,256,3,"conv256_1"),N=l(589824,256,3,"conv256_2"),_=l(589824,256,3,"conv256_down_out"),C=he(function(){return ma(ua(n(256*128),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var k={conv32_down:c,conv32_1:u,conv32_2:d,conv32_3:h,conv64_down:f,conv64_1:p,conv64_2:m,conv64_3:x,conv128_down:y,conv128_1:g,conv128_2:v,conv256_down:w,conv256_1:b,conv256_2:N,conv256_down_out:_,fc:C};return{params:k,paramMappings:a}}function DR(e,t){var n=_a(e,t);function r(o){var l=n(o+"/scale/weights",1),c=n(o+"/scale/biases",1);return{weights:l,biases:c}}function a(o){var l=n(o+"/conv/filters",4),c=n(o+"/conv/bias",1),u=r(o);return{conv:{filters:l,bias:c},scale:u}}function s(o){return{conv1:a(o+"/conv1"),conv2:a(o+"/conv2")}}return{extractConvLayerParams:a,extractResidualLayerParams:s}}function IR(e){var t=[],n=DR(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,s=r("conv32_down"),o=a("conv32_1"),l=a("conv32_2"),c=a("conv32_3"),u=a("conv64_down"),d=a("conv64_1"),h=a("conv64_2"),f=a("conv64_3"),p=a("conv128_down"),m=a("conv128_1"),x=a("conv128_2"),y=a("conv256_down"),g=a("conv256_1"),v=a("conv256_2"),w=a("conv256_down_out"),b=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!B3(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var N={conv32_down:s,conv32_1:o,conv32_2:l,conv32_3:c,conv64_down:u,conv64_1:d,conv64_2:h,conv64_3:f,conv128_down:p,conv128_1:m,conv128_2:x,conv256_down:y,conv256_1:g,conv256_2:v,conv256_down_out:w,fc:b};return Br(e,t),{params:N,paramMappings:t}}function tr(e,t){var n=SR(e,t.conv1);return n=Bb(n,t.conv2),n=Te(n,e),n=at(n),n}function ol(e,t){var n=$b(e,t.conv1);n=Bb(n,t.conv2);var r=Ei(e,2,2,"valid"),a=Je(r.shape),s=r.shape[3]!==n.shape[3],o=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(o){var l=Lo(n.shape);l[1]=1;var c=Je(l);n=Nt([n,c],1);var u=Lo(n.shape);u[2]=1;var d=Je(u);n=Nt([n,d],2)}return r=s?Nt([r,a],3):r,n=Te(r,n),n=at(n),n}var AR=function(e){Re(t,e);function t(){return e.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return he(function(){var a=n.toBatchTensor(150,!0).toFloat(),s=[122.782,117.001,104.298],o=Di(a,s).div(ce(256)),l=$b(o,r.conv32_down);l=Et(l,3,2,"valid"),l=tr(l,r.conv32_1),l=tr(l,r.conv32_2),l=tr(l,r.conv32_3),l=ol(l,r.conv64_down),l=tr(l,r.conv64_1),l=tr(l,r.conv64_2),l=tr(l,r.conv64_3),l=ol(l,r.conv128_down),l=tr(l,r.conv128_1),l=tr(l,r.conv128_2),l=ol(l,r.conv256_down),l=tr(l,r.conv256_1),l=tr(l,r.conv256_2),l=ol(l,r.conv256_down_out);var c=l.mean([1,2]),u=qc(c,r.fc);return u})},t.prototype.forward=function(n){return be(this,void 0,void 0,function(){var r;return we(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.computeFaceDescriptor=function(n){return be(this,void 0,void 0,function(){var r,a,s,o=this;return we(this,function(l){switch(l.label){case 0:return[4,At(n)];case 1:return r=l.sent(),a=he(function(){return _t(o.forwardInput(r))}),[4,Promise.all(a.map(function(c){return c.data()}))];case 2:return s=l.sent(),a.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?s:s[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(n){return IR(n)},t.prototype.extractParams=function(n){return RR(n)},t}(Lr);function Wb(e,t){var n={descriptor:t};return Object.assign({},e,n)}function zb(e,t){var n={age:t};return Object.assign({},e,n)}function Ub(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var Vb=function(){function e(t){var n=t===void 0?{}:t,r=n.minFaceSize,a=n.scaleFactor,s=n.maxNumScales,o=n.scoreThresholds,l=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=a||.709,this._maxNumScales=s||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=l,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(c){return typeof c!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return typeof c!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function TR(e,t){function n(c,u){var d=rn(e(9*c),[3,3,c,1]),h=gt(e(c)),f=gt(e(c)),p=gt(e(c)),m=gt(e(c));return t.push({paramPath:u+"/filters"},{paramPath:u+"/batch_norm_scale"},{paramPath:u+"/batch_norm_offset"},{paramPath:u+"/batch_norm_mean"},{paramPath:u+"/batch_norm_variance"}),{filters:d,batch_norm_scale:h,batch_norm_offset:f,batch_norm_mean:p,batch_norm_variance:m}}function r(c,u,d,h,f){var p=rn(e(c*u*d*d),[d,d,c,u]),m=gt(e(u));return t.push({paramPath:h+"/filters"},{paramPath:h+"/"+(f?"batch_norm_offset":"bias")}),{filters:p,bias:m}}function a(c,u,d,h){var f=r(c,u,d,h,!0),p=f.filters,m=f.bias;return{filters:p,batch_norm_offset:m}}function s(c,u,d){var h=n(c,d+"/depthwise_conv"),f=a(c,u,1,d+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:f}}function o(){var c=a(3,32,3,"mobilenetv1/conv_0"),u=s(32,64,"mobilenetv1/conv_1"),d=s(64,128,"mobilenetv1/conv_2"),h=s(128,128,"mobilenetv1/conv_3"),f=s(128,256,"mobilenetv1/conv_4"),p=s(256,256,"mobilenetv1/conv_5"),m=s(256,512,"mobilenetv1/conv_6"),x=s(512,512,"mobilenetv1/conv_7"),y=s(512,512,"mobilenetv1/conv_8"),g=s(512,512,"mobilenetv1/conv_9"),v=s(512,512,"mobilenetv1/conv_10"),w=s(512,512,"mobilenetv1/conv_11"),b=s(512,1024,"mobilenetv1/conv_12"),N=s(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:u,conv_2:d,conv_3:h,conv_4:f,conv_5:p,conv_6:m,conv_7:x,conv_8:y,conv_9:g,conv_10:v,conv_11:w,conv_12:b,conv_13:N}}function l(){var c=a(1024,256,1,"prediction_layer/conv_0"),u=a(256,512,3,"prediction_layer/conv_1"),d=a(512,128,1,"prediction_layer/conv_2"),h=a(128,256,3,"prediction_layer/conv_3"),f=a(256,128,1,"prediction_layer/conv_4"),p=a(128,256,3,"prediction_layer/conv_5"),m=a(256,64,1,"prediction_layer/conv_6"),x=a(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),v=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),w=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),N=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),C=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),k=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),j=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),S=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),M=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),D={box_encoding_predictor:y,class_predictor:g},A={box_encoding_predictor:v,class_predictor:w},B={box_encoding_predictor:b,class_predictor:N},F={box_encoding_predictor:_,class_predictor:C},U={box_encoding_predictor:k,class_predictor:j},V={box_encoding_predictor:S,class_predictor:M};return{conv_0:c,conv_1:u,conv_2:d,conv_3:h,conv_4:f,conv_5:p,conv_6:m,conv_7:x,box_predictor_0:D,box_predictor_1:A,box_predictor_2:B,box_predictor_3:F,box_predictor_4:U,box_predictor_5:V}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:l}}function PR(e){var t=[],n=$r(e),r=n.extractWeights,a=n.getRemainingWeights,s=TR(r,t),o=s.extractMobilenetV1Params,l=s.extractPredictionLayerParams,c=o(),u=l(),d=Pf(r(5118*4),[1,5118,4]),h={extra_dim:d};if(t.push({paramPath:"output_layer/extra_dim"}),a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:c,prediction_layer:u,output_layer:h},paramMappings:t}}function FR(e,t){var n=_a(e,t);function r(u,d,h){var f=n(u+"/Conv2d_"+d+"_pointwise/weights",4,h+"/filters"),p=n(u+"/Conv2d_"+d+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:f,batch_norm_offset:p}}function a(u){var d="mobilenetv1/conv_"+u,h="MobilenetV1/Conv2d_"+u+"_depthwise",f=d+"/depthwise_conv",p=d+"/pointwise_conv",m=n(h+"/depthwise_weights",4,f+"/filters"),x=n(h+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),y=n(h+"/BatchNorm/beta",1,f+"/batch_norm_offset"),g=n(h+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),v=n(h+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:m,batch_norm_scale:x,batch_norm_offset:y,batch_norm_mean:g,batch_norm_variance:v},pointwise_conv:r("MobilenetV1",u,p)}}function s(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function o(u,d){var h=n(u+"/weights",4,d+"/filters"),f=n(u+"/biases",1,d+"/bias");return{filters:h,bias:f}}function l(u){var d=o("Prediction/BoxPredictor_"+u+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+u+"/box_encoding_predictor"),h=o("Prediction/BoxPredictor_"+u+"/ClassPredictor","prediction_layer/box_predictor_"+u+"/class_predictor");return{box_encoding_predictor:d,class_predictor:h}}function c(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:l(0),box_predictor_1:l(1),box_predictor_2:l(2),box_predictor_3:l(3),box_predictor_4:l(4),box_predictor_5:l(5)}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:c}}function MR(e){var t=[],n=FR(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,s=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Xc(s))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+s);var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:s}};return Br(e,t),{params:o,paramMappings:t}}function rr(e,t,n){return he(function(){var r=On(e,t.filters,n,"same");return r=Te(r,t.batch_norm_offset),qf(r,0,6)})}var OR=.0010000000474974513;function LR(e,t,n){return he(function(){var r=Vc(e,t.filters,n,"same");return r=Ly(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,OR),qf(r,0,6)})}function BR(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}function $R(e,t){return he(function(){var n=null,r=rr(e,t.conv_0,[2,2]),a=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(a.forEach(function(s,o){var l=o+1,c=BR(l);r=LR(r,s.depthwise_conv,c),r=rr(r,s.pointwise_conv,[1,1]),l===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function WR(e,t,n,r,a){var s=e.shape[0],o=Math.min(n,s),l=t.map(function(d,h){return{score:d,boxIndex:h}}).filter(function(d){return d.score>a}).sort(function(d,h){return h.score-d.score}),c=function(d){return d<=r?1:0},u=[];return l.forEach(function(d){if(!(u.length>=o)){for(var h=d.score,f=u.length-1;f>=0;--f){var p=zR(e,d.boxIndex,u[f]);if(p!==0&&(d.score*=c(p),d.score<=a))break}h===d.score&&u.push(d.boxIndex)}}),u}function zR(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),s=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),l=Math.max(r[t][1],r[t][3]),c=Math.min(r[n][0],r[n][2]),u=Math.min(r[n][1],r[n][3]),d=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),f=(o-a)*(l-s),p=(d-c)*(h-u);if(f<=0||p<=0)return 0;var m=Math.max(a,c),x=Math.max(s,u),y=Math.min(o,d),g=Math.min(l,h),v=Math.max(y-m,0)*Math.max(g-x,0);return v/(f+p-v)}function UR(e){var t=_t(ma(e,[1,0])),n=[kt(t[2],t[0]),kt(t[3],t[1])],r=[Te(t[0],Un(n[0],ce(2))),Te(t[1],Un(n[1],ce(2)))];return{sizes:n,centers:r}}function VR(e,t){var n=UR(e),r=n.sizes,a=n.centers,s=_t(ma(t,[1,0])),o=Un(Kt(yh(Un(s[2],ce(5))),r[0]),ce(2)),l=Te(Kt(Un(s[0],ce(10)),r[0]),a[0]),c=Un(Kt(yh(Un(s[3],ce(5))),r[1]),ce(2)),u=Te(Kt(Un(s[1],ce(10)),r[1]),a[1]);return ma(Nn([kt(l,o),kt(u,c),Te(l,o),Te(u,c)]),[1,0])}function qR(e,t,n){return he(function(){var r=e.shape[0],a=VR(qn(Ps(n.extra_dim,[r,1,1]),[-1,4]),qn(e,[-1,4]));a=qn(a,[r,a.shape[0]/r,4]);var s=Py(pr(t,[0,0,1],[-1,-1,-1])),o=pr(s,[0,0,0],[-1,-1,1]);o=qn(o,[r,o.shape[1]]);var l=_t(a),c=_t(o);return{boxes:l,scores:c}})}function ls(e,t){return he(function(){var n=e.shape[0],r=qn(Kn(e,t.box_encoding_predictor),[n,-1,1,4]),a=qn(Kn(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:a}})}function HR(e,t,n){return he(function(){var r=rr(e,n.conv_0,[1,1]),a=rr(r,n.conv_1,[2,2]),s=rr(a,n.conv_2,[1,1]),o=rr(s,n.conv_3,[2,2]),l=rr(o,n.conv_4,[1,1]),c=rr(l,n.conv_5,[2,2]),u=rr(c,n.conv_6,[1,1]),d=rr(u,n.conv_7,[2,2]),h=ls(t,n.box_predictor_0),f=ls(e,n.box_predictor_1),p=ls(a,n.box_predictor_2),m=ls(o,n.box_predictor_3),x=ls(c,n.box_predictor_4),y=ls(d,n.box_predictor_5),g=Nt([h.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,x.boxPredictionEncoding,y.boxPredictionEncoding],1),v=Nt([h.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,x.classPrediction,y.classPrediction],1);return{boxPredictions:g,classPredictions:v}})}var io=function(){function e(t){var n=t===void 0?{}:t,r=n.minConfidence,a=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=a||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),qb=function(e){Re(t,e);function t(){return e.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return he(function(){var a=n.toBatchTensor(512,!1).toFloat(),s=kt(Kt(a,ce(.007843137718737125)),ce(1)),o=$R(s,r.mobilenetv1),l=HR(o.out,o.conv11,r.prediction_layer),c=l.boxPredictions,u=l.classPredictions;return qR(c,u,r.output_layer)})},t.prototype.forward=function(n){return be(this,void 0,void 0,function(){var r;return we(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,At(n)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),be(this,void 0,void 0,function(){var a,s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,C,k;return we(this,function(j){switch(j.label){case 0:return a=new io(r),s=a.maxResults,o=a.minConfidence,[4,At(n)];case 1:for(l=j.sent(),c=this.forwardInput(l),u=c.boxes,d=c.scores,h=u[0],f=d[0],p=1;p<u.length;p++)u[p].dispose(),d[p].dispose();return y=(x=Array).from,[4,f.data()];case 2:return m=y.apply(x,[j.sent()]),g=.5,v=WR(h,m,s,g,o),w=l.getReshapedInputDimensions(0),b=l.inputSize,N=b/w.width,_=b/w.height,C=h.arraySync(),k=v.map(function(S){var M=[Math.max(0,C[S][0]),Math.min(1,C[S][2])].map(function(V){return V*_}),D=M[0],A=M[1],B=[Math.max(0,C[S][1]),Math.min(1,C[S][3])].map(function(V){return V*N}),F=B[0],U=B[1];return new xr(m[S],new lp(F,D,U-F,A-D),{height:l.getInputHeight(0),width:l.getInputWidth(0)})}),h.dispose(),f.dispose(),[2,k]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(n){return MR(n)},t.prototype.extractParams=function(n){return PR(n)},t}(Lr);(function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(qb);var GR=.4,KR=[new ze(.738768,.874946),new ze(2.42204,2.65704),new ze(4.30971,7.04493),new ze(10.246,4.59428),new ze(12.6868,11.8741)],XR=[new ze(1.603231,2.094468),new ze(6.041143,7.080126),new ze(2.882459,3.518061),new ze(4.266906,5.178857),new ze(9.041765,10.66308)],YR=[117.001,114.697,97.404],QR="tiny_yolov2_model",JR="tiny_yolov2_separable_conv_model",il=function(e){return typeof e=="number"};function ZR(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!il(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(t){return t||{}}).every(function(t){return il(t.x)&&il(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(il)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function yp(e){return he(function(){var t=Kt(e,ce(.10000000149011612));return Te(at(kt(e,t)),t)})}function Ur(e,t){return he(function(){var n=Za(e,[[0,0],[1,1],[1,1],[0,0]]);return n=On(n,t.conv.filters,[1,1],"valid"),n=kt(n,t.bn.sub),n=Kt(n,t.bn.truediv),n=Te(n,t.conv.bias),yp(n)})}function Vr(e,t){return he(function(){var n=Za(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Xf(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=Te(n,t.bias),yp(n)})}function eD(e,t){var n=Jc(e,t);function r(o,l){var c=gt(e(o)),u=gt(e(o));return t.push({paramPath:l+"/sub"},{paramPath:l+"/truediv"}),{sub:c,truediv:u}}function a(o,l,c){var u=n(o,l,3,c+"/conv"),d=r(l,c+"/bn");return{conv:u,bn:d}}var s=mp(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}}function tD(e,t,n,r){var a=$r(e),s=a.extractWeights,o=a.getRemainingWeights,l=[],c=eD(s,l),u=c.extractConvParams,d=c.extractConvWithBatchNormParams,h=c.extractSeparableConvParams,f;if(t.withSeparableConvs){var p=r[0],m=r[1],x=r[2],y=r[3],g=r[4],v=r[5],w=r[6],b=r[7],N=r[8],_=t.isFirstLayerConv2d?u(p,m,3,"conv0"):h(p,m,"conv0"),C=h(m,x,"conv1"),k=h(x,y,"conv2"),j=h(y,g,"conv3"),S=h(g,v,"conv4"),M=h(v,w,"conv5"),D=b?h(w,b,"conv6"):void 0,A=N?h(b,N,"conv7"):void 0,B=u(N||b||w,5*n,1,"conv8");f={conv0:_,conv1:C,conv2:k,conv3:j,conv4:S,conv5:M,conv6:D,conv7:A,conv8:B}}else{var p=r[0],m=r[1],x=r[2],y=r[3],g=r[4],v=r[5],w=r[6],b=r[7],N=r[8],_=d(p,m,"conv0"),C=d(m,x,"conv1"),k=d(x,y,"conv2"),j=d(y,g,"conv3"),S=d(g,v,"conv4"),M=d(v,w,"conv5"),D=d(w,b,"conv6"),A=d(b,N,"conv7"),B=u(N,5*n,1,"conv8");f={conv0:_,conv1:C,conv2:k,conv3:j,conv4:S,conv5:M,conv6:D,conv7:A,conv8:B}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:f,paramMappings:l}}function nD(e,t){var n=_a(e,t);function r(l){var c=n(l+"/sub",1),u=n(l+"/truediv",1);return{sub:c,truediv:u}}function a(l){var c=n(l+"/filters",4),u=n(l+"/bias",1);return{filters:c,bias:u}}function s(l){var c=a(l+"/conv"),u=r(l+"/bn");return{conv:c,bn:u}}var o=gp(n);return{extractConvParams:a,extractConvWithBatchNormParams:s,extractSeparableConvParams:o}}function rD(e,t){var n=[],r=nD(e,n),a=r.extractConvParams,s=r.extractConvWithBatchNormParams,o=r.extractSeparableConvParams,l;if(t.withSeparableConvs){var c=t.filterSizes&&t.filterSizes.length||9;l={conv0:t.isFirstLayerConv2d?a("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:c>7?o("conv6"):void 0,conv7:c>8?o("conv7"):void 0,conv8:a("conv8")}}else l={conv0:s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:s("conv6"),conv7:s("conv7"),conv8:a("conv8")};return Br(e,n),{params:l,paramMappings:n}}var sv;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(sv||(sv={}));var bp=function(){function e(t){var n=t===void 0?{}:t,r=n.inputSize,a=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=a||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),Hb=function(e){Re(t,e);function t(n){var r=e.call(this,"TinyYolov2")||this;return ZR(n),r._config=n,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(n,r){var a=Ur(n,r.conv0);return a=Et(a,[2,2],[2,2],"same"),a=Ur(a,r.conv1),a=Et(a,[2,2],[2,2],"same"),a=Ur(a,r.conv2),a=Et(a,[2,2],[2,2],"same"),a=Ur(a,r.conv3),a=Et(a,[2,2],[2,2],"same"),a=Ur(a,r.conv4),a=Et(a,[2,2],[2,2],"same"),a=Ur(a,r.conv5),a=Et(a,[2,2],[1,1],"same"),a=Ur(a,r.conv6),a=Ur(a,r.conv7),Kn(a,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(n,r){var a=this.config.isFirstLayerConv2d?yp(Kn(n,r.conv0,"valid",!1)):Vr(n,r.conv0);return a=Et(a,[2,2],[2,2],"same"),a=Vr(a,r.conv1),a=Et(a,[2,2],[2,2],"same"),a=Vr(a,r.conv2),a=Et(a,[2,2],[2,2],"same"),a=Vr(a,r.conv3),a=Et(a,[2,2],[2,2],"same"),a=Vr(a,r.conv4),a=Et(a,[2,2],[2,2],"same"),a=Vr(a,r.conv5),a=Et(a,[2,2],[1,1],"same"),a=r.conv6?Vr(a,r.conv6):a,a=r.conv7?Vr(a,r.conv7):a,Kn(a,r.conv8,"valid",!1)},t.prototype.forwardInput=function(n,r){var a=this,s=this.params;if(!s)throw new Error("TinyYolov2 - load model before inference");return he(function(){var o=n.toBatchTensor(r,!1).toFloat();return o=a.config.meanRgb?Di(o,a.config.meanRgb):o,o=o.div(ce(256)),a.config.withSeparableConvs?a.runMobilenet(o,s):a.runTinyYolov2(o,s)})},t.prototype.forward=function(n,r){return be(this,void 0,void 0,function(){var a;return we(this,function(s){switch(s.label){case 0:return a=this.forwardInput,[4,At(n)];case 1:return[4,a.apply(this,[s.sent(),r])];case 2:return[2,s.sent()]}})})},t.prototype.detect=function(n,r){return r===void 0&&(r={}),be(this,void 0,void 0,function(){var a,s,o,l,c,u,d,h,f,p,m,x,y,g,v=this;return we(this,function(w){switch(w.label){case 0:return a=new bp(r),s=a.inputSize,o=a.scoreThreshold,[4,At(n)];case 1:return l=w.sent(),[4,this.forwardInput(l,s)];case 2:return c=w.sent(),u=he(function(){return _t(c)[0].expandDims()}),d={width:l.getInputWidth(0),height:l.getInputHeight(0)},[4,this.extractBoxes(u,l.getReshapedInputDimensions(0),o)];case 3:return h=w.sent(),c.dispose(),u.dispose(),f=h.map(function(b){return b.box}),p=h.map(function(b){return b.score}),m=h.map(function(b){return b.classScore}),x=h.map(function(b){return v.config.classes[b.label]}),y=gi(f.map(function(b){return b.rescale(s)}),p,this.config.iouThreshold,!0),g=y.map(function(b){return new xb(p[b],m[b],x[b],f[b],d)}),[2,g]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(n){return rD(n,this.config)},t.prototype.extractParams=function(n){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,a=r?r.length:void 0;if(a!==7&&a!==8&&a!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+a+" filterSizes in config");return tD(n,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(n,r,a){return be(this,void 0,void 0,function(){var s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,C,k,j,S,M,D,A,B,F,U,V,P=this;return we(this,function($){switch($.label){case 0:return s=r.width,o=r.height,l=Math.max(s,o),c=l/s,u=l/o,d=n.shape[1],h=this.config.anchors.length,f=he(function(){var I=n.reshape([d,d,h,P.boxEncodingSize]),q=I.slice([0,0,0,0],[d,d,h,4]),X=I.slice([0,0,0,4],[d,d,h,1]),ne=P.withClassScores?Mr(I.slice([0,0,0,5],[d,d,h,P.config.classes.length]),3):ce(0);return[q,X,ne]}),p=f[0],m=f[1],x=f[2],y=[],[4,m.array()];case 1:return g=$.sent(),[4,p.array()];case 2:v=$.sent(),w=0,$.label=3;case 3:if(!(w<d))return[3,12];b=0,$.label=4;case 4:if(!(b<d))return[3,11];N=0,$.label=5;case 5:return N<h?(_=ed(g[w][b][N][0]),!a||_>a?(C=(b+ed(v[w][b][N][0]))/d*c,k=(w+ed(v[w][b][N][1]))/d*u,j=Math.exp(v[w][b][N][2])*this.config.anchors[N].x/d*c,S=Math.exp(v[w][b][N][3])*this.config.anchors[N].y/d*u,M=C-j/2,D=k-S/2,A={row:w,col:b,anchor:N},this.withClassScores?[4,this.extractPredictedClass(x,A)]:[3,7]):[3,9]):[3,10];case 6:return V=$.sent(),[3,8];case 7:V={classScore:1,label:0},$.label=8;case 8:B=V,F=B.classScore,U=B.label,y.push(qt({box:new Yc(M,D,M+j,D+S),score:_,classScore:_*F,label:U},A)),$.label=9;case 9:return N++,[3,5];case 10:return b++,[3,4];case 11:return w++,[3,3];case 12:return p.dispose(),m.dispose(),x.dispose(),[2,y]}})})},t.prototype.extractPredictedClass=function(n,r){return be(this,void 0,void 0,function(){var a,s,o,l;return we(this,function(c){switch(c.label){case 0:return a=r.row,s=r.col,o=r.anchor,[4,n.array()];case 1:return l=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(u,d){return l[a][s][o][d]}).map(function(u,d){return{classScore:u,label:d}}).reduce(function(u,d){return u.classScore>d.classScore?u:d})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Lr),aD=function(e){Re(t,e);function t(n){n===void 0&&(n=!0);var r=this,a=Object.assign({},{withSeparableConvs:n,iouThreshold:GR,classes:["face"]},n?{anchors:XR,meanRgb:YR}:{anchors:KR,withClassScores:!0});return r=e.call(this,a)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return be(this,void 0,void 0,function(){var a;return we(this,function(s){switch(s.label){case 0:return[4,this.detect(n,r)];case 1:return a=s.sent(),[2,a.map(function(o){return new xr(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?JR:QR},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(Hb),wp=function(e){Re(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return t}(bp),Ii=function(){function e(){}return e.prototype.then=function(t){return be(this,void 0,void 0,function(){var n;return we(this,function(r){switch(r.label){case 0:return n=t,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return be(this,void 0,void 0,function(){return we(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},e}();function Zc(e,t,n,r,a){return a===void 0&&(a=function(s){var o=s.alignedRect;return o}),be(this,void 0,void 0,function(){var s,o,l,c,u;return we(this,function(d){switch(d.label){case 0:return s=e.map(function(h){return hR(h)?a(h):h.detection}),l=r,l?[3,5]:t instanceof rt?[4,fp(t,s)]:[3,2];case 1:return c=d.sent(),[3,4];case 2:return[4,hp(t,s)];case 3:c=d.sent(),d.label=4;case 4:l=c,d.label=5;case 5:return o=l,[4,n(o)];case 6:return u=d.sent(),o.forEach(function(h){return h instanceof rt&&h.dispose()}),[2,u]}})})}function Np(e,t,n,r,a){return be(this,void 0,void 0,function(){var s=this;return we(this,function(o){return[2,Zc([e],t,function(l){return be(s,void 0,void 0,function(){return we(this,function(c){return[2,n(l[0])]})})},r,a)]})})}function sD(e){return he(function(){return Nn(_t(e,3).reverse(),3)})}var ll=2,bc=12;function oD(e,t){var n=Jc(e,t),r=pp(e,t);function a(u,d){var h=gt(e(u));return t.push({paramPath:d}),h}function s(u,d,h){h===void 0&&(h=!1);var f=n(u[0],u[1],3,d+"/conv1"),p=a(u[1],d+"/prelu1_alpha"),m=n(u[1],u[2],3,d+"/conv2"),x=a(u[2],d+"/prelu2_alpha"),y=n(u[2],u[3],h?2:3,d+"/conv3"),g=a(u[3],d+"/prelu3_alpha");return{conv1:f,prelu1_alpha:p,conv2:m,prelu2_alpha:x,conv3:y,prelu3_alpha:g}}function o(){var u=s([3,10,16,32],"pnet"),d=n(32,2,1,"pnet/conv4_1"),h=n(32,4,1,"pnet/conv4_2");return qt(qt({},u),{conv4_1:d,conv4_2:h})}function l(){var u=s([3,28,48,64],"rnet",!0),d=r(576,128,"rnet/fc1"),h=a(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),p=r(128,4,"rnet/fc2_2");return qt(qt({},u),{fc1:d,prelu4_alpha:h,fc2_1:f,fc2_2:p})}function c(){var u=s([3,32,64,64],"onet"),d=n(64,128,2,"onet/conv4"),h=a(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),p=a(256,"onet/prelu5_alpha"),m=r(256,2,"onet/fc2_1"),x=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return qt(qt({},u),{conv4:d,prelu4_alpha:h,fc1:f,prelu5_alpha:p,fc2_1:m,fc2_2:x,fc2_3:y})}return{extractPNetParams:o,extractRNetParams:l,extractONetParams:c}}function iD(e){var t=$r(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],s=oD(n,a),o=s.extractPNetParams,l=s.extractRNetParams,c=s.extractONetParams,u=o(),d=l(),h=c();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:u,rnet:d,onet:h},paramMappings:a}}function lD(e,t){var n=_a(e,t);function r(d){var h=n(d+"/weights",4,d+"/filters"),f=n(d+"/bias",1);return{filters:h,bias:f}}function a(d){var h=n(d+"/weights",2),f=n(d+"/bias",1);return{weights:h,bias:f}}function s(d){return n(d,1)}function o(d){var h=r(d+"/conv1"),f=s(d+"/prelu1_alpha"),p=r(d+"/conv2"),m=s(d+"/prelu2_alpha"),x=r(d+"/conv3"),y=s(d+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:p,prelu2_alpha:m,conv3:x,prelu3_alpha:y}}function l(){var d=o("pnet"),h=r("pnet/conv4_1"),f=r("pnet/conv4_2");return qt(qt({},d),{conv4_1:h,conv4_2:f})}function c(){var d=o("rnet"),h=a("rnet/fc1"),f=s("rnet/prelu4_alpha"),p=a("rnet/fc2_1"),m=a("rnet/fc2_2");return qt(qt({},d),{fc1:h,prelu4_alpha:f,fc2_1:p,fc2_2:m})}function u(){var d=o("onet"),h=r("onet/conv4"),f=s("onet/prelu4_alpha"),p=a("onet/fc1"),m=s("onet/prelu5_alpha"),x=a("onet/fc2_1"),y=a("onet/fc2_2"),g=a("onet/fc2_3");return qt(qt({},d),{conv4:h,prelu4_alpha:f,fc1:p,prelu5_alpha:m,fc2_1:x,fc2_2:y,fc2_3:g})}return{extractPNetParams:l,extractRNetParams:c,extractONetParams:u}}function cD(e){var t=[],n=lD(e,t),r=n.extractPNetParams,a=n.extractRNetParams,s=n.extractONetParams,o=r(),l=a(),c=s();return Br(e,t),{params:{pnet:o,rnet:l,onet:c},paramMappings:t}}function Sh(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}function uD(e,t,n){for(var r=n[0],a=n[1],s=bc/e,o=[],l=Math.min(r,a)*s,c=0;l>=12;)o.push(s*Math.pow(t,c)),l=l*t,c+=1;return o}var _p=function(e){Re(t,e);function t(n,r,a,s){return e.call(this,{left:n,top:r,right:a,bottom:s},!0)||this}return t}(ga);function Gb(e){return he(function(){return Kt(kt(e,ce(127.5)),ce(.0078125))})}function $s(e,t){return he(function(){return Te(at(e),Kt(t,fc(at(fc(e)))))})}function jp(e,t,n){return n===void 0&&(n=!1),he(function(){var r=Kn(e,t.conv1,"valid");return r=$s(r,t.prelu1_alpha),r=Et(r,n?[2,2]:[3,3],[2,2],"same"),r=Kn(r,t.conv2,"valid"),r=$s(r,t.prelu2_alpha),r=n?r:Et(r,[3,3],[2,2],"valid"),r=Kn(r,t.conv3,"valid"),r=$s(r,t.prelu3_alpha),r})}function dD(e,t){return he(function(){var n=jp(e,t,!0),r=Kn(n,t.conv4_1,"valid"),a=Rn(Hc(r,3),3),s=Mr(kt(r,a),3),o=Kn(n,t.conv4_2,"valid");return{prob:s,regions:o}})}function hD(e,t){return he(function(){var n=Sh(t,e.shape.slice(1)),r=n.height,a=n.width,s=ep.resizeBilinear(e,[r,a]),o=Gb(s);return ma(o,[0,2,1,3])})}function fD(e,t,n,r){for(var a=[],s=e.arraySync(),o=0;o<e.shape[0];o++)for(var l=0;l<e.shape[1];l++)s[o][l]>=r&&a.push(new ze(l,o));var c=a.map(function(u){var d=new Yc(Math.round((u.y*ll+1)/n),Math.round((u.x*ll+1)/n),Math.round((u.y*ll+bc)/n),Math.round((u.x*ll+bc)/n)),h=s[u.y][u.x],f=t.arraySync(),p=new _p(f[u.y][u.x][0],f[u.y][u.x][1],f[u.y][u.x][2],f[u.y][u.x][3]);return{cell:d,score:h,region:p}});return c}function pD(e,t,n,r,a){a.stage1=[];var s=t.map(function(f){return he(function(){var p={scale:f},m=hD(e,f),x=Date.now(),y=dD(m,r),g=y.prob,v=y.regions;p.pnet=Date.now()-x;var w=_t(_t(g,3)[1])[0],b=_t(v)[0];return{scoresTensor:w,regionsTensor:b,scale:f,statsForScale:p}})}),o=s.map(function(f){var p=f.scoresTensor,m=f.regionsTensor,x=f.scale,y=f.statsForScale,g=fD(p,m,x,n);if(p.dispose(),m.dispose(),!g.length)return a.stage1.push(y),[];var v=Date.now(),w=gi(g.map(function(b){return b.cell}),g.map(function(b){return b.score}),.5);return y.nms=Date.now()-v,y.numBoxes=w.length,a.stage1.push(y),w.map(function(b){return g[b]})}),l=o.reduce(function(f,p){return f.concat(p)},[]),c=[],u=[];if(l.length>0){var d=Date.now(),h=gi(l.map(function(f){return f.cell}),l.map(function(f){return f.score}),.7);a.stage1_nms=Date.now()-d,u=h.map(function(f){return l[f].score}),c=h.map(function(f){return l[f]}).map(function(f){var p=f.cell,m=f.region;return new Yc(p.left+m.left*p.width,p.top+m.top*p.height,p.right+m.right*p.width,p.bottom+m.bottom*p.height).toSquare().round()})}return{boxes:c,scores:u}}function Kb(e,t,n){var r=n.width,a=n.height;return be(this,void 0,void 0,function(){var s,o,l,c=this;return we(this,function(u){switch(u.label){case 0:return s=Xa(e),[4,Promise.all(t.map(function(d){return be(c,void 0,void 0,function(){var h,f,p,m,x,y,g,v;return we(this,function(w){return h=d.padAtBorders(e.height,e.width),f=h.y,p=h.ey,m=h.x,x=h.ex,y=m-1,g=f-1,v=s.getImageData(y,g,x-y,p-g),[2,Yt.isNodejs()?dp(v):createImageBitmap(v)]})})}))];case 1:return o=u.sent(),l=[],o.forEach(function(d){var h=Qc({width:r,height:a}),f=Xa(h);f.drawImage(d,0,0,r,a);for(var p=f.getImageData(0,0,r,a).data,m=[],x=0;x<p.length;x+=4)m.push(p[x+2]),m.push(p[x+1]),m.push(p[x]);l.push(m)}),[2,l.map(function(d){var h=he(function(){var f=ma(rn(d,[1,r,a,3]),[0,2,1,3]).toFloat();return Gb(f)});return h})]}})})}function mD(e,t){return he(function(){var n=jp(e,t),r=qn(n,[n.shape[0],t.fc1.weights.shape[0]]),a=lr(r,t.fc1),s=$s(a,t.prelu4_alpha),o=lr(s,t.fc2_1),l=Rn(Hc(o,1),1),c=Mr(kt(o,l),1),u=lr(s,t.fc2_2),d=_t(c,1)[1];return{scores:d,regions:u}})}function gD(e,t,n,r,a){return be(this,void 0,void 0,function(){var s,o,l,c,u,d,h,f,p,m,x,y,g,v;return we(this,function(w){switch(w.label){case 0:return s=Date.now(),[4,Kb(e,t,{width:24,height:24})];case 1:return o=w.sent(),a.stage2_extractImagePatches=Date.now()-s,s=Date.now(),l=o.map(function(b){var N=mD(b,r);return b.dispose(),N}),a.stage2_rnet=Date.now()-s,c=l.length>1?Nt(l.map(function(b){return b.scores})):l[0].scores,h=(d=Array).from,[4,c.data()];case 2:return u=h.apply(d,[w.sent()]),c.dispose(),f=u.map(function(b,N){return{score:b,idx:N}}).filter(function(b){return b.score>n}).map(function(b){var N=b.idx;return N}),p=f.map(function(b){return t[b]}),m=f.map(function(b){return u[b]}),x=[],y=[],p.length>0&&(s=Date.now(),g=gi(p,m,.7),a.stage2_nms=Date.now()-s,v=g.map(function(b){var N=l[f[b]].regions.arraySync();return new _p(N[0][0],N[0][1],N[0][2],N[0][3])}),y=g.map(function(b){return m[b]}),x=g.map(function(b,N){return p[b].calibrate(v[N])})),l.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:x,scores:y}]}})})}function vD(e,t){return he(function(){var n=jp(e,t);n=Et(n,[2,2],[2,2],"same"),n=Kn(n,t.conv4,"valid"),n=$s(n,t.prelu4_alpha);var r=qn(n,[n.shape[0],t.fc1.weights.shape[0]]),a=lr(r,t.fc1),s=$s(a,t.prelu5_alpha),o=lr(s,t.fc2_1),l=Rn(Hc(o,1),1),c=Mr(kt(o,l),1),u=lr(s,t.fc2_2),d=lr(s,t.fc2_3),h=_t(c,1)[1];return{scores:h,regions:u,points:d}})}function xD(e,t,n,r,a){return be(this,void 0,void 0,function(){var s,o,l,c,u,d,h,f,p,m,x,y,g,v,w;return we(this,function(b){switch(b.label){case 0:return s=Date.now(),[4,Kb(e,t,{width:48,height:48})];case 1:return o=b.sent(),a.stage3_extractImagePatches=Date.now()-s,s=Date.now(),l=o.map(function(N){var _=vD(N,r);return N.dispose(),_}),a.stage3_onet=Date.now()-s,c=l.length>1?Nt(l.map(function(N){return N.scores})):l[0].scores,h=(d=Array).from,[4,c.data()];case 2:return u=h.apply(d,[b.sent()]),c.dispose(),f=u.map(function(N,_){return{score:N,idx:_}}).filter(function(N){return N.score>n}).map(function(N){var _=N.idx;return _}),p=f.map(function(N){var _=l[N].regions.arraySync();return new _p(_[0][0],_[0][1],_[0][2],_[0][3])}),m=f.map(function(N,_){return t[N].calibrate(p[_])}),x=f.map(function(N){return u[N]}),y=[],g=[],v=[],m.length>0&&(s=Date.now(),w=gi(m,x,.7,!1),a.stage3_nms=Date.now()-s,y=w.map(function(N){return m[N]}),g=w.map(function(N){return x[N]}),v=w.map(function(N,_){return Array(5).fill(0).map(function(C,k){var j=l[N].points.arraySync();return new ze(j[0][k]*(y[_].width+1)+y[_].left,j[0][k+5]*(y[_].height+1)+y[_].top)})})),l.forEach(function(N){N.regions.dispose(),N.scores.dispose(),N.points.dispose()}),[2,{boxes:y,scores:g,points:v}]}})})}var yD=function(e){Re(t,e);function t(){return e.call(this,"Mtcnn")||this}return t.prototype.load=function(n){return be(this,void 0,void 0,function(){return we(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,n)]})})},t.prototype.loadFromDisk=function(n){return be(this,void 0,void 0,function(){return we(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,n)]})})},t.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),be(this,void 0,void 0,function(){var a,s,o,l,c,u,d,h,f,p,m,x,y,g,v,w,b,N,_,C,k;return we(this,function(j){switch(j.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(s=n.canvases[0],!s)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},l=Date.now(),c=he(function(){return sD(Rn(op.fromPixels(s)).toFloat())}),u=function(S){return c.dispose(),o.total=Date.now()-l,S},d=c.shape.slice(1),h=d[0],f=d[1],p=new Vb(r),m=p.minFaceSize,x=p.scaleFactor,y=p.maxNumScales,g=p.scoreThresholds,v=p.scaleSteps,w=(v||uD(m,x,[h,f])).filter(function(S){var M=Sh(S,[h,f]);return Math.min(M.width,M.height)>bc}).slice(0,y),o.scales=w,o.pyramid=w.map(function(S){return Sh(S,[h,f])}),b=Date.now(),[4,pD(c,w,g[0],a.pnet,o)];case 1:return N=j.sent(),o.total_stage1=Date.now()-b,N.boxes.length?(o.stage2_numInputBoxes=N.boxes.length,b=Date.now(),[4,gD(s,N.boxes,g[1],a.rnet,o)]):[2,u({results:[],stats:o})];case 2:return _=j.sent(),o.total_stage2=Date.now()-b,_.boxes.length?(o.stage3_numInputBoxes=_.boxes.length,b=Date.now(),[4,xD(s,_.boxes,g[2],a.onet,o)]):[2,u({results:[],stats:o})];case 3:return C=j.sent(),o.total_stage3=Date.now()-b,k=C.boxes.map(function(S,M){return vp(cp({},new xr(C.scores[M],new lp(S.left/f,S.top/h,S.width/f,S.height/h),{height:h,width:f})),new X3(C.points[M].map(function(D){return D.sub(new ze(S.left,S.top)).div(new ze(S.width,S.height))}),{width:S.width,height:S.height}))}),[2,u({results:k,stats:o})]}})})},t.prototype.forward=function(n,r){return r===void 0&&(r={}),be(this,void 0,void 0,function(){var a;return we(this,function(s){switch(s.label){case 0:return a=this.forwardInput,[4,At(n)];case 1:return[4,a.apply(this,[s.sent(),r])];case 2:return[2,s.sent().results]}})})},t.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),be(this,void 0,void 0,function(){var a;return we(this,function(s){switch(s.label){case 0:return a=this.forwardInput,[4,At(n)];case 1:return[2,a.apply(this,[s.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(n){return cD(n)},t.prototype.extractParams=function(n){return iD(n)},t}(Lr),bD=.4,wD=[new ze(1.603231,2.094468),new ze(6.041143,7.080126),new ze(2.882459,3.518061),new ze(4.266906,5.178857),new ze(9.041765,10.66308)],ND=[117.001,114.697,97.404],_D=function(e){Re(t,e);function t(){var n=this,r={withSeparableConvs:!0,iouThreshold:bD,classes:["face"],anchors:wD,meanRgb:ND,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=e.call(this,r)||this,n}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return be(this,void 0,void 0,function(){var a;return we(this,function(s){switch(s.label){case 0:return[4,this.detect(n,r)];case 1:return a=s.sent(),[2,a.map(function(o){return new xr(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(Hb),ft={ssdMobilenetv1:new qb,tinyFaceDetector:new _D,tinyYolov2:new aD,mtcnn:new yD,faceLandmark68Net:new Lb,faceLandmark68TinyNet:new kR,faceRecognitionNet:new AR,faceExpressionNet:new dR,ageGenderNet:new wR},Xb=function(e){Re(t,e);function t(n,r,a){var s=e.call(this)||this;return s.parentTask=n,s.input=r,s.extractedFaces=a,s}return t}(Ii),kp=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r,a=this;return we(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),[4,Zc(n,this.input,function(o){return be(a,void 0,void 0,function(){return we(this,function(l){switch(l.label){case 0:return[4,Promise.all(o.map(function(c){return ft.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,l.sent()]}})})},this.extractedFaces)];case 2:return r=s.sent(),[2,n.map(function(o,l){return Fb(o,r[l])})]}})})},t.prototype.withAgeAndGender=function(){return new Rp(this,this.input)},t}(Xb),Cp=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r;return we(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),n?[4,Np(n,this.input,function(s){return ft.faceExpressionNet.predictExpressions(s)},this.extractedFaces)]:[2];case 2:return r=a.sent(),[2,Fb(n,r)]}})})},t.prototype.withAgeAndGender=function(){return new Dp(this,this.input)},t}(Xb),Sp=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Ip(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Tp(this,this.input)},t}(kp),Ep=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Ap(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Pp(this,this.input)},t}(Cp),Yb=function(e){Re(t,e);function t(n,r,a){var s=e.call(this)||this;return s.parentTask=n,s.input=r,s.extractedFaces=a,s}return t}(Ii),Rp=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r,a=this;return we(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),[4,Zc(n,this.input,function(o){return be(a,void 0,void 0,function(){return we(this,function(l){switch(l.label){case 0:return[4,Promise.all(o.map(function(c){return ft.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,l.sent()]}})})},this.extractedFaces)];case 2:return r=s.sent(),[2,n.map(function(o,l){var c=r[l],u=c.age,d=c.gender,h=c.genderProbability;return zb(Ub(o,d,h),u)})]}})})},t.prototype.withFaceExpressions=function(){return new kp(this,this.input)},t}(Yb),Dp=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r,a,s,o;return we(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return n=l.sent(),n?[4,Np(n,this.input,function(c){return ft.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return r=l.sent(),a=r.age,s=r.gender,o=r.genderProbability,[2,zb(Ub(n,s,o),a)]}})})},t.prototype.withFaceExpressions=function(){return new Cp(this,this.input)},t}(Yb),Ip=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new Sp(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Tp(this,this.input)},t}(Rp),Ap=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new Ep(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Pp(this,this.input)},t}(Dp),Qb=function(e){Re(t,e);function t(n,r){var a=e.call(this)||this;return a.parentTask=n,a.input=r,a}return t}(Ii),Tp=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r;return we(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),[4,Zc(n,this.input,function(s){return Promise.all(s.map(function(o){return ft.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(s){return s.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=a.sent(),[2,r.map(function(s,o){return Wb(n[o],s)})]}})})},t.prototype.withFaceExpressions=function(){return new Sp(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ip(this,this.input)},t}(Qb),Pp=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r;return we(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return n=a.sent(),n?[4,Np(n,this.input,function(s){return ft.faceRecognitionNet.computeFaceDescriptor(s)},null,function(s){return s.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=a.sent(),[2,Wb(n,r)]}})})},t.prototype.withFaceExpressions=function(){return new Ep(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ap(this,this.input)},t}(Qb),Jb=function(e){Re(t,e);function t(n,r,a){var s=e.call(this)||this;return s.parentTask=n,s.input=r,s.useTinyLandmarkNet=a,s}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ft.faceLandmark68TinyNet:ft.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Ii),jD=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r,a,s,o,l=this;return we(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return n=c.sent(),r=n.map(function(u){return u.detection}),this.input instanceof rt?[4,fp(this.input,r)]:[3,3];case 2:return s=c.sent(),[3,5];case 3:return[4,hp(this.input,r)];case 4:s=c.sent(),c.label=5;case 5:return a=s,[4,Promise.all(a.map(function(u){return l.landmarkNet.detectLandmarks(u)}))];case 6:return o=c.sent(),a.forEach(function(u){return u instanceof rt&&u.dispose()}),[2,n.map(function(u,d){return vp(u,o[d])})]}})})},t.prototype.withFaceExpressions=function(){return new Sp(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ip(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Tp(this,this.input)},t}(Jb),kD=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r,a,s,o;return we(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return n=l.sent(),n?(r=n.detection,this.input instanceof rt?[4,fp(this.input,[r])]:[3,3]):[2];case 2:return s=l.sent(),[3,5];case 3:return[4,hp(this.input,[r])];case 4:s=l.sent(),l.label=5;case 5:return a=s,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return o=l.sent(),a.forEach(function(c){return c instanceof rt&&c.dispose()}),[2,vp(n,o)]}})})},t.prototype.withFaceExpressions=function(){return new Ep(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ap(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Pp(this,this.input)},t}(Jb),Zb=function(e){Re(t,e);function t(n,r){r===void 0&&(r=new io);var a=e.call(this)||this;return a.input=n,a.options=r,a}return t}(Ii),CD=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r,a,s;return we(this,function(o){switch(o.label){case 0:return n=this,r=n.input,a=n.options,a instanceof Vb?[4,ft.mtcnn.forward(r,a)]:[3,2];case 1:return[2,o.sent().map(function(l){return l.detection})];case 2:if(s=a instanceof wp?function(l){return ft.tinyFaceDetector.locateFaces(l,a)}:a instanceof io?function(l){return ft.ssdMobilenetv1.locateFaces(l,a)}:a instanceof bp?function(l){return ft.tinyYolov2.locateFaces(l,a)}:null,!s)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,s(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return be(n,void 0,void 0,function(){var a;return we(this,function(s){switch(s.label){case 0:return[4,this.run()];case 1:return a=s.sent(),[2,r(a.map(function(o){return cp({},o)}))]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new jD(this.runAndExtendWithFaceDetections(),this.input,n)},t.prototype.withFaceExpressions=function(){return new kp(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Rp(this.runAndExtendWithFaceDetections(),this.input)},t}(Zb),SD=function(e){Re(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return be(this,void 0,void 0,function(){var n,r;return we(this,function(a){switch(a.label){case 0:return[4,new CD(this.input,this.options)];case 1:return n=a.sent(),r=n[0],n.forEach(function(s){s.score>r.score&&(r=s)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return be(n,void 0,void 0,function(){var a;return we(this,function(s){switch(s.label){case 0:return[4,this.run()];case 1:return a=s.sent(),[2,r(a?cp({},a):void 0)]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new kD(this.runAndExtendWithFaceDetection(),this.input,n)},t.prototype.withFaceExpressions=function(){return new Cp(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Dp(this.runAndExtendWithFaceDetection(),this.input)},t}(Zb);function wc(e,t){return t===void 0&&(t=new io),new SD(e,t)}function ED(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(a,s){return a-r[s]}).reduce(function(a,s){return a+Math.pow(s,2)},0))}(function(){function e(t,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,s=function(){return"person "+a++};this._labeledDescriptors=r.map(function(o){if(o instanceof al)return o;if(o instanceof Float32Array)return new al(s(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new al(s(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(t,n){return n.map(function(r){return ED(r,t)}).reduce(function(r,a){return r+a},0)/(n.length||1)},e.prototype.matchDescriptor=function(t){var n=this;return this.labeledDescriptors.map(function(r){var a=r.descriptors,s=r.label;return new ev(s,n.computeMeanDistance(t,a))}).reduce(function(r,a){return r.distance<a.distance?r:a})},e.prototype.findBestMatch=function(t){var n=this.matchDescriptor(t);return n.distance<this.distanceThreshold?n:new ev("unknown",n.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(r){return al.fromJSON(r)});return new e(n,t.distanceThreshold)},e})();const Bo=e=>e.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),RD=e=>{const t=e.time||e.timestamp||e.created_at||e.createdAt||e.date;if(!t)return e;let n;return/^\d{1,2}:\d{2}$/.test(t)?n=new Date(`2000-01-01T${t}`):n=new Date(t),isNaN(n.getTime())?e:{...e,time:Bo(n)}},DD=()=>i.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx("div",{className:"w-6 h-6 border-4 border-white border-t-transparent rounded-full animate-spin"}),i.jsx("span",{className:"text-white text-lg font-medium",children:"Loading..."})]}),kl=[],Tt=e=>{const t=document.createElement("div");t.innerText=`[${Bo(new Date)}] ${e}`,kl.unshift(t),kl.length>10&&kl.pop(),ID()},ID=()=>{const e=document.getElementById("attendance-notifications");e&&(e.innerHTML="",kl.forEach(t=>e.appendChild(t)))},ov=({registerCleanup:e})=>{Yn();const[t,n]=E.useState(!1),[r,a]=E.useState("ready"),[s,o]=E.useState(null),[l,c]=E.useState(null),[u,d]=E.useState(!1),[h,f]=E.useState(15),[p,m]=E.useState([]),[x,y]=E.useState(null),g=E.useRef(null),v=E.useRef(null),w=E.useRef(null);E.useEffect(()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("isAuthenticated");const C=async()=>{try{await ft.tinyFaceDetector.loadFromUri("/models"),await ft.ssdMobilenetv1.loadFromUri("/models"),await ft.faceLandmark68Net.loadFromUri("/models"),await ft.faceRecognitionNet.loadFromUri("/models"),await ft.faceExpressionNet.loadFromUri("/models"),d(!0);try{const j=await navigator.mediaDevices.getUserMedia({video:!0});w.current=j}catch(j){console.error("Failed to pre-acquire camera stream:",j)}}catch(j){console.error("Failed to load face-api models:",j),Tt("Failed to load face recognition models")}},k=async()=>{try{const S=(await Ne.getLiveActivity()).reverse().map(M=>RD(M));m(S)}catch(j){console.error("Failed to fetch live activity:",j)}};return C(),k(),e&&e(()=>{w.current&&(w.current.getTracks().forEach(j=>j.stop()),w.current=null)}),()=>{w.current&&(w.current.getTracks().forEach(j=>j.stop()),w.current=null)}},[]);const b=async()=>{if(w.current&&g.current)g.current.srcObject=w.current;else try{const C=await navigator.mediaDevices.getUserMedia({video:!0});g.current.srcObject=C,w.current=C}catch(C){console.error("Camera error:",C),a("Camera access denied")}},N=()=>{g.current&&(g.current.srcObject=null,g.current.pause(),g.current.load())},_=async()=>{if(!u){a("Models not loaded yet"),Tt("Models not loaded yet");return}n(!0),a("analyzing"),o(null),f(15),Tt("Starting face scan..."),await b();let C=!1,k=!1,j=!1,S=!1,M=null,D=null,A=null;A=setInterval(()=>{f(F=>{const U=Math.max(0,F-1);return U===0&&(clearInterval(A),k||(k=!0,clearInterval(D),n(!1),a("Face not recognized"),N(),setTimeout(()=>{a("ready")},2e3))),U})},1e3);const B=async()=>{if(!(C||k))try{Tt("Detecting face...");let F=await wc(g.current,new wp({inputSize:512,scoreThreshold:.1})).withFaceLandmarks().withFaceDescriptor().withFaceExpressions();if(F||(Tt("TinyFace detection failed, trying SSD Mobilenet..."),F=await wc(g.current,new io({minConfidence:.3})).withFaceLandmarks().withFaceDescriptor().withFaceExpressions()),F){Tt("Face detected, extracting features...");const U=Array.from(F.descriptor),V=F.expressions,P=Object.keys(V).reduce((I,q)=>V[I]>V[q]?I:q);Tt("Recognizing face...");const $=await Ne.recognizeFace(U,.4);if($.match&&!j&&!S){C=!0,k=!0,j=!0,S=!0,clearInterval(A),clearInterval(D),clearTimeout(M),n(!1),f(0),N(),o({...$,mood:P}),a("Face recognized"),Tt(`Recognized ${$.employee_name} (ID: ${$.employee_id}) - Mood: ${P}`);try{const I=await Ne.markAttendance($.employee_id);console.log("markAttendance response:",I);const q=new Date;c(q),Tt("Attendance marked successfully!"),o(le=>{var pe,_e;return{...le,department:(_e=(pe=I==null?void 0:I.attendance)==null?void 0:pe.employee)==null?void 0:_e.department}}),a("Attendance marked successfully!");let X="Check-In";I.message&&I.message.includes("Break start")?X="Break Start":I.message&&I.message.includes("Break end")?X="Break End":I.message&&I.message.includes("Check-out")?X="Check-Out":I.message&&I.message.includes("Check-in")&&(X="Check-In"),y(X);const ne=Bo(q),ie={name:$.employee_name,action:X,time:ne,employee_id:$.employee_id,mood:P};m(le=>[ie,...le.slice(0,9)]),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}catch(I){console.log("Attendance marking error response:",I.response);const q=I.response;if(q&&q.status===403&&q.data&&typeof q.data.message=="string"){const X=q.data.message.toLowerCase();if(X.includes("inactive employee")||X.includes("inactive employees")||X.includes("inactive")&&X.includes("not allowed"))c(new Date),a("Inactive employees cannot mark attendance"),Tt("Inactive employees cannot mark attendance"),setTimeout(()=>{a("ready"),o(null),c(null)},2e3);else if(I.message&&I.message.includes("already marked")){const ne=new Date;c(ne),a("Attendance marked successfully!"),Tt("Attendance already marked for today");const ie=Bo(ne),le={name:$.employee_name,action:"Already Checked-In",time:ie,employee_id:$.employee_id,mood:P};m(pe=>[le,...pe.slice(0,9)]),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}else console.error("Attendance marking error:",I),a("Face recognized but attendance marking failed"),Tt("Face recognized but attendance marking failed"),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}else if(I.message&&I.message.includes("already marked")){const X=new Date;c(X),a("Attendance marked successfully!"),Tt("Attendance already marked for today");const ne=Bo(X),ie={name:$.employee_name,action:"Already Checked-In",time:ne,employee_id:$.employee_id,mood:P};m(le=>[ie,...le.slice(0,9)]),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}else console.error("Attendance marking error:",I),a("Face recognized but attendance marking failed"),Tt("Face recognized but attendance marking failed"),setTimeout(()=>{a("ready"),o(null),c(null)},2e3)}finally{S=!1}}else $.match||Tt("Face detected but not recognized, trying again...")}else Tt("No face detected, trying again...")}catch(F){console.error("Recognition error:",F),Tt("Recognition attempt failed: "+F.message)}};D=setInterval(B,2e3),await B(),M=setTimeout(()=>{k||(k=!0,clearInterval(A),clearInterval(D),n(!1),a("Face not recognized"),N(),setTimeout(()=>{a("ready")},2e3))},15e3)};return i.jsxs("div",{className:"min-h-screen w-full overflow-x-hidden bg-gradient-to-br from-slate-900 to-slate-800 flex flex-col",children:[i.jsx("style",{children:`
          .custom-scrollbar::-webkit-scrollbar {
            width: 2px;
          }
          .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 1px;
          }
          .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent.
          }
          .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.25);
          }
        `}),i.jsx(M0,{}),i.jsxs("main",{className:"flex-1 flex flex-col lg:flex-row gap-4 md:gap-6 p-4 md:p-8 max-w-7xl mx-auto w-full overflow-x-hidden",children:[i.jsxs("div",{className:"flex-1 flex flex-col",children:[i.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border-2 border-white/20 overflow-hidden flex-1 flex flex-col",children:[i.jsxs("div",{className:"bg-slate-800 relative flex flex-col flex-1 pt-3 pb-5",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-500/20"}),i.jsxs("div",{className:"flex justify-between p-4 z-20",children:[i.jsx("div",{className:`px-4 py-2 rounded-full text-sm font-medium text-white ${r==="success"||r.includes("successfully")?"bg-green-600":r==="Face not recognized"||r==="No face detected"||r.includes("failed")?"bg-red-600":"bg-black/50"}`,children:r==="ready"?"Ready":r}),i.jsx("div",{className:"bg-red-500 w-3 h-3 rounded-full animate-pulse"})]}),i.jsx("div",{className:"flex-1 relative z-10 text-center px-4 flex items-center justify-center",children:u?r==="Attendance marked successfully!"&&s&&l?i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:[i.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[i.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",children:i.jsx(Lt,{className:"w-12 h-12 text-green-500"})}),i.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:i.jsx("span",{className:"text-2xl font-bold text-white",children:s.employee_name.split(" ").map(C=>C[0]).join("")})}),i.jsxs("div",{className:"text-center space-y-1",children:[i.jsx("h2",{className:"text-white text-xl font-semibold",children:s.employee_name}),i.jsxs("p",{className:"text-gray-300 text-sm",children:["ID: ",s.employee_id]}),(s==null?void 0:s.department)&&i.jsx("p",{className:"text-gray-400 text-xs",children:s.department})]})]}),i.jsxs("button",{className:"px-6 py-3 bg-green-500 hover:bg-green-600 transition-colors text-white font-semibold rounded-full text-sm",children:[x||"Check-In"," Successful"]})]}):r==="Face not recognized"?i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:[i.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[i.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",children:i.jsx(ao,{className:"w-14 h-14 text-red-500"})}),i.jsxs("div",{className:"text-center space-y-1",children:[i.jsx("h2",{className:"text-white text-xl font-semibold",children:"Face Not Recognized"}),i.jsx("p",{className:"text-gray-300 text-sm",children:"Please try again or contact support"})]})]}),i.jsx("button",{className:"px-6 py-3 bg-red-500 hover:bg-red-600 transition-colors text-white font-semibold rounded-full text-sm",children:"Try Again"})]}):r==="Inactive employees cannot mark attendance"?i.jsx("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2",children:i.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[i.jsx("div",{className:"w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center",children:i.jsx(vt,{className:"w-8 h-8 text-white"})}),i.jsxs("div",{className:"text-center space-y-1",children:[i.jsx("h2",{className:"text-white text-xl font-semibold",children:"Attendance Denied"}),i.jsx("p",{className:"text-gray-300 text-sm",children:"Inactive employees are not allowed to mark attendance."})]})]})}):t?i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 mb-2 w-full",children:[i.jsx("div",{className:"w-full flex justify-center px-2",children:i.jsxs("div",{className:`\r
                          relative\r
                          w-full\r
                          max-w-xs\r
                          sm:max-w-sm\r
                          md:max-w-md\r
                          h-64\r
                          md:h-72\r
                          lg:h-80\r
                          rounded-xl\r
                          border-4 border-blue-400/40\r
                          overflow-hidden\r
                          bg-black\r
                          mx-auto\r
                        `,children:[i.jsx("video",{ref:g,autoPlay:!0,muted:!0,playsInline:!0,className:`\r
                            absolute\r
                            inset-0\r
                            w-full\r
                            h-full\r
                            object-cover\r
                          `}),i.jsx("canvas",{ref:v,className:`\r
                            absolute\r
                            inset-0\r
                            w-full\r
                            h-full\r
                            pointer-events-none\r
                          `})]})}),i.jsx("div",{className:"flex flex-col items-center space-y-1 mt-4",children:i.jsxs("div",{className:"text-center px-4",children:[i.jsxs("p",{className:"text-lg text-white font-medium",children:["Analyzing face... (",h,"s)"]}),i.jsx("p",{className:"text-sm text-gray-400",children:"Please keep your face in the frame"})]})}),s&&i.jsxs("div",{className:"p-4 rounded-lg border border-green-500/30 max-w-sm w-full",children:[i.jsxs("div",{className:"flex items-center gap-2 text-green-400 mb-2",children:[i.jsx(Lt,{className:"w-5 h-5"}),i.jsx("span",{className:"font-medium",children:"Recognized!"})]}),i.jsx("p",{className:"text-white font-medium",children:s.employee_name}),i.jsxs("p",{className:"text-gray-300 text-sm",children:["Employee ID: ",s.employee_id]}),i.jsxs("p",{className:"text-gray-300 text-sm",children:["Mood: ",s.mood]})]})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 mb-4",children:[i.jsx(ks,{className:"w-16 h-16 text-white/70"}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-lg text-white font-medium mb-1",children:"Position your face in the frame"}),i.jsx("p",{className:"text-sm text-gray-400",children:"Camera is active and scanning"})]})]}):i.jsx(DD,{})})]}),i.jsx("div",{className:"p-4 md:p-6 text-center",children:i.jsx("button",{onClick:_,className:`bg-blue-600 hover:bg-blue-700 text-white px-6 md:px-8 py-2 md:py-3 rounded-lg font-semibold transition-colors text-sm md:text-base ${u?"":"opacity-50 cursor-not-allowed"}`,disabled:!u,children:"Simulate Face Recognition"})})]}),i.jsx("div",{className:"w-full lg:w-96 flex flex-col gap-4 md:gap-6"})]}),i.jsxs("div",{className:"w-full lg:w-96 flex flex-col gap-4 md:gap-6",children:[i.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border border-white/20 p-6",children:[i.jsxs("h2",{className:"text-white text-lg font-semibold mb-4 flex items-center gap-2",children:[i.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Recent Activity"]}),i.jsxs("div",{className:"space-y-3 h-60 overflow-y-auto scrollbar-w-1 scrollbar-thumb-white/20 scrollbar-track-transparent",children:[p.map((C,k)=>i.jsxs("div",{className:"bg-white/5 rounded-lg p-3 flex items-center gap-3 hover:bg-white/10 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:C.name.split(" ").map(j=>j[0]).join("")}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-white text-sm font-medium truncate",children:C.name}),i.jsx("p",{className:"text-slate-400 text-xs",children:C.action})]}),i.jsx("div",{className:"text-slate-300 text-xs",children:C.time})]},k)),p.length===0&&i.jsx("div",{className:"text-center text-gray-400 text-sm py-8",children:"No recent activities yet"})]})]}),i.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border border-white/20 p-6",children:[i.jsx("h3",{className:"text-white text-lg font-semibold mb-4",children:"Instructions"}),i.jsxs("ul",{className:"space-y-3 text-slate-300 text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-400 font-bold",children:"1."})," Stand 2-3 feet away from the screen"]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-400 font-bold",children:"2."})," Look directly at the camera"]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-400 font-bold",children:"3."})," Wait for automatic recognition"]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-blue-400 font-bold",children:"4."})," Confirmation will appear on screen"]})]})]})]})]}),i.jsx(O0,{})]})},rd=e=>{if(!e)return"N/A";const t=new Date(e);if(!isNaN(t.getTime()))return t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});const n=e.split(":");if(n.length<2)return e;const r=parseInt(n[0],10),a=parseInt(n[1],10);if(isNaN(r)||isNaN(a))return e;const s=r>=12?"PM":"AM",o=r%12===0?12:r%12,l=String(o).padStart(2,"0"),c=String(a).padStart(2,"0");return`${l}:${c} ${s}`},iv=e=>{if(e==null)return"N/A";const t=Math.abs(Number(e));if(Number.isNaN(t))return"N/A";const n=Math.floor(t/60),r=t%60,a=[];return n>0&&a.push(`${n} hr${n>1?"s":""}`),r>0&&a.push(`${r} min${r>1?"s":""}`),a.length===0?"0 mins":a.join(" ")},e1=e=>{if(!e||typeof e!="object")return null;for(const[t,n]of Object.entries(e)){const r=t.toLowerCase();if(typeof n=="string"&&n.trim()!==""&&(r.includes("email")||r.includes("mail")))return n;if(n&&typeof n=="object"){const a=e1(n);if(a)return a}}return null},AD=e=>{var r,a,s,o,l,c,u,d;const t=e.email||e.mail||e.employee_email||e.employee_mail||e.work_email||e.work_mail||e.office_email||e.office_mail||((r=e.employee)==null?void 0:r.email)||((a=e.employee)==null?void 0:a.mail)||((s=e.employee)==null?void 0:s.work_email)||((o=e.employee)==null?void 0:o.work_mail)||((l=e.employee)==null?void 0:l.official_email)||((c=e.employee)==null?void 0:c.official_mail)||((u=e.user)==null?void 0:u.email)||((d=e.user)==null?void 0:d.mail);return t&&t.trim()!==""?t:e1(e)||"N/A"},TD=({isOpen:e,onClose:t,statType:n,statValue:r})=>{const[a,s]=E.useState([]),[o,l]=E.useState(!1),[c,u]=E.useState(null);E.useEffect(()=>{e&&n&&d()},[e,n]);const d=async()=>{l(!0),u(null);try{let p;switch(n){case"total_employees":p=await Ne.getEmployees();break;case"present_today":p=await Ne.getPresentToday();break;case"absent_today":p=await Ne.getAbsentToday();break;case"on_leave":p=await Ne.getOnLeaveToday();break;case"late_arrivals":p=await Ne.getLateArrivalsToday();break;case"early_departures":p=await Ne.getEarlyDeparturesToday();break;default:p=[]}s(p)}catch(p){u(p.message||"Failed to load data")}finally{l(!1)}},h=()=>{switch(n){case"total_employees":return"All Employees";case"present_today":return"Employees Present Today";case"absent_today":return"Employees Absent Today";case"on_leave":return"Employees On Leave";case"late_arrivals":return"Late Arrivals Today";case"early_departures":return"Early Departures Today";default:return"Details"}},f=p=>p?p.split(" ").filter(Boolean).map(m=>m[0]).join("").toUpperCase():"N/A";return e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 md:p-6 flex items-center justify-between z-10 rounded-t-2xl",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:h()}),i.jsxs("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:[r," records"]})]}),i.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Mn,{className:"w-6 h-6"})})]}),i.jsxs("div",{className:"flex-1 p-4 md:p-6 overflow-y-auto",children:[o&&i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),i.jsx("p",{className:"text-gray-600",children:"Loading..."})]}),c&&i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-red-600",children:c})}),!o&&!c&&a.length===0&&i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-gray-500",children:"No data available"})}),!o&&!c&&a.length>0&&i.jsx("div",{className:"space-y-3",children:a.map((p,m)=>{var B,F,U,V,P,$,I,q;const x=p.name||((B=p.employee)==null?void 0:B.name)||`Employee ${p.employee_id||p.id}`,y=p.department||((F=p.employee)==null?void 0:F.department)||"N/A",g=AD(p),v=p.phone||((U=p.employee)==null?void 0:U.phone)||((V=p.user)==null?void 0:V.phone)||"N/A",w=p.check_in_time||((P=p.employee)==null?void 0:P.check_in_time),b=p.check_out_time||(($=p.employee)==null?void 0:$.check_out_time),N=p.early_minutes??((I=p.employee)==null?void 0:I.early_minutes)??null,_=p.late_minutes??((q=p.employee)==null?void 0:q.late_minutes)??null,C=p.leave_type||p.leave_reason||p.type||"On Leave",k=p.leave_days||p.duration_days||p.days||null,j=p.reason||p.absence_reason||"No show",M=(p.employment_status||p.status||"").toLowerCase();let D="Active",A="bg-green-100 text-green-700";return M.includes("leave")?(D="On Leave",A="bg-blue-100 text-blue-700"):M.includes("inactive")||M.includes("not_active")||M.includes("terminated")?(D="Not Active",A="bg-gray-200 text-gray-700"):M===""&&(D="Active",A="bg-green-100 text-green-700"),n==="present_today"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Wn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:v})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(He,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Check-in: ",rd(w)]})]})]})]})})},m):n==="early_departures"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Wn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(He,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Check-out: ",rd(b)]})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-purple-600",children:[i.jsx(vt,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Early by:"," ",iv(N)]})]})]})]})})},m):n==="on_leave"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Wn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-blue-600",children:[i.jsx(T_,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:[C,k!=null?` (${k} day${k===1?"":"s"})`:""]})]})]})]})})},m):n==="late_arrivals"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Wn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(He,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Check-in: ",rd(w)]})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-600",children:[i.jsx(vt,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Late by:"," ",iv(_)]})]})]})]})})},m):n==="absent_today"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Wn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:v})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600",children:[i.jsx(vt,{className:"w-[14px] h-[14px]"}),i.jsxs("span",{children:["Reason: ",j]})]})]})]})})},m):n==="total_employees"?i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Wn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:v})]}),i.jsx("div",{className:"flex items-center gap-2 text-xs",children:i.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${A}`,children:D})})]})]})})},m):i.jsx("div",{className:"bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors",children:i.jsx("div",{className:"flex items-start justify-between gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:f(x)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:x}),i.jsx("p",{className:"text-sm text-gray-600",children:y})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Wn,{className:"w-[14px] h-[14px]"}),i.jsx("span",{className:"truncate",children:g})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-[14px] h-[14px]"}),i.jsx("span",{children:v})]})]})]})})},m)})})]}),i.jsxs("div",{className:"bg-gray-50 border-t border-gray-200 p-4 md:p-6 flex justify-end gap-3 rounded-b-2xl",children:[i.jsx("button",{onClick:()=>window.location.href="/employees",className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-100 transition-colors",children:"Manage Employees"}),i.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Close"})]})]})}):null},PD=()=>{const e=Yn(),[t,n]=E.useState(!0),[r,a]=E.useState(null),[s,o]=E.useState({total_employees:0,present_today:0,absent_today:0,on_leave:0,late_arrivals:0,early_departures:0,changes:{present:0,absent:0,on_leave:0,late_arrivals:0,early_departures:0}}),[l,c]=E.useState([]),[u,d]=E.useState({average_check_in:"00:00",average_work_hours:0,punctuality_rate:0}),[h,f]=E.useState([]),[p,m]=E.useState(0),[x,y]=E.useState({isOpen:!1,statType:null,statValue:0});E.useEffect(()=>{const j=async()=>{n(!0),a(null);try{const M=await Ne.getDashboardData();o(M.stats),c(M.departments),d(M.trends),f(M.live_activity)}catch(M){console.error("Error fetching dashboard data:",M),a(M.message||"Failed to load dashboard data")}finally{n(!1)}};j();const S=setInterval(()=>{j()},6e4);return()=>clearInterval(S)},[p]);const[g,v]=E.useState(new Date);E.useEffect(()=>{const j=setInterval(()=>{v(new Date)},1e3);return()=>clearInterval(j)},[]);const w=()=>g.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),b=()=>g.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),N=j=>{if(!j)return"";try{return new Date(`2000-01-01T${j}`).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return j}},_=j=>j==="Check-In"?"bg-green-100 text-green-700":j==="Re-Check-In"?"bg-blue-100 text-blue-700":j==="Check-Out"?"bg-gray-100 text-gray-700":j==="Early Departure"?"bg-orange-100 text-orange-700":j==="Break Start"?"bg-yellow-100 text-yellow-700":j==="Break End"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700",C=(j,S)=>{y({isOpen:!0,statType:j,statValue:S})},k=()=>{y({isOpen:!1,statType:null,statValue:0})};return i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Real-time attendance monitoring"})]}),i.jsxs("div",{className:"text-left md:text-right",children:[i.jsx("div",{className:"text-xl md:text-2xl font-bold text-gray-900",children:w()}),i.jsx("div",{className:"text-xs md:text-sm text-gray-600",children:b()})]})]}),r&&i.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[i.jsx("p",{className:"text-red-600",children:r}),i.jsx("button",{onClick:()=>m(j=>j+1),className:"mt-2 text-sm text-red-600 hover:text-red-700",children:"Try again"})]}),t&&i.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),i.jsx("p",{className:"text-gray-600",children:"Loading dashboard data..."})]})}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:[i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>C("total_employees",s.total_employees),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Employees"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.total_employees}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current Count"})})]}),i.jsx("div",{className:"bg-blue-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(ci,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>C("present_today",s.present_today),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Present Today"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.present_today}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:`text-xs font-medium ${s.changes.present>=0?"text-green-600":"text-red-600"}`,children:[s.changes.present>0?"+":"",s.changes.present," from yesterday"]})})]}),i.jsx("div",{className:"bg-green-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-user-check text-white",children:[i.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),i.jsx("circle",{cx:"9",cy:"7",r:"4"}),i.jsx("polyline",{points:"16 11 18 13 22 9"})]})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>C("absent_today",s.absent_today),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Absent"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.absent_today}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:`text-xs font-medium ${s.changes.absent<=0?"text-green-600":"text-red-600"}`,children:[s.changes.absent>0?"+":"",s.changes.absent," from yesterday"]})})]}),i.jsx("div",{className:"bg-red-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-user-x text-white",children:[i.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),i.jsx("circle",{cx:"9",cy:"7",r:"4"}),i.jsx("line",{x1:"17",x2:"22",y1:"8",y2:"13"}),i.jsx("line",{x1:"22",x2:"17",y1:"8",y2:"13"})]})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>C("on_leave",s.on_leave),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"On Leave"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.on_leave}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:`text-xs font-medium ${s.changes.on_leave>=0?"text-green-600":"text-red-600"}`,children:[s.changes.on_leave>0?"+":"",s.changes.on_leave," from yesterday"]})})]}),i.jsx("div",{className:"bg-yellow-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx("div",{className:"bg-yellow-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-activity text-white",children:i.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>C("late_arrivals",s.late_arrivals),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Late Arrivals"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.late_arrivals}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:`text-xs font-medium ${s.changes.late_arrivals>=0?"text-green-600":"text-red-600"}`,children:[s.changes.late_arrivals>0?"+":"",s.changes.late_arrivals," from yesterday"]})})]}),i.jsx("div",{className:"bg-orange-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(He,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 hover:shadow-md hover:border-blue-300 transition-all cursor-pointer",onClick:()=>C("early_departures",s.early_departures),children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Early Departures"}),i.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:s.early_departures}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsxs("span",{className:`text-xs font-medium ${s.changes.early_departures<=0?"text-green-600":"text-red-600"}`,children:[s.changes.early_departures>0?"+":"",s.changes.early_departures," from yesterday"]})})]}),i.jsx("div",{className:"bg-purple-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(vt,{className:"w-6 h-6 text-white"})})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:[i.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),"Live Activity Feed"]}),i.jsx("button",{onClick:()=>e("/reports"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),i.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:h.map((j,S)=>i.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:j.name.split(" ").map(M=>M[0]).join("").toUpperCase()}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:j.name}),i.jsxs("p",{className:"text-xs text-gray-500",children:[N(j.time)," "]})]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${_(j.action)}`,children:j.action})]},S))})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Department Attendance"}),i.jsx("div",{className:"space-y-4",children:l.map((j,S)=>i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700",children:j.department}),i.jsxs("span",{className:"text-sm text-gray-600",children:[j.present,"/",j.total]})]}),i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:i.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all",style:{width:`${j.percentage}%`}})}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[j.percentage,"% present"]})]},S))})]})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Attendance Trends"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Average Check-in Time"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.average_check_in&&u.average_check_in!=="00:00:00"?new Date(`2000-01-01T${u.average_check_in}`).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"No Data"})]}),i.jsx(ah,{className:"w-8 h-8 text-green-500"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Average Work Hours"}),i.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[typeof u.average_work_hours=="number"&&!isNaN(u.average_work_hours)?u.average_work_hours.toFixed(1):"0.0"," hrs"]})]}),i.jsx(He,{className:"w-8 h-8 text-blue-500"})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Punctuality Rate"}),i.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[u.punctuality_rate,"%"]})]}),i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-activity text-purple-500",children:i.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Quick Actions"}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("button",{onClick:()=>e("/employees"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left",children:[i.jsx(ci,{className:"w-6 h-6 text-blue-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Manage Employees"})]}),i.jsxs("button",{onClick:()=>e("/reports"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-left",children:[i.jsx(ah,{className:"w-6 h-6 text-green-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"View Reports"})]}),i.jsxs("button",{onClick:()=>e("/policies"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-colors text-left",children:[i.jsx(He,{className:"w-6 h-6 text-purple-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Manage Policies"})]}),i.jsxs("button",{onClick:()=>C("late_arrivals",s.late_arrivals),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-colors text-left",children:[i.jsx(vt,{className:"w-6 h-6 text-orange-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"View Alerts"})]})]})]})]}),x.isOpen&&i.jsx(TD,{isOpen:x.isOpen,onClose:k,statType:x.statType,statValue:x.statValue})]})})};function FD(){const e=Yn(),t=new Date,[n,r]=E.useState(null),[a,s]=E.useState(t.getFullYear()),[o,l]=E.useState(t.getMonth()),[c,u]=E.useState([]),[d,h]=E.useState(1),f=5,[p,m]=E.useState(!1),[x,y]=E.useState(null),[g,v]=E.useState({}),[w,b]=E.useState("monthly"),[N,_]=E.useState(""),[C,k]=E.useState(""),[j,S]=E.useState(!1),[M,D]=E.useState(null),[A,B]=E.useState(!1),[F,U]=E.useState(!1),[V,P]=E.useState(""),[$,I]=E.useState([]),[q,X]=E.useState([]),ne=()=>{o===0?(l(11),s(a-1)):l(o-1)},ie=()=>{o===11?(l(0),s(a+1)):l(o+1)},le=new Date(a,o,1),pe=le.toLocaleDateString("en-US",{month:"long",year:"numeric"}),_e=new Date(a,o+1,0).getDate(),G=new Date(a,o,1).getDay(),re=ee=>{const me=ee.getFullYear(),ke=String(ee.getMonth()+1).padStart(2,"0"),Me=String(ee.getDate()).padStart(2,"0");return`${me}-${ke}-${Me}`},Ce=(ee,me,ke)=>`${ee}-${String(me+1).padStart(2,"0")}-${String(ke).padStart(2,"0")}`;function H(ee){switch(ee){case"Present":return"bg-green-500 text-white";case"Late Arrival":return"bg-purple-500 text-white";case"Absent":return"bg-red-500 text-white";case"Holiday":return"bg-blue-500 text-white";case"On Leave":return"bg-orange-500 text-white";case"Early Departure":return"bg-pink-500 text-white";case"Half Day":return"bg-yellow-500 text-white";default:return""}}const O=async()=>{var ee;try{const me=await Ne.getEmployees();u(me||[]);const ke=[...new Set((me||[]).map(Me=>Me.department).filter(Boolean))];I(ke),X(me||[]),me&&me.length>0&&!n&&r(me[0].employee_id)}catch(me){((ee=me==null?void 0:me.response)==null?void 0:ee.status)===401&&e("/login"),y("Failed to fetch employees")}},Q=async()=>{var ee;if(n){m(!0),y(null);try{const me=le.getFullYear(),ke=le.getMonth()+1,Me=await Ne.getEmployeeMonthlyAttendance(n,me,ke),Ye={};(Me||[]).forEach($e=>{const St=$e.date;Ye[St]={status:$e.status,checkIn:$e.check_in?new Date($e.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",checkOut:$e.check_out?new Date($e.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",totalHours:$e.total_hours||"-",breaks:$e.breaks||[],holiday:$e.holiday||null,leaveReason:$e.leave_reason||null}}),v(Ye)}catch(me){console.error(me),((ee=me==null?void 0:me.response)==null?void 0:ee.status)===401&&e("/login"),y("Failed to fetch attendance records")}finally{m(!1)}}};E.useEffect(()=>{O()},[]),E.useEffect(()=>{Q()},[n,a,o]),E.useEffect(()=>{const ee=setInterval(()=>{n&&Q()},3e4);return()=>clearInterval(ee)},[n,a,o]),E.useEffect(()=>{const ee=M?c.filter(me=>me.department===M):c;X(ee),n&&!ee.some(me=>me.employee_id===n)&&r(ee.length>0?ee[0].employee_id:null)},[M,c]);const oe=()=>{B(!1)},ue=()=>{D(null),B(!1)},ae=(()=>{const ee=[],me=le.getFullYear(),ke=le.getMonth();re(new Date);for(let Me=0;Me<G;Me++)ee.push(null);for(let Me=1;Me<=_e;Me++){const Ye=Ce(me,ke,Me),$e=new Date(me,ke,Me),St=re($e);let Zn=g[Ye];if(!Zn){const ja=new Date(t);ja.setDate(ja.getDate()-1);const rs=re(ja),yr=$e.getDay();St<=rs&&n&&yr!==0&&yr!==6&&(Zn={status:"Absent",checkIn:"-",checkOut:"-",totalHours:"-",holiday:null})}ee.push({day:Me,key:Ye,rec:Zn,date:$e})}return ee})(),je=ae.filter(Boolean).filter(ee=>ee.rec).map(ee=>({date:ee.key,...ee.rec})).sort((ee,me)=>ee.date<me.date?1:-1),de=p?Array(f).fill({skeleton:!0}):je.slice((d-1)*f,d*f),Le=Math.max(1,Math.ceil(je.length/f)),qe=async()=>{var ee;if(n){if(w==="custom"&&(!N||!C)){y("Please select both start and end dates for custom range");return}if(w==="custom"&&new Date(N)>new Date(C)){y("Start date cannot be after end date");return}try{let me,ke;const Me=le.getFullYear(),Ye=le.getMonth()+1;if(w==="daily"){const Zn=new Date().toISOString().split("T")[0];me=await Ne.exportEmployeeDailyAttendance(n,Zn),ke=`attendance-daily-${n}-${Zn}.csv`}else w==="monthly"?(me=await Ne.exportEmployeeMonthlyAttendance(n,Me,Ye),ke=`attendance-monthly-${n}-${Me}-${Ye}.csv`):w==="custom"&&(me=await Ne.exportEmployeeCustomRangeAttendance(n,N,C),ke=`attendance-custom-${n}-${N}-to-${C}.csv`);const $e=window.URL.createObjectURL(me),St=document.createElement("a");St.href=$e,St.download=ke,document.body.appendChild(St),St.click(),window.URL.revokeObjectURL($e),document.body.removeChild(St),S(!1)}catch(me){((ee=me==null?void 0:me.response)==null?void 0:ee.status)===401&&e("/login"),y("Failed to download attendance records")}}},Oe=async()=>{var ee;if(!n||!V){y("Please select an employee and enter an email address");return}if(w==="custom"&&(!N||!C)){y("Please select both start and end dates for custom range");return}if(w==="custom"&&new Date(N)>new Date(C)){y("Start date cannot be after end date");return}try{const me=le.getFullYear(),ke=le.getMonth()+1;await Ne.emailEmployeeAttendanceReport(n,V,w,me,ke,N,C),U(!1),P(""),y(null)}catch(me){((ee=me==null?void 0:me.response)==null?void 0:ee.status)===401&&e("/login"),y("Failed to send email report")}};return i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"p-3 space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Attendance Calendar"}),i.jsx("p",{className:"text-md text-gray-500",children:"View attendance records"})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("button",{onClick:()=>B(!0),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors flex items-center gap-2",children:[i.jsx(Rf,{className:"w-5 h-5"}),"Filter"]}),i.jsxs("button",{onClick:()=>U(!0),disabled:p||!n,className:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md shadow hover:bg-green-700 disabled:opacity-60 disabled:cursor-not-allowed",children:[i.jsx(Wn,{className:"w-4 h-4"}),"Email Report"]}),i.jsxs("button",{onClick:()=>S(!0),disabled:p||!n,className:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md shadow hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",children:[i.jsx(si,{className:"w-4 h-4"}),"Export"]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[i.jsxs("div",{className:"flex-1 max-w-xs",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee"}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",value:n||"",onChange:ee=>r(ee.target.value),disabled:p,children:q.map(ee=>i.jsx("option",{value:ee.employee_id,children:ee.name},ee.employee_id))}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:ne,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(T0,{className:"w-5 h-5"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:pe}),i.jsx("button",{onClick:ie,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Ef,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"flex-1"})]}),x&&i.jsx("div",{className:"text-rose-500 text-sm",children:x}),i.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2 mb-2",children:[i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sun"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Mon"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Tue"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Wed"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Thu"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Fri"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sat"})]}),i.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2",children:[ae.slice(0,G).map((ee,me)=>i.jsx("div",{className:"aspect-square"},`lead-${me}`)),ae.slice(G).map((ee,me)=>{var $e,St;const ke=($e=ee.rec)==null?void 0:$e.status,Me=H(ke),Ye=new Date(ee.key).getDay()===0||new Date(ee.key).getDay()===6;return i.jsx("div",{className:`aspect-square border-2 rounded-lg p-2 cursor-pointer transition-all hover:shadow-md ${ke?Me:Ye?"bg-gray-100 border-gray-200":"bg-white border-gray-200"}`,children:i.jsxs("div",{className:"h-full flex flex-col",children:[i.jsx("span",{className:`text-sm font-semibold mb-1 ${ke?"text-white":"text-gray-700"}`,children:ee.day}),i.jsx("div",{className:"flex-1 flex flex-col justify-center text-xs",children:ee.rec?i.jsx(i.Fragment,{children:ke==="Holiday"?i.jsx("span",{className:`font-medium ${ke?"text-white":"text-gray-700"}`,children:((St=ee.rec.holiday)==null?void 0:St.name)||"Holiday"}):ke==="On Leave"?i.jsx("span",{className:`font-medium ${ke?"text-white":"text-gray-700"}`,children:ee.rec.leaveReason||"On Leave"}):ke==="Present"||ke==="Late Arrival"||ke==="Early Departure"||ke==="Half Day"?i.jsxs(i.Fragment,{children:[i.jsxs("span",{className:`${ke?"text-white":"text-gray-700"}`,children:["In: ",ee.rec.checkIn]}),i.jsxs("span",{className:`${ke?"text-white":"text-gray-700"}`,children:["Out: ",ee.rec.checkOut]})]}):i.jsx("span",{children:""})}):i.jsx("span",{children:""})})]})},`${ee.key}-${me}`)})]}),i.jsxs("div",{className:"mt-4 md:mt-6 pt-4 md:pt-6 border-t border-gray-200 grid grid-cols-2 sm:flex sm:flex-wrap gap-3 md:gap-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Present"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Half Day"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Absent"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Holiday"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"On Leave"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Late Arrival"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-pink-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Early Departure"})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2",children:[i.jsx(Ke,{className:"w-5 h-5"})," Detailed Attendance Logs"]}),i.jsx("div",{className:"space-y-4",children:de.map((ee,me)=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors",children:[i.jsx("div",{className:"flex items-start justify-between mb-3",children:ee.skeleton?i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})]}),i.jsx("div",{className:"h-4 w-40 bg-gray-200 rounded animate-pulse mt-2"})]}),i.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(ke=>i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded animate-pulse mt-1"}),i.jsxs("div",{children:[i.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse mt-1"})]})]},ke))})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-lg font-semibold text-gray-900",children:new Date(ee.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})}),i.jsx("p",{className:"text-sm text-gray-600",children:(()=>{const ke=c.find(Ye=>Ye.employee_id===n),Me=ke==null?void 0:ke.policy;return Me?`${Me.name} (${Me.status==="active"?"Active":"Inactive"})`:"No Policy"})()})]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${ee.status==="Present"?"bg-green-100 text-green-700":ee.status==="Absent"?"bg-red-100 text-red-800":ee.status==="Late Arrival"?"bg-purple-100 text-purple-800":ee.status==="Early Departure"?"bg-pink-100 text-pink-800":ee.status==="Holiday"?"bg-blue-100 text-blue-800":ee.status==="On Leave"?"bg-orange-100 text-orange-800":ee.status==="Half Day"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:ee.status})]})}),!ee.skeleton&&i.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(He,{className:"w-5 h-5 text-green-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Check-In"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:ee.checkIn})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ks,{className:"w-5 h-5 text-red-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Check-Out"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:ee.checkOut})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(He,{className:"w-5 h-5 text-blue-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Total Duration"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:ee.totalHours})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ke,{className:"w-5 h-5 text-purple-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Re-entries"}),i.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[Array.isArray(ee.breaks)?ee.breaks.length:ee.breaks||0," times"]})]})]})]}),ee.breaks&&ee.breaks.length>0&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Break Details:"}),ee.breaks.map((ke,Me)=>i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsxs("span",{className:"text-gray-700",children:["Start: ",ke.break_start?new Date(ke.break_start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]}),i.jsxs("span",{className:"text-gray-700",children:["End: ",ke.break_end?new Date(ke.break_end).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]})]},Me))]})})]},ee.skeleton?me:ee.date))}),i.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 pt-4 border-t border-gray-200 gap-4",children:[i.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",de.length," of ",je.length," records"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>h(ee=>Math.max(1,ee-1)),disabled:d===1,className:`px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ${d===1?"opacity-50 cursor-not-allowed":""}`,children:"Previous"}),i.jsx("button",{className:"px-4 py-2 rounded-lg text-sm font-medium bg-blue-600 text-white",children:d}),i.jsx("button",{onClick:()=>h(ee=>Math.min(Le,ee+1)),disabled:d===Le,className:`px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ${d===Le?"opacity-50 cursor-not-allowed":""}`,children:"Next"})]})]})]}),j&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Export Attendance Report"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),i.jsxs("div",{className:"relative",children:[i.jsxs("select",{value:w,onChange:ee=>b(ee.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",children:[i.jsx("option",{value:"daily",children:"Daily (CSV)"}),i.jsx("option",{value:"monthly",children:"Monthly (CSV)"}),i.jsx("option",{value:"custom",children:"Custom range (CSV)"})]}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),w==="custom"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),i.jsx("input",{type:"date",value:N,onChange:ee=>_(ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),i.jsx("input",{type:"date",value:C,onChange:ee=>k(ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[i.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{onClick:qe,disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed",children:p?"Downloading...":"Download"})]})]})}),A&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filter Employees"}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),i.jsxs("div",{className:"relative",children:[i.jsxs("select",{value:M||"",onChange:ee=>D(ee.target.value||null),className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none cursor-pointer hover:border-gray-400 transition-colors",children:[i.jsx("option",{value:"",children:"All Departments"}),$.map(ee=>i.jsx("option",{value:ee,children:ee},ee))]}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),i.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[i.jsx("button",{onClick:ue,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Reset"}),i.jsx("button",{onClick:oe,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Apply"})]})]})}),F&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Attendance Report"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),i.jsx("input",{type:"email",value:V,onChange:ee=>P(ee.target.value),placeholder:"Enter email address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Report Type"}),i.jsxs("select",{value:w,onChange:ee=>b(ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[i.jsx("option",{value:"daily",children:"Daily"}),i.jsx("option",{value:"monthly",children:"Monthly"}),i.jsx("option",{value:"custom",children:"Custom range"})]})]}),w==="custom"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),i.jsx("input",{type:"date",value:N,onChange:ee=>_(ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),i.jsx("input",{type:"date",value:C,onChange:ee=>k(ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]})]}),i.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[i.jsx("button",{onClick:()=>{U(!1),P("")},className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{onClick:Oe,disabled:p,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-60 disabled:cursor-not-allowed",children:p?"Sending...":"Send Email"})]})]})})]})})}const MD=()=>{const[e,t]=E.useState(""),[n,r]=E.useState(""),[a,s]=E.useState(!1),[o,l]=E.useState(""),[c,u]=E.useState(!1),d=Yn();E.useEffect(()=>{localStorage.getItem("authToken")&&d("/dashboard")},[d]);const h=async f=>{f.preventDefault(),l(""),u(!0);try{const p=await Ne.login({email:e,password:n});d("/dashboard")}catch(p){if(console.error("Login failed:",p),p.errors){const m=Object.values(p.errors).flat();l(m.join(" "))}else l(p.message||"Invalid username or password. Please try again.")}finally{u(!1)}};return i.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4 overflow-y-auto",children:[i.jsx("div",{className:"absolute top-4 left-4",children:i.jsx("button",{onClick:()=>d("/"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 font-medium transition-colors",children:" Back to Kiosk"})}),i.jsxs("div",{className:"max-w-md w-full",children:[i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-4",children:i.jsx(ii,{className:"w-8 h-8 text-white"})}),i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Login"}),i.jsx("p",{className:"text-gray-600",children:"Access the administration panel"})]}),i.jsxs("form",{className:"space-y-6",onSubmit:h,children:[o&&i.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:i.jsxs("div",{className:"flex",children:[i.jsx(vt,{className:"h-5 w-5 text-red-400"}),i.jsx("div",{className:"ml-3",children:i.jsx("p",{className:"text-sm text-red-700",children:o})})]})}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Username"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Vn,{className:"h-5 w-5 text-gray-400"})}),i.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,value:e,onChange:f=>t(f.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter username"})]})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ii,{className:"h-5 w-5 text-gray-400"})}),i.jsx("input",{id:"password",name:"password",type:a?"text":"password",autoComplete:"current-password",required:!0,value:n,onChange:f=>r(f.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter password"}),i.jsx("button",{type:"button",onClick:()=>s(!a),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:i.jsx(P0,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})]}),i.jsx("button",{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-400 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-[1.02] disabled:scale-100 disabled:cursor-not-allowed",children:c?i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing In..."]}):"Sign In"})]}),i.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:i.jsxs("p",{className:"text-xs text-gray-600 text-center",children:[i.jsx("strong",{children:"Demo Credentials:"}),i.jsx("br",{}),"Username: admin@kiosk.com | Password: admin123"]})})]}),i.jsx("div",{className:"text-center mt-6",children:i.jsx("p",{className:"text-sm text-gray-500",children:"Attendance Kiosk System v1.0"})})]})]})},OD=({registerCleanup:e})=>{const[t,n]=E.useState([]),[r,a]=E.useState([]),[s,o]=E.useState([]),[l,c]=E.useState(""),[u,d]=E.useState(!1),[h,f]=E.useState(null),[p,m]=E.useState({firstName:"",lastName:"",employeeId:"",email:"",phone:"",department:"",designation:"",policyId:"",joinDate:"",status:"active",leavePolicyIds:[],password:""}),[x,y]=E.useState({}),[g,v]=E.useState(null),[w,b]=E.useState(!0),[N,_]=E.useState(!1),C=E.useRef(!1),[k,j]=E.useState(!1),[S,M]=E.useState(null),[D,A]=E.useState(!1),[B,F]=E.useState(null),[U,V]=E.useState(!1),[P,$]=E.useState(0),[I,q]=E.useState(null),[X,ne]=E.useState(""),[ie,le]=E.useState("ssdMobilenetv1"),[pe,_e]=E.useState([]),G=E.useRef([]),[re,Ce]=E.useState([]),H=E.useRef([]),[O,Q]=E.useState(!1),oe=E.useRef(!1),[ue,W]=E.useState(!1);E.useRef(!1);const ae=E.useRef(null),je=E.useRef(null);E.useRef(null);const de=E.useRef(null);E.useEffect(()=>((async()=>{try{const[Ie,et,tn]=await Promise.all([Ne.getEmployees(),Ne.getPolicies(),Ne.getLeavePolicies()]);n(Ie),a(et),o(tn)}catch(Ie){console.error("Failed to load data:",Ie)}finally{b(!1)}})(),e&&e(()=>{Wr()}),()=>{Wr()}),[]);const Le=async()=>{try{await ft.tinyFaceDetector.loadFromUri("/models"),await ft.ssdMobilenetv1.loadFromUri("/models"),await ft.faceLandmark68Net.loadFromUri("/models"),await ft.faceRecognitionNet.loadFromUri("/models"),_(!0)}catch(Z){throw console.error("Failed to load face-api models:",Z),Z}},qe=t.filter(Z=>Z.name.toLowerCase().includes(l.toLowerCase())||Z.email.toLowerCase().includes(l.toLowerCase())||Z.employee_id.toLowerCase().includes(l.toLowerCase())||Z.department.toLowerCase().includes(l.toLowerCase())),Oe=Z=>Z.split(" ").map(Ie=>Ie[0]).join("").toUpperCase(),ee=()=>{m({firstName:"",lastName:"",employeeId:"",email:"",phone:"",department:"",designation:"",policyId:"",joinDate:"",status:"active",leavePolicyIds:[],password:""}),y({}),f(null)},me=()=>{ee(),d(!0)},ke=Z=>{m({firstName:Z.name.split(" ")[0],lastName:Z.name.split(" ").slice(1).join(" ")||"",employeeId:Z.employee_id,email:Z.email,phone:Z.phone||"",department:Z.department,designation:Z.designation,policyId:Z.policy?Z.policy.id.toString():"",joinDate:Z.join_date,status:Z.status||"active",leavePolicyIds:(Z.leave_policies||[]).map(Ie=>Ie.id.toString()),password:""}),f(Z),d(!0)},Me=()=>{d(!1),ee()},Ye=()=>{const Z={};return p.firstName.trim()||(Z.firstName="First name is required"),p.lastName.trim()||(Z.lastName="Last name is required"),p.employeeId.trim()||(Z.employeeId="Employee ID is required"),p.email.trim()?/\S+@\S+\.\S+/.test(p.email)||(Z.email="Email is invalid"):Z.email="Email is required",p.department.trim()||(Z.department="Department is required"),p.designation.trim()||(Z.designation="Designation is required"),p.policyId||(Z.policyId="Policy is required"),p.joinDate||(Z.joinDate="Join date is required"),y(Z),Object.keys(Z).length===0},$e=async Z=>{if(Z.preventDefault(),!Ye())return;const Ie={employee_id:p.employeeId.trim(),name:`${p.firstName.trim()} ${p.lastName.trim()}`,email:p.email.trim(),phone:p.phone.trim(),department:p.department.trim(),designation:p.designation.trim(),join_date:p.joinDate,status:p.status,face_enrolled:h?h.face_enrolled:!1,policy_id:parseInt(p.policyId,10),leave_policy_ids:p.leavePolicyIds.map(et=>parseInt(et,10))};p.password.trim()&&(Ie.password=p.password.trim());try{if(h){const et=await Ne.updateEmployee(h.id,Ie),tn=await Ne.getEmployees();n(tn),F(et),A(!0),Me()}else{const et=await Ne.createEmployee(Ie);n([...t,et]),M(et),d(!1),j(!0)}}catch(et){console.error("Failed to save employee:",et),alert("Failed to save employee. Please try again.")}},St=Z=>{m(Ie=>{const tn=Ie.leavePolicyIds.includes(Z)?Ie.leavePolicyIds.filter(Cn=>Cn!==Z):[...Ie.leavePolicyIds,Z];return{...Ie,leavePolicyIds:tn}})},Zn=async()=>{try{await Ne.deleteEmployee(g.id),n(t.filter(Z=>Z.id!==g.id)),v(null)}catch(Z){console.error("Failed to delete employee:",Z),alert("Failed to delete employee. Please try again.")}},ja=()=>{const Z=[["Name","Employee ID","Email","Phone","Department","Designation","Face Enrolled","Join Date"],...qe.map(Cn=>[Cn.name,Cn.employee_id,Cn.email,Cn.phone||"",Cn.department,Cn.designation,Cn.face_enrolled?"Yes":"No",Cn.join_date])].map(Cn=>Cn.join(",")).join(`
`),Ie=new Blob([Z],{type:"text/csv"}),et=window.URL.createObjectURL(Ie),tn=document.createElement("a");tn.href=et,tn.download=`employees_${new Date().toISOString().split("T")[0]}.csv`,tn.click(),window.URL.revokeObjectURL(et)},rs=async Z=>{if(q(Z),$(0),V(!0),ne(""),_e([]),G.current=[],Ce([]),H.current=[],!N&&!C.current){C.current=!0;try{await Le()}finally{C.current=!1}}},yr=()=>{V(!1),$(0),q(null),Wr()},lo=async()=>{try{const Z=await navigator.mediaDevices.getUserMedia({video:!0});if(ae.current){ae.current.srcObject=Z,de.current=Z;const Ie=ae.current.play();Ie!=null&&Ie.catch&&Ie.catch(()=>{})}}catch(Z){console.error("Camera error",Z),ne("Camera access denied or unavailable.")}},Wr=()=>{de.current&&(de.current.getTracks().forEach(Z=>Z.stop()),de.current=null)},r1=async()=>{$(1),le("ssdMobilenetv1"),ne("Initializing camera..."),await lo();const Z=(Ie,et,tn=0)=>{if(!ae.current)return et(new Error("No video element"));if(ae.current.readyState>=2)return Ie();if(tn>50)return et(new Error("Video not ready"));setTimeout(()=>Z(Ie,et,tn+1),100)};new Promise(Z).then(()=>{Q(!0),oe.current=!0,ne("Capturing your face..."),Fp()}).catch(()=>ne("Video not ready. Please try again."))},Fp=async()=>{if(!(!oe.current||G.current.length>=10)){try{let Z;if(ie==="ssdMobilenetv1"&&(Z=await wc(ae.current,new io({minConfidence:.5})).withFaceLandmarks().withFaceDescriptor(),Z||le("tinyFaceDetector")),Z||(Z=await wc(ae.current,new wp({inputSize:256,scoreThreshold:.1})).withFaceLandmarks().withFaceDescriptor()),Z){G.current.push(Z.descriptor),_e([...G.current]);const Ie=document.createElement("canvas");Ie.width=160,Ie.height=120;const et=Ie.getContext("2d");try{et.drawImage(ae.current,0,0,Ie.width,Ie.height)}catch{}const tn=Ie.toDataURL("image/jpeg");H.current.push(tn),Ce([...H.current]),ne(`Capturing your face...
Image ${G.current.length} of 10`),G.current.length>=10&&(Q(!1),oe.current=!1,ne("All 10 images captured. Ready to enroll."),a1())}}catch(Z){console.error("Detection error",Z),ne("Error during detection.")}oe.current&&setTimeout(Fp,250)}},a1=async()=>{if(G.current.length<5){alert("Please capture at least 5 images.");return}try{W(!0),ne("Registering face...");const Z={method:"auto-10",intervalMs:250,totalSamples:G.current.length,detectionMethod:ie};await Ne.enrollFace(I.employee_id,G.current,Z),n(Ie=>Ie.map(et=>et.id===I.id?{...et,face_enrolled:!0}:et)),Wr(),$(2)}catch(Z){console.error("Enrollment error:",Z),ne("Enrollment failed. Please try again.")}finally{W(!1)}};return w?i.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),i.jsx("p",{className:"text-gray-600",children:"Loading employees..."})]})}):i.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-6",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsx("div",{className:"mb-6",children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Employee Management"}),i.jsx("p",{className:"text-md text-gray-600 mt-1",children:"Manage employees and face enrollment"})]}),i.jsxs("button",{onClick:me,className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-3 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm",children:[i.jsx(Ga,{className:"w-4 h-4"}),i.jsx("span",{children:"Add Employee"})]})]})}),i.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 mb-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(rg,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),i.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:Z=>c(Z.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row md:flex-row lg:flex-row gap-2",children:[i.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[i.jsx(Rf,{className:"w-4 h-4"}),i.jsx("span",{className:"inline",children:"Filter"})]}),i.jsxs("button",{onClick:ja,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[i.jsx(si,{className:"w-4 h-4"}),i.jsx("span",{className:"inline",children:"Export"})]})]})]}),i.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-5",children:qe.map(Z=>i.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-blue-500 hover:shadow-md transition-all",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-lg font-bold",children:Oe(Z.name)}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:()=>ke(Z),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-pen text-gray-600",children:i.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})})}),i.jsx("button",{onClick:()=>v(Z),className:"p-1.5 hover:bg-red-50 rounded-lg transition-colors",children:i.jsx(li,{className:"w-4 h-4"})})]})]}),i.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:Z.name}),i.jsx("p",{className:"text-xs text-gray-600 mb-3",children:Z.employee_id}),i.jsxs("div",{className:"space-y-2 mb-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Wn,{className:"w-4 h-4"}),i.jsx("span",{className:"truncate",children:Z.email})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Ma,{className:"w-4 h-4"}),i.jsx("span",{children:Z.phone||"+1 234 567 8902"})]}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[i.jsx(Vn,{className:"w-4 h-4"}),i.jsx("span",{children:Z.department})]})]}),Z.face_enrolled?i.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 border border-green-200 rounded-lg mb-3",children:[i.jsx(Lt,{className:"w-4 h-4 text-green-600"}),i.jsx("span",{className:"text-xs font-medium text-green-700",children:"Face Enrolled"})]}):i.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-50 border border-red-200 rounded-lg mb-3",children:[i.jsx(ao,{className:"w-4 h-4 text-red-600"}),i.jsx("span",{className:"text-xs font-medium text-red-700",children:"Face Not Enrolled"})]}),i.jsxs("button",{onClick:()=>rs(Z),className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors",children:[i.jsx(ks,{className:"w-4 h-4"}),i.jsx("span",{children:Z.face_enrolled?"Re-enroll Face":"Enroll Face"})]})]},Z.id))}),qe.length===0&&i.jsxs("div",{className:"text-center py-12 bg-white rounded-xl border border-gray-200",children:[i.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(rg,{className:"w-8 h-8 text-gray-400"})}),i.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"No employees found"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Try adjusting your search or add a new employee"})]}),u&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between z-10",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:h?"Edit Employee":"Add New Employee"}),i.jsx("button",{onClick:Me,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Mn,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"overflow-y-auto px-6 py-6 flex-1 space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),i.jsx("input",{type:"text",placeholder:"John",value:p.firstName,onChange:Z=>m({...p,firstName:Z.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),i.jsx("input",{type:"text",placeholder:"Smith",value:p.lastName,onChange:Z=>m({...p,lastName:Z.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee ID"}),i.jsx("input",{type:"text",placeholder:"EMP-001",value:p.employeeId,onChange:Z=>m({...p,employeeId:Z.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),i.jsx("input",{type:"email",placeholder:"john.smith@techcorp.com",value:p.email,onChange:Z=>m({...p,email:Z.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),i.jsx("input",{type:"tel",placeholder:"+1 234 567 8901",value:p.phone,onChange:Z=>m({...p,phone:Z.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),i.jsx("input",{type:"text",placeholder:"Engineering",value:p.department,onChange:Z=>m({...p,department:Z.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Designation"}),i.jsx("input",{type:"text",placeholder:"Senior Developer",value:p.designation,onChange:Z=>m({...p,designation:Z.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attendance Policy"}),i.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p.policyId,onChange:Z=>m({...p,policyId:Z.target.value}),children:[i.jsx("option",{value:"",children:"Select a policy"}),r.filter(Z=>Z.status==="active").map(Z=>i.jsx("option",{value:Z.id,children:Z.name},Z.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Join Date"}),i.jsx("input",{type:"date",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p.joinDate,onChange:Z=>m({...p,joinDate:Z.target.value})})]})]}),i.jsxs("div",{className:"border border-dashed border-gray-300 rounded-xl p-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Leave Policies"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Select the leave types this employee can access."})]}),i.jsxs("span",{className:"text-xs text-gray-500",children:[p.leavePolicyIds.length," selected"]})]}),s.length===0?i.jsx("p",{className:"text-xs text-gray-500",children:"No leave policies found. Create leave policies first."}):i.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(Z=>{const Ie=p.leavePolicyIds.includes(Z.id.toString());return i.jsxs("label",{className:`px-3 py-2 rounded-lg border text-xs font-medium cursor-pointer transition-colors ${Ie?"bg-blue-600 text-white border-blue-600":"bg-gray-50 text-gray-700 border-gray-200 hover:border-blue-300"}`,children:[i.jsx("input",{type:"checkbox",className:"hidden",checked:Ie,onChange:()=>St(Z.id.toString())}),Z.name,"  ",Z.yearly_quota," days"]},Z.id)})})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),i.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:p.status,onChange:Z=>m({...p,status:Z.target.value}),children:[i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"inactive",children:"Inactive"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Portal Password (optional)"}),i.jsx("input",{type:"password",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:h?"Leave blank to keep current password":"Set initial password",value:p.password,onChange:Z=>m({...p,password:Z.target.value})}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Employees use this password to access their portal."})]})]})]}),i.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-6 flex gap-3",children:[i.jsx("button",{onClick:Me,type:"button",className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{onClick:$e,type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",children:h?"Update Employee":"Add Employee"})]})]})}),k&&S&&i.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 text-center",children:[i.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-50 flex items-center justify-center mx-auto mb-4",children:i.jsx(ks,{className:"w-7 h-7 text-blue-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Employee Added!"}),i.jsxs("p",{className:"text-gray-700 mb-6",children:[i.jsx("span",{className:"font-semibold",children:S.name})," has been added successfully. Would you like to enroll their face now?"]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>{j(!1),M(null)},className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg font-medium",children:"Enroll Later"}),i.jsxs("button",{onClick:()=>{j(!1),rs(S)},className:"flex-1 px-4 py-2.5 rounded-lg font-medium bg-blue-600 text-white inline-flex items-center justify-center gap-2",children:[i.jsx(ks,{className:"w-4 h-4"}),"Enroll Now"]})]})]})}),U&&I&&i.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-[#0f1a2b] text-white rounded-2xl w-full max-w-md overflow-hidden",children:[i.jsxs("div",{className:"p-4 sm:p-6 flex items-center justify-between",children:[i.jsx("h2",{className:"text-lg sm:text-xl font-bold text-white",children:"Face Enrollment"}),i.jsx("button",{onClick:yr,className:"text-white/60 hover:text-white",children:i.jsx(Mn,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),i.jsxs("div",{className:"flex items-center justify-between mb-6 sm:mb-8 px-4 sm:px-6",children:[i.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-green-500",children:i.jsx(Lt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),i.jsx("div",{className:"flex-1 h-1 mx-1 sm:mx-2 bg-gray-700"}),i.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full ${P>=1?"bg-green-500":"bg-gray-700"}`,children:i.jsx(ks,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),i.jsx("div",{className:"flex-1 h-1 mx-1 sm:mx-2 bg-gray-700"}),i.jsx("div",{className:`flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 rounded-full ${P>=2?"bg-green-500":"bg-gray-700"}`,children:i.jsx(Lt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})})]}),i.jsxs("div",{className:"p-4 sm:p-6",children:[P===0&&i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-2xl sm:text-3xl font-bold mx-auto mb-4",children:Oe(I.name)}),i.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:I.name}),i.jsx("p",{className:"text-gray-400 mb-1 text-sm sm:text-base",children:I.employee_id}),i.jsx("p",{className:"text-gray-400 mb-4 sm:mb-6 text-sm sm:text-base",children:I.department}),i.jsxs("div",{className:"bg-slate-800 rounded-lg p-3 sm:p-4 mb-4 sm:mb-6 text-left",children:[i.jsx("h4",{className:"text-sm font-semibold text-white mb-2 sm:mb-3",children:"Instructions:"}),i.jsxs("ul",{className:"space-y-1 sm:space-y-2 text-xs sm:text-sm text-gray-300",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsx("span",{children:"Position your face in the camera frame"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsx("span",{children:"Look directly at the camera"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsx("span",{children:"Ensure good lighting"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-400",children:""}),i.jsx("span",{children:"10 images will be captured automatically"})]})]})]}),i.jsx("button",{onClick:r1,className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 sm:py-3 rounded-lg font-semibold transition-colors text-sm sm:text-base",children:"Start Capture"})]}),P===1&&i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"relative bg-slate-900 rounded-xl overflow-hidden mb-4",children:[i.jsx("video",{ref:ae,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-48 sm:h-64 object-cover"}),i.jsx("canvas",{ref:je,className:"absolute top-0 left-0 w-full h-48 sm:h-64 hidden"})]}),i.jsx("div",{className:"text-slate-200 mb-2 whitespace-pre-line text-sm sm:text-base",children:X||"Capturing your face..."}),i.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2 mb-2",children:i.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all",style:{width:`${pe.length/10*100}%`}})}),i.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2 mb-4",children:re.map((Z,Ie)=>i.jsx("img",{src:Z,alt:`sample-${Ie}`,className:"w-full h-12 sm:h-16 object-cover rounded border border-slate-700"},Ie))}),i.jsx("p",{className:"text-center text-slate-400 text-xs sm:text-sm",children:"Capturing 10 images automatically..."}),ue&&i.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400",children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-400"}),i.jsx("span",{className:"text-sm",children:"Processing enrollment..."})]})]}),P===2&&i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-green-500 grid place-items-center mx-auto mb-4",children:i.jsx(Lt,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),i.jsx("h4",{className:"text-xl sm:text-2xl font-semibold mb-1",children:"Enrollment Successful!"}),i.jsx("p",{className:"text-slate-300 mb-4 sm:mb-6 text-sm sm:text-base",children:"Face has been registered successfully"}),i.jsx("button",{onClick:yr,className:"w-full bg-green-500 hover:bg-green-600 text-white font-semibold rounded-xl py-2 sm:py-3 text-sm sm:text-base",children:"Continue"})]})]})]})}),D&&B&&i.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 text-center",children:[i.jsx("div",{className:"w-14 h-14 rounded-full bg-green-50 flex items-center justify-center mx-auto mb-4",children:i.jsx(Lt,{className:"w-7 h-7 text-green-600"})}),i.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Employee Updated Successfully"}),i.jsxs("p",{className:"text-gray-700 mb-6",children:[i.jsx("span",{className:"font-semibold",children:B.name})," has been updated successfully."]}),i.jsx("div",{className:"flex gap-3",children:i.jsx("button",{onClick:()=>{A(!1),F(null)},className:"flex-1 px-4 py-2.5 rounded-lg font-medium bg-green-600 text-white",children:"Continue"})})]})}),g&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:i.jsx(li,{className:"w-6 h-6 text-red-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Delete Employee"})]}),i.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete ",i.jsx("strong",{children:g.name}),"? This action cannot be undone and will remove all associated data."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>v(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{onClick:Zn,className:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700",children:"Delete"})]})]})})})]})]})})},LD=()=>{const[e,t]=E.useState([]),[n,r]=E.useState(!0),[a,s]=E.useState(!1),[o,l]=E.useState(null),[c,u]=E.useState(null),[d,h]=E.useState(null),[f,p]=E.useState(null),[m,x]=E.useState(null),[y,g]=E.useState({show:!1,type:"success",message:""}),[v,w]=E.useState({policyName:"",effectiveFrom:"",effectiveTo:"",includeBreak:!1,breakHours:1,breakMinutes:0,fullDayHours:8,fullDayMinutes:30,halfDayHours:4,halfDayMinutes:30,enableLateTracking:!0,workStartTime:"09:00",lateGracePeriod:15,enableEarlyTracking:!0,workEndTime:"18:00",earlyGracePeriod:15});E.useEffect(()=>{(async()=>{try{const B=await Ne.getPolicies();t(B)}catch(B){console.error("Failed to load policies:",B)}finally{r(!1)}})()},[]);const b=A=>{const B=F=>{if(!F)return"";try{let U;if(F.includes("T")?U=new Date(F):U=new Date(F+"T00:00:00"),isNaN(U.getTime()))return"";const V=U.getFullYear(),P=String(U.getMonth()+1).padStart(2,"0"),$=String(U.getDate()).padStart(2,"0");return`${V}-${P}-${$}`}catch(U){return console.error("Error parsing date:",F,U),""}};l(A),w({policyName:A.name||"",effectiveFrom:B(A.effective_from),effectiveTo:B(A.effective_to),includeBreak:A.include_break||!1,breakHours:A.break_hours||1,breakMinutes:A.break_minutes||0,fullDayHours:A.full_day_hours||8,fullDayMinutes:A.full_day_minutes||30,halfDayHours:A.half_day_hours||4,halfDayMinutes:A.half_day_minutes||30,enableLateTracking:A.enable_late_tracking!==void 0?A.enable_late_tracking:!0,workStartTime:A.work_start_time?A.work_start_time.substring(0,5):"09:00",lateGracePeriod:A.late_grace_period||15,enableEarlyTracking:A.enable_early_tracking!==void 0?A.enable_early_tracking:!0,workEndTime:A.work_end_time?A.work_end_time.substring(0,5):"18:00",earlyGracePeriod:A.early_grace_period||15}),s(!0)},N=()=>{l(null),w({policyName:"",effectiveFrom:"",effectiveTo:"",includeBreak:!1,breakHours:1,breakMinutes:0,fullDayHours:8,fullDayMinutes:30,halfDayHours:4,halfDayMinutes:30,enableLateTracking:!0,workStartTime:"09:00",lateGracePeriod:15,enableEarlyTracking:!0,workEndTime:"18:00",earlyGracePeriod:15}),s(!0)},_=async A=>{A.preventDefault();const B={name:v.policyName,effective_from:v.effectiveFrom?v.effectiveFrom:null,effective_to:v.effectiveTo?v.effectiveTo:null,include_break:v.includeBreak,break_hours:v.breakHours,break_minutes:v.breakMinutes,full_day_hours:v.fullDayHours,full_day_minutes:v.fullDayMinutes,half_day_hours:v.halfDayHours,half_day_minutes:v.halfDayMinutes,enable_late_tracking:v.enableLateTracking,work_start_time:v.workStartTime,late_grace_period:v.lateGracePeriod,enable_early_tracking:v.enableEarlyTracking,work_end_time:v.workEndTime,early_grace_period:v.earlyGracePeriod};try{if(o){const F=await Ne.updatePolicy(o.id,B);t(e.map(U=>U.id===o.id?F:U)),g({show:!0,type:"success",message:"Policy updated successfully!"})}else{const F=await Ne.createPolicy(B);t([...e,F]),g({show:!0,type:"success",message:"Policy created successfully!"})}setTimeout(()=>g({show:!1,type:"success",message:""}),2e3),s(!1)}catch(F){console.error("Failed to save policy:",F),g({show:!0,type:"error",message:"Failed to save policy. Please try again."}),setTimeout(()=>g({show:!1,type:"error",message:""}),3e3)}},C=A=>{h(A)},k=async()=>{try{const A=await Ne.togglePolicyStatus(d.id);t(e.map(B=>B.id===d.id?A.policy:B)),h(null),g({show:!0,type:"success",message:A.message||"Policy status updated successfully!"}),setTimeout(()=>g({show:!1,type:"success",message:""}),2e3)}catch(A){console.error("Failed to toggle policy status:",A);const B=A.error||"Failed to update policy status. Please try again.";g({show:!0,type:"error",message:B}),setTimeout(()=>g({show:!1,type:"error",message:""}),2e3),h(null)}},j=async()=>{var A,B,F,U;if(!c.id){g({show:!0,type:"error",message:"Invalid policy selected. Please try again."}),setTimeout(()=>g({show:!1,type:"error",message:""}),2e3),u(null);return}try{await Ne.deletePolicy(c.id),t(e.filter(V=>V.id!==c.id)),u(null),g({show:!0,type:"success",message:"Policy deleted successfully!"}),setTimeout(()=>g({show:!1,type:"success",message:""}),2e3)}catch(V){if(console.error("Failed to delete policy:",V),V.response&&V.response.status===422&&V.response.data.error)x(V.response.data),u(null);else{const P=((B=(A=V.response)==null?void 0:A.data)==null?void 0:B.message)||((U=(F=V.response)==null?void 0:F.data)==null?void 0:U.error)||"Failed to delete policy. Please try again.";g({show:!0,type:"error",message:P}),setTimeout(()=>g({show:!1,type:"error",message:""}),2e3)}}},S=A=>{p(A)},M=async()=>{if(!f){g({show:!0,type:"error",message:"Invalid policy selected. Please try again."}),setTimeout(()=>g({show:!1,type:"error",message:""}),3e3),p(null);return}const A=f,B={name:`Copy of ${A.name}`,effective_from:A.effective_from,effective_to:A.effective_to,include_break:A.include_break,break_hours:A.break_hours,break_minutes:A.break_minutes,full_day_hours:A.full_day_hours,full_day_minutes:A.full_day_minutes,half_day_hours:A.half_day_hours,half_day_minutes:A.half_day_minutes,enable_late_tracking:A.enable_late_tracking,work_start_time:A.work_start_time?A.work_start_time.substring(0,5):"09:00",late_grace_period:A.late_grace_period,enable_early_tracking:A.enable_early_tracking,work_end_time:A.work_end_time?A.work_end_time.substring(0,5):"18:00",early_grace_period:A.early_grace_period,enable_absence_tracking:A.enable_absence_tracking};try{const F=await Ne.createPolicy(B);t([...e,F]),g({show:!0,type:"success",message:"Policy copied successfully!"}),setTimeout(()=>g({show:!1,type:"success",message:""}),3e3),p(null)}catch(F){console.error("Failed to copy policy:",F),g({show:!0,type:"error",message:"Failed to copy policy. Please try again."}),setTimeout(()=>g({show:!1,type:"error",message:""}),3e3),p(null)}},D=A=>A?A.substring(0,5):"-";return n?i.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):i.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsx("div",{className:"mb-8",children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Policy Management"}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure attendance policies"})]}),i.jsxs("button",{onClick:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 md:px-6 py-2 md:py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-colors text-sm md:text-base",children:[i.jsx(Ga,{className:"w-5 h-5"}),i.jsx("span",{children:"Create Policy"})]})]})}),y.show&&i.jsxs("div",{className:`mb-6 p-4 border rounded-lg flex items-center shadow-sm ${y.type==="success"?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:[y.type==="success"?i.jsx(Lt,{className:"w-5 h-5 mr-3 flex-shrink-0"}):i.jsx(ao,{className:"w-5 h-5 mr-3 flex-shrink-0"}),i.jsx("span",{className:"font-medium",children:y.message})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:e.map((A,B)=>i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow",children:[i.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-200",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsx("h3",{className:"text-lg font-bold text-gray-900",children:A.name}),i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${A.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:A.status==="active"?"Active":"Inactive"})]}),i.jsxs("p",{className:"text-sm text-gray-600",children:[A.employees_count||0," employees assigned"]})]}),i.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(He,{className:"w-5 h-5 text-blue-600"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Work Hours"}),i.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[D(A.work_start_time)," - ",D(A.work_end_time)]})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Ke,{className:"w-5 h-5 text-green-600"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Full Day / Half Day"}),i.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[A.full_day_hours,".",A.full_day_minutes," hrs / ",A.half_day_hours,".",A.half_day_minutes," hrs"]})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(m_,{className:"w-5 h-5 text-orange-600"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Break Duration"}),i.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[A.break_hours,".",A.break_minutes," hr ",A.include_break?"(Included)":"(Excluded)"]})]})]})]}),i.jsxs("div",{className:"p-4 bg-gray-50 border-t border-gray-200 flex gap-2",children:[i.jsxs("button",{onClick:()=>b(A),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors flex items-center justify-center gap-2",children:[i.jsx(ca,{className:"w-4 h-4"}),"Edit"]}),i.jsx("button",{onClick:()=>S(A),className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",title:"Copy",children:i.jsx(nh,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>C(A),className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition-colors",title:A.status==="active"?"Deactivate":"Activate",children:i.jsx(th,{className:"w-4 h-4"})})]})]},A.id||`policy-${B}`))}),e.length===0&&i.jsxs("div",{className:"text-center py-12 text-gray-500",children:[i.jsx("p",{className:"text-lg",children:"No policies found"}),i.jsx("p",{className:"text-sm mt-2",children:"Create your first policy to get started"})]}),a&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 md:p-6 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:o?"Edit Policy":"Create Policy"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:o?o.name:"New Policy"})]}),i.jsx("button",{onClick:()=>s(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Mn,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"overflow-y-auto max-h-[60vh] p-6",children:i.jsxs("form",{onSubmit:_,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"policyName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Policy Name"}),i.jsx("input",{id:"policyName",type:"text",placeholder:"e.g., Standard Office Policy",value:v.policyName,onChange:A=>w({...v,policyName:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Effective From"}),i.jsx("input",{type:"date",value:v.effectiveFrom,onChange:A=>w({...v,effectiveFrom:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Effective To"}),i.jsx("input",{type:"date",value:v.effectiveTo,onChange:A=>w({...v,effectiveTo:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(He,{className:"w-5 h-5 text-blue-600"}),"Work Duration Settings"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("input",{type:"checkbox",id:"breakHandlingEdit",checked:v.includeBreak,onChange:A=>w({...v,includeBreak:A.target.checked}),className:"w-4 h-4 text-blue-600"}),i.jsx("label",{htmlFor:"breakHandlingEdit",className:"text-sm font-medium text-gray-700",children:"Include break time in work duration calculation"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Duration (Hours)"}),i.jsx("input",{type:"number",step:"0.5",placeholder:"1.0",value:v.breakHours,onChange:A=>w({...v,breakHours:parseFloat(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Break Duration (Minutes)"}),i.jsx("input",{type:"number",step:"15",placeholder:"0",value:v.breakMinutes,onChange:A=>w({...v,breakMinutes:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Ke,{className:"w-5 h-5 text-green-600"}),"Attendance Classification"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Day Minimum Hours"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("input",{type:"number",placeholder:"8",value:v.fullDayHours,onChange:A=>w({...v,fullDayHours:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),i.jsx("input",{type:"number",placeholder:"30",value:v.fullDayMinutes,onChange:A=>w({...v,fullDayMinutes:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours and Minutes"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Half Day Minimum Hours"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("input",{type:"number",placeholder:"4",value:v.halfDayHours,onChange:A=>w({...v,halfDayHours:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),i.jsx("input",{type:"number",placeholder:"30",value:v.halfDayMinutes,onChange:A=>w({...v,halfDayMinutes:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours and Minutes"})]})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(vt,{className:"w-5 h-5 text-orange-600"}),"Late Arrival Tracking"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("input",{type:"checkbox",id:"enableLateEdit",checked:v.enableLateTracking,onChange:A=>w({...v,enableLateTracking:A.target.checked}),className:"w-4 h-4 text-blue-600"}),i.jsx("label",{htmlFor:"enableLateEdit",className:"text-sm font-medium text-gray-700",children:"Enable late arrival tracking"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Work Start Time"}),i.jsx("input",{type:"time",value:v.workStartTime,onChange:A=>w({...v,workStartTime:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grace Period (minutes)"}),i.jsx("input",{type:"number",placeholder:"15",value:v.lateGracePeriod,onChange:A=>w({...v,lateGracePeriod:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(vt,{className:"w-5 h-5 text-red-600"}),"Early Departure Tracking"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("input",{type:"checkbox",id:"enableEarlyEdit",checked:v.enableEarlyTracking,onChange:A=>w({...v,enableEarlyTracking:A.target.checked}),className:"w-4 h-4 text-blue-600"}),i.jsx("label",{htmlFor:"enableEarlyEdit",className:"text-sm font-medium text-gray-700",children:"Enable early departure tracking"})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Work End Time"}),i.jsx("input",{type:"time",value:v.workEndTime,onChange:A=>w({...v,workEndTime:A.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grace Period (minutes)"}),i.jsx("input",{type:"number",placeholder:"15",value:v.earlyGracePeriod,onChange:A=>w({...v,earlyGracePeriod:parseInt(A.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})]})]})}),i.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-4 md:p-6 flex gap-3",children:[i.jsx("button",{type:"button",onClick:()=>s(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{type:"submit",onClick:_,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:o?"Update Policy":"Create Policy"})]})]})}),c&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:i.jsx(li,{className:"w-6 h-6 text-red-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Delete Policy"})]}),i.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete ",i.jsx("strong",{children:c.name}),"? This action cannot be undone."]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>u(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{onClick:j,className:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors",children:"Delete"})]})]})})}),m&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[80vh] overflow-y-auto",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:i.jsx(li,{className:"w-6 h-6 text-red-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cannot Delete Policy"})]}),i.jsx("p",{className:"text-red-600 mb-4 font-medium",children:m.error}),i.jsx("p",{className:"text-gray-600 mb-6",children:"The following employees are currently assigned to this policy:"}),i.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 max-h-48 overflow-y-auto",children:i.jsx("ul",{className:"space-y-2",children:m.assigned_employees.map((A,B)=>i.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[i.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full flex-shrink-0"}),i.jsx("span",{className:"font-medium",children:A.employee_id}),i.jsxs("span",{className:"text-gray-600",children:["- ",A.name]})]},B))})}),i.jsx("div",{className:"flex gap-3",children:i.jsx("button",{onClick:()=>x(null),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"OK"})})]})})}),d&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center",children:i.jsx(th,{className:"w-6 h-6 text-orange-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:d.status==="active"?"Deactivate Policy":"Activate Policy"})]}),i.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to ",d.status==="active"?"deactivate":"activate"," ",i.jsx("strong",{children:d.name}),"?"]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>h(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{onClick:k,className:"flex-1 px-4 py-2.5 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition-colors",children:d.status==="active"?"Deactivate":"Activate"})]})]})})}),f&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:i.jsx(nh,{className:"w-6 h-6 text-blue-600"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Copy Policy"})]}),i.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to copy ",i.jsx("strong",{children:f.name}),"?"]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>p(null),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),i.jsx("button",{onClick:M,className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Copy"})]})]})})})]})})},cl={toBackend:{monthly_accrual:"monthly_accrual_value",carry_forward_quarter_cap:"carry_forward_max_per_quarter",carry_forward_reset_mode:"carry_forward_reset_frequency",max_balance:"annual_maximum",status:"is_active",carry_forward_enabled:"carry_forward_allowed",auto_reset_quarter_end:"carry_forward_auto_reset_enabled",sandwich_rule_enabled:"sandwich_rule_enabled"},fromBackend:{monthly_accrual_value:"monthly_accrual",carry_forward_max_per_quarter:"carry_forward_quarter_cap",carry_forward_reset_frequency:"carry_forward_reset_mode",annual_maximum:"max_balance",is_active:"status",carry_forward_allowed:"carry_forward_enabled",carry_forward_auto_reset_enabled:"auto_reset_quarter_end",sandwich_rule_enabled:"sandwich_rule_enabled"}},ul={name:"",code:"",description:"",yearly_quota:12,monthly_accrual:1,accrual_day_of_month:1,join_date_proration:!0,carry_forward_enabled:!0,carry_forward_quarter_cap:3,carry_forward_reset_mode:"quarterly",auto_reset_quarter_end:!0,reset_notice_days:3,sandwich_rule_enabled:!0,max_balance:12,status:"active",eligibility_departments:[],eligibility_designations:[]},lv=(e=[])=>i.jsx("div",{className:"flex flex-wrap gap-2",children:e.length===0?i.jsx("span",{className:"text-xs text-gray-500",children:"All"}):e.map(t=>i.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full",children:t},t))}),BD=()=>{const[e,t]=E.useState([]),[n,r]=E.useState(!0),[a,s]=E.useState(!1),[o,l]=E.useState(ul),[c,u]=E.useState(null),[d,h]=E.useState(null),[f,p]=E.useState(null),[m,x]=E.useState(null),[y,g]=E.useState([]),[v,w]=E.useState([]),[b,N]=E.useState([]),[_,C]=E.useState(!1),k=I=>{if(Array.isArray(I))return I.map(X=>k(X));const q={...I};return Object.keys(cl.fromBackend).forEach(X=>{const ne=cl.fromBackend[X];q[X]!==void 0&&(q[ne]=q[X],X!==ne&&delete q[X])}),typeof q.status=="boolean"&&(q.status=q.status?"active":"inactive"),q.carry_forward_enabled=!!q.carry_forward_enabled,q.auto_reset_quarter_end=!!q.auto_reset_quarter_end,q.sandwich_rule_enabled=!!q.sandwich_rule_enabled,q.eligibility_departments=q.eligibility_departments||[],q.eligibility_designations=q.eligibility_designations||[],q},j=I=>{const q={...I};return Object.keys(cl.toBackend).forEach(X=>{const ne=cl.toBackend[X];if(q[X]!==void 0){let ie=q[X];X==="status"&&(ie=ie==="active"),X==="carry_forward_reset_mode"&&(ie={quarterly:"QUARTERLY",annual:"ANNUAL"}[ie]||"QUARTERLY"),q[ne]=ie,ne!==X&&delete q[X]}}),q.carry_forward_allowed||(q.carry_forward_max_per_quarter=3,q.carry_forward_reset_frequency="QUARTERLY",q.carry_forward_auto_reset_enabled=!0,q.reset_notice_days=3),q.join_date_proration_rule="ACCRUE_FROM_NEXT_MONTH",q},S=async()=>{try{r(!0);const I=await Ne.getLeavePolicies();t(k(I))}catch(I){console.error("Failed to load leave policies",I),h({type:"error",message:"Unable to load leave policies."})}finally{r(!1)}},M=async()=>{try{C(!0);const I=await Ne.getEmployees();g(I||[]);const q=new Set,X=new Set;(I||[]).forEach(ne=>{ne.department&&q.add(ne.department),ne.designation&&X.add(ne.designation)}),w(Array.from(q)),N(Array.from(X))}catch(I){console.error("Failed to load employees / departments",I),h(q=>q||{type:"error",message:"Unable to load departments and designations."})}finally{C(!1)}};E.useEffect(()=>{S(),M()},[]),E.useEffect(()=>{if(d){const I=setTimeout(()=>{h(null)},2e3);return()=>clearTimeout(I)}},[d]);const D=()=>{s(!1),u(null),l(ul)},A=()=>{u(null),l(ul),s(!0)},B=I=>{u(I),l({...ul,...I,code:I.code,name:I.name,description:I.description??"",yearly_quota:I.yearly_quota,monthly_accrual:I.monthly_accrual,carry_forward_enabled:I.carry_forward_enabled,sandwich_rule_enabled:I.sandwich_rule_enabled,eligibility_departments:I.eligibility_departments||[],eligibility_designations:I.eligibility_designations||[],metadataObject:I.metadataObject||{}}),s(!0)},F=(I,q)=>{l(X=>({...X,[I]:q}))},U=E.useMemo(()=>[{title:"Basic Details",description:"Name, description & status",content:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Policy Name"}),i.jsx("input",{type:"text",value:o.name,onChange:I=>F("name",I.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"e.g., Casual Leave"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Policy Code"}),i.jsx("input",{type:"text",value:o.code,onChange:I=>F("code",I.target.value.toUpperCase()),className:"w-full border border-gray-300 rounded-lg px-4 py-2 uppercase",placeholder:"CL",maxLength:6})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),i.jsx("textarea",{value:o.description,onChange:I=>F("description",I.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2",rows:3,placeholder:"Explain what this leave type covers"})]})]})},{title:"Accrual Rules",description:"Monthly accrual and quotas",content:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Yearly Quota"}),i.jsx("input",{type:"number",value:o.yearly_quota,onChange:I=>F("yearly_quota",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2",min:0}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Annual maximum 12 leaves"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monthly Accrual"}),i.jsx("input",{type:"number",step:"0.5",value:o.monthly_accrual,onChange:I=>F("monthly_accrual",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"1 leave added monthly"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Accrual Day of Month *"}),i.jsx("input",{type:"number",value:o.accrual_day_of_month,onChange:I=>F("accrual_day_of_month",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2",min:1,max:31,required:!0}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Day of month for accruals"})]})]})},{title:"Carry-forward Settings",description:"Quarter limits & reset notifications",content:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-800",children:"Carry-forward allowed"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Auto reset at quarter end"})]}),i.jsx("label",{className:"inline-flex items-center cursor-pointer",children:i.jsx("input",{type:"checkbox",checked:o.carry_forward_enabled,onChange:I=>F("carry_forward_enabled",I.target.checked),className:"w-5 h-5 text-blue-600 rounded"})})]}),o.carry_forward_enabled&&i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quarter Cap (max leaves)"}),i.jsx("input",{type:"number",min:0,value:o.carry_forward_quarter_cap,onChange:I=>F("carry_forward_quarter_cap",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max 3 leaves carry forward"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reset Mode"}),i.jsxs("select",{value:o.carry_forward_reset_mode,onChange:I=>F("carry_forward_reset_mode",I.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-2",children:[i.jsx("option",{value:"quarterly",children:"Quarterly"}),i.jsx("option",{value:"annual",children:"Annual"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reset Notification (days)"}),i.jsx("input",{type:"number",min:0,value:o.reset_notice_days,onChange:I=>F("reset_notice_days",Number(I.target.value)),className:"w-full border border-gray-300 rounded-lg px-4 py-2"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Alert 3 days before reset"})]})]})]})},{title:"Sandwich Rule",description:"Weekend/holiday counted if leave spans both sides",content:i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"flex items-center justify-between border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-800",children:"Sandwich Rule"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Weekend/holiday counted if leave spans both sides"})]}),i.jsx("label",{htmlFor:"sandwich_rule_enabled",className:"inline-flex items-center cursor-pointer",children:i.jsx("input",{id:"sandwich_rule_enabled",name:"sandwich_rule_enabled",type:"checkbox",checked:o.sandwich_rule_enabled,onChange:I=>F("sandwich_rule_enabled",I.target.checked),className:"w-5 h-5 text-blue-600 rounded"})})]})})},{title:"Eligibility",description:"Departments / designations the policy applies to",content:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departments (Multi-select)"}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{multiple:!0,value:o.eligibility_departments,onChange:I=>{const q=Array.from(I.target.selectedOptions,X=>X.value);F("eligibility_departments",q)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[120px]",children:v.map(I=>i.jsx("option",{value:I,children:I},I))}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple. Leave empty for all departments."}),_&&i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Loading departments"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Designations (Multi-select)"}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{multiple:!0,value:o.eligibility_designations,onChange:I=>{const q=Array.from(I.target.selectedOptions,X=>X.value);F("eligibility_designations",q)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[120px]",children:b.map(I=>i.jsx("option",{value:I,children:I},I))}),i.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none",children:i.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple. Leave empty for all designations."}),_&&i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Loading designations"})]})]})}],[o,v,b,_]),V=async I=>{I.preventDefault();try{const q=j(o);c?await Ne.updateLeavePolicy(c.id,q):await Ne.createLeavePolicy(q),await S(),h({type:"success",message:`Policy ${c?"updated":"created"} successfully.`}),D()}catch(q){console.error("Failed to save policy",q),h({type:"error",message:(q==null?void 0:q.message)||"Unable to save policy. Please check inputs."})}},P=async()=>{if(f)try{await Ne.toggleLeavePolicyStatus(f.id),await S(),h({type:"success",message:"Policy status updated."})}catch{h({type:"error",message:"Failed to update status."})}finally{p(null)}},$=async()=>{if(m)try{await Ne.copyLeavePolicy(m.id),await S(),h({type:"success",message:"Policy copied successfully."})}catch{h({type:"error",message:"Failed to copy policy."})}finally{x(null)}};return i.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[i.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Leave Policies"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Configure CL, SL, EL accruals & sandwich rule."})]}),i.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[i.jsx(Ga,{className:"w-4 h-4"}),"Create Policy"]})]}),d&&i.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 rounded-lg ${d.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[d.type==="success"?i.jsx(Lt,{className:"w-5 h-5"}):i.jsx(vt,{className:"w-5 h-5"}),i.jsx("span",{className:"font-medium text-sm",children:d.message})]}),n?i.jsx("div",{className:"flex justify-center py-16",children:"Loading policies..."}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:e.map(I=>i.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-5 flex flex-col gap-4",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:I.code}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:I.name}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:I.description})]}),i.jsx("span",{className:`px-3 py-1 text-xs font-semibold rounded-full ${I.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:I.status})]}),i.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(G_,{className:"w-4 h-4 text-blue-500"}),i.jsxs("span",{children:["Quota: ",I.yearly_quota," / year  +",I.monthly_accrual," monthly"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(rh,{className:"w-4 h-4 text-orange-500"}),i.jsxs("span",{children:["Carry forward:"," ",I.carry_forward_enabled?`Yes  ${I.carry_forward_quarter_cap} per quarter`:"No"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(vt,{className:`w-4 h-4 ${I.sandwich_rule_enabled?"text-red-500":"text-gray-400"}`}),i.jsxs("span",{children:["Sandwich rule: ",I.sandwich_rule_enabled?"Enabled":"Disabled"]})]})]}),i.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[i.jsx("p",{className:"font-semibold text-gray-700",children:"Eligibility"}),lv(I.eligibility_departments),lv(I.eligibility_designations)]}),i.jsxs("div",{className:"flex items-center gap-2 mt-auto",children:[i.jsxs("button",{onClick:()=>B(I),className:"flex-1 inline-flex items-center justify-center gap-2 border border-gray-200 rounded-lg px-3 py-2 text-sm font-medium hover:bg-gray-50",children:[i.jsx(ca,{className:"w-4 h-4"}),"Edit"]}),i.jsx("button",{onClick:()=>x(I),className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50",title:"Copy policy",children:i.jsx(nh,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>p(I),className:"p-2 border border-gray-200 rounded-lg hover:bg-gray-50",title:"Archive policy",children:i.jsx(th,{className:"w-4 h-4"})})]})]},I.id))})]}),a&&i.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-3xl shadow-xl max-h-[90vh] flex flex-col",children:[i.jsxs("div",{className:"flex items-start justify-between border-b border-gray-200 px-6 py-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:c?"Edit Leave Policy":"Create Leave Policy"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Multi-section setup covering accrual, carry-forward, sandwich & eligibility."})]}),i.jsx("button",{onClick:D,className:"p-2 rounded-full hover:bg-gray-100",children:i.jsx(Mn,{className:"w-5 h-5 text-gray-500"})})]}),i.jsx("form",{onSubmit:V,className:"overflow-y-auto px-6 py-4 space-y-6",children:U.map(I=>i.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"text-sm font-semibold text-gray-800",children:I.title}),i.jsx("p",{className:"text-xs text-gray-500",children:I.description})]}),I.content]},I.title))}),i.jsxs("div",{className:"border-t border-gray-200 px-6 py-4 flex items-center gap-3 justify-end",children:[i.jsx("button",{type:"button",onClick:D,className:"px-4 py-2 border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{type:"submit",onClick:V,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:c?"Update Policy":"Create Policy"})]})]})}),f&&i.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6 space-y-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:f.status==="active"?"Archive Policy":"Activate Policy"}),i.jsx("p",{className:"text-sm text-gray-600",children:f.status==="active"?"Archiving will disable accruals. Employees keep existing balance.":"Activating will resume accruals for eligible employees."}),i.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[i.jsx("button",{onClick:()=>p(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),i.jsx("button",{onClick:P,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Confirm"})]})]})}),m&&i.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6 space-y-4",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Copy ",m.name,"?"]}),i.jsx("p",{className:"text-sm text-gray-600",children:"A new inactive policy will be created with the same rules."}),i.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[i.jsx("button",{onClick:()=>x(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),i.jsx("button",{onClick:$,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Copy Policy"})]})]})})]})},$D=({onClose:e,onSuccess:t})=>{var _e,G,re,Ce,H;const[n,r]=E.useState(1),[a,s]=E.useState(""),[o,l]=E.useState(!1),[c,u]=E.useState([]),[d,h]=E.useState([]),[f,p]=E.useState(""),[m,x]=E.useState(""),[y,g]=E.useState([]),[v,w]=E.useState([]),[b,N]=E.useState({}),[_,C]=E.useState(""),[k,j]=E.useState({employee_id:"",policy_id:"",adjustment_days:"",adjustment_type:"add",reason:"",from_date:"",to_date:"",leave_request_id:"",leave_type:"Full Day"}),S=[{id:"adjust_balance",title:"Adjust Balance",description:"Add or subtract days from leave balance",icon:ng},{id:"add_leave",title:"Add Leave Manually",description:"Create a new leave entry",icon:Ga},{id:"edit_leave",title:"Edit Existing Leave",description:"Modify an existing leave request",icon:ca},{id:"delete_leave",title:"Delete Existing Leave",description:"Remove an existing leave entry",icon:li}];E.useEffect(()=>{M(),A()},[]),E.useEffect(()=>{f?D():(h([]),x(""))},[f]);const M=async()=>{try{const O=await Ne.getDepartments();u(O.departments||[])}catch(O){console.error("Failed to load departments:",O),N({submit:"Failed to load departments. Please check your authentication and try again."}),setTimeout(()=>N(Q=>({...Q,submit:""})),5e3)}},D=async()=>{try{const O=await Ne.getEmployeesByDepartment(f);h(O.employees||[])}catch(O){console.error("Failed to load employees:",O),N({submit:"Failed to load employees. Please check your authentication and try again."}),setTimeout(()=>N(Q=>({...Q,submit:""})),5e3)}},A=async()=>{l(!0);try{const O=await Ne.getCorrectionData();g(O.policies||[]),w(O.leave_requests||[])}catch(O){console.error("Failed to load correction data",O),N({submit:"Failed to load required data"}),setTimeout(()=>N(Q=>({...Q,submit:""})),2e3)}finally{l(!1)}},B=()=>{j({employee_id:"",policy_id:"",adjustment_days:"",adjustment_type:"add",reason:"",from_date:"",to_date:"",leave_request_id:"",leave_type:"Full Day"}),N({}),C("")},F=O=>{s(O),B(),r(2)},U=()=>{n<3&&r(n+1)},V=()=>{n>1&&r(n-1)},P=O=>{(O<=n||O===2&&a||O===3&&a)&&r(O)},$=O=>{var Q,oe;return O?O.leave_policy_id??O.policy_id??((Q=O.policy)==null?void 0:Q.id)??((oe=O.policy)==null?void 0:oe.policy_id)??O.policy_name??"":""},I=O=>{if(!O)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(O))return O;const Q=String(O),oe=new Date(Q);if(!isNaN(oe.getTime())){const ue=oe.getFullYear(),W=String(oe.getMonth()+1).padStart(2,"0"),ae=String(oe.getDate()).padStart(2,"0");return`${ue}-${W}-${ae}`}return""},q=(O,Q,oe=!1)=>{if(!O||!Q)return 0;const ue=Le=>{if(!Le)return null;const qe=String(Le).split("-").map(Number);if(qe.length!==3)return null;const[Oe,ee,me]=qe;return!Oe||!ee||!me?null:new Date(Oe,ee-1,me)},W=ue(O),ae=ue(Q);if(!W||!ae)return 0;const je=ae.getTime()-W.getTime(),de=Math.floor(je/(24*60*60*1e3))+1;return de<=0?0:oe?de-.5:de},X=()=>{var Q,oe,ue;const O={};return m||(O.employee_id="Employee is required"),a==="adjust_balance"&&(k.policy_id||(O.policy_id="Leave policy is required"),(k.adjustment_days===""||isNaN(Number(k.adjustment_days)))&&(O.adjustment_days="Please enter a valid number of days"),(Q=k.reason)!=null&&Q.trim()||(O.reason="Reason is required")),a==="add_leave"&&(k.policy_id||(O.policy_id="Leave policy is required"),k.from_date||(O.from_date="From date is required"),k.to_date||(O.to_date="To date is required"),k.from_date&&k.to_date&&k.from_date>k.to_date&&(O.to_date="End date must be after start date"),(oe=k.reason)!=null&&oe.trim()||(O.reason="Reason is required")),(a==="edit_leave"||a==="delete_leave")&&(k.leave_request_id||(O.leave_request_id="Leave request is required"),k.policy_id||(O.policy_id="Leave policy is required (from selected leave)"),a==="edit_leave"&&(k.from_date||(O.from_date="From date required"),k.to_date||(O.to_date="To date required"),k.from_date&&k.to_date&&k.from_date>k.to_date&&(O.to_date="End date must be after start date"),(ue=k.reason)!=null&&ue.trim()||(O.reason="Reason is required"))),N(O),Object.keys(O).length===0},ne=(O,Q)=>{const oe=Number(O);if(isNaN(oe))return;const ue=Math.abs(oe);return Q==="subtract"?-ue:ue},ie=async()=>{var O,Q,oe;if(X()){l(!0),N({}),C("");try{const ue={add_leave:"create",edit_leave:"update",delete_leave:"delete",adjust_balance:"adjust_balance"};let W=k.policy_id,ae;if(a==="delete_leave"){const Oe=(v||[]).find(Ye=>String(Ye.id)===String(k.leave_request_id)),ee=I((Oe==null?void 0:Oe.from_date)??k.from_date),me=I((Oe==null?void 0:Oe.to_date)??k.to_date),ke=!!(Oe!=null&&Oe.leave_type&&String(Oe.leave_type).toLowerCase().includes("half"))||k.leave_type==="Half Day",Me=q(ee,me,ke);ae=Number(Me),W=W||$(Oe),k.reason||j(Ye=>({...Ye,reason:`Deleted leave returned ${Me} day(s)`}))}else a==="adjust_balance"&&(ae=ne(k.adjustment_days,k.adjustment_type));const je=I(k.from_date),de=I(k.to_date),Le=k.employee_id||m,qe={action:ue[a],employee_id:Le||void 0,leave_policy_id:W||void 0,leave_request_id:k.leave_request_id||void 0,from_date:je||void 0,to_date:de||void 0,reason:k.reason||void 0,comment:((O=k.reason)==null?void 0:O.trim())??"",adjustment_days:ae!==void 0?ae:void 0,update_balance:a==="delete_leave"?!0:void 0,balance_adjustment:a==="delete_leave"?ae:void 0,leave_type:k.leave_type||void 0};Object.keys(qe).forEach(Oe=>qe[Oe]===void 0&&delete qe[Oe]),console.debug("applyLeaveCorrection payload:",qe),await Ne.applyLeaveCorrection(qe),await A(),C("Updated successfully"),setTimeout(()=>{C(""),typeof t=="function"&&t(),e()},1500)}catch(ue){console.error("Failed to apply correction",ue);const W=((Q=ue==null?void 0:ue.response)==null?void 0:Q.data)??(ue==null?void 0:ue.data)??null;if(((oe=ue==null?void 0:ue.response)==null?void 0:oe.status)===422&&W){const ae={};W.errors&&typeof W.errors=="object"?Object.entries(W.errors).forEach(([je,de])=>{const Le=je==="leave_policy_id"?"policy_id":je;Array.isArray(de)?ae[Le]=de.join(" "):ae[Le]=String(de)}):typeof W=="object"?Object.entries(W).forEach(([je,de])=>{je==="message"?ae.submit=String(de):Array.isArray(de)?ae[je]=de.join(" "):ae[je]=String(de)}):ae.submit="Validation failed",N(ae),ae.submit&&setTimeout(()=>N(je=>({...je,submit:""})),2e3)}else if(ue!=null&&ue.response){const ae=(W==null?void 0:W.message)||(W==null?void 0:W.error)||`Server error ${ue.response.status}`;N({submit:ae}),setTimeout(()=>N(je=>({...je,submit:""})),2e3)}else N({submit:(ue==null?void 0:ue.message)||"Failed to apply correction"}),setTimeout(()=>N(ae=>({...ae,submit:""})),2e3)}finally{l(!1)}}},le=v.filter(O=>String(O.employee_id)===String(m)),pe=(()=>{const O=d.find(oe=>String(oe.id)===String(m));if(!O||!Array.isArray(O.balances))return null;const Q=O.balances.find(oe=>String(oe.policy_id)===String(k.policy_id)||String(oe.leave_policy_id)===String(k.policy_id));return Q?Q.balance??Q.remaining??Q.days??null:null})();return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden",children:[i.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 md:p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Manual Leave Correction"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Apply corrections to employee leave records"})]}),i.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Mn,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[1,2,3].map(O=>i.jsxs("div",{className:"flex items-center",children:[i.jsx("button",{onClick:()=>P(O),disabled:O>n&&!(O===2&&a)&&!(O===3&&a),className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors ${n>=O?"bg-blue-600 text-white":O===2&&a?"bg-blue-100 text-blue-600 border-2 border-blue-600":"bg-gray-200 text-gray-600"} ${O>n&&!(O===2&&a)&&!(O===3&&a)?"cursor-not-allowed opacity-50":"cursor-pointer hover:bg-blue-700 hover:text-white"}`,children:O}),i.jsx("span",{className:`ml-2 text-sm font-medium ${n>=O?"text-blue-600":"text-gray-500"}`,children:O===1?"Action":O===2?"Details":"Review"}),O<3&&i.jsx("div",{className:`hidden sm:block w-8 sm:w-12 h-0.5 mx-2 sm:mx-4 ${n>O?"bg-blue-600":"bg-gray-300"}`})]},O))})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pb-32",children:[n===1&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(vt,{className:"w-5 h-5 text-blue-600"}),"Select Correction Type"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.map(O=>{const Q=O.icon;return i.jsx("button",{onClick:()=>F(O.id),className:`p-4 border rounded-lg text-left hover:bg-blue-50 transition-colors ${a===O.id?"bg-blue-50 border-blue-300":"bg-white border-gray-200"}`,children:i.jsxs("div",{className:"flex gap-3",children:[i.jsx(Q,{className:`w-6 h-6 ${a===O.id?"text-blue-600":"text-gray-600"}`}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-900",children:O.title}),i.jsx("p",{className:"text-sm text-gray-600",children:O.description})]})]})},O.id)})})]}),n===2&&a&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(mn,{className:"w-5 h-5 text-green-600"}),"Employee Selection"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Department"}),i.jsxs("select",{value:f,onChange:O=>{p(O.target.value),x(""),j(Q=>({...Q,employee_id:"",leave_request_id:"",policy_id:""}))},className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select Department"}),c.map(O=>i.jsx("option",{value:O,children:O},O))]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employee *"}),i.jsxs("select",{value:m,onChange:O=>{x(O.target.value),j(Q=>({...Q,employee_id:O.target.value,leave_request_id:"",policy_id:""}))},disabled:!f,className:"w-full border px-3 py-2 rounded-lg disabled:bg-gray-100",children:[i.jsx("option",{value:"",children:"Select Employee"}),d.map(O=>i.jsxs("option",{value:O.id,children:[O.name," (",O.employee_id,")"]},O.id))]}),b.employee_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.employee_id})]})]})]}),(a==="adjust_balance"||a==="add_leave")&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Ke,{className:"w-5 h-5 text-purple-600"}),"Leave Policy Configuration"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Leave Policy *"}),i.jsxs("select",{value:k.policy_id,onChange:O=>j(Q=>({...Q,policy_id:O.target.value})),className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select Policy"}),y.map(O=>i.jsx("option",{value:O.id,children:O.name},O.id))]}),b.policy_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.policy_id})]}),pe!==null&&i.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:i.jsxs("p",{className:"text-sm text-blue-800",children:[i.jsx("strong",{children:"Current Balance:"})," ",pe," days"]})})]})]}),a==="adjust_balance"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(ng,{className:"w-5 h-5 text-orange-600"}),"Balance Adjustment"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adjustment Type *"}),i.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[i.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"radio",name:"adj_type",checked:k.adjustment_type==="add",onChange:()=>j(O=>({...O,adjustment_type:"add"}))}),i.jsx("span",{className:"text-sm",children:"Add Days"})]}),i.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer",children:[i.jsx("input",{type:"radio",name:"adj_type",checked:k.adjustment_type==="subtract",onChange:()=>j(O=>({...O,adjustment_type:"subtract"}))}),i.jsx("span",{className:"text-sm",children:"Subtract Days"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Days *"}),i.jsx("input",{type:"number",step:"0.5",value:k.adjustment_days,onChange:O=>{const Q=String(O.target.value).replace(/\+/g,"");j(oe=>({...oe,adjustment_days:Q}))},className:"w-full border px-3 py-2 rounded-lg",placeholder:"e.g., 2 or 1.5"}),b.adjustment_days&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.adjustment_days})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),i.jsx("textarea",{value:k.reason,onChange:O=>j(Q=>({...Q,reason:O.target.value})),rows:3,className:"w-full border px-3 py-2 rounded-lg"}),b.reason&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.reason})]})]})]}),a==="add_leave"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Ga,{className:"w-5 h-5 text-green-600"}),"Leave Entry Details"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date *"}),i.jsx("input",{type:"date",value:k.from_date,onChange:O=>j(Q=>({...Q,from_date:O.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),b.from_date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.from_date})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date *"}),i.jsx("input",{type:"date",value:k.to_date,onChange:O=>j(Q=>({...Q,to_date:O.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),b.to_date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.to_date})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Leave Type *"}),i.jsxs("select",{value:k.leave_type,onChange:O=>j(Q=>({...Q,leave_type:O.target.value})),className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"Full Day",children:"Full Day"}),i.jsx("option",{value:"Half Day",children:"Half Day"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),i.jsx("textarea",{value:k.reason,onChange:O=>j(Q=>({...Q,reason:O.target.value})),rows:3,className:"w-full border px-3 py-2 rounded-lg"}),b.reason&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.reason})]})]})]}),(a==="edit_leave"||a==="delete_leave")&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(ca,{className:"w-5 h-5 text-indigo-600"}),"Select Leave Request"]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Leave Request *"}),i.jsxs("select",{value:k.leave_request_id,onChange:O=>{const Q=O.target.value,oe=le.find(de=>String(de.id)===String(Q))||(v||[]).find(de=>String(de.id)===String(Q)),ue=I(oe==null?void 0:oe.from_date),W=I(oe==null?void 0:oe.to_date),ae=!!(oe!=null&&oe.leave_type&&String(oe.leave_type).toLowerCase().includes("half"))||(oe==null?void 0:oe.half_day)===!0,je=q(ue,W,ae);j(de=>({...de,leave_request_id:Q,from_date:ue,to_date:W,policy_id:$(oe),adjustment_days:a==="delete_leave"?String(je):de.adjustment_days,adjustment_type:a==="delete_leave"?"add":de.adjustment_type,reason:(oe==null?void 0:oe.reason)??de.reason,leave_type:(oe==null?void 0:oe.leave_type)??de.leave_type})),N(de=>({...de,leave_request_id:void 0,policy_id:void 0}))},className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select leave"}),le.map(O=>{var Q;return i.jsxs("option",{value:O.id,children:[I(O.from_date),"  ",I(O.to_date)," (",((Q=O.policy)==null?void 0:Q.name)??O.policy_name??"",")"]},O.id)})]}),b.leave_request_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.leave_request_id}),b.policy_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.policy_id})]})})]}),a==="edit_leave"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(He,{className:"w-5 h-5 text-blue-600"}),"Update Leave Details"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date *"}),i.jsx("input",{type:"date",value:k.from_date,onChange:O=>j(Q=>({...Q,from_date:O.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),b.from_date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.from_date})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date *"}),i.jsx("input",{type:"date",value:k.to_date,onChange:O=>j(Q=>({...Q,to_date:O.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),b.to_date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.to_date})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),i.jsx("textarea",{value:k.reason,onChange:O=>j(Q=>({...Q,reason:O.target.value})),rows:3,className:"w-full border px-3 py-2 rounded-lg"}),b.reason&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:b.reason})]})]})]}),b.submit&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg mb-6",children:i.jsx("p",{className:"text-red-600 text-sm",children:b.submit})}),_&&i.jsx("div",{className:"bg-green-50 p-3 border border-green-200 rounded-lg mb-6",children:i.jsx("p",{className:"text-green-700 text-sm",children:_})})]}),n===3&&a&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Lt,{className:"w-5 h-5 text-green-600"}),"Review Your Changes"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Correction Type"}),i.jsx("p",{className:"text-gray-700",children:(_e=S.find(O=>O.id===a))==null?void 0:_e.title})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Employee"}),i.jsx("p",{className:"text-gray-700",children:((G=d.find(O=>String(O.id)===String(m)))==null?void 0:G.name)||"Not selected"})]})]}),a==="adjust_balance"&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Balance Adjustment"}),i.jsxs("p",{className:"text-gray-700",children:[k.adjustment_type==="add"?"Add":"Subtract"," ",k.adjustment_days," days",k.policy_id&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-1",children:["Policy: ",(re=y.find(O=>String(O.id)===String(k.policy_id)))==null?void 0:re.name]})]})]}),a==="add_leave"&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"New Leave Entry"}),i.jsxs("p",{className:"text-gray-700",children:[k.from_date," to ",k.to_date," (",k.leave_type,")",k.policy_id&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-1",children:["Policy: ",(Ce=y.find(O=>String(O.id)===String(k.policy_id)))==null?void 0:Ce.name]})]})]}),(a==="edit_leave"||a==="delete_leave")&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:a==="edit_leave"?"Edit Leave":"Delete Leave"}),i.jsxs("p",{className:"text-gray-700",children:[k.from_date," to ",k.to_date,k.policy_id&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-1",children:["Policy: ",(H=y.find(O=>String(O.id)===String(k.policy_id)))==null?void 0:H.name]})]})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Reason"}),i.jsx("p",{className:"text-gray-700",children:k.reason||"No reason provided"})]})]})]}),b.submit&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-red-600 text-sm",children:b.submit})}),_&&i.jsx("div",{className:"bg-green-50 p-3 border border-green-200 rounded-lg",children:i.jsx("p",{className:"text-green-700 text-sm",children:_})})]})]}),i.jsxs("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 p-4 md:p-6 flex gap-3 justify-between",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),n>1&&i.jsx("button",{type:"button",onClick:V,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Previous"})]}),i.jsxs("div",{className:"flex gap-3",children:[n<3&&a&&i.jsx("button",{type:"button",onClick:U,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Next"}),n===3&&a&&i.jsxs("button",{type:"button",onClick:ie,disabled:o,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[o?i.jsx(oi,{className:"w-4 h-4 animate-spin"}):i.jsx(Lt,{className:"w-4 h-4"}),"Apply Correction"]})]})]})]})})},dl={pending:{label:"Pending",className:"bg-amber-100 text-amber-700"},approved:{label:"Approved",className:"bg-green-100 text-green-700"},rejected:{label:"Rejected",className:"bg-red-100 text-red-700"},clarification:{label:"Clarification",className:"bg-blue-100 text-blue-700"}},WD={status:"pending",department:"",leave_policy_id:"",start_date:"",end_date:""},zD=()=>{var ne,ie,le,pe,_e;const[e,t]=E.useState([]),[n,r]=E.useState([]),[a,s]=E.useState(WD),[o,l]=E.useState(1),[c,u]=E.useState({current_page:1,last_page:1}),[d,h]=E.useState(!0),[f,p]=E.useState(null),[m,x]=E.useState(!1),[y,g]=E.useState(null),[v,w]=E.useState({comment:"",from_date:"",to_date:"",admin_reason:"",reject_choice:"reject"}),[b,N]=E.useState(!1),[_,C]=E.useState(null),[k,j]=E.useState(!1),S=E.useMemo(()=>"https://kiosk.quriousclick.es/api".replace(/\/api\/?$/,""),[]),M="https://kiosk.quriousclick.es/api",D=G=>{if(!G)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(G))return G;const re=String(G),Ce=new Date(re);if(!isNaN(Ce.getTime())){const H=Ce.getFullYear(),O=String(Ce.getMonth()+1).padStart(2,"0"),Q=String(Ce.getDate()).padStart(2,"0");return`${H}-${O}-${Q}`}return""},A=async()=>{try{const G=await Ne.getLeavePolicies();r(G||[])}catch(G){console.error("Failed to load leave policies",G)}},B=async()=>{h(!0);try{const G={page:o};a.status&&(G.status=a.status),a.department&&String(a.department).trim()!==""&&(G.department=a.department.trim()),a.leave_policy_id&&(G.leave_policy_id=a.leave_policy_id),a.start_date&&(G.start_date=a.start_date),a.end_date&&(G.end_date=a.end_date);const re=await Ne.getLeaveApprovals(G),Ce=(re.data||[]).map(H=>({...H,from_date:D(H.from_date),to_date:D(H.to_date)}));t(Ce),u({current_page:re.current_page,last_page:re.last_page})}catch(G){console.error("Failed to load leave approvals",G),C({type:"error",message:"Unable to load leave requests."})}finally{h(!1)}};E.useEffect(()=>{A()},[]),E.useEffect(()=>{l(1),B()},[a]),E.useEffect(()=>{B()},[o]),E.useEffect(()=>{if(_){const G=setTimeout(()=>{C(null)},2e3);return()=>clearTimeout(G)}},[_]);const F=async G=>{x(!0),p(null);try{const re=await Ne.getLeaveRequest(G.id),Ce={...re,from_date:D(re.from_date),to_date:D(re.to_date),timelines:(re.timelines||[]).map(H=>({...H,created_at:H.created_at}))};p(Ce)}catch(re){console.error("Failed to load leave request detail",re),C({type:"error",message:"Unable to load leave details."})}finally{x(!1)}},U=()=>{g(null),w({comment:"",from_date:"",to_date:"",admin_reason:"",reject_choice:"reject"})},V=(G,re)=>{g({type:G,request:re}),w({comment:"",from_date:D(re.from_date),to_date:D(re.to_date),admin_reason:"",reject_choice:"reject"})},P=async()=>{if(!y)return;const{type:G,request:re}=y;if(G==="approve"&&(!v.from_date||!v.to_date)){C({type:"error",message:"Please provide valid from and to dates."});return}if(G==="reject"){if(v.reject_choice==="clarify"&&!v.comment.trim()){C({type:"error",message:"Clarification comment is required."});return}if(v.reject_choice==="reject"&&!v.admin_reason.trim()){C({type:"error",message:"Rejection reason is required."});return}}N(!0);try{G==="approve"?(await Ne.approveLeaveRequest(re.id,{comment:v.comment,from_date:v.from_date,to_date:v.to_date}),C({type:"success",message:"Request approved successfully."})):G==="reject"&&(v.reject_choice==="clarify"?(await Ne.requestLeaveClarification(re.id,{comment:v.comment}),C({type:"success",message:"Clarification requested successfully."})):(await Ne.rejectLeaveRequest(re.id,{comment:v.admin_reason}),C({type:"success",message:"Request rejected successfully."}))),U(),B(),f&&f.id===re.id&&F(re)}catch(Ce){console.error("Action failed",Ce),C({type:"error",message:(Ce==null?void 0:Ce.message)||"Action failed. Please try again."})}finally{N(!1)}},$=(G,re)=>{const Ce=localStorage.getItem("authToken");if(re){const H=new URL(`${M}/leave/requests/${re}/download`);return H.searchParams.set("token",Ce),H.toString()}return G?`${S}/storage/${G}`:null},I=Object.keys(dl),q=(f==null?void 0:f.timelines)||[],X=G=>{const re=dl[G]||dl.pending;return i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${re.className}`,children:re.label})};return i.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 md:p-6",children:[i.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Leave Approvals"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Review leave requests, apply sandwich rules, and manage workflows."})]}),i.jsxs("button",{onClick:()=>j(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[i.jsx(Df,{className:"w-4 h-4"}),"Manual Leave Correction"]})]}),_&&i.jsx("div",{className:`px-4 py-3 rounded-lg text-sm font-medium ${_.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:_.message}),i.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm p-4 space-y-4",children:[i.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(G=>i.jsx("button",{onClick:()=>{s(re=>({...re,status:G}))},className:`px-4 py-2 rounded-full text-sm font-medium border transition-colors ${a.status===G?"bg-blue-600 text-white border-blue-600":"border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:dl[G].label},G))}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[i.jsx(ci,{className:"w-4 h-4 text-gray-400"}),"Department"]}),i.jsx("input",{type:"text",value:a.department,onChange:G=>{s(re=>({...re,department:G.target.value}))},placeholder:"All departments",className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[i.jsx(Ke,{className:"w-4 h-4 text-gray-400"}),"From date"]}),i.jsx("input",{type:"date",value:a.start_date,onChange:G=>{s(re=>({...re,start_date:G.target.value}))},className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[i.jsx(Ke,{className:"w-4 h-4 text-gray-400"}),"To date"]}),i.jsx("input",{type:"date",value:a.end_date,onChange:G=>{s(re=>({...re,end_date:G.target.value}))},className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 mb-1",children:[i.jsx(Rf,{className:"w-4 h-4 text-gray-400"}),"Leave type"]}),i.jsxs("select",{value:a.leave_policy_id,onChange:G=>{s(re=>({...re,leave_policy_id:G.target.value}))},className:"w-full border border-gray-200 rounded-lg px-3 py-2",children:[i.jsx("option",{value:"",children:"All leave types"}),n.map(G=>i.jsx("option",{value:G.id,children:G.name},G.id))]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"xl:col-span-2 space-y-4",children:[d?i.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-6 flex justify-center items-center",children:i.jsx(oi,{className:"w-6 h-6 animate-spin text-blue-600"})}):e.length===0?i.jsx("div",{className:"bg-white rounded-2xl border border-dashed border-gray-300 p-10 text-center text-gray-500",children:"No leave requests found for the selected filters."}):e.map(G=>{var re,Ce,H;return i.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-4 md:p-5 flex flex-col gap-3",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:((re=G.employee)==null?void 0:re.department)||"General"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:(Ce=G.employee)==null?void 0:Ce.name}),i.jsx("p",{className:"text-xs text-gray-500",children:(H=G.policy)==null?void 0:H.name})]}),X(G.status)]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm text-gray-600",children:[i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wide",children:"Dates"}),i.jsxs("p",{className:"font-semibold text-gray-800",children:[D(G.from_date),"  ",D(G.to_date)]}),i.jsxs("p",{className:"text-xs text-gray-500",children:[G.estimated_days," days"]})]}),i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wide",children:"Sandwich rule"}),i.jsx("p",{className:"font-semibold text-gray-800",children:G.sandwich_rule_applied?`${G.sandwich_applied_days} days added`:"Not applied"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Policy setting controls reset"})]}),i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1 uppercase tracking-wide",children:"Reason"}),i.jsx("p",{className:"font-semibold text-gray-800 line-clamp-2",children:G.reason||"N/A"})]})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[G.attachment_path&&i.jsxs("a",{href:$(G.attachment_path,G.id),target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-600 hover:text-blue-700",children:[i.jsx(si,{className:"w-4 h-4"}),"Attachment"]}),i.jsxs("button",{onClick:()=>F(G),className:"inline-flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900 ml-auto",children:["View timeline",i.jsx(Ef,{className:"w-4 h-4"})]})]}),G.status==="pending"&&i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs("button",{onClick:()=>V("approve",G),className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-green-50 text-green-700 hover:bg-green-100",children:[i.jsx(s_,{className:"w-4 h-4"}),"Approve"]}),i.jsxs("button",{onClick:()=>V("reject",G),className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100",children:[i.jsx(ao,{className:"w-4 h-4"}),"Reject"]})]})]},G.id)}),c.last_page>1&&i.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm p-4 flex items-center justify-between",children:[i.jsx("button",{disabled:c.current_page===1,onClick:()=>l(G=>Math.max(1,G-1)),className:"px-4 py-2 rounded-lg border text-sm font-medium disabled:opacity-50",children:"Previous"}),i.jsxs("p",{className:"text-sm text-gray-500",children:["Page ",c.current_page," of ",c.last_page]}),i.jsx("button",{disabled:c.current_page===c.last_page,onClick:()=>l(G=>G+1),className:"px-4 py-2 rounded-lg border text-sm font-medium disabled:opacity-50",children:"Next"})]})]}),i.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm p-5 sticky top-4 h-fit",children:[i.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(mn,{className:"w-5 h-5 text-blue-600"}),"Request detail"]}),m?i.jsx("div",{className:"flex items-center justify-center py-12 text-gray-500",children:i.jsx(oi,{className:"w-5 h-5 animate-spin"})}):f?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Employee"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:(ne=f.employee)==null?void 0:ne.name}),i.jsx("p",{className:"text-xs text-gray-500",children:(ie=f.employee)==null?void 0:ie.department})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-600",children:[i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Policy"}),i.jsx("p",{className:"font-semibold text-gray-900",children:(le=f.policy)==null?void 0:le.name}),i.jsx("p",{className:"text-xs text-gray-500",children:(pe=f.policy)==null?void 0:pe.code})]}),i.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Duration"}),i.jsxs("p",{className:"font-semibold text-gray-900",children:[D(f.from_date),"  ",D(f.to_date)]}),i.jsxs("p",{className:"text-xs text-gray-500",children:[f.estimated_days," days + ",f.sandwich_applied_days," sandwich"]})]})]}),i.jsxs("div",{className:"border border-gray-100 rounded-xl p-3",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Reason"}),i.jsx("p",{className:"text-sm text-gray-800",children:f.reason||"No reason provided"})]}),f.attachment_path&&i.jsxs("a",{className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700",href:$(f.attachment_path,f.id),target:"_blank",rel:"noreferrer",children:[i.jsx(si,{className:"w-4 h-4"}),"Download document"]}),i.jsxs("div",{children:[i.jsxs("p",{className:"text-xs text-gray-500 uppercase mb-2 flex items-center gap-2",children:[i.jsx(j_,{className:"w-4 h-4 text-gray-400"}),"Timeline"]}),i.jsx("div",{className:"space-y-3 max-h-72 overflow-y-auto pr-2",children:q.length===0?i.jsx("p",{className:"text-sm text-gray-500",children:"No timeline entries yet."}):q.map(G=>i.jsxs("div",{className:"border border-gray-100 rounded-xl p-3 text-sm",children:[i.jsx("p",{className:"font-semibold text-gray-800 capitalize",children:G.action.replace("_"," ")}),i.jsx("p",{className:"text-xs text-gray-500",children:new Date(G.created_at).toLocaleString()}),G.notes&&i.jsx("p",{className:"text-sm text-gray-700 mt-1",children:G.notes})]},G.id))})]})]}):i.jsx("div",{className:"text-sm text-gray-500",children:"Select a request to view its timeline & attachments."})]})]})]}),y&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg shadow-xl",children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 capitalize",children:y.type==="reject"?"Reject / Ask clarification":`${y.type} leave`}),i.jsxs("p",{className:"text-sm text-gray-500",children:["For ",(_e=y.request.employee)==null?void 0:_e.name]})]}),i.jsxs("div",{className:"px-6 py-4 space-y-4",children:[y.type==="approve"&&i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"From date"}),i.jsx("input",{type:"date",value:v.from_date,onChange:G=>w(re=>({...re,from_date:G.target.value})),className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"To date"}),i.jsx("input",{type:"date",value:v.to_date,onChange:G=>w(re=>({...re,to_date:G.target.value})),className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]})]}),y.type==="reject"&&i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Action"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("label",{className:`inline-flex items-center gap-2 px-3 py-2 border rounded-lg cursor-pointer ${v.reject_choice==="reject"?"bg-red-50 border-red-200":"bg-white"}`,children:[i.jsx("input",{type:"radio",name:"reject_choice",value:"reject",checked:v.reject_choice==="reject",onChange:G=>w(re=>({...re,reject_choice:G.target.value}))}),"Reject"]}),i.jsxs("label",{className:`inline-flex items-center gap-2 px-3 py-2 border rounded-lg cursor-pointer ${v.reject_choice==="clarify"?"bg-blue-50 border-blue-200":"bg-white"}`,children:[i.jsx("input",{type:"radio",name:"reject_choice",value:"clarify",checked:v.reject_choice==="clarify",onChange:G=>w(re=>({...re,reject_choice:G.target.value}))}),"Ask for clarification"]})]}),v.reject_choice==="reject"?i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Reason (required)"}),i.jsx("textarea",{value:v.admin_reason,onChange:G=>w(re=>({...re,admin_reason:G.target.value})),rows:3,className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]}):i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Clarification required (required)"}),i.jsx("textarea",{value:v.comment,onChange:G=>w(re=>({...re,comment:G.target.value})),rows:3,className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]})]}),y.type!=="reject"&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:"Comment"}),i.jsx("textarea",{value:v.comment,onChange:G=>w(re=>({...re,comment:G.target.value})),rows:3,placeholder:y.type==="clarify"?"Explain what details you need from the employee.":"Optional note to the employee.",className:"w-full border border-gray-200 rounded-lg px-3 py-2"})]})]}),i.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center gap-3 justify-end",children:[i.jsx("button",{onClick:U,className:"px-4 py-2 rounded-lg border text-sm font-medium text-gray-600 hover:bg-gray-50",children:"Cancel"}),i.jsx("button",{onClick:P,disabled:b,className:"px-4 py-2 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:b?"Processing...":"Submit"})]})]})}),k&&i.jsx($D,{onClose:()=>j(!1),onSuccess:()=>{j(!1),B(),C({type:"success",message:"Leave correction completed successfully."})}})]})},UD=({onClose:e,onSuccess:t,selectedEmployee:n,startDate:r,endDate:a,attendanceLogs:s})=>{var oe,ue;const[o,l]=E.useState(1),[c,u]=E.useState(""),[d,h]=E.useState(!1),[f,p]=E.useState({}),[m,x]=E.useState(""),[y,g]=E.useState(""),[v,w]=E.useState([]),[b,N]=E.useState([]),[_,C]=E.useState(""),[k,j]=E.useState(n||""),[S,M]=E.useState("today"),[D,A]=E.useState(r||""),[B,F]=E.useState(a||""),[U,V]=E.useState(s||[]),[P,$]=E.useState({date:r||"",check_in:"",check_out:"",reason:"",breaks:[],attendance_id:""}),I=[{id:"add_attendance",title:"Add New Attendance",description:"Create a new attendance record",icon:Ga},{id:"edit_attendance",title:"Edit Existing Attendance",description:"Modify an existing attendance record",icon:ca}];E.useEffect(()=>{X()},[]),E.useEffect(()=>{_?ne():(N([]),j(""))},[_]),E.useEffect(()=>{c==="edit_attendance"&&(U==null?void 0:U.length)>0&&re(U[0].id)},[c,U]);const q=()=>{$({date:r||"",check_in:"",check_out:"",reason:"",breaks:[],attendance_id:""}),p({}),x(""),g("")},X=async()=>{try{const W=await Ne.getDepartments();w(W.departments||[])}catch(W){console.error("Failed to load departments:",W),p({submit:"Failed to load departments. Please check your authentication and try again."}),setTimeout(()=>p(ae=>({...ae,submit:""})),5e3)}},ne=async()=>{try{const W=await Ne.getEmployeesByDepartment(_);N(W.employees||[])}catch(W){console.error("Failed to load employees:",W)}},ie=async()=>{if(!k||!D||!B){p({submit:"Please select employee and date range"}),setTimeout(()=>p(W=>({...W,submit:""})),2e3);return}h(!0),p({});try{const ae=(await Ne.getAttendanceLogs(k,D,B)).attendances||[];V(ae),ae.length>0?(x("Attendance logs loaded successfully"),setTimeout(()=>x(""),2e3)):(g("No logs found for the selected period"),setTimeout(()=>g(""),2e3))}catch{p({submit:"Failed to fetch attendance logs"}),setTimeout(()=>p(ae=>({...ae,submit:""})),2e3)}finally{h(!1)}},le=async W=>{if(u(W),q(),W==="edit_attendance"&&U.length===0){h(!0);try{if(await ie(),U.length===0){p({action:"No attendance records found for the selected period. Please check the date range or add a new attendance record instead."}),setTimeout(()=>p(ae=>({...ae,action:""})),3e3),u(""),h(!1);return}}catch{p({action:"Failed to fetch attendance logs. Please try again."}),setTimeout(()=>p(je=>({...je,action:""})),3e3),u(""),h(!1);return}h(!1)}l(3)},pe=()=>{o===1?l(2):o===2&&c&&l(3)},_e=()=>{o>1&&l(o-1)},G=W=>{(W<=o||W===2&&U.length>0||W===3&&c)&&l(W)},re=W=>{const ae=U.find(je=>je.id===parseInt(W));ae&&$({date:ae.date,check_in:ae.check_in||"",check_out:ae.check_out||"",reason:"",breaks:ae.breaks?ae.breaks.map(je=>({break_start:je.break_start||"",break_end:je.break_end||""})):[],attendance_id:ae.id})},Ce=()=>{$(W=>({...W,breaks:[...W.breaks||[],{break_start:"",break_end:""}]}))},H=W=>{$(ae=>({...ae,breaks:ae.breaks.filter((je,de)=>de!==W)}))},O=()=>{var ae,je;const W={};return c==="add_attendance"&&(k||(W.employee="Employee selection is required"),P.date||(W.date="Date is required"),(ae=P.reason)!=null&&ae.trim()||(W.reason="Reason is required"),P.check_in||P.check_out||P.breaks&&P.breaks.some(Le=>Le.break_start||Le.break_end)||(W.timing="At least one timing field (check-in, check-out, or break) is required")),c==="edit_attendance"&&(k||(W.employee="Employee selection is required"),P.attendance_id||(W.attendance_id="Attendance record is required"),(je=P.reason)!=null&&je.trim()||(W.reason="Reason is required"),P.check_in||P.check_out||P.breaks&&P.breaks.some(Le=>Le.break_start||Le.break_end)||(W.timing="At least one timing field (check-in, check-out, or break) is required")),p(W),Object.keys(W).length===0},Q=async()=>{if(O()){h(!0),p({}),x("");try{const W={reason:P.reason};P.check_in&&(W.check_in=P.check_in),P.check_out&&(W.check_out=P.check_out),P.breaks&&Array.isArray(P.breaks)&&(W.breaks=P.breaks.map(ae=>({break_start:ae.break_start||null,break_end:ae.break_end||null}))),c==="add_attendance"?(W.employee_id=k,W.date=P.date,await Ne.addNewAttendance(W)):c==="edit_attendance"&&await Ne.updateAttendanceRecord(P.attendance_id,W),x("Attendance updated successfully"),setTimeout(()=>{x(""),typeof t=="function"&&t(),e()},1500)}catch(W){p({submit:W.message||"Failed to update attendance"}),setTimeout(()=>p(ae=>({...ae,submit:""})),2e3)}finally{h(!1)}}};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden",children:[i.jsxs("div",{className:"flex-shrink-0 bg-white border-b border-gray-200 p-4 md:p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-900",children:"Attendance Correction Wizard"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Apply corrections to employee attendance records"})]}),i.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Mn,{className:"w-5 h-5"})})]}),i.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[1,2,3].map(W=>i.jsxs("div",{className:"flex items-center",children:[i.jsx("button",{onClick:()=>G(W),disabled:W>o&&!(W===2&&c)&&!(W===3&&c),className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors ${o>=W?"bg-blue-600 text-white":W===2&&c?"bg-blue-100 text-blue-600 border-2 border-blue-600":"bg-gray-200 text-gray-600"} ${W>o&&!(W===2&&c)&&!(W===3&&c)?"cursor-not-allowed opacity-50":"cursor-pointer hover:bg-blue-700 hover:text-white"}`,children:W}),i.jsx("span",{className:`ml-2 text-xs sm:text-sm font-medium ${o>=W?"text-blue-600":"text-gray-500"}`,children:W===1?"Emp & Date":W===2?"Select Action":"Config Details"}),W<3&&i.jsx("div",{className:`hidden sm:block w-8 sm:w-12 h-0.5 mx-2 sm:mx-4 ${o>W?"bg-blue-600":"bg-gray-300"}`})]},W))})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[o===1&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Vn,{className:"w-5 h-5 text-blue-600"}),"Employee Selection"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Department"}),i.jsxs("select",{value:_,onChange:W=>{C(W.target.value),j(""),V([])},className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select Department"}),v.map(W=>i.jsx("option",{value:W,children:W},W))]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employee"}),i.jsxs("select",{value:k,onChange:W=>{j(W.target.value),V([])},disabled:!_,className:"w-full border px-3 py-2 rounded-lg disabled:bg-gray-100",children:[i.jsx("option",{value:"",children:"Select Employee"}),b.map(W=>i.jsxs("option",{value:W.id,children:[W.name," (",W.employee_id,")"]},W.id))]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date Range"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"radio",id:"wizard-today",name:"wizard-dateRange",value:"today",checked:S==="today",onChange:W=>{M(W.target.value);const ae=new Date().toISOString().split("T")[0];A(ae),F(ae)}}),i.jsx("label",{htmlFor:"wizard-today",className:"text-sm",children:"Today"}),i.jsx("input",{type:"radio",id:"wizard-custom",name:"wizard-dateRange",value:"custom",checked:S==="custom",onChange:W=>{M(W.target.value),A(""),F("")}}),i.jsx("label",{htmlFor:"wizard-custom",className:"text-sm",children:"Custom"})]})]})]}),S==="custom"&&i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),i.jsx("input",{type:"date",value:D,onChange:W=>A(W.target.value),className:"w-full border px-3 py-2 rounded-lg"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Date"}),i.jsx("input",{type:"date",value:B,onChange:W=>F(W.target.value),className:"w-full border px-3 py-2 rounded-lg"})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsxs("button",{onClick:ie,disabled:!k||!D||!B||d,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[d&&i.jsx(oi,{className:"w-4 h-4 animate-spin"}),"Fetch Attendance Logs"]}),f.employee&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.employee})]}),y&&i.jsx("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:i.jsx("p",{className:"text-sm text-orange-800",children:y})})]}),U.length>0&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Ke,{className:"w-5 h-5 text-green-600"}),"Attendance Records (",U.length,")"]}),i.jsx("div",{className:"max-h-60 overflow-y-auto",children:i.jsx("div",{className:"space-y-2",children:U.map(W=>{const ae=je=>{if(!je)return"";const de=new Date(je),Le=String(de.getDate()).padStart(2,"0"),qe=String(de.getMonth()+1).padStart(2,"0"),Oe=de.getFullYear();return`${Le}-${qe}-${Oe}`};return i.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),i.jsx("span",{className:"font-medium text-gray-900",children:ae(W.date)})]}),i.jsxs("div",{className:"text-sm text-gray-600",children:[W.check_in||"No check-in"," - ",W.check_out||"No check-out"]})]}),W.breaks&&W.breaks.length>0&&i.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[i.jsx("span",{className:"font-medium",children:"Breaks:"})," ",W.breaks.map((je,de)=>i.jsxs("span",{children:[je.break_start||"??:??"," - ",je.break_end||"??:??",de<W.breaks.length-1?", ":""]},de))]})]},W.id)})})})]})]}),o===2&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(vt,{className:"w-5 h-5 text-blue-600"}),"Select Correction Type"]}),f.action&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg mb-4",children:i.jsx("p",{className:"text-red-600 text-sm",children:f.action})}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:I.map(W=>{const ae=W.icon;return i.jsx("button",{onClick:()=>!d&&le(W.id),disabled:d,className:`p-4 border rounded-lg text-left transition-colors ${d?"bg-gray-100 border-gray-200 cursor-not-allowed opacity-50":c===W.id?"bg-blue-50 border-blue-300 hover:bg-blue-50":"bg-white border-gray-200 hover:bg-blue-50"}`,children:i.jsxs("div",{className:"flex gap-3",children:[i.jsx(ae,{className:`w-6 h-6 ${c===W.id?"text-blue-600":"text-gray-600"}`}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-900",children:W.title}),i.jsx("p",{className:"text-sm text-gray-600",children:W.description})]})]})},W.id)})})]}),o===3&&c&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Vn,{className:"w-5 h-5 text-blue-600"}),"Employee Selection"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Department"}),i.jsxs("select",{value:_,onChange:W=>{C(W.target.value),j(""),V([])},className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select Department"}),v.map(W=>i.jsx("option",{value:W,children:W},W))]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employee"}),i.jsxs("select",{value:k,onChange:W=>{j(W.target.value),V([])},disabled:!_,className:"w-full border px-3 py-2 rounded-lg disabled:bg-gray-100",children:[i.jsx("option",{value:"",children:"Select Employee"}),b.map(W=>i.jsxs("option",{value:W.id,children:[W.name," (",W.employee_id,")"]},W.id))]})]})]}),U.length>0&&i.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:i.jsxs("p",{className:"text-sm text-green-800",children:["Found ",U.length," attendance record(s) for the selected period"]})})]}),c==="add_attendance"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Ke,{className:"w-5 h-5 text-green-600"}),"Attendance Date"]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date *"}),i.jsx("input",{type:"date",value:P.date,onChange:W=>$(ae=>({...ae,date:W.target.value})),className:"w-full border px-3 py-2 rounded-lg"}),f.date&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.date})]})})]}),c==="edit_attendance"&&i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(mn,{className:"w-5 h-5 text-indigo-600"}),"Select Attendance Record"]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attendance Record *"}),i.jsxs("select",{value:P.attendance_id,onChange:W=>re(W.target.value),className:"w-full border px-3 py-2 rounded-lg",children:[i.jsx("option",{value:"",children:"Select attendance record"}),U.map(W=>{const ae=je=>{if(!je)return"";const de=new Date(je),Le=String(de.getDate()).padStart(2,"0"),qe=String(de.getMonth()+1).padStart(2,"0"),Oe=de.getFullYear();return`${Le}-${qe}-${Oe}`};return i.jsxs("option",{value:W.id,children:[ae(W.date)," - ",W.check_in||"No check-in"," to ",W.check_out||"No check-out"]},W.id)})]}),f.attendance_id&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.attendance_id})]})})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(He,{className:"w-5 h-5 text-blue-600"}),"Timing Details"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Check In"}),i.jsx("input",{type:"time",value:P.check_in,onChange:W=>$(ae=>({...ae,check_in:W.target.value})),className:"w-full border px-3 py-2 rounded-lg"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Check Out"}),i.jsx("input",{type:"time",value:P.check_out,onChange:W=>$(ae=>({...ae,check_out:W.target.value})),className:"w-full border px-3 py-2 rounded-lg"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Breaks"}),i.jsxs("div",{className:"space-y-3",children:[(P.breaks||[]).map((W,ae)=>i.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg border border-gray-200",children:[i.jsx("input",{type:"time",value:W.break_start,onChange:je=>{const de=[...P.breaks];de[ae].break_start=je.target.value,$(Le=>({...Le,breaks:de}))},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Start time"}),i.jsx("span",{className:"text-gray-500",children:"-"}),i.jsx("input",{type:"time",value:W.break_end,onChange:je=>{const de=[...P.breaks];de[ae].break_end=je.target.value,$(Le=>({...Le,breaks:de}))},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"End time"}),i.jsx("button",{onClick:()=>H(ae),className:"text-red-500 hover:text-red-700 transition-colors p-1",type:"button",children:i.jsx(Mn,{className:"w-4 h-4"})})]},ae)),i.jsxs("button",{onClick:Ce,className:"text-indigo-600 hover:text-indigo-800 transition-colors flex items-center gap-2 text-sm font-medium",type:"button",children:[i.jsx(Ga,{className:"w-4 h-4"}),"Add Break"]})]})]}),f.timing&&i.jsx("p",{className:"text-red-600 text-sm",children:f.timing})]})]}),i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50 mb-6",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(mn,{className:"w-5 h-5 text-purple-600"}),"Correction Reason"]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason *"}),i.jsx("textarea",{value:P.reason,onChange:W=>$(ae=>({...ae,reason:W.target.value})),rows:4,className:"w-full border px-3 py-2 rounded-lg",placeholder:"Please explain the reason for this attendance correction"}),f.reason&&i.jsx("p",{className:"text-red-600 text-sm mt-1",children:f.reason})]})})]}),f.submit&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg mb-6",children:i.jsx("p",{className:"text-red-600 text-sm",children:f.submit})}),m&&i.jsx("div",{className:"bg-green-50 p-3 border border-green-200 rounded-lg mb-6",children:i.jsx("p",{className:"text-green-700 text-sm",children:m})})]}),o===3&&c&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 md:p-6 bg-gray-50",children:[i.jsxs("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Lt,{className:"w-5 h-5 text-green-600"}),"Review Your Changes"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Correction Type"}),i.jsx("p",{className:"text-gray-700",children:(oe=I.find(W=>W.id===c))==null?void 0:oe.title})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Employee"}),i.jsx("p",{className:"text-gray-700",children:((ue=b.find(W=>String(W.id)===String(k)))==null?void 0:ue.name)||"Not selected"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Date"}),i.jsx("p",{className:"text-gray-700",children:P.date||"Not specified"})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Date Range"}),i.jsxs("p",{className:"text-gray-700",children:[D," to ",B]})]})]}),c==="add_attendance"&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"New Attendance Entry"}),i.jsxs("p",{className:"text-gray-700",children:["Check-in: ",P.check_in||"Not specified",i.jsx("br",{}),"Check-out: ",P.check_out||"Not specified",P.breaks&&P.breaks.length>0&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-2",children:["Breaks: ",P.breaks.filter(W=>W.break_start||W.break_end).length," break(s)"]})]})]}),c==="edit_attendance"&&i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Edit Existing Attendance"}),i.jsxs("p",{className:"text-gray-700",children:["Check-in: ",P.check_in||"Not specified",i.jsx("br",{}),"Check-out: ",P.check_out||"Not specified",P.breaks&&P.breaks.length>0&&i.jsxs("span",{className:"block text-sm text-gray-600 mt-2",children:["Breaks: ",P.breaks.filter(W=>W.break_start||W.break_end).length," break(s)"]})]})]}),i.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[i.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Reason"}),i.jsx("p",{className:"text-gray-700",children:P.reason||"No reason provided"})]})]})]}),f.submit&&i.jsx("div",{className:"bg-red-50 p-3 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-red-600 text-sm",children:f.submit})}),m&&i.jsx("div",{className:"bg-green-50 p-3 border border-green-200 rounded-lg",children:i.jsx("p",{className:"text-green-700 text-sm",children:m})})]})]}),i.jsxs("div",{className:"flex-shrink-0 bg-white border-t border-gray-200 p-4 md:p-6 flex gap-3 justify-between",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),o>1&&i.jsx("button",{type:"button",onClick:_e,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Previous"})]}),i.jsxs("div",{className:"flex gap-3",children:[o===1&&i.jsx("button",{type:"button",onClick:pe,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Continue"}),o===2&&c&&i.jsx("button",{type:"button",onClick:pe,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Next"}),o===3&&c&&i.jsxs("button",{type:"button",onClick:Q,disabled:d,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[d?i.jsx(oi,{className:"w-4 h-4 animate-spin"}):i.jsx(Lt,{className:"w-4 h-4"}),"Apply Correction"]})]})]})]})})},VD=()=>{const[e,t]=E.useState([]),[n,r]=E.useState(!0),[a,s]=E.useState(null),[o,l]=E.useState("pending"),[c,u]=E.useState({show:!1,type:"success",message:""}),[d,h]=E.useState(!1),[f,p]=E.useState(null),[m,x]=E.useState({check_in:"",check_out:"",reason:""});E.useEffect(()=>{if(!localStorage.getItem("authToken")){u({show:!0,type:"error",message:"Authentication required. Please log in again."});return}y()},[o]),E.useEffect(()=>{if(c.show){const N=setTimeout(()=>{u({show:!1,type:"success",message:""})},2e3);return()=>clearTimeout(N)}},[c.show]);const y=async()=>{r(!0);try{const N=await Ne.get(`/admin/correction-requests?status=${o}`);t(N.requests||[])}catch(N){console.error("Error loading correction requests:",N),N.message&&N.message.includes("Authentication")?(u({show:!0,type:"error",message:"Authentication failed. Please log in again."}),localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("isAuthenticated"),setTimeout(()=>{window.location.href="/login"},2e3)):N.message&&N.message.includes("permission")?u({show:!0,type:"error",message:"You do not have permission to access this resource."}):N.message&&N.message.includes("Server error")?u({show:!0,type:"error",message:"Server error. Please try again later."}):u({show:!0,type:"error",message:N.message||"Failed to load correction requests"})}finally{r(!1)}},g=async N=>{s(N);try{await Ne.post(`/admin/correction-requests/${N}/approve`),u({show:!0,type:"success",message:"Correction request approved successfully"}),y()}catch(_){u({show:!0,type:"error",message:_.message||"An error occurred while approving request"})}finally{s(null)}},v=async N=>{s(N);try{await Ne.post(`/admin/correction-requests/${N}/reject`),u({show:!0,type:"success",message:"Correction request rejected successfully"}),y()}catch(_){u({show:!0,type:"error",message:_.message||"An error occurred while rejecting request"})}finally{s(null)}},w=()=>{const N=[];if(!m.check_in&&!m.check_out&&N.push("At least one time field (check-in or check-out) must be provided"),m.check_in){const[_,C]=m.check_in.split(":").map(Number);(_<0||_>23||C<0||C>59)&&N.push("Invalid check-in time format")}if(m.check_out){const[_,C]=m.check_out.split(":").map(Number);(_<0||_>23||C<0||C>59)&&N.push("Invalid check-out time format")}return m.check_in&&m.check_out&&m.check_out<=m.check_in&&N.push("Check-out time must be after check-in time"),m.reason.trim()?m.reason.trim().length<10?N.push("Reason must be at least 10 characters long"):m.reason.trim().length>500&&N.push("Reason cannot exceed 500 characters"):N.push("Reason for edit is required"),N},b=async N=>{N.preventDefault();const _=w();if(_.length>0){u({show:!0,type:"error",message:`Validation errors: ${_.join(", ")}`});return}s("edit");try{const C={check_in:m.check_in||null,check_out:m.check_out||null,reason:m.reason.trim()};await Ne.put(`/admin/attendance/${f.id}`,C),u({show:!0,type:"success",message:"Attendance record updated successfully"}),p(null),x({check_in:"",check_out:"",reason:""}),y()}catch(C){console.error("Error updating attendance:",C),C.message&&C.message.includes("Validation error")?u({show:!0,type:"error",message:C.message}):C.message&&C.message.includes("not found")?u({show:!0,type:"error",message:"Attendance record not found"}):C.message&&C.message.includes("exists")?u({show:!0,type:"error",message:"Another attendance record exists for this time slot"}):C.name==="TypeError"&&C.message.includes("fetch")?u({show:!0,type:"error",message:"Network error. Please check your connection and try again."}):u({show:!0,type:"error",message:C.message||"An error occurred while updating attendance. Please try again."})}finally{s(null)}};return i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Attendance Correction Requests"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Manage employee attendance correction requests"})]}),i.jsx("div",{className:"flex items-center gap-4",children:i.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium",children:[i.jsx(Df,{className:"w-4 h-4"}),i.jsx("span",{children:"Admin Attendance Correction"})]})})]}),c.show&&i.jsx("div",{className:`px-4 py-3 rounded-lg text-sm font-medium ${c.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:c.message}),f&&i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(tg,{className:"w-5 h-5 text-gray-600"}),"Edit Attendance Record"]}),i.jsxs("form",{onSubmit:b,className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(He,{className:"w-4 h-4 text-gray-500"}),"Check-in Time"]}),i.jsx("input",{type:"time",value:m.check_in,onChange:N=>x({...m,check_in:N.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(He,{className:"w-4 h-4 text-gray-500"}),"Check-out Time"]}),i.jsx("input",{type:"time",value:m.check_out,onChange:N=>x({...m,check_out:N.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(mn,{className:"w-4 h-4 text-gray-500"}),"Reason for Edit"]}),i.jsx("textarea",{value:m.reason,onChange:N=>x({...m,reason:N.target.value}),rows:4,className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors resize-none",placeholder:"Please explain the reason for editing this attendance record",required:!0})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:i.jsxs("div",{className:"flex space-x-3",children:[i.jsxs("button",{type:"button",onClick:()=>p(null),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",children:[i.jsx(ao,{className:"w-4 h-4"}),"Cancel"]}),i.jsx("button",{type:"submit",disabled:a==="edit",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:a==="edit"?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(tg,{className:"w-4 h-4"}),"Update Attendance"]})})]})})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow",children:[i.jsx("div",{className:"border-b border-gray-200",children:i.jsx("nav",{className:"flex space-x-4 md:space-x-8 px-4 md:px-6 overflow-x-auto",children:[{id:"pending",label:"Pending"},{id:"approved",label:"Approved"},{id:"rejected",label:"Rejected"},{id:"all",label:"All"}].map(N=>i.jsx("button",{onClick:()=>l(N.id),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${o===N.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:N.label},N.id))})}),i.jsx("div",{className:"p-6",children:n?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"}),i.jsx("p",{className:"text-gray-500 mt-2",children:"Loading requests..."})]}):e.length===0?i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-gray-500",children:"No correction requests found."})}):i.jsx("div",{className:"space-y-4",children:e.map(N=>i.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-900",children:N.employee.name}),i.jsx("span",{className:"text-sm text-gray-500",children:N.employee.employee_id}),i.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${N.status==="approved"?"bg-green-100 text-green-800":N.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:N.status})]}),i.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Request Type"}),i.jsx("p",{className:"font-medium text-gray-900 capitalize",children:N.type?N.type.replace("_"," "):"Type not specified"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Submitted"}),i.jsx("p",{className:"font-medium text-gray-900",children:N.submitted_at})]}),N.type!=="wrong_break"&&(N.requested_check_in||N.requested_check_out)&&i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Requested Times"}),i.jsxs("p",{className:"font-medium text-gray-900",children:[N.requested_check_in||"N/A"," - ",N.requested_check_out||"N/A"]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Requested Breaks"}),N.requested_breaks&&Array.isArray(N.requested_breaks)&&N.requested_breaks.length>0?i.jsx("div",{className:"space-y-1",children:N.requested_breaks.map((_,C)=>i.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:["Break ",C+1,": ",(_==null?void 0:_.break_start)||"N/A"," - ",(_==null?void 0:_.break_end)||"N/A"]},C))}):i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"No breaks requested"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Current Breaks"}),N.attendance&&N.attendance.breaks&&Array.isArray(N.attendance.breaks)&&N.attendance.breaks.length>0?i.jsx("div",{className:"space-y-1",children:N.attendance.breaks.map((_,C)=>i.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:["Break ",C+1,": ",(_==null?void 0:_.break_start)||"N/A"," - ",(_==null?void 0:_.break_end)||"N/A"]},C))}):i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"No breaks"})]}),N.attendance&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Current Attendance"}),i.jsxs("p",{className:"font-medium text-gray-900",children:[N.attendance.check_in||"N/A"," - ",N.attendance.check_out||"N/A"]})]}),N.attendance&&i.jsxs("div",{children:[i.jsx("p",{className:"text-gray-500",children:"Current Breaks"}),N.attendance.breaks&&Array.isArray(N.attendance.breaks)&&N.attendance.breaks.length>0?i.jsx("div",{className:"space-y-1",children:N.attendance.breaks.map((_,C)=>i.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:["Break ",C+1,": ",(_==null?void 0:_.break_start)||"N/A"," - ",(_==null?void 0:_.break_end)||"N/A"]},C))}):i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:"No breaks"})]})]})]}),i.jsxs("div",{className:"mt-3",children:[i.jsx("p",{className:"text-gray-500 text-sm",children:"Reason"}),i.jsx("p",{className:"text-gray-900 mt-1",children:N.reason})]})]}),N.status==="pending"&&i.jsxs("div",{className:"flex space-x-2 ml-4",children:[i.jsx("button",{onClick:()=>g(N.id),disabled:a===N.id,className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 disabled:opacity-50",children:a===N.id?"Approving...":"Approve"}),i.jsx("button",{onClick:()=>v(N.id),disabled:a===N.id,className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 disabled:opacity-50",children:a===N.id?"Rejecting...":"Reject"})]})]})},N.id))})})]}),d&&i.jsx(UD,{onClose:()=>h(!1),onSuccess:()=>{h(!1),y()},selectedEmployee:"",startDate:"",endDate:"",attendanceLogs:[]})]})})},qD="https://kiosk.quriousclick.es/api",ad="employeeAuthToken";class HD{constructor(){this.baseURL=qD}get token(){return localStorage.getItem(ad)}set token(t){t?localStorage.setItem(ad,t):localStorage.removeItem(ad)}async request(t,n={}){const r=`${this.baseURL}${t}`,a={Accept:"application/json",...n.headers||{}};n.body instanceof FormData||(a["Content-Type"]="application/json"),this.token&&(a.Authorization=`Bearer ${this.token}`);const o=await fetch(r,{...n,headers:a});if(!o.ok){let l;try{l=await o.json()}catch{l={message:"Something went wrong."}}throw l}return n.responseType==="blob"?o.blob():o.json()}async login(t){const n=await this.request("/employee/login",{method:"POST",body:JSON.stringify(t)});return this.token=n.token,localStorage.setItem("employeeProfile",JSON.stringify(n.employee)),n}async logout(){try{await this.request("/employee/logout",{method:"POST"})}finally{this.token=null,localStorage.removeItem("employeeProfile")}}async requestPasswordOtp(t){return this.request("/employee/password/otp",{method:"POST",body:JSON.stringify({email:t})})}async resetPassword(t){return this.request("/employee/password/reset",{method:"POST",body:JSON.stringify(t)})}async getProfile(){return this.request("/employee/portal/profile")}async updateProfile(t){const n=t instanceof FormData;return this.request("/employee/portal/profile",{method:"PUT",body:n?t:JSON.stringify(t)})}async changePassword(t){return this.request("/employee/portal/change-password",{method:"POST",body:JSON.stringify(t)})}async getDashboard(){return this.request("/employee/portal/dashboard")}async getLeaveBalances(){return this.request("/employee/portal/leave-balances")}async getAttendanceReport(t={}){const n=new URLSearchParams(t).toString(),r=n?`/employee/portal/attendance?${n}`:"/employee/portal/attendance";return this.request(r)}async exportAttendanceReport(t={}){const n=new URLSearchParams(t).toString(),r=n?`/employee/portal/attendance/export?${n}`:"/employee/portal/attendance/export";return this.request(r,{responseType:"blob"})}async getLeaveRequests(t={}){const n=new URLSearchParams(t).toString(),r=n?`/leave/requests?${n}`:"/leave/requests";return this.request(r)}async createLeaveRequest(t){return this.request("/leave/requests",{method:"POST",body:t})}async cancelLeaveRequest(t){return this.request(`/leave/requests/${t}/cancel`,{method:"POST"})}async getHolidays(t=new Date().getFullYear()){return this.request(`/employee/portal/holidays?year=${t}`)}async submitCorrectionRequest(t){return this.request("/employee/portal/correction-requests",{method:"POST",body:JSON.stringify(t)})}async getCorrectionRequests(){return this.request("/employee/portal/correction-requests")}async respondToClarification(t,n){return this.request(`/employee/portal/leave/requests/${t}/respond-clarification`,{method:"POST",body:JSON.stringify(n)})}}const ut=new HD,GD=()=>{const e=Yn(),[t,n]=E.useState(""),[r,a]=E.useState(""),[s,o]=E.useState(!1),[l,c]=E.useState(""),[u,d]=E.useState(!1),[h,f]=E.useState(""),[p,m]=E.useState(!1),[x,y]=E.useState(""),[g,v]=E.useState(""),[w,b]=E.useState(""),[N,_]=E.useState(""),[C,k]=E.useState(""),[j,S]=E.useState(!1);E.useEffect(()=>{localStorage.getItem("employeeAuthToken")&&e("/employee/dashboard",{replace:!0})},[e]);const M=async B=>{B.preventDefault(),c(""),d(!0);try{await ut.login({identifier:t,password:r}),e("/employee/dashboard")}catch(F){c((F==null?void 0:F.message)||"Invalid credentials. Please try again.")}finally{d(!1)}},D=async()=>{k(""),_("");try{await ut.requestPasswordOtp(h),m(!0),_("OTP sent! Check your email (valid for 10 minutes).")}catch(B){k((B==null?void 0:B.message)||"Unable to send OTP. Please try again.")}},A=async()=>{if(k(""),_(""),g!==w){k("Passwords do not match.");return}try{await ut.resetPassword({email:h,otp:x,password:g,password_confirmation:w}),_("Password updated. You can now log in."),m(!1),y(""),v(""),b("")}catch(B){k((B==null?void 0:B.message)||"Failed to reset password. Check your OTP.")}};return i.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 flex items-center justify-center p-4 overflow-y-auto",children:[i.jsx("div",{className:"absolute top-4 left-4",children:i.jsx("button",{onClick:()=>e("/"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 font-medium transition-colors",children:" Back to Kiosk"})}),i.jsxs("div",{className:"max-w-md w-full",children:[i.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-blue-500 rounded-2xl flex items-center justify-center mx-auto mb-4",children:i.jsx(ii,{className:"w-8 h-8 text-white"})}),i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Employee Login"}),i.jsx("p",{className:"text-gray-600",children:"Access your employee portal"})]}),i.jsxs("form",{className:"space-y-6",onSubmit:M,children:[l&&i.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:i.jsxs("div",{className:"flex",children:[i.jsx(vt,{className:"h-5 w-5 text-red-400"}),i.jsx("div",{className:"ml-3",children:i.jsx("p",{className:"text-sm text-red-700",children:l})})]})}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"identifier",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email or Employee ID"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Vn,{className:"h-5 w-5 text-gray-400"})}),i.jsx("input",{id:"identifier",name:"identifier",type:"text",autoComplete:"username",required:!0,value:t,onChange:B=>n(B.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",placeholder:"e.g. EMP001 or you@email.com"})]})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ii,{className:"h-5 w-5 text-gray-400"})}),i.jsx("input",{id:"password",name:"password",type:s?"text":"password",autoComplete:"current-password",required:!0,value:r,onChange:B=>a(B.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",placeholder:"Enter your portal password"}),i.jsx("button",{type:"button",onClick:()=>o(!s),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:i.jsx(P0,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})]}),i.jsx("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 disabled:from-gray-400 disabled:to-gray-400 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-[1.02] disabled:scale-100 disabled:cursor-not-allowed",children:u?i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing In..."]}):"Sign In"})]}),i.jsx("button",{className:"mt-4 w-full text-sm text-green-600 hover:text-green-800 font-medium",onClick:()=>S(B=>!B),children:j?"Hide password reset":"Forgot password?"}),j&&i.jsxs("div",{className:"mt-6 border border-gray-200 rounded-lg p-4 space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[i.jsx(Wn,{className:"w-4 h-4 text-green-500"}),"Password reset via email OTP"]}),i.jsx("input",{type:"email",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Your registered email",value:h,onChange:B=>f(B.target.value)}),i.jsx("button",{type:"button",onClick:D,className:"w-full border border-green-200 text-green-600 hover:bg-green-50 rounded-lg py-2 text-sm font-semibold",children:"Send OTP"}),p&&i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"text",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter 6-digit OTP",value:x,onChange:B=>y(B.target.value)}),i.jsx("input",{type:"password",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"New password",value:g,onChange:B=>v(B.target.value)}),i.jsx("input",{type:"password",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Confirm new password",value:w,onChange:B=>b(B.target.value)}),i.jsx("button",{type:"button",onClick:A,className:"w-full bg-green-600 text-white rounded-lg py-2 text-sm font-semibold hover:bg-green-700",children:"Reset Password"})]}),N&&i.jsx("p",{className:"text-xs text-green-600",children:N}),C&&i.jsxs("p",{className:"text-xs text-red-600 flex items-center gap-1",children:[i.jsx(vt,{className:"w-3 h-3"}),C]})]})]}),i.jsx("div",{className:"text-center mt-6",children:i.jsx("p",{className:"text-sm text-gray-500",children:"Attendance Kiosk System v1.0"})})]})]})},t1=E.createContext(null),eu=()=>Cs.useContext(t1),cv=[{label:"Dashboard",path:"/employee/dashboard",icon:N_},{label:"Leave",path:"/employee/leaves",icon:XN},{label:"Attendance",path:"/employee/attendance",icon:VN},{label:"Profile",path:"/employee/profile",icon:u_}],KD=()=>{const e=localStorage.getItem("employeeAuthToken"),[t,n]=E.useState(()=>{const p=localStorage.getItem("employeeProfile");return p?JSON.parse(p):null}),[r,a]=E.useState(!0),[s,o]=E.useState(!1),l=Yn(),c=Pr(),u=p=>c.pathname===p||c.pathname.startsWith(`${p}/`),d=E.useCallback(async()=>{if(e){a(!0);try{const p=await ut.getProfile();n(p),localStorage.setItem("employeeProfile",JSON.stringify(p))}catch(p){console.error("Failed to load employee profile",p),(p==null?void 0:p.status)===401&&(await ut.logout(),l("/employee/login",{replace:!0}))}finally{a(!1)}}},[e,l]);E.useEffect(()=>{e&&d()},[e,d]);const h=async()=>{await ut.logout(),l("/employee/login")},f=E.useMemo(()=>({profile:t,setProfile:n,refreshProfile:d}),[t,d]);return e?r&&!t?i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"h-12 w-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-gray-500 text-sm",children:"Loading your portal..."})]})}):i.jsx(t1.Provider,{value:f,children:i.jsxs("div",{className:"min-h-screen bg-gray-50",children:[i.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-3 shadow-sm sticky top-0 z-50",children:[i.jsx("div",{className:"max-w-7xl mx-auto",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h1",{className:"text-base md:text-lg font-semibold text-gray-900",children:"Employee Portal"}),i.jsxs("span",{className:"hidden md:inline-block text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["Logged in as ",(t==null?void 0:t.name)||"Employee"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"hidden lg:flex items-center gap-2",children:[cv.map(p=>{const m=p.icon,x=u(p.path);return i.jsxs(Fa,{to:p.path,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[i.jsx(m,{className:"w-4 h-4"}),i.jsx("span",{children:p.label})]},p.path)}),i.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),i.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[i.jsx(Ks,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]}),i.jsx("button",{className:"lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors ml-auto",onClick:()=>o(!s),children:s?i.jsx(Mn,{className:"w-6 h-6"}):i.jsx(F0,{className:"w-6 h-6"})})]})]})}),s&&i.jsxs("div",{className:"lg:hidden mt-4 space-y-2",children:[i.jsx("hr",{className:"border-gray-200"}),i.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:cv.map(p=>{const m=p.icon,x=u(p.path);return i.jsxs(Fa,{to:p.path,onClick:()=>o(!1),className:`flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium transition-colors
                        ${x?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[i.jsx(m,{className:"w-4 h-4"}),i.jsx("span",{children:p.label})]},p.path)})}),i.jsxs("button",{onClick:async()=>{await h(),o(!1)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg text-sm font-medium bg-red-50 text-red-700 hover:bg-red-100 transition-colors",children:[i.jsx(Ks,{className:"w-4 h-4"}),i.jsx("span",{children:"Logout"})]})]})]}),i.jsx("main",{className:"max-w-7xl mx-auto px-2 py-2",children:i.jsx(kN,{})})]})}):i.jsx(Sf,{to:"/employee/login",replace:!0,state:{from:c}})},uv={present:"text-green-600 bg-green-50",absent:"text-red-600 bg-red-50",late:"text-amber-600 bg-amber-50",default:"text-gray-600 bg-gray-100"},XD=()=>{var m,x,y,g,v,w;const{profile:e}=eu(),t=Yn(),[n,r]=E.useState(null),[a,s]=E.useState(!0),[o,l]=E.useState(""),[c,u]=E.useState(new Date);E.useEffect(()=>{(async()=>{try{const N=await ut.getDashboard();r(N)}catch(N){l((N==null?void 0:N.message)||"Unable to load dashboard.")}finally{s(!1)}})()},[]),E.useEffect(()=>{const b=setInterval(()=>{u(new Date)},1e3);return()=>clearInterval(b)},[]);const d=()=>c.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),h=()=>c.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),f=b=>{if(!b||b===0)return"0 h 0 min";const N=Math.round(b*60),_=Math.floor(N/60),C=N%60;return`${_} h ${C} min`},p=b=>{if(!b)return"";const N=new Date(b),_=String(N.getDate()).padStart(2,"0"),C=String(N.getMonth()+1).padStart(2,"0"),k=N.getFullYear();return`${_}-${C}-${k}`};return a?i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-8 text-center",children:[i.jsx("div",{className:"h-10 w-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Preparing your dashboard..."})]}):o?i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-sm text-red-600 flex items-center gap-2",children:[i.jsx(vt,{className:"w-4 h-4"}),o]}):(uv[(m=n==null?void 0:n.today)==null?void 0:m.status]||uv.default,i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Employee Dashboard"}),i.jsxs("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:["Welcome back, ",e==null?void 0:e.name]})]}),i.jsxs("div",{className:"text-left md:text-right",children:[i.jsx("div",{className:"text-xl md:text-2xl font-bold text-gray-900",children:d()}),i.jsx("div",{className:"text-xs md:text-sm text-gray-600",children:h()})]})]}),o&&i.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:i.jsx("p",{className:"text-red-600",children:o})}),a&&i.jsx("div",{className:"fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),i.jsx("p",{className:"text-gray-600",children:"Loading dashboard data..."})]})}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8",children:[i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Today's Attendance Status"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:((x=n==null?void 0:n.today)==null?void 0:x.status)||"Pending"}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:(y=n==null?void 0:n.today)!=null&&y.check_in?"Checked In":"Not Checked In"})})]}),i.jsx("div",{className:"bg-green-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Lt,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Hours worked this week"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:f(n==null?void 0:n.weekly_hours)}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Current week hours"})})]}),i.jsx("div",{className:"bg-blue-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(He,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Leave Requests"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:((g=n==null?void 0:n.pending_leaves)==null?void 0:g.length)??0}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Awaiting Approval"})})]}),i.jsx("div",{className:"bg-yellow-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Ke,{className:"w-6 h-6 text-white"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Profile Status"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2 capitalize",children:(e==null?void 0:e.status)||"Active"}),i.jsx("div",{className:"flex items-center gap-2 mt-2",children:i.jsx("span",{className:"text-xs font-medium text-gray-600",children:e==null?void 0:e.designation})})]}),i.jsx("div",{className:"bg-purple-500 w-12 h-12 rounded-lg flex items-center justify-center",children:i.jsx(Vn,{className:"w-6 h-6 text-white"})})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:[i.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("div",{className:"flex items-center justify-between mb-6",children:i.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),"Recent Activities"]})}),i.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[(v=n==null?void 0:n.last_check_ins)==null?void 0:v.map(b=>{var N;return i.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:((N=e==null?void 0:e.name)==null?void 0:N.split(" ").map(_=>_[0]).join("").toUpperCase())||"U"}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:(e==null?void 0:e.name)||"You"}),i.jsx("p",{className:"text-xs text-gray-500",children:new Date(b.time).toLocaleString()})]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${b.action==="Check-In"?"bg-green-100 text-green-700":b.action==="Check-Out"?"bg-gray-100 text-gray-700":b.action==="Break Start"?"bg-yellow-100 text-yellow-700":(b.action==="Break End","bg-blue-100 text-blue-700")}`,children:b.action})]},b.id)}),(!(n!=null&&n.last_check_ins)||n.last_check_ins.length===0)&&i.jsx("p",{className:"text-xs text-gray-500",children:"No recent activities yet."})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Pending Leave Requests"}),i.jsxs("div",{className:"space-y-4",children:[(w=n==null?void 0:n.pending_leaves)==null?void 0:w.map(b=>i.jsxs("div",{className:"border border-gray-100 rounded-lg p-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:b.policy_name||"Leave"}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[p(b.from_date),"  ",p(b.to_date)," - ",b.days," day",b.days>1?"s":""]})]},b.id)),(!(n!=null&&n.pending_leaves)||n.pending_leaves.length===0)&&i.jsx("p",{className:"text-xs text-gray-500",children:"You have no pending leave requests."})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 mb-4 md:mb-6",children:"Quick Actions"}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[i.jsxs("button",{onClick:()=>t("/employee/leaves"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left",children:[i.jsx(Ke,{className:"w-6 h-6 text-blue-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Leave Dashboard"})]}),i.jsxs("button",{onClick:()=>t("/employee/attendance"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-left",children:[i.jsx(ah,{className:"w-6 h-6 text-green-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"View My Attendance Report"})]}),i.jsxs("button",{onClick:()=>t("/employee/profile"),className:"p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-colors text-left",children:[i.jsx(Vn,{className:"w-6 h-6 text-purple-600 mb-2"}),i.jsx("p",{className:"text-sm font-medium text-gray-900",children:"My Profile"})]})]})]})]})}))},YD=()=>{eu(),Yn();const[e,t]=E.useState(null),[n,r]=E.useState(!0),[a,s]=E.useState(""),[o,l]=E.useState(null),[c,u]=E.useState(null),[d,h]=E.useState(""),[f,p]=E.useState(!1),m=j=>{if(!j)return"";const S=new Date(j);return Number.isNaN(S.getTime())?j:S.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})},x=(j,S)=>{const M=m(j),D=m(S);return`${M}  ${D}`};E.useEffect(()=>{(async()=>{try{const S=await ut.getDashboard();t(S)}catch(S){s((S==null?void 0:S.message)||"Unable to load dashboard.")}finally{r(!1)}})()},[]);const y=(e==null?void 0:e.leave_balances)||[],g=(j,S)=>!S||S<=0?0:Math.min(100,Math.round(j/S*100)),v=(e==null?void 0:e.pending_leaves)||(e==null?void 0:e.pending_requests)||[],w=(e==null?void 0:e.recent_leaves)||[],b=(e==null?void 0:e.pending_requests_count)!=null?e.pending_requests_count:v.length,N=(e==null?void 0:e.approved_this_month)??0,_=(e==null?void 0:e.total_leaves_taken)??0,C=j=>{u(j),h("")},k=async()=>{if(!(!c||!d.trim())){p(!0);try{await ut.respondToClarification(c.id,{response:d.trim()});const j=await ut.getDashboard();t(j),u(null),h("")}catch(j){console.error("Failed to submit clarification:",j)}finally{p(!1)}}};return n?i.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-8 text-center",children:[i.jsx("div",{className:"h-10 w-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Preparing your leave dashboard..."})]})}):a?i.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-sm text-red-600 flex items-center gap-2",children:[i.jsx(vt,{className:"w-4 h-4"}),a]})}):i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Leave Dashboard"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Manage your leave requests and view balances"})]}),i.jsx(Fa,{to:"/employee/apply-leave",className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-cyan-500 text-white text-sm font-medium shadow-sm hover:bg-cyan-600 transition-colors self-start md:self-auto",children:i.jsx("span",{className:"text-base",children:" apply leave"})})]}),i.jsx("section",{className:"mb-6",children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:y.map(j=>{const S=g(j.available,j.total),D={CL:{bg:"bg-cyan-500",text:"text-cyan-500"},SL:{bg:"bg-emerald-500",text:"text-emerald-500"},EL:{bg:"bg-amber-500",text:"text-amber-500"}}[j.code]||{bg:"bg-blue-500",text:"text-blue-500"};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>l(j),children:[i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-700",children:j.name}),i.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Available leaves"})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:`text-3xl font-bold ${D.text}`,children:j.available}),i.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["out of ",j.total||0]})]})]}),i.jsx("div",{className:"h-1.5 rounded-full bg-gray-100 overflow-hidden",children:i.jsx("div",{className:`h-1.5 ${D.bg} rounded-full transition-all`,style:{width:`${S}%`}})})]},j.id)})})}),i.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[i.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Pending Requests"}),i.jsx("p",{className:"text-4xl font-bold text-amber-500",children:b})]}),i.jsx("div",{className:"w-12 h-12 rounded-lg bg-amber-50 flex items-center justify-center flex-shrink-0",children:i.jsx(Ke,{className:"w-6 h-6 text-amber-500"})})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Approved This Month"}),i.jsxs("p",{className:"text-4xl font-bold text-emerald-500",children:[N," days"]})]}),i.jsx("div",{className:"w-12 h-12 rounded-lg bg-emerald-50 flex items-center justify-center flex-shrink-0",children:i.jsx(Lt,{className:"w-6 h-6 text-emerald-500"})})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-5",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Total Leaves Taken"}),i.jsxs("p",{className:"text-4xl font-bold text-cyan-500",children:[_," days"]})]}),i.jsx("div",{className:"w-12 h-12 rounded-lg bg-cyan-50 flex items-center justify-center flex-shrink-0",children:i.jsx(Ke,{className:"w-6 h-6 text-cyan-500"})})]})})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("section",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[i.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center gap-2",children:"Pending Requests"}),i.jsx("div",{className:"space-y-3",children:v.length>0?v.map(j=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:j.type||"Leave"}),i.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[j.days," day",j.days>1?"s":""]})]}),i.jsx("span",{className:"inline-flex items-center rounded-md px-2.5 py-1 text-xs font-medium bg-amber-100 text-amber-700",children:"Pending"})]}),i.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 mb-2",children:[i.jsx(Ke,{className:"w-3.5 h-3.5"}),i.jsx("span",{children:x(j.from_date,j.to_date)})]}),j.reason&&i.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-gray-600 mb-2",children:[i.jsx("span",{className:"flex-shrink-0",children:""}),i.jsx("span",{children:j.reason})]}),j.submitted_at&&i.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Submitted on ",m(j.submitted_at)]})]},j.id)):i.jsx("p",{className:"text-sm text-gray-500",children:"You have no pending leave requests."})})]}),i.jsxs("section",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[i.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center gap-2",children:"Recent Requests"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:w.length>0?w.slice(0,3).map(j=>i.jsxs("div",{className:`border border-gray-200 rounded-lg p-4 ${j.clarification_reason?"cursor-pointer hover:bg-gray-50":""}`,onClick:()=>j.clarification_reason&&C(j),children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-900 text-sm",children:j.type||"Leave"}),i.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[j.days," day",j.days>1?"s":""]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[j.clarification_reason&&i.jsx(M_,{className:"w-4 h-4 text-blue-500"}),i.jsx("span",{className:`inline-flex items-center rounded-md px-2.5 py-1 text-xs font-medium ${j.status==="Approved"?"bg-emerald-100 text-emerald-700":j.status==="Rejected"?"bg-red-100 text-red-700":j.clarification_reason?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:j.clarification_reason?"Clarification Needed":j.status||"Pending"})]})]}),i.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600 mb-2",children:[i.jsx(Ke,{className:"w-3.5 h-3.5"}),i.jsx("span",{children:x(j.from_date,j.to_date)})]}),j.reason&&i.jsx("div",{className:"flex items-start gap-1.5 text-xs text-gray-600 mb-2",children:i.jsxs("span",{children:["reason: ",j.reason]})}),j.submitted_at&&i.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Submitted on ",m(j.submitted_at)]})]},j.id)):i.jsx("p",{className:"text-sm text-gray-500",children:"No recent leave requests found."})})]})]}),o&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[o.name," Details"]}),i.jsx("button",{onClick:()=>l(null),className:"text-gray-400 hover:text-gray-600",children:i.jsx(Mn,{className:"w-6 h-6"})})]}),i.jsxs("div",{className:"p-6 space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Available"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.available})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.total})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-600",children:"Current Balance:"}),i.jsx("span",{className:"font-medium",children:o.balance})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-600",children:"Carry Forward:"}),i.jsx("span",{className:"font-medium",children:o.carry_forward_balance})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-600",children:"Pending Deduction:"}),i.jsx("span",{className:"font-medium",children:o.pending_deduction})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-600",children:"Accrued This Year:"}),i.jsx("span",{className:"font-medium",children:o.accrued_this_year})]})]}),o.description&&i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Description"}),i.jsx("p",{className:"text-sm text-gray-900",children:o.description})]})]})]})}),c&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Clarification Required"}),i.jsx("button",{onClick:()=>u(null),className:"text-gray-400 hover:text-gray-600",children:i.jsx(Mn,{className:"w-6 h-6"})})]}),i.jsxs("div",{className:"p-6 space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Admin Message:"}),i.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:i.jsx("p",{className:"text-sm text-blue-900",children:c.clarification_reason})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Response"}),i.jsx("textarea",{value:d,onChange:j=>h(j.target.value),placeholder:"Please provide clarification for your leave request...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:4,disabled:f})]}),i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:()=>u(null),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:f,children:"Cancel"}),i.jsx("button",{onClick:k,disabled:!d.trim()||f,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors",children:f?"Submitting...":"Submit Response"})]})]})]})})]})})},QD=()=>{eu();const[e,t]=E.useState([]),[n,r]=E.useState(!0),[a,s]=E.useState(""),[o,l]=E.useState(""),[c,u]=E.useState(!1),[d,h]=E.useState({leave_policy_id:"",from_date:"",to_date:"",partial_day:"full_day",partial_session:"first_half",reason:"",attachment:null}),[f,p]=E.useState([]);E.useEffect(()=>{(async()=>{try{const N=await ut.getLeaveBalances();t(N.balances||[])}catch(N){s((N==null?void 0:N.message)||"Unable to fetch balances.")}finally{r(!1)}})()},[]),E.useEffect(()=>{(async()=>{try{const N=await ut.getHolidays();p(N.holidays||[])}catch(N){console.warn("Failed to load holidays:",N)}})()},[]),E.useEffect(()=>{e.length>0&&!d.leave_policy_id&&h(b=>({...b,leave_policy_id:e[0].policy.id.toString()}))},[e]),E.useEffect(()=>{d.partial_day==="half_day"&&d.from_date&&h(b=>({...b,to_date:d.from_date}))},[d.partial_day,d.from_date]),E.useEffect(()=>{if(o){const b=setTimeout(()=>l(""),2e3);return()=>clearTimeout(b)}},[o]),E.useEffect(()=>{if(a){const b=setTimeout(()=>s(""),2e3);return()=>clearTimeout(b)}},[a]);const m=E.useMemo(()=>{var b;return(b=e.find(N=>{var _;return Number((_=N.policy)==null?void 0:_.id)===Number(d.leave_policy_id)}))==null?void 0:b.policy},[e,d.leave_policy_id]),x=E.useMemo(()=>{const b=e.find(N=>{var _;return Number((_=N.policy)==null?void 0:_.id)===Number(d.leave_policy_id)});return b?b.available:0},[e,d.leave_policy_id]),y=E.useMemo(()=>{if(!d.from_date||!d.to_date)return 0;const b=k=>{if(!k)return null;const[j,S,M]=k.split("-").map(Number);return!j||!S||!M?null:new Date(j,S-1,M)},N=b(d.from_date),_=b(d.to_date);if(!N||!_||N>_)return 0;if(d.partial_day==="half_day")return .5;if((m==null?void 0:m.sandwich_rule_enabled)===!0)return Math.floor((_-N)/864e5)+1;{let k=0;const j=new Date(N),S=f.map(D=>D.date),M=D=>`${D.getFullYear().toString().padStart(4,"0")}-${(D.getMonth()+1).toString().padStart(2,"0")}-${D.getDate().toString().padStart(2,"0")}`;for(;j<=_;){const D=M(j);j.getDay()!==0&&j.getDay()!==6&&!S.includes(D)&&k++,j.setDate(j.getDate()+1)}return k}},[d.from_date,d.to_date,d.partial_day,m,f]),g=(b,N)=>{h(_=>({..._,[b]:N}))},v=b=>{var _;const N=(_=b.target.files)==null?void 0:_[0];g("attachment",N||null)},w=async b=>{if(b.preventDefault(),s(""),l(""),!d.leave_policy_id){s("Please choose a leave policy.");return}if(!d.reason.trim()){s("Please provide a reason for the leave request.");return}if((m==null?void 0:m.code)==="SL"&&y>=2&&!d.attachment){s("Supporting document is required for medical leave of 2+ days.");return}u(!0);try{const N=new FormData;N.append("leave_policy_id",d.leave_policy_id),N.append("from_date",d.from_date),N.append("to_date",d.to_date),N.append("partial_day",d.partial_day),d.partial_day==="half_day"&&N.append("partial_session",d.partial_session),N.append("reason",d.reason),d.attachment&&N.append("attachment",d.attachment),await ut.createLeaveRequest(N),l("Leave request submitted successfully.");const _=await ut.getLeaveBalances();t(_.balances||[]),h({leave_policy_id:"",from_date:"",to_date:"",partial_day:"full_day",partial_session:"first_half",reason:"",attachment:null})}catch(N){s((N==null?void 0:N.error)||(N==null?void 0:N.message)||"Failed to submit leave request.")}finally{u(!1)}};return n?i.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow text-center",children:[i.jsx("div",{className:"h-8 w-8 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Loading leave policies..."})]}):i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[i.jsx(l_,{className:"w-5 h-5 text-indigo-500"}),"Apply for Leave"]}),i.jsx("button",{onClick:async()=>{try{const b=await ut.getLeaveBalances();t(b.balances||[])}catch(b){s((b==null?void 0:b.message)||"Unable to refresh balances.")}},className:"text-xs text-indigo-600 hover:text-indigo-800 font-medium",children:"Refresh Balances"})]}),a&&i.jsxs("div",{className:"mb-4 flex items-center gap-2 text-sm text-red-700 bg-red-50 border border-red-200 px-3 py-2 rounded-lg",children:[i.jsx(vt,{className:"w-4 h-4"}),a]}),o&&i.jsx("div",{className:"mb-4 text-sm text-green-700 bg-green-50 border border-green-200 px-3 py-2 rounded-lg",children:o}),i.jsxs("form",{className:"space-y-4",onSubmit:w,children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Leave Type"}),i.jsxs("select",{className:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:d.leave_policy_id,onChange:b=>g("leave_policy_id",b.target.value),required:!0,children:[i.jsx("option",{value:"",children:"Select leave type"}),e.map(b=>i.jsx("option",{value:b.policy.id,children:b.policy.name},b.policy.id))]}),m&&i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Monthly accrual: ",m.monthly_accrual,"  Sandwich rule"," ",m.sandwich_rule_enabled===!0?"enabled":"disabled"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:d.partial_day==="half_day"?"Date":"From Date"}),i.jsx("input",{type:"date",className:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:d.from_date,onChange:b=>g("from_date",b.target.value),required:!0})]}),d.partial_day!=="half_day"&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),i.jsx("input",{type:"date",className:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:d.to_date,onChange:b=>g("to_date",b.target.value),required:!0})]})]}),i.jsxs("div",{className:"p-4 bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl border border-indigo-100",children:[i.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(He,{className:"w-5 h-5 text-indigo-500"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{id:"partial-day",type:"checkbox",className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500",checked:d.partial_day==="half_day",onChange:b=>g("partial_day",b.target.checked?"half_day":"full_day")}),i.jsx("label",{htmlFor:"partial-day",className:"text-sm font-medium text-gray-700",children:"Partial day leave"})]})]}),d.partial_day==="half_day"&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-sm text-gray-600",children:"Session:"}),i.jsxs("select",{className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",value:d.partial_session,onChange:b=>g("partial_session",b.target.value),children:[i.jsx("option",{value:"first_half",children:"First Half"}),i.jsx("option",{value:"second_half",children:"Second Half"})]})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 lg:gap-6",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),i.jsx("span",{className:"text-sm text-gray-600",children:"Days:"}),i.jsx("span",{className:`font-semibold ${y>x?"text-red-600":"text-gray-900"}`,children:Number.isNaN(y)?0:y})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Lt,{className:"w-4 h-4 text-green-500"}),i.jsx("span",{className:"text-sm text-gray-600",children:"Available:"}),i.jsx("span",{className:`font-semibold ${x<y?"text-red-600":"text-green-600"}`,children:x.toFixed(1)})]})]})]}),m&&i.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:[m.sandwich_rule_enabled===!0&&i.jsx("p",{children:"Sandwich rule is enabled for this policy."}),m.code==="SL"&&i.jsx("p",{children:"Medical leave requires supporting document for 2+ days."})]}),y>x&&i.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-red-600 bg-red-50 border border-red-200 px-3 py-2 rounded-lg",children:[i.jsx(vt,{className:"w-4 h-4"}),"Insufficient leave balance for the requested period."]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),i.jsx("textarea",{rows:3,className:"w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Explain why you need this leave...",value:d.reason,onChange:b=>g("reason",b.target.value)})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supporting document (optional)"}),i.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-xl cursor-pointer text-sm text-gray-600 hover:border-indigo-300",children:[i.jsx(L_,{className:"w-4 h-4"}),d.attachment?d.attachment.name:"Upload medical certificate, exam hall ticket, etc.",i.jsx("input",{type:"file",className:"hidden",onChange:v})]})]}),i.jsx("button",{type:"submit",disabled:c||y>x,className:"inline-flex items-center justify-center gap-2 w-full bg-indigo-600 text-white py-3 rounded-xl font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:c?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting Request..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Lt,{className:"w-5 h-5"}),"Submit Leave Request"]})})]})]})})};function JD(){const e=Yn(),t=new Date,[n,r]=E.useState(t.getFullYear()),[a,s]=E.useState(t.getMonth()),[o,l]=E.useState(1),c=5,[u,d]=E.useState(!1),[h,f]=E.useState(null),[p,m]=E.useState({}),x=()=>{a===0?(s(11),r(n-1)):s(a-1)},y=()=>{a===11?(s(0),r(n+1)):s(a+1)},g=async()=>{try{const F=v.getFullYear(),U=v.getMonth()+1,V=C(F,U-1,1),P=C(F,U-1,b),$=await ut.exportAttendanceReport({start_date:V,end_date:P}),I=window.URL.createObjectURL($),q=document.createElement("a");q.href=I,q.download=`attendance-${F}-${String(U).padStart(2,"0")}.csv`,document.body.appendChild(q),q.click(),window.URL.revokeObjectURL(I),document.body.removeChild(q)}catch(F){console.error("Download failed:",F),f("Failed to download attendance report")}},v=new Date(n,a,1),w=v.toLocaleDateString("en-US",{month:"long",year:"numeric"}),b=new Date(n,a+1,0).getDate(),N=new Date(n,a,1).getDay(),_=F=>{const U=F.getFullYear(),V=String(F.getMonth()+1).padStart(2,"0"),P=String(F.getDate()).padStart(2,"0");return`${U}-${V}-${P}`},C=(F,U,V)=>`${F}-${String(U+1).padStart(2,"0")}-${String(V).padStart(2,"0")}`;function k(F){switch(F){case"Present":return"bg-green-500 text-white";case"Late Arrival":return"bg-purple-500 text-white";case"Absent":return"bg-red-500 text-white";case"Holiday":return"bg-blue-500 text-white";case"On Leave":return"bg-orange-500 text-white";case"Early Departure":return"bg-pink-500 text-white";case"Half Day":return"bg-yellow-500 text-white";default:return""}}const j=async()=>{var F;d(!0),f(null);try{const U=v.getFullYear(),V=v.getMonth()+1,P=C(U,V-1,1),$=C(U,V-1,b),I=await ut.getAttendanceReport({start_date:P,end_date:$}),q={};(I.records||[]).forEach(X=>{const ne=X.date;q[ne]={status:X.status,checkIn:X.check_in?new Date(X.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",checkOut:X.check_out?new Date(X.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-",totalHours:X.total_hours||"-",breaks:X.breaks||[],holiday:X.holiday||null,leaveReason:X.leave_reason||null}}),m(q)}catch(U){console.error(U),((F=U==null?void 0:U.response)==null?void 0:F.status)===401&&e("/login"),f("Failed to fetch attendance records")}finally{d(!1)}};E.useEffect(()=>{j()},[n,a]),E.useEffect(()=>{const F=setInterval(()=>{j()},3e4);return()=>clearInterval(F)},[n,a]);const M=(()=>{const F=[],U=v.getFullYear(),V=v.getMonth();_(new Date);for(let P=0;P<N;P++)F.push(null);for(let P=1;P<=b;P++){const $=C(U,V,P),I=new Date(U,V,P),q=_(I);let X=p[$];if(!X){const ne=new Date(t);ne.setDate(ne.getDate()-1);const ie=_(ne),le=I.getDay();q<=ie&&le!==0&&le!==6&&(X={status:"Absent",checkIn:"-",checkOut:"-",totalHours:"-",holiday:null})}F.push({day:P,key:$,rec:X,date:I})}return F})(),D=M.filter(Boolean).filter(F=>F.rec).map(F=>({date:F.key,...F.rec})).sort((F,U)=>F.date<U.date?1:-1),A=u?Array(c).fill({skeleton:!0}):D.slice((o-1)*c,o*c),B=Math.max(1,Math.ceil(D.length/c));return i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"p-3 space-y-4",children:[i.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"My Attendance Calendar"}),i.jsx("p",{className:"text-md text-gray-500",children:"View your attendance records"})]})}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(T0,{className:"w-5 h-5"})}),i.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:w}),i.jsx("button",{onClick:y,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:i.jsx(Ef,{className:"w-5 h-5"})})]}),i.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors w-full sm:w-auto",children:[i.jsx(si,{className:"w-4 h-4"}),"Download CSV"]})]}),h&&i.jsx("div",{className:"text-rose-500 text-sm",children:h}),i.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2 mb-2",children:[i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sun"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Mon"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Tue"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Wed"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Thu"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Fri"}),i.jsx("div",{className:"text-center font-semibold text-gray-700 text-sm py-2",children:"Sat"})]}),i.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2",children:[M.slice(0,N).map((F,U)=>i.jsx("div",{className:"aspect-square"},`lead-${U}`)),M.slice(N).map((F,U)=>{var I,q;const V=(I=F.rec)==null?void 0:I.status,P=k(V),$=new Date(F.key).getDay()===0||new Date(F.key).getDay()===6;return i.jsx("div",{className:`aspect-square border-2 rounded-lg p-2 cursor-pointer transition-all hover:shadow-md ${V?P:$?"bg-gray-100 border-gray-200":"bg-white border-gray-200"}`,children:i.jsxs("div",{className:"h-full flex flex-col",children:[i.jsx("span",{className:`text-sm font-semibold mb-1 ${V?"text-white":"text-gray-700"}`,children:F.day}),i.jsx("div",{className:"flex-1 flex flex-col justify-center text-xs",children:F.rec?i.jsx(i.Fragment,{children:V==="Holiday"?i.jsx("span",{className:`font-medium ${V?"text-white":"text-gray-700"}`,children:((q=F.rec.holiday)==null?void 0:q.name)||"Holiday"}):V==="On Leave"?i.jsx("span",{className:`font-medium ${V?"text-white":"text-gray-700"}`,children:F.rec.leaveReason||"On Leave"}):V==="Present"||V==="Late Arrival"||V==="Early Departure"||V==="Half Day"?i.jsxs(i.Fragment,{children:[i.jsxs("span",{className:`${V?"text-white":"text-gray-700"}`,children:["In: ",F.rec.checkIn]}),i.jsxs("span",{className:`${V?"text-white":"text-gray-700"}`,children:["Out: ",F.rec.checkOut]})]}):i.jsx("span",{children:""})}):i.jsx("span",{children:""})})]})},`${F.key}-${U}`)})]}),i.jsxs("div",{className:"mt-4 md:mt-6 pt-4 md:pt-6 border-t border-gray-200 grid grid-cols-2 sm:flex sm:flex-wrap gap-3 md:gap-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Present"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Half Day"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Absent"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Holiday"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"On Leave"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Late Arrival"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 bg-pink-500 rounded"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Early Departure"})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2",children:[i.jsx(Ke,{className:"w-5 h-5"})," Detailed Attendance Logs"]}),i.jsx("div",{className:"space-y-4",children:A.map((F,U)=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors",children:[i.jsx("div",{className:"flex items-start justify-between mb-3",children:F.skeleton?i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})]}),i.jsx("div",{className:"h-4 w-40 bg-gray-200 rounded animate-pulse mt-2"})]}),i.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(V=>i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded animate-pulse mt-1"}),i.jsxs("div",{children:[i.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse mt-1"})]})]},V))})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{children:i.jsx("p",{className:"text-lg font-semibold text-gray-900",children:new Date(F.date).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})})}),i.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${F.status==="Present"?"bg-green-100 text-green-700":F.status==="Absent"?"bg-red-100 text-red-800":F.status==="Late Arrival"?"bg-purple-100 text-purple-800":F.status==="Early Departure"?"bg-pink-100 text-pink-800":F.status==="Holiday"?"bg-blue-100 text-blue-800":F.status==="On Leave"?"bg-orange-100 text-orange-800":F.status==="Half Day"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:F.status})]})}),!F.skeleton&&i.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(He,{className:"w-5 h-5 text-green-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Check-In"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:F.checkIn})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ks,{className:"w-5 h-5 text-red-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Check-Out"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:F.checkOut})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(He,{className:"w-5 h-5 text-blue-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Total Duration"}),i.jsx("p",{className:"text-base font-semibold text-gray-900",children:F.totalHours})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Ke,{className:"w-5 h-5 text-purple-600 mt-1"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-gray-600",children:"Re-entries"}),i.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[Array.isArray(F.breaks)?F.breaks.length:F.breaks||0," times"]})]})]})]}),F.breaks&&F.breaks.length>0&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Break Details:"}),F.breaks.map((V,P)=>i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsxs("span",{className:"text-gray-700",children:["Start: ",V.break_start?new Date(V.break_start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]}),i.jsxs("span",{className:"text-gray-700",children:["End: ",V.break_end?new Date(V.break_end).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]})]},P))]})})]},F.skeleton?U:F.date))}),i.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 pt-4 border-t border-gray-200 gap-4",children:[i.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",A.length," of ",D.length," records"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>l(F=>Math.max(1,F-1)),disabled:o===1,className:`px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ${o===1?"opacity-50 cursor-not-allowed":""}`,children:"Previous"}),i.jsx("button",{className:"px-4 py-2 rounded-lg text-sm font-medium bg-blue-600 text-white",children:o}),i.jsx("button",{onClick:()=>l(F=>Math.min(B,F+1)),disabled:o===B,className:`px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors ${o===B?"opacity-50 cursor-not-allowed":""}`,children:"Next"})]})]})]})]})})}const ZD=()=>{var Ce;const{profile:e,setProfile:t,refreshProfile:n}=eu(),[r,a]=E.useState("view"),[s,o]=E.useState(!1),[l,c]=E.useState("");Cs.useEffect(()=>{if(!l)return;const H=setTimeout(()=>c(""),2e3);return()=>clearTimeout(H)},[l]);const u=E.useRef(null),[d,h]=E.useState({phone:"",emergency_contact_number:"",profile_photo:null}),[f,p]=E.useState({current_password:"",password:"",password_confirmation:""}),[m,x]=E.useState("today"),[y,g]=E.useState(new Date().toISOString().split("T")[0]),[v,w]=E.useState([]),[b,N]=E.useState(null),[_,C]=E.useState(!1),[k,j]=E.useState(null),[S,M]=E.useState(!1),[D,A]=E.useState({type:"missing",requested_check_in:"",requested_check_out:"",reason:"",breaks:[]}),[B,F]=E.useState([]),[U,V]=E.useState(!1),[P,$]=E.useState(null);function I(H){switch(H){case"approved":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}Cs.useEffect(()=>{e&&h({phone:e.phone||"",emergency_contact_number:e.emergency_contact_number||"",profile_photo:null})},[e]);const q=async H=>{H.preventDefault(),o(!0),c(""),console.log("Profile form data:",d),console.log("Profile photo file:",d.profile_photo);try{let O;d.profile_photo?(console.log("File detected, creating FormData"),O=new FormData,O.append("phone",d.phone),O.append("emergency_contact_number",d.emergency_contact_number),O.append("profile_photo",d.profile_photo),console.log("FormData created with file")):(console.log("No file, sending as JSON"),O={phone:d.phone,emergency_contact_number:d.emergency_contact_number});const Q=await ut.updateProfile(O);c(Q.message),t(Q.employee),localStorage.setItem("employeeProfile",JSON.stringify(Q.employee)),h({phone:Q.employee.phone||"",emergency_contact_number:Q.employee.emergency_contact_number||"",profile_photo:null}),u.current&&(u.current.value="")}catch(O){O.errors?c(Object.values(O.errors).flat().join(", ")):c(O.message||"Failed to update profile")}finally{o(!1)}},X=async H=>{if(H.preventDefault(),o(!0),c(""),f.password!==f.password_confirmation){c("Passwords do not match"),o(!1);return}try{await ut.changePassword({current_password:f.current_password,password:f.password,password_confirmation:f.password_confirmation}),c("Password changed successfully"),p({current_password:"",password:"",password_confirmation:""})}catch(O){O.errors?c(Object.values(O.errors).flat().join(", ")):c(O.message||"Failed to change password")}finally{o(!1)}},ne=async()=>{if(!y){j("Please select a date");return}C(!0),j("");try{const H={start_date:y,end_date:y},O=await ut.getAttendanceReport(H);w((O==null?void 0:O.records)||[]),N(null),M(!0)}catch(H){console.error("Failed to fetch attendance logs:",H),j("Failed to fetch attendance logs")}finally{C(!1)}},ie=H=>{const O=Q=>{if(!Q)return"";const oe=new Date(Q),ue=oe.getHours().toString().padStart(2,"0"),W=oe.getMinutes().toString().padStart(2,"0");return`${ue}:${W}`};A({...D,type:H,requested_check_in:H==="missing"?D.requested_check_in:b?O(b.check_in):"",requested_check_out:H==="missing"?D.requested_check_out:b?O(b.check_out):""})},le=H=>{N(H);const O=Q=>{if(!Q)return"";const oe=new Date(Q),ue=oe.getHours().toString().padStart(2,"0"),W=oe.getMinutes().toString().padStart(2,"0");return`${ue}:${W}`};A({...D,requested_check_in:O(H.check_in),requested_check_out:O(H.check_out),breaks:H.breaks?H.breaks.map(Q=>({break_start:Q.break_start?O(Q.break_start):"",break_end:Q.break_end?O(Q.break_end):""})):[]})},pe=()=>{if(D.requested_check_in&&D.requested_check_out){const H=D.requested_check_in;if(D.requested_check_out<=H)return"Check-out time must be after check-in time"}return null},_e=async H=>{H.preventDefault(),o(!0),c("");const O=pe();if(O){c(O),o(!1);return}try{const Q={...D,attendance_id:D.type==="missing"?null:b.id,date:b.date};await ut.submitCorrectionRequest(Q),c("Correction request submitted successfully"),A({type:"missing",requested_check_in:"",requested_check_out:"",reason:"",breaks:[]}),N(null),w([]),G()}catch(Q){c(Q.message||"Failed to submit correction request")}finally{o(!1)}},G=async()=>{V(!0),$(null);try{const H=await ut.getCorrectionRequests();F(Array.isArray(H==null?void 0:H.requests)?H.requests:[])}catch(H){console.error("Failed to load correction requests:",H),$("Failed to load correction requests"),F([])}finally{V(!1)}};if(Cs.useEffect(()=>{r==="corrections"&&G()},[r]),!e)return null;const re=[{id:"view",label:"Profile",icon:Vn},{id:"edit",label:"Edit Profile",icon:ca},{id:"corrections",label:"Attendance Corrections",icon:mn}];return i.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:i.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[i.jsxs("div",{className:"flex items-center justify-between gap-4 mb-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Employee Profile"}),i.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Manage your personal information and account settings"})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[e!=null&&e.profile_photo?i.jsx("img",{src:`/storage/${e.profile_photo}`,alt:e.name,className:"w-12 h-12 rounded-full object-cover flex-shrink-0"}):i.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",children:((Ce=e==null?void 0:e.name)==null?void 0:Ce.split(" ").map(H=>H[0]).join("").toUpperCase())||"U"}),i.jsxs("div",{className:"hidden md:block",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.name}),i.jsx("p",{className:"text-xs text-gray-500",children:e.employee_id})]})]})]}),i.jsxs("div",{className:"bg-white rounded-2xl shadow",children:[i.jsx("div",{className:"border-b border-gray-200",children:i.jsx("nav",{className:"flex space-x-8 px-6",children:re.map(H=>i.jsx("button",{onClick:()=>a(H.id),className:`py-4 px-1 border-b-2 font-medium text-sm ${r===H.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:H.label},H.id))})}),i.jsxs("div",{className:"p-6",children:[l&&i.jsx("div",{className:`mb-4 p-4 rounded-md ${l.includes("successfully")?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:l}),r==="view"&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Vn,{className:"w-5 h-5 text-gray-600"}),"Personal Information"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(Wn,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{className:"min-w-0 flex-1",children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Email Address"}),i.jsx("p",{className:"font-medium text-gray-900 break-all",children:e.email})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(Ma,{className:"w-5 h-5 text-green-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Phone Number"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.phone||"Not provided"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-orange-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(ag,{className:"w-5 h-5 text-orange-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Emergency Contact Number"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.emergency_contact_number||"Not provided"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(GN,{className:"w-5 h-5 text-purple-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Department"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.department||"General"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(Vn,{className:"w-5 h-5 text-indigo-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Designation"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.designation||"N/A"})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-cyan-50 rounded-lg flex items-center justify-center flex-shrink-0",children:i.jsx(Ke,{className:"w-5 h-5 text-cyan-600"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-gray-500",children:"Join Date"}),i.jsx("p",{className:"font-medium text-gray-900",children:e.join_date?new Date(e.join_date).toLocaleDateString("en-GB"):"N/A"})]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(Ke,{className:"w-5 h-5 text-gray-600"}),"Assigned Leave Policies"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(e.leave_policies||[]).map(H=>i.jsx("div",{className:"p-4 rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 border border-green-100",children:i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center",children:i.jsx(Ke,{className:"w-4 h-4 text-white"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-gray-900",children:H.name}),i.jsxs("p",{className:"text-xs text-green-600 font-medium",children:[H.yearly_quota," days/year"]})]})]})},H.id)),(!e.leave_policies||e.leave_policies.length===0)&&i.jsxs("div",{className:"col-span-full p-8 text-center",children:[i.jsx(Ke,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"No leave policies assigned."})]})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(He,{className:"w-5 h-5 text-gray-600"}),"Assigned Attendance Policy"]}),e.attendance_policy?i.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:i.jsx(He,{className:"w-5 h-5 text-white"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-lg font-semibold text-gray-900",children:e.attendance_policy.name}),i.jsx("p",{className:"text-sm text-blue-600",children:"Work Schedule Policy"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-blue-200",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Work Start"}),i.jsx("p",{className:"text-sm font-semibold text-gray-900",children:e.attendance_policy.work_start_time})]}),i.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-blue-200",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Work End"}),i.jsx("p",{className:"text-sm font-semibold text-gray-900",children:e.attendance_policy.work_end_time})]}),i.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-blue-200",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Break Duration"}),i.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[e.attendance_policy.break_duration," mins"]})]}),i.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-blue-200",children:[i.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Grace Period"}),i.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[e.attendance_policy.grace_period," mins"]})]})]})]}):i.jsxs("div",{className:"p-8 text-center",children:[i.jsx(He,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),i.jsx("p",{className:"text-sm text-gray-500",children:"No attendance policy assigned."})]})]})]}),r==="edit"&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(ca,{className:"w-5 h-5 text-gray-600"}),"Update Personal Information"]}),i.jsxs("form",{onSubmit:q,className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Ma,{className:"w-4 h-4 text-gray-500"}),"Phone Number"]}),i.jsx("input",{type:"text",value:d.phone,onChange:H=>h({...d,phone:H.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Enter phone number"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(ag,{className:"w-4 h-4 text-gray-500"}),"Emergency Contact Number"]}),i.jsx("input",{type:"text",value:d.emergency_contact_number,onChange:H=>h({...d,emergency_contact_number:H.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Enter emergency contact number"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Vn,{className:"w-4 h-4 text-gray-500"}),"Profile Photo"]}),i.jsx("input",{type:"file",ref:u,accept:"image/*",onChange:H=>{const O=H.target.files[0];console.log("File selected:",O),h({...d,profile_photo:O})},className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"}),(e==null?void 0:e.profile_photo)&&i.jsx("p",{className:"text-xs text-gray-500",children:"Current photo will be replaced if you select a new one."})]})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:i.jsx("button",{type:"submit",disabled:s,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:s?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(ca,{className:"w-4 h-4"}),"Update Profile"]})})})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(xo,{className:"w-5 h-5 text-gray-600"}),"Change Password"]}),i.jsxs("form",{onSubmit:X,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xo,{className:"w-4 h-4 text-gray-500"}),"Current Password"]}),i.jsx("input",{type:"password",value:f.current_password,onChange:H=>p({...f,current_password:H.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Enter current password",required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xo,{className:"w-4 h-4 text-gray-500"}),"New Password"]}),i.jsx("input",{type:"password",value:f.password,onChange:H=>p({...f,password:H.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Enter new password",required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(xo,{className:"w-4 h-4 text-gray-500"}),"Confirm New Password"]}),i.jsx("input",{type:"password",value:f.password_confirmation,onChange:H=>p({...f,password_confirmation:H.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"Confirm new password",required:!0})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:i.jsx("button",{type:"submit",disabled:s,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:s?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Changing..."]}):i.jsxs(i.Fragment,{children:[i.jsx(xo,{className:"w-4 h-4"}),"Change Password"]})})})]})]})]}),r==="corrections"&&i.jsxs("div",{className:"space-y-6",children:[k&&i.jsxs("div",{className:"p-4 rounded-xl shadow-lg border-l-4 bg-red-50 text-red-800 border-red-400 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(vt,{className:"h-6 w-6 text-red-600"}),i.jsx("span",{className:"font-medium",children:k})]}),i.jsx("button",{onClick:()=>j(""),className:"text-red-400 hover:text-red-600 transition-colors duration-200",children:i.jsx(ao,{className:"h-5 w-5"})})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),"Date Range"]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"today",name:"dateRange",value:"today",checked:m==="today",onChange:H=>{x(H.target.value);const O=new Date().toISOString().split("T")[0];g(O)},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"today",className:"ml-2 block text-sm text-gray-900",children:"Today"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"custom",name:"dateRange",value:"custom",checked:m==="custom",onChange:H=>{x(H.target.value),g("")},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"custom",className:"ml-2 block text-sm text-gray-900",children:"Custom Date"})]})]})]}),m==="custom"&&i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),i.jsx("input",{type:"date",value:y,onChange:H=>{g(H.target.value),M(!1)},className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]})})]}),i.jsx("div",{className:"mt-4 flex flex-col sm:flex-row gap-4",children:i.jsxs("button",{onClick:ne,disabled:!y||_,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[_&&i.jsx(rh,{className:"w-4 h-4 animate-spin"}),_?"Loading...":"Fetch Attendance Logs"]})})]}),v.length>0&&i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[i.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:i.jsx("h2",{className:"text-lg font-semibold",children:"Your Attendance Logs"})}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check In"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check Out"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Breaks"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Break Duration"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Hours"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),i.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(v||[]).map(H=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(H.date).toLocaleDateString("en-GB")}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.check_in?new Date(H.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.check_out?new Date(H.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.breaks&&H.breaks.length>0?i.jsx("div",{className:"space-y-1",children:H.breaks.map((O,Q)=>i.jsxs("div",{className:"text-xs",children:["Break ",Q+1,": ",O.break_start?new Date(O.break_start).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"," - ",O.break_end?new Date(O.break_end).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]},O.id||Q))}):"No breaks"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.breaks&&H.breaks.length>0?`${H.breaks.length*30} min`:"N/A"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.total_hours||"-"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${H.status==="Present"?"bg-green-100 text-green-800":H.status==="Absent"?"bg-red-100 text-red-800":H.status==="Late Arrival"?"bg-purple-100 text-purple-800":H.status==="Early Departure"?"bg-pink-100 text-pink-800":H.status==="Holiday"?"bg-blue-100 text-blue-800":H.status==="On Leave"?"bg-orange-100 text-orange-800":H.status==="Half Day"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:H.status})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:i.jsx("button",{type:"button",onClick:()=>le(H),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${(b==null?void 0:b.id)===H.id?"bg-indigo-600 text-white":"bg-indigo-100 text-indigo-700 hover:bg-indigo-200"}`,children:(b==null?void 0:b.id)===H.id?"Selected":"Select"})})]},H.id))})]})})]}),v.length===0&&S&&!_&&i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 text-center",children:i.jsx("p",{className:"text-gray-500",children:"No log found"})}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[i.jsx(mn,{className:"w-5 h-5 text-gray-600"}),"Attendance Correction request"]}),b?i.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:i.jsxs("p",{className:"text-sm text-blue-800",children:[i.jsx("strong",{children:"Selected Log:"})," ",new Date(b.date).toLocaleDateString()," ","- Check-in: ",b.check_in?new Date(b.check_in).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"N/A"," ","- Check-out: ",b.check_out?new Date(b.check_out).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"N/A"]})}):i.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:i.jsx("p",{className:"text-sm text-yellow-800",children:"Please select an attendance log from the table above to submit a correction request."})}),i.jsxs("form",{onSubmit:_e,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(mn,{className:"w-4 h-4 text-gray-500"}),"Correction Type *"]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"missing",name:"correctionType",value:"missing",checked:D.type==="missing",onChange:H=>ie(H.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"missing",className:"ml-2 block text-sm text-gray-900",children:"Change Attendance - Request for a completely missing attendance record"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"wrong_checkin",name:"correctionType",value:"wrong_checkin",checked:D.type==="wrong_checkin",onChange:H=>ie(H.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"wrong_checkin",className:"ml-2 block text-sm text-gray-900",children:"Wrong Check-in Time - Correct only the check-in time"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"wrong_checkout",name:"correctionType",value:"wrong_checkout",checked:D.type==="wrong_checkout",onChange:H=>ie(H.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"wrong_checkout",className:"ml-2 block text-sm text-gray-900",children:"Wrong Check-out Time - Correct only the check-out time"})]}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:"wrong_break",name:"correctionType",value:"wrong_break",checked:D.type==="wrong_break",onChange:H=>ie(H.target.value),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"}),i.jsx("label",{htmlFor:"wrong_break",className:"ml-2 block text-sm text-gray-900",children:"Wrong Break Times - Correct break start and end times"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(D.type==="missing"||D.type==="wrong_checkin")&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(He,{className:"w-4 h-4 text-gray-500"}),"Check-in Time *"]}),i.jsx("input",{type:"time",value:D.requested_check_in,onChange:H=>A({...D,requested_check_in:H.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:!0})]}),(D.type==="missing"||D.type==="wrong_checkout")&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(He,{className:"w-4 h-4 text-gray-500"}),"Check-out Time *"]}),i.jsx("input",{type:"time",value:D.requested_check_out,onChange:H=>A({...D,requested_check_out:H.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",required:!0})]})]}),(D.type==="missing"||D.type==="wrong_break")&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(He,{className:"w-4 h-4 text-gray-500"}),"Breaks"]}),i.jsx("button",{type:"button",onClick:()=>A({...D,breaks:[...D.breaks||[],{break_start:"",break_end:""}]}),className:"px-3 py-1 text-sm bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition-colors",children:"Add Break"})]}),(D.breaks||[]).map((H,O)=>i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Break Start Time"}),i.jsx("input",{type:"time",value:H.break_start,onChange:Q=>{const oe=[...D.breaks||[]];oe[O].break_start=Q.target.value,A({...D,breaks:oe})},className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Break End Time"}),i.jsx("input",{type:"time",value:H.break_end,onChange:Q=>{const oe=[...D.breaks||[]];oe[O].break_end=Q.target.value,A({...D,breaks:oe})},className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]}),i.jsx("div",{className:"flex items-end",children:i.jsx("button",{type:"button",onClick:()=>{const Q=(D.breaks||[]).filter((oe,ue)=>ue!==O);A({...D,breaks:Q})},className:"px-3 py-2 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:"Remove"})})]},`break-${O}`))]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(mn,{className:"w-4 h-4 text-gray-500"}),"Reason for Edit *"]}),i.jsx("textarea",{value:D.reason,onChange:H=>A({...D,reason:H.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors resize-none",rows:4,placeholder:"Please explain the reason for editing this attendance record",required:!0})]}),i.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:i.jsxs("button",{type:"submit",disabled:s||!b,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[s&&i.jsx(rh,{className:"w-4 h-4 animate-spin"}),i.jsx(mn,{className:"w-4 h-4"}),s?"Submitting...":"Submit Request"]})})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[i.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:i.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[i.jsx(mn,{className:"w-5 h-5"}),"Your Correction Requests"]})}),i.jsx("div",{className:"overflow-x-auto",children:B.length>0?i.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested Times"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Submitted"})]})}),i.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(Array.isArray(B)?B:[]).map((H,O)=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.date?new Date(H.date).toLocaleDateString("en-GB"):"N/A"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.type==="missing"?"Change Attendance":H.type==="wrong_checkin"?"Wrong Check-in":H.type==="wrong_checkout"?"Wrong Check-out":H.type==="wrong_break"?"Wrong Break Times":H.type==="break"?"Break Correction":H.type}),i.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[H.requested_check_in||"-"," - ",H.requested_check_out||"-"]}),i.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate",children:H.reason}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${I(H.status)}`,children:H.status.charAt(0).toUpperCase()+H.status.slice(1)})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:H.submitted_at?new Date(H.submitted_at).toLocaleDateString("en-GB"):"N/A"})]},H.id||`correction-${O}`))})]}):i.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"No correction requests found"})})]})]})]})]})]})})};function eI({cleanupRef:e}){const t=Pr();return E.useEffect(()=>{e.current&&typeof e.current=="function"&&(e.current(),e.current=null)},[t,e]),null}function tI(){const e=E.useRef(null);return i.jsxs(PN,{children:[i.jsx(eI,{cleanupRef:e}),i.jsxs(SN,{children:[i.jsx(xt,{path:"/login",element:i.jsx(MD,{})}),i.jsx(xt,{path:"/",element:i.jsx(ov,{registerCleanup:t=>e.current=t})}),i.jsx(xt,{path:"/attendance",element:i.jsx(ov,{registerCleanup:t=>e.current=t})}),i.jsx(xt,{path:"/dashboard",element:i.jsx(ka,{children:i.jsx(PD,{})})}),i.jsx(xt,{path:"/policies",element:i.jsx(ka,{children:i.jsx(LD,{})})}),i.jsx(xt,{path:"/leave/policies",element:i.jsx(ka,{children:i.jsx(BD,{})})}),i.jsx(xt,{path:"/leave/approvals",element:i.jsx(ka,{children:i.jsx(zD,{})})}),i.jsx(xt,{path:"/admin/correction-requests",element:i.jsx(ka,{children:i.jsx(VD,{})})}),i.jsx(xt,{path:"/employee/login",element:i.jsx(GD,{})}),i.jsxs(xt,{path:"/employee",element:i.jsx(KD,{}),children:[i.jsx(xt,{index:!0,element:i.jsx(Sf,{to:"/employee/dashboard",replace:!0})}),i.jsx(xt,{path:"dashboard",element:i.jsx(XD,{})}),i.jsx(xt,{path:"leaves",element:i.jsx(YD,{})}),i.jsx(xt,{path:"apply-leave",element:i.jsx(QD,{})}),i.jsx(xt,{path:"attendance",element:i.jsx(JD,{})}),i.jsx(xt,{path:"profile",element:i.jsx(ZD,{})})]}),i.jsx(xt,{path:"/employees",element:i.jsx(ka,{children:i.jsx(OD,{registerCleanup:t=>e.current=t})})}),i.jsx(xt,{path:"/reports",element:i.jsx(ka,{children:i.jsx(FD,{})})})]})]})}const nI=sd.createRoot(document.getElementById("root"));nI.render(i.jsx(Cs.StrictMode,{children:i.jsx(tI,{})}))});export default rI();
